

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/about/dogs.jpg">
  <link rel="icon" href="/img/about/dogs.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="ranzier">
  <meta name="keywords" content="">
  
    <meta name="description" content="ÂïÜÂìÅÁßíÊùÄ(GoodsKill)  Êú¨ÊñáÂØπgithubÂïÜÂìÅÁßíÊùÄÈ°πÁõÆËøõË°åÈ°πÁõÆÊãÜËß£ÂàÜÊûêÂíå‰ª£Á†ÅËØ¶Ëß£Ôºå‰ªéËÄåÂ≠¶‰π†ÂæÆÊúçÂä°ÁöÑÁü•ËØÜ„Äã„ÄÇ„ÄÇ(Â¶ÇÊúâ‰æµÊùÉÔºåËØ∑ËÅîÁ≥ªÊàëÂà†Èô§) È°πÁõÆÂú∞ÂùÄÔºögoodsKill 1. È°πÁõÆÊ®°ÂùóÊÄªËßà123456789101112131415goodsKill|--goodskill-admin                          ||SpringBoot AdminÁõëÊéßÊúçÂä°Á´ØÔºåÊîØÊåÅSpr">
<meta property="og:type" content="article">
<meta property="og:title" content="GoodsKillÈ°πÁõÆÂàÜÊûêÂèä‰∫ÆÁÇπËß£Êûê">
<meta property="og:url" content="http://example.com/2025/06/11/JAVA/GoodsKill/index.html">
<meta property="og:site_name" content="RANZIER">
<meta property="og:description" content="ÂïÜÂìÅÁßíÊùÄ(GoodsKill)  Êú¨ÊñáÂØπgithubÂïÜÂìÅÁßíÊùÄÈ°πÁõÆËøõË°åÈ°πÁõÆÊãÜËß£ÂàÜÊûêÂíå‰ª£Á†ÅËØ¶Ëß£Ôºå‰ªéËÄåÂ≠¶‰π†ÂæÆÊúçÂä°ÁöÑÁü•ËØÜ„Äã„ÄÇ„ÄÇ(Â¶ÇÊúâ‰æµÊùÉÔºåËØ∑ËÅîÁ≥ªÊàëÂà†Èô§) È°πÁõÆÂú∞ÂùÄÔºögoodsKill 1. È°πÁõÆÊ®°ÂùóÊÄªËßà123456789101112131415goodsKill|--goodskill-admin                          ||SpringBoot AdminÁõëÊéßÊúçÂä°Á´ØÔºåÊîØÊåÅSpr">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/bg/38.jpg">
<meta property="article:published_time" content="2025-06-11T14:01:29.000Z">
<meta property="article:modified_time" content="2025-10-14T08:08:19.722Z">
<meta property="article:author" content="ranzier">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="SpringCloud">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/bg/38.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>GoodsKillÈ°πÁõÆÂàÜÊûêÂèä‰∫ÆÁÇπËß£Êûê - RANZIER</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ‰∏ªÈ¢ò‰æùËµñÁöÑÂõæÊ†áÂ∫ìÔºå‰∏çË¶ÅËá™Ë°å‰øÆÊîπ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3846514_kabxni94auf.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/gundongtiao.css">
<link rel="stylesheet" href="/css/bubble.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"üåü","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body><!-- hexo injector body_begin start --><div id="web_bg"></div><!-- hexo injector body_begin end -->
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>RANZIER</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>È¶ñÈ°µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>ÂΩíÊ°£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>ÂàÜÁ±ª</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Ê†áÁ≠æ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>ÂÖ≥‰∫é</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bg/3.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.35)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="GoodsKillÈ°πÁõÆÂàÜÊûêÂèä‰∫ÆÁÇπËß£Êûê"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-06-11 22:01" pubdate>
          2025Âπ¥6Êúà11Êó• Êôö‰∏ä
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          38k Â≠ó
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          189 ÂàÜÈíü
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          Êú¨ÊñáÈòÖËØªÊ¨°Êï∞Ôºö<span id="busuanzi_value_page_pv"></span> Ê¨°
        </span>
        

      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">GoodsKillÈ°πÁõÆÂàÜÊûêÂèä‰∫ÆÁÇπËß£Êûê</h1>
            
            
              <div class="markdown-body">
                
                <h1 align="center">ÂïÜÂìÅÁßíÊùÄ(GoodsKill)</h1>

<p>Êú¨ÊñáÂØπgithubÂïÜÂìÅÁßíÊùÄÈ°πÁõÆËøõË°åÈ°πÁõÆÊãÜËß£ÂàÜÊûêÂíå‰ª£Á†ÅËØ¶Ëß£Ôºå‰ªéËÄåÂ≠¶‰π†ÂæÆÊúçÂä°ÁöÑÁü•ËØÜ„Äã„ÄÇ„ÄÇ(<strong>Â¶ÇÊúâ‰æµÊùÉÔºåËØ∑ËÅîÁ≥ªÊàëÂà†Èô§</strong>)</p>
<p>È°πÁõÆÂú∞ÂùÄÔºö<a target="_blank" rel="noopener" href="https://github.com/techa03/goodsKill">goodsKill</a></p>
<h1 id="1-È°πÁõÆÊ®°ÂùóÊÄªËßà"><a href="#1-È°πÁõÆÊ®°ÂùóÊÄªËßà" class="headerlink" title="1. È°πÁõÆÊ®°ÂùóÊÄªËßà"></a>1. È°πÁõÆÊ®°ÂùóÊÄªËßà</h1><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">goodsKill<br>|<span class="hljs-string">--goodskill-admin                          </span>||<span class="hljs-string">SpringBoot AdminÁõëÊéßÊúçÂä°Á´ØÔºåÊîØÊåÅSpring CloudÂæÆÊúçÂä°ÂèëÁé∞</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-ai                             </span>||<span class="hljs-string">AIÊú∫Âô®‰∫∫ËÅäÂ§©ÊúçÂä°</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-gateway                        </span>||<span class="hljs-string">ÂæÆÊúçÂä°APIÁΩëÂÖ≥ÔºåÁªü‰∏ÄÊúçÂä°Èâ¥ÊùÉÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±Âä†ËΩΩ</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-order-provider                 </span>||<span class="hljs-string">ËÆ¢ÂçïÊúçÂä°Êèê‰æõËÄÖ</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-seckill-provider               </span>||<span class="hljs-string">ÁßíÊùÄÊúçÂä°Êèê‰æõËÄÖ</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-spring-boot-starter            </span>||<span class="hljs-string">È°πÁõÆÈÖçÁΩÆËá™Âä®Ë£ÖÈÖç</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-common                         </span>||<span class="hljs-string">ÂÖ¨ÂÖ±ÊúçÂä°(ÁõÆÂâçÂåÖÂê´minio‰∏ä‰º†‰∏ãËΩΩÂäüËÉΩ)</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-web                            </span>||<span class="hljs-string">Êèê‰æõÁßíÊùÄÊ®°ÊãüÊé•Âè£ËÆøÈóÆ</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-job                            </span>||<span class="hljs-string">elastic-jobÂÆöÊó∂‰ªªÂä°</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-seata                          </span>||<span class="hljs-string">ÈõÜÊàênacos+dubbo+shardingjdbc+seataÁöÑÂàÜÂ∏ÉÂºè‰∫ãÂä°Ëß£ÂÜ≥ÊñπÊ°àÁ§∫‰æã</span><br><span class="hljs-string"></span>|<span class="hljs-string">--goodskill-auth                           </span>||<span class="hljs-string">authÁôªÂΩï‰ª•ÂèäÊéàÊùÉÊ®°Âùó</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">--auth-service                         </span>||<span class="hljs-string">Âü∫‰∫éSa-TokenÊ°ÜÊû∂ÁöÑÁî®Êà∑ÁôªÂΩïÊéàÊùÉÊúçÂä°</span><br><span class="hljs-string">    </span>|<span class="hljs-string">--oauth2-auth-server                   </span>||<span class="hljs-string">oauth2.0ÁôªÂΩïÊéàÊùÉÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°</span><br><span class="hljs-string">    </span>|<span class="hljs-string">--oauth2-resource-server               </span>||<span class="hljs-string">oauth2.0ËµÑÊ∫êÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°</span><br></code></pre></td></tr></table></figure>

<h1 id="2-goodskill-order-provider-ËÆ¢ÂçïÊúçÂä°Êèê‰æõËÄÖ"><a href="#2-goodskill-order-provider-ËÆ¢ÂçïÊúçÂä°Êèê‰æõËÄÖ" class="headerlink" title="2. goodskill-order-provider (ËÆ¢ÂçïÊúçÂä°Êèê‰æõËÄÖ)"></a>2. goodskill-order-provider (ËÆ¢ÂçïÊúçÂä°Êèê‰æõËÄÖ)</h1><p>ÂàÜ‰∏∫‰∏§‰∏™Ê®°ÂùóÔºö</p>
<ul>
<li>goodskill-order-api</li>
<li>goodskill-order-service</li>
</ul>
<h2 id="2-1-goodskill-order-api"><a href="#2-1-goodskill-order-api" class="headerlink" title="2.1 goodskill-order-api"></a>2.1 goodskill-order-api</h2><p><img src="/img/blogs/java/goodskill/2.1.1.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>OrderServiceÊé•Âè£ÂèäÂÖ∂ÂÆûÁé∞Á±ª</strong>Ôºö</p>
<ul>
<li>OrderServiceÊé•Âè£</li>
<li>OrderServiceFallbackÂÆûÁé∞Á±ª</li>
</ul>
<p>Âü∫‰∫é Spring Cloud OpenFeign ÂÆûÁé∞ÁöÑ <strong>ËÆ¢ÂçïÂæÆÊúçÂä° (goodskill-order) ËøúÁ®ãË∞ÉÁî®Êé•Âè£</strong>ÔºåÂπ∂Êèê‰æõ‰∫Ü <strong>ÁÜîÊñ≠ÈôçÁ∫ßÂ§ÑÁêÜ</strong>„ÄÇ<br>ÂÆÉÁöÑ‰ΩúÁî®ÊòØËÆ©ÂÖ∂‰ªñÂæÆÊúçÂä°ÔºàÊØîÂ¶Ç goodskill-seckill-providerÔºâÂèØ‰ª•ÈÄöËøá FeignClient ËøúÁ®ãË∞ÉÁî®ËÆ¢ÂçïÊúçÂä°ÔºåÂπ∂Âú®ÊúçÂä°‰∏çÂèØÁî®Êó∂Êèê‰æõÈôçÁ∫ßÁ≠ñÁï•„ÄÇ</p>
<h4 id="OrderServiceÊé•Âè£"><a href="#OrderServiceÊé•Âè£" class="headerlink" title="OrderServiceÊé•Âè£"></a>OrderServiceÊé•Âè£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">ÊåáÂÆöË∞ÉÁî®ÁöÑÂæÆÊúçÂä°ÂêçÁß∞Ôºögoodskill-order</span><br><span class="hljs-comment">ËÆæÁΩÆÁÜîÊñ≠ÈôçÁ∫ßÂÆûÁé∞Á±ªÔºöOrderServiceFallback</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@FeignClient(value = &quot;goodskill-order&quot;, fallback = OrderServiceFallback.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderService</span> &#123;<br><br>    <span class="hljs-comment">//Ë∞ÉÁî® goodskill-order ÊúçÂä°ÁöÑ /deleteRecord Êé•Âè£ÔºåÂà†Èô§ÁßíÊùÄËÆ¢Âçï</span><br>    <span class="hljs-meta">@DeleteMapping(&quot;/deleteRecord&quot;)</span><br>    Boolean <span class="hljs-title function_">deleteRecord</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> <span class="hljs-type">long</span> seckillId)</span>;<br><br>    <span class="hljs-comment">//Ë∞ÉÁî® goodskill-order ÊúçÂä°ÁöÑ /saveRecord Êé•Âè£Ôºå‰øùÂ≠òËÆ¢ÂçïËÆ∞ÂΩï„ÄÇ</span><br>    <span class="hljs-meta">@PostMapping(&quot;/saveRecord&quot;)</span><br>    Boolean <span class="hljs-title function_">saveRecord</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrderDTO orderDTO)</span>;<br><br>    <span class="hljs-comment">//Ë∞ÉÁî® goodskill-order ÊúçÂä°ÁöÑ /count Êé•Âè£ÔºåÊü•ËØ¢Êüê‰∏™ seckillId ÁöÑ ËÆ¢ÂçïÊï∞Èáè„ÄÇ</span><br>    <span class="hljs-meta">@GetMapping(&quot;/count&quot;)</span><br>    <span class="hljs-type">long</span> <span class="hljs-title function_">count</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> <span class="hljs-type">long</span> seckillId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ÊåáÂÆö<strong>Ë∞ÉÁî®ÁöÑÂæÆÊúçÂä°ÂêçÁß∞Ôºögoodskill-order</strong></li>
<li>ËÆæÁΩÆ<strong>ÁÜîÊñ≠ÈôçÁ∫ßÂÆûÁé∞Á±ªÔºöOrderServiceFallback</strong></li>
<li>ËøôÊÑèÂë≥ÁùÄÂΩì goodskill-order ÊúçÂä° ‰∏çÂèØÁî® Êó∂ÔºåË∞ÉÁî® OrderServiceFallback ÈáåÁöÑÊñπÊ≥ï<strong>ËøîÂõûÈªòËÆ§ÂÄºÔºåËÄå‰∏çÊòØËÆ©ËØ∑Ê±ÇÁõ¥Êé•Â§±Ë¥•</strong>„ÄÇ</li>
</ul>
<p>Êé•Âè£‰∏≠Ôºö<strong>ÂÆö‰πâËøúÁ®ãË∞ÉÁî®ÁöÑ API</strong></p>
<ul>
<li>Ë∞ÉÁî® goodskill-order ÊúçÂä°ÁöÑ &#x2F;deleteRecord Êé•Âè£ÔºåÂà†Èô§ÁßíÊùÄËÆ¢Âçï</li>
<li>Ë∞ÉÁî® goodskill-order ÊúçÂä°ÁöÑ &#x2F;saveRecord Êé•Âè£Ôºå‰øùÂ≠òËÆ¢ÂçïËÆ∞ÂΩï„ÄÇ</li>
<li>Ë∞ÉÁî® goodskill-order ÊúçÂä°ÁöÑ &#x2F;count Êé•Âè£ÔºåÊü•ËØ¢Êüê‰∏™ seckillId ÁöÑ ËÆ¢ÂçïÊï∞Èáè„ÄÇ</li>
</ul>
<h4 id="OrderServiceFallbackÔºàÁÜîÊñ≠ÈôçÁ∫ßÂÆûÁé∞Á±ªÔºâ"><a href="#OrderServiceFallbackÔºàÁÜîÊñ≠ÈôçÁ∫ßÂÆûÁé∞Á±ªÔºâ" class="headerlink" title="OrderServiceFallbackÔºàÁÜîÊñ≠ÈôçÁ∫ßÂÆûÁé∞Á±ªÔºâ"></a>OrderServiceFallbackÔºàÁÜîÊñ≠ÈôçÁ∫ßÂÆûÁé∞Á±ªÔºâ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">ÁÜîÊñ≠ÈôçÁ∫ßÂÆûÁé∞Á±ªÔºöOrderServiceFallback</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceFallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-comment">//ÈôçÁ∫ßÁ≠ñÁï•ÔºöÂΩì deleteRecord() Ë∞ÉÁî®Â§±Ë¥•Êó∂ÔºåËøîÂõû falseÔºåË°®Á§∫Âà†Èô§Â§±Ë¥•„ÄÇ</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">deleteRecord</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//ÈôçÁ∫ßÁ≠ñÁï•ÔºöÂΩì saveRecord() Ë∞ÉÁî®Â§±Ë¥•Êó∂ÔºåËøîÂõû falseÔºåË°®Á§∫ËÆ¢Âçï‰øùÂ≠òÂ§±Ë¥•„ÄÇ</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">saveRecord</span><span class="hljs-params">(OrderDTO orderDTO)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//ÈôçÁ∫ßÁ≠ñÁï•Ôºöcount() ÊñπÊ≥ïÂú®ÈôçÁ∫ßÊó∂ ÊäõÂá∫ÂºÇÂ∏∏ÔºåË°®Á§∫Ê≠§Êé•Âè£‰∏çÊèê‰æõÂ§áÁî®ÊñπÊ°à„ÄÇ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">count</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoFallbackAvailableException</span>(<span class="hljs-string">&quot;Boom!&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ÈôçÁ∫ßÁ≠ñÁï•Ôºö</p>
<ul>
<li>ÂΩì deleteRecord() Ë∞ÉÁî®Â§±Ë¥•Êó∂ÔºåËøîÂõû falseÔºåË°®Á§∫Âà†Èô§Â§±Ë¥•„ÄÇ</li>
<li>count() ÊñπÊ≥ïÂú®ÈôçÁ∫ßÊó∂ ÊäõÂá∫ÂºÇÂ∏∏ÔºåË°®Á§∫Ê≠§Êé•Âè£‰∏çÊèê‰æõÂ§áÁî®ÊñπÊ°à„ÄÇ</li>
</ul>
<h2 id="2-2-goodskill-order-service"><a href="#2-2-goodskill-order-service" class="headerlink" title="2.2 goodskill-order-service"></a>2.2 goodskill-order-service</h2><p><img src="/img/blogs/java/goodskill/2.2.1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-2-1-OrderApplicationÂêØÂä®Á±ª"><a href="#2-2-1-OrderApplicationÂêØÂä®Á±ª" class="headerlink" title="2.2.1 OrderApplicationÂêØÂä®Á±ª"></a>2.2.1 OrderApplicationÂêØÂä®Á±ª</h3><p>ËÆ¢ÂçïÂæÆÊúçÂä°Ôºàgoodskill-order-providerÔºâÁöÑÂêØÂä®Á±ª OrderApplicationÔºå‰ΩøÁî®ÁöÑÊòØ Spring Boot + MongoDB + Ê∂àÊÅØÈ©±Âä®Ê®°ÂûãÔºàÁ±ª‰ºº Stream Ê∂àË¥πÔºâ„ÄÇ</p>
<ul>
<li>ÂÆûÁé∞ÔºöÁõëÂê¨Âêç‰∏∫ seckillMongoSave ÁöÑÊ∂àÊÅØÈòüÂàóÔºàÊàñÈÄöÈÅìÔºâÔºå<strong>Êé•Êî∂ÁßíÊùÄËØ∑Ê±Ç‰ø°ÊÅØ</strong> SeckillMockSaveVoÔºåÁÑ∂Âêé<strong>Â∞ÅË£Ö‰∏∫ OrderDTO ÂØπË±°Âπ∂Â≠òÂÖ• MongoDB</strong>„ÄÇ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication(scanBasePackages = &#123;&quot;com.goodskill.order&quot;, &quot;com.goodskill.core&quot;&#125;)</span><br><span class="hljs-meta">@EnableMongoRepositories(basePackages = &quot;com.goodskill.order.repository&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderApplication</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderServiceImpl mongoService;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplicationBuilder</span>(OrderApplication.class)<br>                .web(WebApplicationType.SERVLET)<br>                .registerShutdownHook(<span class="hljs-literal">true</span>)<br>                .run(args);<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    ÂÆö‰πâ BeanÔºöÁõëÂê¨Ê∂àÊÅØÈÄöÈÅì seckillMongoSave</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Consumer&lt;SeckillMockSaveVo&gt; <span class="hljs-title function_">seckillMongoSave</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> it -&gt; &#123;<br>            log.info(<span class="hljs-string">&quot;Êé•Êî∂Âà∞Ê∂àÊÅØ:&#123;&#125;&quot;</span>, it);<br>            <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">orderDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDTO</span>();<br>            orderDTO.setSeckillId(BigInteger.valueOf(it.getSeckillId()));<br>            orderDTO.setUserPhone(it.getUserPhone());<br>            orderDTO.setCreateTime(LocalDateTime.now());<br>            mongoService.saveRecord(orderDTO);<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ÂêØÂä®ËÆ¢ÂçïÊúçÂä°ÔºàÂü∫‰∫é Spring BootÔºâ</li>
<li>ÂêØÁî® MongoDB ÁöÑ‰ªìÂ∫ìÊîØÊåÅ</li>
<li>ÁõëÂê¨Âêç‰∏∫ seckillMongoSave ÁöÑÊ∂àÊÅØÈÄöÈÅì</li>
<li>ÊØèÂΩìÊúâÁî®Êà∑ÁßíÊùÄËØ∑Ê±ÇÔºàÂ¶ÇÂéãÊµãÊ®°ÊãüÊï∞ÊçÆÔºâÈÄöËøáÊ∂àÊÅØ‰∏≠Èó¥‰ª∂ÂèëÊù•Êó∂Ôºö<ul>
<li>Êé•Êî∂Ê∂àÊÅØ</li>
<li>ÊûÑÂª∫ËÆ¢ÂçïÂØπË±° OrderDTO</li>
<li>Ë∞ÉÁî® OrderServiceImpl Â∞ÜÂÖ∂‰øùÂ≠òËá≥ MongoDB</li>
</ul>
</li>
</ul>
<h3 id="2-2-2-ËÆ¢ÂçïÂæÆÊúçÂä°ÁöÑÊé•Âè£ÂíåÂÆûÁé∞Á±ª"><a href="#2-2-2-ËÆ¢ÂçïÂæÆÊúçÂä°ÁöÑÊé•Âè£ÂíåÂÆûÁé∞Á±ª" class="headerlink" title="2.2.2 ËÆ¢ÂçïÂæÆÊúçÂä°ÁöÑÊé•Âè£ÂíåÂÆûÁé∞Á±ª"></a>2.2.2 ËÆ¢ÂçïÂæÆÊúçÂä°ÁöÑÊé•Âè£ÂíåÂÆûÁé∞Á±ª</h3><ul>
<li>OrderController</li>
<li>OrderRepository</li>
<li>OrderServiceImpl</li>
</ul>
<h4 id="OrderController"><a href="#OrderController" class="headerlink" title="OrderController"></a>OrderController</h4><p>OrderController ÊòØËÆ¢ÂçïÊ®°ÂùóÔºàgoodskill-order-providerÔºâÁöÑ‰∏Ä‰∏™ REST ÊéßÂà∂Âô®Á±ªÔºåÁî®‰∫éÊèê‰æõÂØπËÆ¢ÂçïÁöÑ Âü∫Á°ÄÂ¢ûÂà†Êü•Êé•Âè£Ôºå‰∏ªË¶ÅÊòØ‰æõÂÜÖÈÉ®ÊúçÂä°ÊàñÂÖ∂‰ªñÂæÆÊúçÂä°Ë∞ÉÁî®ÔºåÊØîÂ¶ÇÁßíÊùÄÊúçÂä°„ÄÅÂâçÁ´ØÁÆ°ÁêÜÁ≥ªÁªüÁ≠â„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">Êèê‰æõ‰∫Ü ËÆ¢ÂçïËÆ∞ÂΩïÁöÑÊñ∞Â¢û„ÄÅÂà†Èô§„ÄÅÁªüËÆ°Êü•ËØ¢ÁöÑ HTTP Êé•Âè£</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderServiceImpl orderService;<br><br>    <span class="hljs-meta">@DeleteMapping(&quot;/deleteRecord&quot;)</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">deleteRecord</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-keyword">return</span> orderService.deleteRecord(seckillId);<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/saveRecord&quot;)</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">saveRecord</span><span class="hljs-params">(OrderDTO orderDTO)</span> &#123;<br>        <span class="hljs-keyword">return</span> orderService.saveRecord(orderDTO);<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/count&quot;)</span><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">count</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-keyword">return</span> orderService.count(seckillId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>ÂäüËÉΩËØ¥Êòé</th>
<th>ËØ∑Ê±ÇÊñπÂºè</th>
<th>Ë∑ØÂæÑ</th>
</tr>
</thead>
<tbody><tr>
<td>deleteRecord</td>
<td>Âà†Èô§Êüê‰∏™ÁßíÊùÄIDÁöÑËÆ¢ÂçïËÆ∞ÂΩï</td>
<td>DELETE</td>
<td>&#x2F;deleteRecord</td>
</tr>
<tr>
<td>saveRecord</td>
<td>‰øùÂ≠òËÆ¢ÂçïËÆ∞ÂΩï</td>
<td>POST</td>
<td>&#x2F;saveRecord</td>
</tr>
<tr>
<td>count</td>
<td>Êü•ËØ¢ÊüêÊ¥ªÂä®ÁöÑËÆ¢ÂçïÊÄªÊï∞</td>
<td>GET</td>
<td>&#x2F;count</td>
</tr>
</tbody></table>
<h4 id="OrderRepositoryÊé•Âè£"><a href="#OrderRepositoryÊé•Âè£" class="headerlink" title="OrderRepositoryÊé•Âè£"></a>OrderRepositoryÊé•Âè£</h4><p>OrderRepository Êé•Âè£ÊòØËÆ¢ÂçïÊúçÂä°‰∏≠Áî®‰∫é <strong>Êìç‰Ωú MongoDB ÁöÑÊï∞ÊçÆËÆøÈóÆÂ±Ç</strong>ÔºàDAOÔºâÔºåÂÆÉÁªßÊâøËá™ Spring Data MongoDB Êèê‰æõÁöÑ MongoRepositoryÔºåËÆ©‰Ω†Âá†‰πé‰∏çÁî®ÂÜô SQL&#x2F;Êü•ËØ¢ËØ≠Âè•ÔºåÂ∞±ÂèØ‰ª•ÂÆûÁé∞ÂØπ Order ÂÆû‰ΩìÁöÑ CRUD Êìç‰Ωú„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MongoRepository</span>&lt;Order, String&gt; &#123;<br><br>    <span class="hljs-comment">//Ê†πÊçÆ seckillId Âà†Èô§ÊâÄÊúâÂØπÂ∫îÁöÑËÆ¢ÂçïËÆ∞ÂΩï</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBySeckillId</span><span class="hljs-params">(BigInteger seckillId)</span>;<br><br>    <span class="hljs-comment">//ÁªüËÆ°Êüê‰∏™ÁßíÊùÄÊ¥ªÂä®ÂØπÂ∫îÁöÑËÆ¢ÂçïÊï∞Èáè</span><br>    <span class="hljs-type">long</span> <span class="hljs-title function_">countBySeckillId</span><span class="hljs-params">(BigInteger seckillId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Ëøô‰∏™Êé•Âè£ÊòØ Êìç‰Ωú MongoDB ÁöÑÊ†∏ÂøÉ DAO Êé•Âè£ÔºåÂäüËÉΩÂ¶Ç‰∏ãÔºö</p>
<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>‰ΩúÁî®</th>
</tr>
</thead>
<tbody><tr>
<td>deleteBySeckillId()</td>
<td>Âà†Èô§Êüê‰∏™Ê¥ªÂä®‰∏ãÁöÑËÆ¢ÂçïËÆ∞ÂΩï</td>
</tr>
<tr>
<td>countBySeckillId()</td>
<td>ÁªüËÆ°Êüê‰∏™Ê¥ªÂä®‰∏ãÁöÑËÆ¢ÂçïÊï∞Èáè</td>
</tr>
<tr>
<td>ÔºàÁªßÊâøËá™ MongoRepositoryÔºâ</td>
<td>Êèê‰æõÂ∏∏Áî®Â¢ûÂà†ÊîπÊü•Êìç‰Ωú</td>
</tr>
</tbody></table>
<h4 id="OrderServiceImpl"><a href="#OrderServiceImpl" class="headerlink" title="OrderServiceImpl"></a>OrderServiceImpl</h4><p>OrderServiceImpl ÊòØËÆ¢ÂçïÊ®°ÂùóÔºàgoodskill-order-providerÔºâÁöÑ <strong>‰∏öÂä°ÈÄªËæëÂÆûÁé∞Á±ª</strong>ÔºåÁî®‰∫éÂ§ÑÁêÜÂíåÂ∞ÅË£ÖËÆ¢ÂçïÁöÑÊ†∏ÂøÉÊìç‰ΩúÔºö<strong>‰øùÂ≠òËÆ¢Âçï„ÄÅÂà†Èô§ËÆ¢Âçï„ÄÅÁªüËÆ°ËÆ¢ÂçïÊï∞Èáè</strong>„ÄÇÂÆÉ‰Ωú‰∏∫ OrderController ÁöÑ <strong>Service Â±ÇÂÆûÁé∞Á±ª</strong>ÔºåÂπ∂‰æùËµñ MongoDB ËøõË°åÊåÅ‰πÖÂåñÂ≠òÂÇ®„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderRepository orderRepository;<br><br>    <span class="hljs-comment">//Âà†Èô§ÊüêÂú∫ÁßíÊùÄÊ¥ªÂä®‰∏ãÁöÑÊâÄÊúâËÆ¢ÂçïËÆ∞ÂΩï</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">deleteRecord</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        orderRepository.deleteBySeckillId(BigInteger.valueOf(seckillId));<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//Áî®‰∫éÁßíÊùÄÊàêÂäüÊó∂ËêΩÂ∫ìÔºåÊàñÂéãÊµãÊ®°ÊãüÁîüÊàêËÆ¢Âçï</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">saveRecord</span><span class="hljs-params">(OrderDTO orderDTO)</span> &#123;<br>        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> Order.builder()<br>                .id(UUID.randomUUID().toString())<br>                .seckillId(orderDTO.getSeckillId())<br>                .userPhone(orderDTO.getUserPhone())<br>                .build();<br>        orderRepository.insert(order);<br>        log.info(<span class="hljs-string">&quot;‰øùÂ≠òÊàêÂäü,&#123;&#125;&quot;</span>, order);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//ÁªüËÆ°Êüê‰∏™ seckillId ÂØπÂ∫îÁöÑËÆ¢ÂçïÊï∞</span><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">count</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-keyword">return</span> orderRepository.countBySeckillId(BigInteger.valueOf(seckillId));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>OrderServiceImpl ÊòØËÆ¢ÂçïÂæÆÊúçÂä°ÁöÑÊ†∏ÂøÉ‰∏öÂä°Á±ªÔºåË¥üË¥£ËÆ¢ÂçïÊï∞ÊçÆÁöÑ ÂàõÂª∫„ÄÅÊ∏ÖÁêÜ„ÄÅÁªüËÆ°</li>
<li>Áî®‰∫éÊìç‰ΩúËÆ¢ÂçïÊï∞ÊçÆÁöÑ ÊúçÂä°ÂÆûÁé∞Á±ªÔºåË∞ÉÁî®Â∫ïÂ±Ç OrderRepository ÂÆåÊàê CRUDÔºåÂπ∂ÂØπÂ§ñÊèê‰æõÁªü‰∏ÄÁöÑ‰∏öÂä°ÈÄªËæëÂ∞ÅË£Ö</li>
</ul>
<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>‰ΩúÁî®</th>
<th>Ë∞ÉÁî®Â∫ïÂ±Ç DAO ÊñπÊ≥ï</th>
</tr>
</thead>
<tbody><tr>
<td>deleteRecord</td>
<td>Âà†Èô§ÊåáÂÆöÁßíÊùÄÊ¥ªÂä®ÁöÑÊâÄÊúâËÆ¢ÂçïËÆ∞ÂΩï</td>
<td>deleteBySeckillId(‚Ä¶)</td>
</tr>
<tr>
<td>saveRecord</td>
<td>‰øùÂ≠òËÆ¢ÂçïÊï∞ÊçÆÂà∞ MongoDB</td>
<td>insert(order)</td>
</tr>
<tr>
<td>count</td>
<td>ÁªüËÆ°ÊüêÁßíÊùÄÊ¥ªÂä®ÂØπÂ∫îÁöÑËÆ¢ÂçïÊï∞Èáè</td>
<td>countBySeckillId(‚Ä¶)</td>
</tr>
</tbody></table>
<h3 id="2-2-3-application-ymlÈÖçÁΩÆÊñá‰ª∂"><a href="#2-2-3-application-ymlÈÖçÁΩÆÊñá‰ª∂" class="headerlink" title="2.2.3 application.ymlÈÖçÁΩÆÊñá‰ª∂"></a>2.2.3 application.ymlÈÖçÁΩÆÊñá‰ª∂</h3><p>ÈÖçÁΩÆÊñá‰ª∂‰∏∫ goodskill-order ÂæÆÊúçÂä°ÂáÜÂ§á‰∫Ü ÂºÄÂèëÁéØÂ¢É‰∏ãÁöÑËøêË°åÂü∫Á°ÄËÆæÊñΩÊîØÊåÅ</p>
<ul>
<li>ÊúçÂä°Ê≥®ÂÜå&#x2F;ÈÖçÁΩÆÔºöNacos</li>
<li>Ê∂àÊÅØÁõëÂê¨ÔºöRabbitMQ + Stream + Function</li>
<li>Êï∞ÊçÆÂ≠òÂÇ®ÔºöMongoDBÔºàÂê´Ëá™Âä®Á¥¢ÂºïÔºâ</li>
<li>Êó•ÂøóË∞ÉËØïÔºöMongo Êìç‰ΩúÂèØËßÅ</li>
<li>È°πÁõÆËß£ËÄ¶ÂíåÂ§öÁéØÂ¢ÉÊîØÊåÅÔºöÈÖçÁΩÆ‰∏≠ÂøÉÂØºÂÖ• + Âä®ÊÄÅÁ´ØÂè£ + graceful shutdown</li>
</ul>
<h1 id="3-goodskill-seckill-provider-ÁßíÊùÄÊúçÂä°Êèê‰æõËÄÖ"><a href="#3-goodskill-seckill-provider-ÁßíÊùÄÊúçÂä°Êèê‰æõËÄÖ" class="headerlink" title="3. goodskill-seckill-provider (ÁßíÊùÄÊúçÂä°Êèê‰æõËÄÖ)"></a>3. goodskill-seckill-provider (ÁßíÊùÄÊúçÂä°Êèê‰æõËÄÖ)</h1><p>ÂàÜ‰∏∫‰∏§‰∏™Ê®°ÂùóÔºö</p>
<ul>
<li>goodskill-api</li>
<li>goodskill-service</li>
</ul>
<h2 id="3-1-goodskill-api"><a href="#3-1-goodskill-api" class="headerlink" title="3.1 goodskill-api"></a>3.1 goodskill-api</h2><p><img src="/img/blogs/java/goodskill/3.1.1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-1-1-DTOÂíåVO"><a href="#3-1-1-DTOÂíåVO" class="headerlink" title="3.1.1 DTOÂíåVO"></a>3.1.1 DTOÂíåVO</h3><p><strong>DTOÊï∞ÊçÆ‰º†ËæìÂØπË±°</strong>Ôºö</p>
<ul>
<li><code>ExposerDTO</code>: <strong>Êö¥Èú≤ÁßíÊùÄÂú∞ÂùÄ</strong> ÁöÑÊï∞ÊçÆ‰º†ËæìÂØπË±°ÔºàDTOÔºâÔºåÂÆÉÁöÑ‰ΩúÁî®ÊòØÂú®ÁßíÊùÄÊé•Âè£ÂºÄÊîæÊó∂Ôºå<strong>ÂêëÂâçÁ´ØËøîÂõûÂΩìÂâçÁßíÊùÄÁöÑÁä∂ÊÄÅÂíåÂøÖË¶ÅÂèÇÊï∞</strong>ÔºàÂ¶Ç MD5 Âä†ÂØÜ‰∏≤Ôºâ</li>
<li><code>GoodsDTO</code>: <strong>ÂïÜÂìÅ‰ø°ÊÅØ</strong>ÁöÑ Êï∞ÊçÆ‰º†ËæìÂØπË±°ÔºàDTOÔºâ,Áî®‰∫éÂ∞ÅË£ÖÁßíÊùÄÂïÜÂìÅÊàñÊôÆÈÄöÂïÜÂìÅÁöÑÂü∫Êú¨‰ø°ÊÅØÔºå‰æø‰∫éÊúçÂä°‰πãÈó¥‰º†ËæìÊàñÂ±ïÁ§∫Âú®ÂâçÁ´ØÈ°µÈù¢</li>
<li><code>SeckillExecutionDTO</code>: Áî®‰∫éË°®Á§∫ <strong>ÁßíÊùÄÊâßË°åÁªìÊûú</strong> ÁöÑÊï∞ÊçÆ‰º†ËæìÂØπË±°ÔºàDTOÔºâÔºå‰∏ªË¶ÅÊòØÁî®Êù•Â∞ÅË£Ö‰∏Ä‰∏™Áî®Êà∑ÂèÇ‰∏éÁßíÊùÄÂêéÁöÑÁªìÊûúËØ¶ÊÉÖÔºåÊØîÂ¶ÇÊàêÂäü&#x2F;Â§±Ë¥•Áä∂ÊÄÅ„ÄÅÁõ∏ÂÖ≥ÊèèËø∞„ÄÅ‰∏ãÂçïÊï∞ÊçÆ„ÄÅ‰ª•Âèä‰∫åÁª¥Á†ÅË∑ØÂæÑÁ≠â</li>
<li><code>SeckillInfoDTO</code>: Â∞ÅË£Ö<strong>ÁßíÊùÄÊ¥ªÂä®Âü∫Êú¨‰ø°ÊÅØ</strong>ÁöÑ‰∏Ä‰∏™Êï∞ÊçÆ‰º†ËæìÂØπË±°ÔºàDTOÔºâ,Áî®‰∫é‰º†ÈÄíÁßíÊùÄÊ¥ªÂä®ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÔºåÂåÖÊã¨Êó∂Èó¥„ÄÅÂïÜÂìÅ„ÄÅÂ∫ìÂ≠òÂíå‰ª∑Ê†ºÁ≠â</li>
<li><code>SeckillMockCanalResponseDTO</code>: Áî®‰∫éË°®Á§∫<strong>ÁßíÊùÄÊ¥ªÂä®Áä∂ÊÄÅÂèòÊõ¥ÂìçÂ∫îÁªìÊûú</strong>ÁöÑ‰∏Ä‰∏™Êï∞ÊçÆ‰º†ËæìÂØπË±°ÔºàDTOÔºâ,Â∏∏Áî®‰∫éÊ∂àÊÅØ‰º†ÈÄí„ÄÅÊ¥ªÂä®Êõ¥Êñ∞ÂèçÈ¶à</li>
<li><code>SeckillMockRequestDTO</code>: Áî®‰∫é<strong>Ê®°ÊãüÁßíÊùÄËØ∑Ê±Ç</strong>ÁöÑËØ∑Ê±ÇÊï∞ÊçÆ‰º†ËæìÂØπË±°ÔºàDTOÔºâ,‰∏ªË¶ÅÁî®‰∫éÁßíÊùÄÊé•Âè£ÁöÑÂéãÊµãÊàñÂÆöÊó∂‰ªªÂä°Ê®°ÊãüÁî®Êà∑ËØ∑Ê±ÇË°å‰∏∫</li>
<li><code>SeckillMockResponseDTO</code>: Áî®‰∫é<strong>ËøîÂõûÁßíÊùÄÊ®°Êãü‰ªªÂä°ÊâßË°åÁªìÊûú</strong>ÁöÑÂìçÂ∫îÊï∞ÊçÆ‰º†ËæìÂØπË±°ÔºàDTOÔºâ,ÂåÖÂê´ÁßíÊùÄÊ¥ªÂä® ID„ÄÅÊâßË°åÂ§áÊ≥®„ÄÅÁä∂ÊÄÅ‰ª•Âèä‰ªªÂä° ID</li>
<li><code>SeckillResponseDTO</code>: Áî®‰∫éÂ∞ÅË£Ö <strong>ÁßíÊùÄÊìç‰ΩúËøîÂõûÁöÑ‰∫åËøõÂà∂Êï∞ÊçÆ</strong>Ôºàbyte[]ÔºâÔºåÈÄöÂ∏∏Áî®‰∫éËøîÂõû‰∏Ä‰∫õ <strong>ÁªìÊûÑÂåñÊàñÊñá‰ª∂Á±ªÁöÑÊï∞ÊçÆÂÜÖÂÆπ</strong>ÔºåËÄå‰∏çÊòØÁÆÄÂçïÁöÑ JSON ÊñáÊú¨</li>
<li><code>SuccessKilledDTO</code>: Áî®‰∫é<strong>Â∞ÅË£ÖÁßíÊùÄÊàêÂäüËÆ∞ÂΩï</strong>ÁöÑ Êï∞ÊçÆ‰º†ËæìÂØπË±°ÔºàDTOÔºâÔºåÂÆÉËÆ∞ÂΩï‰∫ÜÊüê‰∏™Áî®Êà∑Âú®ÂèÇ‰∏éÊüêÊ¨°ÁßíÊùÄÊ¥ªÂä®Êó∂ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ‰∏éÁä∂ÊÄÅ</li>
</ul>
<p><strong>VO</strong>Ôºö</p>
<ul>
<li><code>GoodsVO</code>: Áî®‰∫éË°®Á§∫ <strong>ÂïÜÂìÅ‰ø°ÊÅØ</strong>ÁöÑÂÄºÂØπË±°,Áî®‰∫é‰º†Ëæì‰∏éÂïÜÂìÅÁõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØÔºåÂ¶ÇÂïÜÂìÅID„ÄÅ‰ª∑Ê†º„ÄÅÊèèËø∞Á≠â</li>
<li><code>SeckillVO</code>: Áî®‰∫éË°®Á§∫ <strong>ÁßíÊùÄÊ¥ªÂä®Áõ∏ÂÖ≥ÁöÑÊï∞ÊçÆ</strong>„ÄÇVO Á±ª‰∏ªË¶ÅÁî®‰∫éÊï∞ÊçÆ‰º†ËæìÔºåÈÄöÂ∏∏Áî®‰∫éÂâçÂêéÁ´ØÊï∞ÊçÆ‰∫§‰∫íÊàñ‰º†ÈÄí‰∏öÂä°Êï∞ÊçÆ</li>
</ul>
<h3 id="3-1-2-ServiceÊé•Âè£"><a href="#3-1-2-ServiceÊé•Âè£" class="headerlink" title="3.1.2 ServiceÊé•Âè£"></a>3.1.2 ServiceÊé•Âè£</h3><ul>
<li>GoodsEsService</li>
<li>GoodsService</li>
<li>SeckillService</li>
</ul>
<h4 id="GoodsEsService"><a href="#GoodsEsService" class="headerlink" title="GoodsEsService"></a>GoodsEsService</h4><p><code>GoodsEsService</code>ÊòØ‰∏Ä‰∏™ <strong>Feign ÂÆ¢Êà∑Á´ØÊé•Âè£</strong>ÔºåÂÆÉÁî®‰∫éÂíå <code>goodskill-seckill</code> ÂæÆÊúçÂä°ËøõË°åÈÄö‰ø°,‰∏∫ goodskill-seckill ÊúçÂä°Êèê‰æõ‰∫Ü‰øùÂ≠òÂïÜÂìÅ„ÄÅÊâπÈáè‰øùÂ≠òÂïÜÂìÅ„ÄÅÂà†Èô§ÂïÜÂìÅ‰ª•ÂèäÂïÜÂìÅÂêçÁß∞ÊêúÁ¥¢ÁöÑÂäüËÉΩ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">Áî®‰∫éÂíå `goodskill-seckill` ÂæÆÊúçÂä°ËøõË°åÈÄö‰ø°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@FeignClient(value = &quot;goodskill-seckill&quot;, contextId = &quot;goods&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GoodsEsService</span> &#123;<br><br>    <span class="hljs-comment">//‰øùÂ≠òÂïÜÂìÅ‰ø°ÊÅØÔºöÈÄöËøá save ÊñπÊ≥ïÔºåÂ∞ÜÂçï‰∏™ÂïÜÂìÅ‰ø°ÊÅØ‰øùÂ≠òÂà∞ goodskill-seckill ÊúçÂä°</span><br>    <span class="hljs-meta">@PutMapping(&quot;/save&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> GoodsDTO goodsDto)</span>;<br><br>    <span class="hljs-comment">//ÊâπÈáè‰øùÂ≠òÂïÜÂìÅ‰ø°ÊÅØÔºöÈÄöËøá saveBatch ÊñπÊ≥ïÔºåÂ∞ÜÂ§ö‰∏™ÂïÜÂìÅ‰ø°ÊÅØÊâπÈáè‰øùÂ≠òÂà∞ goodskill-seckill ÊúçÂä°</span><br>    <span class="hljs-meta">@PutMapping(&quot;/saveBatch&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveBatch</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> List&lt;GoodsDTO&gt; list)</span>;<br><br>    <span class="hljs-comment">//Âà†Èô§ÂïÜÂìÅ‰ø°ÊÅØÔºöÈÄöËøá delete ÊñπÊ≥ïÔºåÊ†πÊçÆ‰º†ÂÖ•ÁöÑ GoodsDTO ÂØπË±°Âà†Èô§ÂïÜÂìÅ‰ø°ÊÅØ</span><br>    <span class="hljs-meta">@DeleteMapping(&quot;/delete&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> GoodsDTO goodsDto)</span>;<br><br>    <span class="hljs-comment">//Ê†πÊçÆÂïÜÂìÅÂêçÁß∞ËøõË°åÂàÜÈ°µÊü•ËØ¢ÔºöÈÄöËøá searchWithNameByPage ÊñπÊ≥ïÔºåÊ†πÊçÆ‰º†ÂÖ•ÁöÑÂÖ≥ÈîÆËØçÊü•ËØ¢ÂïÜÂìÅ‰ø°ÊÅØÔºåÂπ∂ÂàÜÈ°µËøîÂõûÁªìÊûú</span><br>    <span class="hljs-meta">@GetMapping(&quot;/searchWithNameByPage&quot;)</span><br>    List&lt;GoodsDTO&gt; <span class="hljs-title function_">searchWithNameByPage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;input&quot;)</span> String input)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>GoodsEsService Êé•Âè£ÂÆö‰πâ‰∫Ü‰∏é <code>goodskill-seckill</code> ÂæÆÊúçÂä°ËøõË°åÂïÜÂìÅ‰ø°ÊÅØ‰∫§‰∫íÁöÑÊìç‰Ωú„ÄÇÂåÖÊã¨‰ª•‰∏ãÂäüËÉΩÔºö</p>
<ol>
<li><strong>‰øùÂ≠òÂïÜÂìÅ‰ø°ÊÅØ</strong>ÔºöÈÄöËøá save ÊñπÊ≥ïÔºåÂ∞ÜÂçï‰∏™ÂïÜÂìÅ‰ø°ÊÅØ‰øùÂ≠òÂà∞ goodskill-seckill ÊúçÂä°„ÄÇ</li>
<li><strong>ÊâπÈáè‰øùÂ≠òÂïÜÂìÅ‰ø°ÊÅØ</strong>ÔºöÈÄöËøá saveBatch ÊñπÊ≥ïÔºåÂ∞ÜÂ§ö‰∏™ÂïÜÂìÅ‰ø°ÊÅØÊâπÈáè‰øùÂ≠òÂà∞ goodskill-seckill ÊúçÂä°„ÄÇ</li>
<li><strong>Âà†Èô§ÂïÜÂìÅ‰ø°ÊÅØ</strong>ÔºöÈÄöËøá delete ÊñπÊ≥ïÔºåÊ†πÊçÆ‰º†ÂÖ•ÁöÑ GoodsDTO ÂØπË±°Âà†Èô§ÂïÜÂìÅ‰ø°ÊÅØ„ÄÇ</li>
<li><strong>Ê†πÊçÆÂïÜÂìÅÂêçÁß∞ËøõË°åÂàÜÈ°µÊü•ËØ¢</strong>ÔºöÈÄöËøá searchWithNameByPage ÊñπÊ≥ïÔºåÊ†πÊçÆ‰º†ÂÖ•ÁöÑÂÖ≥ÈîÆËØçÊü•ËØ¢ÂïÜÂìÅ‰ø°ÊÅØÔºåÂπ∂ÂàÜÈ°µËøîÂõûÁªìÊûú„ÄÇ</li>
</ol>
<h4 id="GoodsService"><a href="#GoodsService" class="headerlink" title="GoodsService"></a>GoodsService</h4><p>Áî®‰∫é<strong>Â§ÑÁêÜÂïÜÂìÅÁõ∏ÂÖ≥‰∏öÂä°ÈÄªËæë</strong>ÁöÑÊé•Âè£ÔºåÊèê‰æõ‰∫ÜÂ§ö‰∏™ÊñπÊ≥ïÊù•<strong>ÁÆ°ÁêÜÂïÜÂìÅ‰ø°ÊÅØ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GoodsService</span> &#123;<br><br>    <span class="hljs-comment">//‰∏ä‰º†ÂïÜÂìÅÁÖßÁâá</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">uploadGoodsPhoto</span><span class="hljs-params">(<span class="hljs-type">long</span> goodsId, String fileUrl)</span>;<br><br>    <span class="hljs-comment">//Ê∑ªÂä†‰∏Ä‰∏™Êñ∞ÁöÑÂïÜÂìÅ</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addGoods</span><span class="hljs-params">(GoodsVO goods)</span>;<br><br>    <span class="hljs-comment">//Êü•ËØ¢Â§ö‰∏™ÂïÜÂìÅ</span><br>    List&lt;GoodsVO&gt; <span class="hljs-title function_">findMany</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">//Ê†πÊçÆÂïÜÂìÅIDÊü•ËØ¢ÂïÜÂìÅ</span><br>    GoodsVO <span class="hljs-title function_">findById</span><span class="hljs-params">(Serializable goodsId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>GoodsService Êé•Âè£‰∏ªË¶Å<strong>Ë¥üË¥£ÂïÜÂìÅÁöÑÁÆ°ÁêÜÊìç‰Ωú</strong>ÔºåÂåÖÊã¨Ôºö</p>
<ul>
<li><strong>‰∏ä‰º†ÂïÜÂìÅÁÖßÁâá</strong>ÔºöÈÄöËøá uploadGoodsPhoto ÊñπÊ≥ï‰∏ä‰º†ÂïÜÂìÅÁÖßÁâáÔºåÂπ∂Â∞ÜÁÖßÁâáÂÖ≥ËÅîÂà∞ÂïÜÂìÅ„ÄÇ</li>
<li><strong>Ê∑ªÂä†ÂïÜÂìÅ</strong>ÔºöÈÄöËøá addGoods ÊñπÊ≥ïÂêëÁ≥ªÁªü‰∏≠Ê∑ªÂä†Êñ∞ÁöÑÂïÜÂìÅ‰ø°ÊÅØ„ÄÇ</li>
<li><strong>Êü•ËØ¢ÂïÜÂìÅÂàóË°®</strong>ÔºöÈÄöËøá findMany ÊñπÊ≥ïÊü•ËØ¢Â§ö‰∏™ÂïÜÂìÅ‰ø°ÊÅØÔºåÈÄöÂ∏∏Áî®‰∫éËé∑ÂèñÂïÜÂìÅÁöÑÈõÜÂêà„ÄÇ</li>
<li><strong>Ê†πÊçÆÂïÜÂìÅIDÊü•ËØ¢ÂïÜÂìÅ‰ø°ÊÅØ</strong>ÔºöÈÄöËøá findById ÊñπÊ≥ïÊü•ËØ¢ÊåáÂÆöÂïÜÂìÅÁöÑËØ¶ÁªÜ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h4 id="SeckillService"><a href="#SeckillService" class="headerlink" title="SeckillService"></a>SeckillService</h4><p>Áî®‰∫éÂ§ÑÁêÜÁßíÊùÄÁõ∏ÂÖ≥Êìç‰ΩúÁöÑÊúçÂä°Êé•Âè£ÔºåÊèê<strong>‰æõ‰∫ÜÂ§ö‰∏™‰∏éÁßíÊùÄÊ¥ªÂä®Áõ∏ÂÖ≥ÁöÑÂäüËÉΩ</strong>„ÄÇËØ•Êé•Âè£ÈÄöËøá Feign Client ‰∏éÂêç‰∏∫ <code>goodskill-seckill</code> ÁöÑÂæÆÊúçÂä°ËøõË°åÈÄö‰ø°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÁßíÊùÄÊúçÂä°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@FeignClient(value = &quot;goodskill-seckill&quot;, contextId = &quot;seckill&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SeckillService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ëé∑ÂèñÁßíÊùÄÊ¥ªÂä®ÂàóË°®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageNum   È°µÁ†Å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageSize  ÊØèÈ°µÊï∞Èáè</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> goodsName ÂïÜÂìÅÂêçÁß∞ÔºåÊ®°Á≥äÂåπÈÖç</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/getSeckillList&quot;)</span><br>    PageDTO&lt;SeckillVO&gt; <span class="hljs-title function_">getSeckillList</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;pageNum&quot;)</span> <span class="hljs-type">int</span> pageNum,</span><br><span class="hljs-params">                                      <span class="hljs-meta">@RequestParam(&quot;pageSize&quot;)</span> <span class="hljs-type">int</span> pageSize,</span><br><span class="hljs-params">                                      <span class="hljs-meta">@RequestParam(value = &quot;goodsName&quot;, required = false)</span> String goodsName)</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êö¥Èú≤ÁßíÊùÄÊ¥ªÂä®url</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillId ÁßíÊùÄÊ¥ªÂä®id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Ê¥ªÂä®‰ø°ÊÅØ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/exportSeckillUrl&quot;)</span><br>    ExposerDTO <span class="hljs-title function_">exportSeckillUrl</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> <span class="hljs-type">long</span> seckillId)</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÁßíÊùÄidÂà†Èô§ÊàêÂäüËÆ∞ÂΩï</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillId ÁßíÊùÄÊ¥ªÂä®id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Âà†Èô§Êï∞Èáè</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@DeleteMapping(&quot;/deleteSuccessKillRecord&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteSuccessKillRecord</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> <span class="hljs-type">long</span> seckillId)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊâßË°åÁßíÊùÄÔºåÈÄöËøáÂêåÊ≠•Êù•ÊéßÂà∂Âπ∂Âèë</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> requestDto     ÁßíÊùÄËØ∑Ê±Ç</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> strategyNumber ÁßíÊùÄÁ≠ñÁï•ÁºñÁ†Å</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/execute&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SeckillMockRequestDTO requestDto,</span><br><span class="hljs-params">                 <span class="hljs-meta">@RequestParam(&quot;strategyNumber&quot;)</span> <span class="hljs-type">int</span> strategyNumber)</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ëé∑ÂèñÊàêÂäüÁßíÊùÄËÆ∞ÂΩïÊï∞</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillId ÁßíÊùÄÊ¥ªÂä®id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/getSuccessKillCount&quot;)</span><br>    <span class="hljs-type">long</span> <span class="hljs-title function_">getSuccessKillCount</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> Long seckillId)</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂáÜÂ§áÁßíÊùÄÂïÜÂìÅÊï∞Èáè</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillId    ÁßíÊùÄÂïÜÂìÅid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillCount ÁßíÊùÄÊï∞Èáè</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> taskId ‰ªªÂä°id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/prepareSeckill&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareSeckill</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> Long seckillId,</span><br><span class="hljs-params">                        <span class="hljs-meta">@RequestParam(&quot;seckillCount&quot;)</span> <span class="hljs-type">int</span> seckillCount, <span class="hljs-meta">@RequestParam(&quot;taskId&quot;)</span> String taskId)</span>;<br><br><br>    <span class="hljs-meta">@GetMapping(&quot;/getById&quot;)</span><br>    SeckillVO <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> Serializable seckillId)</span>;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/saveOrUpdate&quot;)</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">saveOrUpdateSeckill</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SeckillVO seckill)</span>;<br><br>    <span class="hljs-meta">@DeleteMapping(&quot;/removeById&quot;)</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeBySeckillId</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> Serializable seckillId)</span>;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/save&quot;)</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SeckillVO seckill)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂáèÂïÜÂìÅÂ∫ìÂ≠ò</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> successKilled</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 1‰ª£Ë°®ÊàêÂäüÔºåÂ∞è‰∫é1‰∏∫Â§±Ë¥•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/reduceNumber&quot;)</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">reduceNumber</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SuccessKilledDTO successKilled)</span>;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/reduceNumberInner&quot;)</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">reduceNumberInner</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SuccessKilledDTO successKilled)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ëé∑Âèñ‰∫åÁª¥Á†Å</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> fileName ‰∫åÁª¥Á†ÅÂõæÁâáÂêçÁß∞</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> SeckillResponseDto</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/getQrcode&quot;)</span><br>    SeckillResponseDTO <span class="hljs-title function_">getQrcode</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;fileName&quot;)</span> String fileName)</span> <span class="hljs-keyword">throws</span> IOException;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÁßíÊùÄidËé∑ÂèñÁßíÊùÄÊ¥ªÂä®‰ø°ÊÅØ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/getInfoById&quot;)</span><br>    SeckillInfoDTO <span class="hljs-title function_">getInfoById</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> Serializable seckillId)</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÁªìÊùüÁßíÊùÄÊìç‰Ωú</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillId ÁßíÊùÄID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> boolean ÁªìÊùüÁßíÊùÄÊòØÂê¶ÊàêÂäü</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">endSeckill</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> Long seckillId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>SeckillService Êé•Âè£ÊòØÁî®‰∫éÁÆ°ÁêÜÁßíÊùÄÊ¥ªÂä®ÁöÑ‰∏Ä‰∏™ÊúçÂä°Êé•Âè£ÔºåÊ∂µÁõñ‰∫ÜÁßíÊùÄÊ¥ªÂä®ÁöÑ‰ª•‰∏ãÂá†‰∏™ÊñπÈù¢Ôºö</p>
<ul>
<li>ÁßíÊùÄÊ¥ªÂä®ÁÆ°ÁêÜÔºöÂåÖÊã¨<strong>Êü•ËØ¢„ÄÅÊ∑ªÂä†„ÄÅÊõ¥Êñ∞„ÄÅÂà†Èô§ÁßíÊùÄÊ¥ªÂä®</strong>„ÄÇ</li>
<li>ÁßíÊùÄÂïÜÂìÅÁÆ°ÁêÜÔºö<strong>ÂáÜÂ§áÁßíÊùÄÂïÜÂìÅÊï∞Èáè„ÄÅÂáèÂ∞ëÂïÜÂìÅÂ∫ìÂ≠ò</strong>Á≠â„ÄÇ</li>
<li>ÁßíÊùÄÊìç‰ΩúÔºö<strong>ÊâßË°åÁßíÊùÄ„ÄÅËé∑ÂèñÊàêÂäüÁßíÊùÄËÆ∞ÂΩï„ÄÅËé∑Âèñ‰∫åÁª¥Á†Å</strong>Á≠â„ÄÇ</li>
<li><strong>ÁßíÊùÄÁªüËÆ°</strong>ÔºöËé∑ÂèñÁßíÊùÄÊ¥ªÂä®ÁöÑÊàêÂäüÁßíÊùÄËÆ∞ÂΩïÊï∞Á≠â„ÄÇ</li>
</ul>
<h2 id="3-2-goodskill-service"><a href="#3-2-goodskill-service" class="headerlink" title="3.2 goodskill-service"></a>3.2 goodskill-service</h2><p><img src="/img/blogs/java/goodskill/3.2.1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-2-1-commonÂåÖ"><a href="#3-2-1-commonÂåÖ" class="headerlink" title="3.2.1 commonÂåÖ"></a>3.2.1 commonÂåÖ</h3><p><img src="/img/blogs/java/goodskill/3.2.2.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><code>CommonConstant</code> Á±ªÔºö ÊòØ‰∏Ä‰∏™Â∏∏ÈáèÁ±ªÔºåÂÆÉÁöÑ‰ΩúÁî®ÊòØÁªü‰∏ÄÁÆ°ÁêÜÈ°πÁõÆ‰∏≠‰ΩøÁî®ÁöÑ ÂÖ¨ÂÖ±Â∏∏ÈáèÔºå‰∏ªË¶ÅÁî®‰∫éÊ∂àÊÅØÈòüÂàóÔºàÂ¶Ç Spring Cloud StreamÔºâ‰∏≠ÁªëÂÆöÈÄöÈÅìÔºàbinding nameÔºâÁöÑÂÆö‰πâ</li>
<li><code>GoodsKillStrategyEnum</code> ÊòØ‰∏Ä‰∏™ Êûö‰∏æÁ±ªÔºåÁî®‰∫éË°®Á§∫<strong>ÁßíÊùÄÁ≥ªÁªü‰∏≠ÂèØÈÄâÁöÑÂ§öÁßçÁ≠ñÁï•ÂÆûÁé∞ÊñπÊ°à</strong>ÔºåÊñπ‰æøÁ≥ªÁªüÂú®ËøêË°åÊó∂Ê†πÊçÆÈÖçÁΩÆÊàñÂèÇÊï∞ÈÄâÊã©‰∏çÂêåÁöÑÁßíÊùÄÂ§ÑÁêÜÁ≠ñÁï•„ÄÇ<strong>ÁßíÊùÄÁ≠ñÁï•Êûö‰∏æÔºåÈÄöËøáÊûö‰∏æÈÅøÂÖçÊö¥Èú≤ÂÖ∑‰ΩìÊñπÊ≥ï</strong></li>
<li><code>ResponseInfo</code> ÊòØ‰∏Ä‰∏™ <strong>ÂìçÂ∫îÁä∂ÊÄÅÊûö‰∏æÁ±ª</strong>ÔºàEnumÔºâÔºåÁî®‰∫é<strong>Áªü‰∏ÄÂÆö‰πâÂêéÁ´ØÊé•Âè£ÁöÑÂìçÂ∫îÁä∂ÊÄÅÁ†ÅÂíåÂØπÂ∫îÁöÑ‰ø°ÊÅØ</strong>Ôºå‰æãÂ¶ÇÊàêÂäü„ÄÅÂ§±Ë¥•„ÄÅË∂ÖÊó∂„ÄÅÊúçÂä°Âô®ÂÜÖÈÉ®ÈîôËØØÁ≠â</li>
<li><code>SuccessKilledService</code>‰∏∫<code>SuccessKilled</code> ÂÆû‰ΩìÊèê‰æõ <strong>Âü∫Á°ÄÁöÑÂ¢ûÂà†ÊîπÊü•ÔºàCRUDÔºâÊúçÂä°</strong>ÔºåÈÄöËøáÁªßÊâø <code>IService&lt;T&gt;</code> Êù•ÂÆûÁé∞„ÄÇ</li>
</ul>
<h4 id="RedisService"><a href="#RedisService" class="headerlink" title="RedisService"></a>RedisService</h4><p>RedisService Á±ªÊòØ‰∏Ä‰∏™Áî®‰∫é<strong>Êìç‰ΩúÁßíÊùÄÁõ∏ÂÖ≥ Redis ÁºìÂ≠òÁöÑÂ∑•ÂÖ∑Á±ª</strong>ÔºåÂÆÉÂ∞ÅË£Ö‰∫ÜÂØπ Redis ÁöÑËØªÂÜôÈÄªËæëÔºå‰∏ªË¶ÅÁõÆÁöÑÊòØÊèêÂçáÊü•ËØ¢ÊïàÁéá„ÄÅÂáèËΩªÊï∞ÊçÆÂ∫ìÂéãÂäõ„ÄÅÊ†áËØÜÁßíÊùÄÁä∂ÊÄÅÁ≠â</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SeckillMapper seckillMapper;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br>    <br>    <span class="hljs-comment">//Êü•ËØ¢ÁßíÊùÄÊ¥ªÂä®ÁºìÂ≠òÔºàÂ¶ÇÊûúÊ≤°ÊúâÂàôÊü•Êï∞ÊçÆÂ∫ìÂπ∂ÂõûÂ°´Âà∞ RedisÔºâ</span><br>    <span class="hljs-keyword">public</span> Seckill <span class="hljs-title function_">getSeckill</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;seckill:&quot;</span> + seckillId;<br>        <span class="hljs-type">Seckill</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> (Seckill) redisTemplate.opsForValue().get(key);<br>        <span class="hljs-keyword">if</span> (seckill != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> seckill;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            seckill = seckillMapper.selectById(seckillId);<br>            <span class="hljs-keyword">if</span> (seckill == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;ÁßíÊùÄÊ¥ªÂä®‰∏çÂ≠òÂú®ÔºÅ&quot;</span>);<br>            &#125;<br>            putSeckill(seckill);<br>            <span class="hljs-keyword">return</span> seckill;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//Â∞Ü Seckill ÂØπË±°Â≠òÂÖ• Redis,ËøáÊúüÊó∂Èó¥ÊòØ60Áßí</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putSeckill</span><span class="hljs-params">(Seckill seckill)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;seckill:&quot;</span> + seckill.getSeckillId();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br>        redisTemplate.opsForValue().set(key, seckill, timeout, TimeUnit.SECONDS);<br>    &#125;<br><br>    <span class="hljs-comment">//Âà†Èô§ Redis ‰∏≠ÁöÑÁßíÊùÄÁºìÂ≠ò</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeSeckill</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;seckill:&quot;</span> + seckillId;<br>        redisTemplate.delete(key);<br>        redisTemplate.delete(String.valueOf(seckillId));<br>    &#125;<br><br>    <span class="hljs-comment">//ËÆæÁΩÆ‰∏Ä‰∏™ÁßíÊùÄÊ¥ªÂä®ÁªìÊùüÁöÑÊ†áËØÜ‰ΩçÔºåËøîÂõûÂÄºË°®Á§∫ÊòØÂê¶ÊàêÂäüËÆæÁΩÆÔºàÁ¨¨‰∏ÄÊ¨°ËÆæÁΩÆÊàêÂäüËøîÂõû trueÔºå‰πãÂêéËøîÂõû falseÔºâ</span><br>    <span class="hljs-comment">//‰ΩøÁî®Âú∫ÊôØÔºöÈò≤Ê≠¢Â§öÁ∫øÁ®ã/Â§öËäÇÁÇπÈáçÂ§çËß¶Âèë‚ÄúÁßíÊùÄÁªìÊùü‚ÄùÈÄªËæë</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">setSeckillEndFlag</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId, String taskId)</span> &#123;<br>        <span class="hljs-keyword">return</span> stringRedisTemplate.opsForValue().setIfAbsent(<span class="hljs-string">&quot;goodskill:seckill:end:notice&quot;</span> + seckillId + <span class="hljs-string">&quot;:&quot;</span> + taskId, <span class="hljs-string">&quot;1&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">//Âà†Èô§ÂØπÂ∫îÁöÑ‚ÄúÁßíÊùÄÂ∑≤ÁªìÊùü‚ÄùÊ†áÂøó‰Ωç</span><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">clearSeckillEndFlag</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId, String taskId)</span> &#123;<br>        <span class="hljs-keyword">return</span> stringRedisTemplate.delete(<span class="hljs-string">&quot;goodskill:seckill:end:notice&quot;</span> + seckillId + <span class="hljs-string">&quot;:&quot;</span> + taskId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>‰∏ªË¶ÅËÅåË¥£</p>
<ul>
<li>Êü•ËØ¢ÁßíÊùÄÊ¥ªÂä®ÁºìÂ≠òÔºàÂ¶ÇÊûúÊ≤°ÊúâÂàôÊü•Êï∞ÊçÆÂ∫ìÂπ∂ÂõûÂ°´Âà∞ RedisÔºâÔºõ</li>
<li>ÂÜôÂÖ•&#x2F;Âà†Èô§ Redis ÁºìÂ≠ò‰∏≠ÁöÑÁßíÊùÄÊ¥ªÂä®Êï∞ÊçÆÔºõ</li>
<li>ÁÆ°ÁêÜÁßíÊùÄÊòØÂê¶ÁªìÊùüÁöÑÊ†áËØÜ‰ΩçÔºàÂ∏ÉÂ∞îÂÄºÊ†áËØÜÔºâÔºõ</li>
<li>Â∞ÅË£Ö Redis ËÆøÈóÆÈÄªËæëÔºåÈÅøÂÖç‰∏öÂä°‰ª£Á†Å‰∏≠ÈáçÂ§çÊìç‰Ωú Redis„ÄÇ</li>
</ul>
<p><strong>ÊäÄÊúØÁÇπÊÄªÁªì</strong></p>
<ul>
<li>‰ΩøÁî®‰∫Ü Redis ÁöÑ<strong>ËøáÊúüÊú∫Âà∂</strong>Âíå setIfAbsent Êú∫Âà∂Ôºå<strong>Á°Æ‰øùÈ´òÂπ∂Âèë‰∏ãÁöÑÊìç‰Ωú‰∏ÄËá¥ÊÄß</strong>„ÄÇ</li>
<li><strong>ÁºìÂ≠òÁ©øÈÄèÊéßÂà∂</strong>ÔºöÁºìÂ≠òÊú™ÂëΩ‰∏≠Êó∂Ëá™Âä®Âä†ËΩΩÊï∞ÊçÆÂ∫ìÂπ∂ÂõûÂ°´ÔºåÈò≤Ê≠¢Â§ßÈáèËØ∑Ê±ÇÁõ¥ÂáªÊï∞ÊçÆÂ∫ì„ÄÇ</li>
</ul>
<h3 id="3-2-2-configÂåÖ"><a href="#3-2-2-configÂåÖ" class="headerlink" title="3.2.2 configÂåÖ"></a>3.2.2 configÂåÖ</h3><p><img src="/img/blogs/java/goodskill/3.2.3.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="StateMachineConfig"><a href="#StateMachineConfig" class="headerlink" title="StateMachineConfig"></a>StateMachineConfig</h4><p>Áî®‰∫é<strong>ÊéßÂà∂‚ÄúÁßíÊùÄÊ¥ªÂä®Áä∂ÊÄÅÊú∫‚ÄùÈÄªËæëÁöÑÊ†∏ÂøÉÈÖçÁΩÆÁ±ª</strong>ÔºåÂÆÉÂü∫‰∫é Spring State Machine Áä∂ÊÄÅÊú∫Ê°ÜÊû∂ÔºåÈÄöËøá<strong>ÈÖçÁΩÆÁä∂ÊÄÅ„ÄÅ‰∫ã‰ª∂„ÄÅÁä∂ÊÄÅËΩ¨Êç¢ËßÑÂàô„ÄÅÁõëÂê¨Âô®„ÄÅÊåÅ‰πÖÂåñÊú∫Âà∂</strong>Êù•È©±Âä®‰∏Ä‰∏™ÊµÅÁ®ãÔºàÊØîÂ¶ÇÔºöÁßíÊùÄÊ¥ªÂä®ÁöÑÁîüÂëΩÂë®ÊúüÔºâÊåâÁÖßÈ¢ÑÊúüÁöÑÊ≠•È™§ËøêË°å„ÄÇ</p>
<p>ÁõÆÂâçÁßíÊùÄÊ¥ªÂä®Áä∂ÊÄÅÁöÑÊéßÂà∂Âü∫‰∫éSpring StatemachineÁä∂ÊÄÅÊú∫ÂÆûÁé∞Ôºå‰ΩøÁî®Áä∂ÊÄÅÊú∫ÁöÑ‰ºòÁÇπÔºö</p>
<ul>
<li>Áªü‰∏ÄÊéßÂà∂Ê¥ªÂä®Áä∂ÊÄÅÔºå‰æø‰∫éÁä∂ÊÄÅÁöÑÈõÜ‰∏≠Áª¥Êä§Ôºõ</li>
<li>Èò≤Ê≠¢‰∏öÂä°Áä∂ÊÄÅË¢´ÈöèÊÑèÊõ¥ÊîπÔºå‰øùËØÅÁä∂ÊÄÅÁöÑÂèØÊéßÊõ¥Êñ∞Ôºõ</li>
</ul>
<p><img src="/img/blogs/java/goodskill/3.2.4.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>StateMachineConfig ÈÖçÁΩÆ‰∫Ü <strong>ÁßíÊùÄÊ¥ªÂä®ÁöÑÂÆåÊï¥ÁîüÂëΩÂë®ÊúüÁä∂ÊÄÅÊú∫</strong>ÔºåÂåÖÊã¨Áä∂ÊÄÅ„ÄÅ‰∫ã‰ª∂„ÄÅÁä∂ÊÄÅËΩ¨Êç¢ÈÄªËæë„ÄÅÁõëÂê¨Âô®Âíå Redis ÊåÅ‰πÖÂåñÊîØÊåÅÔºåÊòØÊ¥ªÂä®ÊµÅÁ®ãÊéßÂà∂ÁöÑÊ†∏ÂøÉÈÖçÁΩÆ„ÄÇ</li>
</ul>
<h4 id="ThreadPoolConfig"><a href="#ThreadPoolConfig" class="headerlink" title="ThreadPoolConfig"></a>ThreadPoolConfig</h4><p><strong>Á∫øÁ®ãÊ±†ÈÖçÁΩÆÁ±ª</strong>ÔºåÁî®‰∫éÂú® Spring ÂÆπÂô®‰∏≠Ê≥®ÂÜå‰∏Ä‰∏™ ThreadPoolExecutor Á±ªÂûãÁöÑ BeanÔºå‰æõÈ°πÁõÆ‰∏≠ÁöÑÂºÇÊ≠•‰ªªÂä°ÊàñÂπ∂ÂèëÊìç‰ΩúÂ§çÁî®„ÄÇ<br>Êèê‰æõ‰∏Ä‰∏™ÂèØÂ§çÁî®ÁöÑÁ∫øÁ®ãÊ±† taskExecutorÔºåÁî®Êù•Áªü‰∏ÄÁÆ°ÁêÜÈ°πÁõÆ‰∏≠ÁöÑÂπ∂Âèë‰ªªÂä°ÔºåÊØîÂ¶ÇÊâßË°åÁßíÊùÄÂºÇÊ≠•ÈÄªËæë„ÄÅÂèëÈÄÅMQ„ÄÅÂ§ÑÁêÜÂõûË∞É„ÄÅËÆ∞ÂΩïÊó•ÂøóÁ≠â„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Á∫øÁ®ãÊ±†ÈÖçÁΩÆ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ThreadPoolExecutor <span class="hljs-title function_">taskExecutor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, TimeUnit.MINUTES,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="hljs-number">100</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th>ÂèÇÊï∞</th>
<th>Âê´‰πâ</th>
</tr>
</thead>
<tbody><tr>
<td><code>corePoolSize = 2</code></td>
<td>Ê†∏ÂøÉÁ∫øÁ®ãÊï∞ÔºöÂç≥‰ΩøÁ©∫Èó≤‰πü‰ºö‰øùÁïô 2 ‰∏™Á∫øÁ®ã</td>
</tr>
<tr>
<td><code>maximumPoolSize = 10</code></td>
<td>ÊúÄÂ§ßÁ∫øÁ®ãÊï∞‰∏äÈôê‰∏∫ 10ÔºåË∂ÖËøáÂ∞±ËøõÂÖ•ÈòüÂàóÊàñÊãíÁªù</td>
</tr>
<tr>
<td><code>keepAliveTime = 1 ÂàÜÈíü</code></td>
<td>ÈùûÊ†∏ÂøÉÁ∫øÁ®ãÈó≤ÁΩÆ 1 ÂàÜÈíüÂêé‰ºöË¢´ÈîÄÊØÅ</td>
</tr>
<tr>
<td><code>LinkedBlockingDeque&lt;&gt;(100)</code></td>
<td>ÈòüÂàóÊúÄÂ§ßÁºìÂ≠ò‰ªªÂä°Êï∞ÊòØ 100</td>
</tr>
<tr>
<td><code>CallerRunsPolicy</code></td>
<td>ÊãíÁªùÁ≠ñÁï•ÔºöÂΩìÁ∫øÁ®ãÂíåÈòüÂàóÈÉΩÊª°‰∫ÜÔºå‰ªªÂä°Áî±Êèê‰∫§‰ªªÂä°ÁöÑÁ∫øÁ®ãËá™Â∑±ÊâßË°åÔºà‰∏ç‰ºö‰∏¢‰ªªÂä°Ôºâ</td>
</tr>
</tbody></table>
<h3 id="3-2-3-ControllerÂ±Ç"><a href="#3-2-3-ControllerÂ±Ç" class="headerlink" title="3.2.3 ControllerÂ±Ç"></a>3.2.3 ControllerÂ±Ç</h3><p><img src="/img/blogs/java/goodskill/3.2.5.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="SeckillGraphqlController"><a href="#SeckillGraphqlController" class="headerlink" title="SeckillGraphqlController"></a>SeckillGraphqlController</h4><p>Âü∫‰∫é GraphQL ÁöÑÊéßÂà∂Âô®Ôºö<strong>‰∏∫ÂâçÁ´Ø GraphQL Êü•ËØ¢Êèê‰æõÊï∞ÊçÆËß£ÊûêËÉΩÂäõ</strong>ÔºåÈÄöËøáÊ≥®Ëß£È©±Âä®ÁöÑÊñπÂºèÔºåÂ∞Ü‰∏çÂêåÁöÑ GraphQL Êü•ËØ¢ÊàñÂ≠óÊÆµËß£ÊûêÔºåÊò†Â∞ÑÂà∞ÂêéÁ´ØÁöÑÊúçÂä°Êé•Âè£‰∏äÔºåÊñπ‰æøÂú∞Êü•ËØ¢ÁßíÊùÄÊ¥ªÂä®ÂèäÂÖ∂ÂÖ≥ËÅî‰ø°ÊÅØÔºàÂ¶ÇÂïÜÂìÅ‰ø°ÊÅØ„ÄÅÊàêÂäüÁßíÊùÄËÆ∞ÂΩïÁ≠âÔºâ„ÄÇ<br>SeckillGraphqlController ÊòØ‰∏Ä‰∏™ <strong>GraphQL ÊéßÂà∂Âô®Á±ª</strong>ÔºåÁî®‰∫éÂ§ÑÁêÜÂâçÁ´Ø GraphQL Êü•ËØ¢ËØ∑Ê±ÇÔºåË¥üË¥£‰ªéÂêéÁ´ØÊúçÂä°‰∏≠<strong>Êü•ËØ¢ÁßíÊùÄÊ¥ªÂä®„ÄÅÂÖ≥ËÅîÂïÜÂìÅ‰ø°ÊÅØ„ÄÅÊàêÂäüÁßíÊùÄËÆ∞ÂΩï</strong>Á≠âÔºåÂπ∂Â∞ÜÂÆÉ‰ª¨ÁªëÂÆöÂà∞ÂØπÂ∫î GraphQL ÁöÑÂ≠óÊÆµÂíåÊü•ËØ¢ÁªìÊûÑ‰∏≠„ÄÇ</p>
<h4 id="GoodsController"><a href="#GoodsController" class="headerlink" title="GoodsController"></a>GoodsController</h4><p>GoodsController Á±ªÊòØ‰∏Ä‰∏™Âü∫‰∫é Spring Boot ÁöÑ RESTful ÊéßÂà∂Âô®Á±ªÔºå‰∏ªË¶ÅÁî®‰∫é<strong>ÂïÜÂìÅÁÆ°ÁêÜÊ®°Âùó‰∏≠ÁöÑËÆ¢ÂçïÁªüËÆ°ÂäüËÉΩ</strong>ÔºåÈÄöËøá HTTP Êé•Âè£ÂØπÂ§ñÊèê‰æõÊúçÂä°„ÄÇ</p>
<p><strong>Êèê‰æõ‰∏Ä‰∏™Áî®‰∫éÊü•ËØ¢Êüê‰∏™ÁßíÊùÄÊ¥ªÂä®‰∏ãËÆ¢ÂçïÊï∞ÈáèÁöÑÊé•Âè£</strong>Ôºå‰æø‰∫éÁªüËÆ°ÂèÇ‰∏éÊüêÂïÜÂìÅÁßíÊùÄÁöÑÁî®Êà∑Êï∞ÈáèÊàñ‰∏ãÂçïÊï∞Èáè„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Tag(name = &quot;ÂïÜÂìÅÁÆ°ÁêÜ&quot;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/seckill/goods&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsController</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br>    <span class="hljs-comment">//Êü•ËØ¢ËÆ¢ÂçïÊï∞Èáè</span><br>    <span class="hljs-meta">@GetMapping(&quot;/orders/count&quot;)</span><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">countOrders</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> <span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-keyword">return</span> orderService.count(seckillId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="SeckillController"><a href="#SeckillController" class="headerlink" title="SeckillController"></a>SeckillController</h4><p><strong>ÁßíÊùÄÁÆ°ÁêÜÊéßÂà∂Âô®Á±ª</strong>: Áî®‰∫éÂ§ÑÁêÜ‰∏é <strong>ÂïÜÂìÅÁßíÊùÄÊ¥ªÂä®Áõ∏ÂÖ≥ÁöÑÈ°µÈù¢Ë∑≥ËΩ¨„ÄÅÊï∞ÊçÆÊé•Âè£Âíå‰∏öÂä°Êìç‰Ωú</strong>„ÄÇÂÆÉÁªìÂêà‰∫Ü‰º†Áªü MVC ÁöÑÈ°µÈù¢Ë∑≥ËΩ¨Âíå REST Êé•Âè£ÔºåÊîØÊåÅÈ°µÈù¢Ê∏≤Êüì„ÄÅÊï∞ÊçÆÂàÜÈ°µ„ÄÅÂàõÂª∫&#x2F;ÁºñËæë&#x2F;Âà†Èô§ÁßíÊùÄÊ¥ªÂä®„ÄÅ‰∫åÁª¥Á†ÅÊîØ‰ªò„ÄÅ‰∏ä‰º†ÂõæÁâá„ÄÅÂïÜÂìÅÊêúÁ¥¢Á≠âÂäüËÉΩ„ÄÇ</p>
<p><strong>SeckillController ÊñπÊ≥ïÂäüËÉΩË°®</strong>:</p>
<table>
<thead>
<tr>
<th>ËØ∑Ê±ÇÊñπÂºè</th>
<th>ËØ∑Ê±ÇË∑ØÂæÑ</th>
<th>ÊñπÊ≥ïÂêç</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody><tr>
<td><code>GET</code></td>
<td><code>/seckill/list</code></td>
<td><code>list</code></td>
<td><strong>ÂàÜÈ°µÂ±ïÁ§∫ÁßíÊùÄÊ¥ªÂä®ÂàóË°®</strong>ÔºåÊîØÊåÅÂïÜÂìÅÂêçÁß∞ÊêúÁ¥¢</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/seckill/{seckillId}/detail</code></td>
<td><code>detail</code></td>
<td><strong>Êü•ÁúãÊåáÂÆöÁßíÊùÄÊ¥ªÂä®ÁöÑËØ¶ÊÉÖ</strong></td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/seckill/{seckillId}/exposer</code></td>
<td><code>exposer</code></td>
<td><strong>Ëé∑ÂèñÁßíÊùÄÂú∞ÂùÄ</strong>ÔºàÊé•Âè£Êö¥Èú≤Ôºâ</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/seckill/create</code></td>
<td><code>addSeckill</code></td>
<td><strong>Ê∑ªÂä†</strong>‰∏Ä‰∏™Êñ∞ÁöÑÁßíÊùÄÊ¥ªÂä®</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/seckill/new</code></td>
<td><code>toAddSeckillPage</code></td>
<td><strong>Ë∑≥ËΩ¨Âà∞Êñ∞Âª∫ÁßíÊùÄÊ¥ªÂä®ÁöÑÈ°µÈù¢</strong></td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/seckill/{seckillId}/delete</code></td>
<td><code>delete</code></td>
<td><strong>Âà†Èô§</strong>Êüê‰∏™ÁßíÊùÄÊ¥ªÂä®</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/seckill/{seckillId}/edit</code></td>
<td><code>edit</code></td>
<td>Ë∑≥ËΩ¨Âà∞ÁºñËæëÈ°µÈù¢ÔºåÂä†ËΩΩÂΩìÂâçÊ¥ªÂä®‰ø°ÊÅØ</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/seckill/{seckillId}/update</code></td>
<td><code>update</code></td>
<td><strong>Êõ¥Êñ∞</strong>ÁßíÊùÄÊ¥ªÂä®‰ø°ÊÅØ</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/seckill/pay/Qrcode/{QRfilePath}</code></td>
<td><code>payTransaction</code></td>
<td>Ë∑≥ËΩ¨Âà∞ÊîØ‰ªòÂÆù‰∫åÁª¥Á†ÅÊîØ‰ªòÈ°µÈù¢</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/seckill/upload/{seckillId}/create</code></td>
<td><code>uploadPhoto</code></td>
<td><strong>‰∏ä‰º†ÁßíÊùÄÂïÜÂìÅÂõæÁâá</strong>ÔºåÊõ¥Êñ∞ÂïÜÂìÅÂõæÂú∞ÂùÄ</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/seckill/goods/search/{goodsName}</code></td>
<td><code>searchGoods</code></td>
<td>ÈÄöËøá<strong>ÂïÜÂìÅÂêçÊ®°Á≥äÊêúÁ¥¢</strong>ÔºàÂü∫‰∫éESÔºâÔºåËøîÂõûÈ´ò‰∫ÆÊêúÁ¥¢ÁªìÊûú</td>
</tr>
</tbody></table>
<h3 id="3-2-4-entityÂåÖ"><a href="#3-2-4-entityÂåÖ" class="headerlink" title="3.2.4 entityÂåÖ"></a>3.2.4 entityÂåÖ</h3><p><img src="/img/blogs/java/goodskill/3.2.6.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><code>Goods</code> Á±ªÊòØ‰∏Ä‰∏™ÂÆû‰ΩìÁ±ªÔºåË°®Á§∫Á≥ªÁªü‰∏≠ÁöÑ<strong>ÂïÜÂìÅÂØπË±°</strong>ÔºåÂú®ÁßíÊùÄÁ≥ªÁªü‰∏≠Áî®‰∫éÂ≠òÂÇ®ÂíåÁÆ°ÁêÜ<strong>ÂïÜÂìÅÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØ</strong></li>
<li><code>Seckill</code> Á±ªÊòØ‰∏Ä‰∏™ÂÆû‰ΩìÁ±ªÔºåË°®Á§∫Á≥ªÁªü‰∏≠ÁöÑ<strong>ÁßíÊùÄÂ∫ìÂ≠òÊ¥ªÂä®ÂØπË±°</strong>Ôºå‰∏ªË¶ÅÁî®‰∫éÊèèËø∞<strong>‰∏Ä‰∏™ÁâπÂÆöÂïÜÂìÅÁöÑÁßíÊùÄÊ¥ªÂä®ÁöÑÂü∫Êú¨‰ø°ÊÅØ</strong>ÔºåÂåÖÊã¨Êó∂Èó¥„ÄÅ<strong>Â∫ìÂ≠ò</strong>„ÄÅ‰ª∑Ê†ºÁ≠âÂÜÖÂÆπ</li>
<li><code>SuccessKilled</code> Á±ªÊòØ‰∏Ä‰∏™ÂÆû‰ΩìÁ±ªÔºåË°®Á§∫<strong>ÁßíÊùÄÊàêÂäüËÆ∞ÂΩïÁöÑÂØπË±°</strong>ÔºåÁî®‰∫éÂ≠òÂÇ®Áî®Êà∑ÂèÇ‰∏éÁßíÊùÄÊ¥ªÂä®Âπ∂ÊàêÂäüË¥≠‰π∞ÂïÜÂìÅÁöÑËÆ∞ÂΩï</li>
</ul>
<h3 id="3-2-5-esÂåÖ-Elasticsearch"><a href="#3-2-5-esÂåÖ-Elasticsearch" class="headerlink" title="3.2.5 esÂåÖ(Elasticsearch)"></a>3.2.5 esÂåÖ(Elasticsearch)</h3><p><img src="/img/blogs/java/goodskill/3.2.7.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><code>Goods</code> Á±ªÊòØ‰∏Ä‰∏™ <strong>Elasticsearch ÂÆû‰ΩìÁ±ª</strong>ÔºåÁî®‰∫é<strong>Ë°®Á§∫ÂïÜÂìÅ‰ø°ÊÅØ</strong>ÔºåÂπ∂‰∏îËØ•Á±ªÈÄöËøá @Document Ê≥®Ëß£‰∏é Elasticsearch ‰∏≠ÁöÑ goods Á¥¢ÂºïËøõË°åÊò†Â∞Ñ„ÄÇ</li>
</ul>
<p><code>GoodsRepository</code> Êé•Âè£ÊòØ‰∏Ä‰∏™Áî®‰∫éÊìç‰Ωú Elasticsearch Êï∞ÊçÆÂ∫ìÁöÑ Spring Data Elasticsearch ‰ªìÂ∫ìÊé•Âè£„ÄÇÂÆÉ<strong>ÁªßÊâøËá™ ElasticsearchRepository</strong>ÔºåËøôÊòØ Spring Data Elasticsearch Êèê‰æõÁöÑ‰∏Ä‰∏™Âü∫Á°ÄÊé•Âè£Ôºå<strong>Êèê‰æõ‰∫ÜÂ∏∏Áî®ÁöÑ CRUDÔºàÂàõÂª∫„ÄÅËØªÂèñ„ÄÅÊõ¥Êñ∞„ÄÅÂà†Èô§ÔºâÊìç‰Ωú</strong>„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GoodsRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;Goods, String&gt; &#123;<br><br>   <span class="hljs-comment">//Ê†πÊçÆ ID Âà†Èô§ Goods ÂÆû‰Ωì</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteByGoodsId</span><span class="hljs-params">(Integer goodsId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="3-2-6-handlerÂåÖ"><a href="#3-2-6-handlerÂåÖ" class="headerlink" title="3.2.6 handlerÂåÖ"></a>3.2.6 handlerÂåÖ</h3><p><img src="/img/blogs/java/goodskill/3.2.8.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="AbstractPreRequestHandler-ÊäΩË±°Á±ª"><a href="#AbstractPreRequestHandler-ÊäΩË±°Á±ª" class="headerlink" title="AbstractPreRequestHandler ÊäΩË±°Á±ª"></a>AbstractPreRequestHandler ÊäΩË±°Á±ª</h4><p>ÊäΩË±°Âü∫Á±ªÔºåÊèê‰æõÈ¢ÑÂ§ÑÁêÜÂô®Áªü‰∏ÄÊé•Âè£ÂíåÊâßË°åÈ°∫Â∫èÊéßÂà∂<br>Áî®‰∫éËØ∑Ê±ÇÂâçÁöÑÁªü‰∏ÄÂ§ÑÁêÜÊµÅÁ®ãÔºàÂ¶ÇÊ†°È™å„ÄÅÈôêÊµÅ„ÄÅÊó•Âøó„ÄÅÈâ¥ÊùÉÁ≠âÔºâ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractPreRequestHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PreRequestHandler</span>, Ordered &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SeckillWebMockRequestDTO request)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="DatabasePreRequestHandler"><a href="#DatabasePreRequestHandler" class="headerlink" title="DatabasePreRequestHandler"></a>DatabasePreRequestHandler</h4><p>DatabasePreRequestHandler ÊòØ‰∏Ä‰∏™Áî®‰∫é <strong>Êï∞ÊçÆÂ∫ìÂàùÂßãÂåñ&#x2F;ÈáçÁΩÆÁöÑËØ∑Ê±ÇÈ¢ÑÂ§ÑÁêÜÂô®</strong>ÔºåÂú®Êüê‰∫õ‰∏öÂä°Âú∫ÊôØ‰∏≠ÔºàÂ¶ÇÊ®°ÊãüÁßíÊùÄÁéØÂ¢ÉÊàñÂàùÂßãÂåñÊµãËØïÊï∞ÊçÆÔºâÔºåËØ•Â§ÑÁêÜÂô®‰ºöÔºö</p>
<ul>
<li><strong>ÈáçÁΩÆÊåáÂÆöÁßíÊùÄÊ¥ªÂä®ÁöÑÂ∫ìÂ≠òÊï∞Èáè</strong></li>
<li><strong>Ê∏ÖÁ©∫ËØ•ÁßíÊùÄÊ¥ªÂä®‰∏ãÁöÑÂ∑≤ÊàêÂäüÁßíÊùÄËÆ∞ÂΩï</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabasePreRequestHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractPreRequestHandler</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> SeckillMapper seckillMapper;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> SuccessKilledMapper successKilledMapper;<br>    <span class="hljs-comment">// Êõ¥Êñ∞Â∫ìÂ≠ò	Â∞Ü‰º†ÂÖ•ÁöÑÁßíÊùÄÂïÜÂìÅ ID ÁöÑÂ∫ìÂ≠òÊï∞ÈáèËÆæÁΩÆ‰∏∫ÊåáÂÆöÊï∞Èáè</span><br>    <span class="hljs-comment">// Âà†Èô§ËÆ∞ÂΩï	Ê∏ÖÈô§ËØ•ÂïÜÂìÅ ID ÊâÄÊúâÁöÑÊàêÂäüÁßíÊùÄËÆ∞ÂΩïÔºà‰æãÂ¶ÇÁî®‰∫éÊµãËØïÊàñÈáçÁΩÆÔºâ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SeckillWebMockRequestDTO request)</span> &#123;<br>        <span class="hljs-type">Seckill</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Seckill</span>();<br>        entity.setSeckillId(request.getSeckillId());<br>        entity.setNumber(request.getSeckillCount());<br>        seckillMapper.updateById(entity);<br><br>        <span class="hljs-comment">// Ê∏ÖÁêÜÂ∑≤ÊàêÂäüÁßíÊùÄËÆ∞ÂΩï</span><br>        <span class="hljs-type">SuccessKilled</span> <span class="hljs-variable">example</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuccessKilled</span>();<br>        example.setSeckillId(request.getSeckillId());<br>        successKilledMapper.delete(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;(example));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="MongoPreRequestHandler"><a href="#MongoPreRequestHandler" class="headerlink" title="MongoPreRequestHandler"></a>MongoPreRequestHandler</h4><p>MongoPreRequestHandler Á±ªÁöÑ‰ΩúÁî®ÊòØÔºö<strong>Âú®ÊâßË°åÁßíÊùÄÂéãÊµãÊàñÊµãËØï‰πãÂâçÔºåÊ∏ÖÁ©∫ MongoDB ‰∏≠ËØ•ÁßíÊùÄÊ¥ªÂä®ÁöÑÁõ∏ÂÖ≥ËÆ¢ÂçïËÆ∞ÂΩï</strong>Ôºå‰ª•‰øùËØÅÊµãËØïÊï∞ÊçÆÂπ≤ÂáÄ„ÄÅ‰∏ç‰ºöÂèóÂà∞ÂéÜÂè≤Êï∞ÊçÆÂΩ±Âìç„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MongoPreRequestHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractPreRequestHandler</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br>    <span class="hljs-comment">//‰ªé MongoDB ‰∏≠Âà†Èô§ËØ•Ê¥ªÂä®ÁöÑÊâÄÊúâËÆ¢ÂçïÊï∞ÊçÆ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SeckillWebMockRequestDTO request)</span> &#123;<br>        orderService.deleteRecord(request.getSeckillId());<br>    &#125;<br><br>    <span class="hljs-comment">//Ë¥£‰ªªÈìæ‰∏≠ÊâßË°åÈ°∫Â∫èÊéíÂú®ÂêéÈù¢ÔºàÂÄºË∂äÂ§ßË∂äÂêéÊâßË°åÔºâ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="PreRequestHandler-Êé•Âè£"><a href="#PreRequestHandler-Êé•Âè£" class="headerlink" title="PreRequestHandler Êé•Âè£"></a>PreRequestHandler Êé•Âè£</h4><p>ÂÆö‰πâ‰∏Ä‰∏™Áªü‰∏ÄÁöÑ‚ÄúÁßíÊùÄËØ∑Ê±ÇÈ¢ÑÂ§ÑÁêÜ‚ÄùÊìç‰ΩúËßÑËåÉ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ËØ∑Ê±ÇÂ§ÑÁêÜÁ±ª</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PreRequestHandler</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SeckillWebMockRequestDTO request)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="PreRequestPipeline"><a href="#PreRequestPipeline" class="headerlink" title="PreRequestPipeline"></a>PreRequestPipeline</h4><p>Áªü‰∏ÄË∞ÉÂ∫¶ÂíåÊâßË°åÊâÄÊúâÈ¢ÑÂ§ÑÁêÜÂô®ÔºàPreRequestHandlerÔºâÁöÑÈÄªËæëÔºåÊåâÁÖß‰ºòÂÖàÁ∫ßÈ°∫Â∫è‰æùÊ¨°ÊâßË°åÊØè‰∏™È¢ÑÂ§ÑÁêÜÊ≠•È™§„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Setter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PreRequestPipeline</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> List&lt;AbstractPreRequestHandler&gt; prePreRequestHandlers;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SeckillWebMockRequestDTO request)</span> &#123;<br>        prePreRequestHandlers.stream().sorted(Comparator.comparing(Ordered::getOrder))<br>                .forEach(it -&gt; &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        it.handle(request);<br>                    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                        log.warn(<span class="hljs-string">&quot;pre request handler error&quot;</span>, e);<br>                    &#125;<br>                &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ÂÖ•ÂèÇÊòØÁßíÊùÄËØ∑Ê±ÇÁöÑÊï∞ÊçÆÂØπË±° SeckillWebMockRequestDTOÔºåÂåÖÂê´ËØ∏Â¶ÇÁßíÊùÄ ID„ÄÅÁßíÊùÄÂ∫ìÂ≠òÁ≠â‰ø°ÊÅØ„ÄÇ</li>
<li>‰ºöÈÅçÂéÜÊâÄÊúâÊ≥®ÂÜåÁöÑ AbstractPreRequestHandler ÂÆûÁé∞Á±ªÔºåÊåâÁÖß getOrder() ÊåáÂÆöÁöÑÈ°∫Â∫è‰æùÊ¨°Ë∞ÉÁî® handle(request) ÊñπÊ≥ï„ÄÇ</li>
<li><strong>Â¶ÇÊûúÊüê‰∏™Â§ÑÁêÜÂô®Âá∫ÈîôÔºåÊçïËé∑ÂºÇÂ∏∏Âπ∂ËÆ∞ÂΩïÊó•ÂøóÔºåÁªßÁª≠ÊâßË°åÂêéÈù¢ÁöÑÂ§ÑÁêÜÂô®Ôºå‰∏ç‰∏≠Êñ≠Êï¥‰∏™ÊµÅÁ®ã</strong>„ÄÇ</li>
</ul>
<h4 id="RedisPreRequestHandler"><a href="#RedisPreRequestHandler" class="headerlink" title="RedisPreRequestHandler"></a>RedisPreRequestHandler</h4><p>RedisPreRequestHandler Á±ªÊòØ‰∏Ä‰∏™È¢ÑÂ§ÑÁêÜÂô®ÁªÑ‰ª∂ÔºåÂÖ∂‰ΩúÁî®ÊòØ<strong>Âú®ÊâßË°åÁßíÊùÄÂâçÔºåÊ∏ÖÁêÜÂíåÂàùÂßãÂåñ Redis ‰∏≠‰∏éÁßíÊùÄÊ¥ªÂä®Áõ∏ÂÖ≥ÁöÑÁºìÂ≠òÊï∞ÊçÆ</strong>Ôºå‰ª•Á°Æ‰øù Redis ÁºìÂ≠òÁéØÂ¢ÉÂ§Ñ‰∫éÂπ≤ÂáÄ‰∏îÊ≠£Á°ÆÁöÑÁä∂ÊÄÅ„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPreRequestHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractPreRequestHandler</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisService redisService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SeckillWebMockRequestDTO request)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">seckillId</span> <span class="hljs-operator">=</span> request.getSeckillId();<br>        redisService.removeSeckill(seckillId);<br>        <span class="hljs-type">Seckill</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> redisService.getSeckill(seckillId);<br>        seckill.setStatus(SeckillStatusConstant.IN_PROGRESS);<br>        redisService.putSeckill(seckill);<br>        redisService.clearSeckillEndFlag(seckillId, request.getTaskId());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="StateMachinePreRequestHandler"><a href="#StateMachinePreRequestHandler" class="headerlink" title="StateMachinePreRequestHandler"></a>StateMachinePreRequestHandler</h4><p>Ëøô‰∏™ StateMachinePreRequestHandler Á±ªÊòØ‰∏Ä‰∏™È¢ÑÂ§ÑÁêÜÂô®ÁªÑ‰ª∂ÔºåÁî®‰∫é<strong>Âú®ÁßíÊùÄÊ¥ªÂä®ÂºÄÂßãÂâçÔºåÈÄöËøáÁä∂ÊÄÅÊú∫ÊúçÂä°Êù•ÂàùÂßãÂåñÂíåÁÆ°ÁêÜÁßíÊùÄÊ¥ªÂä®ÁöÑÁä∂ÊÄÅÊµÅËΩ¨</strong>ÔºåÊòØÈ¢ÑÂ§ÑÁêÜË¥£‰ªªÈìæ‰∏≠ÁöÑÁ¨¨‰∏âÊ≠•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateMachinePreRequestHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractPreRequestHandler</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StateMachineService stateMachineService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(SeckillWebMockRequestDTO request)</span> &#123;<br>        <span class="hljs-comment">// Áä∂ÊÄÅÊú∫ÂàùÂßãÂåñ</span><br>        stateMachineService.initStateMachine(request.getSeckillId());<br>        <span class="hljs-comment">// ÂàùÂßãÂåñÂ∫ìÂ≠òÊï∞Èáè</span><br>        <span class="hljs-comment">// ‰ΩøÁî®Áä∂ÊÄÅÊú∫ÊéßÂà∂Ê¥ªÂä®Áä∂ÊÄÅ</span><br>        <span class="hljs-keyword">if</span> (!stateMachineService.feedMachine(Events.ACTIVITY_RESET, request.getSeckillId())) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Ê¥ªÂä®Â∞öÊú™ÁªìÊùüÔºåËØ∑Á≠âÂæÖÊ¥ªÂä®ÁªìÊùüÂêéÂÜçÊ¨°Êìç‰Ωú&quot;</span>);<br>        &#125;<br>        stateMachineService.feedMachine(Events.ACTIVITY_START, request.getSeckillId());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="HandlerÁöÑ‰ΩúÁî®"><a href="#HandlerÁöÑ‰ΩúÁî®" class="headerlink" title="HandlerÁöÑ‰ΩúÁî®"></a>HandlerÁöÑ‰ΩúÁî®</h4><p>ÁßíÊùÄÁ≥ªÁªüÁöÑÁâπÁÇπÊòØ<strong>È´òÂπ∂Âèë„ÄÅÊï∞ÊçÆÊïèÊÑü„ÄÅÁä∂ÊÄÅÂ§çÊùÇ</strong>ÔºåÊâÄ‰ª•Âú®ÊØèÊ¨°Ê¥ªÂä®ÂºÄÂßãÂâçÔºåÈúÄË¶Å<strong>ÂÆåÊàê‰∏ÄÁ≥ªÂàóÁöÑÂáÜÂ§áÂ∑•‰Ωú</strong><br>Ëøô‰∫õ Handler Â∞±ÂÉè‚ÄúÂêØÂä®ÂâçÊ£ÄÊü•Ê∏ÖÂçï‚ÄùÔºåÊØè‰∏™Ë¥üË¥£‰∏Ä‰∏™ÁéØËäÇÔºå‰ªéÊï∞ÊçÆ„ÄÅÁºìÂ≠ò„ÄÅÁä∂ÊÄÅ„ÄÅÂéÜÂè≤ËÆ∞ÂΩïÁ≠âÂ§ö‰∏™Áª¥Â∫¶ÂÅöÂ•ΩÂáÜÂ§áÔºåÁ°Æ‰øùÁßíÊùÄÁ≥ªÁªüÂú®È´òÂπ∂Âèë‰∏ã‰πüËÉΩÁ®≥ÂÆöËøêË°å„ÄÇ<br>ÂÅáËÆæ‰Ω†ËøêË°å‰∏Ä‰∏™Êñ∞ÁöÑÁßíÊùÄÊ®°Êãü‰ªªÂä°ÔºåÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<p><img src="/img/blogs/java/goodskill/3.2.9.png" srcset="/img/loading.gif" lazyload></p>
<table>
<thead>
<tr>
<th>È°∫Â∫è</th>
<th>Â§ÑÁêÜÂô®</th>
<th>ÂäüËÉΩ</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>DatabasePreRequestHandler</td>
<td>ÈáçÁΩÆÊï∞ÊçÆÂ∫ìÂ∫ìÂ≠òÔºåÊ∏ÖÁêÜËÆ¢ÂçïËÆ∞ÂΩï</td>
</tr>
<tr>
<td>1</td>
<td>RedisPreRequestHandler</td>
<td>Ê∏ÖÈô§ÁºìÂ≠ò„ÄÅËÆæÁΩÆ‰∏∫Ê¥ªÂä®ËøõË°å‰∏≠</td>
</tr>
<tr>
<td>2</td>
<td>StateMachinePreRequestHandler</td>
<td>ÂàùÂßãÂåñÁä∂ÊÄÅÊú∫„ÄÅÊ£ÄÊµãÊòØÂê¶ÂèØÈáçÂêØ„ÄÅÂêØÂä®Ê¥ªÂä®Áä∂ÊÄÅ</td>
</tr>
<tr>
<td>3</td>
<td>MongoPreRequestHandler</td>
<td>Ê∏ÖÈô§ Mongo ‰∏≠ÁöÑËÆ¢ÂçïËÆ∞ÂΩï</td>
</tr>
</tbody></table>
<h3 id="3-2-7-implÂÆûÁé∞Á±ª"><a href="#3-2-7-implÂÆûÁé∞Á±ª" class="headerlink" title="3.2.7 implÂÆûÁé∞Á±ª"></a>3.2.7 implÂÆûÁé∞Á±ª</h3><p><img src="/img/blogs/java/goodskill/3.2.10.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="GoodsServiceImpl"><a href="#GoodsServiceImpl" class="headerlink" title="GoodsServiceImpl"></a>GoodsServiceImpl</h4><p>GoodsServiceImpl ÊòØ‰∏Ä‰∏™<strong>ÂïÜÂìÅÊúçÂä°ÁöÑÂÆûÁé∞Á±ª</strong>ÔºåÂ±û‰∫éÁßíÊùÄÁ≥ªÁªü‰∏≠ÁöÑÂïÜÂìÅÊ®°ÂùóÔºåË¥üË¥£ÂïÜÂìÅÁöÑÂü∫Êú¨‰ø°ÊÅØÁÆ°ÁêÜÔºåÂåÖÊã¨Êï∞ÊçÆÂ∫ìÊìç‰Ωú„ÄÅESÔºàElasticsearchÔºâÁ¥¢ÂºïÂêåÊ≠•„ÄÅÂõæÁâá‰∏ä‰º†Á≠â</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DubboService</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;GoodsMapper, Goods&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsService</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> GoodsEsService goodsEsService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> GoodsMapper baseMapper;<br><br>    <span class="hljs-comment">//‰∏ä‰º†Âπ∂Êõ¥Êñ∞ÂïÜÂìÅÂõæÁâáÈìæÊé•</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uploadGoodsPhoto</span><span class="hljs-params">(<span class="hljs-type">long</span> goodsId, String fileUrl)</span> &#123;<br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Goods</span>();<br>        goods.setGoodsId((<span class="hljs-type">int</span>) goodsId);<br>        goods.setPhotoUrl(fileUrl);<br>        log.info(goods.toString());<br>        baseMapper.updateById(goods);<br>    &#125;<br><br>    <span class="hljs-comment">//Ê∑ªÂä†Êñ∞ÂïÜÂìÅÔºàÂê´ESÂêåÊ≠•Ôºâ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addGoods</span><span class="hljs-params">(GoodsVO goods)</span> &#123;<br>        baseMapper.insert(BeanUtil.copyProperties(goods, Goods.class));<br>        <span class="hljs-type">GoodsDTO</span> <span class="hljs-variable">goodsDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsDTO</span>();<br>        goodsDto.setId(IdWorker.getId());<br>        BeanUtils.copyProperties(goods, goodsDto);<br>        <span class="hljs-keyword">try</span> &#123;<br>            goodsEsService.save(goodsDto);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.warn(<span class="hljs-string">&quot;esÊúçÂä°‰∏çÂèØÁî®ÔºåËØ∑Ê£ÄÊü•ÔºÅ&quot;</span>, e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//Ê†πÊçÆÂïÜÂìÅ ID Êü•ËØ¢ÂïÜÂìÅ‰ø°ÊÅØ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> GoodsVO <span class="hljs-title function_">findById</span><span class="hljs-params">(Serializable id)</span> &#123;<br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">byId</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.getById(id);<br>        <span class="hljs-keyword">return</span> BeanUtil.copyProperties(byId, GoodsVO.class);<br>    &#125;<br><br>    <span class="hljs-comment">//Êü•ËØ¢ÊâÄÊúâÂïÜÂìÅ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;GoodsVO&gt; <span class="hljs-title function_">findMany</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BeanUtil.copyToList(<span class="hljs-built_in">super</span>.list(), GoodsVO.class);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>ÊñπÊ≥ï‰ΩúÁî®</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td><code>uploadGoodsPhoto(long goodsId, String fileUrl)</code></td>
<td>‰∏ä‰º†Âπ∂Êõ¥Êñ∞ÂïÜÂìÅÂõæÁâáÈìæÊé•</td>
<td>Â∞Ü‰∏ä‰º†Â•ΩÁöÑÂõæÁâá URL ÂÜôÂÖ•Êï∞ÊçÆÂ∫ì‰∏≠ÂØπÂ∫îÁöÑÂïÜÂìÅËÆ∞ÂΩïÈáå„ÄÇ</td>
</tr>
<tr>
<td><code>addGoods(GoodsVO goods)</code></td>
<td>Ê∑ªÂä†Êñ∞ÂïÜÂìÅÔºàÂê´ESÂêåÊ≠•Ôºâ</td>
<td>- Â∞ÜÂïÜÂìÅ‰ø°ÊÅØÊèíÂÖ•Êï∞ÊçÆÂ∫ìÔºõ<br>- Â∞ÜÂïÜÂìÅ‰ø°ÊÅØÊûÑÈÄ†Êàê GoodsDTO ÂØπË±°ÂêåÊ≠•Âà∞ ElasticsearchÔºõ<br>- Ëã• ES Âá∫ÈîôÂàôËÆ∞ÂΩïË≠¶ÂëäÊó•ÂøóÔºå‰∏ç‰∏≠Êñ≠‰∫ãÂä°„ÄÇ</td>
</tr>
<tr>
<td><code>findById(Serializable id)</code></td>
<td>Ê†πÊçÆÂïÜÂìÅ ID Êü•ËØ¢ÂïÜÂìÅ‰ø°ÊÅØ</td>
<td>‰ªéÊï∞ÊçÆÂ∫ìÊü•ËØ¢ÂïÜÂìÅËÆ∞ÂΩïÂπ∂ËΩ¨Êç¢‰∏∫ÂâçÁ´ØÁî®ÁöÑ GoodsVO ÂØπË±°ËøîÂõû„ÄÇ</td>
</tr>
<tr>
<td><code>findMany()</code></td>
<td>Êü•ËØ¢ÊâÄÊúâÂïÜÂìÅ</td>
<td>Êü•ËØ¢ÊâÄÊúâÂïÜÂìÅËÆ∞ÂΩïÂπ∂Â∞ÅË£ÖÊàê VO ÂàóË°®„ÄÇ</td>
</tr>
</tbody></table>
<h4 id="SeckillServiceImpl"><a href="#SeckillServiceImpl" class="headerlink" title="SeckillServiceImpl"></a>SeckillServiceImpl</h4><p><strong>ÁßíÊùÄÊúçÂä°ÁöÑÂÆûÁé∞Á±ª</strong>ÔºåÁªßÊâø‰∫Ü <code>ServiceImpl&lt;SeckillMapper, Seckill&gt;</code>ÔºåÂπ∂ÂÆûÁé∞‰∫Ü <code>SeckillService</code> Êé•Âè£„ÄÇËøô‰∏™Á±ªÈõÜÊàê‰∫Ü Dubbo„ÄÅRedis„ÄÅMongoDB„ÄÅÁ∫øÁ®ãÊ±†„ÄÅÁä∂ÊÄÅÊú∫„ÄÅÈ¢ÑÂ§ÑÁêÜÊµÅÊ∞¥Á∫øÁ≠âÁªÑ‰ª∂ÔºåÂäüËÉΩÈùûÂ∏∏‰∏∞ÂØåÔºåÊ†∏ÂøÉ‰ΩúÁî®ÊòØË¥üË¥£‚ÄúÁßíÊùÄÊ¥ªÂä®‚ÄùÁöÑ‰∏öÂä°ÈÄªËæëÂ§ÑÁêÜÔºåÂåÖÊã¨Ê¥ªÂä®ÂáÜÂ§á„ÄÅÁßíÊùÄÊâßË°å„ÄÅ‰∫åÁª¥Á†ÅÁîüÊàê„ÄÅÁßíÊùÄËÆ∞ÂΩïÁÆ°ÁêÜÁ≠â</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@DubboService</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;SeckillMapper, Seckill&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SeckillService</span> &#123;<br>    <span class="hljs-comment">//ÂàÜÈ°µËé∑ÂèñÁßíÊùÄÊ¥ªÂä®ÂàóË°®ÔºåÊîØÊåÅÂïÜÂìÅÂêçÊ®°Á≥äÊü•ËØ¢ÔºåÊü•ËØ¢ÁªìÊûúÁºìÂ≠òËøõ RedisÔºåÈÅøÂÖçÈ¢ëÁπÅ DB Êü•ËØ¢</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> PageDTO&lt;SeckillVO&gt; <span class="hljs-title function_">getSeckillList</span><span class="hljs-params">(<span class="hljs-type">int</span> pageNum, <span class="hljs-type">int</span> pageSize, String goodsName)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;seckill:list:&quot;</span> + pageNum + <span class="hljs-string">&quot;:&quot;</span> + pageSize + <span class="hljs-string">&quot;:&quot;</span> + goodsName;<br>        <span class="hljs-type">ValueOperations</span> <span class="hljs-variable">valueOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">pageCache</span> <span class="hljs-operator">=</span> valueOperations.get(key);<br>        PageDTO&lt;SeckillVO&gt; page;<br>        <span class="hljs-keyword">if</span> (Objects.isNull(pageCache)) &#123;<br>            QueryWrapper&lt;Seckill&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>            <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(goodsName)) &#123;<br>                queryWrapper.lambda().like(Seckill::getName, goodsName);<br>            &#125;<br>            Page&lt;Seckill&gt; seckillPage = baseMapper.selectPage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>(pageNum, pageSize), queryWrapper);<br>            List&lt;SeckillVO&gt; collect = seckillPage.getRecords().stream().map(it -&gt; &#123;<br>                <span class="hljs-type">SeckillVO</span> <span class="hljs-variable">seckillVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillVO</span>();<br>                BeanUtils.copyProperties(it, seckillVO);<br>                <span class="hljs-type">GoodsVO</span> <span class="hljs-variable">byId</span> <span class="hljs-operator">=</span> goodsService.findById(it.getGoodsId());<br>                <span class="hljs-keyword">if</span> (Objects.nonNull(byId)) &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">photoUrl</span> <span class="hljs-operator">=</span> byId.getPhotoUrl();<br>                    seckillVO.setPhotoUrl(photoUrl);<br>                &#125;<br>                <span class="hljs-keyword">return</span> seckillVO;<br>            &#125;).collect(Collectors.toList());<br>            page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageDTO</span>&lt;&gt;();<br>            page.setCurrent(pageNum);<br>            page.setSize(pageSize);<br>            page.setTotal(seckillPage.getTotal());<br>            page.setRecords(collect);<br>            valueOperations.set(key, page, <span class="hljs-number">5</span>, TimeUnit.MINUTES);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            page = (PageDTO&lt;SeckillVO&gt;) pageCache;<br>        &#125;<br>        <span class="hljs-keyword">return</span> page;<br>    &#125;<br><br>    <span class="hljs-comment">//Êö¥Èú≤ÁßíÊùÄÂú∞ÂùÄÔºåÁî®‰∫éÈ™åËØÅÊ¥ªÂä®ÊòØÂê¶Âú®ÊúâÊïàÊúüÂÜÖÔºåÂπ∂ÁîüÊàê‰∏Ä‰∏™Â∏¶ MD5 ÁöÑÂä†ÂØÜÈìæÊé•„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ExposerDTO <span class="hljs-title function_">exportSeckillUrl</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-comment">//‰ªéredis‰∏≠Ëé∑ÂèñÁºìÂ≠òÁßíÊùÄ‰ø°ÊÅØ</span><br>        <span class="hljs-type">Seckill</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> redisService.getSeckill(seckillId);<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> seckill.getStartTime();<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> seckill.getEndTime();<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">nowTime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>        <span class="hljs-keyword">if</span> (nowTime.getTime() &lt; startTime.getTime() || nowTime.getTime() &gt; endTime.getTime()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExposerDTO</span>(<span class="hljs-literal">false</span>, seckillId, nowTime.getTime(), startTime.getTime(), endTime.getTime());<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">md5</span> <span class="hljs-operator">=</span> MD5Util.getMD5(seckillId);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExposerDTO</span>(<span class="hljs-literal">true</span>, md5, seckillId);<br>    &#125;<br><br>    <span class="hljs-comment">//Âà†Èô§Êüê‰∏™ÁßíÊùÄÊ¥ªÂä®ÁöÑÊâÄÊúâÊàêÂäüËÆ∞ÂΩïÔºàÊìç‰ΩúÊï∞ÊçÆÂ∫ìÔºâ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteSuccessKillRecord</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-type">SuccessKilled</span> <span class="hljs-variable">example</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuccessKilled</span>();<br>        example.setSeckillId(seckillId);<br>        successKilledMapper.delete(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;(example));<br>    &#125;<br><br>    <span class="hljs-comment">//Ê†πÊçÆÁ≠ñÁï•ÁºñÂè∑ÈÄâÊã©ÂØπÂ∫îÁöÑÁßíÊùÄÁ≠ñÁï•ÊâßË°åÂô®ÔºåÊâßË°åÁßíÊùÄÈÄªËæëÔºàÁ≠ñÁï•Ê®°ÂºèÔºâ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto, <span class="hljs-type">int</span> strategyNumber)</span> &#123;<br>        goodskillStrategies.stream()<br>                .filter(n -&gt; n.getClass().getName().startsWith(Objects.requireNonNull(GoodsKillStrategyEnum.stateOf(strategyNumber)).getClassName()))<br>                .findFirst().ifPresent(n -&gt; n.execute(requestDto));<br>    &#125;<br><br>    <span class="hljs-comment">//Ëé∑ÂèñÁßíÊùÄÊàêÂäüÁöÑËÆ∞ÂΩïÊï∞Ôºå‰ºòÂÖàÊü•Êï∞ÊçÆÂ∫ìÔºåÊ≤°ÊúâÂÜçÊü• MongoDB„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getSuccessKillCount</span><span class="hljs-params">(Long seckillId)</span> &#123;<br>        <span class="hljs-type">SuccessKilled</span> <span class="hljs-variable">example</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuccessKilled</span>();<br>        example.setSeckillId(seckillId);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> successKilledMapper.selectCount(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;(example));<br>        <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                count = orderService.count(seckillId);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                log.error(<span class="hljs-string">&quot;mongoÊúçÂä°‰∏çÂèØÁî®ÔºåËØ∑Ê£ÄÊü•ÔºÅ&quot;</span>, e);<br>                <span class="hljs-keyword">throw</span> e;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br><br>    <span class="hljs-comment">//ÂáÜÂ§áÁßíÊùÄÊ¥ªÂä®ÁöÑËµÑÊ∫êÔºàÂ∫ìÂ≠ò„ÄÅÁä∂ÊÄÅ„ÄÅÁºìÂ≠òÁ≠âÔºâÔºåË∞ÉÁî®È¢ÑÂ§ÑÁêÜÊµÅÊ∞¥Á∫ø‰∏≠ÁöÑÂ§ö‰∏™ Handler ÊâßË°å„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareSeckill</span><span class="hljs-params">(Long seckillId, <span class="hljs-type">int</span> seckillCount, String taskId)</span> &#123;<br>        <span class="hljs-type">SeckillWebMockRequestDTO</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillWebMockRequestDTO</span>();<br>        request.setSeckillId(seckillId);<br>        request.setSeckillCount(seckillCount);<br>        request.setTaskId(taskId);<br>        preRequestPipeline.handle(request);<br>    &#125;<br><br>    <span class="hljs-comment">//ÂáèÂ∫ìÂ≠òÁöÑÂ§ñÂ±ÇÊñπÊ≥ïÔºåË∞ÉÁî® reduceNumberInner„ÄÇÊçïËé∑ÂºÇÂ∏∏ÈÅøÂÖç‰∏≠Êñ≠ÊµÅÁ®ã„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">reduceNumber</span><span class="hljs-params">(SuccessKilledDTO successKilled)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            count = seckillService.reduceNumberInner(successKilled);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.warn(e.getMessage());<br>        &#125;<br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br><br>    <span class="hljs-comment">//ÁúüÊ≠£ÂáèÂ∫ìÂ≠òÔºöÊèíÂÖ•ÁßíÊùÄËÆ∞ÂΩïÔºåÁÑ∂ÂêéÊõ¥Êñ∞Â∫ìÂ≠òÔºàÂ∏¶Êù°‰ª∂ÈôêÂà∂Ôºâ„ÄÇÊõ¥Êñ∞Â§±Ë¥•‰ºöÊäõÂá∫‚ÄúÊ¥ªÂä®Â∑≤ÁªìÊùü‚ÄùÂºÇÂ∏∏„ÄÇ</span><br>    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">reduceNumberInner</span><span class="hljs-params">(SuccessKilledDTO successKilled)</span> &#123;<br>        <span class="hljs-type">SuccessKilled</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> BeanUtil.copyProperties(successKilled, SuccessKilled.class);<br>        successKilledMapper.insert(entity);<br>        <span class="hljs-type">Seckill</span> <span class="hljs-variable">wrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Seckill</span>();<br>        wrapper.setSeckillId(entity.getSeckillId());<br>        UpdateWrapper&lt;Seckill&gt; updateWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateWrapper</span>(wrapper);<br>        updateWrapper.gt(<span class="hljs-string">&quot;end_time&quot;</span>, entity.getCreateTime());<br>        updateWrapper.lt(<span class="hljs-string">&quot;start_time&quot;</span>, entity.getCreateTime());<br>        updateWrapper.gt(<span class="hljs-string">&quot;number&quot;</span>, <span class="hljs-number">0</span>);<br>        updateWrapper.setSql(<span class="hljs-string">&quot;number = number - 1&quot;</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">update</span> <span class="hljs-operator">=</span> baseMapper.update(<span class="hljs-literal">null</span>, updateWrapper);<br>        <span class="hljs-keyword">if</span> (update &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillCloseException</span>(<span class="hljs-string">&quot;seckill is closed&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> update;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//Ê†πÊçÆÊñá‰ª∂ÂêçËØªÂèñÊú¨Âú∞‰∫åÁª¥Á†ÅÂõæÁâáÂπ∂ËøîÂõûÂ≠óËäÇÊµÅÔºåÈÄöÂ∏∏Áî®‰∫éËÆ¢ÂçïÊîØ‰ªò</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> SeckillResponseDTO <span class="hljs-title function_">getQrcode</span><span class="hljs-params">(String fileName)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">SeckillResponseDTO</span> <span class="hljs-variable">seckillResponseDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillResponseDTO</span>();<br>        <span class="hljs-keyword">if</span> (qrcodeImagePath == <span class="hljs-literal">null</span>) &#123;<br>            qrcodeImagePath = System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(qrcodeImagePath + <span class="hljs-string">&quot;/&quot;</span> + fileName + <span class="hljs-string">&quot;.png&quot;</span>);<br>        <span class="hljs-type">int</span> b;<br>        <span class="hljs-comment">// ‰∫åÁª¥Á†Å‰∏ÄËà¨‰∏çË∂ÖËøá10KB</span><br>        <span class="hljs-type">byte</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">10</span>];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> ((b = inputStream.read()) != -<span class="hljs-number">1</span>) &#123;<br>            data[i] = (<span class="hljs-type">byte</span>) b;<br>            i++;<br>        &#125;<br>        seckillResponseDto.setData(data);<br>        <span class="hljs-keyword">return</span> seckillResponseDto;<br>    &#125;<br><br>    <span class="hljs-comment">//Êü•ËØ¢ÁßíÊùÄÊ¥ªÂä®ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÔºåÂåÖÊã¨ÁªëÂÆöÁöÑÂïÜÂìÅ‰ø°ÊÅØ„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> SeckillInfoDTO <span class="hljs-title function_">getInfoById</span><span class="hljs-params">(Serializable seckillId)</span> &#123;<br>        <span class="hljs-type">SeckillInfoDTO</span> <span class="hljs-variable">seckillInfoDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillInfoDTO</span>();<br>        <span class="hljs-type">SeckillVO</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> seckillService.findById(seckillId);<br>        <span class="hljs-type">GoodsVO</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> goodsService.findById(seckill.getGoodsId());<br>        BeanUtils.copyProperties(seckill, seckillInfoDTO);<br>        seckillInfoDTO.setGoodsName(goods.getName());<br>        <span class="hljs-keyword">return</span> seckillInfoDTO;<br>    &#125;<br><br>    <span class="hljs-comment">//ÈÄöËøáÁä∂ÊÄÅÊú∫ÁªìÊùüÁßíÊùÄÊ¥ªÂä®ÔºàËß¶ÂèëÁä∂ÊÄÅÂèòËøÅÔºâ„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">endSeckill</span><span class="hljs-params">(Long seckillId)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMachineService.feedMachine(Events.ACTIVITY_END, seckillId);<br>    &#125;<br><br>    <span class="hljs-comment">//Âà†Èô§Êüê‰∏™ÁßíÊùÄÊ¥ªÂä®„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeBySeckillId</span><span class="hljs-params">(Serializable id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.removeById(id);<br>    &#125;<br><br>    <span class="hljs-comment">//Êñ∞Âª∫ÁßíÊùÄÊ¥ªÂä®ËÆ∞ÂΩï„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">save</span><span class="hljs-params">(SeckillVO seckill)</span> &#123;<br>        <span class="hljs-keyword">return</span> baseMapper.insert(BeanUtil.copyProperties(seckill, Seckill.class)) &gt; <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//Ê†πÊçÆ ID Ëé∑ÂèñÁßíÊùÄÊ¥ªÂä® VO ÂØπË±°ÔºàÂ∞ÅË£ÖÂ±ïÁ§∫Êï∞ÊçÆÔºâ„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> SeckillVO <span class="hljs-title function_">findById</span><span class="hljs-params">(Serializable id)</span> &#123;<br>        <span class="hljs-keyword">return</span> BeanUtil.copyProperties(<span class="hljs-built_in">super</span>.getById(id), SeckillVO.class);<br>    &#125;<br><br>    <span class="hljs-comment">//Êõ¥Êñ∞ÊàñÊñ∞Â¢ûÁßíÊùÄÊ¥ªÂä®Êï∞ÊçÆÔºàMyBatis Plus Â∞ÅË£ÖÊñπÊ≥ïÔºâ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">saveOrUpdateSeckill</span><span class="hljs-params">(SeckillVO seckill)</span> &#123;<br>        <span class="hljs-keyword">return</span> saveOrUpdate(BeanUtil.copyProperties(seckill, Seckill.class));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>‰ΩúÁî®ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td><code>getSeckillList</code></td>
<td>ÂàÜÈ°µËé∑ÂèñÁßíÊùÄÊ¥ªÂä®ÂàóË°®ÔºåÊîØÊåÅÂïÜÂìÅÂêçÊ®°Á≥äÊü•ËØ¢ÔºåÊü•ËØ¢ÁªìÊûúÁºìÂ≠òËøõ RedisÔºåÈÅøÂÖçÈ¢ëÁπÅ DB Êü•ËØ¢„ÄÇ</td>
</tr>
<tr>
<td><code>exportSeckillUrl</code></td>
<td>Êö¥Èú≤ÁßíÊùÄÂú∞ÂùÄÔºåÁî®‰∫éÈ™åËØÅÊ¥ªÂä®ÊòØÂê¶Âú®ÊúâÊïàÊúüÂÜÖÔºåÂπ∂ÁîüÊàê‰∏Ä‰∏™Â∏¶ MD5 ÁöÑÂä†ÂØÜÈìæÊé•„ÄÇ</td>
</tr>
<tr>
<td><code>deleteSuccessKillRecord</code></td>
<td>Âà†Èô§Êüê‰∏™ÁßíÊùÄÊ¥ªÂä®ÁöÑÊâÄÊúâÊàêÂäüËÆ∞ÂΩïÔºàÊìç‰ΩúÊï∞ÊçÆÂ∫ìÔºâ„ÄÇ</td>
</tr>
<tr>
<td><code>execute</code></td>
<td>Ê†πÊçÆÁ≠ñÁï•ÁºñÂè∑ÈÄâÊã©ÂØπÂ∫îÁöÑÁßíÊùÄÁ≠ñÁï•ÊâßË°åÂô®ÔºåÊâßË°åÁßíÊùÄÈÄªËæëÔºàÁ≠ñÁï•Ê®°ÂºèÔºâ„ÄÇ</td>
</tr>
<tr>
<td><code>getSuccessKillCount</code></td>
<td>Ëé∑ÂèñÁßíÊùÄÊàêÂäüÁöÑËÆ∞ÂΩïÊï∞Ôºå‰ºòÂÖàÊü•Êï∞ÊçÆÂ∫ìÔºåÊ≤°ÊúâÂÜçÊü• MongoDB„ÄÇ</td>
</tr>
<tr>
<td><code>prepareSeckill</code></td>
<td>ÂáÜÂ§áÁßíÊùÄÊ¥ªÂä®ÁöÑËµÑÊ∫êÔºàÂ∫ìÂ≠ò„ÄÅÁä∂ÊÄÅ„ÄÅÁºìÂ≠òÁ≠âÔºâÔºåË∞ÉÁî®È¢ÑÂ§ÑÁêÜÊµÅÊ∞¥Á∫ø‰∏≠ÁöÑÂ§ö‰∏™ Handler ÊâßË°å„ÄÇ</td>
</tr>
<tr>
<td><code>reduceNumber</code></td>
<td>ÂáèÂ∫ìÂ≠òÁöÑÂ§ñÂ±ÇÊñπÊ≥ïÔºåË∞ÉÁî® reduceNumberInner„ÄÇÊçïËé∑ÂºÇÂ∏∏ÈÅøÂÖç‰∏≠Êñ≠ÊµÅÁ®ã„ÄÇ</td>
</tr>
<tr>
<td><code>reduceNumberInner</code></td>
<td>ÁúüÊ≠£ÂáèÂ∫ìÂ≠òÔºöÊèíÂÖ•ÁßíÊùÄËÆ∞ÂΩïÔºåÁÑ∂ÂêéÊõ¥Êñ∞Â∫ìÂ≠òÔºàÂ∏¶Êù°‰ª∂ÈôêÂà∂Ôºâ„ÄÇÊõ¥Êñ∞Â§±Ë¥•‰ºöÊäõÂá∫‚ÄúÊ¥ªÂä®Â∑≤ÁªìÊùü‚ÄùÂºÇÂ∏∏„ÄÇ</td>
</tr>
<tr>
<td><code>getQrcode</code></td>
<td>Ê†πÊçÆÊñá‰ª∂ÂêçËØªÂèñÊú¨Âú∞‰∫åÁª¥Á†ÅÂõæÁâáÂπ∂ËøîÂõûÂ≠óËäÇÊµÅÔºåÈÄöÂ∏∏Áî®‰∫éËÆ¢ÂçïÊîØ‰ªò„ÄÇ</td>
</tr>
<tr>
<td><code>getInfoById</code></td>
<td>Êü•ËØ¢ÁßíÊùÄÊ¥ªÂä®ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÔºåÂåÖÊã¨ÁªëÂÆöÁöÑÂïÜÂìÅ‰ø°ÊÅØ„ÄÇ</td>
</tr>
<tr>
<td><code>endSeckill</code></td>
<td>ÈÄöËøáÁä∂ÊÄÅÊú∫ÁªìÊùüÁßíÊùÄÊ¥ªÂä®ÔºàËß¶ÂèëÁä∂ÊÄÅÂèòËøÅÔºâ„ÄÇ</td>
</tr>
<tr>
<td><code>removeBySeckillId</code></td>
<td>Âà†Èô§Êüê‰∏™ÁßíÊùÄÊ¥ªÂä®„ÄÇ</td>
</tr>
<tr>
<td><code>save</code></td>
<td>Êñ∞Âª∫ÁßíÊùÄÊ¥ªÂä®ËÆ∞ÂΩï„ÄÇ</td>
</tr>
<tr>
<td><code>findById</code></td>
<td>Ê†πÊçÆ ID Ëé∑ÂèñÁßíÊùÄÊ¥ªÂä® VO ÂØπË±°ÔºàÂ∞ÅË£ÖÂ±ïÁ§∫Êï∞ÊçÆÔºâ„ÄÇ</td>
</tr>
<tr>
<td><code>saveOrUpdateSeckill</code></td>
<td>Êõ¥Êñ∞ÊàñÊñ∞Â¢ûÁßíÊùÄÊ¥ªÂä®Êï∞ÊçÆÔºàMyBatis Plus Â∞ÅË£ÖÊñπÊ≥ïÔºâ„ÄÇ</td>
</tr>
</tbody></table>
<h4 id="GoodsEsServiceImpl"><a href="#GoodsEsServiceImpl" class="headerlink" title="GoodsEsServiceImpl"></a>GoodsEsServiceImpl</h4><p>ÊòØ‰∏Ä‰∏™Âü∫‰∫éElasticsearch ÁöÑÊúçÂä°ÂÆûÁé∞Á±ªÔºåË¥üË¥£ÂØπ <strong>ÂïÜÂìÅ‰ø°ÊÅØËøõË°å Elasticsearch ÁöÑÂ¢ûÂà†Êü•Êìç‰Ωú</strong>ÔºåÊèê‰æõ‰∫Ü‰∏éÊêúÁ¥¢Áõ∏ÂÖ≥ÁöÑÂäüËÉΩÔºåÈÄÇÁî®‰∫éÁîµÂïÜÁ±ªÁ≥ªÁªü‰∏≠ÁöÑÂïÜÂìÅÊêúÁ¥¢Ê®°Âùó„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsEsServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsEsService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">BeanCopier</span> <span class="hljs-variable">beanCopier</span> <span class="hljs-operator">=</span> BeanCopier.create(GoodsDTO.class, Goods.class, <span class="hljs-literal">false</span>);<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ElasticsearchOperations elasticsearchOperations;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> GoodsRepository goodsRepository;<br><br>    <span class="hljs-comment">//Â∞ÜÂçï‰∏™ÂïÜÂìÅ‰øùÂ≠òÂà∞ Elasticsearch</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(GoodsDTO goodsDto)</span> &#123;<br>        <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Goods</span>();<br>        beanCopier.copy(goodsDto, goods, <span class="hljs-literal">null</span>);<br>        goodsRepository.save(goods);<br>    &#125;<br><br>    <span class="hljs-comment">//ÊâπÈáè‰øùÂ≠òÂïÜÂìÅ‰ø°ÊÅØÂà∞ Elasticsearch</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveBatch</span><span class="hljs-params">(List&lt;GoodsDTO&gt; list)</span> &#123;<br>        List&lt;Goods&gt; collect = list.stream().map(dto -&gt; &#123;<br>            <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Goods</span>();<br>            beanCopier.copy(dto, goods, <span class="hljs-literal">null</span>);<br>            <span class="hljs-keyword">return</span> goods;<br>        &#125;).collect(Collectors.toList());<br>        goodsRepository.saveAll(collect);<br>    &#125;<br><br>    <span class="hljs-comment">//Âà†Èô§Êüê‰∏™ÂïÜÂìÅÁöÑ ES Á¥¢ÂºïÊñáÊ°£</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(GoodsDTO goodsDto)</span> &#123;<br>        goodsRepository.deleteByGoodsId(goodsDto.getGoodsId());<br>    &#125;<br><br>    <span class="hljs-comment">//ÊåâÂïÜÂìÅÂêçÊ®°Á≥äÂåπÈÖçÊêúÁ¥¢ÂïÜÂìÅÔºàÊúÄÂ§öËøîÂõû3Êù°ÔºâÔºåÂπ∂È´ò‰∫ÆÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠ó</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;GoodsDTO&gt; <span class="hljs-title function_">searchWithNameByPage</span><span class="hljs-params">(String input)</span> &#123;<br>        <span class="hljs-type">Criteria</span> <span class="hljs-variable">criteria</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Criteria</span>(<span class="hljs-string">&quot;name&quot;</span>).matches(input);<br>        <span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CriteriaQuery</span>(criteria);<br><br>        <span class="hljs-type">HighlightFieldParameters</span> <span class="hljs-variable">parameters</span> <span class="hljs-operator">=</span> HighlightFieldParameters.builder()<br>                .withPostTags(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;&lt;/font&gt;&quot;</span>&#125;)<br>                .withPreTags(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;&lt;font color=&#x27;red&#x27;&gt;&quot;</span>&#125;)<br>                .build();<br>        <span class="hljs-type">HighlightField</span> <span class="hljs-variable">highlightField</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightField</span>(<span class="hljs-string">&quot;name&quot;</span>, parameters);<br>        <span class="hljs-type">Highlight</span> <span class="hljs-variable">highlight</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Highlight</span>(HighlightParameters.builder().build(), List.of(highlightField));<br>        query.setHighlightQuery(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightQuery</span>(highlight, <span class="hljs-literal">null</span>));<br>        query.setPageable(PageRequest.of(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>));<br>        <span class="hljs-keyword">return</span> elasticsearchOperations.search(query, Goods.class)<br>                .getSearchHits().stream().map(s -&gt; &#123;<br>                    <span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> s.getContent();<br>                    <span class="hljs-type">GoodsDTO</span> <span class="hljs-variable">goodsDto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsDTO</span>();<br>                    goodsDto.setName(s.getHighlightField(<span class="hljs-string">&quot;name&quot;</span>).getFirst());<br>                    goodsDto.setRawName(goods.getName());<br>                    <span class="hljs-keyword">return</span> goodsDto;<br>                &#125;).collect(Collectors.toList());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Â∞ÜÂïÜÂìÅ‰ø°ÊÅØ GoodsDTO ÂêåÊ≠•‰øùÂ≠òÂà∞ Elasticsearch„ÄÇ</li>
<li>ÊîØÊåÅÊâπÈáè‰øùÂ≠ò„ÄÅÂà†Èô§„ÄÇ</li>
<li>Êèê‰æõÂïÜÂìÅÂêçÁß∞ÁöÑÊêúÁ¥¢ÂäüËÉΩÔºåÂ∏¶ <strong>ÂÖ≥ÈîÆÂ≠óÈ´ò‰∫Æ</strong>„ÄÇ</li>
<li>‰Ωú‰∏∫Á≥ªÁªü‰∏≠ÊêúÁ¥¢ÊúçÂä°ÁöÑÂÆûÁé∞Á±ªÔºåÈÄÇÁî®‰∫éÁî®Êà∑ËæìÂÖ•ÂïÜÂìÅÂêçÁß∞ÂÖ≥ÈîÆÂ≠óÊó∂ÁöÑËÅîÊÉ≥ÊêúÁ¥¢&#x2F;Ê®°Á≥äÊêúÁ¥¢„ÄÇ</li>
</ul>
<h4 id="SuccessKilledServiceImpl"><a href="#SuccessKilledServiceImpl" class="headerlink" title="SuccessKilledServiceImpl"></a>SuccessKilledServiceImpl</h4><p>ÂÆûÁé∞‰∫Ü SuccessKilledService Êé•Âè£ÔºåÂπ∂ÁªßÊâø‰∫Ü MyBatis-Plus Êèê‰æõÁöÑ <code>ServiceImpl&lt;SuccessKilledMapper, SuccessKilled&gt;</code>ÔºåÂõ†Ê≠§ Ëá™Âä®ÁªßÊâø‰∫ÜÂ§ßÈÉ®ÂàÜ CRUD ÊñπÊ≥ï</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SuccessKilledServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;SuccessKilledMapper, SuccessKilled&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SuccessKilledService</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-8-innerÂåÖ"><a href="#3-2-8-innerÂåÖ" class="headerlink" title="3.2.8 innerÂåÖ"></a>3.2.8 innerÂåÖ</h3><p><img src="/img/blogs/java/goodskill/3.2.11.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="Êé•Âè£-SeckillExecutor"><a href="#Êé•Âè£-SeckillExecutor" class="headerlink" title="Êé•Âè£ SeckillExecutor"></a>Êé•Âè£ SeckillExecutor</h4><p>SeckillExecutor ÊòØ‰∏Ä‰∏™<strong>ÂÆö‰πâ‰∫ÜÊ†áÂáÜÁßíÊùÄÂ§ÑÁêÜÊñπÊ≥ïÁöÑÊé•Âè£</strong>Ôºå‰∏∫Êï¥‰∏™ÁßíÊùÄÁ≥ªÁªü‰∏≠‰∏çÂêåÁöÑÊâßË°åÁ≠ñÁï•Êèê‰æõÁªü‰∏ÄÁöÑÊâ©Â±ïÂÖ•Âè£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SeckillExecutor</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÁßíÊùÄÂÜÖÈÉ®Â§ÑÁêÜÊñπÊ≥ï</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">dealSeckill</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId, String userPhone, String note, String taskId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="ÂÆûÁé∞Á±ª-SeckillProcedureExecutor"><a href="#ÂÆûÁé∞Á±ª-SeckillProcedureExecutor" class="headerlink" title="ÂÆûÁé∞Á±ª SeckillProcedureExecutor"></a>ÂÆûÁé∞Á±ª SeckillProcedureExecutor</h4><p>ÊòØ SeckillExecutor Êé•Âè£ÁöÑ‰∏Ä‰∏™ÂÖ∑‰ΩìÂÆûÁé∞ÔºåÁî®‰∫éÂ§ÑÁêÜÁî®Êà∑ÂèëËµ∑ÁöÑÁßíÊùÄËØ∑Ê±Ç</p>
<p>ËøôÊòØ‰∏Ä‰∏™Âü∫‰∫é<strong>Êï∞ÊçÆÂ∫ìÂ≠òÂÇ®ËøáÁ®ã&#x2F;‰πêËßÇÈîÅÈÄªËæëÁöÑÁßíÊùÄÊâßË°åÂô®ÂÆûÁé∞Á±ª</strong>Ôºå‰∏ªË¶ÅËÅåË¥£ÊòØÔºö</p>
<ul>
<li>Â∞ùËØï‰∏∫Áî®Êà∑ÊâßË°å‰∏ÄÊ¨°ÁßíÊùÄÊìç‰Ωú</li>
<li>Âú®Â∫ìÂ≠òÂîÆÁΩÑÊó∂ÔºåËß¶ÂèëÁä∂ÊÄÅÊú∫ÂèòÊõ¥„ÄÅÈÄöÁü•‰∏ãÊ∏∏Á≥ªÁªüÔºàÂ¶ÇÈÄöËøá StreamBridge ÂèëÊ∂àÊÅØÔºâ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillProcedureExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SeckillExecutor</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Â§ÑÁêÜÁî®Êà∑ÁßíÊùÄËØ∑Ê±Ç</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillId ÁßíÊùÄÊ¥ªÂä®id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userPhone ÁßíÊùÄÁî®Êà∑ÊâãÊú∫Âè∑</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> note      ÁßíÊùÄÂ§áÊ≥®‰ø°ÊÅØ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> taskId    ÁßíÊùÄ‰ªªÂä°id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dealSeckill</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId, String userPhone, String note, String taskId)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">InetAddress</span> <span class="hljs-variable">localHost</span> <span class="hljs-operator">=</span> InetAddress.getLocalHost();<br>            <span class="hljs-type">SuccessKilledDTO</span> <span class="hljs-variable">successKilled</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuccessKilledDTO</span>();<br>            successKilled.setSeckillId(seckillId);<br>            successKilled.setUserPhone(userPhone);<br>            successKilled.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            successKilled.setServerIp(localHost.getHostAddress() + <span class="hljs-string">&quot;:&quot;</span> + localHost.getHostName());<br>            <span class="hljs-keyword">if</span> (seckillService.reduceNumber(successKilled) &lt; <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-type">Seckill</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> seckillMapper.selectById(seckillId);<br>                log.debug(<span class="hljs-string">&quot;#dealSeckill ÂΩìÂâçÂ∫ìÂ≠òÔºö&#123;&#125;ÔºåÁßíÊùÄÊ¥ªÂä®id:&#123;&#125;ÔºåÂïÜÂìÅid:&#123;&#125;&quot;</span>, seckill.getNumber(), seckill.getSeckillId(), seckill.getGoodsId());<br>                <span class="hljs-keyword">if</span> (stateMachineService.checkState(seckillId, States.IN_PROGRESS)) &#123;<br>                    stateMachineService.feedMachine(Events.ACTIVITY_CALCULATE, seckillId);<br>                    <span class="hljs-comment">// È´òÂπ∂ÂèëÊó∂ÂèØËÉΩÂ§öÊ¨°ÂèëÈÄÅÂÆåÊàêÈÄöÁü•Ôºå‰ΩøÁî®ÈîÅÊéßÂà∂</span><br>                    <span class="hljs-type">Boolean</span> <span class="hljs-variable">endFlag</span> <span class="hljs-operator">=</span> redisService.setSeckillEndFlag(seckillId, taskId);<br>                    <span class="hljs-keyword">if</span> (endFlag) &#123;<br>                        streamBridge.send(DEFAULT_BINDING_NAME, MessageBuilder.withPayload(<br>                                        SeckillMockResponseDTO.builder().seckillId(seckillId).note(note).status(<span class="hljs-literal">true</span>).taskId(taskId).build())<br>                                .build());<br>                        log.info(<span class="hljs-string">&quot;#dealSeckill ÂïÜÂìÅÂ∑≤ÂîÆÁΩÑÔºåÊúÄÊñ∞ÁßíÊùÄ‰ø°ÊÅØÔºö&#123;&#125;&quot;</span>, seckill);<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (seckill.getNumber() &lt;= <span class="hljs-number">0</span>) &#123;<br>                    log.debug(<span class="hljs-string">&quot;#dealSeckill Â∫ìÂ≠ò‰∏çË∂≥ÔºåÊó†Ê≥ïÁªßÁª≠ÁßíÊùÄÔºÅ&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (UnknownHostException e) &#123;<br>            log.error(e.getMessage(), e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-9-mapperÂ±Ç"><a href="#3-2-9-mapperÂ±Ç" class="headerlink" title="3.2.9 mapperÂ±Ç"></a>3.2.9 mapperÂ±Ç</h3><p><img src="/img/blogs/java/goodskill/3.2.12.png" srcset="/img/loading.gif" lazyload></p>
<p>Ëøô‰∏â‰∏™ Mapper Êé•Âè£ÊòØÂü∫‰∫é MyBatis-Plus ÁöÑÊï∞ÊçÆËÆøÈóÆÊé•Âè£ÔºåÂÆÉ‰ª¨ÂàÜÂà´ÂØπÂ∫îÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑ‰∏â‰∏™Ê†∏ÂøÉË°®Ôºö<strong>ÂïÜÂìÅË°®„ÄÅÁßíÊùÄÊ¥ªÂä®Ë°®„ÄÅÁßíÊùÄÊàêÂäüËÆ∞ÂΩïË°®</strong></p>
<ul>
<li><code>GoodsMapper</code>ÔºöÊìç‰Ωú<strong>ÂïÜÂìÅË°®</strong> goods ÁöÑÊï∞ÊçÆÂ∫ìÊé•Âè£</li>
<li><code>SeckillMapper</code>ÔºöÊìç‰Ωú<strong>ÁßíÊùÄÊ¥ªÂä®Ë°®</strong> seckill ÁöÑÊï∞ÊçÆÂ∫ìÊé•Âè£<ul>
<li>Êâ©Â±ï‰∫Ü‰∏§‰∏™Áî®‰∫éÂ∫ìÂ≠òÊâ£ÂáèÁöÑËá™ÂÆö‰πâ SQL ÊñπÊ≥ïÔºö<ul>
<li>ÊôÆÈÄöÁöÑ SQL Êâ£ÂáèÂ∫ìÂ≠òËØ≠Âè•</li>
<li>Âä†ÂÖ•‰∫Ü <strong>‰πêËßÇÈîÅÊéßÂà∂</strong>ÁöÑÊâ£ÂáèÊñπÂºèÔºàÈÄöËøá‰º†ÂÖ• number ‰øùËØÅÁâàÊú¨‰∏ÄËá¥ÊÄßÔºâ</li>
</ul>
</li>
</ul>
</li>
<li><code>SuccessKilledMapper</code>ÔºöÊìç‰Ωú<strong>ÁßíÊùÄÊàêÂäüËÆ∞ÂΩïË°®</strong> success_killed ÁöÑÊï∞ÊçÆÂ∫ìÊé•Âè£</li>
</ul>
<h3 id="3-2-10-mock-strategy"><a href="#3-2-10-mock-strategy" class="headerlink" title="3.2.10 mock.strategy"></a>3.2.10 mock.strategy</h3><p><img src="/img/blogs/java/goodskill/3.2.13.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="GoodsKillStrategy"><a href="#GoodsKillStrategy" class="headerlink" title="GoodsKillStrategy"></a>GoodsKillStrategy</h4><p>Êé•Âè£ GoodsKillStrategy ÊòØ‰∏Ä‰∏™ <strong>ÁßíÊùÄÁ≠ñÁï•Êé•Âè£</strong>ÔºåÁî®‰∫éÊîØÊåÅÁ≠ñÁï•Ê®°ÂºèÔºåÁõÆÁöÑÊòØÊ†πÊçÆ‰∏çÂêåÁöÑÁ≠ñÁï•ÔºåÊâßË°å‰∏çÂêåÁöÑ‚ÄúÁßíÊùÄÂ§ÑÁêÜÈÄªËæë‚Äù„ÄÇ</p>
<ul>
<li>ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Áªü‰∏ÄÁöÑ<strong>ÁßíÊùÄÂ§ÑÁêÜÊñπÊ≥ï</strong> execute(‚Ä¶)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÁßíÊùÄÁ≠ñÁï•Êé•Âè£</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊâßË°åÁßíÊùÄ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> requestDto ÁßíÊùÄËØ∑Ê±Ç</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Á≠ñÁï•1ÔºöAtomicUpdateStrategyÂéüÂ≠êÊõ¥Êñ∞Á≠ñÁï•"><a href="#Á≠ñÁï•1ÔºöAtomicUpdateStrategyÂéüÂ≠êÊõ¥Êñ∞Á≠ñÁï•" class="headerlink" title="Á≠ñÁï•1ÔºöAtomicUpdateStrategyÂéüÂ≠êÊõ¥Êñ∞Á≠ñÁï•"></a>Á≠ñÁï•1ÔºöAtomicUpdateStrategyÂéüÂ≠êÊõ¥Êñ∞Á≠ñÁï•</h4><p>ÂÆûÁé∞‰∫ÜÁßíÊùÄÁ≠ñÁï•Êé•Âè£ GoodsKillStrategy ÁöÑ‰∏ÄÁßçÂÖ∑‰ΩìÁ≠ñÁï•ÂÆûÁé∞ÔºåÂ±û‰∫é<strong>ÂéüÂ≠êÊõ¥Êñ∞Á≠ñÁï•</strong>ÔºàAtomic UpdateÔºâ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AtomicUpdateStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SeckillExecutor seckillExecutor;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        seckillExecutor.dealSeckill(requestDto.getSeckillId(), requestDto.getPhoneNumber(), ATOMIC_UPDATE.getName(), requestDto.getTaskId());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>AtomicUpdateStrategy Êõ¥Âº∫Ë∞ÉÔºö</p>
<ul>
<li>‰ΩøÁî® <strong>Êï∞ÊçÆÂ∫ì‰πêËßÇÈîÅÊú∫Âà∂ Êàñ ÂéüÂ≠êÊÄßÊõ¥Êñ∞ËØ≠Âè•</strong>ÔºàÂ¶Ç UPDATE ‚Ä¶ SET number &#x3D; number - 1 WHERE number &gt; 0Ôºâ</li>
<li>Êù•‰øùÈöúÈ´òÂπ∂ÂèëÁéØÂ¢É‰∏ãÁöÑ<strong>Êï∞ÊçÆ‰∏ÄËá¥ÊÄß‰∏éÂ∫ìÂ≠òÂÆâÂÖ®</strong></li>
</ul>
<h4 id="Á≠ñÁï•2ÔºöAtomicWithCanalStrategy"><a href="#Á≠ñÁï•2ÔºöAtomicWithCanalStrategy" class="headerlink" title="Á≠ñÁï•2ÔºöAtomicWithCanalStrategy"></a>Á≠ñÁï•2ÔºöAtomicWithCanalStrategy</h4><p>AtomicWithCanalStrategy ÊòØ‰∏Ä‰∏™ÁßíÊùÄÁ≠ñÁï•ÁöÑÂÖ∑‰ΩìÂÆûÁé∞Á±ªÔºåÁªìÂêà‰∫ÜÊï∞ÊçÆÂ∫ìÂéüÂ≠êÊÄßÊõ¥Êñ∞Êìç‰Ωú‰∏é**CanalÁõëÂê¨ binlogÔºàÊï∞ÊçÆÂ∫ìÂèòÊõ¥Êó•Âøó)**ÁöÑÊû∂ÊûÑÊÄùË∑ØÔºåÊù•ÂÆåÊàêÈ´òÂπ∂ÂèëÁßíÊùÄÁöÑÂ§ÑÁêÜ„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AtomicWithCanalStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> SeckillMapper seckillMapper;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> SuccessKilledMapper successKilledMapper;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StateMachineService stateMachineService;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Long, Object&gt; seckillIdList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">seckillId</span> <span class="hljs-operator">=</span> requestDto.getSeckillId();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> requestDto.getPhoneNumber();<br>        <span class="hljs-comment">// Ê≠§Â§ÑÂ∑≤‰ºòÂåñÔºåÈîÅÂçï‰∏™ÂïÜÂìÅËÄå‰∏çÊòØÊï¥‰∏™ÊñπÊ≥ï</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">seckillMonitor</span> <span class="hljs-operator">=</span> seckillIdList.get(seckillId);<br>        <span class="hljs-keyword">if</span> (seckillMonitor == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>            seckillIdList.put(seckillId, value);<br>        &#125;<br>        <span class="hljs-keyword">synchronized</span> (seckillIdList.get(seckillId)) &#123;<br>            <span class="hljs-type">Seckill</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> seckillMapper.selectById(seckillId);<br>            <span class="hljs-keyword">if</span> (seckill.getNumber() &gt; <span class="hljs-number">0</span>) &#123;<br>                seckillMapper.reduceNumber(seckillId, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                <span class="hljs-type">SuccessKilled</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuccessKilled</span>();<br>                record.setSeckillId(seckillId);<br>                record.setUserPhone(String.valueOf(userId));<br>                record.setStatus(<span class="hljs-number">1</span>);<br>                record.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                successKilledMapper.insert(record);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                stateMachineService.feedMachine(Events.ACTIVITY_CALCULATE, seckillId);<br>                <span class="hljs-keyword">if</span> (log.isDebugEnabled()) &#123;<br>                    log.debug(<span class="hljs-string">&quot;#execute Â∫ìÂ≠ò‰∏çË∂≥ÔºåÊó†Ê≥ïÁªßÁª≠ÁßíÊùÄÔºÅ&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Âú®ÁßíÊùÄÊó∂Ôºö</p>
<ol>
<li>Âà©Áî® <strong>Êï∞ÊçÆÂ∫ìÂ±ÇÁöÑÂéüÂ≠êÊõ¥Êñ∞Êìç‰ΩúÔºàSQLËØ≠Âè•Áõ¥Êé•ÂáèÂ∞ëÂ∫ìÂ≠òÔºâ</strong> Êù•Èò≤Ê≠¢Ë∂ÖÂçñ„ÄÇ</li>
<li>Âà©Áî® <strong>Â±ÄÈÉ®ÂêåÊ≠•ÈîÅÔºàÊåâÂïÜÂìÅ ID Âä†ÈîÅÔºâ</strong> Êù•ÊéßÂà∂Âπ∂Âèë„ÄÇ</li>
<li>Â∞ÜÁî®Êà∑ÁßíÊùÄÊàêÂäü‰ø°ÊÅØÊèíÂÖ•Êï∞ÊçÆÂ∫ìÔºàÂêéÁª≠ÂèØÈÄöËøá Canal ÁõëÂê¨ËØ•Ë°®ÁöÑ binlog ËøõË°åÂºÇÊ≠•Â§ÑÁêÜÔºåÊØîÂ¶ÇÂèëÊîæ‰ºòÊÉ†Âà∏„ÄÅÈÄöÁü•Áî®Êà∑Á≠âÔºâ„ÄÇ</li>
<li>Âú®Â∫ìÂ≠òËÄóÂ∞ΩÊó∂ÔºåÈÄöÁü•Áä∂ÊÄÅÊú∫ËøõÂÖ•‚ÄúÁªìÊùüËÆ°ÁÆó‚ÄùÁä∂ÊÄÅ„ÄÇ</li>
</ol>
<h4 id="Á≠ñÁï•3ÔºöRedisMongoReactiveStrategy"><a href="#Á≠ñÁï•3ÔºöRedisMongoReactiveStrategy" class="headerlink" title="Á≠ñÁï•3ÔºöRedisMongoReactiveStrategy"></a>Á≠ñÁï•3ÔºöRedisMongoReactiveStrategy</h4><p>RedisMongoReactiveStrategy Á±ªÁöÑÁ≠ñÁï•ÊòØÂ§ÑÁêÜÁßíÊùÄËØ∑Ê±ÇÁöÑÂºÇÊ≠•ÈÄªËæë„ÄÇÂÆÉ‰∏ªË¶ÅÈÄöËøá‰ª•‰∏ãÂá†‰∏™Ê≠•È™§Ôºö</p>
<ul>
<li>ÂºÇÊ≠•ÊâßË°åÁßíÊùÄËØ∑Ê±Ç„ÄÇ</li>
<li>‰ΩøÁî® Redis Êù•Âà§Êñ≠ÁßíÊùÄÂïÜÂìÅÂ∫ìÂ≠òÔºåÂπ∂ËøõË°åÂ¢ûÈáèÊìç‰Ωú„ÄÇ</li>
<li>Ëã•ÁßíÊùÄÊàêÂäüÔºåÂèëÈÄÅÊ∂àÊÅØÂà∞Ê∂àÊÅØ‰∏≠Èó¥‰ª∂ÔºåËøõË°å MongoDB ‰øùÂ≠òÊìç‰Ωú„ÄÇ</li>
<li>Ëã•ÁßíÊùÄÂ§±Ë¥•ÔºàÂ∫ìÂ≠ò‰∏çË∂≥ÔºâÔºåÈÄöËøáÁä∂ÊÄÅÊú∫Ê£ÄÊü•Ê¥ªÂä®Áä∂ÊÄÅÔºåÂπ∂ÂèëÈÄÅÁßíÊùÄÁªìÊùüÁöÑÊ∂àÊÅØ„ÄÇ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisMongoReactiveStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisService redisService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;<br>    <span class="hljs-meta">@Resource(name = &quot;taskExecutor&quot;)</span><br>    <span class="hljs-keyword">private</span> ThreadPoolExecutor taskExecutor;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StreamBridge streamBridge;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StateMachineService stateMachineService;<br>    <span class="hljs-comment">//ÂΩìÊî∂Âà∞ÁßíÊùÄËØ∑Ê±ÇÊó∂ÔºåÂÆÉ‰ºöÂ∞ÜËØ∑Ê±Ç‰∫§ÁªôÁ∫øÁ®ãÊ±† taskExecutor ÂºÇÊ≠•ÊâßË°å„ÄÇ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        taskExecutor.execute(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                doExecute(requestDto);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                log.error(<span class="hljs-string">&quot;ÁßíÊùÄÂ§±Ë¥•&quot;</span>, e);<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-comment">//ÊâßË°åÁßíÊùÄÈÄªËæëÁöÑ‰∏ªË¶ÅÊñπÊ≥ï</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doExecute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">seckillId</span> <span class="hljs-operator">=</span> requestDto.getSeckillId();<br>        <span class="hljs-type">Seckill</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> redisService.getSeckill(seckillId);<br>        <span class="hljs-keyword">if</span> (redisTemplate.opsForValue().increment(String.valueOf(seckillId)) &lt;= seckill.getNumber()) &#123;<br>            taskExecutor.execute(() -&gt;<br>                    streamBridge.send(DEFAULT_BINDING_NAME_MONGO_SAVE, MessageBuilder.withPayload(<br>                            SeckillMockSaveVo<br>                                    .builder()<br>                                    .seckillId(seckillId)<br>                                    .userPhone(requestDto.getPhoneNumber())<br>                                    .note(REDIS_MONGO_REACTIVE.getName())<br>                                    .build())<br>                            .build())<br>            );<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                seckill = redisService.getSeckill(seckillId);<br>                <span class="hljs-keyword">if</span> (stateMachineService.checkState(seckillId, States.IN_PROGRESS)) &#123;<br>                    stateMachineService.feedMachine(Events.ACTIVITY_CALCULATE, seckillId);<br>                    log.info(<span class="hljs-string">&quot;ÁßíÊùÄÂïÜÂìÅÊöÇÊó†Â∫ìÂ≠òÔºåÂèëÈÄÅÊ¥ªÂä®ÁªìÊùüÊ∂àÊÅØÔºÅ&quot;</span>);<br>                    streamBridge.send(DEFAULT_BINDING_NAME, MessageBuilder.withPayload(<br>                            SeckillMockResponseDTO<br>                                    .builder()<br>                                    .status(<span class="hljs-literal">true</span>)<br>                                    .seckillId(seckillId)<br>                                    .note(REDIS_MONGO_REACTIVE.getName())<br>                                    .taskId(requestDto.getTaskId())<br>                                    .build())<br>                            .build());<br>                    seckill.setStatus(SeckillStatusConstant.END);<br>                    redisService.putSeckill(seckill);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Á≠ñÁï•4ÔºöRedissonStrategy"><a href="#Á≠ñÁï•4ÔºöRedissonStrategy" class="headerlink" title="Á≠ñÁï•4ÔºöRedissonStrategy"></a>Á≠ñÁï•4ÔºöRedissonStrategy</h4><p>ÈÄöËøá<strong>ÂàÜÂ∏ÉÂºèÈîÅ Redisson ‰øùËØÅÂú®È´òÂπ∂Âèë‰∏ãÂØπÂêå‰∏Ä‰∏™ÂïÜÂìÅÁöÑÁßíÊùÄÊìç‰ΩúÊòØÁ∫øÁ®ãÂÆâÂÖ®</strong>ÁöÑÔºå<strong>ÈÅøÂÖçË∂ÖÂçñÈóÆÈ¢ò</strong>„ÄÇ</p>
<ul>
<li>RedissonStrategy ÊòØ‰∏ÄÁßç Âü∫‰∫é Redisson ÂàÜÂ∏ÉÂºèÈîÅÁöÑÁßíÊùÄÁ≠ñÁï•ÔºåÂÆÉÈÄöËøáÁªôÊØè‰∏™ÁßíÊùÄÂïÜÂìÅÂä†ÈîÅÊù•Á°Æ‰øùÂêå‰∏ÄÊó∂Èó¥Âè™ËÉΩÊúâ‰∏Ä‰∏™Á∫øÁ®ãÂ§ÑÁêÜÊüê‰∏™ÂïÜÂìÅÁöÑÁßíÊùÄÈÄªËæëÔºå‰ªéËÄåÂÆûÁé∞Âπ∂ÂèëÊéßÂà∂ÂíåÂ∫ìÂ≠ò‰∏ÄËá¥ÊÄß„ÄÇ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedissonClient redissonClient;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SeckillExecutor seckillExecutor;<br>    <br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    ‰∏∫ÂΩìÂâçÂïÜÂìÅËé∑Âèñ‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÈîÅÔºàÈîÅÂêç‰∏∫ÂïÜÂìÅ ID ÁöÑÂ≠óÁ¨¶‰∏≤Ôºâ„ÄÇ</span><br><span class="hljs-comment">    ‰ΩøÁî®ÁöÑÊòØ ÂèØÈáçÂÖ•ÈîÅ RLockÔºåÂ§ö‰∏™ËäÇÁÇπ‰∏ãÁöÑÂπ∂ÂèëÁî®Êà∑ÈÉΩ‰ºöÁ´û‰∫âËøô‰∏™ÈîÅÔºåÁ°Æ‰øùÂêå‰∏ÄÊó∂Èó¥Âè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËÉΩÊâßË°å‰∏ãÈù¢ÁöÑÈÄªËæë„ÄÇ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(requestDto.getSeckillId() + <span class="hljs-string">&quot;&quot;</span>);<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            seckillExecutor.dealSeckill(requestDto.getSeckillId(), requestDto.getPhoneNumber(), REDISSION_LOCK.getName(), requestDto.getTaskId());<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Á≠ñÁï•5ÔºöSentinelLimitStrategy"><a href="#Á≠ñÁï•5ÔºöSentinelLimitStrategy" class="headerlink" title="Á≠ñÁï•5ÔºöSentinelLimitStrategy"></a>Á≠ñÁï•5ÔºöSentinelLimitStrategy</h4><p>SentinelLimitStrategy ÊòØ‰∏Ä‰∏™Âü∫‰∫é <strong>Sentinel ÁöÑÈôêÊµÅÁ≠ñÁï•</strong>ÔºåÁî®‰∫éÂú®È´òÂπ∂ÂèëÂú∫ÊôØ‰∏ã‰øùÊä§Á≥ªÁªüËµÑÊ∫êÔºåÈò≤Ê≠¢ÁßíÊùÄÊé•Âè£Ë¢´ËøáËΩΩË∞ÉÁî®ÂØºËá¥Á≥ªÁªüÂ¥©Ê∫É„ÄÇÂÆÉÊòØ GoodsKillStrategy Êé•Âè£ÁöÑ‰∏Ä‰∏™ÂÆûÁé∞ÔºåÊ†∏ÂøÉÊòØ<strong>Âà©Áî® Sentinel ÂÅöÊµÅÈáèÊéßÂà∂ÔºàÈôêÊµÅÔºâ</strong>„ÄÇ</p>
<ul>
<li>ÈÄöËøá Sentinel ÂÆûÁé∞ÈôêÊµÅ‰øùÊä§Êú∫Âà∂ÔºåÈôêÂà∂ÊØèÁßíËøõÂÖ•ÁßíÊùÄÁ≥ªÁªüÁöÑËØ∑Ê±ÇÊï∞ÈáèÔºõ</li>
<li>‰∏ÄÊó¶ËØ∑Ê±ÇË∂ÖËøáÈòàÂÄºÔºåSentinel ‰ºöËß¶Âèë blockHandler ÊñπÊ≥ïÔºåËøõË°åÈôçÁ∫ßÂ§ÑÁêÜÔºåËÄå‰∏ç‰ºöÁªßÁª≠ÊâßË°åÁßíÊùÄÈÄªËæëÔºõ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SentinelLimitStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SeckillExecutor seckillExecutor;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@SentinelResource(value = &quot;limit&quot;, blockHandler = &quot;exceptionHandler&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        seckillExecutor.dealSeckill(requestDto.getSeckillId(), requestDto.getPhoneNumber(), ATOMIC_UPDATE.getName(), requestDto.getTaskId());<br>    &#125;<br><br>    <span class="hljs-comment">// Áõ∏ÂΩì‰∫é‰∏ÄÁßç‚ÄúÁÜîÊñ≠ÈôçÁ∫ßÂ§ÑÁêÜ‚ÄùÔºåÁ≥ªÁªüËøáËΩΩÊó∂ÊãíÁªùËØ∑Ê±ÇÔºåËÄå‰∏çÊòØËÆ©ÊúçÂä°ÂÆïÊú∫</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionHandler</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId, String userPhone, String note, BlockException ex)</span> &#123;<br>        log.error(<span class="hljs-string">&quot;Oops, error occurred at &#123;&#125;:&#123;&#125;:&#123;&#125;&quot;</span>, seckillId, userPhone, note, ex);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ÈÄöËøá Sentinel ÁöÑÊµÅÊéßËßÑÂàôÂØπÊåáÂÆöÊñπÊ≥ïÂÅöÈôêÊµÅ</li>
<li>Sentinel ÁöÑÈôêÊµÅÊòØÂü∫‰∫éÊªëÂä®Á™óÂè£ÁÆóÊ≥ïÂÆûÁé∞ÔºåÊÄßËÉΩÂºÄÈîÄ‰Ωé</li>
</ul>
<h4 id="Á≠ñÁï•6ÔºöSynchronizedLockStrategy"><a href="#Á≠ñÁï•6ÔºöSynchronizedLockStrategy" class="headerlink" title="Á≠ñÁï•6ÔºöSynchronizedLockStrategy"></a>Á≠ñÁï•6ÔºöSynchronizedLockStrategy</h4><p>ÈááÁî®ÁöÑÊòØÊúÄ‰º†ÁªüÁöÑ Java Êú¨Âú∞ÈîÅ synchronized ÂÖ≥ÈîÆÂ≠óÊù•ÊéßÂà∂Âπ∂ÂèëÊìç‰ΩúÔºåÈò≤Ê≠¢ÁßíÊùÄË∂ÖÂçñ„ÄÇ</p>
<p>ÂÆÉÁöÑÊ†∏ÂøÉÊÄùÊÉ≥ÊòØÔºö<strong>ÂØπÊØè‰∏™ÂïÜÂìÅ ID Âª∫Á´ã‰∏Ä‰∏™ÁõëËßÜÂØπË±°</strong>ÔºàObjectÔºâÔºåÁÑ∂Âêé<strong>Áî® synchronized ÂÖ≥ÈîÆÂ≠óÂØπËøô‰∏™ÂïÜÂìÅÂä†ÈîÅ</strong>Ôºå<strong>ÂÆûÁé∞ÂçïÂïÜÂìÅÁöÑÂπ∂ÂèëÊéßÂà∂</strong>„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedLockStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SeckillMapper seckillMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SuccessKilledMapper successKilledMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StreamBridge streamBridge;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StateMachineService stateMachineService;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Long, Object&gt; seckillIdList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">seckillId</span> <span class="hljs-operator">=</span> requestDto.getSeckillId();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> requestDto.getPhoneNumber();<br>        <span class="hljs-comment">// Ê≠§Â§ÑÂ∑≤‰ºòÂåñÔºåÈîÅÂçï‰∏™ÂïÜÂìÅËÄå‰∏çÊòØÊï¥‰∏™ÊñπÊ≥ï</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">seckillMonitor</span> <span class="hljs-operator">=</span> seckillIdList.get(seckillId);<br>        <span class="hljs-keyword">if</span> (seckillMonitor == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>            seckillIdList.put(seckillId, value);<br>        &#125;<br>        <span class="hljs-keyword">synchronized</span> (seckillIdList.get(seckillId)) &#123;<br>            <span class="hljs-type">Seckill</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> seckillMapper.selectById(seckillId);<br>            <span class="hljs-keyword">if</span> (seckill.getNumber() &gt; <span class="hljs-number">0</span>) &#123;<br>                seckillMapper.reduceNumber(seckillId, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                <span class="hljs-type">SuccessKilled</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuccessKilled</span>();<br>                record.setSeckillId(seckillId);<br>                record.setUserPhone(String.valueOf(userId));<br>                record.setStatus(<span class="hljs-number">1</span>);<br>                record.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                successKilledMapper.insert(record);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">if</span> (stateMachineService.checkState(seckillId, States.IN_PROGRESS)) &#123;<br>                    stateMachineService.feedMachine(Events.ACTIVITY_CALCULATE, seckillId);<br>                    streamBridge.send(DEFAULT_BINDING_NAME, MessageBuilder.withPayload(<br>                                    SeckillMockResponseDTO<br>                                            .builder()<br>                                            .seckillId(seckillId)<br>                                            .status(<span class="hljs-literal">true</span>)<br>                                            .note(SYCHRONIZED.getName())<br>                                            .taskId(requestDto.getTaskId())<br>                                            .build())<br>                            .build());<br>                &#125;<br>                <span class="hljs-keyword">if</span> (log.isDebugEnabled()) &#123;<br>                    log.debug(<span class="hljs-string">&quot;Â∫ìÂ≠ò‰∏çË∂≥ÔºåÊó†Ê≥ïÁªßÁª≠ÁßíÊùÄÔºÅ&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<ul>
<li>SynchronizedLockStrategy ÊòØ‰∏ÄÁßçÂü∫‰∫é Java Êú¨Âú∞ÈîÅ„ÄÅÊåâÂïÜÂìÅÁ≤íÂ∫¶Âä†ÈîÅÁöÑÁßíÊùÄÁ≠ñÁï•ÔºåÈÄÇÁî®‰∫éÂçïÊú∫È°πÁõÆÔºåÁÆÄÂçïÊòìÂÆûÁé∞Ôºå‰ΩÜ‰∏çÈÄÇÂêàÂ§öËäÇÁÇπÈÉ®ÁΩ≤„ÄÇ</li>
</ul>
<h4 id="Á≠ñÁï•7ÔºöZookeeperLockStrategy"><a href="#Á≠ñÁï•7ÔºöZookeeperLockStrategy" class="headerlink" title="Á≠ñÁï•7ÔºöZookeeperLockStrategy"></a>Á≠ñÁï•7ÔºöZookeeperLockStrategy</h4><p><strong>Âü∫‰∫é Zookeeper ÂàÜÂ∏ÉÂºèÈîÅÁöÑÁßíÊùÄÁ≠ñÁï•</strong>„ÄÇÂÆÉÈÄöËøá Apache Curator Êèê‰æõÁöÑ InterProcessMutexÔºàÂàÜÂ∏ÉÂºèÂèØÈáçÂÖ•ÈîÅÔºâÊù•ÊéßÂà∂ÂØπÁßíÊùÄÂïÜÂìÅÁöÑÂπ∂ÂèëËÆøÈóÆÔºåÁ°Æ‰øùÂú®ÂàÜÂ∏ÉÂºèÈÉ®ÁΩ≤ÁéØÂ¢É‰∏ãÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÂíåÁ∫øÁ®ãÂÆâÂÖ®„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZookeeperLockStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> ZookeeperLockUtil zookeeperLockUtil;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> SeckillExecutor seckillExecutor;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@SneakyThrows</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">seckillId</span> <span class="hljs-operator">=</span> requestDto.getSeckillId();<br>        <span class="hljs-type">InterProcessMutex</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> zookeeperLockUtil.lock(seckillId);<br>        <span class="hljs-keyword">if</span> (lock != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                seckillExecutor.dealSeckill(seckillId, requestDto.getPhoneNumber(), ZOOKEEPER_LOCK.getName(), requestDto.getTaskId());<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                lock.release();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<ul>
<li>Êèê‰æõÁöÑ‰∏ÄÁßç <strong>ÂèØÈáçÂÖ•„ÄÅÈòªÂ°ûÂºèÂàÜÂ∏ÉÂºèÈîÅ</strong>ÂÆûÁé∞</li>
<li>‰øùËØÅÂú®Â§ö‰∏™ÊúçÂä°ËäÇÁÇπ‰∏≠ÔºåÊüê‰∏ÄÊó∂ÂàªÂè™Êúâ‰∏Ä‰∏™ËäÇÁÇπÂèØ‰ª•Ëé∑ÂæóÈîÅÊù•Êìç‰ΩúËØ•ÂïÜÂìÅ„ÄÇ</li>
<li>ÊúÄÂêéÈáäÊîæÈîÅÔºåÊó†ËÆ∫ÊâßË°åÊàêÂäü‰∏éÂê¶Ôºå<strong>ÂøÖÈ°ªÈáäÊîæÈîÅÈò≤Ê≠¢Ê≠ªÈîÅ</strong>„ÄÇ</li>
</ul>
<h3 id="3-2-11-mq"><a href="#3-2-11-mq" class="headerlink" title="3.2.11 mq"></a>3.2.11 mq</h3><p><img src="/img/blogs/java/goodskill/3.2.14.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="SeckillKafkaConsumer"><a href="#SeckillKafkaConsumer" class="headerlink" title="SeckillKafkaConsumer"></a>SeckillKafkaConsumer</h4><p><strong>Âü∫‰∫é Kafka Ê∂àÊÅØÈòüÂàóÁöÑÊ∂àË¥πËÄÖÁªÑ‰ª∂</strong>ÔºåÁî®‰∫é<strong>ÂºÇÊ≠•Â§ÑÁêÜÁßíÊùÄËØ∑Ê±Ç</strong>„ÄÇÂÆÉÁõëÂê¨Âêç‰∏∫ ‚Äúgoodskill-kafka‚Äù ÁöÑ Kafka ‰∏ªÈ¢òÔºåÊé•Êî∂Âà∞ÁßíÊùÄÊ∂àÊÅØÂêéÔºåË∞ÉÁî®Ê†∏ÂøÉ‰∏öÂä°Â§ÑÁêÜÁ±ª SeckillExecutor ÊâßË°åÂÖ∑‰ΩìÁöÑÁßíÊùÄÊìç‰Ωú„ÄÇ<br>SeckillKafkaConsumer ÊòØ‰∏Ä‰∏™ Kafka Ê∂àË¥πËÄÖÁ±ªÔºå‰∏ªË¶ÅÁî®‰∫éÊé•Êî∂ÂºÇÊ≠•ÁßíÊùÄËØ∑Ê±ÇÊ∂àÊÅØÔºåËß£ÂåÖÂêéË∞ÉÁî®ÂÆûÈôÖÁöÑÁßíÊùÄÂ§ÑÁêÜÈÄªËæëÔºåÂÆûÁé∞‚ÄúÂâäÂ≥∞Â°´Ë∞∑‚ÄùÔºåÊúâÊïàÁºìËß£È´òÂπ∂ÂèëÂ∏¶Êù•ÁöÑÁ≥ªÁªüÂéãÂäõ„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillKafkaConsumer</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SeckillExecutor seckillExecutor;<br><br>    <span class="hljs-meta">@KafkaListener(topics = &quot;goodskill-kafka&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(Object data)</span> &#123;<br>        <span class="hljs-keyword">if</span> (data <span class="hljs-keyword">instanceof</span> ConsumerRecord record) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">userPhone</span> <span class="hljs-operator">=</span> record.key().toString();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (String) record.value();<br>            SeckillMockRequestDTO seckillMockRequestDTO;<br>            <span class="hljs-keyword">if</span> (StringUtils.hasText(value)) &#123;<br>                seckillMockRequestDTO = JSON.parseObject(value, SeckillMockRequestDTO.class);<br>                seckillExecutor.dealSeckill(seckillMockRequestDTO.getSeckillId(), userPhone, <span class="hljs-string">&quot;ÁßíÊùÄÂú∫ÊôØÂõõ(kafkaÊ∂àÊÅØÈòüÂàóÂÆûÁé∞)&quot;</span>, seckillMockRequestDTO.getTaskId());<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            log.warn(<span class="hljs-string">&quot;Êú™Â§ÑÁêÜÊï∞ÊçÆÔºö&#123;&#125;&quot;</span>, data.toString());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="StreamMessageConsumer"><a href="#StreamMessageConsumer" class="headerlink" title="StreamMessageConsumer"></a>StreamMessageConsumer</h4><p>StreamMessageConsumer ÊòØ‰∏Ä‰∏™ Âü∫‰∫é Spring Cloud Stream ÁöÑ<strong>Ê∂àÊÅØÊ∂àË¥πËÄÖÈÖçÁΩÆÁ±ª</strong>ÔºåÁî®‰∫é<strong>Â§ÑÁêÜÊù•Ëá™Ê∂àÊÅØ‰∏≠Èó¥‰ª∂</strong>ÔºàÂ¶Ç RabbitMQ„ÄÅKafka„ÄÅRocketMQ Á≠âÔºâÁöÑ<strong>ÁßíÊùÄËØ∑Ê±ÇÊ∂àÊÅØ</strong>„ÄÇÂÆÉÂ∞ÜÊé•Êî∂Âà∞ÁöÑ SeckillMockRequestDTO Á±ªÂûãÊ∂àÊÅØ‰∫§Áî± SeckillExecutor ÊâßË°åÔºå‰ªéËÄåÂÆåÊàêÂºÇÊ≠•„ÄÅËß£ËÄ¶ÁöÑÁßíÊùÄÊìç‰Ωú„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamMessageConsumer</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(StreamMessageConsumer.class);<br><br>    <span class="hljs-keyword">private</span> SeckillExecutor seckillExecutor;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSeckillExecutor</span><span class="hljs-params">(SeckillExecutor seckillExecutor)</span> &#123;<br>        <span class="hljs-built_in">this</span>.seckillExecutor = seckillExecutor;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Consumer&lt;SeckillMockRequestDTO&gt; <span class="hljs-title function_">seckill</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span>  (payload) -&gt; &#123;<br>            log.info(<span class="hljs-string">&quot;Êî∂Âà∞ÁßíÊùÄËØ∑Ê±Ç:&#123;&#125;&quot;</span>, payload);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">userPhone</span> <span class="hljs-operator">=</span> payload.getPhoneNumber();<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">seckillId</span> <span class="hljs-operator">=</span> payload.getSeckillId();<br>            seckillExecutor.dealSeckill(seckillId, userPhone, SeckillSolutionEnum.RABBIT_MQ.name(), payload.getTaskId());<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-12-pojo"><a href="#3-2-12-pojo" class="headerlink" title="3.2.12 pojo"></a>3.2.12 pojo</h3><p><img src="/img/blogs/java/goodskill/3.2.15.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li><code>ResponseDTO&lt;T&gt;</code><br>ÈÄöÁî®ÂìçÂ∫îÂ∞ÅË£ÖÁ±ªÔºåÁî®‰∫éÂú®Á≥ªÁªü‰∏≠<strong>Áªü‰∏ÄËøîÂõûÁªìÊûúÊ†ºÂºè</strong>Ôºå‰æø‰∫éÂâçÂêéÁ´Ø‰∫§‰∫íÊó∂ÁöÑÊï∞ÊçÆÁªìÊûÑ‰∏ÄËá¥ÊÄßÂíåÂ§ÑÁêÜÁªü‰∏ÄÊÄß„ÄÇ‰Ω†ÂèØ‰ª•ÁêÜËß£‰∏∫ËøôÊòØ‰∏Ä‰∏™ÂâçÂêéÁ´ØÈÄö‰ø°ÁöÑ‚ÄúÊ†áÂáÜËøîÂõûÊ®°Êùø‚Äù„ÄÇ<br>ResponseDTO<T> Áî®‰∫éÂåÖË£ÖÊé•Âè£ÁöÑËøîÂõûÊï∞ÊçÆÔºåÊîØÊåÅÊê∫Â∏¶Ôºö</li>
</ol>
<ul>
<li>Áä∂ÊÄÅÁ†ÅÔºàcodeÔºâ</li>
<li>ÊèêÁ§∫‰ø°ÊÅØÔºàmsgÔºâ</li>
<li>ÊÄªËÆ∞ÂΩïÊï∞ÔºàcountÔºâ</li>
<li>ÂÆûÈôÖËøîÂõûÁöÑÊï∞ÊçÆÊï∞ÁªÑÔºàdataÔºâ</li>
</ul>
<p><strong>ÂÆÉÂèØ‰ª•Áªü‰∏ÄË°®Á§∫ÊàêÂäüÊàñÂ§±Ë¥•ÁöÑÂìçÂ∫îÁªìÊûú</strong></p>
<ol start="2">
<li><code>PageVO&lt;T&gt;</code><br>PageVO<T> ÊòØ‰∏Ä‰∏™<strong>ÈÄöÁî®ÂàÜÈ°µÁªìÊûúÂØπË±°</strong>ÔºåÁî®‰∫éÁªü‰∏ÄÂ∞ÅË£ÖÂàÜÈ°µÊé•Âè£ÁöÑËøîÂõûÁªìÊûúÔºåÂåÖÊã¨Ôºö</li>
</ol>
<ul>
<li>ÊÄªËÆ∞ÂΩïÊï∞ total</li>
<li>ÂΩìÂâçÈ°µÁöÑÊï∞ÊçÆÈ°π items</li>
</ul>
<ol start="3">
<li><code>UserVO</code>Áî®Êà∑ËßÜÂõæÂØπË±°<br>UserVO ÊòØÁî®Êù•Ë°®Á§∫<strong>Áî®Êà∑‰ø°ÊÅØÁöÑÂ±ïÁ§∫Ê®°Âûã</strong>ÔºåÈÄöÂ∏∏ÊòØÊé•Âè£ËøîÂõûÁî®Êà∑‰ø°ÊÅØÊó∂‰ΩøÁî®ÁöÑÁªìÊûÑÔºåÊòØ‰ªéÊï∞ÊçÆÂ∫ìÂÆû‰Ωì UserÔºàÊàñÁ±ª‰ººË°®ÔºâËΩ¨Êç¢ËÄåÊù•</li>
</ol>
<h3 id="3-2-13-util"><a href="#3-2-13-util" class="headerlink" title="3.2.13 util"></a>3.2.13 util</h3><p><img src="/img/blogs/java/goodskill/3.2.16.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="StateMachineService"><a href="#StateMachineService" class="headerlink" title="StateMachineService"></a>StateMachineService</h4><p>ÈÄöËøá Spring StateMachine <strong>ÁÆ°ÁêÜÊØè‰∏Ä‰∏™ÁßíÊùÄÊ¥ªÂä®ÁöÑÁä∂ÊÄÅÁîüÂëΩÂë®Êúü</strong>Ôºå<br>Áî®Êù•ÂçèË∞ÉÂïÜÂìÅÂú®‰∏çÂêåÁä∂ÊÄÅ‰∏ãÁöÑË°å‰∏∫ÔºàÊØîÂ¶ÇËøõË°å‰∏≠„ÄÅÂ∑≤ÁªìÊùüÁ≠âÔºâÔºåÂπ∂‰∏îÈÄöËøá Redis ÂÆûÁé∞Áä∂ÊÄÅÊåÅ‰πÖÂåñÂíåË∑®ÊúçÂä°ÂÖ±‰∫´„ÄÇ</p>
<p>ËØ•Á±ªÊòØ‰∏Ä‰∏™ <strong>Áä∂ÊÄÅÊú∫ÁÆ°ÁêÜÊúçÂä°ÁªÑ‰ª∂</strong>Ôºå‰∏∫ÊØè‰∏™ÁßíÊùÄÊ¥ªÂä®Ôºà‰ª• seckillId Âå∫ÂàÜÔºâÁª¥Êä§‰∏Ä‰∏™Áã¨Á´ãÁöÑÁä∂ÊÄÅÊú∫ÂÆû‰æã„ÄÇÊèê‰æõ‰ª•‰∏ãÂäüËÉΩÔºö</p>
<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>‰ΩúÁî®</th>
</tr>
</thead>
<tbody><tr>
<td>feedMachine()</td>
<td>ËæìÂÖ•‰∏Ä‰∏™‰∫ã‰ª∂ÔºåÈ©±Âä®Áä∂ÊÄÅÂèòÂåñ, ÁªôÁä∂ÊÄÅÊú∫ÂèëÈÄÅ‰∫ã‰ª∂ÔºåÈ©±Âä®Áä∂ÊÄÅÊµÅËΩ¨</td>
</tr>
<tr>
<td>checkState()</td>
<td>Ê£ÄÊü•ÊåáÂÆöÊ¥ªÂä®ÊòØÂê¶Â§Ñ‰∫éÊüê‰∏™Áä∂ÊÄÅ</td>
</tr>
<tr>
<td>initStateMachine()</td>
<td>ÂàùÂßãÂåñÊüê‰∏™Ê¥ªÂä®ÁöÑÁä∂ÊÄÅÊú∫ÔºåÂπ∂ÊåÅ‰πÖÂåñ</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateMachineService</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">STATEMACHINE_REDIS_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;seckillId:&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, StateMachine&lt;States, Events&gt;&gt; stateMachineMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StateMachineFactory&lt;States, Events&gt; stateMachineFactory;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StateMachinePersister&lt;States, Events, String&gt; stateMachinePersister;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂêëÁä∂ÊÄÅÊú∫‰∏≠ËæìÂÖ•‰∫ã‰ª∂ÔºåÁî®‰∫éÂ§ÑÁêÜÊ¥ªÂä®‰∫ã‰ª∂ÁöÑÊñπÊ≥ï</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> e           ÂæÖÂ§ÑÁêÜÁöÑÊ¥ªÂä®‰∫ã‰ª∂</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@SneakyThrows</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">feedMachine</span><span class="hljs-params">(Events e, <span class="hljs-type">long</span> seckillId)</span> &#123;<br>        StateMachine&lt;States, Events&gt; stateMachine = stateMachineMap.get(String.valueOf(seckillId));<br>        stateMachinePersister.restore(stateMachine, STATEMACHINE_REDIS_KEY_PREFIX + seckillId);<br>        StateMachineEventResult&lt;States, Events&gt; eventResult =<br>                stateMachine.sendEvent(Mono.just(MessageBuilder.withPayload(e).build())).blockLast();<br>        log.info(<span class="hljs-string">&quot;eventResult:&#123;&#125;&quot;</span>, eventResult);<br>        stateMachinePersister.persist(stateMachine, STATEMACHINE_REDIS_KEY_PREFIX + seckillId);<br>        <span class="hljs-keyword">return</span> eventResult != <span class="hljs-literal">null</span> &amp;&amp; StateMachineEventResult.ResultType.ACCEPTED.equals(eventResult.getResultType());<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê£ÄÊü•ÁßíÊùÄÊ¥ªÂä®ÁöÑÁä∂ÊÄÅÊòØÂê¶Á¨¶ÂêàË¶ÅÊ±Ç</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillId ÁßíÊùÄÊ¥ªÂä®ÁöÑID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> state     ÊåáÂÆöÁöÑÁä∂ÊÄÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Â¶ÇÊûúÂΩìÂâçÁä∂ÊÄÅ‰∏éstateÁõ∏ÂêåÂàôËøîÂõûtrueÔºåÂê¶ÂàôËøîÂõûfalse</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@SneakyThrows</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkState</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId, States state)</span> &#123;<br>        StateMachine&lt;States, Events&gt; stateMachine = stateMachineMap.get(String.valueOf(seckillId));<br>        stateMachinePersister.restore(stateMachine, STATEMACHINE_REDIS_KEY_PREFIX + seckillId);<br>        <span class="hljs-keyword">return</span> stateMachine.getState().getId().equals(state);<br>    &#125;<br><br>    <span class="hljs-meta">@SneakyThrows</span><br>    <span class="hljs-keyword">public</span> StateMachine&lt;States, Events&gt; <span class="hljs-title function_">initStateMachine</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        StateMachine&lt;States, Events&gt; stateMachine = stateMachineFactory.getStateMachine();<br>        stateMachinePersister.persist(stateMachine, STATEMACHINE_REDIS_KEY_PREFIX + seckillId);<br>        <span class="hljs-keyword">return</span> stateMachineMap.putIfAbsent(String.valueOf(seckillId), stateMachine);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>StateMachineService ÊòØ‰∏Ä‰∏™Âü∫‰∫é Spring StateMachine ÂÆûÁé∞ÁöÑ<strong>Ê¥ªÂä®Áä∂ÊÄÅÁÆ°ÁêÜ‰∏≠ÂøÉ</strong>ÔºåÊØè‰∏™ÂïÜÂìÅÁßíÊùÄÊ¥ªÂä®ÈÉΩÊúâËá™Â∑±Áã¨Á´ãÁöÑÁä∂ÊÄÅÊµÅËΩ¨ËøáÁ®ãÔºàÂºÄÂßã„ÄÅËøõË°å‰∏≠„ÄÅÁªìÊùüÔºâÔºåËøô‰∏™Á±ªË¥üË¥£‰∫ã‰ª∂È©±Âä®„ÄÅÁä∂ÊÄÅÂà§Êñ≠ÂíåÊåÅ‰πÖÂåñÊìç‰ΩúÔºåÁ°Æ‰øùÁ≥ªÁªüÂú®Âπ∂Âèë‰∏ã‰ªçËÉΩÂèØÈù†Âú∞ËøõË°åÁßíÊùÄÊµÅÁ®ãÊéßÂà∂„ÄÇ</p>
<h4 id="UploadFileUtil"><a href="#UploadFileUtil" class="headerlink" title="UploadFileUtil"></a>UploadFileUtil</h4><p>Â∞ÅË£Ö‰∫Ü‰∏Ä‰∏™ MinIO ÂÆ¢Êà∑Á´ØÁöÑÊñá‰ª∂‰∏ä‰º†Â∑•ÂÖ∑Á±ªÔºåÊèê‰æõ‰∫ÜÂ∞ÜÊñá‰ª∂ÔºàÈÄöÂ∏∏ÊòØÂâçÁ´Ø‰∏ä‰º†ÁöÑÂõæÁâá„ÄÅËßÜÈ¢ë„ÄÅÊñáÊ°£Á≠âÔºâ‰∏ä‰º†Ëá≥ MinIO ÂØπË±°Â≠òÂÇ®ÊúçÂä°ÁöÑÂäüËÉΩÔºåÂπ∂ËøîÂõûËÆøÈóÆÂú∞ÂùÄ„ÄÇ</p>
<ul>
<li>UploadFileUtil ÊòØ‰∏Ä‰∏™<strong>‰∏ä‰º†Êñá‰ª∂Âà∞ MinIO Âπ∂ËøîÂõûÊñá‰ª∂ URL ÁöÑÂ∑•ÂÖ∑Á±ª</strong>„ÄÇ</li>
</ul>
<h4 id="ZookeeperLockUtil"><a href="#ZookeeperLockUtil" class="headerlink" title="ZookeeperLockUtil"></a>ZookeeperLockUtil</h4><p><strong>Êèê‰æõÂü∫‰∫é ZooKeeper ÁöÑÂàÜÂ∏ÉÂºèÈîÅÂäüËÉΩ</strong>Ôºå‰ΩøÁî® Curator Ê°ÜÊû∂ÂÆûÁé∞ÂàÜÂ∏ÉÂºèÈîÅÁöÑËé∑ÂèñÂíåÈáäÊîæÔºå‰ª•‰øùËØÅÂú®ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ãÔºåÁßíÊùÄÊ¥ªÂä®Á≠âÂπ∂ÂèëÂú∫ÊôØ‰∏≠ÁöÑËµÑÊ∫êÔºàÂ¶ÇÂ∫ìÂ≠òÔºâËÉΩÂ§üË¢´ÊúâÊïàÊéßÂà∂ÂíåÂçèË∞É</p>
<ul>
<li>Áî®‰∫éÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏≠ÊéßÂà∂ÂØπÊüê‰∏™ËµÑÊ∫êÔºàÂ¶ÇÁßíÊùÄÂïÜÂìÅÂ∫ìÂ≠òÔºâÁöÑËÆøÈóÆÔºåÁ°Æ‰øùÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ã&#x2F;ËøõÁ®ãËÉΩÂú®Âêå‰∏ÄÊó∂ÂàªÂØπÂÖ∂ËøõË°åÊìç‰Ωú</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZookeeperLockUtil</span> &#123;<br><br>    <span class="hljs-keyword">private</span> CuratorFramework client;<br>    <span class="hljs-meta">@Value(&quot;$&#123;zookeeper_ip&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String zookeeperIp;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÈááÁî®curatorÊèê‰æõÁöÑ‰∫íÊñ•ÈîÅËé∑ÂèñÈîÅÊñπÊ≥ï</span><br><span class="hljs-comment">     * ÈááÁî®Á∫øÁ®ãÊú¨Âú∞ÂèòÈáèÁöÑÊñπÊ≥ïËß£ÂÜ≥Âπ∂ÂèëÈóÆÈ¢ò</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> seckillId ÁßíÊùÄid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true Âä†ÈîÅÊàêÂäü</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> InterProcessMutex <span class="hljs-title function_">lock</span><span class="hljs-params">(<span class="hljs-type">long</span> seckillId)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">rootLockPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/goodskill&quot;</span>;<br>            <span class="hljs-type">InterProcessMutex</span> <span class="hljs-variable">interProcessMutex</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterProcessMutex</span>(client, rootLockPath + <span class="hljs-string">&quot;/&quot;</span> + seckillId);<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">acquire</span> <span class="hljs-operator">=</span> interProcessMutex.acquire(<span class="hljs-number">1000L</span>, TimeUnit.MILLISECONDS);<br>            <span class="hljs-keyword">if</span> (acquire) &#123;<br>                log.info(<span class="hljs-string">&quot;ÊàêÂäüËé∑ÂèñÂà∞zkÈîÅ,ÁßíÊùÄid&#123;&#125;&quot;</span>, seckillId);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                log.info(<span class="hljs-string">&quot;Êú™Ëé∑ÂèñÂà∞zkÈîÅ,ÁßíÊùÄid&#123;&#125;&quot;</span>, seckillId);<br>            &#125;<br>            <span class="hljs-keyword">return</span> interProcessMutex;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.warn(<span class="hljs-string">&quot;Ëé∑ÂèñzkÈîÅÂºÇÂ∏∏:&#123;&#125;&quot;</span>, e.getMessage());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initClient</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ÂàùÂßãÂåñCuratorÂÆ¢Êà∑Á´Ø</span><br>        <span class="hljs-type">RetryPolicy</span> <span class="hljs-variable">retryPolicy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExponentialBackoffRetry</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">3</span>);<br>        <span class="hljs-built_in">this</span>.client = CuratorFrameworkFactory.newClient(zookeeperIp, retryPolicy);<br>        client.start();<br>    &#125;<br><br>    <span class="hljs-meta">@PreDestroy</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopLocal</span><span class="hljs-params">()</span> &#123;<br>        client.close();<br>        log.info(<span class="hljs-string">&quot;zkClientÂ∑≤ÂÖ≥Èó≠&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ZookeeperLockUtil</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-14-SeckillApplicationÁßíÊùÄÊúçÂä°ÂêØÂä®Á±ª"><a href="#3-2-14-SeckillApplicationÁßíÊùÄÊúçÂä°ÂêØÂä®Á±ª" class="headerlink" title="3.2.14 SeckillApplicationÁßíÊùÄÊúçÂä°ÂêØÂä®Á±ª"></a>3.2.14 SeckillApplicationÁßíÊùÄÊúçÂä°ÂêØÂä®Á±ª</h3><p>Ëøô‰∏™Á±ªÊòØ Spring Boot Â∫îÁî®ÁöÑÂêØÂä®Á±ªÔºåÈÄöËøá‰ª•‰∏ãÊñπÂºèÊù•ÈÖçÁΩÆÂíåÂêØÂä®Â∫îÁî®Ôºö</p>
<ol>
<li>ÂêØÂä® Spring Boot Â∫îÁî®„ÄÇ</li>
<li>ÂêØÁî®Ëá™Âä®ÈÖçÁΩÆ„ÄÅ‰∫ãÂä°ÁÆ°ÁêÜ„ÄÅMyBatis Mapper Êâ´Êèè„ÄÅÊúçÂä°ÂèëÁé∞ÔºàÂ¶Ç EurekaÔºâ„ÄÅFeign ÂÆ¢Êà∑Á´ØÁ≠âÂäüËÉΩ„ÄÇ</li>
<li>ÂÆö‰πâ‰∫Ü REST API ÊéßÂà∂Âô®ÔºåËÉΩÂ§üÂ§ÑÁêÜ HTTP ËØ∑Ê±ÇÂπ∂ËøîÂõûÂìçÂ∫î„ÄÇ</li>
<li>‰ΩøÁî® Lombok Ëá™Âä®ÁîüÊàêÊó•ÂøóÂäüËÉΩ</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication(scanBasePackages = &#123;</span><br><span class="hljs-meta">        &quot;com.goodskill.service&quot;,</span><br><span class="hljs-meta">        &quot;com.goodskill.core&quot;,</span><br><span class="hljs-meta">        &quot;com.goodskill.order.api&quot;,</span><br><span class="hljs-meta">&#125;)</span><br><span class="hljs-meta">@EnableTransactionManagement</span><br><span class="hljs-meta">@MapperScan(&quot;com.goodskill.service.mapper&quot;)</span><br><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-meta">@EnableFeignClients(&#123;&quot;com.goodskill.order.api&quot;&#125;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">SpringApplication</span> <span class="hljs-variable">application</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplication</span>(SeckillApplication.class);<br>        application.setBannerMode(Banner.Mode.CONSOLE);<br>        application.run(args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-15-application-yml"><a href="#3-2-15-application-yml" class="headerlink" title="3.2.15 application.yml"></a>3.2.15 application.yml</h3><p>ÂåÖÂê´‰ª•‰∏ãÈÖçÁΩÆÔºö</p>
<ul>
<li>ÊúçÂä°Á´ØÂè£ÂíåÂ∫îÁî®‰ø°ÊÅØ„ÄÇ</li>
<li>Êï∞ÊçÆÂ∫ìËøûÊé•ÈÖçÁΩÆÔºåÂ¶Ç MySQL Âíå Redis„ÄÇ</li>
<li>Spring Cloud ÂíåÊ∂àÊÅØÊµÅÈÖçÁΩÆÔºåÂåÖÊã¨ Nacos„ÄÅKafka„ÄÅRabbitMQ„ÄÇ</li>
<li>ÂàÜÂ∏ÉÂºè‰∫ãÂä° ÈÖçÁΩÆÔºàSeataÔºâÂíå Dubbo ÈÖçÁΩÆ„ÄÇ</li>
<li>Flyway Âíå Feign ÈÖçÁΩÆ„ÄÇ</li>
</ul>
<h1 id="4-goodskill-web-Êèê‰æõÁßíÊùÄÊ®°ÊãüÊé•Âè£ËÆøÈóÆ"><a href="#4-goodskill-web-Êèê‰æõÁßíÊùÄÊ®°ÊãüÊé•Âè£ËÆøÈóÆ" class="headerlink" title="4. goodskill-web (Êèê‰æõÁßíÊùÄÊ®°ÊãüÊé•Âè£ËÆøÈóÆ)"></a>4. goodskill-web (Êèê‰æõÁßíÊùÄÊ®°ÊãüÊé•Âè£ËÆøÈóÆ)</h1><p><img src="/img/blogs/java/goodskill/4.1.1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="4-1-configÂåÖ"><a href="#4-1-configÂåÖ" class="headerlink" title="4.1 configÂåÖ"></a>4.1 configÂåÖ</h2><ul>
<li>GlobalExceptionHandler</li>
</ul>
<h4 id="GlobalExceptionHandler"><a href="#GlobalExceptionHandler" class="headerlink" title="GlobalExceptionHandler"></a>GlobalExceptionHandler</h4><p>GlobalExceptionHandler Á±ªÊòØ‰∏Ä‰∏™Áî®‰∫é<strong>ÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜÁöÑÁ±ª</strong>ÔºåÂü∫‰∫é Spring Boot ‰∏≠ÁöÑ @RestControllerAdvice Âíå @ExceptionHandler Ê≥®Ëß£„ÄÇËøô‰∏™Á±ªÊçïËé∑Âπ∂Â§ÑÁêÜÂ∫îÁî®‰∏≠ÁöÑÂêÑÁßçÂºÇÂ∏∏ÔºåÂπ∂ËøîÂõûÊ†ºÂºèÂåñÁöÑÂìçÂ∫î‰ø°ÊÅØ„ÄÇÂÆÉÁöÑ‰ΩúÁî®ÊòØ<strong>ÈõÜ‰∏≠Â§ÑÁêÜÂ∫îÁî®‰∏≠ÁöÑÂºÇÂ∏∏ÔºåÊèê‰æõÁªü‰∏ÄÁöÑÈîôËØØ‰ø°ÊÅØÂìçÂ∫îÊ†ºÂºè</strong>Ôºå‰ª•‰æøÂâçÁ´ØÊàñÂÆ¢Êà∑Á´ØÊõ¥Â•ΩÂú∞Â§ÑÁêÜÈîôËØØ„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜÁ±ª</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> &#123;<br><br>    <span class="hljs-comment">//Áî®Êù•Â§ÑÁêÜÊâÄÊúâÊú™Ë¢´ÂÖ∂‰ªñ @ExceptionHandler ÊçïËé∑ÁöÑÈÄöÁî®ÂºÇÂ∏∏ÔºàÁªßÊâøËá™ Exception Á±ªÁöÑÂºÇÂ∏∏Ôºâ</span><br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.OK)</span><br>    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">exception</span><span class="hljs-params">(Exception e)</span> &#123;<br>        log.error(e.getMessage(), e);<br>        <span class="hljs-keyword">return</span> ApiResult.error(ResultCode.C500.getCode(), e.getMessage());<br>    &#125;<br><br>    <span class="hljs-comment">// Áî®Êù•Â§ÑÁêÜÂèÇÊï∞ÁªëÂÆöÂºÇÂ∏∏ÔºåÈÄöÂ∏∏ÂèëÁîüÂú®ËØ∑Ê±ÇÁöÑÂèÇÊï∞‰∏çÁ¨¶ÂêàË¶ÅÊ±ÇÊó∂Ôºà‰æãÂ¶ÇËØ∑Ê±ÇÂèÇÊï∞Ê†ºÂºèÈîôËØØÔºâ„ÄÇ</span><br>    <span class="hljs-comment">// ËøôÁßçÂºÇÂ∏∏‰∏ÄËà¨ÊòØÂú® Spring MVC ‰∏≠ÂèëÁîüÁöÑÔºåÂΩìËØ∑Ê±Ç‰ΩìÊï∞ÊçÆÊó†Ê≥ïÁªëÂÆöÂà∞ Java Bean Êó∂Ôºå‰ºöÊäõÂá∫ BindException„ÄÇ</span><br>    <span class="hljs-meta">@ExceptionHandler(BindException.class)</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.OK)</span><br>    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">exception</span><span class="hljs-params">(BindException e)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">errorMsg</span> <span class="hljs-operator">=</span> e.getBindingResult().getFieldErrors().stream()<br>                .map(errorInfo -&gt; errorInfo.getField() + errorInfo.getDefaultMessage()).collect(Collectors.joining(<span class="hljs-string">&quot;,&quot;</span>));<br>        log.warn(e.getMessage(), e);<br>        <span class="hljs-keyword">return</span> ApiResult.error(ResultCode.C500.getCode(), <span class="hljs-string">&quot;ÂèÇÊï∞Ê†°È™åÂ§±Ë¥•:&quot;</span> + errorMsg);<br>    &#125;<br><br>    <span class="hljs-comment">//Â§ÑÁêÜÂèÇÊï∞Ê†°È™åÂ§±Ë¥•ÁöÑÂºÇÂ∏∏ÔºåÈÄöÂ∏∏ÂèëÁîüÂú®‰ΩøÁî® @Valid Êàñ @Validated Ê≥®Ëß£ËøõË°åÂèÇÊï∞Ê†°È™åÊó∂</span><br>    <span class="hljs-comment">// Â¶ÇÊûúÊ†°È™åÂ§±Ë¥•ÔºåSpring ‰ºöÊäõÂá∫ MethodArgumentNotValidException„ÄÇ</span><br>    <span class="hljs-meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.OK)</span><br>    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">exception</span><span class="hljs-params">(MethodArgumentNotValidException e)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">errorMsg</span> <span class="hljs-operator">=</span> e.getBindingResult().getFieldErrors().stream()<br>                .map(errorInfo -&gt; errorInfo.getField() + errorInfo.getDefaultMessage()).collect(Collectors.joining(<span class="hljs-string">&quot;,&quot;</span>));<br>        log.warn(e.getMessage(), e);<br>        <span class="hljs-keyword">return</span> ApiResult.error(ResultCode.C500.getCode(), <span class="hljs-string">&quot;ÂèÇÊï∞Ê†°È™åÂ§±Ë¥•:&quot;</span> + errorMsg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4-2-controller"><a href="#4-2-controller" class="headerlink" title="4.2 controller"></a>4.2 controller</h2><ul>
<li>SeckillMockController</li>
</ul>
<h4 id="SeckillMockController"><a href="#SeckillMockController" class="headerlink" title="SeckillMockController"></a>SeckillMockController</h4><p>Ê®°ÊãüÁßíÊùÄÂú∫ÊôØÁöÑÊéßÂà∂Âô®Ôºå‰∏ªË¶ÅÁî®‰∫éÊ®°Êãü‰∏çÂêåÁ±ªÂûãÁöÑÁßíÊùÄÁ≠ñÁï•ÔºåÂπ∂ÈÄöËøá‰∏çÂêåÁöÑÊñπÂºèÊù•ÊéßÂà∂Âπ∂Âèë„ÄÅÂ∫ìÂ≠ò„ÄÅ‰ªªÂä°ÂàÜÈÖçÁ≠â„ÄÇ</p>
<p><strong>‰∏ªË¶ÅÂäüËÉΩÂíå‰ΩúÁî®</strong>Ôºö</p>
<ol>
<li><p><strong>Ê®°Êãü‰∏çÂêåÁöÑÁßíÊùÄÂú∫ÊôØÔºö</strong></p>
<ul>
<li>Á±ª‰∏≠ÁöÑÊñπÊ≥ïÊ®°Êãü‰∫ÜÂ§öÁßçÁßíÊùÄÂú∫ÊôØÔºåÊ∂µÁõñ‰∫ÜÂêåÊ≠•ÈîÅ„ÄÅÂàÜÂ∏ÉÂºèÈîÅ„ÄÅÊ∂àÊÅØÈòüÂàó„ÄÅÊï∞ÊçÆÂ∫ìÂéüÂ≠êÊõ¥Êñ∞Á≠âÊäÄÊúØÊâãÊÆµ„ÄÇ</li>
<li>ÊØè‰∏™Âú∫ÊôØÂØπÂ∫î‰∏Ä‰∏™ÁßíÊùÄÁ≠ñÁï•ÔºåÊ®°ÊãüÁßíÊùÄÁöÑÂπ∂ÂèëÂ§ÑÁêÜÂíåÂ∫ìÂ≠òÊõ¥Êñ∞„ÄÇ</li>
</ul>
</li>
<li><p><strong>Âú∫ÊôØËØ¶ÁªÜËß£ÈáäÔºö</strong></p>
<ul>
<li><strong>Âú∫ÊôØ‰∏Ä (<code>sychronized</code>)</strong>Ôºö‰ΩøÁî®ÂêåÊ≠•ÈîÅÊù•ÊéßÂà∂Âπ∂ÂèëÔºåÊ®°ÊãüÂçïÊú∫ÁéØÂ¢É‰∏ãÁöÑÁßíÊùÄ„ÄÇ</li>
<li><strong>Âú∫ÊôØ‰∫å (<code>redisson</code>)</strong>Ôºö‰ΩøÁî® Redis ÂàÜÂ∏ÉÂºèÈîÅÊù•ÊéßÂà∂Âπ∂ÂèëÔºåÈÄÇÁî®‰∫éÂàÜÂ∏ÉÂºèÁéØÂ¢É„ÄÇ</li>
<li><strong>Âú∫ÊôØ‰∏â (<code>activemq</code>)</strong>Ôºö‰ΩøÁî® ActiveMQ Ê∂àÊÅØÈòüÂàóËøõË°åÂºÇÊ≠•ÁßíÊùÄÔºåÊ®°ÊãüÈ´òÂπ∂ÂèëÊÉÖÂÜµ‰∏ãÁöÑÂºÇÊ≠•Â§ÑÁêÜ„ÄÇ</li>
<li><strong>Âú∫ÊôØÂõõ (<code>kafka</code>)</strong>Ôºö‰ΩøÁî® Kafka Ê∂àÊÅØÈòüÂàóÔºåÊèêÂçáÊÄßËÉΩÂπ∂Â§ÑÁêÜÊõ¥È´òÂπ∂Âèë„ÄÇ</li>
<li><strong>Âú∫ÊôØ‰∫î (<code>procedure</code>)</strong>Ôºö‰ΩøÁî®Êï∞ÊçÆÂ∫ìÂéüÂ≠êÊÄßÊõ¥Êñ∞Êù•Â§ÑÁêÜÁßíÊùÄÔºå‰ΩøÁî® SQL Â≠òÂÇ®ËøáÁ®ãËøõË°åÂ∫ìÂ≠òÊõ¥Êñ∞„ÄÇ</li>
<li><strong>Âú∫ÊôØÂÖ≠ (<code>activemq/reply</code>)</strong>ÔºöÂºÇÊ≠•ÁßíÊùÄÂπ∂Âú® 30 ÁßíÂÜÖËøîÂõûÁßíÊùÄÊâßË°åÁªìÊûú„ÄÇ</li>
<li><strong>Âú∫ÊôØ‰∏É (<code>zookeeperLock</code>)</strong>Ôºö‰ΩøÁî® Zookeeper ÂàÜÂ∏ÉÂºèÈîÅÊù•ÊéßÂà∂Âπ∂Âèë„ÄÇ</li>
<li><strong>Âú∫ÊôØÂÖ´ (<code>redisReactiveMongo</code>)</strong>Ôºö‰ΩøÁî® Redis ÁºìÂ≠òÊâßË°åÂáèÂ∫ìÂ≠òÊìç‰ΩúÔºåÊúÄÂêéÈÄöËøá MQ ÂÆåÊàêÊï∞ÊçÆËêΩÂú∞„ÄÇ</li>
<li><strong>Âú∫ÊôØ‰πù (<code>rabbitmq</code>)</strong>Ôºö‰ΩøÁî® RabbitMQ Ê∂àÊÅØÈòüÂàóÊù•ËøõË°åÂºÇÊ≠•ÁßíÊùÄÂ§ÑÁêÜ„ÄÇ</li>
<li><strong>Âú∫ÊôØÂçÅ (<code>limit</code>)</strong>Ôºö‰ΩøÁî® Sentinel ÈôêÊµÅÁ≠ñÁï•‰∏éÊï∞ÊçÆÂ∫ìÂéüÂ≠êÊõ¥Êñ∞ÁªìÂêàÔºåÈò≤Ê≠¢ËøáÂ§öËØ∑Ê±ÇÂØπÁ≥ªÁªüÈÄ†ÊàêËøáËΩΩ„ÄÇ</li>
<li><strong>Âú∫ÊôØÂçÅ‰∏Ä (<code>atomicWithCanal</code>)</strong>Ôºö‰ΩøÁî®Êï∞ÊçÆÂ∫ìÂéüÂ≠êÊõ¥Êñ∞Âíå Canal ÁõëÂê¨Êï∞ÊçÆÂ∫ìÂèòÊõ¥ÔºåÂ§ÑÁêÜÁßíÊùÄÁªìÊûú„ÄÇ</li>
</ul>
</li>
<li><p><strong>ÊâßË°åÁßíÊùÄÊìç‰ΩúÔºö</strong></p>
<ul>
<li>ÊØè‰∏™ÁßíÊùÄÂú∫ÊôØÈÉΩÈÄöËøá <code>processSeckill</code> ÊñπÊ≥ïÊù•ÊâßË°å„ÄÇÊ≠§ÊñπÊ≥ïË¥üË¥£ÂáÜÂ§áÁßíÊùÄÁöÑÂ∫ìÂ≠ò„ÄÅË∞ÉÊï¥Á∫øÁ®ãÊ±†ÂèÇÊï∞„ÄÅËÆ∞ÂΩï‰ªªÂä°ÂºÄÂßãÊó∂Èó¥Á≠â„ÄÇ</li>
<li>ËØ•ÊñπÊ≥ïÂèØ‰ª•ÈÄöËøá‰∏çÂêåÁöÑÁßíÊùÄÁ≠ñÁï•ÔºàÂ¶ÇÂêåÊ≠•ÈîÅ„ÄÅÂàÜÂ∏ÉÂºèÈîÅ„ÄÅÊ∂àÊÅØÈòüÂàóÁ≠âÔºâÊù•ÊâßË°åÁßíÊùÄÔºåÂπ∂Êèê‰æõËá™ÂÆö‰πâÁöÑÊâßË°å‰ªªÂä°ÔºàÂ¶ÇÂèëÈÄÅÊ∂àÊÅØÈòüÂàó„ÄÅÊâßË°åÁßíÊùÄÊúçÂä°Á≠âÔºâ„ÄÇ</li>
</ul>
</li>
<li><p><strong>ÂºÇÊ≠•ÂíåÂπ∂ÂèëÂ§ÑÁêÜÔºö</strong></p>
<ul>
<li>ËØ•Á±ªÈÄöËøáÁ∫øÁ®ãÊ±† (<code>taskExecutor</code>) Êù•Ê®°ÊãüÈ´òÂπ∂ÂèëÁéØÂ¢É‰∏ãÁöÑÁßíÊùÄÂ§ÑÁêÜÔºåÁ°Æ‰øùÂ§ßÈáèËØ∑Ê±ÇÂèØ‰ª•ÂêåÊó∂ËøõË°å„ÄÇ</li>
<li>‰ΩøÁî®‰∏çÂêåÁöÑÂπ∂ÂèëÊéßÂà∂ÊñπÊ≥ïÔºàÂ¶ÇÂêåÊ≠•ÈîÅ„ÄÅRedis ÈîÅ„ÄÅÊ∂àÊÅØÈòüÂàóÁ≠âÔºâÊù•‰øùËØÅÁßíÊùÄËøáÁ®ã‰∏≠ÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÂíåÂ∫ìÂ≠òÊ≠£Á°ÆÊÄß„ÄÇ</li>
</ul>
</li>
<li><p><strong>Ëá™ÂÆö‰πâ‰ªªÂä°ÂíåÊó•ÂøóËÆ∞ÂΩïÔºö</strong></p>
<ul>
<li>ÈÄöËøá <code>Runnable</code> Êù•ÂÆö‰πâ‰ªªÂä°Âπ∂Êèê‰∫§ÁªôÁ∫øÁ®ãÊ±†ÔºåÊ®°ÊãüÊØè‰∏™Áî®Êà∑ÂèÇ‰∏éÁßíÊùÄÁöÑÊìç‰Ωú„ÄÇ</li>
<li>ÊØè‰∏™ÁßíÊùÄËØ∑Ê±ÇÈÉΩ‰ºöÈÄöËøáÊó•ÂøóËÆ∞ÂΩïÁõ∏ÂÖ≥‰ø°ÊÅØÔºå‰æø‰∫éË∞ÉËØïÂíåÁõëÊéß„ÄÇ</li>
</ul>
</li>
<li><p><strong>‰ªªÂä°ÁªüËÆ°‰∏éÊó∂Èó¥ËÆ∞ÂΩïÔºö</strong></p>
<ul>
<li>Á±ª‰∏≠ËøòÂåÖÊã¨‰∫Ü‰∏Ä‰∫õÁî®‰∫é‰ªªÂä°Êó∂Èó¥ÁªüËÆ°ÁöÑÂ∑•ÂÖ∑ÔºàÂ¶Ç <code>TaskTimeCaculateUtil</code>ÔºâÔºåÂèØ‰ª•ËÆ∞ÂΩïÂíåËøîÂõûÊØè‰∏™ÁßíÊùÄ‰ªªÂä°ÁöÑÊâßË°åÊó∂Èó¥„ÄÇ</li>
</ul>
</li>
<li><p><strong>Êâ©Â±ïÊÄß‰∏éÂÆπÈîôÂ§ÑÁêÜÔºö</strong></p>
<ul>
<li>ËØ•ÊéßÂà∂Âô®ÊîØÊåÅ‰∏çÂêåÁöÑÁßíÊùÄÁ≠ñÁï•ÂíåÂ§öÁßçÂàÜÂ∏ÉÂºèÁéØÂ¢ÉÁöÑÈÖçÁΩÆÔºàÂ¶Ç Redis„ÄÅZookeeper„ÄÅKafka„ÄÅRabbitMQ Á≠âÔºâÔºå‰ΩøÂæóÁßíÊùÄÁ≥ªÁªüÂèØ‰ª•Ê†πÊçÆÂÆûÈôÖÈúÄÊ±ÇËøõË°åË∞ÉÊï¥Âíå‰ºòÂåñ„ÄÇ</li>
<li>ÈîôËØØÂ§ÑÁêÜ‰πüÁªèËøá‰∫ÜËÆæËÆ°ÔºåËÉΩÂ§üÂú®ÂêÑÁßçÂú∫ÊôØ‰∏ãÊèê‰æõÂèçÈ¶à„ÄÇ</li>
</ul>
</li>
</ol>
<h2 id="4-3-stream-consumer"><a href="#4-3-stream-consumer" class="headerlink" title="4.3 stream.consumer"></a>4.3 stream.consumer</h2><ul>
<li>SeckillMockCanalResponseListener</li>
<li>SeckillMockResponseListener</li>
</ul>
<h4 id="SeckillMockCanalResponseListener"><a href="#SeckillMockCanalResponseListener" class="headerlink" title="SeckillMockCanalResponseListener"></a>SeckillMockCanalResponseListener</h4><p>ËØ•Á±ª‰∏ªË¶ÅÁî®‰∫éÂú®ÁßíÊùÄÊ¥ªÂä®ÁªìÊùüÊó∂ÔºåÁõëÂê¨ Canal Êé®ÈÄÅÁöÑÊï∞ÊçÆÂ∫ìÂèòÊõ¥Ê∂àÊÅØÔºåËÆ∞ÂΩïÁßíÊùÄÊ¥ªÂä®ÁöÑÁªìÊùüÊó∂Èó¥„ÄÅID ÂíåÊàêÂäüÁöÑ‰∫§ÊòìÁ¨îÊï∞„ÄÇÂÆÉÂÆûÁé∞‰∫Ü‰∏Ä‰∏™Âü∫‰∫é Canal ÁöÑÊï∞ÊçÆÂ∫ìÂèòÊõ¥ÁõëÂê¨Êú∫Âà∂ÔºåÂ∏ÆÂä©Á≥ªÁªüÂú®ÁßíÊùÄÊ¥ªÂä®ÁªìÊùüÂêéÊâßË°åÂêéÁª≠Â§ÑÁêÜÂíåÁªüËÆ°Êìç‰Ωú„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * canal binlogÁßíÊùÄÁªìÊûúÊ∂àÊÅØÊ∂àË¥πËÄÖ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillMockCanalResponseListener</span> &#123;<br>    <span class="hljs-meta">@DubboReference</span><br>    <span class="hljs-keyword">private</span> SeckillService seckillService;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Consumer&lt;SeckillMockCanalResponseDTO&gt; <span class="hljs-title function_">seckillCanalResult</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> responseDto -&gt; &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">seckillId</span> <span class="hljs-operator">=</span> responseDto.getSeckillId();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">note</span> <span class="hljs-operator">=</span> responseDto.getNote();<br><br>            <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(responseDto.getStatus())) &#123;<br>                log.info(<span class="hljs-string">&quot;binlogÁõëÊéßÂà∞ÁßíÊùÄÊ¥ªÂä®ÁªìÊùüÔºå&#123;&#125;Êó∂Èó¥Ôºö&#123;&#125;,ÁßíÊùÄidÔºö&#123;&#125;&quot;</span>, note, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), seckillId);<br>                <span class="hljs-type">long</span> <span class="hljs-variable">successKillCount</span> <span class="hljs-operator">=</span> seckillService.getSuccessKillCount(seckillId);<br>                log.info(<span class="hljs-string">&quot;ÊúÄÁªàÊàêÂäü‰∫§ÊòìÁ¨îÊï∞Ôºö&#123;&#125;&quot;</span>, successKillCount);<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>seckillCanalResult</code>ÔºöÂàõÂª∫‰∫Ü‰∏Ä‰∏™ <code>Consumer&lt;SeckillMockCanalResponseDTO&gt;</code>ÔºåÂÆÉÂÆö‰πâ‰∫ÜÂ¶Ç‰ΩïÂ§ÑÁêÜ Canal ÁõëÂê¨Âà∞ÁöÑ <code>SeckillMockCanalResponseDTO</code> Êï∞ÊçÆ„ÄÇ<ul>
<li>Â¶ÇÊûú status ‰∏∫ trueÔºàË°®Á§∫ÁßíÊùÄÊ¥ªÂä®Â∑≤ÁªìÊùüÔºâÔºåÂàôÊâßË°å‰ª•‰∏ãÊìç‰ΩúÔºö<ul>
<li>ÊâìÂç∞ÁßíÊùÄÁªìÊùüÁöÑÊó•ÂøóÔºåÂåÖÊã¨Ê¥ªÂä®ÁöÑÁªìÊùüÊó∂Èó¥„ÄÅÁßíÊùÄ ID ÂíåÊèèËø∞‰ø°ÊÅØ„ÄÇ</li>
<li>Ë∞ÉÁî® <code>seckillService.getSuccessKillCount(seckillId)</code> Ëé∑ÂèñÊàêÂäüÁßíÊùÄÁöÑÊÄªÊï∞ÔºåÂπ∂ÊâìÂç∞Âá∫Êù•„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="SeckillMockResponseListener"><a href="#SeckillMockResponseListener" class="headerlink" title="SeckillMockResponseListener"></a>SeckillMockResponseListener</h4><p>Ê†∏ÂøÉÂäüËÉΩÊòØ<strong>ÁõëÂê¨ÁßíÊùÄÊ¥ªÂä®ÁöÑÁªìÊùü‰∫ã‰ª∂</strong>ÔºåÁ°Æ‰øùÂú®Ê¥ªÂä®ÁªìÊùüÂêéÊ≠£Á°ÆËÆ°ÁÆóÂπ∂ËÆ∞ÂΩïÊàêÂäüÁöÑ‰∫§ÊòìÁ¨îÊï∞ÔºåÂ§ÑÁêÜÂºÇÊ≠•Êìç‰ΩúÂ∏¶Êù•ÁöÑÂª∂ËøüÔºåÂπ∂ËæìÂá∫Áõ∏ÂÖ≥ÁöÑÁªüËÆ°‰ø°ÊÅØ„ÄÇÂÆÉËøòÁ°Æ‰øùÂú®Âú∫ÊôØÂÖ´ÔºàRedis + MongoDB ÂºÇÊ≠•Êìç‰ΩúÂú∫ÊôØÔºâ‰∏ãÔºåÊâßË°åË°•ÂÅøÁ≠âÂæÖÊìç‰ΩúÔºåÊúÄÁªàÁªìÊùüÁßíÊùÄÊ¥ªÂä®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillMockResponseListener</span> &#123;<br>    <span class="hljs-meta">@DubboReference</span><br>    <span class="hljs-keyword">private</span> SeckillService seckillService;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Consumer&lt;SeckillMockResponseDTO&gt; <span class="hljs-title function_">seckillResult</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> responseDto -&gt; &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">seckillId</span> <span class="hljs-operator">=</span> responseDto.getSeckillId();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">note</span> <span class="hljs-operator">=</span> responseDto.getNote();<br><br>            <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(responseDto.getStatus())) &#123;<br>                log.info(<span class="hljs-string">&quot;ÁßíÊùÄÊ¥ªÂä®ÁªìÊùüÔºå&#123;&#125;Êó∂Èó¥Ôºö&#123;&#125;,ÁßíÊùÄidÔºö&#123;&#125;&quot;</span>, note, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), seckillId);<br>                <span class="hljs-type">long</span> <span class="hljs-variable">successKillCount</span> <span class="hljs-operator">=</span> seckillService.getSuccessKillCount(seckillId);<br>                <span class="hljs-type">long</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">while</span> (successKillCount != temp) &#123;<br>                    <span class="hljs-comment">// ËÆ°ÁÆóÊÄªÊï∞ÂèØËÉΩÊúâÂª∂ËøüÔºåÁ≠âÂæÖÁªüËÆ°Êï∞ÊçÆÁ®≥ÂÆöÂêéÂæóÂà∞ÊúÄÁªàÁªìÊûú</span><br>                    log.info(<span class="hljs-string">&quot;ÊúÄÁªàÊàêÂäü‰∫§ÊòìÁ¨îÊï∞ÁªüËÆ°‰∏≠„ÄÇ„ÄÇ„ÄÇ&quot;</span>);<br>                    successKillCount = temp;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        Thread.sleep(<span class="hljs-number">1500L</span>);<br>                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                        log.warn(e.getMessage(), e);<br>                    &#125;<br>                    temp = seckillService.getSuccessKillCount(seckillId);<br>                &#125;<br>                TaskTimeCaculateUtil.stop(responseDto.getTaskId());<br>                log.info(<span class="hljs-string">&quot;ÊúÄÁªàÊàêÂäü‰∫§ÊòìÁ¨îÊï∞Ôºö&#123;&#125;&quot;</span>, successKillCount);<br>                log.info(<span class="hljs-string">&quot;ÂéÜÂè≤‰ªªÂä°ËÄóÊó∂ÁªüËÆ°Ôºö&#123;&#125;&quot;</span>, TaskTimeCaculateUtil.prettyPrint(responseDto.getTaskId()));<br>                <span class="hljs-comment">// Âú∫ÊôØÂÖ´Áî±‰∫éÊòØÂºÇÊ≠•ÊèíÂÖ•ÔºåË°•ÂÅøÊü•ËØ¢ÊúÄÊñ∞ÊèíÂÖ•ËÆ∞ÂΩïÊï∞ÔºåÂª∂Ëøü10s</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span> (SeckillSolutionEnum.REDIS_MONGO_REACTIVE.getName().endsWith(note)) &#123;<br>                        Thread.sleep(<span class="hljs-number">10000</span>);<br>                        log.info(<span class="hljs-string">&quot;mongoÊúÄÁªàÊàêÂäü‰∫§ÊòìÁ¨îÊï∞Ôºö&#123;&#125;&quot;</span>, successKillCount);<br>                    &#125;<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    log.error(e.getMessage(), e);<br>                    Thread.currentThread().interrupt();<br>                &#125;<br>                seckillService.endSeckill(seckillId);<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<ul>
<li>seckillResult()ÔºöÂàõÂª∫‰∫Ü‰∏Ä‰∏™ Consumer<SeckillMockResponseDTO>ÔºåËØ•ÊñπÊ≥ïÂÆö‰πâ‰∫ÜÂ¶Ç‰ΩïÂ§ÑÁêÜÊî∂Âà∞ÁöÑÁßíÊùÄÊ¥ªÂä®ÁªìÊùüÊ∂àÊÅØÔºö<ul>
<li>ÂÆÉÈ¶ñÂÖàËé∑ÂèñÁßíÊùÄÊ¥ªÂä®ÁöÑ ID ÂíåÁä∂ÊÄÅÔºàÈÄöËøá responseDtoÔºâ„ÄÇ</li>
<li>Â¶ÇÊûúÁßíÊùÄÊ¥ªÂä®Â∑≤ÁªèÁªìÊùüÔºàstatus &#x3D;&#x3D; trueÔºâÔºåÂàôÂºÄÂßãÁªüËÆ°ÊàêÂäü‰∫§ÊòìÁ¨îÊï∞„ÄÇ</li>
<li>Â¶ÇÊûúÁªüËÆ°ÁöÑÊàêÂäü‰∫§ÊòìÁ¨îÊï∞ÂèëÁîüÂèòÂåñÔºåÂàô‰ºöÁªßÁª≠Á≠âÂæÖÔºåÁõ¥Âà∞Êï∞ÊçÆÁ®≥ÂÆö„ÄÇ</li>
<li>ÂÆåÊàêÁªüËÆ°ÂêéÔºåÂÅúÊ≠¢‰ªªÂä°Êó∂Èó¥ÁªüËÆ°ÔºåËæìÂá∫Êó•ÂøóÔºåËÆ∞ÂΩïÊ¥ªÂä®ÁöÑÊúÄÁªàÊàêÂäü‰∫§ÊòìÁ¨îÊï∞Âíå‰ªªÂä°ÁöÑËÄóÊó∂„ÄÇ</li>
<li>Â¶ÇÊûúÊòØÁâπÂÆöÂú∫ÊôØÔºàÂ¶Ç Redis + MongoDB ÂºÇÊ≠•Â§ÑÁêÜÔºâÔºåËøò‰ºöËøõË°åË°•ÂÅøÊìç‰ΩúÔºåÁ≠âÂæÖÊï∞ÊçÆÊèíÂÖ•ÂÆåÊàêÂêéÂÜçËæìÂá∫ÊúÄÁªàÁªìÊûú„ÄÇ</li>
<li>ÊúÄÂêéÔºåË∞ÉÁî® seckillService.endSeckill(seckillId) Êù•ÁªìÊùüÁßíÊùÄÊ¥ªÂä®„ÄÇ</li>
</ul>
</li>
</ul>
<h2 id="4-4-util"><a href="#4-4-util" class="headerlink" title="4.4 util"></a>4.4 util</h2><ul>
<li>TaskTimeCaculateUtil</li>
</ul>
<h4 id="TaskTimeCaculateUtil"><a href="#TaskTimeCaculateUtil" class="headerlink" title="TaskTimeCaculateUtil"></a>TaskTimeCaculateUtil</h4><p>TaskTimeCaculateUtil Á±ªÈÄöËøáÂ∞ÅË£Ö StopWatch Êù•Êèê‰æõÁÆÄÂçïÁöÑ‰ªªÂä°ËÆ°Êó∂„ÄÅÂÅúÊ≠¢ÂíåÁªüËÆ°ÂäüËÉΩ„ÄÇÂÆÉÂèØ‰ª•Áî®Êù•ÁõëÊéß‰ªªÂä°ÊâßË°åÁöÑÊó∂Èïø„ÄÅËæìÂá∫ÊâßË°åÊó∂Èó¥Êä•Âëä</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskTimeCaculateUtil</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ËÆ°Êó∂Âô®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">StopWatch</span> <span class="hljs-variable">stopWatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopWatch</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ‰ªªÂä°ËÆ°Êó∂Âô®Êò†Â∞Ñ, taskId:stopWatch</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, StopWatch&gt; taskWatchMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂºÄÂêØ‰∏Ä‰∏™ËÆ°Êó∂‰ªªÂä°ÔºåÊúÄÂ§ßÂÖÅËÆ∏ÂêåÊó∂ÂºÄÂêØÂçÅ‰∏™‰ªªÂä°</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> taskName ‰ªªÂä°Âêç</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> taskId   ‰ªªÂä°id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startTask</span><span class="hljs-params">(String taskName, String taskId)</span> &#123;<br>        <span class="hljs-keyword">if</span> (stopWatch.getTaskCount() &gt; <span class="hljs-number">10</span> || stopWatch.isRunning()) &#123;<br>            stopWatch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopWatch</span>();<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            stopWatch.start(taskName);<br>            taskWatchMap.put(taskId, stopWatch);<br>        &#125; <span class="hljs-keyword">catch</span> (IllegalStateException e) &#123;<br>            log.warn(<span class="hljs-string">&quot;Last task have not finish yet!&quot;</span>, e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂÅúÊ≠¢‰∏ä‰∏Ä‰∏™ËÆ°Êó∂‰ªªÂä°</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> taskId ‰ªªÂä°id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">(String taskId)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            taskWatchMap.get(taskId).stop();<br>        &#125; <span class="hljs-keyword">catch</span> (IllegalStateException e) &#123;<br>            log.warn(<span class="hljs-string">&quot;Oops, stop error occurs!&quot;</span>, e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ËæìÂá∫ÂéÜÂè≤‰ªªÂä°ÁöÑËÄóÊó∂ÊÉÖÂÜµ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> taskId ‰ªªÂä°id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ‰ªªÂä°ÁöÑËÄóÊó∂ÊÉÖÂÜµ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">prettyPrint</span><span class="hljs-params">(String taskId)</span> &#123;<br>        <span class="hljs-keyword">return</span> taskWatchMap.get(taskId).prettyPrint();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>ÂÖ≥ÈîÆÊñπÊ≥ïÔºö</p>
<ol>
<li>startTask(String taskName, String taskId)Ôºö<ul>
<li>ÂêØÂä®‰∏Ä‰∏™Êñ∞ÁöÑËÆ°Êó∂‰ªªÂä°„ÄÇÊúÄÂ§öÂÖÅËÆ∏ÂêåÊó∂Êúâ 10 ‰∏™‰ªªÂä°Âú®ËÆ°Êó∂ÔºàÈÄöËøáÊ£ÄÊü• stopWatch.getTaskCount()Ôºâ„ÄÇÂ¶ÇÊûú‰ªªÂä°Êï∞Ë∂ÖËøáÈôêÂà∂ÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑËÆ°Êó∂Âô®ÂÆû‰æã„ÄÇ</li>
<li>‰ΩøÁî® taskId Â∞Ü‰ªªÂä°‰∏éËÆ°Êó∂Âô®ÂÆû‰æãÂÖ≥ËÅî„ÄÇ</li>
</ul>
</li>
<li>stop(String taskId)Ôºö<ul>
<li>ÂÅúÊ≠¢ÊåáÂÆö‰ªªÂä°ÁöÑËÆ°Êó∂„ÄÇÈÄöËøá taskId Ëé∑ÂèñÂØπÂ∫îÁöÑ StopWatch ÂØπË±°Âπ∂ÂÅúÊ≠¢ÂÆÉ„ÄÇ</li>
<li>Â¶ÇÊûúÂÅúÊ≠¢Êó∂Âá∫Áé∞ÂºÇÂ∏∏ÔºàÂ¶ÇÊ≤°ÊúâÊâæÂà∞ÂØπÂ∫îÁöÑ‰ªªÂä°Êàñ‰ªªÂä°Ê≤°ÊúâÂêØÂä®ÔºâÔºå‰ºöËÆ∞ÂΩïË≠¶ÂëäÊó•Âøó„ÄÇ</li>
</ul>
</li>
<li>prettyPrint(String taskId)Ôºö<ul>
<li>Ëé∑ÂèñÂπ∂ËøîÂõûÊüê‰∏™‰ªªÂä°ÁöÑËØ¶ÁªÜËÄóÊó∂‰ø°ÊÅØÔºàÂ¶ÇÂºÄÂßãÊó∂Èó¥„ÄÅÁªìÊùüÊó∂Èó¥„ÄÅÊÄªËÄóÊó∂Á≠âÔºâÔºåËæìÂá∫ÁöÑÊ†ºÂºèÈÄöËøá StopWatch ÁöÑ prettyPrint ÊñπÊ≥ïÊù•ÂÆûÁé∞„ÄÇ</li>
</ul>
</li>
</ol>
<h2 id="4-5-SampleWebApplicationÂêØÂä®Á±ª"><a href="#4-5-SampleWebApplicationÂêØÂä®Á±ª" class="headerlink" title="4.5 SampleWebApplicationÂêØÂä®Á±ª"></a>4.5 SampleWebApplicationÂêØÂä®Á±ª</h2><p>ËØ•ÂêØÂä®Á±ªÁöÑ‰ΩúÁî®ÊòØÔºö</p>
<ul>
<li>ÂêØÂä®‰∏Ä‰∏™ Spring Boot Â∫îÁî®„ÄÇ</li>
<li>ÂêØÁî®ÊúçÂä°ÂèëÁé∞ÂäüËÉΩÔºåÂÖÅËÆ∏Â∫îÁî®‰∏éÊúçÂä°Ê≥®ÂÜå‰∏≠ÂøÉËøõË°å‰∫§‰∫í„ÄÇ</li>
<li>ÂêØÁî® Feign ÂÆ¢Êà∑Á´ØÊîØÊåÅÔºåÊñπ‰æøËøúÁ®ãË∞ÉÁî®ÂÖ∂‰ªñÊúçÂä°„ÄÇ</li>
<li>ÂêØÁî®ÂºÇÊ≠•ÂäüËÉΩÔºåÊîØÊåÅÊñπÊ≥ïÁöÑÂºÇÊ≠•ÊâßË°å„ÄÇ</li>
<li>ÊòæÂºèÂú∞ÊåáÂÆö Web Â∫îÁî®Á±ªÂûã‰∏∫ ServletÔºå‰ΩøÁî®‰º†ÁªüÁöÑ Servlet ÂÆπÂô®ÂêØÂä®„ÄÇ</li>
</ul>
<h1 id="5-goodskill-spring-boot-starter-È°πÁõÆÈÖçÁΩÆËá™Âä®Ë£ÖÈÖç"><a href="#5-goodskill-spring-boot-starter-È°πÁõÆÈÖçÁΩÆËá™Âä®Ë£ÖÈÖç" class="headerlink" title="5. goodskill-spring-boot-starter (È°πÁõÆÈÖçÁΩÆËá™Âä®Ë£ÖÈÖç)"></a>5. goodskill-spring-boot-starter (È°πÁõÆÈÖçÁΩÆËá™Âä®Ë£ÖÈÖç)</h1><p><img src="/img/blogs/java/goodskill/5.1.1.png" srcset="/img/loading.gif" lazyload></p>
<p>goodskill-spring-boot-starter Ê®°ÂùóÁöÑ‰ΩúÁî®</p>
<ul>
<li>ÂÆÉÊòØ‰∏Ä‰∏™‰∏∫ GoodSkill Á≥ªÁªüÂ∞ÅË£ÖÁöÑ Spring Boot Ëá™Âä®ÈÖçÁΩÆÊ®°ÂùóÔºåÊèê‰æõ‰∫Ü OAuth2 ÁôªÂΩïÊîØÊåÅ„ÄÅMinIO ÂØπË±°Â≠òÂÇ®ÊîØÊåÅ„ÄÅ‰ª•ÂèäÂÖ∂‰ªñÈÄöÁî®ËÉΩÂäõÁöÑÂºÄÁÆ±Âç≥Áî®ÈõÜÊàêÔºåÁÆÄÂåñ‰∏öÂä°Ê®°ÂùóÁöÑÈõÜÊàêÂíåÈÖçÁΩÆ„ÄÇ</li>
</ul>
<p>Âú®Â§ßÂûãÈ°πÁõÆ‰∏≠ÔºåÂ§ö‰∏™ÂæÆÊúçÂä°ÂèØËÉΩÈÉΩË¶Å‰ΩøÁî®Ôºö</p>
<ul>
<li>Á¨¨‰∏âÊñπÁôªÂΩïÔºàÊØîÂ¶Ç Gitee OAuth2Ôºâ</li>
<li>MinIO ÂØπË±°Â≠òÂÇ®ÊúçÂä°</li>
<li>ÈÄöÁî®ÁöÑÊúçÂä°Ê≥®ÂÜå‰∏éÈÖçÁΩÆÈÄªËæë</li>
<li>Ëá™ÂÆö‰πâÂ∑•ÂÖ∑Á±ª„ÄÅAOP ÁªÑ‰ª∂Á≠â</li>
</ul>
<p><strong>Â¶ÇÊûúÊØè‰∏™Ê®°ÂùóÈÉΩÊâãÂä®ÂéªÂÜô‰∏ÄÈÅçÈÖçÁΩÆÔºåÈÇ£ÂæàÈ∫ªÁÉ¶ËÄå‰∏îÂÆπÊòìÂá∫Èîô„ÄÇ</strong><br>‰∫éÊòØÂ∞±Êúâ‰∫ÜËøô‰∏™ starter Ê®°ÂùóÔºåÁªü‰∏ÄÂ∞ÅË£ÖÂ•ΩËøô‰∫õÈÖçÁΩÆÂíåÂ∑•ÂÖ∑Á±ª<br>‰∏ªÂ∑•Á®ãÂè™Ë¶ÅÂú® application.yml ÈáåÂÜôÂ•ΩÈÖçÁΩÆÔºåÂ∞±ËÉΩËá™Âä®Ë£ÖÈÖçÂπ∂‰ΩøÁî®Ëøô‰∫õÂäüËÉΩÔºåÂÆûÁé∞‚Äú<strong>ÂºÄÁÆ±Âç≥Áî®</strong>‚Äù</p>
<h1 id="6-goodskill-seata-ÈõÜÊàênacos-dubbo-shardingjdbc-seataÁöÑÂàÜÂ∏ÉÂºè‰∫ãÂä°Ëß£ÂÜ≥ÊñπÊ°àÁ§∫‰æã"><a href="#6-goodskill-seata-ÈõÜÊàênacos-dubbo-shardingjdbc-seataÁöÑÂàÜÂ∏ÉÂºè‰∫ãÂä°Ëß£ÂÜ≥ÊñπÊ°àÁ§∫‰æã" class="headerlink" title="6. goodskill-seata (ÈõÜÊàênacos+dubbo+shardingjdbc+seataÁöÑÂàÜÂ∏ÉÂºè‰∫ãÂä°Ëß£ÂÜ≥ÊñπÊ°àÁ§∫‰æã)"></a>6. goodskill-seata (ÈõÜÊàênacos+dubbo+shardingjdbc+seataÁöÑÂàÜÂ∏ÉÂºè‰∫ãÂä°Ëß£ÂÜ≥ÊñπÊ°àÁ§∫‰æã)</h1><p><img src="/img/blogs/java/goodskill/6.1.1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="6-1-feignÂåÖ"><a href="#6-1-feignÂåÖ" class="headerlink" title="6.1 feignÂåÖ"></a>6.1 feignÂåÖ</h2><h4 id="AuthFeignClientÊé•Âè£"><a href="#AuthFeignClientÊé•Âè£" class="headerlink" title="AuthFeignClientÊé•Âè£"></a>AuthFeignClientÊé•Âè£</h4><p>AuthFeignClient Êé•Âè£ÊòØ‰∏Ä‰∏™ Feign ÂÆ¢Êà∑Á´ØÔºåÁî®‰∫éÂú® Spring Cloud ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠Ôºå<strong>ÈÄöËøáÂ£∞ÊòéÂºèÊñπÂºèËøúÁ®ãË∞ÉÁî® goodskill-auth ÊúçÂä°ÁöÑÊé•Âè£</strong>„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(name = &quot;goodskill-auth&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AuthFeignClient</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ‰∏∫Áî®Êà∑Â¢ûÂä†ËßíËâ≤</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/user/role/add&quot;)</span><br>    Result&lt;String&gt; <span class="hljs-title function_">addRole</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;userId&quot;)</span> <span class="hljs-type">int</span> userId, <span class="hljs-meta">@RequestParam(&quot;roleId&quot;)</span> <span class="hljs-type">int</span> roleId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>AuthFeignClient ÁöÑ‰ΩúÁî®ÊòØÔºö</p>
<ul>
<li>Âú®ÂΩìÂâçÊúçÂä°‰∏≠Ôºå‰ª• Java Êé•Âè£ÁöÑÊñπÂºèÔºå<strong>Ë∞ÉÁî® goodskill-auth ÊúçÂä°ÁöÑ ‚Äú‰∏∫Áî®Êà∑Ê∑ªÂä†ËßíËâ≤‚Äù Êé•Âè£</strong>ÔºåÂÆûÁé∞Ë∑®ÊúçÂä°ËøúÁ®ãË∞ÉÁî®ÔºåËÄå‰∏çÈúÄË¶ÅÊâãÂä®ÂÜô HTTP ËØ∑Ê±ÇÈÄªËæë„ÄÇ</li>
</ul>
<h2 id="6-2-GoodskillSeataApplication"><a href="#6-2-GoodskillSeataApplication" class="headerlink" title="6.2 GoodskillSeataApplication"></a>6.2 GoodskillSeataApplication</h2><p>ËøôÊòØ‰∏Ä‰∏™ Spring Boot Â∫îÁî®ÁöÑÂêØÂä®Á±ªÔºå‰∏ªË¶ÅÂäüËÉΩÊòØÔºö</p>
<p>‚úÖ Âú®‰∏Ä‰∏™ÊúçÂä°‰∏≠ÂêåÊó∂Ë∞ÉÁî®Â§ö‰∏™ËøúÁ®ãÊúçÂä°ÔºàDubbo + FeignÔºâ<br>‚úÖ <strong>ÈÄöËøá Seata ÂÆûÁé∞ÂàÜÂ∏ÉÂºè‰∫ãÂä°ÁÆ°ÁêÜ</strong><br>‚úÖ ÊµãËØïÂú®ÂºÇÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÂ§ö‰∏™Â≠êÊúçÂä°‰πãÈó¥ÁöÑÊï∞ÊçÆÂõûÊªöÊïàÊûúÔºåÁ°Æ‰øùÊúÄÁªà‰∏ÄËá¥ÊÄß</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication(scanBasePackages = &#123;&quot;com.goodskill.seata&quot;, &quot;com.goodskill.core&quot;&#125;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@EnableFeignClients(basePackages = &quot;com.goodskill.seata.feign&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodskillSeataApplication</span> &#123;<br>    <span class="hljs-meta">@DubboReference</span><br>    <span class="hljs-keyword">private</span> SeckillService seckillService;<br>    <span class="hljs-meta">@DubboReference</span><br>    <span class="hljs-keyword">private</span> GoodsService goodsService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> AuthFeignClient authFeignClient;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊµãËØïseataÂàÜÂ∏ÉÂºè‰∫ãÂä°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/test&quot;)</span><br>    <span class="hljs-meta">@GlobalTransactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGlobalTransaction</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">GoodsVO</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsVO</span>();<br>        goods.setName(<span class="hljs-string">&quot;test&quot;</span>);<br>        goodsService.addGoods(goods);<br>        <span class="hljs-type">SeckillVO</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> seckillService.findById(<span class="hljs-number">1001L</span>);<br>        seckill.setNumber(seckill.getNumber() - <span class="hljs-number">1</span>);<br>        seckillService.saveOrUpdateSeckill(seckill);<br>        authFeignClient.addRole(<span class="hljs-number">21</span>, <span class="hljs-number">7</span>);<br>        <span class="hljs-comment">// ÊµãËØïÂºÇÂ∏∏ÊÉÖÂÜµ</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(GoodskillSeataApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>Âõ†‰∏∫Âä†‰∫Ü @GlobalTransactionalÔºå<strong>Âè™Ë¶Å‰ªª‰Ωï‰∏Ä‰∏™Â≠êÊìç‰ΩúÂ§±Ë¥•</strong>ÔºàÊØîÂ¶ÇÊúÄÂêéÊäõÂá∫ÂºÇÂ∏∏ÔºâÔºå<strong>Â∞±‰ºöËß¶Âèë Seata ÁöÑ‰∫ãÂä°ÂõûÊªöÊú∫Âà∂</strong>ÔºåËÆ©Ôºö</p>
<ul>
<li>Ê∑ªÂä†ÂïÜÂìÅ</li>
<li>Êõ¥Êñ∞ÁßíÊùÄ‰ø°ÊÅØ</li>
<li>Ê∑ªÂä†Áî®Êà∑ËßíËâ≤<br>ÂÖ®ÈÉ®ÂõûÊªöÔºåÁ°Æ‰øùÊï∞ÊçÆ‰∏ÄËá¥ÊÄß„ÄÇ</li>
</ul>
<h1 id="7-goodskill-admin-SpringBoot-AdminÁõëÊéßÊúçÂä°Á´ØÔºåÊîØÊåÅSpring-CloudÂæÆÊúçÂä°ÂèëÁé∞"><a href="#7-goodskill-admin-SpringBoot-AdminÁõëÊéßÊúçÂä°Á´ØÔºåÊîØÊåÅSpring-CloudÂæÆÊúçÂä°ÂèëÁé∞" class="headerlink" title="7. goodskill-admin (SpringBoot AdminÁõëÊéßÊúçÂä°Á´ØÔºåÊîØÊåÅSpring CloudÂæÆÊúçÂä°ÂèëÁé∞)"></a>7. goodskill-admin (SpringBoot AdminÁõëÊéßÊúçÂä°Á´ØÔºåÊîØÊåÅSpring CloudÂæÆÊúçÂä°ÂèëÁé∞)</h1><p><img src="/img/blogs/java/goodskill/7.1.1.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>GoodskillAdminApplication</strong>Ôºö<br>ÂêéÂè∞ÁÆ°ÁêÜÊ®°ÂùóÁöÑÂêØÂä®Á±ªÔºåÂÆÉÁöÑ‰ΩúÁî®ÊòØÂêØÂä®Êï¥‰∏™ goodskill-admin ÂæÆÊúçÂä°„ÄÇ<br>Áî®‰∫éÊûÑÂª∫‰∏Ä‰∏™<strong>Áî®‰∫éÁõëÊéßÂÖ∂‰ªñ Spring Boot ÂæÆÊúçÂä°ÁöÑÂêéÂè∞ÁÆ°ÁêÜÁïåÈù¢</strong>„ÄÇ</p>
<h1 id="8-goodskill-job-elastic-jobÂÆöÊó∂‰ªªÂä°"><a href="#8-goodskill-job-elastic-jobÂÆöÊó∂‰ªªÂä°" class="headerlink" title="8. goodskill-job (elastic-jobÂÆöÊó∂‰ªªÂä°)"></a>8. goodskill-job (elastic-jobÂÆöÊó∂‰ªªÂä°)</h1><p><img src="/img/blogs/java/goodskill/8.1.1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="goodskill-job-simpleÂåÖ"><a href="#goodskill-job-simpleÂåÖ" class="headerlink" title="goodskill.job.simpleÂåÖ"></a>goodskill.job.simpleÂåÖ</h2><ul>
<li>MyJob</li>
<li>MyJob2</li>
</ul>
<h4 id="MyJob"><a href="#MyJob" class="headerlink" title="MyJob"></a>MyJob</h4><p>ÂàÜÁâáÂÆöÊó∂‰ªªÂä°ÂÆûÁé∞Á±ª</p>
<p><strong>‰ΩúÁî®</strong>Ôºö</p>
<ul>
<li><p><strong>ÂÆöÊó∂ÂêåÊ≠•ÂïÜÂìÅÊï∞ÊçÆÂà∞ Elasticsearch Á¥¢Âºï‰∏≠</strong>ÔºåÈÄöËøá ElasticJob ÁöÑÂàÜÁâáÊú∫Âà∂ÂØπ‰ªªÂä°ËøõË°åÂàÜÂ∏ÉÂºèÊãÜÂàÜÂíåÊâßË°å„ÄÇ</p>
</li>
<li><p>ÈÄöËøá Dubbo Ë∞ÉÁî®ËøúÁ®ãÁöÑÂïÜÂìÅÊúçÂä°ÔºåËé∑ÂèñÂïÜÂìÅÂàóË°®„ÄÇ</p>
</li>
<li><p>Â∞ÜÂïÜÂìÅÊï∞ÊçÆËΩ¨Êç¢‰∏∫ ES ÊâÄÈúÄÁöÑ VO ÂØπË±°ÂêéÔºåË∞ÉÁî® goodsEsService.saveBatch() ÊâπÈáèÊõ¥Êñ∞Á¥¢Âºï</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SimpleJob</span> &#123;<br>    <span class="hljs-meta">@DubboReference</span><br>    <span class="hljs-keyword">private</span> GoodsService goodsService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> GoodsEsService goodsEsService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(ShardingContext context)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (context.getShardingItem()) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.info(<span class="hljs-string">&quot;ÂàÜÁâá0 ÂïÜÂìÅesÁ¥¢ÂºïÂºÄÂßãÊõ¥Êñ∞„ÄÇ„ÄÇ„ÄÇ&quot;</span>);<br>                    <span class="hljs-type">List</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> goodsService.findMany().parallelStream().map(g -&gt; &#123;<br>                        <span class="hljs-type">GoodsVO</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsVO</span>();<br>                        BeanUtils.copyProperties(g, goods);<br>                        <span class="hljs-keyword">return</span> goods;<br>                    &#125;).collect(Collectors.toList());<br>                    goodsEsService.saveBatch(list);<br>                    log.info(<span class="hljs-string">&quot;ÂàÜÁâá0 ÂïÜÂìÅesÁ¥¢ÂºïÊõ¥Êñ∞ÊàêÂäüÔºåÊù°Êï∞:&#123;&#125;&quot;</span>, list.size());<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    log.warn(<span class="hljs-string">&quot;ÂàÜÁâá0 ÂïÜÂìÅesÁ¥¢ÂºïÂÆöÊó∂‰ªªÂä°Êõ¥Êñ∞Â§±Ë¥•!&quot;</span>, e);<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.info(<span class="hljs-string">&quot;ÂàÜÁâá1 ÂïÜÂìÅesÁ¥¢ÂºïÂºÄÂßãÊõ¥Êñ∞„ÄÇ„ÄÇ„ÄÇ&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    log.warn(<span class="hljs-string">&quot;ÂàÜÁâá1 ÂïÜÂìÅesÁ¥¢ÂºïÂÆöÊó∂‰ªªÂä°Êõ¥Êñ∞Â§±Ë¥•!&quot;</span>, e);<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.info(<span class="hljs-string">&quot;ÂàÜÁâá2 ÂïÜÂìÅesÁ¥¢ÂºïÂºÄÂßãÊõ¥Êñ∞„ÄÇ„ÄÇ„ÄÇ&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    log.warn(<span class="hljs-string">&quot;ÂàÜÁâá2 ÂïÜÂìÅesÁ¥¢ÂºïÂÆöÊó∂‰ªªÂä°Êõ¥Êñ∞Â§±Ë¥•!&quot;</span>, e);<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-comment">// case n: ...</span><br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ElasticJob ‰ºöÊ†πÊçÆ<strong>ÂàÜÁâáÊï∞Â§öÁ∫øÁ®ãË∞ÉÁî®ËØ•ÊñπÊ≥ïÔºåÊØè‰∏™ÂàÜÁâáË¥üË¥£Â§ÑÁêÜ‰∏çÂêåÁöÑÊï∞ÊçÆ</strong>„ÄÇ</p>
<ul>
<li>ÂàÜÁâá0ÁöÑÊâßË°åÈÄªËæë<ul>
<li><strong>Ëé∑ÂèñÂïÜÂìÅÂàóË°®</strong>ÔºöË∞ÉÁî®ËøúÁ®ã goodsService.findMany() Ëé∑ÂèñÊâÄÊúâÂïÜÂìÅÊï∞ÊçÆ„ÄÇ</li>
<li><strong>ËΩ¨Êç¢Êàê VO ÂØπË±°</strong>Ôºö‰ΩøÁî® BeanUtils.copyProperties() ÊääÂéüÂßãÂïÜÂìÅÂÆû‰ΩìËΩ¨‰∏∫ GoodsVOÔºàÈÄÇÁî®‰∫é ES Â≠òÂÇ®ÁªìÊûÑÔºâ„ÄÇ</li>
<li><strong>Âπ∂Ë°åÂ§ÑÁêÜÊï∞ÊçÆ</strong>ÔºöparallelStream() Â§öÁ∫øÁ®ãÂä†ÈÄüÂ±ûÊÄßÊã∑Ë¥ùÔºàËßÜÊï∞ÊçÆÈáèËÄåÂÆöÊòØÂê¶ÊúâÊïàÔºâ„ÄÇ</li>
<li><strong>ÊâπÈáèÂ≠òÂÇ®Âà∞ ES</strong>ÔºöÈÄöËøá goodsEsService.saveBatch(list) ‰∏ÄÊ¨°ÊÄßÊääÊâÄÊúâÂïÜÂìÅÊï∞ÊçÆÂêåÊ≠•Âà∞ Elasticsearch Á¥¢Âºï‰∏≠„ÄÇ</li>
<li><strong>ËÆ∞ÂΩïÊó•Âøó</strong>ÔºöËÆ∞ÂΩïÊõ¥Êñ∞ÊàêÂäüÁöÑÂïÜÂìÅÊù°Êï∞„ÄÇ</li>
</ul>
</li>
</ul>
<h4 id="MyJob2"><a href="#MyJob2" class="headerlink" title="MyJob2"></a>MyJob2</h4><p>Ëøô‰∏™Á±ª‰πüÊòØ‰∏Ä‰∏™ÂÆöÊó∂‰ªªÂä°ÁöÑÂÆûÁé∞Á±ªÔºå‰∏çËøáÔºö</p>
<p><strong>‰ΩúÁî®</strong>Ôºö<br>‰Ωú‰∏∫Á¨¨‰∫å‰∏™ÂÆöÊó∂‰ªªÂä°Á§∫‰æãÔºå‰ªÖÊâìÂç∞Êó•ÂøóÔºåÊºîÁ§∫ÂàÜÁâáÂäüËÉΩÂ¶Ç‰ΩïÁîüÊïà„ÄÇ</p>
<h4 id="ElasticJobApplication"><a href="#ElasticJobApplication" class="headerlink" title="ElasticJobApplication"></a>ElasticJobApplication</h4><p>ElasticJob ÊúçÂä°ÂêØÂä®Á±ª</p>
<ul>
<li>ÂêØÂä®Êï¥‰∏™‰ªªÂä°ÊúçÂä°Á®ãÂ∫èÔºåÊ≥®ÂÜå‰∏§‰∏™ ElasticJob ÂÆöÊó∂‰ªªÂä°</li>
</ul>
<h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><p>ElasticJob ÈÖçÁΩÆÊñá‰ª∂</p>
<ul>
<li>ÈÖçÁΩÆ‰∫Ü ElasticJob„ÄÅDubbo„ÄÅNacos„ÄÅÊúçÂä°Á´ØÂè£Á≠â‰ø°ÊÅØÔºåÊòØÊï¥‰∏™‰ªªÂä°Á≥ªÁªüÁöÑÈÖçÁΩÆ‰∏≠ÂøÉ„ÄÇ</li>
<li>ÊØè 6 ÁßíÊâßË°å‰∏ÄÊ¨° MyJob</li>
<li>ÂÆö‰πâÂπ∂ÈÖçÁΩÆ‰∏§‰∏™ÂÆöÊó∂‰ªªÂä°ÔºàsimpleJob Âíå simpleJob2ÔºâÁöÑÊâßË°åÊñπÂºèÔºåÂåÖÊã¨Ë∞ÉÂ∫¶Êó∂Èó¥„ÄÅÂàÜÁâáÁ≠ñÁï•„ÄÅÊâßË°åÁ±ªÁ≠â„ÄÇ</li>
<li>Ê≥®ÂÜå‰∫Ü‰∏§‰∏™ ElasticJob ÂàÜÁâá‰ªªÂä°ÔºåÊØè‰∏™‰ªªÂä°ÁöÑÊâßË°åÁ±ªÂàÜÂà´ÊòØ MyJob Âíå MyJob2ÔºåÈÉΩÊØè 6 ÁßíÊâßË°å‰∏ÄÊ¨°ÔºåÂàÜÁâáÊï∞Èáè‰∏∫ 1ÔºåÊâßË°åÊó∂‰ΩøÁî®ËΩÆËØ¢Á≠ñÁï•ÔºåÂπ∂ÈÄöËøá Zookeeper Ê≥®ÂÜå‰∏≠ÂøÉËøõË°åË∞ÉÂ∫¶ÁÆ°ÁêÜ„ÄÇ</li>
</ul>
<h4 id="goodskill-job-ÊâßË°åÊµÅÁ®ã"><a href="#goodskill-job-ÊâßË°åÊµÅÁ®ã" class="headerlink" title="goodskill-job ÊâßË°åÊµÅÁ®ã"></a>goodskill-job ÊâßË°åÊµÅÁ®ã</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs lua">          +<span class="hljs-comment">--------------------------+</span><br>          | ElasticJobApplication    |<br>          |  ‚¨á ÂêØÂä® SpringBoot       |<br>          +<span class="hljs-comment">------------+-------------+</span><br>                       |<br>             Registers ElasticJob Jobs<br>                       |<br>         +<span class="hljs-comment">-------------+--------------+</span><br>         |                            |<br>+<span class="hljs-comment">------------------+       +------------------+</span><br>|     MyJob        |       |     MyJob2       |<br>| ES Á¥¢ÂºïÊõ¥Êñ∞‰ªªÂä°   |       | Êó•ÂøóÊºîÁ§∫‰ªªÂä°       |<br>+<span class="hljs-comment">------------------+       +------------------+</span><br>         |                            |<br>    +<span class="hljs-comment">----v----+                 +-----v----+</span><br>    | Dubbo   |                 |  Êó•ÂøóÊâìÂç∞ |<br>    | Goods   |                 +<span class="hljs-comment">----------+</span><br>    | Services|<br>    +<span class="hljs-comment">---------+</span><br></code></pre></td></tr></table></figure>


<h1 id="9-goodskill-common-ÂÖ¨ÂÖ±ÊúçÂä°"><a href="#9-goodskill-common-ÂÖ¨ÂÖ±ÊúçÂä°" class="headerlink" title="9. goodskill-common (ÂÖ¨ÂÖ±ÊúçÂä°)"></a>9. goodskill-common (ÂÖ¨ÂÖ±ÊúçÂä°)</h1><ul>
<li>goodskill.common.api</li>
<li>goodskill.common.service</li>
<li>goodskill.core</li>
</ul>
<p><img src="/img/blogs/java/goodskill/9.0.1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="9-1-goodskill-common-api-Ê®°Âùó"><a href="#9-1-goodskill-common-api-Ê®°Âùó" class="headerlink" title="9.1 goodskill-common-api Ê®°Âùó"></a>9.1 goodskill-common-api Ê®°Âùó</h2><p><img src="/img/blogs/java/goodskill/9.1.1.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><code>DictDTO</code>: ‰∏öÂä°Â≠óÂÖ∏Ë°®ÔºåÁî®‰∫éÂú®Á≥ªÁªü‰∏≠‰º†ÈÄí‚Äú‰∏öÂä°Â≠óÂÖ∏‚ÄùÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆ</li>
<li><code>DictSimpleDTO</code>: <strong>ÁÆÄÂåñÁâà</strong>Â≠óÂÖ∏Êï∞ÊçÆÊ®°Âûã</li>
</ul>
<h4 id="DictionaryService"><a href="#DictionaryService" class="headerlink" title="DictionaryService"></a>DictionaryService</h4><p><strong>Â≠óÂÖ∏ÈÄöÁî®ÊúçÂä°Êé•Âè£</strong></p>
<ul>
<li>‰∏∫Á≥ªÁªüÊèê‰æõÁªü‰∏ÄÁöÑ‰∏öÂä°Â≠óÂÖ∏Êü•ËØ¢ËÉΩÂäõÔºåÊîØÊåÅÈÄöËøáÂ≠óÂÖ∏ÁºñÁ†Å„ÄÅÈîÆÔºàkeyÔºâ„ÄÅÂÄºÔºàvalueÔºâÁ≠âÊñπÂºèËé∑ÂèñÁÆÄÂåñÁöÑÂ≠óÂÖ∏Êï∞ÊçÆÔºåÁî®‰∫éÂâçÁ´ØÂ±ïÁ§∫Êàñ‰∏öÂä°ÈÄªËæëÂ§ÑÁêÜ„ÄÇ</li>
</ul>
<table>
<thead>
<tr>
<th>ÊñπÊ≥ï</th>
<th>ÈÄÇÁî®Âú∫ÊôØ</th>
</tr>
</thead>
<tbody><tr>
<td>getSimpleDictByCode</td>
<td>ÂâçÁ´ØÂä†ËΩΩ‰∏ãÊãâÊ°Ü&#x2F;ÂçïÈÄâÊ°ÜÈÄâÈ°π</td>
</tr>
<tr>
<td>getSimpleDictByDictCodeAndDictKey</td>
<td>ÈÄöËøá code+key ÊòæÁ§∫ÂÖ∑‰ΩìÂ≠óÂÖ∏È°πÔºåÊØîÂ¶ÇÂ±ïÁ§∫‚ÄúÁî∑‚ÄùËÄå‰∏çÊòØ‚Äú1‚Äù</td>
</tr>
<tr>
<td>getSimpleDictByDictCodeAndDictValue</td>
<td>ÈÄöËøá code+value ÂèçÊü• keyÔºåÈÄÇÁî®‰∫éÊï∞ÊçÆÂÖ•Â∫ìÊàñÊØîÂØπ</td>
</tr>
</tbody></table>
<h4 id="GlobalDictionaryService"><a href="#GlobalDictionaryService" class="headerlink" title="GlobalDictionaryService"></a>GlobalDictionaryService</h4><p><strong>ÂÖ®Â±ÄÂ≠óÂÖ∏ÈÄöÁî®ÊúçÂä°Êé•Âè£</strong></p>
<ul>
<li>ÂÆÉÁöÑÊ†∏ÂøÉÁõÆÊ†áÊòØ‰∏∫Á≥ªÁªüÊèê‰æõÊó†ÈúÄÊåáÂÆöÁ≥ªÁªüÁºñÁ†ÅÔºàsystemCodeÔºâÁöÑÂ≠óÂÖ∏Êü•ËØ¢ËÉΩÂäõÔºå<strong>ÈÄÇÁî®‰∫éÈÄöÁî®ÊÄßÊõ¥Âº∫„ÄÅ‰∏çÂå∫ÂàÜÂ≠êÁ≥ªÁªüÁöÑÂ≠óÂÖ∏Êü•ËØ¢Âú∫ÊôØ</strong>„ÄÇ</li>
</ul>
<h2 id="9-2-goodskill-common-service"><a href="#9-2-goodskill-common-service" class="headerlink" title="9.2 goodskill-common-service"></a>9.2 goodskill-common-service</h2><p><img src="/img/blogs/java/goodskill/9.2.1.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="OssFileController"><a href="#OssFileController" class="headerlink" title="OssFileController"></a>OssFileController</h4><p>ÊòØ‰∏Ä‰∏™Âü∫‰∫é Spring Boot ÂÆûÁé∞ÁöÑ <strong>Êñá‰ª∂‰∏ä‰º†Âíå‰∏ãËΩΩÊéßÂà∂Âô®Á±ª</strong>ÔºåÂÆÉÁöÑ‰∏ªË¶Å‰ΩúÁî®ÊòØÔºö</p>
<ul>
<li><strong>Êèê‰æõÁªü‰∏ÄÁöÑÊé•Âè£</strong>ÔºåÁî®‰∫éÊé•Êî∂ÂâçÁ´Ø‰∏ä‰º†ÁöÑÊñá‰ª∂ÔºåÂπ∂Â∞ÜÊñá‰ª∂‰∏ä‰º†Âà∞ MinIOÔºåÂêåÊó∂‰øùÂ≠òÊñá‰ª∂‰ø°ÊÅØÔºàÂ¶Ç MD5„ÄÅÊñá‰ª∂ÂêçÊò†Â∞ÑÔºâÂà∞ MongoDB ‰∏≠ÔºõÂêåÊó∂Êèê‰æõÊñá‰ª∂‰∏ãËΩΩÊé•Âè£ÔºåÊîØÊåÅËøîÂõûÊñá‰ª∂ÁöÑ‰∫åËøõÂà∂ÊµÅÊàñÁîüÊàê‰∏¥Êó∂‰∏ãËΩΩ URL„ÄÇ</li>
</ul>
<h4 id="FileNameMapping"><a href="#FileNameMapping" class="headerlink" title="FileNameMapping"></a>FileNameMapping</h4><p>‰Ωú‰∏∫<strong>Êñá‰ª∂ÂêçÊò†Â∞Ñ‰ø°ÊÅØÁöÑÂÆû‰ΩìÁ±ª</strong>Ôºå<strong>Áî®‰∫éÂ≠òÂÇ®‰∏ä‰º†Êñá‰ª∂ÁöÑÂÖÉÊï∞ÊçÆ‰ø°ÊÅØ</strong>Ôºå<strong>Âπ∂ÊåÅ‰πÖÂåñÂà∞ MongoDB</strong> ÁöÑ oss_file_name_mapping ÈõÜÂêà‰∏≠„ÄÇ</p>
<h4 id="FileNameMappingRepository"><a href="#FileNameMappingRepository" class="headerlink" title="FileNameMappingRepository"></a>FileNameMappingRepository</h4><p>Áî®‰∫é<strong>Êìç‰Ωú MongoDB ÁöÑ Êï∞ÊçÆËÆøÈóÆÂ±ÇÊé•Âè£</strong>ÔºàRepositoryÔºâÔºåÁªßÊâøËá™ Spring Data Êèê‰æõÁöÑ MongoRepositoryÔºåÁî®‰∫é<strong>ÁÆ°ÁêÜ FileNameMapping ÂÆû‰ΩìÁöÑÊï∞ÊçÆÂ∫ìÊìç‰Ωú</strong>„ÄÇ</p>
<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÁ≠æÂêç</th>
<th>Êü•ËØ¢Êù°‰ª∂</th>
<th>ËøîÂõûÂÜÖÂÆπ</th>
<th>‰ΩúÁî®ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td>findByOriginalFileName(String originalFileName)</td>
<td>Ê†πÊçÆÂéüÂßãÊñá‰ª∂ÂêçÊü•ËØ¢</td>
<td><code>Optional&lt;FileNameMapping&gt;</code></td>
<td>Âà§Êñ≠Áî®Êà∑‰∏ä‰º†ÁöÑÊñá‰ª∂ÊòØÂê¶Â∑≤Â≠òÂú®</td>
</tr>
<tr>
<td>findByUniqueFileName(String uniqueFileName)</td>
<td>Ê†πÊçÆÂîØ‰∏ÄÊñá‰ª∂ÂêçÊü•ËØ¢</td>
<td><code>Optional&lt;FileNameMapping&gt;</code></td>
<td>Ê†πÊçÆ MinIO ‰∏äÁöÑÊñá‰ª∂ÂêçÊâæËÆ∞ÂΩï</td>
</tr>
<tr>
<td>findFirstByFileMd5(String fileMd5)</td>
<td>Ê†πÊçÆÊñá‰ª∂ MD5 Êü•ËØ¢‰∏ÄÊù°ËÆ∞ÂΩï</td>
<td><code>Optional&lt;FileNameMapping&gt;</code></td>
<td>Âà§Êñ≠ÊòØÂê¶‰∏ä‰º†ËøáÁõ∏ÂêåÂÜÖÂÆπÁöÑÊñá‰ª∂ÔºàÂÆûÁé∞Êñá‰ª∂ÂéªÈáçÈÄªËæëÔºâ</td>
</tr>
</tbody></table>
<h4 id="CommonServiceApplication"><a href="#CommonServiceApplication" class="headerlink" title="CommonServiceApplication"></a>CommonServiceApplication</h4><p>Áî®‰∫éÂêØÂä®Êï¥‰∏™ Common Service Ê®°ÂùóÁöÑÊúçÂä°</p>
<h2 id="9-3-goodskill-core"><a href="#9-3-goodskill-core" class="headerlink" title="9.3 goodskill-core"></a>9.3 goodskill-core</h2><p><img src="/img/blogs/java/goodskill/9.3.1.png" srcset="/img/loading.gif" lazyload></p>
<p>ÂàÜ‰∏∫‰∏â‰∏™Â≠êÊ®°ÂùóÔºö</p>
<ul>
<li>core-jwt</li>
<li>core-orm</li>
<li>core-util</li>
</ul>
<h3 id="9-3-1-core-jwt"><a href="#9-3-1-core-jwt" class="headerlink" title="9.3.1 core-jwt"></a>9.3.1 core-jwt</h3><p><img src="/img/blogs/java/goodskill/9.3.2.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="JwtUtils"><a href="#JwtUtils" class="headerlink" title="JwtUtils"></a>JwtUtils</h4><p><strong>JWT Â∑•ÂÖ∑Á±ª</strong></p>
<ul>
<li>Áî®‰∫éÂú®È°πÁõÆ‰∏≠ ÂàõÂª∫„ÄÅÈ™åËØÅÂíåËß£Êûê JWTÔºàJSON Web TokenÔºâ‰ª§ÁâåÔºåÂ∏∏Áî®‰∫éÁî®Êà∑Ë∫´‰ªΩËÆ§ËØÅÂíåÊéàÊùÉÂú∫ÊôØ„ÄÇ</li>
</ul>
<p>JwtUtils Â∞ÅË£Ö‰∫Ü JWT ÁöÑÂ∏∏Áî®Êìç‰ΩúÔºåÂåÖÊã¨Ôºö</p>
<ul>
<li>ÂàõÂª∫ TokenÔºàcreateTokenÔºâ</li>
<li>È™åËØÅ Token ÂêàÊ≥ïÊÄßÔºàverifyTokenÔºâ</li>
<li>Ëß£Êûê Token ‰∏≠ÁöÑÂÜÖÂÆπÔºàparseTokenÔºâ</li>
<li>ÁîüÊàêÁî®‰∫éÁ≠æÂêçÁöÑÂØÜÈí•ÔºàgenerateKeyÔºâ<br>ÈÄÇÂêàÂú®ÁôªÂΩïÊàêÂäüÂêéÁîüÊàê TokenÔºå‰∏ãÊ¨°ËÆøÈóÆÊé•Âè£Êó∂Áî®Ëøô‰∏™ Token È™åËØÅÁî®Êà∑Ë∫´‰ªΩ„ÄÇ</li>
</ul>
<h3 id="9-3-2-core-orm"><a href="#9-3-2-core-orm" class="headerlink" title="9.3.2 core-orm"></a>9.3.2 core-orm</h3><p><img src="/img/blogs/java/goodskill/9.3.3.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="FieldMetaObjectHandler"><a href="#FieldMetaObjectHandler" class="headerlink" title="FieldMetaObjectHandler"></a>FieldMetaObjectHandler</h4><p>ÊòØ MyBatis-Plus Êèê‰æõÁöÑ‰∏Ä‰∏™ <strong>Â≠óÊÆµËá™Âä®Â°´ÂÖÖÂ§ÑÁêÜÂô®</strong>ÔºåÁî®‰∫éÂú®ÊèíÂÖ•ÊàñÊõ¥Êñ∞Êï∞ÊçÆÂ∫ìËÆ∞ÂΩïÊó∂Ôºå<strong>Ëá™Âä®Â°´ÂÖÖÂÖ¨ÂÖ±Â≠óÊÆµ</strong>ÔºàÂ¶ÇÔºöcreateTime, updateTime, createUser, updateUser Á≠âÔºâÔºåÈÅøÂÖçÊâãÂä®ËµãÂÄºÔºåÁÆÄÂåñÂºÄÂèë„ÄÇ</p>
<ul>
<li>FieldMetaObjectHandler ÊòØ‰∏∫‰∫ÜËß£ÂÜ≥‰Ω†Âú®Êñ∞Â¢ûÊàñÊõ¥Êñ∞Êï∞ÊçÆÊó∂Ôºå‰∏çÁî®ÊØèÊ¨°ÈÉΩÊâãÂä®ËÆæÁΩÆ ÂàõÂª∫‰∫∫&#x2F;ÂàõÂª∫Êó∂Èó¥&#x2F;Êõ¥Êñ∞‰∫∫&#x2F;Êõ¥Êñ∞Êó∂Èó¥ÔºåMyBatis-Plus Â∏Æ‰Ω†Ëá™Âä®ÊêûÂÆö„ÄÇ</li>
</ul>
<h4 id="MybatisPlusConfig"><a href="#MybatisPlusConfig" class="headerlink" title="MybatisPlusConfig"></a>MybatisPlusConfig</h4><p>ÊòØ‰∏Ä‰∏™ MyBatis-Plus ÁöÑÈÖçÁΩÆÁ±ªÔºå‰∏ªË¶Å‰ΩúÁî®ÊòØ<strong>ÈÖçÁΩÆÂàÜÈ°µÊèí‰ª∂Ôºå‰ª•ÊîØÊåÅÊï∞ÊçÆÂ∫ìÁöÑÂàÜÈ°µÊü•ËØ¢ÂäüËÉΩ</strong>„ÄÇ</p>
<ul>
<li>Âêë Spring ÂÆπÂô®‰∏≠Ê≥®ÂÖ• MybatisPlusInterceptorÔºåÂπ∂Ê≥®ÂÜåÂàÜÈ°µÊã¶Êà™Âô® PaginationInnerInterceptorÔºåÁî®‰∫éÂºÄÂêØ MyBatis-Plus ÁöÑÂàÜÈ°µÂäüËÉΩ„ÄÇ</li>
</ul>
<h3 id="9-3-3-core-util"><a href="#9-3-3-core-util" class="headerlink" title="9.3.3 core-util"></a>9.3.3 core-util</h3><p><img src="/img/blogs/java/goodskill/9.3.4.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="constantÂåÖ"><a href="#constantÂåÖ" class="headerlink" title="constantÂåÖ"></a>constantÂåÖ</h4><ul>
<li><code>SeckillStatusConstant</code>ÔºöÂÆö‰πâÁßíÊùÄÊ¥ªÂä®Áä∂ÊÄÅÁöÑÂ∏∏Èáè</li>
</ul>
<h4 id="entityÂåÖ"><a href="#entityÂåÖ" class="headerlink" title="entityÂåÖ"></a>entityÂåÖ</h4><ul>
<li><code>BaseColEntity</code> ÊòØ‰∏Ä‰∏™ ÈÄöÁî®ÁöÑÂü∫Á°ÄÁ±ªÔºå‰∏ªË¶Å‰ΩúÁî®ÊòØ<strong>‰∏∫Á≥ªÁªü‰∏≠ÁªùÂ§ßÈÉ®ÂàÜÂÆû‰ΩìÁ±ªÊèê‰æõÂÖ¨ÂÖ±Â≠óÊÆµÔºåÊØîÂ¶ÇÔºöcreateTime„ÄÅupdateTime„ÄÅcreateUser Âíå updateUser</strong>, Áî®‰∫éÂ∞ÅË£ÖÂÆû‰ΩìÁ±ª‰∏≠Â∏∏ËßÅÁöÑÂÆ°ËÆ°Â≠óÊÆµÔºàËÆ∞ÂΩïÂàõÂª∫„ÄÅÊõ¥Êñ∞‰∫∫ÂíåÊó∂Èó¥ÔºâÔºåÊñπ‰æø‰ª£Á†ÅÂ§çÁî®ÔºåÂáèÂ∞ëÂÜó‰Ωô„ÄÇ</li>
</ul>
<h4 id="enumsÂåÖ"><a href="#enumsÂåÖ" class="headerlink" title="enumsÂåÖ"></a>enumsÂåÖ</h4><ul>
<li><code>ActivityEvent</code>Ôºö Êûö‰∏æÂêÑ‰∏™ÊîØ‰ªò‰∫ã‰ª∂</li>
<li><code>CommonConstants</code>: ÂÖ¨ÂÖ±Â∏∏ÈáèÁ±ªÔºåÂåÖÂê´Áî®Êà∑Ë¥¶Êà∑Áä∂ÊÄÅ</li>
<li><code>Events</code>: Êûö‰∏æÂêÑ‰∏™ÊîØ‰ªò‰∫ã‰ª∂(ÂíåActivityEvent‰∏ÄÊ†∑) </li>
<li><code>SeckillSolutionEnum</code>: Êûö‰∏æÂêÑ‰∏™ÁßíÊùÄÂú∫ÊôØ</li>
<li><code>SeckillStatEnum</code>: Êûö‰∏æÁßíÊùÄÁä∂ÊÄÅ</li>
<li><code>States</code>: ÁßíÊùÄÊ¥ªÂä®Áä∂ÊÄÅÊûö‰∏æ</li>
<li><code>UserAccountEnum</code>: Êûö‰∏æÁî®Êà∑Ë¥¶Êà∑ÁôªÂΩïÁä∂ÊÄÅ</li>
</ul>
<h4 id="exceptionÂåÖ"><a href="#exceptionÂåÖ" class="headerlink" title="exceptionÂåÖ"></a>exceptionÂåÖ</h4><ul>
<li><code>CommonException</code>: Ëá™ÂÆö‰πâÊôÆÈÄöÂºÇÂ∏∏</li>
<li><code>SeckillException</code>: Ëá™ÂÆö‰πâÁßíÊùÄÂºÇÂ∏∏</li>
<li><code>SeckillCloseException</code>: Ëá™ÂÆö‰πâÁßíÊùÄÂÖ≥Èó≠ÂºÇÂ∏∏</li>
</ul>
<h4 id="feignÂåÖ"><a href="#feignÂåÖ" class="headerlink" title="feignÂåÖ"></a>feignÂåÖ</h4><ul>
<li><code>FeignHeaderInterceptor</code> ÁöÑ‰ΩúÁî®ÊòØ <strong>Êã¶Êà™Âπ∂‰º†ÈÄí HTTP ËØ∑Ê±Ç‰∏≠ÁöÑÂ§¥ÈÉ®‰ø°ÊÅØ</strong>Ôºå‰ΩøÂæóÂú®‰ΩøÁî® Feign ËøõË°åËøúÁ®ãË∞ÉÁî®Êó∂ÔºåËÉΩÂ§üÂ∞ÜÂΩìÂâçËØ∑Ê±ÇÁöÑÂ§¥ÈÉ®‰ø°ÊÅØËá™Âä®Ê∑ªÂä†Âà∞ Feign ËØ∑Ê±ÇÁöÑÂ§¥ÈÉ®„ÄÇ</li>
</ul>
<h4 id="infoÂåÖ"><a href="#infoÂåÖ" class="headerlink" title="infoÂåÖ"></a>infoÂåÖ</h4><ul>
<li><code>ResultCode</code>Ôºö Êûö‰∏æÁ≥ªÁªüÂìçÂ∫îÁ†Å</li>
</ul>
<h5 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h5><p>ÈÄöÁî®ÁöÑÂìçÂ∫îÂ∞ÅË£ÖÁ±ªÔºåÁî®‰∫é<strong>Áªü‰∏ÄÂ∞ÅË£Ö API ÂìçÂ∫îÁªìÊûú</strong></p>
<ul>
<li>Áªü‰∏ÄÂ∞ÅË£Ö API ÂìçÂ∫îÁªìÊûúÔºå‰ΩøÂæóÊâÄÊúâÊé•Âè£ÁöÑËøîÂõûÁªìÊûÑ‰øùÊåÅ‰∏ÄËá¥„ÄÇ</li>
<li>Êèê‰æõ‰∫ÜÈÄöÁî®ÁöÑËøîÂõûÁ†ÅÔºàÂ¶ÇÊàêÂäü„ÄÅÂ§±Ë¥•ÔºâÂíåÂìçÂ∫î‰ø°ÊÅØÂ≠óÊÆµÔºå‰æø‰∫éÂÆ¢Êà∑Á´ØÂ§ÑÁêÜ„ÄÇ</li>
</ul>
<h5 id="ApiResult"><a href="#ApiResult" class="headerlink" title="ApiResult"></a>ApiResult</h5><p><strong>API ÂìçÂ∫îÁªìÊûúÁöÑÂ∞ÅË£ÖÁ±ª</strong>ÔºåÁî®‰∫éÁªü‰∏ÄÁÆ°ÁêÜÊé•Âè£ËøîÂõûÁöÑÊï∞ÊçÆÊ†ºÂºè</p>
<ul>
<li>ApiResult Á±ª‰∏ªË¶ÅÁî®‰∫éÂ∞ÅË£Ö API ÁöÑÂìçÂ∫îÂÜÖÂÆπ„ÄÇÈÄöËøáËØ•Á±ªÔºåÂºÄÂèëËÄÖÂèØ‰ª•Áªü‰∏ÄÂÆö‰πâÊé•Âè£ËøîÂõûÁöÑÊ†ºÂºèÔºå‰ΩøÂæóÊé•Âè£ÁöÑÂìçÂ∫îÁªìÊûÑÂú®Á≥ªÁªü‰∏≠‰øùÊåÅ‰∏ÄËá¥„ÄÇ</li>
</ul>
<h4 id="pojoÂåÖ"><a href="#pojoÂåÖ" class="headerlink" title="pojoÂåÖ"></a>pojoÂåÖ</h4><ul>
<li><code>UserBO</code> Á±ªÊòØ‰∏Ä‰∏™Áî®‰∫éË°®Á§∫ <strong>Áî®Êà∑Âü∫Êú¨‰ø°ÊÅØÁöÑ‰∏öÂä°ÂØπË±°</strong>ÔºàBO, Business ObjectÔºâ„ÄÇÂÆÉÂ∞ÅË£Ö‰∫Ü‰∏éÁî®Êà∑Áõ∏ÂÖ≥ÁöÑÊâÄÊúâÂü∫Á°Ä‰ø°ÊÅØÔºåÈÄöÂ∏∏Áî®‰∫éÂú®Á≥ªÁªü‰∏≠‰º†ÈÄíÊàñÊåÅ‰πÖÂåñÁî®Êà∑Êï∞ÊçÆ„ÄÇ</li>
<li><code>AuthResponseDTO</code> Á±ªÊòØ‰∏Ä‰∏™ <strong>Áî®Êà∑Èâ¥ÊùÉÊúçÂä°ÁöÑÂìçÂ∫îÊï∞ÊçÆ‰º†ËæìÂØπË±°</strong>„ÄÇÂÆÉÁî®‰∫éÂú®Áî®Êà∑ËÆ§ËØÅÊàêÂäüÂêéÂêëÂÆ¢Êà∑Á´ØËøîÂõûËÆ§ËØÅ‰ø°ÊÅØ„ÄÇ</li>
<li><code>SeckillWebMockRequestDTO</code> Á±ªÊòØ‰∏Ä‰∏™ <strong>Ê®°ÊãüÁßíÊùÄËØ∑Ê±Ç</strong>ÁöÑ DTOÔºåÁî®‰∫éÊ®°ÊãüÁßíÊùÄÊ¥ªÂä®‰∏≠ÁöÑËØ∑Ê±ÇÊï∞ÊçÆ„ÄÇËØ•Á±ªÂèØËÉΩÁî®‰∫éÊµãËØï„ÄÅÊ®°ÊãüÊàñË∞ÉËØïÁßíÊùÄÁ≥ªÁªüÁöÑÂäüËÉΩ</li>
</ul>
<h4 id="utilÂåÖ"><a href="#utilÂåÖ" class="headerlink" title="utilÂåÖ"></a>utilÂåÖ</h4><ul>
<li><code>HeaderUtil</code>: ‰ªéÂΩìÂâçËØ∑Ê±ÇÁöÑ Header ‰∏≠ÊèêÂèñ userId„ÄÇ</li>
<li><code>MD5Util</code>: ÁîüÊàêÂíåËé∑Âèñmd5Âä†ÂØÜ</li>
<li><code>UserInfoUtil</code>: Áî®Êà∑‰ø°ÊÅØÂ∑•ÂÖ∑Á±ªÔºå‰∏ªË¶ÅÁî®‰∫é‰ªéÂΩìÂâçËØ∑Ê±Ç‰∏≠ÊèêÂèñÁî®Êà∑‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h1 id="10-goodskill-gateway-ÂæÆÊúçÂä°APIÁΩëÂÖ≥ÔºåÁªü‰∏ÄÊúçÂä°Èâ¥ÊùÉÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±Âä†ËΩΩ"><a href="#10-goodskill-gateway-ÂæÆÊúçÂä°APIÁΩëÂÖ≥ÔºåÁªü‰∏ÄÊúçÂä°Èâ¥ÊùÉÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±Âä†ËΩΩ" class="headerlink" title="10. goodskill-gateway (ÂæÆÊúçÂä°APIÁΩëÂÖ≥ÔºåÁªü‰∏ÄÊúçÂä°Èâ¥ÊùÉÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±Âä†ËΩΩ)"></a>10. goodskill-gateway (ÂæÆÊúçÂä°APIÁΩëÂÖ≥ÔºåÁªü‰∏ÄÊúçÂä°Èâ¥ÊùÉÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±Âä†ËΩΩ)</h1><p><img src="/img/blogs/java/goodskill/10.1.1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="10-1-configÂåÖ"><a href="#10-1-configÂåÖ" class="headerlink" title="10.1 configÂåÖ"></a>10.1 configÂåÖ</h2><ul>
<li>GatewayConfiguration</li>
<li>SaTokenConfiguration</li>
<li>StpInterfaceImpl</li>
</ul>
<h4 id="GatewayConfiguration"><a href="#GatewayConfiguration" class="headerlink" title="GatewayConfiguration"></a>GatewayConfiguration</h4><p><strong>ÈÖçÁΩÆ Spring Cloud Gateway ÁΩëÂÖ≥Ë∑ØÁî±</strong></p>
<ul>
<li>‰∏∫ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑ Spring Cloud Gateway ÁΩëÂÖ≥ÊúçÂä° Êèê‰æõ Ë∑ØÁî±ËΩ¨ÂèëËÉΩÂäõÂíåËøúÁ®ãË∞ÉÁî®ÁöÑÂÖºÂÆπÊîØÊåÅ„ÄÇ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GatewayConfiguration</span> &#123;<br><br>    <span class="hljs-comment">// ÂÆö‰πâÁΩëÂÖ≥Ë∑ØÁî±ËßÑÂàô</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title function_">customizedLocator</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> &#123;<br>        <span class="hljs-keyword">return</span> builder.routes()<br>                .route(<span class="hljs-string">&quot;goodskill-order&quot;</span>, r -&gt; r.path(<span class="hljs-string">&quot;/api/order/**&quot;</span>)<br>                        .filters(f -&gt; f.stripPrefix(<span class="hljs-number">2</span>))<br>                        .uri(<span class="hljs-string">&quot;lb://goodskill-order&quot;</span>))<br>                .route(<span class="hljs-string">&quot;goodskill-seata&quot;</span>, r -&gt; r.path(<span class="hljs-string">&quot;/api/seata/**&quot;</span>)<br>                        .filters(f -&gt; f.stripPrefix(<span class="hljs-number">2</span>))<br>                        .uri(<span class="hljs-string">&quot;lb://goodskill-seata&quot;</span>))<br>                .route(<span class="hljs-string">&quot;goodskill-seckill&quot;</span>, r -&gt; r.path(<span class="hljs-string">&quot;/api/seckill/**&quot;</span>)<br>                        .filters(f -&gt; f.stripPrefix(<span class="hljs-number">2</span>))<br>                        .uri(<span class="hljs-string">&quot;lb://goodskill-seckill&quot;</span>))<br>                .route(<span class="hljs-string">&quot;goodskill-auth&quot;</span>, r -&gt; r.path(<span class="hljs-string">&quot;/api/auth/**&quot;</span>)<br>                        .filters(f -&gt; f.stripPrefix(<span class="hljs-number">2</span>))<br>                        .uri(<span class="hljs-string">&quot;lb://goodskill-auth&quot;</span>))<br>                .route(<span class="hljs-string">&quot;goodskill-web&quot;</span>, r -&gt; r.path(<span class="hljs-string">&quot;/api/web/**&quot;</span>)<br>                        .filters(f -&gt; f.stripPrefix(<span class="hljs-number">2</span>))<br>                        .uri(<span class="hljs-string">&quot;lb://goodskill-web&quot;</span>))<br>                .build();<br>    &#125;<br><br>    <span class="hljs-comment">// ‰øÆÂ§ç‰ΩøÁî®feign clientËøúÁ®ãË∞ÉÁî®ÊúçÂä°Êó∂Êä•HttpMessageConvertersÁº∫Â§±ÈóÆÈ¢ò</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> HttpMessageConverters <span class="hljs-title function_">messageConverters</span><span class="hljs-params">(ObjectProvider&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpMessageConverters</span>(converters.orderedStream().collect(Collectors.toList()));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ÊñπÊ≥ï</th>
<th>ÂäüËÉΩ</th>
</tr>
</thead>
<tbody><tr>
<td>customizedLocator</td>
<td>ÂÆö‰πâÁΩëÂÖ≥Ë∑ØÁî±ËßÑÂàôÔºåÂ∞Ü &#x2F;api&#x2F;‚Ä¶ Ë∑ØÂæÑËΩ¨ÂèëÁªôÂØπÂ∫îÂæÆÊúçÂä°ÔºåÊîØÊåÅË∑ØÂæÑÂâçÁºÄÂâ•Á¶ª„ÄÅÊúçÂä°ÂêçË∑ØÁî±Á≠â</td>
</tr>
<tr>
<td>messageConverters</td>
<td>Èò≤Ê≠¢ Feign ‰ΩøÁî®‰∏≠ HTTP Ê∂àÊÅØËΩ¨Êç¢Âô®Áº∫Â§±ÁöÑÈóÆÈ¢òÔºå‰øùÈöúËøúÁ®ãË∞ÉÁî®ÁöÑÊï∞ÊçÆËΩ¨Êç¢Ê≠£Â∏∏</td>
</tr>
</tbody></table>
<h4 id="SaTokenConfiguration"><a href="#SaTokenConfiguration" class="headerlink" title="SaTokenConfiguration"></a>SaTokenConfiguration</h4><p>Sa-Token ÊùÉÈôêËÆ§ËØÅÊ°ÜÊû∂ÁöÑ <strong>ÂÖ®Â±ÄÈÖçÁΩÆÁ±ª</strong>ÔºåÂÖ∂‰∏ªË¶Å‰ΩúÁî®ÊòØ<strong>Âú®ÁΩëÂÖ≥Â±ÇÁªü‰∏ÄÂ§ÑÁêÜÁôªÂΩïÊ†°È™å„ÄÅÊùÉÈôêÊéßÂà∂„ÄÅÊîæË°åÁôΩÂêçÂçï„ÄÅÂºÇÂ∏∏Â§ÑÁêÜÁ≠âÈÄªËæë</strong>„ÄÇ</p>
<ul>
<li>ÈÖçÁΩÆ Sa-Token ÁöÑÂÖ®Â±ÄËøáÊª§Âô®ÔºåÂØπÊâÄÊúâËØ∑Ê±ÇËøõË°åÁªü‰∏ÄÁöÑÊùÉÈôêËÆ§ËØÅÂ§ÑÁêÜ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [Sa-Token ÊùÉÈôêËÆ§ËØÅ] ÂÖ®Â±ÄÈÖçÁΩÆÁ±ª</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaTokenConfiguration</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> IgnoreProperties ignoreProperties;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê≥®ÂÜå [Sa-TokenÂÖ®Â±ÄËøáÊª§Âô®]Ôºå‰ºòÂÖàÁ∫ßÈ´ò‰∫éGlobalFilterÔºåÂç≥Âú®GlobalFilter‰πãÂâçÊâßË°å</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> SaReactorFilter <span class="hljs-title function_">getSaReactorFilter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaReactorFilter</span>()<br>                <span class="hljs-comment">// ÊåáÂÆö [Êã¶Êà™Ë∑ØÁî±]</span><br>                .addInclude(<span class="hljs-string">&quot;/**&quot;</span>)    <span class="hljs-comment">/* Êã¶Êà™ÊâÄÊúâpath */</span><br>                <span class="hljs-comment">// ÊåáÂÆö [ÊîæË°åË∑ØÁî±]</span><br>                .addExclude(<span class="hljs-string">&quot;/favicon.ico&quot;</span>, <span class="hljs-string">&quot;/actuator/**&quot;</span>)<br>                <span class="hljs-comment">// ÊåáÂÆö[ËÆ§ËØÅÂáΩÊï∞]: ÊØèÊ¨°ËØ∑Ê±ÇÊâßË°å</span><br>                .setAuth(obj -&gt; &#123;<br>                    <span class="hljs-comment">// ÊâìÂç∞Ë∑ØÂæÑ</span><br>                    <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> SaReactorSyncHolder.getContext().getRequest();<br>                    <span class="hljs-type">RequestPath</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> request.getPath();<br>                    log.info(<span class="hljs-string">&quot;---------- saÂÖ®Â±ÄËÆ§ËØÅ, ËØ∑Ê±Çurl:&#123;&#125;&quot;</span>, path);<br>                    SaRouter.notMatch(ignoreProperties.getWhiteUrl())<br>                            .check(r -&gt; &#123;<br>                                StpUtil.checkLogin();<br>                                request.mutate().header(USER_ID_HEADER, StpUtil.getLoginId() + <span class="hljs-string">&quot;&quot;</span>);<br>                                List&lt;String&gt; userWhiteUrlList = ignoreProperties.getLoginUserWhiteUrls();<br>                                <span class="hljs-comment">// ÁôªÂΩïÁî®Êà∑ÁôΩÂêçÂçïÊé•Âè£ÊîæË°å</span><br>                                <span class="hljs-keyword">if</span> (!ifMatchUserLoginWhiteUrl(userWhiteUrlList, path)) &#123;<br><span class="hljs-comment">//                                    StpUtil.checkPermission(path.value());</span><br>                                &#125;<br>                            &#125;);<br>                &#125;)<br>                <span class="hljs-comment">// ÊåáÂÆö[ÂºÇÂ∏∏Â§ÑÁêÜÂáΩÊï∞]ÔºöÊØèÊ¨°[ËÆ§ËØÅÂáΩÊï∞]ÂèëÁîüÂºÇÂ∏∏Êó∂ÊâßË°åÊ≠§ÂáΩÊï∞</span><br>                .setError(e -&gt; &#123;<br>                    log.error(<span class="hljs-string">&quot;---------- saÂÖ®Â±ÄÂºÇÂ∏∏&quot;</span>, e);<br>                    <span class="hljs-keyword">return</span> SaResult.error(e.getMessage());<br>                &#125;);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Âà§Êñ≠ÂΩìÂâçurlÊòØÂê¶ÂëΩ‰∏≠ÁôΩÂêçÂçï</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">ifMatchUserLoginWhiteUrl</span><span class="hljs-params">(List&lt;String&gt; userWhite, RequestPath path)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">found</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">for</span> (String pattern : userWhite) &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">match</span> <span class="hljs-operator">=</span> SaPathMatcherHolder.getPathMatcher().match(pattern, path.value());<br>            <span class="hljs-keyword">if</span> (match) &#123;<br>                found = <span class="hljs-literal">true</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> found;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th>ÂäüËÉΩÊ®°Âùó</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td>ÁôªÂΩïÊ†°È™å</td>
<td>ÈùûÁôΩÂêçÂçïÊé•Âè£ÂøÖÈ°ªÁôªÂΩïÊâçËÉΩËÆøÈóÆ</td>
</tr>
<tr>
<td>ÊùÉÈôêÊéßÂà∂</td>
<td>ÁôªÂΩïÂêéÂèØÊãìÂ±ïÊéßÂà∂Áî®Êà∑ËÆøÈóÆÂì™‰∫õÊé•Âè£ÔºàÈ¢ÑÁïôÊùÉÈôêÊ†°È™å‰ª£Á†ÅÔºâ</td>
</tr>
<tr>
<td>ÁôΩÂêçÂçïÊú∫Âà∂</td>
<td>ÊîØÊåÅÈÖçÁΩÆÂÖ®Â±ÄÁôΩÂêçÂçï + ÁôªÂΩïÁî®Êà∑ÁôΩÂêçÂçï</td>
</tr>
<tr>
<td>ÂºÇÂ∏∏Áªü‰∏ÄÂ§ÑÁêÜ</td>
<td>ÊâÄÊúâÂºÇÂ∏∏ÈÉΩË¢´Áªü‰∏ÄÊçïËé∑ËøîÂõûÊ†ºÂºèÂåñÁöÑÈîôËØØÂìçÂ∫î</td>
</tr>
<tr>
<td>ÂÖºÂÆπÊÄßÂ•Ω</td>
<td>Âü∫‰∫é Sa-Token + Spring Cloud GatewayÔºåÈÄÇÁî®‰∫éÂæÆÊúçÂä°Êû∂ÊûÑ</td>
</tr>
</tbody></table>
<h4 id="StpInterfaceImpl"><a href="#StpInterfaceImpl" class="headerlink" title="StpInterfaceImpl"></a>StpInterfaceImpl</h4><p>Sa-Token Ê°ÜÊû∂‰∏≠Áî®‰∫é <strong>Ëá™ÂÆö‰πâÊùÉÈôêÂíåËßíËâ≤Âä†ËΩΩÈÄªËæëÁöÑÂÆûÁé∞Á±ª</strong>ÔºåÂÆÉÈÄöËøáËøúÁ®ãË∞ÉÁî®Áî®Êà∑ÊùÉÈôêÊúçÂä°ÔºàauthFeignClientÔºâÊù•Âä®ÊÄÅËé∑ÂèñÁî®Êà∑ÁöÑÊùÉÈôêÂíåËßíËâ≤„ÄÇ</p>
<ul>
<li>Ê†πÊçÆÁî®Êà∑ÁöÑ loginId Âä†ËΩΩÂÖ∂ÊùÉÈôêÁ†ÅÈõÜÂêàÂíåËßíËâ≤ÈõÜÂêàÔºåÁî®‰∫é StpUtil.checkPermission()„ÄÅStpUtil.checkRole() ËøôÊ†∑ÁöÑÊùÉÈôêÂà§Êñ≠ÊñπÊ≥ï</li>
<li>ÁªìÂêà Sa-Token ÁöÑÊùÉÈôêÊéßÂà∂Êú∫Âà∂Ôºå<strong>ÂÆûÁé∞Âú®ÁôªÂΩïÂêéÂä®ÊÄÅËé∑ÂèñÁî®Êà∑ÊùÉÈôêÂíåËßíËâ≤‰ø°ÊÅØ</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// sa-tokenËá™ÂÆö‰πâÊùÉÈôêÂä†ËΩΩÊé•Âè£ÂÆûÁé∞Á±ª</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StpInterfaceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StpInterface</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> AuthFeignClient authFeignClient;<br><br><br>    <span class="hljs-comment">// ËøîÂõû‰∏Ä‰∏™Ë¥¶Âè∑ÊâÄÊã•ÊúâÁöÑÊùÉÈôêÁ†ÅÈõÜÂêà</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getPermissionList</span><span class="hljs-params">(Object loginId, String loginType)</span> &#123;<br>        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; authFeignClient.listUserPermission(String.valueOf(loginId), loginType)).join();<br>    &#125;<br><br><br>    <span class="hljs-comment">// ËøîÂõû‰∏Ä‰∏™Ë¥¶Âè∑ÊâÄÊã•ÊúâÁöÑËßíËâ≤Ê†áËØÜÈõÜÂêà (ÊùÉÈôê‰∏éËßíËâ≤ÂèØÂàÜÂºÄÊ†°È™å)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getRoleList</span><span class="hljs-params">(Object loginId, String loginType)</span> &#123;<br>        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; authFeignClient.listUserRole(String.valueOf(loginId), loginType)).join();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>ËøîÂõûÂÄº</th>
<th>‰ΩúÁî®ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td>getPermissionList(Object loginId, String loginType)</td>
<td><code>List&lt;String&gt;</code></td>
<td>Ê†πÊçÆ loginId Ëé∑ÂèñËØ•Áî®Êà∑ÁöÑÊùÉÈôêÂàóË°®ÔºàÂ¶ÇÔºöuser:add, order:view Á≠âÔºâÔºå‰æõÊùÉÈôêÊ≥®Ëß£ÊàñÊñπÊ≥ïË∞ÉÁî®‰ΩøÁî®</td>
</tr>
<tr>
<td>getRoleList(Object loginId, String loginType)</td>
<td><code>List&lt;String&gt;</code></td>
<td>Ëé∑ÂèñËØ•Áî®Êà∑ÊâÄÂ±ûÁöÑËßíËâ≤ÂàóË°®ÔºàÂ¶ÇÔºöadmin, user, super_adminÔºâÔºå‰æõËßíËâ≤Ê≥®Ëß£ÊàñÊñπÊ≥ïË∞ÉÁî®‰ΩøÁî®</td>
</tr>
</tbody></table>
<h2 id="10-2-feignÂåÖ"><a href="#10-2-feignÂåÖ" class="headerlink" title="10.2 feignÂåÖ"></a>10.2 feignÂåÖ</h2><h4 id="AuthFeignClientÊé•Âè£-1"><a href="#AuthFeignClientÊé•Âè£-1" class="headerlink" title="AuthFeignClientÊé•Âè£"></a>AuthFeignClientÊé•Âè£</h4><p>Feign ÂÆ¢Êà∑Á´ØÊé•Âè£ÔºåÁî®‰∫éÂú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ <strong>ËøúÁ®ãË∞ÉÁî® goodskill-auth ÊúçÂä°</strong>ÁöÑÊé•Âè£Ôºå‰∏ìÈó®<strong>Áî®‰∫éËé∑ÂèñÁî®Êà∑ÁöÑÊùÉÈôê‰ø°ÊÅØÂíåËßíËâ≤‰ø°ÊÅØ</strong>„ÄÇ</p>
<h2 id="10-3-properties"><a href="#10-3-properties" class="headerlink" title="10.3 properties"></a>10.3 properties</h2><h4 id="IgnoreProperties"><a href="#IgnoreProperties" class="headerlink" title="IgnoreProperties"></a>IgnoreProperties</h4><p>ÈÖçÁΩÆ Êé•Âè£ÁôΩÂêçÂçï ÁöÑ Spring ÈÖçÁΩÆÁ±ªÔºå‰ΩúÁî®ÊòØÔºö</p>
<ul>
<li>‰ªéÈÖçÁΩÆÊñá‰ª∂‰∏≠ËØªÂèñ‰∏çÈúÄË¶ÅÊùÉÈôêÊ†°È™åÁöÑ URL ÂàóË°®ÔºàÁôΩÂêçÂçïÔºâÔºåÂπ∂Êèê‰æõÁªôÊùÉÈôêÊ°ÜÊû∂ÔºàÂ¶Ç Sa-TokenÔºâ‰ΩøÁî®„ÄÇ</li>
<li>Áî®‰∫éÂä†ËΩΩÂπ∂ÁÆ°ÁêÜ <strong>ÁôΩÂêçÂçï URL ÂàóË°®</strong>Ôºà‰∏çÊã¶Êà™„ÄÅÊó†ÈúÄÁôªÂΩïÂç≥ÂèØËÆøÈóÆÔºâ</li>
</ul>
<h2 id="10-4-service"><a href="#10-4-service" class="headerlink" title="10.4 service"></a>10.4 service</h2><ul>
<li>DynamicRouteConfigWatcher</li>
<li>DynamicRouteRefresh</li>
</ul>
<h4 id="DynamicRouteConfigWatcher"><a href="#DynamicRouteConfigWatcher" class="headerlink" title="DynamicRouteConfigWatcher"></a>DynamicRouteConfigWatcher</h4><p><strong>Âä®ÊÄÅÁΩëÂÖ≥Ë∑ØÁî±ÈÖçÁΩÆÁõëÂê¨Âô®ÂíåÂàùÂßãÂåñÂô®</strong>ÔºåÂÆÉÁöÑÊ†∏ÂøÉ‰ΩúÁî®ÊòØÔºö</p>
<ul>
<li>‰ªé Nacos ‰∏≠ËØªÂèñ„ÄÅÁõëÂê¨Âπ∂Â∫îÁî®Âä®ÊÄÅË∑ØÁî±ÈÖçÁΩÆÔºåÁî®‰∫é Spring Cloud Gateway ÁöÑÂä®ÊÄÅË∑ØÁî±ÁÆ°ÁêÜ„ÄÇ</li>
</ul>
<ol>
<li>ÂàùÂßãÂåñÁΩëÂÖ≥Ë∑ØÁî±ÈÖçÁΩÆÔºà‰ªé Nacos Ëé∑ÂèñÔºâ</li>
<li>ÁõëÂê¨ Nacos ‰∏≠Ë∑ØÁî±ÈÖçÁΩÆÂèòÂåñÂπ∂Ëá™Âä®Êõ¥Êñ∞ÁΩëÂÖ≥Ë∑ØÁî±</li>
<li>ÂêØÂä®Êó∂Âä†ËΩΩÂΩìÂâçÈÖçÁΩÆ</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Âä®ÊÄÅË∑ØÁî±ÈÖçÁΩÆÁõëÂê¨‰ª•ÂèäÂàùÂßãÂåñ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicRouteConfigWatcher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DynamicRouteRefresh dynamicRouteService;<br><br>    <span class="hljs-keyword">private</span> ConfigService configService;<br>    <span class="hljs-meta">@Value(&quot;$&#123;spring.cloud.nacos.server-addr&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String NACOS_SERVER_ADDR;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;spring.cloud.nacos.namespace:&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String NACOS_NAMESPACE;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;spring.cloud.nacos.group:DEFAULT_GROUP&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String NACOS_ROUTE_GROUP;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;spring.cloud.nacos.username&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String NACOS_USERNAME;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;spring.cloud.nacos.password&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String NACOS_PASSWORD;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;nacos.router.data.id&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String NACOS_ROUTE_DATA_ID;<br><br>    <span class="hljs-comment">// ÂàùÂßãÂåñÊó∂Ë∞ÉÁî®ÔºöÁî®‰∫éÂàùÂßãÂåñ ConfigService Âπ∂Ê≥®ÂÜåË∑ØÁî±ÈÖçÁΩÆÁõëÂê¨Âô®</span><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        log.info(<span class="hljs-string">&quot;gateway route init...&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            configService = initConfigService();<br>            <span class="hljs-keyword">if</span> (configService == <span class="hljs-literal">null</span>) &#123;<br>                log.warn(<span class="hljs-string">&quot;initConfigService fail&quot;</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;ÂàùÂßãÂåñÁΩëÂÖ≥Ë∑ØÁî±Êó∂ÂèëÁîüÈîôËØØ&quot;</span>, e);<br>        &#125;<br>        dynamicRouteByNacosListener(NACOS_ROUTE_DATA_ID, NACOS_ROUTE_GROUP);<br>    &#125;<br><br>    <span class="hljs-comment">// ÁõëÂê¨ÊåáÂÆöÁöÑ Nacos Ë∑ØÁî±ÈÖçÁΩÆÔºåÂ¶ÇÊûúË∑ØÁî±ÊúâÂèòÊõ¥ÔºåÂàôËß¶ÂèëÊõ¥Êñ∞</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dynamicRouteByNacosListener</span><span class="hljs-params">(String dataId, String group)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            configService.addListener(dataId, group, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Listener</span>() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receiveConfigInfo</span><span class="hljs-params">(String configInfo)</span> &#123;<br>                    log.info(<span class="hljs-string">&quot;ËøõË°åÁΩëÂÖ≥Êõ¥Êñ∞:\n\r&#123;&#125;&quot;</span>, configInfo);<br>                    List&lt;RouteDefinition&gt; definitionList = JSON.parseArray(configInfo, RouteDefinition.class);<br>                    log.info(<span class="hljs-string">&quot;update route : &#123;&#125;&quot;</span>, definitionList.toString());<br>                    dynamicRouteService.updateList(definitionList);<br>                &#125;<br><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getExecutor</span><span class="hljs-params">()</span> &#123;<br>                    log.info(<span class="hljs-string">&quot;getExecutor\n\r&quot;</span>);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125;<br>            &#125;);<br>        &#125; <span class="hljs-keyword">catch</span> (NacosException e) &#123;<br>            log.error(<span class="hljs-string">&quot;‰ªénacosÊé•Êî∂Âä®ÊÄÅË∑ØÁî±ÈÖçÁΩÆÂá∫Èîô!!!&quot;</span>, e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ÂàùÂßãÂåñ Nacos ÈÖçÁΩÆÂÆ¢Êà∑Á´ØÔºåËÆæÁΩÆÂøÖË¶ÅËøûÊé•ÂèÇÊï∞ÔºåÂ¶ÇÂú∞ÂùÄ„ÄÅË¥¶Âè∑„ÄÅÂØÜÁ†ÅÁ≠â„ÄÇ</span><br>    <span class="hljs-keyword">private</span> ConfigService <span class="hljs-title function_">initConfigService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>            properties.setProperty(<span class="hljs-string">&quot;serverAddr&quot;</span>, NACOS_SERVER_ADDR);<br>            properties.setProperty(<span class="hljs-string">&quot;username&quot;</span>, NACOS_USERNAME);<br>            properties.setProperty(<span class="hljs-string">&quot;password&quot;</span>, NACOS_PASSWORD);<br>            properties.setProperty(<span class="hljs-string">&quot;namespace&quot;</span>, NACOS_NAMESPACE);<br>            <span class="hljs-type">return</span> <span class="hljs-variable">configService</span> <span class="hljs-operator">=</span> NacosFactory.createConfigService(properties);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;ÂàùÂßãÂåñÁΩëÂÖ≥Ë∑ØÁî±Êó∂ÂèëÁîüÈîôËØØ&quot;</span>, e);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ÂÆûÁé∞ CommandLineRunner Êé•Âè£ÔºåÂú®È°πÁõÆÂêØÂä®Êó∂ÊâßË°åÔºöÊãâÂèñ‰∏ÄÊ¨°ÂΩìÂâç Nacos ‰∏≠ÁöÑË∑ØÁî±ÈÖçÁΩÆÂπ∂Âä†ËΩΩÂà∞ÁΩëÂÖ≥‰∏≠</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">configInfo</span> <span class="hljs-operator">=</span> configService.getConfig(NACOS_ROUTE_DATA_ID, NACOS_ROUTE_GROUP, <span class="hljs-number">3000</span>);<br>        log.info(<span class="hljs-string">&quot;Ëé∑ÂèñÁΩëÂÖ≥ÂΩìÂâçÈÖçÁΩÆ:&#123;&#125;&quot;</span>, configInfo);<br>        List&lt;RouteDefinition&gt; definitionList = JSON.parseArray(configInfo, RouteDefinition.class);<br>        <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(definitionList)) &#123;<br>            definitionList.forEach(definition -&gt; &#123;<br>                log.info(<span class="hljs-string">&quot;add route : &#123;&#125;&quot;</span>, definition.toString());<br>                dynamicRouteService.save(definition);<br>            &#125;);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç &#x2F; ÁîüÂëΩÂë®Êúü</th>
<th>‰ΩúÁî®</th>
</tr>
</thead>
<tbody><tr>
<td>@PostConstruct init()</td>
<td>ÂàùÂßãÂåñÊó∂Ë∞ÉÁî®ÔºöÁî®‰∫éÂàùÂßãÂåñ ConfigService Âπ∂Ê≥®ÂÜåË∑ØÁî±ÈÖçÁΩÆÁõëÂê¨Âô®ÔºàÂä®ÊÄÅÁõëÂê¨ Nacos ÈÖçÁΩÆÂèòÂåñÔºâ„ÄÇ</td>
</tr>
<tr>
<td>dynamicRouteByNacosListener(String dataId, String group)</td>
<td>ÁõëÂê¨ÊåáÂÆöÁöÑ Nacos Ë∑ØÁî±ÈÖçÁΩÆÔºåÂ¶ÇÊûúË∑ØÁî±ÊúâÂèòÊõ¥ÔºåÂàôËß¶ÂèëÊõ¥Êñ∞„ÄÇ</td>
</tr>
<tr>
<td>ConfigService initConfigService()</td>
<td>ÂàùÂßãÂåñ Nacos ÈÖçÁΩÆÂÆ¢Êà∑Á´ØÔºåËÆæÁΩÆÂøÖË¶ÅËøûÊé•ÂèÇÊï∞ÔºåÂ¶ÇÂú∞ÂùÄ„ÄÅË¥¶Âè∑„ÄÅÂØÜÁ†ÅÁ≠â„ÄÇ</td>
</tr>
<tr>
<td>run(String‚Ä¶ args)</td>
<td>ÂÆûÁé∞ CommandLineRunner Êé•Âè£ÔºåÂú®È°πÁõÆÂêØÂä®Êó∂ÊâßË°åÔºöÊãâÂèñ‰∏ÄÊ¨°ÂΩìÂâç Nacos ‰∏≠ÁöÑË∑ØÁî±ÈÖçÁΩÆÂπ∂Âä†ËΩΩÂà∞ÁΩëÂÖ≥‰∏≠„ÄÇ</td>
</tr>
</tbody></table>
<h4 id="DynamicRouteRefresh"><a href="#DynamicRouteRefresh" class="headerlink" title="DynamicRouteRefresh"></a>DynamicRouteRefresh</h4><p>ÂÆûÁé∞ <strong>Âä®ÊÄÅÁΩëÂÖ≥Ë∑ØÁî±Âà∑Êñ∞ÂäüËÉΩ</strong>ÁöÑÊ†∏ÂøÉÁ±ª</p>
<ul>
<li><strong>ÂÆûÁé∞ÂØπÁΩëÂÖ≥Ë∑ØÁî±ÁöÑ Êñ∞Â¢û„ÄÅÊõ¥Êñ∞„ÄÅÂà†Èô§ Êìç‰Ωú</strong>ÔºåÂπ∂ÈÄöËøá‰∫ã‰ª∂Êú∫Âà∂ÔºàRefreshRoutesEventÔºâÂä®ÊÄÅÂà∑Êñ∞Ë∑ØÁî±„ÄÇ</li>
</ul>
<ol>
<li>‰ΩøÁî® ApplicationEventPublisher Êé®ÈÄÅ‰∫ã‰ª∂Âà∑Êñ∞ÁΩëÂÖ≥Ë∑ØÁî±„ÄÇ</li>
<li>Êìç‰ΩúÂÜÖÂ≠ò‰∏≠ÁöÑ RouteDefinitionRepositoryÔºàË∑ØÁî±ÂÆö‰πâ‰ªìÂ∫ìÔºâ„ÄÇ</li>
<li>Êèê‰æõ‰æõÂ§ñÈÉ®Ë∞ÉÁî®ÁöÑ API ÊñπÊ≥ïÊù•Âä®ÊÄÅÁÆ°ÁêÜÁΩëÂÖ≥Ë∑ØÁî±„ÄÇ</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1ÔºâÂÆûÁé∞‰∏Ä‰∏™SpringÊèê‰æõÁöÑ‰∫ã‰ª∂Êé®ÈÄÅÊé•Âè£ApplicationEventPublisherAware</span><br><span class="hljs-comment"> * 2ÔºâÊèê‰æõÂä®ÊÄÅË∑ØÁî±ÁöÑÂü∫Á°ÄÊñπÊ≥ïÔºåÂèØÈÄöËøáËé∑ÂèñbeanÊìç‰ΩúËØ•Á±ªÁöÑÊñπÊ≥ï„ÄÇËØ•Á±ªÊèê‰æõÊñ∞Â¢ûË∑ØÁî±„ÄÅÊõ¥Êñ∞Ë∑ØÁî±„ÄÅÂà†Èô§Ë∑ØÁî±ÔºåÁÑ∂ÂêéÂÆûÁé∞ÂèëÂ∏ÉÁöÑÂäüËÉΩ„ÄÇ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicRouteRefresh</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationEventPublisherAware</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> InMemoryRouteDefinitionRepository memoryRouteDefinitionRepository;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ApplicationEventPublisher publisher;<br>    <br>    <span class="hljs-comment">// 	ËÆæÁΩÆ‰∫ã‰ª∂ÂèëÂ∏ÉÂô®</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplicationEventPublisher</span><span class="hljs-params">(ApplicationEventPublisher applicationEventPublisher)</span> &#123;<br>        <span class="hljs-built_in">this</span>.publisher = applicationEventPublisher;<br>    &#125;<br><br>    <span class="hljs-comment">// Âà†Èô§ÊåáÂÆö id ÁöÑË∑ØÁî±ÂÆö‰πâÔºåÂπ∂ÂèëÂ∏ÉÂà∑Êñ∞‰∫ã‰ª∂</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">delete</span><span class="hljs-params">(String id)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            log.info(<span class="hljs-string">&quot;gateway delete route id &#123;&#125;&quot;</span>, id);<br>            memoryRouteDefinitionRepository.delete(Mono.just(id)).doOnError(error -&gt; log.error(<span class="hljs-string">&quot;Âà†Èô§Â§±Ë¥•,id:&#123;&#125;&quot;</span>, id))<br>                    .doAfterTerminate(() -&gt; <span class="hljs-built_in">this</span>.publisher.publishEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RefreshRoutesEvent</span>(<span class="hljs-built_in">this</span>))).subscribe();<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;delete success&quot;</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;delete fail&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ÊâπÈáèÊõ¥Êñ∞Ë∑ØÁî±ÂàóË°®</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">updateList</span><span class="hljs-params">(List&lt;RouteDefinition&gt; definitions)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;gateway update route &#123;&#125;&quot;</span>, definitions);<br>        <span class="hljs-comment">// Âà†Èô§ÁºìÂ≠òrouterDefinition</span><br>        memoryRouteDefinitionRepository.getRouteDefinitions()<br>                .filter(it -&gt; !it.getId().startsWith(<span class="hljs-string">&quot;ReactiveCompositeDiscoveryClient_&quot;</span>))<br>                .doOnNext(routeDefinition -&gt; &#123;<br>                    log.info(<span class="hljs-string">&quot;delete routeDefinition:&#123;&#125;&quot;</span>, routeDefinition);<br>                    delete(routeDefinition.getId());<br>                &#125;).doAfterTerminate(() -&gt; definitions.forEach(<span class="hljs-built_in">this</span>::save)).subscribe();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// ‰øùÂ≠ò‰∏Ä‰∏™Êñ∞ÁöÑË∑ØÁî±ÂÆö‰πâ</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">save</span><span class="hljs-params">(RouteDefinition definition)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;gateway add route &#123;&#125;&quot;</span>, definition);<br>        <span class="hljs-keyword">try</span> &#123;<br>            memoryRouteDefinitionRepository.save(Mono.just(definition))<br>                    .doAfterTerminate(() -&gt; <span class="hljs-built_in">this</span>.publisher.publishEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RefreshRoutesEvent</span>(<span class="hljs-built_in">this</span>))).subscribe();<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;update route fail&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>‰ΩúÁî®</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td>setApplicationEventPublisher(‚Ä¶)</td>
<td>ËÆæÁΩÆ‰∫ã‰ª∂ÂèëÂ∏ÉÂô®</td>
<td>ÂÆûÁé∞ ApplicationEventPublisherAware Êé•Âè£ÂêéÔºåSpring ÂÆπÂô®ÂêØÂä®Êó∂‰ºöÊ≥®ÂÖ• publisher„ÄÇ</td>
</tr>
<tr>
<td>delete()</td>
<td>Âà†Èô§ÊåáÂÆö id ÁöÑË∑ØÁî±ÂÆö‰πâÔºåÂπ∂ÂèëÂ∏ÉÂà∑Êñ∞‰∫ã‰ª∂</td>
<td>Âà†Èô§Ë∑ØÁî±ÂêéÁ´ãÂç≥Ëß¶Âèë RefreshRoutesEventÔºå‰ΩøÁΩëÂÖ≥Ë∑ØÁî±Á´ãÂç≥Êõ¥Êñ∞„ÄÇ</td>
</tr>
<tr>
<td>updateList()</td>
<td>ÊâπÈáèÊõ¥Êñ∞Ë∑ØÁî±ÂàóË°®</td>
<td>‰ºöÂÖàÂà†Èô§ÊóßË∑ØÁî±ÔºàÈùûÊ≥®ÂÜå‰∏≠ÂøÉËá™Âä®ÁîüÊàêÁöÑÔºâÔºåÂÜçÈÄê‰∏™Êñ∞Â¢ûÔºåÂπ∂ÂèëÂ∏ÉÂà∑Êñ∞‰∫ã‰ª∂„ÄÇ</td>
</tr>
<tr>
<td>save()</td>
<td>‰øùÂ≠ò‰∏Ä‰∏™Êñ∞ÁöÑË∑ØÁî±ÂÆö‰πâ</td>
<td>Ê∑ªÂä†Âà∞ÂÜÖÂ≠ò‰∏≠Âπ∂Ëß¶ÂèëÂà∑Êñ∞‰∫ã‰ª∂Ôºå‰ΩøÂÖ∂Á´ãÂç≥ÁîüÊïà„ÄÇ</td>
</tr>
</tbody></table>
<h2 id="10-5-GatewayBootApplication"><a href="#10-5-GatewayBootApplication" class="headerlink" title="10.5 GatewayBootApplication"></a>10.5 GatewayBootApplication</h2><p>ËøôÊòØÊï¥‰∏™ÁΩëÂÖ≥ÊúçÂä°ÁöÑÂÖ•Âè£Á±ªÔºåÂêØÂä®Êó∂‰ºöÂàùÂßãÂåñ Spring Boot Â∫îÁî®ÁéØÂ¢ÉÔºåÂπ∂ÂºÄÂêØ Feign ÂÆ¢Êà∑Á´ØÊîØÊåÅÔºåÊ≥®ÂÜåÂæÆÊúçÂä°Èó¥ËøúÁ®ãË∞ÉÁî®ËÉΩÂäõ„ÄÇ</p>
<h1 id="11-goodskill-auth-authÁôªÂΩï‰ª•ÂèäÊéàÊùÉÊ®°Âùó"><a href="#11-goodskill-auth-authÁôªÂΩï‰ª•ÂèäÊéàÊùÉÊ®°Âùó" class="headerlink" title="11. goodskill-auth (authÁôªÂΩï‰ª•ÂèäÊéàÊùÉÊ®°Âùó)"></a>11. goodskill-auth (authÁôªÂΩï‰ª•ÂèäÊéàÊùÉÊ®°Âùó)</h1><p><img src="/img/blogs/java/goodskill/11.0.1.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><code>auth-service</code><ul>
<li>Âü∫‰∫éSa-TokenÊ°ÜÊû∂ÁöÑÁî®Êà∑ÁôªÂΩïÊéàÊùÉÊúçÂä°</li>
</ul>
</li>
<li><code>oauth2-auth-client</code><ul>
<li>oauth2.0ÁôªÂΩïÂÆ¢Êà∑Á´Ø</li>
</ul>
</li>
<li><code>oauth2-auth-server</code><ul>
<li>oauth2.0ÁôªÂΩïÊéàÊùÉÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°</li>
</ul>
</li>
<li><code>oauth2-resource-server</code><ul>
<li>oauth2.0ËµÑÊ∫êÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°</li>
</ul>
</li>
</ul>
<h2 id="11-1-auth-service-Âü∫‰∫éSa-TokenÊ°ÜÊû∂ÁöÑÁî®Êà∑ÁôªÂΩïÊéàÊùÉÊúçÂä°"><a href="#11-1-auth-service-Âü∫‰∫éSa-TokenÊ°ÜÊû∂ÁöÑÁî®Êà∑ÁôªÂΩïÊéàÊùÉÊúçÂä°" class="headerlink" title="11.1 auth-service (Âü∫‰∫éSa-TokenÊ°ÜÊû∂ÁöÑÁî®Êà∑ÁôªÂΩïÊéàÊùÉÊúçÂä°)"></a>11.1 auth-service (Âü∫‰∫éSa-TokenÊ°ÜÊû∂ÁöÑÁî®Êà∑ÁôªÂΩïÊéàÊùÉÊúçÂä°)</h2><p><img src="/img/blogs/java/goodskill/11.1.1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="11-1-1-configÂåÖ"><a href="#11-1-1-configÂåÖ" class="headerlink" title="11.1.1 configÂåÖ"></a>11.1.1 configÂåÖ</h3><ul>
<li><code>EncryptConfig</code>: Âä†ÂØÜÈÖçÁΩÆ</li>
<li>StpInterfaceImpl</li>
</ul>
<h4 id="StpInterfaceImpl-1"><a href="#StpInterfaceImpl-1" class="headerlink" title="StpInterfaceImpl"></a>StpInterfaceImpl</h4><p>ÊòØ‰∏Ä‰∏™ Sa-Token Ê°ÜÊû∂ÁöÑ<strong>Ëá™ÂÆö‰πâÊùÉÈôêÂä†ËΩΩÂÆûÁé∞Á±ª</strong>ÔºåÁî®‰∫éÂú®<strong>Áî®Êà∑ÁôªÂΩïÂêéÔºåÂä®ÊÄÅÂä†ËΩΩÂÖ∂Êã•ÊúâÁöÑ ËßíËâ≤ Âíå ÊùÉÈôêÁ†Å</strong>„ÄÇ</p>
<ul>
<li>ÂÆÉÂÆûÁé∞‰∫Ü StpInterface Êé•Âè£ÔºåÊòØ ÊùÉÈôêÊéßÂà∂Ê†∏ÂøÉÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ</li>
<li>‚ÄúÂΩì‰Ω†ÈúÄË¶ÅÂà§Êñ≠Êüê‰∏™Áî®Êà∑ÁöÑËßíËâ≤ÊàñÊùÉÈôêÊó∂ÔºåÊàëÊù•ÂëäËØâ‰Ω†‰ªñÊúâÂì™‰∫õ„ÄÇ‚Äù</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * sa-tokenËá™ÂÆö‰πâÊùÉÈôêÂä†ËΩΩÊé•Âè£ÂÆûÁé∞Á±ª</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StpInterfaceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StpInterface</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> UserRoleService userRoleService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RolePermissionService rolePermissionService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RoleService roleService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> PermissionService permissionService;<br> <br>    <span class="hljs-comment">// ËøîÂõû‰∏Ä‰∏™Ë¥¶Âè∑ÊâÄÊã•ÊúâÁöÑÊùÉÈôêÁ†ÅÈõÜÂêà</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getPermissionList</span><span class="hljs-params">(Object loginId, String loginType)</span> &#123;<br>        <span class="hljs-comment">// 1. Â£∞ÊòéÊùÉÈôêÁ†ÅÈõÜÂêà</span><br>        List&lt;String&gt; permissionList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>        <span class="hljs-comment">// 2. ÈÅçÂéÜËßíËâ≤ÂàóË°®ÔºåÊü•ËØ¢Êã•ÊúâÁöÑÊùÉÈôêÁ†Å</span><br>        <span class="hljs-keyword">for</span> (String roleCode : getRoleList(loginId, loginType)) &#123;<br>            <span class="hljs-type">SaSession</span> <span class="hljs-variable">roleSession</span> <span class="hljs-operator">=</span> SaSessionCustomUtil.getSessionById(<span class="hljs-string">&quot;role-&quot;</span> + roleCode);<br>            List&lt;String&gt; list = roleSession.get(<span class="hljs-string">&quot;Permission_List&quot;</span>, () -&gt; &#123;<br>                List&lt;Integer&gt; roleIdList = roleService.list(Wrappers.&lt;Role&gt;lambdaQuery().eq(Role::getRoleCode, roleCode))<br>                        .stream().map(Role::getRoleId).collect(Collectors.toList());<br>                List&lt;Integer&gt; permissionIdList = rolePermissionService.list(Wrappers.&lt;RolePermission&gt;lambdaQuery().in(RolePermission::getRoleId, roleIdList))<br>                        .stream().map(RolePermission::getPermissionId).distinct().collect(Collectors.toList());<br>                List&lt;Permission&gt; permissions = permissionService.list(Wrappers.&lt;Permission&gt;lambdaQuery().in(Permission::getPermissionId, permissionIdList));<br>                <span class="hljs-keyword">return</span> permissions.stream().map(Permission::getPermissionCode).collect(Collectors.toList());<br>            &#125;);<br>            permissionList.addAll(list);<br>        &#125;<br>        <span class="hljs-comment">// 3. ËøîÂõûÊùÉÈôêÁ†ÅÈõÜÂêà</span><br>        <span class="hljs-keyword">return</span> permissionList;<br>    &#125;<br> <br>    <span class="hljs-comment">// ËøîÂõû‰∏Ä‰∏™Ë¥¶Âè∑ÊâÄÊã•ÊúâÁöÑËßíËâ≤Ê†áËØÜÈõÜÂêà (ÊùÉÈôê‰∏éËßíËâ≤ÂèØÂàÜÂºÄÊ†°È™å)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getRoleList</span><span class="hljs-params">(Object loginId, String loginType)</span> &#123;<br>        <span class="hljs-type">SaSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> StpUtil.getSessionByLoginId(loginId);<br>        <span class="hljs-keyword">return</span> session.get(<span class="hljs-string">&quot;Role_List&quot;</span>, () -&gt; &#123;<br>            <span class="hljs-comment">// ‰ªéÊï∞ÊçÆÂ∫ìÊü•ËØ¢Ëøô‰∏™Ë¥¶Âè∑idÊã•ÊúâÁöÑËßíËâ≤ÂàóË°®</span><br>            List&lt;UserRole&gt; userRoleList = userRoleService.list(Wrappers.&lt;UserRole&gt;lambdaQuery().eq(UserRole::getUserId, loginId));<br>            List&lt;Integer&gt; roleIds = userRoleList.stream().map(UserRole::getRoleId).collect(Collectors.toList());<br>            <span class="hljs-keyword">return</span> roleService.list(Wrappers.&lt;Role&gt;lambdaQuery().in(Role::getRoleId, roleIds)).stream().map(Role::getRoleCode)<br>                    .collect(Collectors.toList());<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Ëé∑ÂèñÊåáÂÆöÁî®Êà∑ÁöÑÊùÉÈôêÁ†ÅÈõÜÂêàÔºàÊùÉÈôêÂ≠óÁ¨¶‰∏≤ÂàóË°®Ôºâ„ÄÇ</li>
<li>Ëé∑ÂèñÊåáÂÆöÁî®Êà∑ÁöÑÊâÄÊúâËßíËâ≤‰ª£Á†ÅÈõÜÂêà</li>
</ul>
<h3 id="11-1-2-controller"><a href="#11-1-2-controller" class="headerlink" title="11.1.2 controller"></a>11.1.2 controller</h3><ul>
<li>LoginController</li>
<li>UserController</li>
</ul>
<h4 id="LoginController"><a href="#LoginController" class="headerlink" title="LoginController"></a>LoginController</h4><p>Áî®‰∫é<strong>Â§ÑÁêÜÁôªÂΩïÁõ∏ÂÖ≥Êìç‰ΩúÁöÑÊéßÂà∂Âô®Á±ª</strong>Ôºå‰∏ªË¶ÅÁî®‰∫é<strong>Êèê‰æõÊé•Âè£Êù•ÊµãËØïÁôªÂΩïÁä∂ÊÄÅ„ÄÅÊâßË°åÁôªÂΩï„ÄÅÈÄÄÂá∫ÁôªÂΩï„ÄÅÊ≥®ÂÜåÁ≠âÂäüËÉΩ</strong>„ÄÇ</p>
<table>
<thead>
<tr>
<th>Êé•Âè£Ë∑ØÂæÑ</th>
<th>ÊñπÊ≥ï</th>
<th>ÂäüËÉΩÁÆÄ‰ªã</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;isLogin</td>
<td>GET</td>
<td>Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁôªÂΩï</td>
</tr>
<tr>
<td>&#x2F;tokenInfo</td>
<td>GET</td>
<td>Ëé∑ÂèñÂΩìÂâçÁôªÂΩï token ‰ø°ÊÅØ</td>
</tr>
<tr>
<td>&#x2F;logout</td>
<td>POST</td>
<td>Áî®Êà∑ÁôªÂá∫</td>
</tr>
<tr>
<td>&#x2F;register</td>
<td>POST</td>
<td>Áî®Êà∑Ê≥®ÂÜå</td>
</tr>
<tr>
<td>&#x2F;login</td>
<td>POST</td>
<td>Áî®Êà∑ÁôªÂΩïÂπ∂ËøîÂõû token</td>
</tr>
</tbody></table>
<h4 id="UserController"><a href="#UserController" class="headerlink" title="UserController"></a>UserController</h4><p>Áî®‰∫é<strong>Áî®Êà∑ÁÆ°ÁêÜÁöÑÊéßÂà∂Âô®Á±ª</strong>ÔºåÊèê‰æõ‰∫ÜÂíåÁî®Êà∑ËßíËâ≤„ÄÅÊùÉÈôêÁõ∏ÂÖ≥ÁöÑÊé•Âè£ÔºåÊ†∏ÂøÉÂõ¥Áªï <strong>ËßíËâ≤ÂàÜÈÖç„ÄÅÁî®Êà∑‰ø°ÊÅØËé∑Âèñ„ÄÅÊùÉÈôê&#x2F;ËßíËâ≤Êü•ËØ¢</strong> Â±ïÂºÄ</p>
<ul>
<li>Êèê‰æõÂØπÁî®Êà∑‰ø°ÊÅØ„ÄÅËßíËâ≤ÂíåÊùÉÈôêÁöÑÁÆ°ÁêÜËÉΩÂäõÔºå‰æùËµñ UserService Âíå StpInterface ÂÆûÁé∞Áî®Êà∑‰ø°ÊÅØÁöÑÊü•ËØ¢ÂíåÊùÉÈôê‰ΩìÁ≥ªÁöÑÊé•ÂÖ•„ÄÇ</li>
</ul>
<h3 id="11-1-3-entity"><a href="#11-1-3-entity" class="headerlink" title="11.1.3 entity"></a>11.1.3 entity</h3><table>
<thead>
<tr>
<th>ÂÆû‰ΩìÁ±ªÂêç</th>
<th>‰ΩúÁî®ËØ¥Êòé</th>
<th>Â§áÊ≥®</th>
</tr>
</thead>
<tbody><tr>
<td><code>Permission</code></td>
<td>ÊùÉÈôêË°®ÂÆû‰ΩìÁ±ªÔºåË°®Á§∫Á≥ªÁªü‰∏≠ÁöÑÂÖ∑‰ΩìÊùÉÈôêÈ°π</td>
<td>Áî®‰∫éÊéßÂà∂ÊåâÈíÆ&#x2F;ËèúÂçïÊùÉÈôêÁ≠âÔºåÈÖçÂêàËßíËâ≤‰ΩøÁî®</td>
</tr>
<tr>
<td><code>Role</code></td>
<td>ËßíËâ≤Ë°®ÂÆû‰ΩìÁ±ªÔºåÂÆö‰πâÁ≥ªÁªü‰∏≠‰∏çÂêåÁöÑËßíËâ≤</td>
<td>ÂíåÊùÉÈôê„ÄÅÁî®Êà∑ÂÖ≥ËÅîÔºåÁî®‰∫éÊéàÊùÉÁÆ°ÁêÜ</td>
</tr>
<tr>
<td><code>RolePermission</code></td>
<td>ËßíËâ≤‰∏éÊùÉÈôêÁöÑ‰∏≠Èó¥Ë°®ÂÆû‰ΩìÁ±ªÔºåÁî®‰∫éÁª¥Êä§ËßíËâ≤Êã•ÊúâÁöÑÊùÉÈôê</td>
<td>Â§öÂØπÂ§öÂÖ≥ËÅîË°®</td>
</tr>
<tr>
<td><code>User</code></td>
<td>Áî®Êà∑Ë°®ÂÆû‰ΩìÁ±ªÔºå‰øùÂ≠òÁî®Êà∑Âü∫Êú¨‰ø°ÊÅØ</td>
<td>Ê†∏ÂøÉÁî®Êà∑ÂÆû‰ΩìÁ±ª</td>
</tr>
<tr>
<td><code>UserAuthAccount</code></td>
<td>Áî®Êà∑Á¨¨‰∏âÊñπÊéàÊùÉË¥¶Âè∑Ë°®Ôºå‰øùÂ≠òÁªëÂÆöÁöÑÁ¨¨‰∏âÊñπÁôªÂΩï‰ø°ÊÅØ</td>
<td>Áî®‰∫éÂÆûÁé∞ÂæÆ‰ø°„ÄÅQQÁ≠âÁ¨¨‰∏âÊñπÁôªÂΩï</td>
</tr>
<tr>
<td><code>UserRole</code></td>
<td>Áî®Êà∑‰∏éËßíËâ≤ÁöÑ‰∏≠Èó¥Ë°®ÂÆû‰ΩìÁ±ªÔºåÁî®‰∫éÁª¥Êä§Áî®Êà∑Êã•ÊúâÁöÑËßíËâ≤</td>
<td>Â§öÂØπÂ§öÂÖ≥ËÅîË°®</td>
</tr>
</tbody></table>
<h3 id="11-1-4-pojo"><a href="#11-1-4-pojo" class="headerlink" title="11.1.4 pojo"></a>11.1.4 pojo</h3><ul>
<li><code>UserDTO</code>: Áî®Êà∑DTO</li>
<li><code>UserInfoVO</code>: Áî®Êà∑‰ø°ÊÅØËßÜÂõæÂØπË±°</li>
</ul>
<h3 id="11-1-5-mapper"><a href="#11-1-5-mapper" class="headerlink" title="11.1.5 mapper"></a>11.1.5 mapper</h3><p>Ëøô‰∫õmapperÈÉΩÁªßÊâø‰∫Ümybatis-plus‰∏≠ÁöÑBaseMapperÊé•Âè£ÔºåÂÆûÁé∞‰∫ÜÂü∫Êú¨ÁöÑÂ¢ûÂà†ÊîπÊü•</p>
<ul>
<li><code>PermissionMapper</code>: ÊùÉÈôêË°®mapperÊé•Âè£</li>
<li><code>RoleMapper</code>Ôºö ËßíËâ≤Ë°®mapperÊé•Âè£</li>
<li><code>RolePermissionMapper</code>: ËßíËâ≤ÊùÉÈôêË°®mapperÊé•Âè£</li>
<li><code>UserAuthAccountMapper</code>: Áî®Êà∑ÊéàÊùÉË¥¶Âè∑Ë°® Mapper Êé•Âè£</li>
<li><code>UserMapper</code>: Áî®Êà∑Ë°®mapperÊé•Âè£</li>
<li><code>UserRoleMapper</code>: Áî®Êà∑ËßíËâ≤Ë°®mapperÊé•Âè£</li>
</ul>
<h3 id="11-1-6-serviceÊé•Âè£ÂíåÂÆûÁé∞Á±ª"><a href="#11-1-6-serviceÊé•Âè£ÂíåÂÆûÁé∞Á±ª" class="headerlink" title="11.1.6 serviceÊé•Âè£ÂíåÂÆûÁé∞Á±ª"></a>11.1.6 serviceÊé•Âè£ÂíåÂÆûÁé∞Á±ª</h3><h4 id="serviceÊé•Âè£"><a href="#serviceÊé•Âè£" class="headerlink" title="serviceÊé•Âè£"></a>serviceÊé•Âè£</h4><p>Ëøô‰∫õserviceÊé•Âè£ÁªßÊâø‰∫Ümybatis-plus‰∏≠ÁöÑIServiceÊé•Âè£ÔºåÂÆûÁé∞‰∫ÜÂü∫Êú¨ÁöÑÂ¢ûÂà†ÊîπÊü•</p>
<ul>
<li><code>PermissionService</code></li>
<li><code>RolePermissionService</code></li>
<li><code>RoleService</code></li>
<li><code>UserAccountService</code></li>
<li><code>UserAuthAccountService</code>: Áî®Êà∑ÊéàÊùÉË¥¶Âè∑Ë°®ÊúçÂä°Á±ª</li>
<li><code>UserRoleService</code></li>
<li><code>UserService</code></li>
</ul>
<h4 id="ServiceImplÊúçÂä°ÂÆûÁé∞Á±ª"><a href="#ServiceImplÊúçÂä°ÂÆûÁé∞Á±ª" class="headerlink" title="ServiceImplÊúçÂä°ÂÆûÁé∞Á±ª"></a>ServiceImplÊúçÂä°ÂÆûÁé∞Á±ª</h4><p>Ëøô‰∫õÂÆûÁé∞Á±ªÂêåÊ†∑ÁªßÊâø‰∫Ümybatis-plus‰∏≠ÁöÑServiceImpl</p>
<ul>
<li><code>PermissionServiceImpl</code></li>
<li><code>RolePermissionServiceImpl</code></li>
<li><code>RoleServiceImpl</code></li>
<li><code>UserAccountServiceImpl</code></li>
<li><code>UserRoleServiceImpl</code></li>
</ul>
<h4 id="UserAuthAccountServiceImpl"><a href="#UserAuthAccountServiceImpl" class="headerlink" title="UserAuthAccountServiceImpl"></a>UserAuthAccountServiceImpl</h4><p>ÊòØ‰∏Ä‰∏™ <strong>Áî®Êà∑Á¨¨‰∏âÊñπÊéàÊùÉË¥¶Âè∑ÊúçÂä°</strong>ÁöÑÂÆûÁé∞Á±ª<br>ËØ•Á±ªÁöÑ‰∏ªË¶ÅËÅåË¥£ÊòØÂ§ÑÁêÜÁî®Êà∑‰∏éÁ¨¨‰∏âÊñπË¥¶Âè∑ÔºàÂ¶ÇÂæÆ‰ø°„ÄÅQQ„ÄÅGitHubÁ≠âÔºâÁöÑÂÖ≥ËÅîÈÄªËæëÔºå‰∏ªË¶ÅÂåÖÊã¨Ôºö</p>
<ul>
<li>Ê†πÊçÆÁ¨¨‰∏âÊñπË¥¶Âè∑Êü•ÊâæÂØπÂ∫îÁöÑÁî®Êà∑‰ø°ÊÅØ„ÄÇ</li>
<li>Âà§Êñ≠Êüê‰∏™Á¨¨‰∏âÊñπË¥¶Âè∑ÊòØÂê¶Â∑≤ÁªèÁªëÂÆöËøáÁ≥ªÁªüÁî®Êà∑„ÄÇ</li>
</ul>
<h4 id="UserServiceImpl"><a href="#UserServiceImpl" class="headerlink" title="UserServiceImpl"></a>UserServiceImpl</h4><p><strong>Áî®Êà∑ÁÆ°ÁêÜÁöÑÊ†∏ÂøÉÊúçÂä°Á±ª</strong>Ôºå‰∏ªË¶ÅË¥üË¥£Â§ÑÁêÜ<strong>Áî®Êà∑ÁöÑÊ≥®ÂÜå„ÄÅÊü•ËØ¢„ÄÅÊùÉÈôêËßíËâ≤ÁÆ°ÁêÜ„ÄÅÁôªÂΩïÁä∂ÊÄÅÊõ¥Êñ∞Á≠âÈÄªËæë„ÄÇ</strong><br>ÂÆÉÁªßÊâø‰∫Ü <code>ServiceImpl&lt;UserMapper, User&gt;</code>ÔºåÂÆûÁé∞‰∫Ü UserService Êé•Âè£ÔºåÂÄüÂä© MyBatis-Plus ÁöÑÈÄöÁî® Service ÂäüËÉΩÔºåÂπ∂ÈõÜÊàê‰∫ÜÁî®Êà∑„ÄÅËßíËâ≤„ÄÅÊùÉÈôêÁ≠âÂ§ö‰∏™Ê®°ÂùóÁöÑ‰∏öÂä°ÈÄªËæë„ÄÇ</p>
<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>ÊñπÊ≥ï‰ΩúÁî®ÊèèËø∞</th>
</tr>
</thead>
<tbody><tr>
<td><code>register</code></td>
<td>Áî®Êà∑Ê≥®ÂÜåÔºå‰øùÂ≠òÂä†ÂØÜÂØÜÁ†ÅÂíåÁî®Êà∑ÂêçÂà∞Êï∞ÊçÆÂ∫ì</td>
</tr>
<tr>
<td><code>findRoles</code></td>
<td>Ê†πÊçÆË¥¶Âè∑Êü•ÊâæÁî®Êà∑ÁöÑÊâÄÊúâËßíËâ≤</td>
</tr>
<tr>
<td><code>findPermissions</code></td>
<td>Ê†πÊçÆË¥¶Âè∑Êü•ÊâæÁî®Êà∑ÁöÑÊâÄÊúâÊùÉÈôêÔºàÈÄöËøáËßíËâ≤ÊùÉÈôê‰∏≠Èó¥Ë°®Ôºâ</td>
</tr>
<tr>
<td><code>findByUserAccount</code></td>
<td>Ê†πÊçÆË¥¶Âè∑Êü•ÊâæÂØπÂ∫îÁöÑÁî®Êà∑ÂÆû‰Ωì</td>
</tr>
<tr>
<td><code>getUserInfoById</code></td>
<td>Ê†πÊçÆÁî®Êà∑ ID Êü•ËØ¢Áî®Êà∑‰ø°ÊÅØÔºåÂπ∂ÈöêËóèÂØÜÁ†Å</td>
</tr>
<tr>
<td><code>page</code></td>
<td>Ëé∑ÂèñÁî®Êà∑ÂàÜÈ°µ‰ø°ÊÅØÔºà‰ΩøÁî® MyBatis-Plus Êèê‰æõÁöÑÂàÜÈ°µÔºâ</td>
</tr>
<tr>
<td><code>removeById</code></td>
<td>Ê†πÊçÆÁî®Êà∑ ID Âà†Èô§Áî®Êà∑</td>
</tr>
<tr>
<td><code>updateLastLoginTime</code></td>
<td>Êõ¥Êñ∞Áî®Êà∑ÊúÄËøë‰∏ÄÊ¨°ÁôªÂΩïÊó∂Èó¥</td>
</tr>
<tr>
<td><code>checkPassword</code></td>
<td>Ê†°È™åËæìÂÖ•ÂØÜÁ†ÅÊòØÂê¶‰∏éÂä†ÂØÜÂØÜÁ†ÅÂåπÈÖç</td>
</tr>
<tr>
<td><code>addRole</code></td>
<td>‰∏∫ÊåáÂÆöÁî®Êà∑Ê∑ªÂä†‰∏Ä‰∏™ËßíËâ≤ÔºàÊ†°È™åËßíËâ≤ÊòØÂê¶Â≠òÂú®Ôºâ</td>
</tr>
</tbody></table>
<h3 id="11-1-7-AuthApplication"><a href="#11-1-7-AuthApplication" class="headerlink" title="11.1.7 AuthApplication"></a>11.1.7 AuthApplication</h3><p>ÊòØ <strong>ËÆ§ËØÅÊúçÂä°ÁöÑÂêØÂä®Á±ª</strong>, ‰ΩúÁî®ÊòØ<strong>ÂêØÂä®Êï¥‰∏™ËÆ§ËØÅÊ®°ÂùóÔºàauth Ê®°ÂùóÔºâÁöÑÂ∫îÁî®</strong></p>
<h2 id="11-2-oauth2-auth-client-oauth2-0ÁôªÂΩïÂÆ¢Êà∑Á´Ø"><a href="#11-2-oauth2-auth-client-oauth2-0ÁôªÂΩïÂÆ¢Êà∑Á´Ø" class="headerlink" title="11.2 oauth2-auth-client (oauth2.0ÁôªÂΩïÂÆ¢Êà∑Á´Ø)"></a>11.2 oauth2-auth-client (oauth2.0ÁôªÂΩïÂÆ¢Êà∑Á´Ø)</h2><p><img src="/img/blogs/java/goodskill/11.2.1.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><code>OAuth2LoginController</code> ÊòØ‰∏Ä‰∏™Áî®‰∫é <strong>Â±ïÁ§∫ OAuth2 ÁôªÂΩïÊàêÂäüÂêéÁî®Êà∑‰ø°ÊÅØÁöÑÊéßÂà∂Âô®</strong>ÔºåÂÆÉÁöÑ‰ΩúÁî®ÊòØÂ§ÑÁêÜÁî®Êà∑ÁôªÂΩïÊàêÂäüÂêéÁöÑÈ°µÈù¢ËØ∑Ê±ÇÔºåÂπ∂Â∞ÜÁôªÂΩïÁî®Êà∑ÁöÑ‰ø°ÊÅØÂ±ïÁ§∫Âú®È°µÈù¢‰∏ä</li>
<li><code>OAuth2AuthClientApplication</code>: OAuth2.0ÊéàÊùÉÂÆ¢Êà∑Á´ØÊúçÂä°ÁöÑÂêØÂä®Á±ª</li>
</ul>
<h2 id="11-3-oauth2-auth-service-oauth2-0ÁôªÂΩïÊéàÊùÉÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°"><a href="#11-3-oauth2-auth-service-oauth2-0ÁôªÂΩïÊéàÊùÉÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°" class="headerlink" title="11.3 oauth2-auth-service (oauth2.0ÁôªÂΩïÊéàÊùÉÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°)"></a>11.3 oauth2-auth-service (oauth2.0ÁôªÂΩïÊéàÊùÉÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°)</h2><p><img src="/img/blogs/java/goodskill/11.3.1.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="SecurityConfig"><a href="#SecurityConfig" class="headerlink" title="SecurityConfig"></a>SecurityConfig</h4><p>SecurityConfig Á±ªÊòØ‰∏Ä‰∏™ Spring Security ÈÖçÁΩÆÁ±ªÔºåÁî®‰∫é<strong>ÈÖçÁΩÆ OAuth2 ËÆ§ËØÅ‰∏éÊéàÊùÉÊúçÂä°Âô®ÁöÑÂÆâÂÖ®Á≠ñÁï•</strong>Ôºå‰ª•Âèä<strong>Â§ÑÁêÜ ËµÑÊ∫êÊúçÂä°Âô® Âíå ÈªòËÆ§ÁöÑÁî®Êà∑ËÆ§ËØÅ</strong>„ÄÇ</p>
<p>ÂÖ∑‰ΩìÊù•ËØ¥ÔºåÂÆÉË¥üË¥£Ôºö</p>
<ol>
<li>ÈÖçÁΩÆ ÊéàÊùÉÊúçÂä°Âô®ÁöÑÂÆâÂÖ®Á≠ñÁï•„ÄÇ</li>
<li>ÈÖçÁΩÆ ËµÑÊ∫êÊúçÂä°Âô®ÔºàJWT È™åËØÅÔºâ„ÄÇ</li>
<li>ÈÖçÁΩÆ Áî®Êà∑ËÆ§ËØÅ‰∏éÁôªÂΩï„ÄÇ</li>
<li>ËÆæÁΩÆ ÂÆ¢Êà∑Á´ØÂíå ÂÖ¨Èí•ÁßÅÈí•ÂØπ„ÄÇ</li>
</ol>
<h4 id="SimpleController"><a href="#SimpleController" class="headerlink" title="SimpleController"></a>SimpleController</h4><p>ÊòØ‰∏Ä‰∏™ Spring Boot ÊéßÂà∂Âô®ÔºåÁî®‰∫éÂ§ÑÁêÜ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ GET ËØ∑Ê±Ç„ÄÇÂÖ∂‰∏ªË¶ÅÂäüËÉΩÊòØ<strong>ÈÄöËøá Spring Security ÁöÑ @AuthenticationPrincipal Ê≥®Ëß£Ëé∑ÂèñÂΩìÂâçËÆ§ËØÅÁî®Êà∑ÁöÑ‰ø°ÊÅØÔºåÂπ∂ËøîÂõûËØ•Áî®Êà∑ÁöÑÂêçÁß∞</strong>„ÄÇ</p>
<h4 id="UserInfoController"><a href="#UserInfoController" class="headerlink" title="UserInfoController"></a>UserInfoController</h4><p>ÊòØ‰∏Ä‰∏™ Spring Boot REST ÊéßÂà∂Âô®ÔºåÂÆÉÂÆö‰πâ‰∫Ü‰∏§‰∏™Á´ØÁÇπÔºö&#x2F;user Âíå &#x2F;whoamiÔºåÂπ∂Êèê‰æõ‰∫Ü‰∏Ä‰∫õÁî®Êà∑‰ø°ÊÅØÁöÑÂäüËÉΩ</p>
<h4 id="OAuth2AuthorizationServerApplication"><a href="#OAuth2AuthorizationServerApplication" class="headerlink" title="OAuth2AuthorizationServerApplication"></a>OAuth2AuthorizationServerApplication</h4><p>‰ΩúÁî®ÊòØÂêØÂä®‰∏Ä‰∏™ OAuth2 ÊéàÊùÉÊúçÂä°Âô®</p>
<h2 id="11-4-oauth2-resource-server-oauth2-0ËµÑÊ∫êÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°"><a href="#11-4-oauth2-resource-server-oauth2-0ËµÑÊ∫êÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°" class="headerlink" title="11.4 oauth2-resource-server (oauth2.0ËµÑÊ∫êÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°)"></a>11.4 oauth2-resource-server (oauth2.0ËµÑÊ∫êÊúçÂä°Á´ØÔºåËá™ÂÆö‰πâÁöÑÁôªÂΩïÊéàÊùÉÊúçÂä°)</h2><p><img src="/img/blogs/java/goodskill/11.4.1.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><code>UserInfoController</code>: Êèê‰æõÂÖ≥‰∫éÁî®Êà∑ÁöÑ‰∏§Á±ª‰ø°ÊÅØÔºö‰∏ÄÊòØÊ®°ÊãüÁöÑÁî®Êà∑Êï∞ÊçÆÔºå‰∫åÊòØÂΩìÂâçÂ∑≤ËÆ§ËØÅÁî®Êà∑ÁöÑÊï∞ÊçÆ„ÄÇ<ul>
<li>&#x2F;user Êé•Âè£Êèê‰æõÊ®°ÊãüÁöÑÁî®Êà∑Êï∞ÊçÆÔºåËøîÂõû‰∏Ä‰∏™ÈùôÊÄÅÁöÑ JSON ÂìçÂ∫î„ÄÇ</li>
<li>&#x2F;whoami Êé•Âè£Áî®‰∫éËé∑ÂèñÂΩìÂâçÁôªÂΩïÁî®Êà∑ÁöÑ‰ø°ÊÅØÔºåËøîÂõûËÆ§ËØÅÁî®Êà∑ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØ„ÄÇ</li>
</ul>
</li>
<li><code>OAuth2ResourceServerApplication</code>: OAuth2.0ËµÑÊ∫êÊúçÂä°Âô®ÂêØÂä®Á±ª</li>
</ul>
<h1 id="12-goodskill-ai-AIÊú∫Âô®‰∫∫ËÅäÂ§©ÊúçÂä°"><a href="#12-goodskill-ai-AIÊú∫Âô®‰∫∫ËÅäÂ§©ÊúçÂä°" class="headerlink" title="12. goodskill-ai (AIÊú∫Âô®‰∫∫ËÅäÂ§©ÊúçÂä°)"></a>12. goodskill-ai (AIÊú∫Âô®‰∫∫ËÅäÂ§©ÊúçÂä°)</h1><p><img src="/img/blogs/java/goodskill/12.1.1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="12-1-controller"><a href="#12-1-controller" class="headerlink" title="12.1 controller"></a>12.1 controller</h2><ul>
<li>AssistantController</li>
<li>ChatRequest</li>
</ul>
<h4 id="AssistantController"><a href="#AssistantController" class="headerlink" title="AssistantController"></a>AssistantController</h4><p>‰∏ªË¶Å<strong>Áî®‰∫éÂ§ÑÁêÜ‰∏éÁî®Êà∑ÁöÑÂØπËØùÔºàËÅäÂ§©ÔºâËØ∑Ê±Ç</strong>„ÄÇÂÖ∑‰ΩìÊù•ËØ¥ÔºåÂÆÉÁöÑ‰ΩúÁî®ÊòØ‰∏∫Áî®Êà∑Êèê‰æõ‰∏Ä‰∏™Âü∫‰∫é Web ÁöÑËÅäÂ§©Êé•Âè£ÔºåÂÖÅËÆ∏Áî®Êà∑‰∏é‰∏Ä‰∏™Âä©ÊâãËøõË°å‰∫íÂä®„ÄÇÁ±ª‰∏≠ÂÆö‰πâÁöÑËØ∑Ê±ÇÊé•Âè£‰ºöÈÄöËøá UserSupportAssistant Êù•Â§ÑÁêÜÁî®Êà∑ÁöÑËæìÂÖ•Âπ∂ËøîÂõûËÅäÂ§©‰ø°ÊÅØ„ÄÇ</p>
<ul>
<li>‰Ωú‰∏∫‰∏Ä‰∏™ÂÆûÊó∂ÁöÑÁî®Êà∑Âä©ÊâãËÅäÂ§©Êé•Âè£ÔºåÂ§ÑÁêÜÁî®Êà∑Ê∂àÊÅØÂπ∂ÂÆûÊó∂Êé®ÈÄÅËÅäÂ§©ÂõûÂ§ç„ÄÇ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/api/assistant&quot;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssistantController</span> &#123;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserSupportAssistant agent;<br><br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">AssistantController</span><span class="hljs-params">(UserSupportAssistant agent)</span> &#123;<br>		<span class="hljs-built_in">this</span>.agent = agent;<br>	&#125;<br><br>	<span class="hljs-meta">@RequestMapping(path=&quot;/chat&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span><br>	<span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">chat</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String chatId, <span class="hljs-meta">@RequestParam</span> String userMessage)</span> &#123;<br>		<span class="hljs-keyword">return</span> agent.chat(chatId, userMessage);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Êé•Âè£ÂäüËÉΩÔºö&#x2F;api&#x2F;assistant&#x2F;chat Êèê‰æõ‰∫Ü‰∏Ä‰∏™‰∏éÁî®Êà∑ËÅäÂ§©ÁöÑÊé•Âè£„ÄÇÁî®Êà∑ÈÄöËøá‰º†ÈÄí chatId Âíå userMessage ËøõË°å‰∫§‰∫íÔºåÂä©Êâã‰ºöÂÆûÊó∂ËøîÂõûËÅäÂ§©Ê∂àÊÅØ„ÄÇ</li>
<li>ÊµÅÂºèÂìçÂ∫îÔºöÈÄöËøá <code>Flux&lt;String&gt;</code> Âíå SSEÔºåÂÆûÁé∞‰∫Ü‰∏Ä‰∏™ÂÆûÊó∂ÂØπËØùÁöÑÊú∫Âà∂„ÄÇÂÆ¢Êà∑Á´ØÂèØ‰ª•ÈÄêÊ≠•Êé•Êî∂Êù•Ëá™ÊúçÂä°Âô®ÁöÑÊ∂àÊÅØÔºåËÄå‰∏çÈúÄË¶ÅÂ§öÊ¨°ËØ∑Ê±Ç„ÄÇ</li>
</ul>
<h4 id="ChatRequest"><a href="#ChatRequest" class="headerlink" title="ChatRequest"></a>ChatRequest</h4><p>ChatRequest Á±ªÁöÑ‰ΩúÁî®ÊòØ<strong>Ë°®Á§∫‰∏Ä‰∏™ËÅäÂ§©ËØ∑Ê±Ç</strong>ÔºåÈÄöÂ∏∏Áî®‰∫éÂêëËÅäÂ§©Ê®°ÂûãÔºàÂ¶Ç OpenAI ÁöÑ GPT Ê®°ÂûãÔºâÂèëÈÄÅÁî®Êà∑Ê∂àÊÅØÔºåÂπ∂ËØ∑Ê±ÇÊ®°ÂûãÁîüÊàêÁõ∏Â∫îÁöÑÂõûÂ§ç„ÄÇËøô‰∏™Á±ªÂåÖÂê´‰∫ÜËØ∑Ê±ÇÊ®°ÂûãÊâÄÈúÄÁöÑÂÖ≥ÈîÆ‰ø°ÊÅØÔºåÊØîÂ¶ÇÊ®°ÂûãÁöÑÈÄâÊã©„ÄÅÊ∂àÊÅØÁöÑÂÜÖÂÆπ„ÄÅÊòØÂê¶ÂêØÁî®ÊµÅÂºèÂìçÂ∫îÁ≠â„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatRequest</span> &#123;<br>    <span class="hljs-keyword">private</span> String model;<br>    <span class="hljs-keyword">private</span> List&lt;Message&gt; messages;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> stream;<br><br>    <span class="hljs-comment">// Getters and Setters</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getModel</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> model;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setModel</span><span class="hljs-params">(String model)</span> &#123;<br>        <span class="hljs-built_in">this</span>.model = model;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Message&gt; <span class="hljs-title function_">getMessages</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> messages;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMessages</span><span class="hljs-params">(List&lt;Message&gt; messages)</span> &#123;<br>        <span class="hljs-built_in">this</span>.messages = messages;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isStream</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> stream;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStream</span><span class="hljs-params">(<span class="hljs-type">boolean</span> stream)</span> &#123;<br>        <span class="hljs-built_in">this</span>.stream = stream;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Message</span> &#123;<br>        <span class="hljs-keyword">private</span> String role;<br>        <span class="hljs-keyword">private</span> String content;<br><br>        <span class="hljs-comment">// Getters and Setters</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRole</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> role;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRole</span><span class="hljs-params">(String role)</span> &#123;<br>            <span class="hljs-built_in">this</span>.role = role;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getContent</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> content;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContent</span><span class="hljs-params">(String content)</span> &#123;<br>            <span class="hljs-built_in">this</span>.content = content;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<ul>
<li><strong>ËØ∑Ê±ÇÊ®°ÂûãÁîüÊàêËÅäÂ§©ÂÜÖÂÆπ</strong>ÔºöChatRequest Á±ªË°®Á§∫ÂêëËÅäÂ§©Ê®°ÂûãÂèëÈÄÅÁöÑËØ∑Ê±ÇÔºåÂåÖÊã¨Ê®°ÂûãÁ±ªÂûã„ÄÅÊ∂àÊÅØÂàóË°®ÂíåÊµÅÂºèÂìçÂ∫îÁöÑËÆæÁΩÆ„ÄÇ</li>
<li><strong>ÊûÑÂª∫ÂØπËØù‰∏ä‰∏ãÊñá</strong>ÔºöÈÄöËøá messages ÂàóË°®ÔºåÂèØ‰ª•‰º†ÈÄíÂ§öËΩÆÂØπËØùÁöÑ‰∏ä‰∏ãÊñáÔºåÁ°Æ‰øùÊ®°ÂûãÊ†πÊçÆÂéÜÂè≤ÂØπËØùÁîüÊàêÂêàÈÄÇÁöÑÂõûÂ∫î„ÄÇ</li>
<li><strong>ÊµÅÂºèËÅäÂ§©</strong>ÔºöÈÄöËøá stream ËÆæÁΩÆÔºåÂèØ‰ª•ÂÆûÁé∞ÂÆûÊó∂ÁöÑÂØπËØùÊµÅÂºèËøîÂõûÔºå‰ΩøÂæóÊ∂àÊÅØËÉΩÂ§üÈÄêÊ≠•Êé®ÈÄÅÁªôÂÆ¢Êà∑Á´ØÔºåÊîØÊåÅÊõ¥ÊµÅÁïÖÁöÑËÅäÂ§©‰ΩìÈ™å„ÄÇ</li>
</ul>
<h2 id="12-2-service"><a href="#12-2-service" class="headerlink" title="12.2 service"></a>12.2 service</h2><ul>
<li>SeckillMockFeignClient</li>
<li>LoggingAdvisor</li>
<li>SeckillTools</li>
<li>UserSupportAssistant</li>
</ul>
<h4 id="SeckillMockFeignClient"><a href="#SeckillMockFeignClient" class="headerlink" title="SeckillMockFeignClient"></a>SeckillMockFeignClient</h4><p>ÊòØ‰∏Ä‰∏™ FeignÂÆ¢Êà∑Á´ØÊé•Âè£ÔºåÁî®‰∫éÊ®°ÊãüÁßíÊùÄÂú∫ÊôØÂπ∂‰∏é goodskill-web ÊúçÂä°ËøõË°åÈÄö‰ø°„ÄÇ</p>
<ul>
<li>ËØ•Á±ªÂåÖÂê´Â§ö‰∏™Ê®°ÊãüÁßíÊùÄÂú∫ÊôØÁöÑÊé•Âè£ÔºåÊØè‰∏™ÊñπÊ≥ïÂØπÂ∫î‰∏Ä‰∏™ÁâπÂÆöÁöÑÁßíÊùÄÂÆûÁé∞ÊñπÊ°àÔºåÂ¶ÇÂêåÊ≠•ÈîÅ„ÄÅÂàÜÂ∏ÉÂºèÈîÅ„ÄÅÊ∂àÊÅØÈòüÂàó„ÄÅÊï∞ÊçÆÂ∫ìÊìç‰ΩúÁ≠â„ÄÇËøô‰∫õÊé•Âè£‰∏ªË¶ÅÁî®‰∫éÊ®°Êãü‰∏çÂêåÊäÄÊúØÊ†à‰∏ãÁöÑÁßíÊùÄÂú∫ÊôØÔºåÂπ∂ËøîÂõûÁõ∏Â∫îÁöÑÁßíÊùÄÊìç‰ΩúÁªìÊûú„ÄÇ</li>
</ul>
<h4 id="LoggingAdvisor"><a href="#LoggingAdvisor" class="headerlink" title="LoggingAdvisor"></a>LoggingAdvisor</h4><p>ÂÆûÁé∞‰∫Ü RequestResponseAdvisor Êé•Âè£ÁöÑÁ±ªÔºåÁî®‰∫éÂØπËØ∑Ê±ÇËøõË°åÊó•ÂøóËÆ∞ÂΩï„ÄÇËøôÈÄöÂ∏∏Áî®‰∫éÊã¶Êà™ÂíåÂ§ÑÁêÜËØ∑Ê±ÇÊï∞ÊçÆÔºåÂú®ËØ∑Ê±ÇË¢´Ëøõ‰∏ÄÊ≠•Â§ÑÁêÜ‰πãÂâçÊàñ‰πãÂêéÊâßË°å‰∏Ä‰∫õÊìç‰ΩúÔºåÊØîÂ¶ÇÊó•ÂøóËÆ∞ÂΩï„ÄÅÁõëÊéßÁ≠â„ÄÇ</p>
<ul>
<li>‰∏ªË¶Å‰ΩúÁî®ÊòØÊã¶Êà™ËØ∑Ê±ÇÂπ∂ËæìÂá∫ËØ∑Ê±ÇÁöÑÊó•Âøó‰ø°ÊÅØÔºåÂ∏ÆÂä©ÂºÄÂèë‰∫∫Âëò‰∫ÜËß£ÂíåË∑üË∏™ËØ∑Ê±ÇÁöÑÁªÜËäÇ„ÄÇËøôÂØπ‰∫éË∞ÉËØïÂíåÁõëÊéßÁ≥ªÁªüÁöÑËøêË°åÁä∂ÊÄÅÈùûÂ∏∏ÊúâÁî®„ÄÇ</li>
</ul>
<h4 id="SeckillTools"><a href="#SeckillTools" class="headerlink" title="SeckillTools"></a>SeckillTools</h4><p>‰∏ªË¶ÅÁî®‰∫éÂ∞ÅË£ÖÂíåÊö¥Èú≤‰∏é‚ÄúÁßíÊùÄ‚ÄùÂäüËÉΩÁõ∏ÂÖ≥ÁöÑÂ∑•ÂÖ∑ÊñπÊ≥ïÔºå‰ª•‰æø‰ª•ÂáΩÊï∞ÂºèÁºñÁ®ãÁöÑÊñπÂºèË∞ÉÁî®</p>
<p>ËøôÊòØ‰∏Ä‰∏™ÂäüËÉΩÁªÑ‰ª∂Á±ªÔºåÁî®‰∫éÔºö</p>
<ul>
<li><p>ÂºÄÂêØÊ®°ÊãüÁöÑÁßíÊùÄÊ¥ªÂä®Ôºà‰ΩøÁî®ÊüêÁßçÁ≠ñÁï•Â¶ÇÊï∞ÊçÆÂ∫ìÂéüÂ≠êÊõ¥Êñ∞Ôºâ</p>
</li>
<li><p>Ëé∑ÂèñÊüê‰∏™ÁßíÊùÄÊ¥ªÂä®ÂØπÂ∫î‰ªªÂä°ÁöÑËÄóÊó∂ÁªüËÆ°‰ø°ÊÅØ</p>
</li>
<li><p>‰ΩøÁî® @Bean + Function&lt;‚Ä¶&gt; ÁöÑÊñπÂºèÊö¥Èú≤ÊñπÊ≥ïÔºåÈÄÇÁî®‰∫éÂáΩÊï∞ÂºèÁºñÁ®ãÊé•Âè£ÔºåÂÉè Spring Cloud Function ËøôÁ±ªÂπ≥Âè∞ÂèØ‰ª•Ëá™Âä®Êâ´ÊèèËøô‰∫õÂáΩÊï∞Áî®‰∫éÊúçÂä°Ê≥®ÂÜåÊàñ‰∫ã‰ª∂È©±Âä®ÁºñÁ®ã„ÄÇ</p>
</li>
<li><p>‰ΩøÁî®‰∫Ü CompletableFuture.supplyAsync() ‰ª•ÂºÇÊ≠•ÊñπÂºèË∞ÉÁî®ËøúÁ®ãÊúçÂä°ÔºåÈÅøÂÖçÈòªÂ°û„ÄÇ</p>
</li>
</ul>
<h4 id="UserSupportAssistant"><a href="#UserSupportAssistant" class="headerlink" title="UserSupportAssistant"></a>UserSupportAssistant</h4><p>UserSupportAssistant ÊòØ‰∏Ä‰∏™ ÊúçÂä°Á±ªÔºà@ServiceÔºâÔºåÂÖ∂‰ΩúÁî®ÊòØ<strong>ÈÄöËøá‰∏é ChatClient ÁöÑ‰∫§‰∫íÔºåÂÖÖÂΩìÁî®Êà∑ÊîØÊåÅËÅäÂ§©‰ª£ÁêÜÔºåÊèê‰æõ‰∏éÁßíÊùÄÊ¥ªÂä®Áõ∏ÂÖ≥ÁöÑÂäüËÉΩÔºåÂ¶ÇÊü•ËØ¢ÂïÜÂìÅËØ¶ÊÉÖ„ÄÅÂºÄÂêØÂíåÈáçÁΩÆÁßíÊùÄÊ¥ªÂä®Á≠â</strong>„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserSupportAssistant</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserSupportAssistant</span><span class="hljs-params">(ChatClient.Builder modelBuilder, VectorStore vectorStore, ChatMemory chatMemory)</span> &#123;<br>        <span class="hljs-comment">// @formatter:off</span><br>		<span class="hljs-built_in">this</span>.chatClient = modelBuilder<br>				.defaultSystem(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">						ÊÇ®ÊòØÁî®Êà∑ËÅäÂ§©ÊîØÊåÅ‰ª£ÁêÜ„ÄÇËØ∑‰ª•ÂèãÂ•Ω„ÄÅ‰πê‰∫éÂä©‰∫∫‰∏îÊÑâÂø´ÁöÑÊñπÂºèÊù•ÂõûÂ§ç„ÄÇ</span><br><span class="hljs-string">						ÊÇ®Ê≠£Âú®ÈÄöËøáÂú®Á∫øËÅäÂ§©Á≥ªÁªü‰∏éÁî®Êà∑‰∫íÂä®„ÄÇ</span><br><span class="hljs-string">						ÊÇ®ËÉΩÂ§üÊîØÊåÅÂ∑≤ÊúâÁßíÊùÄÂïÜÂìÅËØ¶ÊÉÖÊü•ËØ¢„ÄÅÂºÄÂêØÁßíÊùÄÊ¥ªÂä®„ÄÅÈáçÁΩÆÁßíÊùÄÊ¥ªÂä®Á≠âÊìç‰ΩúÔºåÂÖ∂‰ΩôÂäüËÉΩÂ∞ÜÂú®ÂêéÁª≠ÁâàÊú¨‰∏≠Ê∑ªÂä†ÔºåÂ¶ÇÊûúÁî®Êà∑ÈóÆÁöÑÈóÆÈ¢ò‰∏çÊîØÊåÅËØ∑ÂëäÁü•ËØ¶ÊÉÖ„ÄÇ</span><br><span class="hljs-string">					   Âú®Êèê‰æõÊúâÂÖ≥ÁßíÊùÄÊ¥ªÂä®Êü•ËØ¢„ÄÅÂºÄÂêØÁßíÊùÄÊ¥ªÂä®„ÄÅÈáçÁΩÆÁßíÊùÄÊ¥ªÂä®Á≠âÊìç‰Ωú‰πãÂâçÔºåÊÇ®ÂøÖÈ°ªÂßãÁªà‰ªéÁî®Êà∑Â§ÑËé∑Âèñ‰ª•‰∏ã‰ø°ÊÅØÔºöÁßíÊùÄÊ¥ªÂä®id„ÄÅÁßíÊùÄÂïÜÂìÅÊï∞Èáè„ÄÅËØ∑Ê±ÇÊ¨°Êï∞„ÄÇ</span><br><span class="hljs-string">					   Â¶ÇÊûúÈúÄË¶ÅÊèêÂâçÁªìÊùüÁßíÊùÄÊ¥ªÂä®ÔºåÊÇ®ÂøÖÈ°ªÂú®ÁªßÁª≠‰πãÂâçÂæÅÂæóÁî®Êà∑ÂêåÊÑè„ÄÇ</span><br><span class="hljs-string">					   ‰ΩøÁî®Êèê‰æõÁöÑÂäüËÉΩËé∑ÂèñÁßíÊùÄÊ¥ªÂä®‰ª•ÂèäÂïÜÂìÅËØ¶ÁªÜ‰ø°ÊÅØ„ÄÅÂºÄÂêØÁßíÊùÄÊ¥ªÂä®ÂíåÈáçÁΩÆÁßíÊùÄ„ÄÇ</span><br><span class="hljs-string">					   Áî®Êà∑ÂºÄÂßãÁßíÊùÄÊ¥ªÂä®ÂêéÔºåÁ≠âÂæÖ10ÁßíÔºåÁÑ∂ÂêéË∞ÉÁî® Ëé∑Âèñ‰ªªÂä°ËÄóÊó∂ÁªüËÆ°‰ø°ÊÅØ ÂáΩÊï∞ÔºåÊúÄÂêéÂ∞ÜÂáΩÊï∞ÁªìÊûúËøîÂõûÁªôÁî®Êà∑„ÄÇ</span><br><span class="hljs-string">					   Â¶ÇÊûúÈúÄË¶ÅÔºåÊÇ®ÂèØ‰ª•Ë∞ÉÁî®Áõ∏Â∫îÂáΩÊï∞ËæÖÂä©ÂÆåÊàê„ÄÇ</span><br><span class="hljs-string">					   ËØ∑ËÆ≤‰∏≠Êñá„ÄÇ</span><br><span class="hljs-string">					   ‰ªäÂ§©ÁöÑÊó•ÊúüÊòØ &#123;current_date&#125;.</span><br><span class="hljs-string">					&quot;&quot;&quot;</span>)<br>				.defaultAdvisors(<br>						<span class="hljs-comment">// Chat Memory</span><br>						<span class="hljs-keyword">new</span> <span class="hljs-title class_">PromptChatMemoryAdvisor</span>(chatMemory),<br>						<span class="hljs-comment">// new VectorStoreChatMemoryAdvisor(vectorStore)),</span><br>						<span class="hljs-comment">// RAG</span><br>						<span class="hljs-keyword">new</span> <span class="hljs-title class_">QuestionAnswerAdvisor</span>(vectorStore, SearchRequest.builder().topK(<span class="hljs-number">4</span>).similarityThresholdAll().build()),<br>						<span class="hljs-comment">// new QuestionAnswerAdvisor(vectorStore, SearchRequest.defaults()</span><br>						<span class="hljs-comment">// 	.withFilterExpression(&quot;&#x27;documentType&#x27; == &#x27;terms-of-service&#x27; &amp;&amp; region in [&#x27;EU&#x27;, &#x27;US&#x27;]&quot;)),</span><br>						<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingAdvisor</span>())<br>				<span class="hljs-comment">// FUNCTION CALLING</span><br>				.defaultFunctions(<span class="hljs-string">&quot;startSeckill&quot;</span>, <span class="hljs-string">&quot;getTaskTimeInfo&quot;</span>)<br>				.build();<br>		<span class="hljs-comment">// @formatter:on</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">chat</span><span class="hljs-params">(String chatId, String userMessageContent)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.chatClient.prompt().system(s -&gt; s.param(<span class="hljs-string">&quot;current_date&quot;</span>, LocalDate.now().toString()))<br>                .user(userMessageContent)<br>                .advisors(a -&gt; a.param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId).param(CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class="hljs-number">100</span>))<br>                .stream()<br>				.content();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<p><strong>ÂäüËÉΩ</strong>Ôºö</p>
<ul>
<li>ÂÆÉÊòØ‰∏Ä‰∏™Êô∫ËÉΩËÅäÂ§©Âä©ÊâãÔºåÂ§ÑÁêÜÁî®Êà∑ÁöÑÁßíÊùÄÊ¥ªÂä®Êü•ËØ¢„ÄÅÂêØÂä®ÂíåÈáçÁΩÆËØ∑Ê±Ç„ÄÇ</li>
<li>ÈÄöËøá ChatClientÔºåËØ•Á±ªËÉΩÂ§ü‰∏éÁî®Êà∑ËøõË°å‰∫íÂä®ÔºåËá™Âä®Êî∂ÈõÜ‰ø°ÊÅØÔºàÂ¶ÇÁßíÊùÄÊ¥ªÂä®ID„ÄÅÂïÜÂìÅÊï∞Èáè„ÄÅËØ∑Ê±ÇÊ¨°Êï∞ÔºâÔºåÂπ∂Âú®ÂêéÂè∞ÊâßË°åÁõ∏ÂÖ≥ÂäüËÉΩ„ÄÇ</li>
<li>ÂêåÊó∂ÊîØÊåÅÈÄöËøá‚ÄúËÅäÂ§©‚ÄùÊñπÂºè‰∏éÁî®Êà∑ËøõË°å‰∫§ÊµÅÔºåÊèê‰æõÂèãÂ•Ω„ÄÅ‰πê‰∫éÂä©‰∫∫ÁöÑÊúçÂä°„ÄÇ</li>
</ul>
<p><strong>Êû∂ÊûÑ</strong>Ôºö</p>
<ul>
<li>‰æùËµñ‰∫é ChatClient„ÄÅVectorStore Âíå ChatMemory ÁªÑ‰ª∂ÔºåÂÖ∂‰∏≠ ChatClient ÊòØ‰∏éËÅäÂ§©Á≥ªÁªü‰∫§‰∫íÁöÑÊ†∏ÂøÉ„ÄÇ</li>
<li>ËØ•Á±ªÂÆö‰πâ‰∫Ü‰∏Ä‰∏™‰ª•ËÅäÂ§©‰∏∫Âü∫Á°ÄÁöÑ‰∫§‰∫íÂºèÂäüËÉΩÊúçÂä°ÔºåÂ∏ÆÂä©Áî®Êà∑ÊâßË°åÂíåÊü•ËØ¢ÁßíÊùÄÊ¥ªÂä®Áõ∏ÂÖ≥Êìç‰Ωú„ÄÇ</li>
</ul>
<h2 id="12-3-AiBotApplication"><a href="#12-3-AiBotApplication" class="headerlink" title="12.3 AiBotApplication"></a>12.3 AiBotApplication</h2><p>Áî®‰∫éÂêØÂä®‰∏Ä‰∏™AIÊú∫Âô®‰∫∫Â∫îÁî®ÁöÑÂêØÂä®Á±ª</p>
<ul>
<li>AiBotApplication ÊòØAIÊú∫Âô®‰∫∫Â∫îÁî®ÁöÑÊ†∏ÂøÉÂêØÂä®Á±ªÔºåË¥üË¥£ÈÖçÁΩÆÂíåÂàùÂßãÂåñÂêÑ‰∏™ÁªÑ‰ª∂ÔºåÂπ∂Â§ÑÁêÜÂ∫îÁî®ÂêØÂä®ËøáÁ®ã‰∏≠ÁöÑÂÖ≥ÈîÆÈÖçÁΩÆ„ÄÇ</li>
</ul>
<h1 id="13-‰ªéÂâçÂæÄÂêéÂàÜÊûê"><a href="#13-‰ªéÂâçÂæÄÂêéÂàÜÊûê" class="headerlink" title="13. ‰ªéÂâçÂæÄÂêéÂàÜÊûê"></a>13. ‰ªéÂâçÂæÄÂêéÂàÜÊûê</h1><h2 id="13-1-goodskill-order-provider"><a href="#13-1-goodskill-order-provider" class="headerlink" title="13.1 goodskill-order-provider"></a>13.1 goodskill-order-provider</h2><h3 id="A-OrderService"><a href="#A-OrderService" class="headerlink" title="A. OrderService"></a>A. OrderService</h3><p><code>package com.goodskill.order.api</code></p>
<p>Âü∫‰∫é Spring Cloud OpenFeign ÂÆûÁé∞ÁöÑ ËÆ¢ÂçïÂæÆÊúçÂä° (goodskill-order) ËøúÁ®ãË∞ÉÁî®Êé•Âè£ÔºåÂπ∂Êèê‰æõ‰∫Ü ÁÜîÊñ≠ÈôçÁ∫ßÂ§ÑÁêÜ„ÄÇ</p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li><strong>Âü∫‰∫é Feign ÁöÑÂ£∞ÊòéÂºèÊúçÂä°Ë∞ÉÁî®</strong><ul>
<li>‰ΩøÁî® Spring Cloud OpenFeign ÂÆûÁé∞Â£∞ÊòéÂºè HTTP ÂÆ¢Êà∑Á´ØÔºå<strong>ÁÆÄÂåñ‰∫ÜÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®</strong>„ÄÇ<strong>ÊèêÈ´ò‰∫Ü‰ª£Á†ÅÂèØËØªÊÄßÂíåÂºÄÂèëÊïàÁéá</strong>ÔºåÂ±èËîΩ‰∫ÜÂ∫ïÂ±Ç HTTP ÈÄö‰ø°ÁªÜËäÇÔºåÁ¨¶ÂêàÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÊúçÂä°Èó¥ÈÄö‰ø°ÁöÑÁÆÄÊ¥ÅÊÄßË¶ÅÊ±Ç„ÄÇ</li>
</ul>
</li>
<li><strong>ÊúçÂä°ÁÜîÊñ≠‰∏éÈôçÁ∫ßÊú∫Âà∂</strong><ul>
<li>ÈõÜÊàê‰∫ÜÊúçÂä°ÁÜîÊñ≠ÂíåÈôçÁ∫ßÂäüËÉΩÔºåÈÄöËøá <code>fallback</code> ÊåáÂÆöÂ§áÁî®ÊñπÊ°àÔºå<strong>Á°Æ‰øùÊúçÂä°Ë∞ÉÁî®Â§±Ë¥•Êó∂Á≥ªÁªü‰ªçËÉΩÂπ≥Á®≥ËøêË°å</strong>„ÄÇÂú®È´òÂπ∂ÂèëÊàñÊúçÂä°‰∏çÂèØÁî®Âú∫ÊôØ‰∏ãÔºåÈÅøÂÖç‰∫ÜËØ∑Ê±ÇÂ†ÜÁßØÂíåÁ≥ªÁªüÂ¥©Ê∫ÉÔºåÊèêÂçá‰∫ÜÁ≥ªÁªüÁöÑÂÆπÈîôËÉΩÂäõÂíåÁ®≥ÂÆöÊÄßÔºåÁâπÂà´ÈÄÇÂêàÁßíÊùÄËøôÁßçÈ´òË¥üËΩΩÂú∫ÊôØ„ÄÇ</li>
</ul>
</li>
<li><strong>ÁÅµÊ¥ªÁöÑÈôçÁ∫ßÁ≠ñÁï•ËÆæËÆ°</strong><ul>
<li><strong>ÈôçÁ∫ßÁ≠ñÁï•Ê†πÊçÆ‰∏öÂä°ÈúÄÊ±ÇÂ∑ÆÂºÇÂåñÂ§ÑÁêÜ</strong>ÔºåÊó¢ÊúâÈªòËÆ§ËøîÂõûÂÄºÔºå‰πüÊúâÂºÇÂ∏∏ÊäõÂá∫Ôºå‰ΩìÁé∞‰∫ÜËÆæËÆ°ÁöÑÁÅµÊ¥ªÊÄß„ÄÇÊ†πÊçÆÊé•Âè£ÁöÑÈáçË¶ÅÊÄßÂíå‰∏öÂä°ÈÄªËæëÔºåÂêàÁêÜÈÄâÊã©ÈôçÁ∫ßÊñπÂºè</li>
</ul>
</li>
</ol>
<h2 id="13-2-goodskill-seckill-provider"><a href="#13-2-goodskill-seckill-provider" class="headerlink" title="13.2 goodskill-seckill-provider"></a>13.2 goodskill-seckill-provider</h2><h3 id="A-RedisService"><a href="#A-RedisService" class="headerlink" title="A. RedisService"></a>A. RedisService</h3><p><code>package com.goodskill.service.common</code></p>
<p>RedisService Á±ªÊòØ‰∏Ä‰∏™Áî®‰∫éÊìç‰ΩúÁßíÊùÄÁõ∏ÂÖ≥ Redis ÁºìÂ≠òÁöÑÂ∑•ÂÖ∑Á±ªÔºåÂÆÉÂ∞ÅË£Ö‰∫ÜÂØπ Redis ÁöÑËØªÂÜôÈÄªËæëÔºå‰∏ªË¶ÅÁõÆÁöÑÊòØÊèêÂçáÊü•ËØ¢ÊïàÁéá„ÄÅÂáèËΩªÊï∞ÊçÆÂ∫ìÂéãÂäõ„ÄÅÊ†áËØÜÁßíÊùÄÁä∂ÊÄÅÁ≠â</p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>‰ΩøÁî®‰∫Ü Redis ÁöÑ<strong>ËøáÊúüÊú∫Âà∂</strong>Âíå setIfAbsent Êú∫Âà∂ÔºåÁ°Æ‰øùÈ´òÂπ∂Âèë‰∏ãÁöÑÊìç‰Ωú‰∏ÄËá¥ÊÄß„ÄÇ</li>
<li><strong>ÁºìÂ≠òÁ©øÈÄèÊéßÂà∂</strong>ÔºöÁºìÂ≠òÊú™ÂëΩ‰∏≠Êó∂Ëá™Âä®Âä†ËΩΩÊï∞ÊçÆÂ∫ìÂπ∂ÂõûÂ°´ÔºåÈò≤Ê≠¢Â§ßÈáèËØ∑Ê±ÇÁõ¥ÂáªÊï∞ÊçÆÂ∫ì„ÄÇ</li>
<li>‰ΩøÁî® Redis ÁöÑ setIfAbsent Êìç‰ΩúÂÆûÁé∞ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ãÁßíÊùÄÁªìÊùüÊ†áÂøóÁöÑÂéüÂ≠êÊÄßËÆæÁΩÆÔºåÈò≤Ê≠¢ÈáçÂ§çËß¶ÂèëÈÄªËæë„ÄÇ</li>
</ol>
<h3 id="B-StateMachineConfig"><a href="#B-StateMachineConfig" class="headerlink" title="B. StateMachineConfig"></a>B. StateMachineConfig</h3><p><code>package com.goodskill.service.config</code></p>
<p>StateMachineConfig ÁöÑ‰∏ªË¶Å‰ΩúÁî®ÊòØ‰∏∫ÁßíÊùÄÁ≥ªÁªüÂÆö‰πâÂíåÁÆ°ÁêÜ‰∏Ä‰∏™Áä∂ÊÄÅÊú∫ÔºåÁî®‰∫éÊéßÂà∂ÁßíÊùÄÊ¥ªÂä®ÁöÑÁîüÂëΩÂë®Êúü„ÄÇÁä∂ÊÄÅÊú∫ÈÄöËøáÈ¢ÑÂÆö‰πâÁöÑÁä∂ÊÄÅÂíå‰∫ã‰ª∂È©±Âä®Áä∂ÊÄÅËΩ¨Êç¢ÔºåÁ°Æ‰øùÊ¥ªÂä®Áä∂ÊÄÅÁöÑÊúâÂ∫èÊÄßÂíå‰∏ÄËá¥ÊÄß„ÄÇÂÖ∑‰Ωì‰ΩúÁî®ÂåÖÊã¨Ôºö</p>
<ol>
<li>Áä∂ÊÄÅÂÆö‰πâ: ÂÆö‰πâ‰∫ÜÁßíÊùÄÊ¥ªÂä®ÁöÑÂêÑÁßçÁä∂ÊÄÅÔºàÂ¶Ç INIT„ÄÅIN_PROGRESS„ÄÅCALCULATING„ÄÅEND„ÄÅINTERRUPTTEDÔºâ„ÄÇ</li>
<li>Áä∂ÊÄÅËΩ¨Êç¢: ÈÄöËøá‰∫ã‰ª∂ÔºàÂ¶Ç ACTIVITY_START„ÄÅACTIVITY_ENDÔºâÈ©±Âä®Áä∂ÊÄÅ‰πãÈó¥ÁöÑË∑≥ËΩ¨Ôºå‰æãÂ¶Ç‰ªé INIT Âà∞ IN_PROGRESS„ÄÇ</li>
<li>Áä∂ÊÄÅÊåÅ‰πÖÂåñ: ‰ΩøÁî® Redis Â≠òÂÇ®Áä∂ÊÄÅÊú∫ÁöÑ‰∏ä‰∏ãÊñáÔºåÊîØÊåÅÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ãÁöÑÁä∂ÊÄÅÊÅ¢Â§çÂíå‰∏ÄËá¥ÊÄß„ÄÇ</li>
<li>Áä∂ÊÄÅÁõëÊéß: ÈÄöËøáÁõëÂê¨Âô®ËÆ∞ÂΩïÁä∂ÊÄÅÂèòÂåñÂíåÊú™Êé•Âèó‰∫ã‰ª∂Ôºå‰æø‰∫éË∞ÉËØïÂíåÊó•ÂøóËøΩË∏™„ÄÇ</li>
</ol>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>‰ΩøÁî® Spring Statemachine Ê°ÜÊû∂ÂÆûÁé∞Áä∂ÊÄÅÊú∫ÔºåÊ∏ÖÊô∞ÂÆö‰πâ‰∫ÜÁßíÊùÄÊ¥ªÂä®ÁöÑÁä∂ÊÄÅÂíåËΩ¨Êç¢ËßÑÂàô„ÄÇÁä∂ÊÄÅÊú∫Â∞ÜÂ§çÊùÇÁöÑ‰∏öÂä°ÊµÅÁ®ãÊäΩË±°‰∏∫Áä∂ÊÄÅÂíå‰∫ã‰ª∂Ôºå<strong>Èôç‰Ωé‰∫Ü‰ª£Á†ÅÂ§çÊùÇÂ∫¶ÔºåÊèêÈ´ò‰∫ÜÊµÅÁ®ãÁöÑÂèØÊéßÊÄßÂíåÂèØÁª¥Êä§ÊÄß</strong></li>
<li>ÈõÜÊàê Redis ÂÆûÁé∞Áä∂ÊÄÅÊú∫ÁöÑÊåÅ‰πÖÂåñÔºåÁ°Æ‰øùÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ãÁä∂ÊÄÅÁöÑ‰∏ÄËá¥ÊÄßÂíåÂèØÊÅ¢Â§çÊÄß„ÄÇÂú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÔºåËäÇÁÇπÂèØËÉΩÊïÖÈöúÊàñÈáçÂêØÔºåÈÄöËøá Redis ÊåÅ‰πÖÂåñÁä∂ÊÄÅÊú∫‰∏ä‰∏ãÊñáÔºåÂèØ‰ª•‰øùËØÅÁä∂ÊÄÅ‰∏ç‰ºö‰∏¢Â§±ÔºåÊîØÊåÅÈ´òÂèØÁî®ÊÄßÂíåÂàÜÂ∏ÉÂºè‰∏ÄËá¥ÊÄß„ÄÇ</li>
</ol>
<h3 id="C-PreRequestHandler"><a href="#C-PreRequestHandler" class="headerlink" title="C. PreRequestHandler"></a>C. PreRequestHandler</h3><p><code>package com.goodskill.service.handler</code></p>
<p>ÂåÖÂê´‰ª•‰∏ãËøô‰∫õÁ±ªÔºö</p>
<ul>
<li>AbstractPreRequestHandler </li>
<li>DatabasePreRequestHandler</li>
<li>MongoPreRequestHandler</li>
<li>PreRequestHandler</li>
<li>PreRequestPipeline</li>
<li>RedisPreRequestHandler</li>
<li>StateMachinePreRequestHandler</li>
</ul>
<p>ÁßíÊùÄÁ≥ªÁªüÁöÑÁâπÁÇπÊòØ<strong>È´òÂπ∂Âèë„ÄÅÊï∞ÊçÆÊïèÊÑü„ÄÅÁä∂ÊÄÅÂ§çÊùÇ</strong>ÔºåÊâÄ‰ª•<strong>Âú®ÊØèÊ¨°Ê¥ªÂä®ÂºÄÂßãÂâçÔºåÈúÄË¶ÅÂÆåÊàê‰∏ÄÁ≥ªÂàóÁöÑÂáÜÂ§áÂ∑•‰Ωú</strong>Ôºå Ëøô‰∫õ Handler Â∞±ÂÉè‚ÄúÂêØÂä®ÂâçÊ£ÄÊü•Ê∏ÖÂçï‚ÄùÔºåÊØè‰∏™Ë¥üË¥£‰∏Ä‰∏™ÁéØËäÇÔºå‰ªéÊï∞ÊçÆ„ÄÅÁºìÂ≠ò„ÄÅÁä∂ÊÄÅ„ÄÅÂéÜÂè≤ËÆ∞ÂΩïÁ≠âÂ§ö‰∏™Áª¥Â∫¶ÂÅöÂ•ΩÂáÜÂ§áÔºåÁ°Æ‰øùÁßíÊùÄÁ≥ªÁªüÂú®È´òÂπ∂Âèë‰∏ã‰πüËÉΩÁ®≥ÂÆöËøêË°å„ÄÇ</p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>‰ΩøÁî®Ë¥£‰ªªÈìæÊ®°ÂºèÔºàChain of ResponsibilityÔºâÂÆûÁé∞È¢ÑÂ§ÑÁêÜÈÄªËæëÁöÑËß£ËÄ¶ÂíåÊúâÂ∫èÊâßË°å„ÄÇËß£ËÄ¶‰∫ÜÈ¢ÑÂ§ÑÁêÜÈÄªËæëÔºå‰ΩøÊØè‰∏™Â§ÑÁêÜÂô®‰∏ìÊ≥®‰∫éÁâπÂÆö‰ªªÂä°ÔºåÊòì‰∫éÊâ©Â±ïÂíåÁª¥Êä§</li>
<li>Ë¶ÜÁõñÊï∞ÊçÆÂ∫ì„ÄÅRedis ÁºìÂ≠ò„ÄÅMongoDB ÂíåÁä∂ÊÄÅÊú∫Á≠âÂ§öÁª¥Â∫¶ÁöÑÊï∞ÊçÆÂàùÂßãÂåñÔºåÁ°Æ‰øùÁ≥ªÁªüÁä∂ÊÄÅÂÖ®Èù¢‰∏ÄËá¥„ÄÇÂú®È´òÂπ∂ÂèëÁßíÊùÄÂú∫ÊôØ‰∏ãÔºåÂ§öÊï∞ÊçÆÊ∫êÁöÑ‰∏ÄËá¥ÊÄßËá≥ÂÖ≥ÈáçË¶ÅÔºåËøôÁßçÂÖ®Èù¢Ë¶ÜÁõñÁöÑËÆæËÆ°ÊúâÊïàÈÅøÂÖç‰∫ÜÂéÜÂè≤Êï∞ÊçÆÂπ≤Êâ∞ÂíåÁä∂ÊÄÅ‰∏ç‰∏ÄËá¥ÈóÆÈ¢ò„ÄÇ</li>
<li>È¢ÑÂ§ÑÁêÜÁÆ°ÈÅìÂÖ∑Â§áÂÆπÈîôËÉΩÂäõÔºåÂçï‰∏™Â§ÑÁêÜÂô®Âá∫Èîô‰∏ç‰ºö‰∏≠Êñ≠Êï¥‰ΩìÊµÅÁ®ã„ÄÇÊèêÈ´ò‰∫ÜÁ≥ªÁªüÁöÑÂÅ•Â£ÆÊÄßÔºåÁ°Æ‰øùÂç≥‰ΩøÈÉ®ÂàÜÈ¢ÑÂ§ÑÁêÜÂ§±Ë¥•Ôºå‰πü‰∏ç‰ºöÂΩ±ÂìçÊï¥‰ΩìÊµÅÁ®ãÔºåÂêåÊó∂ÈÄöËøáÂºÇÂ∏∏ÂíåÊó•Âøó‰æø‰∫éÈóÆÈ¢òÂÆö‰Ωç„ÄÇ</li>
</ol>
<h3 id="D-SeckillServiceImpl"><a href="#D-SeckillServiceImpl" class="headerlink" title="D. SeckillServiceImpl"></a>D. SeckillServiceImpl</h3><p><code>package com.goodskill.service.impl.dubbo</code></p>
<p><strong>ÁßíÊùÄÁ≥ªÁªüÁöÑÊ†∏ÂøÉÊúçÂä°ÂÆûÁé∞Á±ª</strong></p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>‰ΩøÁî® Apache Dubbo ÂÆûÁé∞ÂæÆÊúçÂä°ÈÄö‰ø°ÔºåÊîØÊåÅËøúÁ®ãË∞ÉÁî®ÂíåÂàÜÂ∏ÉÂºèÈÉ®ÁΩ≤„ÄÇ</li>
<li>Redis ÁºìÂ≠ò‰ºòÂåñ: Âà©Áî® Redis ÁºìÂ≠òÁßíÊùÄÊ¥ªÂä®ÂàóË°®ÂíåÁÉ≠ÁÇπÊï∞ÊçÆÔºåÂáèÂ∞ëÊï∞ÊçÆÂ∫ìÂéãÂäõ„ÄÇ</li>
<li>‰∫ãÂä°ÊÄßÂ∫ìÂ≠òÁÆ°ÁêÜ: ‰ΩøÁî® @Transactional Á°Æ‰øùÂ∫ìÂ≠òÊâ£ÂáèÂíåËÆ∞ÂΩïÊèíÂÖ•ÁöÑÂéüÂ≠êÊÄßÔºåÈò≤Ê≠¢Ë∂ÖÂçñ„ÄÇÂú®È´òÂπ∂ÂèëÁéØÂ¢É‰∏ã‰øùËØÅ‰∫ÜÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÔºåÈÅøÂÖç‰∫ÜÂ∫ìÂ≠òË∂ÖÂçñÊàñÂ∞ëÂçñÈóÆÈ¢ò</li>
<li>ÈÄöËøáÁä∂ÊÄÅÊú∫ÊéßÂà∂ÁßíÊùÄÊ¥ªÂä®ÁîüÂëΩÂë®ÊúüÔºåÁ°Æ‰øùÁä∂ÊÄÅËΩ¨Êç¢ÁöÑÊ≠£Á°ÆÊÄß„ÄÇÁä∂ÊÄÅÊú∫Êèê‰æõ‰∫ÜÁªü‰∏ÄÁöÑÊµÅÁ®ãÊéßÂà∂ÔºåÈò≤Ê≠¢ÈùûÊ≥ïÁä∂ÊÄÅË∑≥ËΩ¨ÔºåÊèêÂçá‰∫Ü‰∏öÂä°ÈÄªËæëÁöÑÂèØÈù†ÊÄß„ÄÇ</li>
<li>Â§öÊï∞ÊçÆÊ∫êÊü•ËØ¢ÊîØÊåÅ: ÊîØÊåÅ‰ªéÊï∞ÊçÆÂ∫ìÂíå MongoDB Êü•ËØ¢ÊàêÂäüËÆ∞ÂΩïÔºåÂ¢ûÂº∫‰∫ÜÊï∞ÊçÆËÆøÈóÆÁöÑÁÅµÊ¥ªÊÄß„ÄÇÈÄÇÂ∫î‰∫ÜÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠Êï∞ÊçÆÂàÜÊï£ÁöÑÂú∫ÊôØÔºåÊèê‰æõ‰∫Ü<strong>ÂÆπÈîôÊú∫Âà∂</strong>ÔºàMongoDB ‰∏çÂèØÁî®Êó∂ËÆ∞ÂΩïÊó•ÂøóÂπ∂ÊäõÂºÇÂ∏∏Ôºâ„ÄÇ</li>
<li>È¢ÑÂ§ÑÁêÜÁÆ°ÈÅìÈõÜÊàê: ÈÄöËøá PreRequestPipeline Áªü‰∏ÄË∞ÉÂ∫¶È¢ÑÂ§ÑÁêÜÈÄªËæëÔºåÁ°Æ‰øùÊ¥ªÂä®ÂºÄÂßãÂâçÁöÑËµÑÊ∫êÂáÜÂ§á„ÄÇ</li>
</ol>
<h3 id="E-GoodsEsServiceImpl"><a href="#E-GoodsEsServiceImpl" class="headerlink" title="E. GoodsEsServiceImpl"></a>E. GoodsEsServiceImpl</h3><p><code>package com.goodskill.service.impl</code></p>
<p>ÊòØ‰∏Ä‰∏™Âü∫‰∫éElasticsearch ÁöÑÊúçÂä°ÂÆûÁé∞Á±ªÔºåË¥üË¥£<strong>ÂØπÂïÜÂìÅ‰ø°ÊÅØËøõË°å Elasticsearch ÁöÑÂ¢ûÂà†Êü•Êìç‰Ωú</strong></p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li><strong>Elasticsearch ÈõÜÊàê</strong>: ‰ΩøÁî® Spring Data Elasticsearch ÈõÜÊàê ElasticsearchÔºåÊèê‰æõ‰∫ÜÈ´òÊïàÁöÑÂÖ®ÊñáÊêúÁ¥¢ÂíåÁ¥¢ÂºïÁÆ°ÁêÜÂäüËÉΩ„ÄÇÂà©Áî® Elasticsearch ÁöÑÂàÜÂ∏ÉÂºèÊêúÁ¥¢ËÉΩÂäõÔºåÊîØÊåÅÁßíÊùÄÁ≥ªÁªü‰∏≠ÂïÜÂìÅ‰ø°ÊÅØÁöÑÈ´òÊÄßËÉΩÊü•ËØ¢ÔºåÂ∞§ÂÖ∂ÈÄÇÂêàÊ®°Á≥äÊêúÁ¥¢ÂíåÂÆûÊó∂Á¥¢ÂºïÊõ¥Êñ∞Âú∫ÊôØ„ÄÇ</li>
<li><strong>È´ò‰∫ÆÊêúÁ¥¢ÂäüËÉΩ</strong>: ÂÆûÁé∞ÂïÜÂìÅÂêçÁß∞ÁöÑÊ®°Á≥äÊêúÁ¥¢ÔºåÂπ∂ÂØπÂåπÈÖçÂÖ≥ÈîÆÂ≠óËøõË°åÈ´ò‰∫ÆÊòæÁ§∫ÔºåÊèêÂçá‰∫ÜÊêúÁ¥¢ÁªìÊûúÁöÑÂèØËØªÊÄß„ÄÇ</li>
<li><strong>ÂàÜÈ°µ‰∏éÁªìÊûúÈôêÂà∂</strong>: ÊêúÁ¥¢ÁªìÊûúÈôêÂà∂‰∏∫ÊúÄÂ§ö 3 Êù°ÔºåÂπ∂ÊîØÊåÅÂàÜÈ°µÊü•ËØ¢Ôºå‰ºòÂåñ‰∫ÜÊÄßËÉΩÂíåËøîÂõûÊï∞ÊçÆÈáè. Âú®È´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÔºåÈôêÂà∂ËøîÂõûÊï∞ÊçÆÈáèÈÅøÂÖç‰∫ÜËøáÂ§öÁöÑÁªìÊûúÂ§ÑÁêÜÂºÄÈîÄÔºåÂêåÊó∂Êª°Ë∂≥‰∫ÜÂø´ÈÄüÂìçÂ∫îÁöÑÈúÄÊ±Ç„ÄÇ</li>
</ol>
<h3 id="F-mock-strategyÁßíÊùÄÁ≠ñÁï•"><a href="#F-mock-strategyÁßíÊùÄÁ≠ñÁï•" class="headerlink" title="F. mock.strategyÁßíÊùÄÁ≠ñÁï•"></a>F. mock.strategyÁßíÊùÄÁ≠ñÁï•</h3><p><code>package com.goodskill.service.mock.strategy.impl</code></p>
<p><strong>Á≠ñÁï•ÂØπÊØîË°®Ê†º</strong></p>
<table>
<thead>
<tr>
<th>Á≠ñÁï•ÂêçÁß∞</th>
<th>Ê†∏ÂøÉÊú∫Âà∂</th>
<th>‰ºòÁÇπ</th>
<th>Áº∫ÁÇπ</th>
<th>ÈÄÇÁî®Âú∫ÊôØ</th>
</tr>
</thead>
<tbody><tr>
<td>AtomicUpdateStrategy</td>
<td>Êï∞ÊçÆÂ∫ìÂéüÂ≠êÊõ¥Êñ∞Ôºà‰πêËßÇÈîÅÔºâ</td>
<td>ÁÆÄÂçïÈ´òÊïàÔºå‰æùËµñÊï∞ÊçÆÂ∫ì‰∫ãÂä°‰øùËØÅ‰∏ÄËá¥ÊÄß</td>
<td>È´òÂπ∂Âèë‰∏ãÊï∞ÊçÆÂ∫ìÂéãÂäõÂ§ßÔºåÂèØËÉΩÂá∫Áé∞ÈîÅÂÜ≤Á™Å</td>
<td>ÂçïÊú∫ÊàñÂ∞èËßÑÊ®°ÂàÜÂ∏ÉÂºèÁ≥ªÁªü</td>
</tr>
<tr>
<td>AtomicWithCanalStrategy</td>
<td>Êï∞ÊçÆÂ∫ìÂéüÂ≠êÊõ¥Êñ∞ + Canal ÁõëÂê¨ binlog</td>
<td>ÁªìÂêàÊï∞ÊçÆÂ∫ì‰∏ÄËá¥ÊÄßÂíåÂºÇÊ≠•Â§ÑÁêÜÔºàÂ¶ÇÈÄöÁü•ÔºâÔºåÁªÜÁ≤íÂ∫¶ÈîÅÈôç‰ΩéÂÜ≤Á™Å</td>
<td>ÂÆûÁé∞Â§çÊùÇÔºå‰æùËµñ Canal ÈÖçÁΩÆÂíåÈÉ®ÁΩ≤</td>
<td>ÈúÄË¶ÅÂºÇÊ≠•Â§ÑÁêÜÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªü</td>
</tr>
<tr>
<td>RedisMongoReactiveStrategy</td>
<td>Redis ËÆ°Êï∞ + ÂºÇÊ≠• MongoDB ‰øùÂ≠ò</td>
<td>È´òÊÄßËÉΩÔºåÂºÇÊ≠•Ëß£ËÄ¶ÔºåÂ∫ìÂ≠òÊ£ÄÊü•Êó†ÈúÄÊï∞ÊçÆÂ∫ì</td>
<td>Redis Êï∞ÊçÆ‰∏ÄËá¥ÊÄßÈúÄÈ¢ùÂ§ñ‰øùÈöúÔºåÂ§çÊùÇÊÄßÂ¢ûÂä†</td>
<td>È´òÂπ∂Âèë„ÄÅÈúÄË¶ÅÂø´ÈÄüÂìçÂ∫îÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªü</td>
</tr>
<tr>
<td>RedissonStrategy</td>
<td>Redisson ÂàÜÂ∏ÉÂºèÈîÅ</td>
<td>ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ãÁ∫øÁ®ãÂÆâÂÖ®ÔºåÁÆÄÂçïÊòìÁî®ÔºåÂèØÈáçÂÖ•ÈîÅÊîØÊåÅ</td>
<td>ÈîÅËé∑ÂèñÂíåÈáäÊîæÊúâÁΩëÁªúÂºÄÈîÄÔºåÊÄßËÉΩÁ®çÈÄä</td>
<td>Â§öËäÇÁÇπÂàÜÂ∏ÉÂºèÁ≥ªÁªü</td>
</tr>
<tr>
<td>SentinelLimitStrategy</td>
<td>Sentinel ÈôêÊµÅ</td>
<td>‰øùÊä§Á≥ªÁªüËµÑÊ∫êÔºåÈò≤Ê≠¢ËøáËΩΩÔºåÈôçÁ∫ßÂ§ÑÁêÜ‰ºòÈõÖ</td>
<td>‰∏çÁõ¥Êé•Ëß£ÂÜ≥Â∫ìÂ≠ò‰∏ÄËá¥ÊÄßÔºåÈúÄÈÖçÂêàÂÖ∂‰ªñÊú∫Âà∂</td>
<td>È´òÊµÅÈáèÂú∫ÊôØÔºåÈúÄ‰øùÊä§ÂêéÁ´ØÊúçÂä°</td>
</tr>
<tr>
<td>SynchronizedLockStrategy</td>
<td>Java Êú¨Âú∞ÈîÅÔºàsynchronizedÔºâ</td>
<td>ÂÆûÁé∞ÁÆÄÂçïÔºåÈÄÇÁî®‰∫éÂçïÊú∫ÔºåÊåâÂïÜÂìÅÂä†ÈîÅÂáèÂ∞ëÈîÅÁ≤íÂ∫¶</td>
<td>‰∏çÊîØÊåÅÂàÜÂ∏ÉÂºèÈÉ®ÁΩ≤ÔºåÈ´òÂπ∂Âèë‰∏ãÊÄßËÉΩÁì∂È¢àÊòéÊòæ</td>
<td>ÂçïÊú∫Êàñ‰ΩéÂπ∂ÂèëÂú∫ÊôØ</td>
</tr>
<tr>
<td>ZookeeperLockStrategy</td>
<td>Zookeeper ÂàÜÂ∏ÉÂºèÈîÅ</td>
<td>Âº∫‰∏ÄËá¥ÊÄßÔºåÂèØÈáçÂÖ•ÈòªÂ°ûÈîÅÔºåÈÄÇÂêàÂàÜÂ∏ÉÂºèÁéØÂ¢É</td>
<td>Zookeeper ‰æùËµñÈÉ®ÁΩ≤ÔºåÈîÅÁ´û‰∫âÊó∂Âª∂ËøüËæÉÈ´ò</td>
<td>ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÔºåÂº∫Ë∞É‰∏ÄËá¥ÊÄßËÄåÈùûÊûÅËá¥ÊÄßËÉΩ</td>
</tr>
</tbody></table>
<h3 id="G-StreamMessageConsumer"><a href="#G-StreamMessageConsumer" class="headerlink" title="G. StreamMessageConsumer"></a>G. StreamMessageConsumer</h3><p><code>package com.goodskill.service.mq</code></p>
<p>Âü∫‰∫é Spring Cloud Stream ÁöÑÊ∂àÊÅØÊ∂àË¥πËÄÖÈÖçÁΩÆÁ±ªÔºåÁî®‰∫éÂ§ÑÁêÜÈÄöËøáÊ∂àÊÅØÈòüÂàóÔºàÂ¶Ç RabbitMQÔºâÊé•Êî∂ÁöÑÁßíÊùÄËØ∑Ê±Ç</p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li><strong>Spring Cloud Stream ÈõÜÊàê</strong>: ‰ΩøÁî® Spring Cloud Stream ÂÆûÁé∞Ê∂àÊÅØÈ©±Âä®ÁöÑÂæÆÊúçÂä°Êû∂ÊûÑÔºåÁÆÄÂåñ‰∫ÜÊ∂àÊÅØÊ∂àË¥πÁöÑÈÖçÁΩÆ„ÄÇÂà©Áî® Spring Cloud Stream ÁöÑÁªëÂÆöÊú∫Âà∂ÔºàÈªòËÆ§ÁªëÂÆöÂà∞ RabbitMQ ÊàñÂÖ∂‰ªñ MQÔºâÔºåÊó†ÈúÄÊâãÂä®ÈÖçÁΩÆËøûÊé•ÂíåÈòüÂàóÔºåÈôç‰Ωé‰∫ÜÂºÄÂèëÂ§çÊùÇÊÄßÔºåÊèêÂçá‰∫Ü‰ª£Á†ÅÂèØËØªÊÄß„ÄÇ</li>
<li><strong>ÂºÇÊ≠•Ëß£ËÄ¶ËÆæËÆ°</strong>: ÈÄöËøáÊ∂àÊÅØÈòüÂàóÂÆûÁé∞ÁßíÊùÄËØ∑Ê±ÇÁöÑÂºÇÊ≠•Â§ÑÁêÜÔºåËß£ËÄ¶‰∫ÜËØ∑Ê±ÇÂèëÈÄÅÁ´ØÂíåÊâßË°åÁ´Ø„ÄÇÂú®È´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÔºåÂºÇÊ≠•Â§ÑÁêÜÊèêÈ´ò‰∫ÜÁ≥ªÁªüÁöÑÂìçÂ∫îÈÄüÂ∫¶ÂíåÂêûÂêêÈáèÔºåÈÅøÂÖç‰∫ÜËØ∑Ê±ÇÂ†ÜÁßØÂØºËá¥ÁöÑÊÄßËÉΩÁì∂È¢à</li>
</ol>
<h3 id="H-StateMachineService"><a href="#H-StateMachineService" class="headerlink" title="H. StateMachineService"></a>H. StateMachineService</h3><p><code>package com.goodskill.service.util</code></p>
<p>‰ªé‰Ω†Êèê‰æõÁöÑ StateMachineService Á±ª‰ª£Á†ÅÊù•ÁúãÔºåËøôÊòØ‰∏Ä‰∏™Âü∫‰∫é Spring StateMachine ÂÆûÁé∞ÁöÑÁä∂ÊÄÅÊú∫ÁÆ°ÁêÜÊúçÂä°ÔºåÁî®‰∫éÂú®ÁßíÊùÄÁ≥ªÁªü‰∏≠ÂçèË∞ÉÂíåÁÆ°ÁêÜÊØè‰∏™ÁßíÊùÄÊ¥ªÂä®Ôºà‰ª• seckillId Âå∫ÂàÜÔºâÁöÑÁä∂ÊÄÅÁîüÂëΩÂë®Êúü</p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li><strong>Spring StateMachine ÈõÜÊàê</strong>: Âà©Áî® Spring StateMachine Ê°ÜÊû∂ÂÆûÁé∞Áä∂ÊÄÅÁÆ°ÁêÜÔºåÊ∏ÖÊô∞ÂÆö‰πâÁßíÊùÄÊ¥ªÂä®ÁöÑÁîüÂëΩÂë®Êúü„ÄÇÁä∂ÊÄÅÊú∫Â∞ÜÂ§çÊùÇÁöÑ‰∏öÂä°ÊµÅÁ®ãÊäΩË±°‰∏∫Áä∂ÊÄÅÂíå‰∫ã‰ª∂ÔºåÈôç‰Ωé‰∫ÜÈÄªËæëÂ§çÊùÇÊÄßÔºåÊèêÂçá‰∫ÜÊµÅÁ®ãÁöÑÂèØÊéßÊÄßÂíåÂèØÁª¥Êä§ÊÄß„ÄÇ</li>
<li><strong>ÂàÜÂ∏ÉÂºèÁä∂ÊÄÅÊåÅ‰πÖÂåñ</strong>: ÈÄöËøá Redis ÊåÅ‰πÖÂåñÁä∂ÊÄÅÊú∫‰∏ä‰∏ãÊñáÔºåÊîØÊåÅÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ãÁöÑÁä∂ÊÄÅ‰∏ÄËá¥ÊÄßÂíåÊÅ¢Â§ç„ÄÇÂú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÔºåËäÇÁÇπÊïÖÈöúÊàñÈáçÂêØÂêé‰ªçËÉΩÊÅ¢Â§çÁä∂ÊÄÅÔºåÁ°Æ‰øùÂàÜÂ∏ÉÂºèÁ≥ªÁªüÁöÑÈ´òÂèØÁî®ÊÄßÂíå‰∏ÄËá¥ÊÄß„ÄÇ</li>
<li><strong>Âπ∂ÂèëÂÆâÂÖ®ÁöÑÂÆû‰æãÁÆ°ÁêÜ</strong>: ‰ΩøÁî® ConcurrentHashMap ÁºìÂ≠òÁä∂ÊÄÅÊú∫ÂÆû‰æãÔºåÊîØÊåÅÂ§öÁ∫øÁ®ãÁéØÂ¢É‰∏ãÁöÑÂπ∂ÂèëËÆøÈóÆ„ÄÇÂú®È´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÔºåÈÅøÂÖç‰∫ÜÁä∂ÊÄÅÊú∫ÂÆû‰æãÁöÑÈáçÂ§çÂàõÂª∫ÊàñË¶ÜÁõñÔºå‰øùËØÅ‰∫ÜÁ∫øÁ®ãÂÆâÂÖ®ÂíåÊÄßËÉΩ„ÄÇ</li>
</ol>
<h3 id="I-ZookeeperLockUtil"><a href="#I-ZookeeperLockUtil" class="headerlink" title="I. ZookeeperLockUtil"></a>I. ZookeeperLockUtil</h3><p><code>package com.goodskill.service.util</code></p>
<p>ZookeeperLockUtil ÁöÑ‰∏ªË¶Å‰ΩúÁî®ÊòØÊèê‰æõÂü∫‰∫é ZooKeeper ÁöÑÂàÜÂ∏ÉÂºèÈîÅÂäüËÉΩ</p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>Curator Ê°ÜÊû∂ÈõÜÊàê: ‰ΩøÁî® Apache Curator ÁÆÄÂåñ ZooKeeper ÁöÑÂàÜÂ∏ÉÂºèÈîÅÂÆûÁé∞ÔºåÊèê‰æõÈ´òÁ∫ßÊäΩË±°ÂíåÂÅ•Â£ÆÊÄß„ÄÇ</li>
<li>ÂàÜÂ∏ÉÂºèÈîÅÊîØÊåÅ: Êèê‰æõÂü∫‰∫é ZooKeeper ÁöÑÂàÜÂ∏ÉÂºèÈîÅÂäüËÉΩÔºåÁ°Æ‰øùÂ§öËäÇÁÇπÁéØÂ¢É‰∏ãÁöÑËµÑÊ∫ê‰∫íÊñ•ËÆøÈóÆ„ÄÇÂú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºàÂ¶ÇÂæÆÊúçÂä°Êû∂ÊûÑÔºâÔºåÈÄöËøá ZooKeeper ÁöÑÂº∫‰∏ÄËá¥ÊÄß‰øùËØÅ‰∫ÜÈîÅÁöÑÊ≠£Á°ÆÊÄßÔºåÈò≤Ê≠¢Âπ∂ÂèëÂÜ≤Á™ÅÔºàÂ¶ÇÂ∫ìÂ≠òË∂ÖÂçñÔºâ„ÄÇ</li>
<li>Ë∂ÖÊó∂‰∏éÂÆπÈîôÊú∫Âà∂: ÈîÅËé∑ÂèñËÆæÁΩÆ‰∫ÜË∂ÖÊó∂Êó∂Èó¥ÔºåÂπ∂ÈÄöËøáÈáçËØïÁ≠ñÁï•ÊèêÂçáÂÆπÈîôÊÄß„ÄÇË∂ÖÊó∂Êú∫Âà∂Èò≤Ê≠¢ÈîÅÁ´û‰∫âÊó∂ÁöÑÊ≠ªÈîÅÔºåÈáçËØïÁ≠ñÁï•Â¢ûÂº∫‰∫ÜËøûÊé• ZooKeeper ÁöÑÈ≤ÅÊ£íÊÄßÔºåÊèêÂçá‰∫ÜÁ≥ªÁªüÁ®≥ÂÆöÊÄß„ÄÇ</li>
</ol>
<h2 id="13-3-goodskill-web"><a href="#13-3-goodskill-web" class="headerlink" title="13.3 goodskill-web"></a>13.3 goodskill-web</h2><h3 id="A-GlobalExceptionHandler"><a href="#A-GlobalExceptionHandler" class="headerlink" title="A. GlobalExceptionHandler"></a>A. GlobalExceptionHandler</h3><p><code>package com.goodskill.web.config</code></p>
<p>Âü∫‰∫é Spring Boot ÁöÑÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜÁ±ªÔºåÂà©Áî® @RestControllerAdvice Âíå @ExceptionHandler Ê≥®Ëß£ÈõÜ‰∏≠Â§ÑÁêÜÂ∫îÁî®‰∏≠ÁöÑÂºÇÂ∏∏ÔºåÂπ∂ËøîÂõûÁªü‰∏ÄÁöÑÂìçÂ∫îÊ†ºÂºè„ÄÇ</p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>ÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜ: ‰ΩøÁî® @RestControllerAdvice ÂÆûÁé∞ÂÖ®Â±ÄÂºÇÂ∏∏ÊçïËé∑ÔºåÈõÜ‰∏≠ÁÆ°ÁêÜÂ∫îÁî®‰∏≠ÁöÑÈîôËØØÂ§ÑÁêÜÈÄªËæë„ÄÇÈÅøÂÖç‰∫ÜÂú®ÊØè‰∏™ÊéßÂà∂Âô®‰∏≠ÈáçÂ§çÁºñÂÜôÂºÇÂ∏∏Â§ÑÁêÜ‰ª£Á†ÅÔºåÈôç‰Ωé‰∫Ü‰ª£Á†ÅÂÜó‰ΩôÔºåÊèêÈ´ò‰∫ÜÂèØÁª¥Êä§ÊÄß„ÄÇ</li>
<li>Áªü‰∏ÄÁöÑÂìçÂ∫îÊ†ºÂºè: ËøîÂõûÊ†áÂáÜÂåñÁöÑ ApiResult ÂØπË±°ÔºåÁ°Æ‰øùÈîôËØØÂìçÂ∫îÁöÑÊ†ºÂºè‰∏ÄËá¥„ÄÇ</li>
<li>ÁªÜÁ≤íÂ∫¶ÁöÑÂºÇÂ∏∏ÂàÜÁ±ª: ÈíàÂØπ‰∏çÂêåÁ±ªÂûãÁöÑÂºÇÂ∏∏ÔºàÈÄöÁî®ÂºÇÂ∏∏„ÄÅÂèÇÊï∞ÁªëÂÆöÂºÇÂ∏∏„ÄÅÊ†°È™åÂºÇÂ∏∏ÔºâÊèê‰æõÁâπÂÆöÂ§ÑÁêÜÈÄªËæë„ÄÇÊ†πÊçÆÂºÇÂ∏∏Á±ªÂûãËøîÂõûÊõ¥ÂÖ∑‰ΩìÁöÑÈîôËØØ‰ø°ÊÅØÔºàÂ¶ÇÂ≠óÊÆµÁ∫ßÂà´ÁöÑÊ†°È™åÂ§±Ë¥•ÂéüÂõ†ÔºâÔºåÊèêÈ´ò‰∫ÜÈîôËØØÂ§ÑÁêÜÁöÑÁ≤æÂáÜÊÄßÂíåÂÆûÁî®ÊÄß„ÄÇ</li>
</ol>
<h3 id="B-SeckillMockController"><a href="#B-SeckillMockController" class="headerlink" title="B. SeckillMockController"></a>B. SeckillMockController</h3><p><code>package com.goodskill.web.controller</code></p>
<p>Áî®‰∫éÊ®°ÊãüÁßíÊùÄÂú∫ÊôØÁöÑÊéßÂà∂Âô®Á±ªÔºåÈÄöËøá RESTful Êé•Âè£Êèê‰æõÂ§öÁßçÁßíÊùÄÁ≠ñÁï•ÁöÑÊµãËØïÂÖ•Âè£„ÄÇÂÆÉÈõÜÊàê‰∫ÜÂ§öÁßçÊäÄÊúØÔºàÂ¶Ç Dubbo„ÄÅÊ∂àÊÅØÈòüÂàó„ÄÅÁ∫øÁ®ãÊ±†„ÄÅRedis Á≠âÔºâ</p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>Â§öÁßçÁßíÊùÄÁ≠ñÁï•ÊîØÊåÅ: ÈÄöËøáÂçï‰∏ÄÊéßÂà∂Âô®ÊîØÊåÅÂ§öÁßçÁßíÊùÄÁ≠ñÁï•ÔºàÂ¶ÇÂêåÊ≠•ÈîÅ„ÄÅRedisson„ÄÅKafka„ÄÅRabbitMQ„ÄÅSentinel Á≠âÔºâÔºå‰ΩìÁé∞‰∫ÜÁÅµÊ¥ªÊÄßÂíåÂèØÊâ©Â±ïÊÄß„ÄÇ</li>
<li>Á∫øÁ®ãÊ±†Âπ∂ÂèëÊ®°Êãü: ‰ΩøÁî® ThreadPoolTaskExecutor Ê®°ÊãüÈ´òÂπ∂ÂèëËØ∑Ê±ÇÔºåÊîØÊåÅÂä®ÊÄÅË∞ÉÊï¥Á∫øÁ®ãÊ±†ÂèÇÊï∞„ÄÇ</li>
<li>Ê∂àÊÅØÈòüÂàóÈõÜÊàê: ÈõÜÊàê Kafka Âíå RabbitMQÔºàÈÄöËøá StreamBridgeÔºâÂÆûÁé∞ÂºÇÊ≠•ÁßíÊùÄËØ∑Ê±ÇÔºåÊèêÂçáÂìçÂ∫îÈÄüÂ∫¶„ÄÇÂºÇÊ≠•Â§ÑÁêÜËß£ËÄ¶‰∫ÜËØ∑Ê±ÇÂèëÈÄÅÂíåÂÆûÈôÖÊâßË°åÔºåÊèêÈ´ò‰∫ÜÁ≥ªÁªüÁöÑÂêûÂêêÈáèÂíåÂèØÊâ©Â±ïÊÄßÔºåÈÄÇÂêàÈ´òÂπ∂ÂèëÂú∫ÊôØ„ÄÇ</li>
</ol>
<h2 id="13-4-goodskill-job"><a href="#13-4-goodskill-job" class="headerlink" title="13.4 goodskill-job"></a>13.4 goodskill-job</h2><h3 id="ElasticJob-ÁöÑÂàÜÁâáÊú∫Âà∂"><a href="#ElasticJob-ÁöÑÂàÜÁâáÊú∫Âà∂" class="headerlink" title="ElasticJob ÁöÑÂàÜÁâáÊú∫Âà∂"></a>ElasticJob ÁöÑÂàÜÁâáÊú∫Âà∂</h3><p><code>package com.goodskill.job.simple</code></p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>ElasticJob ÂàÜÁâáÊú∫Âà∂ÁöÑÂàÜÂ∏ÉÂºè‰ªªÂä°ÊãÜÂàÜ<ul>
<li>ElasticJob ÈÄöËøáÂàÜÁâáÊú∫Âà∂Â∞Ü‰ªªÂä°ÂàÜÂ∏ÉÂºèÊãÜÂàÜÂà∞Â§ö‰∏™ËäÇÁÇπÊâßË°åÔºåMyJob Á±ª‰∏≠ÁöÑ ShardingContext ÂèÇÊï∞ÂÖÅËÆ∏‰ªªÂä°Ê†πÊçÆ shardingItemÔºàÂàÜÁâáÈ°πÔºâÂä®ÊÄÅÂàÜÈÖç‰∏çÂêåÁöÑÊâßË°åÈÄªËæë„ÄÇËøôÁßçËÆæËÆ°ÁâπÂà´ÈÄÇÂêàÂ§ÑÁêÜÂ§ßËßÑÊ®°Êï∞ÊçÆÂêåÊ≠•‰ªªÂä°Ôºå‰æãÂ¶ÇÂ∞ÜÂïÜÂìÅÊï∞ÊçÆÂêåÊ≠•Âà∞ Elasticsearch„ÄÇ<ul>
<li>Ë¥üËΩΩÂùáË°°: ÂàÜÁâáÊú∫Âà∂ÁªìÂêà Zookeeper Ê≥®ÂÜå‰∏≠ÂøÉÔºåÂèØ‰ª•Â∞Ü‰ªªÂä°ÂùáÂåÄÂàÜÈÖçÂà∞ÈõÜÁæ§‰∏≠ÁöÑÂ§ö‰∏™ËäÇÁÇπÔºåÈÅøÂÖçÂçïÁÇπÂéãÂäõ„ÄÇ</li>
<li>ÂèØÊâ©Â±ïÊÄß: ÂΩìÊï∞ÊçÆÈáèÊàñËäÇÁÇπÊï∞Â¢ûÂä†Êó∂ÔºåÂè™ÈúÄË∞ÉÊï¥ÂàÜÁâáÊï∞ÈáèÔºàshardingTotalCountÔºâÂíåÈÄªËæëÔºåÊó†ÈúÄÂ§ßÂπÖÊîπÂä®‰ª£Á†Å„ÄÇ</li>
<li>ÂÆπÈîôÊÄß: ElasticJob Ëá™Â∏¶‰ªªÂä°Â§±Ë¥•ÈáçËØïÂíåËäÇÁÇπÊïÖÈöúËΩ¨ÁßªÂäüËÉΩÔºåÁ°Æ‰øù‰ªªÂä°ÊâßË°åÁöÑÂèØÈù†ÊÄß„ÄÇ</li>
</ul>
</li>
</ul>
</li>
<li>ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ãÈ´òÊïàÂêåÊ≠•ÂïÜÂìÅÊï∞ÊçÆÂà∞ Elasticsearch<ul>
<li>MyJob ÈÄöËøá Dubbo ËøúÁ®ãË∞ÉÁî® GoodsService Ëé∑ÂèñÂïÜÂìÅÊï∞ÊçÆÔºåÂπ∂Âà©Áî® parallelStream() Âπ∂Ë°åÂ§ÑÁêÜÊï∞ÊçÆËΩ¨Êç¢ÔºåÊúÄÂêéÈÄöËøá goodsEsService.saveBatch() ÊâπÈáèÊõ¥Êñ∞ Elasticsearch Á¥¢Âºï„ÄÇËøôÁßçËÆæËÆ°ÂÖºÈ°æ‰∫ÜÂàÜÂ∏ÉÂºèË∞ÉÁî®ÂíåÊâπÈáèÊìç‰ΩúÁöÑÊïàÁéá„ÄÇ<ul>
<li>È´òÊÄßËÉΩ: Âπ∂Ë°åÊµÅÂíåÊâπÈáèÊìç‰ΩúÊòæËëóÊèêÂçá‰∫ÜÊï∞ÊçÆÂ§ÑÁêÜÁöÑÂêûÂêêÈáè„ÄÇ</li>
<li>Ëß£ËÄ¶ÊÄß: ÈÄöËøá Dubbo Ë∞ÉÁî®ÂïÜÂìÅÊúçÂä°Ôºå‰ªªÂä°Ê®°Âùó‰∏é‰∏öÂä°ÈÄªËæëÂàÜÁ¶ªÔºå‰æø‰∫éÁª¥Êä§ÂíåÊâ©Â±ï„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="13-5-goodskill-gateway"><a href="#13-5-goodskill-gateway" class="headerlink" title="13.5 goodskill-gateway"></a>13.5 goodskill-gateway</h2><h3 id="A-gateway-config-ÁΩëÂÖ≥ÈÖçÁΩÆ"><a href="#A-gateway-config-ÁΩëÂÖ≥ÈÖçÁΩÆ" class="headerlink" title="A. gateway.config ÁΩëÂÖ≥ÈÖçÁΩÆ"></a>A. gateway.config ÁΩëÂÖ≥ÈÖçÁΩÆ</h3><p><code>com.goodskill.gateway.config</code></p>
<p>Êú¨È°πÁõÆÂü∫‰∫é Spring Cloud Gateway Âíå Sa-Token ÂÆûÁé∞‰∫ÜÁªü‰∏ÄËÆ§ËØÅÁΩëÂÖ≥ÔºåÂ∞ÅË£Ö‰∫ÜÁôªÂΩïÈâ¥ÊùÉ„ÄÅË∑ØÁî±ËΩ¨Âèë„ÄÅÊùÉÈôêÊéßÂà∂„ÄÅÁôΩÂêçÂçïÊú∫Âà∂Á≠âÊ†∏ÂøÉÂäüËÉΩÔºåÊèêÂçá‰∫ÜÁ≥ªÁªüÁöÑÂÆâÂÖ®ÊÄßÂíåÂèØÁª¥Êä§ÊÄß„ÄÇÈÄöËøáÊ≥®ÂÖ•Ëá™ÂÆö‰πâÊùÉÈôêÊé•Âè£Âπ∂ÁªìÂêàËøúÁ®ãË∞ÉÁî®ÔºåÂÆåÊàê‰∫ÜÂæÆÊúçÂä°Èó¥ËÆ§ËØÅÊéàÊùÉ‰ΩìÁ≥ªÁöÑÁªü‰∏ÄËÆæËÆ°„ÄÇ</p>
<table>
<thead>
<tr>
<th>ÂäüËÉΩÊ®°Âùó</th>
<th>Á±ªÂêç</th>
<th>‰ºòÂäø</th>
</tr>
</thead>
<tbody><tr>
<td>Ë∑ØÁî±ËΩ¨Âèë</td>
<td>GatewayConfiguration</td>
<td>ÂÆûÁé∞ÈõÜ‰∏≠ÂºèÁΩëÂÖ≥Ë∑ØÁî±„ÄÅË¥üËΩΩÂùáË°°„ÄÅÊúçÂä°ÂèëÁé∞„ÄÅÂâçÁºÄÂâ•Á¶ªÁ≠âÔºåÊèêÈ´òÊé•Âè£Áªü‰∏ÄÊÄß‰∏éÂèØÁª¥Êä§ÊÄß</td>
</tr>
<tr>
<td>ÂÆâÂÖ®ËÆ§ËØÅ</td>
<td>SaTokenConfiguration</td>
<td>Êèê‰æõÂÖ®Â±ÄÁªü‰∏ÄËÆ§ËØÅÂÖ•Âè£ÔºåÊîØÊåÅË∑ØÂæÑÂåπÈÖç„ÄÅÁôΩÂêçÂçïÊéßÂà∂„ÄÅÁî®Êà∑‰ø°ÊÅØ‰º†ÈÄíÁ≠âÔºå‰øùÈöúÂÆâÂÖ®„ÄÅËß£ËÄ¶‰∏öÂä°</td>
</tr>
<tr>
<td>ÊùÉÈôêÊéßÂà∂</td>
<td>StpInterfaceImpl</td>
<td>ÊîØÊåÅËøúÁ®ãÊùÉÈôêÊü•ËØ¢„ÄÅÂä®ÊÄÅËßíËâ≤ÁÆ°ÁêÜÔºåÂÆûÁé∞ÁªÜÁ≤íÂ∫¶ÊùÉÈôêÊéßÂà∂ÔºåÊîØÊåÅÊú™Êù•ÊùÉÈôêÁÆ°ÁêÜÂçáÁ∫ß</td>
</tr>
</tbody></table>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li><code>GatewayConfiguration</code> ‚Äî‚Äî ÁΩëÂÖ≥Ë∑ØÁî±ÈÖçÁΩÆÁ±ª<ul>
<li>ÈõÜ‰∏≠ÂºèË∑ØÁî±ÁÆ°ÁêÜÔºö ÈÄöËøá RouteLocatorBuilder ÊòéÁ°ÆÈÖçÁΩÆ‰∫ÜÂ§ö‰∏™ÂæÆÊúçÂä°ÔºàÂ¶Ç goodskill-order„ÄÅgoodskill-auth Á≠âÔºâÁöÑË∑ØÁî±Ë∑ØÂæÑ„ÄÇ</li>
<li>ÊúçÂä°Ê≥®ÂÜåÂèëÁé∞ÈõÜÊàêÔºö‰ΩøÁî®‰∫Ü ÊúçÂä°Ê≥®ÂÜå‰∏≠ÂøÉÔºàÂ¶Ç Nacos„ÄÅEurekaÔºâÔºåÈÄöËøá<strong>Ë¥üËΩΩÂùáË°°</strong>Ë∞ÉÁî®ÂêéÁ´ØÊúçÂä°Ôºå‰æø‰∫éÊúçÂä°Ê≤ªÁêÜ„ÄÇ</li>
</ul>
</li>
<li><code>SaTokenConfiguration</code> ‚Äî‚Äî Sa-Token ÂÖ®Â±ÄËøáÊª§Âô®ÈÖçÁΩÆÁ±ª<ul>
<li>ÂÖ®Â±ÄËÆ§ËØÅÁªü‰∏ÄÂÖ•Âè£ÔºöÈÄöËøá SaReactorFilter ÂÆûÁé∞ÂÖ®Â±ÄËØ∑Ê±ÇÊã¶Êà™ÔºåÂú®‰∏öÂä°Â§ÑÁêÜÂâçËøõË°åÁªü‰∏ÄËÆ§ËØÅ„ÄÇ</li>
<li>ËÆ§ËØÅÂ¢ûÂº∫ÔºöÁôªÂΩïÊ†°È™åÔºöStpUtil.checkLogin() Âº∫Âà∂Ë¶ÅÊ±ÇÁôªÂΩïÁä∂ÊÄÅ„ÄÇ</li>
<li>ÂºÇÂ∏∏Áªü‰∏ÄÂ§ÑÁêÜÔºöÊâÄÊúâËÆ§ËØÅÂºÇÂ∏∏ÈÉΩÁî± .setError(‚Ä¶) ÊçïÊçâÂπ∂ËøîÂõûÁªü‰∏ÄÊ†ºÂºèÂìçÂ∫îÔºåÊèêÂçáÊé•Âè£‰∏ÄËá¥ÊÄß„ÄÇ</li>
</ul>
</li>
<li><code>StpInterfaceImpl</code> ‚Äî‚Äî Sa-Token ÊùÉÈôê‰∏éËßíËâ≤Êèê‰æõÂô®<ul>
<li>Âä®ÊÄÅÊùÉÈôêÂä†ËΩΩÔºöÂÆûÁé∞ StpInterface Êé•Âè£ÔºåÁªìÂêàËøúÁ®ã AuthFeignClientÔºåÂÆûÁé∞ÊùÉÈôêÂíåËßíËâ≤ÁöÑÂä®ÊÄÅÊü•ËØ¢„ÄÇ</li>
</ul>
</li>
</ol>
<h3 id="B-gateway-service"><a href="#B-gateway-service" class="headerlink" title="B. gateway.service"></a>B. gateway.service</h3><p><code>package com.goodskill.gateway.service</code></p>
<p>ÂæÆÊúçÂä°ÁΩëÂÖ≥Âä®ÊÄÅË∑ØÁî±ÁöÑÊ†∏ÂøÉÔºåÈÖçÂêà Spring Cloud Gateway Âíå NacosÔºåÂÆûÁé∞‰∫Ü<strong>Ë∑ØÁî±ÈÖçÁΩÆÁöÑÂä®ÊÄÅÁÆ°ÁêÜ‰∏éÁÉ≠Êõ¥Êñ∞</strong></p>
<p>Âú®ÁΩëÂÖ≥Ê®°Âùó‰∏≠ËÆæËÆ°Âπ∂ÂÆûÁé∞‰∫ÜÂü∫‰∫é Nacos ÈÖçÁΩÆ‰∏≠ÂøÉÁöÑÂä®ÊÄÅË∑ØÁî±ÁÆ°ÁêÜÊú∫Âà∂ÔºåÊîØÊåÅË∑ØÁî±ÈÖçÁΩÆÁöÑÁÉ≠Êõ¥Êñ∞‰∏éËá™Âä®ÂêåÊ≠•„ÄÇÈÄöËøáÁõëÂê¨ÈÖçÁΩÆ‰∏≠ÂøÉÂèòÊõ¥‰∫ã‰ª∂ÔºåÁªìÂêà Spring Cloud Gateway ÁöÑ‰∫ã‰ª∂Êú∫Âà∂ÔºåÂÆåÊàêÁΩëÂÖ≥Ë∑ØÁî±ÁöÑÂÆûÊó∂Âà∑Êñ∞ÔºåÂ§ßÂπÖÊèêÂçáÁ≥ªÁªüÁöÑÂèØÁª¥Êä§ÊÄßÂíåÊâ©Â±ïÊÄßÔºåÁ°Æ‰øùÁΩëÂÖ≥Âú®È´òÂèØÁî®ÂíåÊúçÂä°È¢ëÁπÅÂèòÊõ¥Âú∫ÊôØ‰∏ã‰æùÁÑ∂‰øùÊåÅË∑ØÁî±‰∏ÄËá¥ÊÄß‰∏éÁ®≥ÂÆöÊÄß„ÄÇ</p>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li><code>DynamicRouteConfigWatcher</code> ‚Äî‚Äî Âä®ÊÄÅË∑ØÁî±ÁõëÂê¨Âô®<ul>
<li>Ëá™Âä®ÁõëÂê¨ Nacos Ë∑ØÁî±ÈÖçÁΩÆÂèòÊõ¥: ÂÆûÁé∞‰∫ÜÁΩëÂÖ≥Êó†ÊÑüÁü•Ëá™Âä®Âà∑Êñ∞Ôºå‰∏çÈúÄË¶ÅÈáçÂêØÊúçÂä°ÔºåÁúüÊ≠£ÂÆûÁé∞ÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞„ÄÇ</li>
<li>‰∏é DynamicRouteRefresh ËÅîÂä®ÔºåÂÆûÊó∂Êõ¥Êñ∞Ë∑ØÁî±</li>
<li>ÂêØÂä®Êó∂Ëá™Âä®ÊãâÂèñÂ∑≤ÊúâË∑ØÁî±ÈÖçÁΩÆ</li>
</ul>
</li>
<li><code>DynamicRouteRefresh</code> ‚Äî‚Äî Âä®ÊÄÅË∑ØÁî±Âà∑Êñ∞ÊúçÂä°Á±ª<ul>
<li>Âà©Áî® Spring Êèê‰æõÁöÑ‰∫ã‰ª∂Êú∫Âà∂ RefreshRoutesEvent ÈÄöÁü• Spring Cloud Gateway Âà∑Êñ∞Ë∑ØÁî±</li>
<li>Ë∑ØÁî±Âà†Èô§‰∏éÊõ¥Êñ∞ÈÄªËæëÂàÜÁ¶ª: updateList() ÂÆûÁé∞ÂÖ®ÈáèÂà∑Êñ∞ÈÄªËæëÔºåÂÖàÂà†Èô§Â∑≤ÊúâË∑ØÁî±ÔºåÂÜçÈáçÊñ∞Ê∑ªÂä†ÔºåÂÆûÁé∞ÂπÇÁ≠âÂåñË∑ØÁî±Êõ¥Êñ∞„ÄÇ</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Ê®°Âùó</th>
<th>Á±ªÂêç</th>
<th>ÂäüËÉΩ‰∫ÆÁÇπ</th>
<th>ÂæÆÊúçÂä°‰ºòÂäø</th>
</tr>
</thead>
<tbody><tr>
<td>Âä®ÊÄÅË∑ØÁî±ÁõëÂê¨Âô®</td>
<td>DynamicRouteConfigWatcher</td>
<td>ÁõëÂê¨ Nacos ÂèòÊõ¥„ÄÅÂêØÂä®Êó∂ÂàùÂßãÂåñË∑ØÁî±</td>
<td>ÂÆûÁé∞Âä®ÊÄÅÊÑüÁü•Ë∑ØÁî±ÈÖçÁΩÆÂèòÊõ¥ÔºåÊó†ÈúÄÈáçÂêØÁΩëÂÖ≥</td>
</tr>
<tr>
<td>Ë∑ØÁî±Âà∑Êñ∞ÊúçÂä°</td>
<td>DynamicRouteRefresh</td>
<td>ÂÜÖÂ≠òË∑ØÁî±Áª¥Êä§„ÄÅ‰∫ã‰ª∂È©±Âä®Âà∑Êñ∞</td>
<td>È´òÊÄßËÉΩË∑ØÁî±Êõ¥Êñ∞Êú∫Âà∂ÔºåÊîØÊåÅÂ§ßËßÑÊ®°ÊúçÂä°Ë∑ØÁî±Âä®ÊÄÅÁÆ°ÁêÜ</td>
</tr>
</tbody></table>
<h2 id="13-6-goodskill-ai"><a href="#13-6-goodskill-ai" class="headerlink" title="13.6 goodskill-ai"></a>13.6 goodskill-ai</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss">Áî®Êà∑ËØ∑Ê±Ç ‚Üí AssistantController<span class="hljs-selector-class">.chat</span>(chatId, userMessage)<br>           ‚Üì<br>      UserSupportAssistant<span class="hljs-selector-class">.chat</span>(...)<br>           ‚Üì<br>      ChatClientÔºöÁîüÊàêÂõûÂ§ç + Ë∞ÉÁî®ÂáΩÊï∞ + ÁÆ°ÁêÜ‰∏ä‰∏ãÊñá<br>           ‚Üì<br>      ËøîÂõû Flux&lt;String&gt; ÊµÅÂºèÊ∂àÊÅØ<br></code></pre></td></tr></table></figure>


<h3 id="A-AssistantController"><a href="#A-AssistantController" class="headerlink" title="A. AssistantController"></a>A. AssistantController</h3><p><code>package com.goodskill.ai.controller</code></p>
<table>
<thead>
<tr>
<th>ÂäüËÉΩÁÇπ</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td>ËÅäÂ§©ÂÖ•Âè£</td>
<td>Êèê‰æõ &#x2F;api&#x2F;assistant&#x2F;chat Êé•Âè£‰Ωú‰∏∫Áî®Êà∑‰∏é AI Âä©ÊâãÁöÑÂØπËØùÂÖ•Âè£</td>
</tr>
<tr>
<td>Ë∞ÉÁî® AI ÊúçÂä°</td>
<td>Â∞ÜÁî®Êà∑ËæìÂÖ•‰∫§Áî± UserSupportAssistantÔºàÊ†∏ÂøÉ AI ÊúçÂä°Á±ªÔºâÂ§ÑÁêÜ</td>
</tr>
<tr>
<td>ÊµÅÂºèÂìçÂ∫î</td>
<td>‰ΩøÁî® <code>Flux&lt;String&gt;</code> ÁªìÂêà TEXT_EVENT_STREAM_VALUE ËøîÂõûÊµÅÂºèÊ∂àÊÅØÔºåÂÆûÁé∞Á±ª‰ºº ChatGPT ÁöÑ‚ÄúÂÆûÊó∂ÂõûÂ§ç‚Äù‰ΩìÈ™å</td>
</tr>
</tbody></table>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>‰ΩøÁî® Spring WebFlux ÂÆûÁé∞ ÊµÅÂºèÂìçÂ∫îÔºàServer-Sent Events, SSEÔºâ<ul>
<li>ËøîÂõû <code>Flux&lt;String&gt;</code> ÂÆûÁé∞‚ÄúÈÄêÊù°Ê∂àÊÅØÂÆûÊó∂Êé®ÈÄÅ‚ÄùÔºåÊèêÂçáÂâçÁ´Ø‰∫§‰∫í‰ΩìÈ™å„ÄÇ</li>
<li>ÂáèÂ∞ëÁî®Êà∑Á≠âÂæÖÊó∂Èó¥ÔºåÊ®°Êãü‚ÄúÊâìÂ≠óÂºè‚ÄùAIÂõûÂ§çÊïàÊûúÔºå‰∫§‰∫íÊõ¥Ëá™ÁÑ∂„ÄÇ</li>
</ul>
</li>
</ol>
<h3 id="B-UserSupportAssistant"><a href="#B-UserSupportAssistant" class="headerlink" title="B. UserSupportAssistant"></a>B. UserSupportAssistant</h3><p><code>package com.goodskill.ai.service</code></p>
<table>
<thead>
<tr>
<th>ÂäüËÉΩ</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody><tr>
<td>AI Âä©ÊâãÊúçÂä°Á±ª</td>
<td>ËøôÊòØ AI ÂæÆÊúçÂä°‰∏≠ÁúüÊ≠£Â§ÑÁêÜÁî®Êà∑ËÅäÂ§©ËØ∑Ê±ÇÁöÑÊ†∏ÂøÉÈÄªËæëÁ±ªÔºåÊéßÂà∂‰∫ÜËÅäÂ§©ÊµÅÁ®ã</td>
</tr>
<tr>
<td>AI Ê®°ÂûãÈ©±Âä®</td>
<td>‰ΩøÁî® ChatClient Â∞ÅË£ÖÂ§ßËØ≠Ë®ÄÊ®°ÂûãÔºàÂ¶Ç ChatGPTÔºâÔºåÂÆûÁé∞Ëá™ÁÑ∂ËØ≠Ë®ÄÂØπËØù</td>
</tr>
<tr>
<td>ÊîØÊåÅ RAG Ê£ÄÁ¥¢ÂºèÈóÆÁ≠î</td>
<td>ÈõÜÊàêÂêëÈáèÊï∞ÊçÆÂ∫ìÔºàVectorStoreÔºâÊù•ÊîØÊåÅ‰∏ä‰∏ãÊñáÈóÆÁ≠îÔºåÂ¢ûÂº∫ÂØπËØùÊô∫ËÉΩ</td>
</tr>
<tr>
<td>ËÆ∞ÂøÜÁÆ°ÁêÜ</td>
<td>ÈõÜÊàê ChatMemory ÂÆûÁé∞Â§öËΩÆÂØπËØùËÆ∞ÂøÜ</td>
</tr>
<tr>
<td>ÂáΩÊï∞Ë∞ÉÁî®</td>
<td>ÊîØÊåÅÈÄöËøáÂØπËØùËß¶ÂèëÁ≥ªÁªüÂáΩÊï∞ÔºàÂ¶ÇÔºöÂºÄÂêØÁßíÊùÄ„ÄÅËé∑Âèñ‰ªªÂä°ËÄóÊó∂Ôºâ</td>
</tr>
</tbody></table>
<p><strong>‰∫ÆÁÇπÔºö</strong></p>
<ol>
<li>Á≥ªÁªüÊèêÁ§∫ËØç System Prompt ÁÅµÊ¥ªÈÖçÁΩÆ</li>
<li>RAGÔºàRetrieval-Augmented GenerationÔºâÂ¢ûÂº∫ÈóÆÁ≠îËÉΩÂäõ</li>
<li>ÊîØÊåÅÂáΩÊï∞ÂºèË∞ÉÁî®: Ê®°ÂûãÂèØËØÜÂà´Áî®Êà∑ÊÑèÂõæÂπ∂Ëß¶ÂèëÂ¶Ç startSeckill()„ÄÅgetTaskTimeInfo() Á≠âÂêéÁ´ØÂÆûÈôÖÊñπÊ≥ï ‚Üí ÂÆûÁé∞ ÂØπËØùÂç≥Êìç‰Ωú ÁöÑ‰∫§‰∫í‰ΩìÈ™å„ÄÇ</li>
<li>Â§öËΩÆÂØπËØù‰∏ä‰∏ãÊñáÁÆ°ÁêÜ: Âà©Áî® ChatMemory Âíå PromptChatMemoryAdvisor ÂÆûÁé∞ËÆ∞ÂøÜËøΩË∏™ÔºåÊ®°ÂûãÂèØËÆ∞‰ΩèÁî®Êà∑‰∏ä‰∏ãÊñá‰ø°ÊÅØ„ÄÇ</li>
<li>ÂìçÂ∫îÂºèÁºñÁ®ã: ËøîÂõû <code>Flux&lt;String&gt;</code> ÊµÅÂºèÂìçÂ∫îÔºåÊèêÂçáÂØπËØùÂÆûÊó∂ÊÄß‰∏éÁî®Êà∑‰ΩìÈ™å„ÄÇ</li>
</ol>
<h1 id="14-È°πÁõÆ‰∫ÆÁÇπ"><a href="#14-È°πÁõÆ‰∫ÆÁÇπ" class="headerlink" title="14. È°πÁõÆ‰∫ÆÁÇπ"></a>14. È°πÁõÆ‰∫ÆÁÇπ</h1><ol>
<li>ÂÆûÁé∞Â§öÁßçÈ´òÂπ∂ÂèëÁßíÊùÄÁ≠ñÁï•ÔºåÊîØÊåÅÂêåÊ≠•‰∏éÂºÇÊ≠•ÂèåÈÄöÈÅìÔºåÊ∂µÁõñSychronizedÂêåÊ≠•ÈîÅ„ÄÅÊï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ„ÄÅRedissonÂàÜÂ∏ÉÂºèÈîÅ„ÄÅRabbitMQÊ∂àÊÅØÈòüÂàó„ÄÅRedis ËÆ°Êï∞ +  MongoDB ÂºÇÊ≠•ÊåÅ‰πÖÂåñÔºåÂÖ®Èù¢‰øùÈöúÈ´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß</li>
<li>Âü∫‰∫é Nacos ÂÆûÁé∞Áªü‰∏ÄÈÖçÁΩÆ‰∏≠ÂøÉÁÆ°ÁêÜÔºõ‰ΩøÁî® OpenFeign ÂÆûÁé∞ÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®ÂíåÊúçÂä°ÁÜîÊñ≠ÔºåÂπ∂ËÆæËÆ°Áõ∏Â∫îÁöÑÊúçÂä°ÈôçÁ∫ßÈÄªËæëÂ§ÑÁêÜÔºõ‰ΩøÁî® Gateway ÊûÑÂª∫ÂæÆÊúçÂä° API ÁΩëÂÖ≥ÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±„ÄÅÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞‰∏éÁªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ</li>
<li>ÈááÁî®Âü∫‰∫éË¥£‰ªªÈìæÊ®°ÂºèÁöÑÈ¢ÑÂ§ÑÁêÜÂô®Êú∫Âà∂ÔºåÂú®ÁßíÊùÄÂâçÂØπÊï∞ÊçÆÂ∫ì„ÄÅÁºìÂ≠ò„ÄÅÁä∂ÊÄÅÊú∫Á≠âËøõË°åÂàùÂßãÂåñÈ¢ÑÂ§ÑÁêÜ</li>
<li>Âà©Áî® Spring StateMachine Áä∂ÊÄÅÊú∫ÂÆö‰πâÂíåÁÆ°ÁêÜÁßíÊùÄÊ¥ªÂä®ÁîüÂëΩÂë®ÊúüÔºåÁªü‰∏ÄÊéßÂà∂Ê¥ªÂä®Áä∂ÊÄÅÔºå‰æø‰∫éÁä∂ÊÄÅÁöÑÈõÜ‰∏≠Áª¥Êä§</li>
<li>ÈõÜÊàêElasticsearchÂÆûÁé∞È´òÊïàÂïÜÂìÅÊ£ÄÁ¥¢ÔºåÊîØÊåÅÊ®°Á≥äÊêúÁ¥¢‰∏éÂÖ≥ÈîÆËØçÈ´ò‰∫ÆÔºåÊèêÂçáÁî®Êà∑Ê£ÄÁ¥¢‰ΩìÈ™å</li>
<li>Âü∫‰∫éSpring AI AlibabaÊûÑÂª∫ÁßíÊùÄAIÂØπËØùÊúçÂä°ÔºåÈÄöËøáÊµÅÂºèÂìçÂ∫îÂÆûÁé∞ÂÆûÊó∂‰∫§‰∫íÔºåÊîØÊåÅÂ§öËΩÆÂØπËØùÂíåÊô∫ËÉΩÈóÆÁ≠îËß¶ÂèëÁßíÊùÄÊìç‰Ωú</li>
</ol>
<h1 id="15-‰∫ÆÁÇπËØ¶Ëß£"><a href="#15-‰∫ÆÁÇπËØ¶Ëß£" class="headerlink" title="15. ‰∫ÆÁÇπËØ¶Ëß£"></a>15. ‰∫ÆÁÇπËØ¶Ëß£</h1><h2 id="1-ÂÆûÁé∞Â§öÁßçÈ´òÂπ∂ÂèëÁßíÊùÄÁ≠ñÁï•ÔºåÊîØÊåÅÂêåÊ≠•‰∏éÂºÇÊ≠•ÂèåÈÄöÈÅìÔºåÊ∂µÁõñSychronizedÂêåÊ≠•ÈîÅ„ÄÅÊï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ„ÄÅRedissonÂàÜÂ∏ÉÂºèÈîÅ„ÄÅRabbitMQÊ∂àÊÅØÈòüÂàó„ÄÅRedis-ËÆ°Êï∞-MongoDB-ÂºÇÊ≠•ÊåÅ‰πÖÂåñÔºåÂÖ®Èù¢‰øùÈöúÈ´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß"><a href="#1-ÂÆûÁé∞Â§öÁßçÈ´òÂπ∂ÂèëÁßíÊùÄÁ≠ñÁï•ÔºåÊîØÊåÅÂêåÊ≠•‰∏éÂºÇÊ≠•ÂèåÈÄöÈÅìÔºåÊ∂µÁõñSychronizedÂêåÊ≠•ÈîÅ„ÄÅÊï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ„ÄÅRedissonÂàÜÂ∏ÉÂºèÈîÅ„ÄÅRabbitMQÊ∂àÊÅØÈòüÂàó„ÄÅRedis-ËÆ°Êï∞-MongoDB-ÂºÇÊ≠•ÊåÅ‰πÖÂåñÔºåÂÖ®Èù¢‰øùÈöúÈ´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß" class="headerlink" title="1. ÂÆûÁé∞Â§öÁßçÈ´òÂπ∂ÂèëÁßíÊùÄÁ≠ñÁï•ÔºåÊîØÊåÅÂêåÊ≠•‰∏éÂºÇÊ≠•ÂèåÈÄöÈÅìÔºåÊ∂µÁõñSychronizedÂêåÊ≠•ÈîÅ„ÄÅÊï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ„ÄÅRedissonÂàÜÂ∏ÉÂºèÈîÅ„ÄÅRabbitMQÊ∂àÊÅØÈòüÂàó„ÄÅRedis ËÆ°Êï∞ +  MongoDB ÂºÇÊ≠•ÊåÅ‰πÖÂåñÔºåÂÖ®Èù¢‰øùÈöúÈ´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß"></a>1. ÂÆûÁé∞Â§öÁßçÈ´òÂπ∂ÂèëÁßíÊùÄÁ≠ñÁï•ÔºåÊîØÊåÅÂêåÊ≠•‰∏éÂºÇÊ≠•ÂèåÈÄöÈÅìÔºåÊ∂µÁõñSychronizedÂêåÊ≠•ÈîÅ„ÄÅÊï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ„ÄÅRedissonÂàÜÂ∏ÉÂºèÈîÅ„ÄÅRabbitMQÊ∂àÊÅØÈòüÂàó„ÄÅRedis ËÆ°Êï∞ +  MongoDB ÂºÇÊ≠•ÊåÅ‰πÖÂåñÔºåÂÖ®Èù¢‰øùÈöúÈ´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÁöÑÊï∞ÊçÆ‰∏ÄËá¥ÊÄß</h2><h3 id="1-1-ÂàÜÂà´‰ªãÁªç‰Ω†ÁöÑËøô‰∫õÊõ¥Êñ∞Á≠ñÁï•ÊÄé‰πàÂÆûÁé∞ÁöÑÔºü"><a href="#1-1-ÂàÜÂà´‰ªãÁªç‰Ω†ÁöÑËøô‰∫õÊõ¥Êñ∞Á≠ñÁï•ÊÄé‰πàÂÆûÁé∞ÁöÑÔºü" class="headerlink" title="1.1 ÂàÜÂà´‰ªãÁªç‰Ω†ÁöÑËøô‰∫õÊõ¥Êñ∞Á≠ñÁï•ÊÄé‰πàÂÆûÁé∞ÁöÑÔºü"></a>1.1 ÂàÜÂà´‰ªãÁªç‰Ω†ÁöÑËøô‰∫õÊõ¥Êñ∞Á≠ñÁï•ÊÄé‰πàÂÆûÁé∞ÁöÑÔºü</h3><h4 id="1-1-1-SychronizedÂêåÊ≠•ÈîÅ"><a href="#1-1-1-SychronizedÂêåÊ≠•ÈîÅ" class="headerlink" title="1.1.1 SychronizedÂêåÊ≠•ÈîÅ"></a>1.1.1 SychronizedÂêåÊ≠•ÈîÅ</h4><p><strong>‰∏Ä„ÄÅsynchronized ÊòØÊÄé‰πàÁî®ÁöÑÔºü</strong><br>Âú® <code>SynchronizedLockStrategy</code> Á≠ñÁï•Á±ª‰∏≠Ôºåsynchronized Ë¢´Áî®‰∫é ÊåâÂïÜÂìÅÁ≤íÂ∫¶Âä†ÈîÅÔºå<strong>ÊéßÂà∂ÂØπÂêå‰∏Ä‰∏™ÂïÜÂìÅÁöÑÂπ∂ÂèëËØ∑Ê±Ç</strong>„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span> (seckillIdList.get(seckillId)) &#123;<br>    <span class="hljs-comment">// Ê†∏ÂøÉÁßíÊùÄÈÄªËæëÔºàÊâ£Â∫ìÂ≠ò + ËÆ∞ÂΩïÁßíÊùÄÊàêÂäü‰ø°ÊÅØÔºâ</span><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ÂàùÂßãÂåñÈîÅÂØπË±°ÔºàÊåâÂïÜÂìÅ ID ÂàÜÈÖç‰∏ÄÊääÈîÅÔºâ</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">seckillMonitor</span> <span class="hljs-operator">=</span> seckillIdList.get(seckillId);<br><span class="hljs-keyword">if</span> (seckillMonitor == <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    seckillIdList.put(seckillId, value);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>‰∫å„ÄÅÈîÅÂä†Âú®‰∫ÜÂì™ÈáåÔºü</strong><br>ÈîÅÂä†Âú®‰∫Ü <code>ConcurrentHashMap&lt;Long, Object&gt; seckillIdList</code> ‰∏≠ÁöÑ <strong>ÂïÜÂìÅ ID ÂØπÂ∫îÁöÑÈîÅÂØπË±°</strong> ‰∏äÔºö</p>
<ul>
<li>ÊØè‰∏™ÂïÜÂìÅ ID Êúâ‰∏ÄÊääÁã¨Á´ãÁöÑÈîÅ„ÄÇ</li>
<li>Âêå‰∏ÄÊó∂Èó¥ÂÜÖÔºå<strong>Âè™ËÉΩÊúâ‰∏Ä‰∏™Á∫øÁ®ãÊâßË°åÂêå‰∏Ä‰∏™ÂïÜÂìÅÁöÑÁßíÊùÄÈÄªËæë</strong>„ÄÇ<br><strong>ÊÄªÁªìÔºöÂØπÊØè‰∏™ÂïÜÂìÅËøõË°åÂçïÁã¨ÁöÑÂä†ÈîÅ</strong></li>
</ul>
<p><strong>‰∏â„ÄÅÂÆÉËß£ÂÜ≥‰∫ÜÁßíÊùÄ‰∏≠ÁöÑÂì™‰∫õÈóÆÈ¢òÔºü</strong></p>
<ul>
<li>È´òÂπ∂Âèë‰∏ã<strong>Â∫ìÂ≠òË∂ÖÂçñ</strong>Ôºö	ÂêåÊó∂Âè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËÉΩÊâ£Â∫ìÂ≠ò</li>
<li>Â§öÁ∫øÁ®ã<strong>ÈáçÂ§ç‰∏ãÂçï</strong>Ôºö 	ÂêåÊ≠•ÈîÅ‰øùÈöúÂêå‰∏ÄÂïÜÂìÅÂè™Ë¢´‰∏Ä‰∏™Á∫øÁ®ã‰øÆÊîπ</li>
<li>Êï∞ÊçÆ‰∏ç‰∏ÄËá¥Ôºö	Êâ£Â∫ìÂ≠ò + ËÆ∞ÂΩïÊàêÂäü‰ø°ÊÅØÂú®‰∏Ä‰∏™ÈîÅÂÜÖÔºå‰øùËØÅÂéüÂ≠êÊÄß</li>
</ul>
<p><strong>Âõõ„ÄÅ‰ΩÜÂÆÉÊúâ‰ªÄ‰πàÂ±ÄÈôêÔºü</strong></p>
<ul>
<li>Âè™ÈÄÇÂêàÂçïÊú∫Ôºö	synchronized ÊòØ JVM ÂÜÖÈÉ®ÈîÅÔºå‰∏çÈÄÇÁî®‰∫éÂ§öÂè∞ÊúçÂä°Âô®ÈÉ®ÁΩ≤</li>
<li>ÊÄßËÉΩÂ∑Æ	Âú®È´òÂπ∂Âèë‰∏ã‰ºöÂØºËá¥Á∫øÁ®ãÁ≠âÂæÖÔºåÂêûÂêêÈáè‰Ωé</li>
</ul>
<p><strong>ÊÄªÁªì‰∏ÄÂè•ËØùÔºö</strong><br>synchronized ÂêåÊ≠•ÈîÅÂú® GoodsKill ‰∏≠<strong>Âä†Âú®‰∫Ü ÂïÜÂìÅ ID Êò†Â∞ÑÁöÑÈîÅÂØπË±°‰∏ä</strong>ÔºåÁî®‰∫éÊéßÂà∂ÊØè‰∏™ÂïÜÂìÅÁöÑÂπ∂ÂèëËØ∑Ê±ÇÔºåËß£ÂÜ≥‰∫Ü<strong>Âπ∂Âèë‰∏ãÁöÑÂ∫ìÂ≠òË∂ÖÂçñÂíåÈáçÂ§ç‰∏ãÂçïÈóÆÈ¢ò</strong>Ôºå‰ΩÜ‰ªÖÈÄÇÂêàÂçïÊú∫ÈÉ®ÁΩ≤ÁöÑÁßíÊùÄÁ≥ªÁªü„ÄÇ</p>
<h4 id="1-1-2-Êï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ"><a href="#1-1-2-Êï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ" class="headerlink" title="1.1.2 Êï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ"></a>1.1.2 Êï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ</h4><p><strong>‰∏Ä„ÄÅ‰ªÄ‰πàÊòØ‰πêËßÇÈîÅÔºü</strong><br>‰πêËßÇÈîÅÊòØ‰∏ÄÁßçÂπ∂ÂèëÊéßÂà∂Á≠ñÁï•ÔºåÂÆÉÂÅáËÆæ<strong>Â§ö‰∏™‰∫ãÂä°Âπ∂ÂèëÊìç‰ΩúÊó∂‰∏ç‰ºöÂèëÁîüÂÜ≤Á™Å</strong>ÔºåÂõ†Ê≠§Âú®Êìç‰ΩúÊï∞ÊçÆÊó∂‰∏çÂä†ÈîÅ„ÄÇ<strong>Âè™ÊúâÂú®Êõ¥Êñ∞Êï∞ÊçÆÊó∂ÊâçÊ£ÄÊü•Êï∞ÊçÆÊúâÊ≤°ÊúâË¢´ÂÖ∂‰ªñ‰∫ãÂä°‰øÆÊîπ</strong>„ÄÇ</p>
<p><strong>‰∫å„ÄÅGoodsKill ‰∏≠ÁöÑ‰πêËßÇÈîÅ‰ΩøÁî®Âú∫ÊôØ</strong></p>
<p><strong>Ëß£ÂÜ≥Ë∂ÖÂçñÈóÆÈ¢ò</strong>ÔºöÂú® ÁßíÊùÄÊìç‰Ωú ‚Üí ÂáèÂ∫ìÂ≠ò Ëøô‰∏™ÊµÅÁ®ã‰∏≠ÔºåÂ¶ÇÊûúÂ§ö‰∏™Áî®Êà∑ÂêåÊó∂Êä¢Ë¥≠Âêå‰∏Ä‰∏™ÂïÜÂìÅÔºåËÄåÊ≤°ÊúâÂπ∂ÂèëÊéßÂà∂Ôºå‰ºöÂØºËá¥Â∫ìÂ≠òË¢´ÂáèÊàêË¥üÊï∞ÔºåÂç≥‚Äú<strong>Ë∂ÖÂçñ</strong>‚Äù„ÄÇ</p>
<p>‰πêËßÇÈîÅÁöÑ‰ΩúÁî®Â∞±ÊòØÔºöÂú®Êõ¥Êñ∞Â∫ìÂ≠òÊó∂Ê†°È™åÂ∫ìÂ≠òÊòØÂê¶‰ªçÊòØ‚ÄúÈ¢ÑÊúüÂÄº‚ÄùÔºåÂ¶ÇÊûú‰∏çÊòØÔºåËØ¥ÊòéÂ∫ìÂ≠òÂ∑≤ÁªèË¢´Âà´ÁöÑÁ∫øÁ®ãÊîπËøá‰∫ÜÔºåÂ∞±ÊîæÂºÉÊõ¥Êñ∞ÔºåÈò≤Ê≠¢ÈîôËØØÂáèÂ∫ìÂ≠ò„ÄÇ</p>
<p><strong>‰∏â„ÄÅÂÆûÁé∞ÊñπÂºèÔºàÊ∫êÁ†ÅÂàÜÊûêÔºâ</strong><br>Âú® <code>SeckillServiceImpl</code>ÁöÑ<code>reduceNumberInner</code>ÊñπÊ≥ï‰∏≠:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ÁúüÊ≠£ÂáèÂ∫ìÂ≠òÔºöÊèíÂÖ•ÁßíÊùÄËÆ∞ÂΩïÔºåÁÑ∂ÂêéÊõ¥Êñ∞Â∫ìÂ≠òÔºàÂ∏¶Êù°‰ª∂ÈôêÂà∂Ôºâ„ÄÇÊõ¥Êñ∞Â§±Ë¥•‰ºöÊäõÂá∫‚ÄúÊ¥ªÂä®Â∑≤ÁªìÊùü‚ÄùÂºÇÂ∏∏„ÄÇ</span><br>    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">reduceNumberInner</span><span class="hljs-params">(SuccessKilledDTO successKilled)</span> &#123;<br>        <span class="hljs-type">SuccessKilled</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> BeanUtil.copyProperties(successKilled, SuccessKilled.class);<br>        successKilledMapper.insert(entity);<br>        <span class="hljs-type">Seckill</span> <span class="hljs-variable">wrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Seckill</span>();<br>        wrapper.setSeckillId(entity.getSeckillId());<br>        UpdateWrapper&lt;Seckill&gt; updateWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateWrapper</span>(wrapper);<br>        updateWrapper.gt(<span class="hljs-string">&quot;end_time&quot;</span>, entity.getCreateTime());<br>        updateWrapper.lt(<span class="hljs-string">&quot;start_time&quot;</span>, entity.getCreateTime());<br>        updateWrapper.gt(<span class="hljs-string">&quot;number&quot;</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// ‰πêËßÇÈîÅÊ†°È™åÁÇπÔºöÂ∫ìÂ≠òÂøÖÈ°ªÂ§ß‰∫é 0</span><br>        updateWrapper.setSql(<span class="hljs-string">&quot;number = number - 1&quot;</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">update</span> <span class="hljs-operator">=</span> baseMapper.update(<span class="hljs-literal">null</span>, updateWrapper);<br>        <span class="hljs-keyword">if</span> (update &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillCloseException</span>(<span class="hljs-string">&quot;seckill is closed&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> update;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ÂïÜÂìÅÂ∫ìÂ≠ò number &gt; 0</li>
<li>Â¶ÇÊûúÊª°Ë∂≥Êù°‰ª∂ÔºåÂàôÊâßË°å SQLÔºöUPDATE seckill SET number &#x3D; number - 1</li>
<li>Â¶ÇÊûú update &#x3D;&#x3D; 0ÔºåËØ¥ÊòéÔºöÂ∫ìÂ≠òÂ∑≤ÁªèË¢´Êä¢ÂÆå‰∫ÜÔºåÊàñËÄÖÊï∞ÊçÆË¢´ÂÖ∂‰ªñÁ∫øÁ®ã‰øÆÊîπ‰∫Ü ‚Üí ÂΩìÂâçÁ∫øÁ®ãÊõ¥Êñ∞Â§±Ë¥•ÔºàÁßíÊùÄÂ§±Ë¥•Ôºâ„ÄÇ</li>
</ul>
<p><strong>Âõõ„ÄÅÊÄªÁªì</strong>Ôºö<br>GoodsKill ‰ΩøÁî®‰πêËßÇÈîÅÁ≠ñÁï•ÔºåÁ°Æ‰øùÂú®È´òÂπ∂Âèë‰∏ãÂè™<strong>ÊúâÂú®Â∫ìÂ≠ò‰ªçÁÑ∂Â§ß‰∫é 0 Êó∂ÊâçÂÖÅËÆ∏ÂáèÂ∫ìÂ≠ò</strong>Ôºå‰ªéËÄå<strong>ÊúâÊïàÈò≤Ê≠¢Ë∂ÖÂçñÂíåÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÁöÑÈóÆÈ¢ò</strong>ÔºåÂêåÊó∂‰øùÊåÅÁ≥ªÁªüÈ´òÊÄßËÉΩËøêË°å„ÄÇ</p>
<h4 id="1-1-3-RedissonÂàÜÂ∏ÉÂºèÈîÅ"><a href="#1-1-3-RedissonÂàÜÂ∏ÉÂºèÈîÅ" class="headerlink" title="1.1.3 RedissonÂàÜÂ∏ÉÂºèÈîÅ"></a>1.1.3 RedissonÂàÜÂ∏ÉÂºèÈîÅ</h4><p><strong>‰∏Ä„ÄÅRedisson ÂàÜÂ∏ÉÂºèÈîÅÂä†Âú®‰∫ÜÂì™ÈáåÔºü</strong></p>
<p>Âú®Á≠ñÁï•Á±ª <code>RedissonStrategy</code> ‰∏≠‰ΩøÁî®ÁöÑ:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedissonClient redissonClient;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SeckillExecutor seckillExecutor;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    ‰∏∫ÂΩìÂâçÂïÜÂìÅËé∑Âèñ‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÈîÅÔºàÈîÅÂêç‰∏∫ÂïÜÂìÅ ID ÁöÑÂ≠óÁ¨¶‰∏≤Ôºâ„ÄÇ</span><br><span class="hljs-comment">    ‰ΩøÁî®ÁöÑÊòØ ÂèØÈáçÂÖ•ÈîÅ RLockÔºåÂ§ö‰∏™ËäÇÁÇπ‰∏ãÁöÑÂπ∂ÂèëÁî®Êà∑ÈÉΩ‰ºöÁ´û‰∫âËøô‰∏™ÈîÅÔºåÁ°Æ‰øùÂêå‰∏ÄÊó∂Èó¥Âè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËÉΩÊâßË°å‰∏ãÈù¢ÁöÑÈÄªËæë„ÄÇ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(requestDto.getSeckillId() + <span class="hljs-string">&quot;&quot;</span>);<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            seckillExecutor.dealSeckill(requestDto.getSeckillId(), requestDto.getPhoneNumber(), REDISSION_LOCK.getName(), requestDto.getTaskId());<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>getLock(requestDto.getSeckillId() + ‚Äú‚Äù) ÊòØ‰∏∫ ÊØè‰∏™ÂïÜÂìÅ ID Âä®ÊÄÅÁîüÊàê‰∏ÄÊääÂàÜÂ∏ÉÂºèÈîÅ„ÄÇ</li>
<li><strong>Âä†ÈîÅÁ≤íÂ∫¶ÊòØÔºöÂïÜÂìÅÁ∫ßÂà´</strong>ÔºåÊØè‰∏™ÂïÜÂìÅ ID Êã•ÊúâËá™Â∑±Áã¨Á´ãÁöÑÈîÅ„ÄÇ</li>
<li>‰ΩøÁî®ÁöÑÊòØ Redisson Êèê‰æõÁöÑ <strong>RLock ÂàÜÂ∏ÉÂºèÂèØÈáçÂÖ•ÈîÅ</strong>ÔºàÂü∫‰∫é Redis ÂÆûÁé∞Ôºâ„ÄÇ</li>
</ul>
<p><strong>‰∫å„ÄÅÂÆÉËß£ÂÜ≥‰∫ÜÁßíÊùÄ‰∏≠ÁöÑÂì™‰∫õÊ†∏ÂøÉÈóÆÈ¢òÔºü</strong></p>
<ul>
<li>ÂàÜÂ∏ÉÂºèÁéØÂ¢ÉÂπ∂ÂèëÊéßÂà∂	Â§öÂè∞ÊúçÂä°Âô®ÈÉ®ÁΩ≤Êó∂Ôºå<strong>Á°Æ‰øùÊüê‰∏ÄÊó∂ÂàªÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãÂú®Â§ÑÁêÜÊüê‰∏™ÂïÜÂìÅÁöÑÁßíÊùÄÈÄªËæë</strong></li>
<li>ÈÅøÂÖçË∂ÖÂçñÔºö	ÈÄöËøáÂØπÂ∫ìÂ≠òÊâ£ÂáèÂä†ÈîÅÔºåÈò≤Ê≠¢Â§ö‰∏™Á∫øÁ®ãÂêåÊó∂Êâ£Â∫ìÂ≠òÂØºËá¥Ë∂ÖÂçñ</li>
<li>‰øùËØÅÂ∫ìÂ≠ò‰∏ÄËá¥ÊÄßÔºö	‰øùËØÅÂú®ÊâßË°åÁßíÊùÄÈÄªËæëÔºàÂáèÂ∫ìÂ≠ò„ÄÅÂÜôÊàêÂäüËÆ∞ÂΩïÔºâÊó∂Êï∞ÊçÆ‰∏ÄËá¥ÊÄß</li>
<li>Êõø‰ª£ synchronizedÔºö	synchronized Âè™Âú®ÂçïÊú∫ÊúâÊïàÔºåËÄå Redisson ÈÄÇÁî®‰∫éÈõÜÁæ§ÁéØÂ¢É</li>
</ul>
<p><strong>‰∏â„ÄÅÂ¶Ç‰ΩïÊµãËØïÊØîËæÉSynchronizedLockÂíåRedissonLock</strong><br>‚úÖ ÂçïÊú∫ÊµãËØïÔºà‰ΩøÁî® SynchronizedLockÔºâ</p>
<ol>
<li>‰ΩøÁî®Â§öÁ∫øÁ®ãÂπ∂ÂèëÊ®°Êãü 1000 ‰∏™Á∫øÁ®ãËÆøÈóÆÂêå‰∏ÄËµÑÊ∫ê</li>
<li>Ê£ÄÊü•Âπ∂ÂèëÂÆâÂÖ®ÊÄß„ÄÅËÄóÊó∂</li>
</ol>
<p>‚úÖ ÈõÜÁæ§ÊµãËØïÔºà‰ΩøÁî® RedissonLockÔºâ</p>
<ol>
<li>ÈÉ®ÁΩ≤Âà∞Â§ö‰∏™ Tomcat ËäÇÁÇπÊàñÁî® <strong>Spring Boot Ê®°ÊãüÈõÜÁæ§</strong></li>
<li>‰ΩøÁî® Redis ÈÖçÁΩÆ Redisson ÂàÜÂ∏ÉÂºèÈîÅ</li>
<li><strong>‰ΩøÁî® JMeter</strong> &#x2F; Apache Bench Ê®°ÊãüÂπ∂ÂèëËØ∑Ê±Ç</li>
<li>Ê£ÄÊü•ÈîÅÁ´û‰∫â‰∏ãÁöÑÊ≠£Á°ÆÊÄß„ÄÅÂìçÂ∫îÊó∂Èó¥„ÄÅRedis ÂéãÂäõ</li>
</ol>
<p><strong>ÊÄªÁªì‰∏ÄÂè•ËØùÔºö</strong></p>
<p>Âú® GoodsKill È°πÁõÆ‰∏≠ÔºåRedisson ÂàÜÂ∏ÉÂºèÈîÅË¢´<strong>Âä†Âú®ÊØè‰∏™ÂïÜÂìÅ ID ÁöÑÈîÅÂØπË±°</strong>‰∏äÔºåÁî®‰∫é<strong>ÊéßÂà∂ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏≠Âêå‰∏ÄÂïÜÂìÅÁöÑÂπ∂ÂèëÁßíÊùÄËØ∑Ê±Ç</strong>Ôºå‰ªéËÄåÊúâÊïà<strong>Èò≤Ê≠¢Â∫ìÂ≠òË∂ÖÂçñ„ÄÅÊï∞ÊçÆÈîô‰π±„ÄÅÁßíÊùÄÂºÇÂ∏∏Á≠âÈóÆÈ¢ò</strong>ÔºåÊòØÂ∫îÂØπÈ´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãË∑®ËäÇÁÇπÁßíÊùÄÊìç‰ΩúÁöÑÂÖ≥ÈîÆÊâãÊÆµ‰πã‰∏Ä„ÄÇ</p>
<h4 id="1-1-4-RabbitMQÊ∂àÊÅØÈòüÂàó"><a href="#1-1-4-RabbitMQÊ∂àÊÅØÈòüÂàó" class="headerlink" title="1.1.4 RabbitMQÊ∂àÊÅØÈòüÂàó"></a>1.1.4 RabbitMQÊ∂àÊÅØÈòüÂàó</h4><p><strong>‰∏Ä„ÄÅRabbitMQÂú®ÁßíÊùÄ‰∏≠ÁöÑÂÆûÁé∞ÊñπÂºè</strong></p>
<p>Ê≠•È™§ 1Ô∏è‚É£Ôºö<strong>ÁßíÊùÄËØ∑Ê±ÇÂÖ•Èòü</strong><br>Âú®Áî®Êà∑ÂèëËµ∑ÁßíÊùÄËØ∑Ê±ÇÊó∂ÔºåÁ≥ªÁªü‰ºöÔºö</p>
<ul>
<li>ÁîüÊàê‰∏Ä‰∏™ËØ∑Ê±ÇÂØπË±°ÔºàÂåÖÊã¨Áî®Êà∑ÊâãÊú∫Âè∑„ÄÅÂïÜÂìÅID„ÄÅ‰ªªÂä°IDÁ≠âÔºâÔºõ</li>
<li>Â∞ÜÂÖ∂Â∫èÂàóÂåñÊàê JSONÔºõ</li>
<li>ÂèëÈÄÅÂà∞ RabbitMQ ÊåáÂÆö‰∏ªÈ¢òÔºàÂ¶Ç ‚Äúgoodskill-RabbitMQ‚ÄùÔºâ‰∏≠„ÄÇ</li>
</ul>
<p>Ê≠•È™§ 2Ô∏è‚É£Ôºö<strong>Ê∂àË¥πËÄÖÂºÇÊ≠•Â§ÑÁêÜ</strong><br>Âú®ÂêéÁ´ØÔºåRabbitMQ Ê∂àË¥πËÄÖÔºàÂ¶Ç SeckillRabbitmqConsumer Á±ªÔºâÈÄöËøá @RabbitmqListener ÁõëÂê¨ËØ•‰∏ªÈ¢òÔºö</p>
<ul>
<li>ÊãøÂà∞Ê∂àÊÅØÂêéÂèçÂ∫èÂàóÂåñÔºõ</li>
<li>Ë∞ÉÁî®Ê†∏ÂøÉÁßíÊùÄÈÄªËæëÔºàÂ¶ÇÂà§Êñ≠Â∫ìÂ≠ò„ÄÅÈîÅÂÆö„ÄÅÊâ£Âáè„ÄÅ‰∏ãÂçïÁ≠âÔºâÔºõ</li>
<li>ÂÆåÊàê‰∏öÂä°Â§ÑÁêÜÂπ∂ËÆ∞ÂΩïÊó•ÂøóÊàñÁä∂ÊÄÅ„ÄÇ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillKafkaConsumer</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SeckillExecutor seckillExecutor;<br><br>    <span class="hljs-meta">@KafkaListener(topics = &quot;goodskill-kafka&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(Object data)</span> &#123;<br>       <span class="hljs-comment">// Ëß£ÊûêÂπ∂Â§ÑÁêÜÁßíÊùÄËØ∑Ê±Ç</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Ê≠•È™§ 3Ô∏è‚É£ÔºöÁ∫øÁ®ãÊ±†Âπ∂ÂèëÊ®°ÊãüÔºàÂéãÊµãÔºâ<br>Âú®Ê®°ÊãüÂú∫ÊôØ‰∏≠ÔºåÁ≥ªÁªü‰ΩøÁî®Á∫øÁ®ãÊ±†ÂêåÊó∂Âπ∂ÂèëËß¶Âèë RabbitMQ Ê∂àÊÅØÂèëÈÄÅÔºåÊ®°ÊãüÂ§ßËßÑÊ®°Áî®Êà∑Êä¢Ë¥≠ÔºåËææÂà∞ÂéãÊµãÁõÆÁöÑ„ÄÇ</p>
<p><strong>‰∫å„ÄÅËß£ÂÜ≥‰∫ÜÂì™‰∫õÁßíÊùÄ‰∏≠ÁöÑÊ†∏ÂøÉÈóÆÈ¢òÔºü</strong></p>
<ul>
<li>È´òÂπ∂ÂèëÁû¨Êó∂ÊµÅÈáèÔºö	MQ ÂÖÖÂΩìÁºìÂÜ≤Â±ÇÔºåÊ∂àÊÅØÊéíÈòüÂêéÁî±Ê∂àË¥πËÄÖÊúâÂ∫èÂ§ÑÁêÜÔºåÂâäÂ≥∞Â°´Ë∞∑</li>
<li>ËØ∑Ê±ÇÂìçÂ∫îÊÖ¢Ôºö	ÂâçÁ´ØÂø´ÈÄüÂìçÂ∫î‚ÄúËØ∑Ê±ÇÂ∑≤Êé•Êî∂‚ÄùÔºåÂÆûÈôÖÂ§ÑÁêÜÂºÇÊ≠•ËøõË°åÔºåÊèêÈ´òÁî®Êà∑‰ΩìÈ™å</li>
<li>Êï∞ÊçÆÂ∫ìÂéãÂäõÂ§ßÔºö	<strong>ÂáèÂ∞ëÁû¨Êó∂ÂÜôÂÖ•ÂéãÂäõ</strong>ÔºåÈÅøÂÖçÊï∞ÊçÆÂ∫ìËøûÊé•ÁàÜÁÇ∏</li>
</ul>
<p><strong>Â∞èÁªì‰∏ÄÂè•ËØù</strong><br>RabbitMQ Âú®ÁßíÊùÄÁ≥ªÁªü‰∏≠ÊòØ È´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÁöÑÂÖ≥ÈîÆ‰∏≠Èó¥‰ª∂ÔºåÈÄöËøáÂºÇÊ≠•„ÄÅÂâäÂ≥∞„ÄÅËß£ËÄ¶„ÄÅÊâ©Â±ïÊÄßÂº∫Á≠âÁâπÊÄßÔºåÊúâÊïàËß£ÂÜ≥‰∫Ü‰º†ÁªüÂêåÊ≠•Â§ÑÁêÜÊû∂ÊûÑÂú®ÁßíÊùÄÂú∫ÊôØ‰∏≠ÈÅáÂà∞ÁöÑÊÄßËÉΩÁì∂È¢àÂíåÁ≥ªÁªüÁ®≥ÂÆöÊÄßÈóÆÈ¢ò„ÄÇ</p>
<h4 id="1-1-5-Redis-ËÆ°Êï∞-MongoDB-ÂºÇÊ≠•ÊåÅ‰πÖÂåñ"><a href="#1-1-5-Redis-ËÆ°Êï∞-MongoDB-ÂºÇÊ≠•ÊåÅ‰πÖÂåñ" class="headerlink" title="1.1.5 Redis ËÆ°Êï∞ +  MongoDB ÂºÇÊ≠•ÊåÅ‰πÖÂåñ"></a>1.1.5 Redis ËÆ°Êï∞ +  MongoDB ÂºÇÊ≠•ÊåÅ‰πÖÂåñ</h4><p><code>RedisMongoReactiveStrategy</code>Á±ª</p>
<p><strong>‰ΩøÁî®RedisËøõË°åÁßíÊùÄÂïÜÂìÅÂáèÂ∫ìÂ≠òÊìç‰ΩúÔºåÁßíÊùÄÁªìÊùüÂêéÂºÇÊ≠•ÂèëÈÄÅMQÔºå‰ΩøÁî®MongoDBÂÆåÊàêÊï∞ÊçÆËêΩÂú∞</strong></p>
<p><strong>Ê†∏ÂøÉÈÄªËæë</strong></p>
<ul>
<li>Redis ËÆ°Êï∞ÔºöÂà©Áî® Redis ÁöÑÂéüÂ≠êÊÄßÊìç‰ΩúÔºàÂ¶Ç INCR Êàñ DECRÔºâÊù•Âø´ÈÄüÊâ£ÂáèÂ∫ìÂ≠òÔºåËÆ∞ÂΩïÁßíÊùÄÊàêÂäüÁöÑËØ∑Ê±Ç„ÄÇ<ul>
<li>ÂØπ Redis ‰∏≠ÁöÑÂïÜÂìÅÁßíÊùÄËÆ°Êï∞ËøõË°å +1Ôºõ</li>
<li>Ëã•ËÆ°Êï∞ &lt;&#x3D; Â∫ìÂ≠òÔºåÂàôÁßíÊùÄÊàêÂäüÔºõ</li>
<li>ÂèëÈÄÅÁßíÊùÄÊàêÂäüÊ∂àÊÅØÔºàÂåÖÂê´ÊâãÊú∫Âè∑„ÄÅÂïÜÂìÅID„ÄÅÊ≥®ÈáäÁ≠âÔºâÂà∞ÁªëÂÆöÈÄöÈÅìÔºåÂºÇÊ≠•ËêΩÂ∫ì MongoDBÔºàÂç≥‚ÄúÊúÄÁªàÂÜôÂÖ•Êï∞ÊçÆÂ∫ì‚ÄùÔºâ„ÄÇ</li>
</ul>
</li>
<li>MongoDB ÂºÇÊ≠•ÊåÅ‰πÖÂåñÔºöÂ∞ÜÁßíÊùÄÊàêÂäüÁöÑËÆ¢ÂçïÊï∞ÊçÆÂºÇÊ≠•ÂÜôÂÖ• MongoDBÔºåÈÅøÂÖçÊï∞ÊçÆÂ∫ìÊìç‰ΩúÈòªÂ°û‰∏ªÊµÅÁ®ã„ÄÇ</li>
</ul>
<p><strong>ÂºÇÊ≠•ÊåÅ‰πÖÂåñÊµÅÁ®ã</strong></p>
<ul>
<li><strong>Ê∂àÊÅØÈòüÂàó</strong>ÔºöÈ°πÁõÆ‰ΩøÁî® Spring Cloud StreamÔºàÈªòËÆ§ÁªëÂÆö RabbitMQ Êàñ KafkaÔºâ‰Ωú‰∏∫Ê∂àÊÅØ‰∏≠Èó¥‰ª∂„ÄÇStreamBridge Â∞ÜËÆ¢ÂçïÊï∞ÊçÆÔºàSeckillMockSaveVoÔºâÂèëÈÄÅÂà∞Ê∂àÊÅØÈòüÂàóÁöÑ seckillMongoSave ÈÄöÈÅì„ÄÇ</li>
<li><strong>ËÆ¢ÂçïÊúçÂä°Ê∂àË¥π</strong>Ôºögoodskill-order-provider Ê®°ÂùóÁöÑ OrderApplication ÈÖçÁΩÆ‰∫Ü‰∏Ä‰∏™Ê∂àÊÅØÊ∂àË¥πËÄÖÔºåÁõëÂê¨ seckillMongoSave ÈÄöÈÅìÔºåÊé•Êî∂Ê∂àÊÅØÂêéÂ∞ÜËÆ¢ÂçïÊï∞ÊçÆ‰øùÂ≠òÂà∞ MongoDB„ÄÇ</li>
</ul>
<p><strong>Ëß£ÂÜ≥‰∫ÜÁßíÊùÄ‰∏≠ÁöÑÂì™‰∫õÈóÆÈ¢ò</strong></p>
<ol>
<li>È´òÂπ∂Âèë‰∏ãÁöÑÊÄßËÉΩÁì∂È¢à<ul>
<li>ÈóÆÈ¢òÔºö‰º†ÁªüÁßíÊùÄÁ≥ªÁªü‰∏≠ÔºåÂ∫ìÂ≠òÊâ£ÂáèÂíåËÆ¢ÂçïÂÜôÂÖ•ÈÄöÂ∏∏Áõ¥Êé•Êìç‰ΩúÂÖ≥Á≥ªÂûãÊï∞ÊçÆÂ∫ìÔºàÂ¶Ç MySQLÔºâ„ÄÇÂú®È´òÂπ∂ÂèëÂú∫ÊôØ‰∏ãÔºåÊï∞ÊçÆÂ∫ìÁöÑÈîÅÁ´û‰∫âÂíå I&#x2F;O Êìç‰Ωú‰ºöÂØºËá¥ÊÄßËÉΩÁì∂È¢àÔºåÁîöËá≥ÂºïÂèëÊï∞ÊçÆÂ∫ìÂÆïÊú∫„ÄÇ</li>
<li>Ëß£ÂÜ≥ÊñπÊ°àÔºö<ul>
<li>Redis ËÆ°Êï∞Ôºö<strong>Â∞ÜÂ∫ìÂ≠òÊâ£ÂáèÊìç‰ΩúÁßªÂà∞ Redis</strong>Ôºå<strong>ÂÜÖÂ≠òÊìç‰ΩúÈÄüÂ∫¶ËøúË∂ÖÊï∞ÊçÆÂ∫ì</strong>ÔºåÂçïËäÇÁÇπ Redis ÂèØÂ§ÑÁêÜÊï∞‰∏á QPSÔºåÊûÅÂ§ßÊèêÂçá‰∫ÜÂπ∂ÂèëÂ§ÑÁêÜËÉΩÂäõ„ÄÇ</li>
<li>ÂºÇÊ≠•ÊåÅ‰πÖÂåñÔºöËÆ¢ÂçïÂÜôÂÖ• MongoDB ÁöÑÊìç‰ΩúÈÄöËøáÊ∂àÊÅØÈòüÂàóÂºÇÊ≠•ÊâßË°åÔºå‰∏ªÊµÅÁ®ãÊó†ÈúÄÁ≠âÂæÖÊï∞ÊçÆÂ∫ìÂìçÂ∫îÔºåÂìçÂ∫îÊó∂Èó¥‰ªéÊØ´ÁßíÁ∫ßÈôçÂà∞ÂæÆÁßíÁ∫ß„ÄÇ</li>
</ul>
</li>
</ul>
</li>
<li><strong>Ë∂ÖÂçñÈóÆÈ¢ò</strong><ul>
<li>ÈóÆÈ¢òÔºöÂú®È´òÂπ∂Âèë‰∏ãÔºåÂ§ö‰∏™ËØ∑Ê±ÇÂèØËÉΩÂêåÊó∂ËØªÂèñÂà∞Áõ∏ÂêåÁöÑÂ∫ìÂ≠òÂÄºÔºåÂØºËá¥Â∫ìÂ≠òÊâ£Âáè‰∏çÂáÜÁ°ÆÔºåÂá∫Áé∞Ë∂ÖÂçñÔºàÂçñÂá∫Êï∞ÈáèË∂ÖËøáÂÆûÈôÖÂ∫ìÂ≠òÔºâ</li>
<li>Ëß£ÂÜ≥ÊñπÊ°àÔºö<ul>
<li><strong>Redis ÂéüÂ≠êÊìç‰Ωú</strong>Ôºö‰ΩøÁî® DECR ÂëΩ‰ª§Á°Æ‰øùÂ∫ìÂ≠òÊâ£ÂáèÊòØÂéüÂ≠êÊÄßÁöÑÔºå<strong>Âè™ÊúâÂΩìÂ∫ìÂ≠òÂ§ß‰∫é 0 Êó∂ÊâçÂÖÅËÆ∏Êâ£ÂáèÔºåÂΩªÂ∫ïÈÅøÂÖçË∂ÖÂçñ</strong>„ÄÇ</li>
</ul>
</li>
</ul>
</li>
<li>Êï∞ÊçÆÂ∫ìÂéãÂäõËøáÂ§ß<ul>
<li>ÈóÆÈ¢òÔºöÁßíÊùÄÂú∫ÊôØ‰∏ãÔºåÁü≠Êó∂Èó¥ÂÜÖÂ§ßÈáèËÆ¢ÂçïÂÜôÂÖ•‰ºöÂØºËá¥Êï∞ÊçÆÂ∫ìÂéãÂäõÊøÄÂ¢ûÔºåÂèØËÉΩÂºïÂèëËøûÊé•Ê±†ËÄóÂ∞ΩÊàñÊÖ¢Êü•ËØ¢„ÄÇ</li>
<li>Ëß£ÂÜ≥ÊñπÊ°àÔºö<ul>
<li>MongoDB ÂºÇÊ≠•ÂÜôÂÖ•ÔºöMongoDB ÊòØ‰∏Ä‰∏™È´òÊÄßËÉΩÁöÑ NoSQL Êï∞ÊçÆÂ∫ìÔºå<strong>ÈÄÇÂêàÈ´òÂêûÂêêÂÜôÂÖ•Âú∫ÊôØ</strong>„ÄÇÈÄöËøáÊ∂àÊÅØÈòüÂàóÂºÇÊ≠•ÂÜôÂÖ•ÔºåËÆ¢ÂçïÊï∞ÊçÆÈÄêÊ≠•ÊåÅ‰πÖÂåñÔºåÂπ≥Êªë‰∫ÜÊï∞ÊçÆÂ∫ìÁöÑÁû¨Êó∂ÂéãÂäõ„ÄÇ</li>
<li>Ê∂àÊÅØÈòüÂàóÁºìÂÜ≤Ôºö<strong>Ê∂àÊÅØÈòüÂàó‰Ωú‰∏∫ÁºìÂÜ≤Â±Ç</strong>ÔºåÂê∏Êî∂‰∫ÜÈ´òÂπ∂ÂèëËØ∑Ê±ÇÁöÑÂ≥∞ÂÄºÊµÅÈáèÔºåËÆ¢ÂçïÊúçÂä°ÂèØ‰ª•ÊåâËá™Ë∫´ËäÇÂ•èÊ∂àË¥πÊ∂àÊÅØÔºåÈÅøÂÖçÊï∞ÊçÆÂ∫ìÁõ¥Êé•Èù¢ÂØπÊµÅÈáèÊ¥™Â≥∞„ÄÇ</li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Redis + MongoDB ÂìçÂ∫îÂºèÁßíÊùÄÁ≠ñÁï•ÂÆûÁé∞</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * ËØ•Á±ª‰ΩøÁî®Á∫øÁ®ãÊ±†ÂºÇÊ≠•Â§ÑÁêÜÁßíÊùÄËØ∑Ê±ÇÔºåÁªìÂêà Redis ËøõË°åÂ∫ìÂ≠òÊéßÂà∂Ôºå</span><br><span class="hljs-comment"> * ÁßíÊùÄÊàêÂäüÂêéÈÄöËøá StreamBridge ÂºÇÊ≠•ÂÜôÂÖ• MongoDBÔºåÈÅøÂÖçÈ´òÂπ∂Âèë‰∏ãÊï∞ÊçÆÂ∫ìÂéãÂäõËøáÂ§ßÔºõ</span><br><span class="hljs-comment"> * ÂΩìÂ∫ìÂ≠òËÄóÂ∞ΩÊó∂ÔºåÁªìÂêàÁä∂ÊÄÅÊú∫ËøõË°åÁä∂ÊÄÅÊõ¥Êñ∞ÔºåÂπ∂ÂèëÈÄÅ‚ÄúÊ¥ªÂä®ÁªìÊùü‚ÄùÊ∂àÊÅØÈÄöÁü•ÂÖ∂‰ªñÊ®°Âùó„ÄÇ</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * ÊäÄÊúØÁÇπÔºöÁ∫øÁ®ãÊ±† + Redis + Mongo + StreamBridge + Áä∂ÊÄÅÊú∫</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisMongoReactiveStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GoodsKillStrategy</span> &#123;<br><br>    <span class="hljs-comment">// Redis ÁºìÂ≠òÊúçÂä°ÔºåÂ∞ÅË£Ö‰∫ÜÁßíÊùÄÂïÜÂìÅ‰ø°ÊÅØÁöÑËé∑Âèñ‰∏éÂ≠òÂÇ®</span><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisService redisService;<br><br>    <span class="hljs-comment">// Redis ÂéüÁîüÊìç‰ΩúÂ∑•ÂÖ∑ÔºåÁî®‰∫éÂ∫ìÂ≠òËÆ°Êï∞ÔºàËá™Â¢ûÔºâ</span><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;<br><br>    <span class="hljs-comment">// ÂºÇÊ≠•‰ªªÂä°Á∫øÁ®ãÊ±†ÔºåÈÅøÂÖç‰∏ªÁ∫øÁ®ãÈòªÂ°ûÔºåÊèêÂçáÁ≥ªÁªüÂêûÂêêÈáè</span><br>    <span class="hljs-meta">@Resource(name = &quot;taskExecutor&quot;)</span><br>    <span class="hljs-keyword">private</span> ThreadPoolExecutor taskExecutor;<br><br>    <span class="hljs-comment">// Ê∂àÊÅØÂèëÈÄÅÂô®ÔºåÁî®‰∫éÂêëÁªëÂÆöÈÄöÈÅìÂèëÈÄÅÊ∂àÊÅØÔºàÂ¶ÇÔºö‰øùÂ≠òËÆ¢ÂçïÔºåÈÄöÁü•Ê¥ªÂä®ÁªìÊùüÔºâ</span><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StreamBridge streamBridge;<br><br>    <span class="hljs-comment">// Áä∂ÊÄÅÊú∫ÊúçÂä°ÔºåÊéßÂà∂Ê¥ªÂä®Áä∂ÊÄÅÔºàÂ¶ÇÔºöËøõË°å‰∏≠„ÄÅÂ∑≤ÁªìÊùüÔºâ</span><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StateMachineService stateMachineService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êé•Êî∂ÁßíÊùÄËØ∑Ê±ÇÔºå‰∫§Áî±Á∫øÁ®ãÊ±†ÂºÇÊ≠•ÊâßË°å‰∏ªÈÄªËæë</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> requestDto ÁßíÊùÄËØ∑Ê±ÇÂèÇÊï∞ÔºàÂåÖÂê´ÁßíÊùÄID„ÄÅÊâãÊú∫Âè∑„ÄÅ‰ªªÂä°IDÁ≠âÔºâ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        taskExecutor.execute(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                doExecute(requestDto);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                log.error(<span class="hljs-string">&quot;ÁßíÊùÄÂ§±Ë¥•&quot;</span>, e);<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊâßË°åÂÖ∑‰ΩìÁöÑÁßíÊùÄÂ§ÑÁêÜÈÄªËæë</span><br><span class="hljs-comment">     * 1. Redis ‰∏≠ËøõË°åÂ∫ìÂ≠òÈÄíÂ¢ûÂà§Êñ≠ÊòØÂê¶ÊàêÂäü</span><br><span class="hljs-comment">     * 2. ÁßíÊùÄÊàêÂäüÔºöÈÄöËøáÊ∂àÊÅØÈòüÂàóÂºÇÊ≠•ÂèëÈÄÅ‰øùÂ≠òËÆ¢Âçï‰ø°ÊÅØ</span><br><span class="hljs-comment">     * 3. ÁßíÊùÄÂ§±Ë¥•ÔºöÂà§Êñ≠ÊòØÂê¶Â∑≤ÁªìÊùüÂπ∂Ëß¶ÂèëÁä∂ÊÄÅÊú∫Êõ¥Êñ∞ÔºåÂêåÊó∂ÂπøÊí≠Ê¥ªÂä®ÁªìÊùüÈÄöÁü•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doExecute</span><span class="hljs-params">(SeckillMockRequestDTO requestDto)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">seckillId</span> <span class="hljs-operator">=</span> requestDto.getSeckillId();<br><br>        <span class="hljs-comment">// ‰ªé Redis Ëé∑ÂèñÁßíÊùÄÂïÜÂìÅËØ¶ÊÉÖ</span><br>        <span class="hljs-type">Seckill</span> <span class="hljs-variable">seckill</span> <span class="hljs-operator">=</span> redisService.getSeckill(seckillId);<br><br>        <span class="hljs-comment">// Â∞ùËØï‰ΩøÁî® Redis Ëá™Â¢ûÊ®°ÊãüÂ∫ìÂ≠òÊâ£ÂáèÊìç‰Ωú</span><br>        <span class="hljs-keyword">if</span> (redisTemplate.opsForValue().increment(String.valueOf(seckillId)) &lt;= seckill.getNumber()) &#123;<br><br>            <span class="hljs-comment">// ÁßíÊùÄÊàêÂäüÔºöÈÄöËøáÊ∂àÊÅØÈòüÂàóÂºÇÊ≠•Â∞ÜËÆ¢ÂçïÂÜôÂÖ• MongoDB</span><br>            taskExecutor.execute(() -&gt;<br>                streamBridge.send(DEFAULT_BINDING_NAME_MONGO_SAVE, MessageBuilder.withPayload(<br>                        SeckillMockSaveVo.builder()<br>                                .seckillId(seckillId)<br>                                .userPhone(requestDto.getPhoneNumber())<br>                                .note(REDIS_MONGO_REACTIVE.getName())<br>                                .build())<br>                        .build())<br>            );<br><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// ÁßíÊùÄÂ§±Ë¥•ÔºöÂ∫ìÂ≠òË∂ÖÈôêÔºåÂèØËÉΩÈúÄË¶ÅÂπøÊí≠Ê¥ªÂä®ÁªìÊùü</span><br>            <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                <span class="hljs-comment">// ÂÜçÊ¨°Ëé∑Âèñ Redis ‰∏≠ÂïÜÂìÅÁä∂ÊÄÅÔºàÈò≤Ê≠¢Âπ∂Âèë‰∏ÄËá¥ÊÄßÈóÆÈ¢òÔºâ</span><br>                seckill = redisService.getSeckill(seckillId);<br><br>                <span class="hljs-comment">// Âà§Êñ≠ÂΩìÂâçÊ¥ªÂä®ÊòØÂê¶‰ªçÂ§Ñ‰∫éËøõË°å‰∏≠</span><br>                <span class="hljs-keyword">if</span> (stateMachineService.checkState(seckillId, States.IN_PROGRESS)) &#123;<br>                    <span class="hljs-comment">// Ëß¶ÂèëÁä∂ÊÄÅÊú∫‰∫ã‰ª∂ÔºöËÆ°ÁÆó -&gt; Ê¥ªÂä®ÁªìÊùü</span><br>                    stateMachineService.feedMachine(Events.ACTIVITY_CALCULATE, seckillId);<br><br>                    log.info(<span class="hljs-string">&quot;ÁßíÊùÄÂïÜÂìÅÊöÇÊó†Â∫ìÂ≠òÔºåÂèëÈÄÅÊ¥ªÂä®ÁªìÊùüÊ∂àÊÅØÔºÅ&quot;</span>);<br><br>                    <span class="hljs-comment">// ÂèëÈÄÅÊ¥ªÂä®ÁªìÊùüÊ∂àÊÅØÔºàÁî®‰∫éÂâçÁ´ØÊèêÁ§∫„ÄÅÂÖ≥Èó≠È°µÈù¢Á≠âÔºâ</span><br>                    streamBridge.send(DEFAULT_BINDING_NAME, MessageBuilder.withPayload(<br>                            SeckillMockResponseDTO.builder()<br>                                    .status(<span class="hljs-literal">true</span>)<br>                                    .seckillId(seckillId)<br>                                    .note(REDIS_MONGO_REACTIVE.getName())<br>                                    .taskId(requestDto.getTaskId())<br>                                    .build())<br>                            .build());<br><br>                    <span class="hljs-comment">// Êõ¥Êñ∞ Redis ‰∏≠ËØ•ÂïÜÂìÅÁä∂ÊÄÅ‰∏∫‚ÄúÁªìÊùü‚Äù</span><br>                    seckill.setStatus(SeckillStatusConstant.END);<br>                    redisService.putSeckill(seckill);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-2-Âì™‰∫õÊòØÂêåÊ≠•ÔºåÂì™‰∫õÊòØÂºÇÊ≠•Ôºü"><a href="#1-2-Âì™‰∫õÊòØÂêåÊ≠•ÔºåÂì™‰∫õÊòØÂºÇÊ≠•Ôºü" class="headerlink" title="1.2 Âì™‰∫õÊòØÂêåÊ≠•ÔºåÂì™‰∫õÊòØÂºÇÊ≠•Ôºü"></a>1.2 Âì™‰∫õÊòØÂêåÊ≠•ÔºåÂì™‰∫õÊòØÂºÇÊ≠•Ôºü</h3><p>Á≥ªÁªüÂú®Â§ÑÁêÜÁßíÊùÄËØ∑Ê±ÇÊó∂ÔºåÊèê‰æõ‰∫Ü‰∏§ÁßçÂπ∂Ë°åÁöÑÂ§ÑÁêÜÊñπÂºè‚Äî‚Äî<strong>ÂêåÊ≠•ÈÄöÈÅìÂíåÂºÇÊ≠•ÈÄöÈÅì</strong></p>
<ul>
<li>ÂêåÊ≠•ÈÄöÈÅìÊòØÊåáËØ∑Ê±ÇÁöÑÂ§ÑÁêÜÊµÅÁ®ãÊòØÂÆûÊó∂ÁöÑ„ÄÅ<strong>ÈòªÂ°ûÁöÑ</strong>,<strong>Áî®Êà∑ÈúÄË¶ÅÁ≠âÂæÖ</strong>Â§ÑÁêÜÂÆåÊàê„ÄÇ</li>
<li>ÂºÇÊ≠•ÈÄöÈÅìÊòØÊåáËØ∑Ê±ÇÁöÑÂ§ÑÁêÜÊµÅÁ®ãÊòØ<strong>ÈùûÈòªÂ°ûÁöÑ</strong>ÔºåÁî®Êà∑ÂèëÂá∫ËØ∑Ê±ÇÂêéÔºåÁ≥ªÁªüÁ´ãÂç≥ËøîÂõû‰∏Ä‰∏™ÂàùÊ≠•ÂìçÂ∫î, <strong>Áî®Êà∑Êó†ÈúÄÁ≠âÂæÖ</strong>ÊâÄÊúâÊìç‰ΩúÂÆåÊàê</li>
</ul>
<p><strong>ÂêåÊ≠•ÈÄöÈÅìÁöÑÂÆûÁé∞</strong></p>
<ul>
<li>SynchronizedLockStrategyÔºö‰ΩøÁî® Java ÁöÑ <strong>synchronized Êú¨Âú∞ÈîÅ</strong>ÔºåÊåâÂïÜÂìÅ ID Âä†ÈîÅÔºå‰∏≤Ë°åÂ§ÑÁêÜËØ∑Ê±Ç„ÄÇ</li>
<li>AtomicUpdateStrategyÔºöÈÄöËøáÊï∞ÊçÆÂ∫ìÁöÑ<strong>‰πêËßÇÈîÅ</strong>ÔºàÂ¶Ç UPDATE ‚Ä¶ WHERE stock &gt; 0ÔºâÂÆûÁé∞Â∫ìÂ≠òÊâ£Âáè„ÄÇ</li>
<li><strong>RedissonÂàÜÂ∏ÉÂºèÈîÅ</strong></li>
</ul>
<p><strong>ÂºÇÊ≠•ÈÄöÈÅìÁöÑÂÆûÁé∞</strong></p>
<ul>
<li>RabbitMQStrategyÔºöÈÄöËøá <strong>RabbitMQ Ê∂àÊÅØÈòüÂàó</strong>ÂºÇÊ≠•Â§ÑÁêÜÁßíÊùÄËØ∑Ê±Ç„ÄÇ</li>
<li>RedisMongoReactiveStrategyÔºö‰ΩøÁî® Redis ËÆ°Êï∞Êâ£ÂáèÂ∫ìÂ≠òÔºåÈÄöËøá<strong>Ê∂àÊÅØÈòüÂàóÂºÇÊ≠•ÂÜôÂÖ• MongoDB</strong></li>
</ul>
<h3 id="1-3-Â¶Ç‰ΩïÊµãËØïÁöÑËøô‰∫õÊñπÊ≥ïÔºü"><a href="#1-3-Â¶Ç‰ΩïÊµãËØïÁöÑËøô‰∫õÊñπÊ≥ïÔºü" class="headerlink" title="1.3 Â¶Ç‰ΩïÊµãËØïÁöÑËøô‰∫õÊñπÊ≥ïÔºü"></a>1.3 Â¶Ç‰ΩïÊµãËØïÁöÑËøô‰∫õÊñπÊ≥ïÔºü</h3><ol>
<li>sychronizedÂêåÊ≠•ÈîÅ</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ÈÄöËøáÂêåÊ≠•ÈîÅÊéßÂà∂ÁßíÊùÄÂπ∂ÂèëÔºàÁßíÊùÄÊú™ÂÆåÊàêÈòªÂ°û‰∏ªÁ∫øÁ®ãÔºâ</span><br><span class="hljs-comment">    * Âú∫ÊôØ‰∏ÄÔºöÂàùÂßãÂåñÂΩìÂâçÂ∫ìÂ≠ò‰∏∫1000ÔºåÈÄöËøáÁ∫øÁ®ãÊ±†Ë∞ÉÂ∫¶ÔºåÊ®°ÊãüÊÄªÂÖ±Êúâ2000‰∫∫ÂèÇ‰∏éÁßíÊùÄÔºåÊúüÊúõÂÄº‰∏∫ÊúÄÂêéÊàêÂäüÁ¨îÊï∞‰∏∫1000</span><br><span class="hljs-comment">    * ÁªìÊûúÔºöÂ§öÊ¨°ËøêË°åÔºåÊúÄÁªàÁöÑÁªìÊûú‰∏∫1000</span><br><span class="hljs-comment">    * ÊÄªÁªìÔºöÂä†‰∏äÂêåÊ≠•ÈîÅÂèØ‰ª•Ëß£ÂÜ≥ÁßíÊùÄÈóÆÈ¢òÔºåÈÄÇÁî®‰∫éÂçïÊú∫Ê®°ÂºèÔºåÊâ©Â±ïÊÄßÂ∑Æ„ÄÇ</span><br><span class="hljs-comment">    */</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>redissonÂàÜÂ∏ÉÂºèÈîÅ</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÈÄöËøáÂêåÊ≠•ÈîÅÊéßÂà∂ÁßíÊùÄÂπ∂ÂèëÔºàÁßíÊùÄÊú™ÂÆåÊàêÈòªÂ°û‰∏ªÁ∫øÁ®ãÔºâ</span><br><span class="hljs-comment"> * Âú∫ÊôØ‰∫åÔºöÂàùÂßãÂåñÂΩìÂâçÂ∫ìÂ≠ò‰∏∫1000ÔºåÈÄöËøáÁ∫øÁ®ãÊ±†Ë∞ÉÂ∫¶ÔºåÊ®°ÊãüÊÄªÂÖ±Êúâ2000‰∫∫ÂèÇ‰∏éÁßíÊùÄÔºåÊúüÊúõÂÄº‰∏∫ÊúÄÂêéÊàêÂäüÁ¨îÊï∞‰∏∫1000</span><br><span class="hljs-comment"> * ÁªìÊûúÔºöÂ§öÊ¨°ËøêË°åÔºåÊúÄÁªàÁöÑÁªìÊûú‰∏∫1000</span><br><span class="hljs-comment"> * ÊÄªÁªìÔºöÂä†‰∏äÂêåÊ≠•ÈîÅÂèØ‰ª•Ëß£ÂÜ≥ÁßíÊùÄÈóÆÈ¢òÔºåÈÄÇÁî®‰∫éÂàÜÂ∏ÉÂºèÁéØÂ¢ÉÔºå‰ΩÜÈÄüÂ∫¶‰∏çÂ¶ÇÂä†ÂêåÊ≠•ÈîÅ„ÄÇ</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>RabbitMQÊ∂àÊÅØÈòüÂàó</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ÂºÇÊ≠•ÁßíÊùÄ</span><br><span class="hljs-comment">   * Âú∫ÊôØ‰∏âÔºöÂàùÂßãÂåñÂΩìÂâçÂ∫ìÂ≠ò‰∏∫1000ÔºåÈÄöËøáÁ∫øÁ®ãÊ±†Ë∞ÉÂ∫¶ÔºåÊ®°ÊãüÊÄªÂÖ±Êúâ2000‰∫∫ÂèÇ‰∏éÁßíÊùÄÔºåÊúüÊúõÂÄº‰∏∫ÊúÄÂêéÊàêÂäüÁ¨îÊï∞‰∏∫1000</span><br><span class="hljs-comment">   * ÁªìÊûúÔºöÂ§öÊ¨°ËøêË°åÔºåÊúÄÁªàÁöÑÁªìÊûú‰∏∫1000</span><br><span class="hljs-comment">   * ÊÄªÁªìÔºöÈÄüÂ∫¶Âø´„ÄÇ</span><br><span class="hljs-comment">   */</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>Êï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÈÄöËøáÂêåÊ≠•ÈîÅÊéßÂà∂ÁßíÊùÄÂπ∂ÂèëÔºåÁßíÊùÄËøáÁ®ã‰ΩøÁî®Â≠òÂÇ®ËøáÁ®ãÔºàÁßíÊùÄÊú™ÂÆåÊàêÈòªÂ°û‰∏ªÁ∫øÁ®ãÔºâ</span><br><span class="hljs-comment">     * Âú∫ÊôØ‰∫îÔºöÂàùÂßãÂåñÂΩìÂâçÂ∫ìÂ≠ò‰∏∫1000ÔºåÈÄöËøáÁ∫øÁ®ãÊ±†Ë∞ÉÂ∫¶ÔºåÊ®°ÊãüÊÄªÂÖ±Êúâ2000‰∫∫ÂèÇ‰∏éÁßíÊùÄÔºåÊúüÊúõÂÄº‰∏∫ÊúÄÂêéÊàêÂäüÁ¨îÊï∞‰∏∫1000</span><br><span class="hljs-comment">     * ÁªìÊûúÔºöÂ§öÊ¨°ËøêË°åÔºåÊúÄÁªàÁöÑÁªìÊûú‰∏∫1000</span><br><span class="hljs-comment">     * ÊÄªÁªìÔºöÈÄüÂ∫¶Âø´</span><br><span class="hljs-comment">     */</span><br></code></pre></td></tr></table></figure>

<ol start="5">
<li>Redis ËÆ°Êï∞ +  MongoDB ÂºÇÊ≠•ÊåÅ‰πÖÂåñ</li>
</ol>
<p>‰ΩøÁî®redisÁºìÂ≠òÊâßË°åÂ∫ìÂ≠ò-1Êìç‰ΩúÔºåÊúÄÂêéÈÄöËøáÂèëÈÄÅMQÂÆåÊàêÊï∞ÊçÆËêΩÂú∞ÔºàÂ≠òÂÖ•mongoDBÔºâ</p>
<h3 id="1-4-‰∫îÁßçÁ≠ñÁï•ÊÄªÁªì"><a href="#1-4-‰∫îÁßçÁ≠ñÁï•ÊÄªÁªì" class="headerlink" title="1.4 ‰∫îÁßçÁ≠ñÁï•ÊÄªÁªì"></a>1.4 ‰∫îÁßçÁ≠ñÁï•ÊÄªÁªì</h3><p><strong>‰∫îÁßçÁßíÊùÄÁ≠ñÁï•ÂØπÊØîË°®Ê†º</strong></p>
<table>
<thead>
<tr>
<th><strong>Á≠ñÁï•ÂêçÁß∞</strong></th>
<th><strong>‰ΩúÁî®</strong></th>
<th><strong>ÂÆûÁé∞ÊñπÂºè</strong></th>
<th><strong>‰ºòÁÇπ</strong></th>
<th><strong>Áº∫ÁÇπ</strong></th>
<th><strong>ÈÄÇÁî®Âú∫ÊôØ</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Synchronized ÂêåÊ≠•ÈîÅ</strong></td>
<td>‰ΩøÁî® Java Êú¨Âú∞ÈîÅ‰∏≤Ë°åÂ§ÑÁêÜËØ∑Ê±ÇÔºåÁ°Æ‰øùÂ∫ìÂ≠òÊâ£ÂáèÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÔºåÈò≤Ê≠¢Ë∂ÖÂçñ„ÄÇ</td>
<td>ÈÄöËøá <code>synchronized</code> ÂÖ≥ÈîÆÂ≠óÂØπÂïÜÂìÅ ID Âä†ÈîÅÔºåÂêåÊ≠•ÊâßË°åÂ∫ìÂ≠òÊ£ÄÊü•ÂíåÊâ£ÂáèÔºåËÆ¢ÂçïÁõ¥Êé•ÂÜôÂÖ•Êï∞ÊçÆÂ∫ì„ÄÇ</td>
<td>1. ÂÆûÁé∞ÁÆÄÂçïÔºåÊó†ÈúÄÈ¢ùÂ§ñÁªÑ‰ª∂<br>2. ÂçïÊú∫ÁéØÂ¢É‰∏ã‰øùËØÅ‰∏ÄËá¥ÊÄß<br>3. ÈîÅÁ≤íÂ∫¶ÁªÜÔºàÊåâÂïÜÂìÅÔºâ</td>
<td>1. ‰∏çÊîØÊåÅÂàÜÂ∏ÉÂºèÈÉ®ÁΩ≤<br>2. È´òÂπ∂Âèë‰∏ãÊÄßËÉΩÁì∂È¢àÊòéÊòæÔºàÈîÅÁ´û‰∫âÔºâ<br>3. ÂçïÁ∫øÁ®ãÂ§ÑÁêÜÔºåÂêûÂêêÈáè‰Ωé</td>
<td>ÂçïÊú∫„ÄÅ‰ΩéÂπ∂ÂèëÂú∫ÊôØ</td>
</tr>
<tr>
<td><strong>Êï∞ÊçÆÂ∫ì‰πêËßÇÈîÅ</strong></td>
<td>ÈÄöËøáÊï∞ÊçÆÂ∫ìÁâàÊú¨Âè∑ÊàñÊù°‰ª∂Êõ¥Êñ∞ÂÆûÁé∞Â∫ìÂ≠òÊâ£ÂáèÁöÑÂπ∂ÂèëÊéßÂà∂Ôºå‰øùËØÅ‰∏ÄËá¥ÊÄß„ÄÇ</td>
<td>‰ΩøÁî® SQLÔºàÂ¶Ç <code>UPDATE seckill SET stock = stock - 1 WHERE stock &gt; 0 AND id = ?</code>ÔºâÂéüÂ≠êÊõ¥Êñ∞Â∫ìÂ≠ò„ÄÇ</td>
<td>1. ÁÆÄÂçïÈ´òÊïàÔºå‰æùËµñÊï∞ÊçÆÂ∫ì‰∫ãÂä°<br>2. Êó†ÈúÄÈ¢ùÂ§ñ‰∏≠Èó¥‰ª∂<br>3. ÂçïÊú∫ÊàñÂ∞èËßÑÊ®°ÂàÜÂ∏ÉÂºè‰∏ÄËá¥ÊÄßÂº∫</td>
<td>1. È´òÂπ∂Âèë‰∏ãÊï∞ÊçÆÂ∫ìÂéãÂäõÂ§ß<br>2. ÈîÅÂÜ≤Á™ÅÈ¢ëÁπÅÔºåÊàêÂäüÁéáÈôç‰Ωé<br>3. ÊÄßËÉΩÂèóÊï∞ÊçÆÂ∫ìÁì∂È¢àÈôêÂà∂</td>
<td>ÂçïÊú∫Êàñ‰∏≠Â∞èËßÑÊ®°ÂàÜÂ∏ÉÂºèÁ≥ªÁªü</td>
</tr>
<tr>
<td><strong>Redisson ÂàÜÂ∏ÉÂºèÈîÅ</strong></td>
<td>Âú®ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ãÈÄöËøá Redis ÂàÜÂ∏ÉÂºèÈîÅÂÆûÁé∞Â∫ìÂ≠òÊâ£ÂáèÁöÑ‰∫íÊñ•ÊÄßÔºåÈò≤Ê≠¢Ë∂ÖÂçñ„ÄÇ</td>
<td>‰ΩøÁî® Redisson ÁöÑ <code>RLock</code> ÂØπÂïÜÂìÅ ID Âä†ÈîÅÔºåÈîÅ‰ΩèÂêéÊâßË°åÂ∫ìÂ≠òÊâ£ÂáèÂíåËÆ¢ÂçïÂÜôÂÖ•„ÄÇ</td>
<td>1. ÊîØÊåÅÂàÜÂ∏ÉÂºèÈÉ®ÁΩ≤<br>2. ÁÆÄÂçïÊòìÁî®ÔºåÂèØÈáçÂÖ•ÈîÅÊîØÊåÅ<br>3. Redis ÊÄßËÉΩÈ´òÔºåÈîÅÁ≤íÂ∫¶ÂèØÊéß</td>
<td>1. ÈîÅËé∑Âèñ&#x2F;ÈáäÊîæÊúâÁΩëÁªúÂºÄÈîÄ<br>2. Redis ÊïÖÈöúÂΩ±ÂìçÈîÅÂèØÁî®ÊÄß<br>3. È´òÂπ∂Âèë‰∏ãÈîÅÁ´û‰∫âÂèØËÉΩÂØºËá¥Âª∂Ëøü</td>
<td>Â§öËäÇÁÇπÂàÜÂ∏ÉÂºèÁ≥ªÁªüÔºåÂº∫Ë∞É‰∏ÄËá¥ÊÄß</td>
</tr>
<tr>
<td><strong>RabbitMQ Ê∂àÊÅØÈòüÂàó</strong></td>
<td>ÈÄöËøáÊ∂àÊÅØÈòüÂàóÂºÇÊ≠•Â§ÑÁêÜÁßíÊùÄËØ∑Ê±ÇÔºåÂø´ÈÄüÂìçÂ∫îÁî®Êà∑ÔºåÁºìËß£Êï∞ÊçÆÂ∫ìÂéãÂäõ„ÄÇ</td>
<td>Redis Ê£ÄÊü•Â∫ìÂ≠òÔºåÊàêÂäüÂêéÂ∞ÜËÆ¢ÂçïÊ∂àÊÅØÂèëÈÄÅÂà∞ RabbitMQÔºåÂêéÂè∞Ê∂àË¥πËÄÖÂºÇÊ≠•ÂÜôÂÖ•Êï∞ÊçÆÂ∫ìÔºàÂ¶Ç MongoDBÔºâ„ÄÇ</td>
<td>1. È´òÂêûÂêêÈáèÔºåÂºÇÊ≠•Ëß£ËÄ¶<br>2. Âø´ÈÄüÂìçÂ∫îÁî®Êà∑<br>3. ÁºìÂÜ≤Â≥∞ÂÄºÊµÅÈáèÔºå‰øùÊä§Êï∞ÊçÆÂ∫ì</td>
<td>1. ÊúÄÁªà‰∏ÄËá¥ÊÄßÔºåÂª∂ËøüÂèØËÉΩÂΩ±Âìç‰ΩìÈ™å<br>2. Á≥ªÁªüÂ§çÊùÇÊÄßÂ¢ûÂä†<br>3. RabbitMQ ÊïÖÈöúÈúÄÂÆπÈîôÊú∫Âà∂</td>
<td>È´òÂπ∂ÂèëÂú∫ÊôØÔºåÈúÄÂø´ÈÄüÂìçÂ∫î</td>
</tr>
<tr>
<td><strong>Redis ËÆ°Êï∞ + MongoDB ÂºÇÊ≠•ÊåÅ‰πÖÂåñ</strong></td>
<td>‰ΩøÁî® Redis ÂéüÂ≠êËÆ°Êï∞Âø´ÈÄüÊâ£ÂáèÂ∫ìÂ≠òÔºåMongoDB ÂºÇÊ≠•ÊåÅ‰πÖÂåñËÆ¢ÂçïÔºåÊèêÂçáÊÄßËÉΩ„ÄÇ</td>
<td>Redis <code>DECR</code> Êâ£ÂáèÂ∫ìÂ≠òÔºåËÆ¢ÂçïÊï∞ÊçÆÈÄöËøáÊ∂àÊÅØÈòüÂàóÔºàÂ¶Ç RabbitMQ&#x2F;KafkaÔºâÂºÇÊ≠•ÂÜôÂÖ• MongoDB„ÄÇ</td>
<td>1. ÊûÅÈ´òÊÄßËÉΩÔºàRedis ÂæÆÁßíÁ∫ßÂìçÂ∫îÔºâ<br>2. ÂºÇÊ≠•Ëß£ËÄ¶ÔºåÂêûÂêêÈáèÈ´ò<br>3. Â∫ìÂ≠ò‰∏ÄËá¥ÊÄßÂº∫ÔºåÈò≤Ë∂ÖÂçñ</td>
<td>1. ÊúÄÁªà‰∏ÄËá¥ÊÄßÈúÄ‰∏öÂä°ÂÆπÂøç<br>2. Êû∂ÊûÑÂ§çÊùÇÔºå‰æùËµñÂ§öÁªÑ‰ª∂<br>3. Redis ÊïÖÈöúÂèØËÉΩ‰∏¢Â§±Â∫ìÂ≠òÊï∞ÊçÆ</td>
<td>È´òÂπ∂Âèë„ÄÅÂàÜÂ∏ÉÂºèÁ≥ªÁªüÔºåËøΩÊ±ÇÊûÅËá¥ÊÄßËÉΩ</td>
</tr>
</tbody></table>
<h2 id="2-Âü∫‰∫é-Nacos-ÂÆûÁé∞Áªü‰∏ÄÈÖçÁΩÆ‰∏≠ÂøÉÁÆ°ÁêÜÔºõ‰ΩøÁî®-OpenFeign-ÂÆûÁé∞ÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®ÂíåÊúçÂä°ÁÜîÊñ≠ÔºåÂπ∂ËÆæËÆ°Áõ∏Â∫îÁöÑÊúçÂä°ÈôçÁ∫ßÈÄªËæëÂ§ÑÁêÜÔºõ‰ΩøÁî®-Gateway-ÊûÑÂª∫ÂæÆÊúçÂä°-API-ÁΩëÂÖ≥ÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±„ÄÅÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞‰∏éÁªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ"><a href="#2-Âü∫‰∫é-Nacos-ÂÆûÁé∞Áªü‰∏ÄÈÖçÁΩÆ‰∏≠ÂøÉÁÆ°ÁêÜÔºõ‰ΩøÁî®-OpenFeign-ÂÆûÁé∞ÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®ÂíåÊúçÂä°ÁÜîÊñ≠ÔºåÂπ∂ËÆæËÆ°Áõ∏Â∫îÁöÑÊúçÂä°ÈôçÁ∫ßÈÄªËæëÂ§ÑÁêÜÔºõ‰ΩøÁî®-Gateway-ÊûÑÂª∫ÂæÆÊúçÂä°-API-ÁΩëÂÖ≥ÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±„ÄÅÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞‰∏éÁªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ" class="headerlink" title="2. Âü∫‰∫é Nacos ÂÆûÁé∞Áªü‰∏ÄÈÖçÁΩÆ‰∏≠ÂøÉÁÆ°ÁêÜÔºõ‰ΩøÁî® OpenFeign ÂÆûÁé∞ÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®ÂíåÊúçÂä°ÁÜîÊñ≠ÔºåÂπ∂ËÆæËÆ°Áõ∏Â∫îÁöÑÊúçÂä°ÈôçÁ∫ßÈÄªËæëÂ§ÑÁêÜÔºõ‰ΩøÁî® Gateway ÊûÑÂª∫ÂæÆÊúçÂä° API ÁΩëÂÖ≥ÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±„ÄÅÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞‰∏éÁªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ"></a>2. Âü∫‰∫é Nacos ÂÆûÁé∞Áªü‰∏ÄÈÖçÁΩÆ‰∏≠ÂøÉÁÆ°ÁêÜÔºõ‰ΩøÁî® OpenFeign ÂÆûÁé∞ÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®ÂíåÊúçÂä°ÁÜîÊñ≠ÔºåÂπ∂ËÆæËÆ°Áõ∏Â∫îÁöÑÊúçÂä°ÈôçÁ∫ßÈÄªËæëÂ§ÑÁêÜÔºõ‰ΩøÁî® Gateway ÊûÑÂª∫ÂæÆÊúçÂä° API ÁΩëÂÖ≥ÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±„ÄÅÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞‰∏éÁªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ</h2><h3 id="2-1-Âü∫‰∫é-Nacos-ÂÆûÁé∞Áªü‰∏ÄÈÖçÁΩÆ‰∏≠ÂøÉÁÆ°ÁêÜ"><a href="#2-1-Âü∫‰∫é-Nacos-ÂÆûÁé∞Áªü‰∏ÄÈÖçÁΩÆ‰∏≠ÂøÉÁÆ°ÁêÜ" class="headerlink" title="2.1 Âü∫‰∫é Nacos ÂÆûÁé∞Áªü‰∏ÄÈÖçÁΩÆ‰∏≠ÂøÉÁÆ°ÁêÜ"></a>2.1 Âü∫‰∫é Nacos ÂÆûÁé∞Áªü‰∏ÄÈÖçÁΩÆ‰∏≠ÂøÉÁÆ°ÁêÜ</h3><p>Nacos ‰Ωú‰∏∫ÈÖçÁΩÆ‰∏≠ÂøÉÂíåÊúçÂä°Ê≥®ÂÜå‰∏≠ÂøÉÔºåÂú® GoodsKill È°πÁõÆ‰∏≠Áî®‰∫éÈõÜ‰∏≠ÁÆ°ÁêÜÂæÆÊúçÂä°ÁöÑÈÖçÁΩÆÔºàÂ¶ÇÊï∞ÊçÆÂ∫ìËøûÊé•„ÄÅÊ∂àÊÅØÈòüÂàóÂèÇÊï∞Á≠âÔºâÔºåÂπ∂ÊîØÊåÅÈÖçÁΩÆÁöÑÂä®ÊÄÅÂà∑Êñ∞„ÄÇ</p>
<ol>
<li>‰æùËµñÂºïÂÖ•Ôºö Âú® pom.xml ‰∏≠ÂºïÂÖ• Nacos ÈÖçÁΩÆÁÆ°ÁêÜÁöÑ‰æùËµñ</li>
<li>ÈÖçÁΩÆÊñá‰ª∂Ôºö Âú® bootstrap.ymlÔºà‰ºòÂÖà‰∫é application.yml Âä†ËΩΩÔºâ‰∏≠ÈÖçÁΩÆ Nacos Âú∞ÂùÄÂíåÈÖçÁΩÆ‰ø°ÊÅØ</li>
<li>ÈÖçÁΩÆ Nacos ÁÆ°ÁêÜÁïåÈù¢Ôºö Âú® Nacos ÊéßÂà∂Âè∞ÂàõÂª∫ÈÖçÁΩÆÊñá‰ª∂</li>
<li>ÊúçÂä°ÂêØÂä®Ôºö ÂêØÂä®ÊúçÂä°Êó∂ÔºåSpring Boot ‰ºö‰ªé Nacos ÊãâÂèñÈÖçÁΩÆÔºåË¶ÜÁõñÊú¨Âú∞ application.ymlÔºåÂπ∂Ê≥®ÂÜåÊúçÂä°Âà∞ Nacos„ÄÇ</li>
</ol>
<h3 id="2-2-‰ΩøÁî®-OpenFeign-ÂÆûÁé∞ÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®ÂíåÊúçÂä°ÁÜîÊñ≠ÔºåÂπ∂ËÆæËÆ°ÊúçÂä°ÈôçÁ∫ßÈÄªËæëÂ§ÑÁêÜ"><a href="#2-2-‰ΩøÁî®-OpenFeign-ÂÆûÁé∞ÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®ÂíåÊúçÂä°ÁÜîÊñ≠ÔºåÂπ∂ËÆæËÆ°ÊúçÂä°ÈôçÁ∫ßÈÄªËæëÂ§ÑÁêÜ" class="headerlink" title="2.2 ‰ΩøÁî® OpenFeign ÂÆûÁé∞ÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®ÂíåÊúçÂä°ÁÜîÊñ≠ÔºåÂπ∂ËÆæËÆ°ÊúçÂä°ÈôçÁ∫ßÈÄªËæëÂ§ÑÁêÜ"></a>2.2 ‰ΩøÁî® OpenFeign ÂÆûÁé∞ÂæÆÊúçÂä°‰πãÈó¥ÁöÑËøúÁ®ãË∞ÉÁî®ÂíåÊúçÂä°ÁÜîÊñ≠ÔºåÂπ∂ËÆæËÆ°ÊúçÂä°ÈôçÁ∫ßÈÄªËæëÂ§ÑÁêÜ</h3><p><a href="#131-goodskill-order-provider">Ë∑≥ËΩ¨Âà∞OrderService</a></p>
<p><strong>OrderService</strong><br><code>package com.goodskill.order.api</code></p>
<p>Âü∫‰∫é Spring Cloud OpenFeign ÂÆûÁé∞ÁöÑ <strong>ËÆ¢ÂçïÂæÆÊúçÂä° (goodskill-order) ËøúÁ®ãË∞ÉÁî®Êé•Âè£</strong>ÔºåÂπ∂Êèê‰æõ‰∫Ü ÁÜîÊñ≠ÈôçÁ∫ßÂ§ÑÁêÜ„ÄÇ</p>
<ul>
<li>‰ΩøÁî®Spring Cloud Alibaba Êèê‰æõ‰∫Ü <strong>Sentinel Êù•ÂÅöÊúçÂä°ÁÜîÊñ≠„ÄÅÈôêÊµÅ„ÄÅÈôçÁ∫ß„ÄÇ</strong></li>
</ul>
<ol>
<li>Ê∑ªÂä†‰æùËµñ</li>
<li>Feign ÂÆ¢Êà∑Á´ØÂºÄÂêØÈôçÁ∫ßÊîØÊåÅ</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">sentinel:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>ÁºñÂÜôÊé•Âè£Âíå fallback Á±ª</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(name = &quot;goodskill-order&quot;, fallback = OrderServiceFallback.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/count&quot;)</span><br>    <span class="hljs-type">long</span> <span class="hljs-title function_">count</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;seckillId&quot;)</span> <span class="hljs-type">long</span> seckillId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-‰ΩøÁî®-Gateway-ÊûÑÂª∫ÂæÆÊúçÂä°-API-ÁΩëÂÖ≥ÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±„ÄÅÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞‰∏éÁªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ"><a href="#2-3-‰ΩøÁî®-Gateway-ÊûÑÂª∫ÂæÆÊúçÂä°-API-ÁΩëÂÖ≥ÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±„ÄÅÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞‰∏éÁªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ" class="headerlink" title="2.3 ‰ΩøÁî® Gateway ÊûÑÂª∫ÂæÆÊúçÂä° API ÁΩëÂÖ≥ÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±„ÄÅÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞‰∏éÁªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ"></a>2.3 ‰ΩøÁî® Gateway ÊûÑÂª∫ÂæÆÊúçÂä° API ÁΩëÂÖ≥ÔºåÊîØÊåÅÂä®ÊÄÅË∑ØÁî±„ÄÅÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞‰∏éÁªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ</h3><p><a href="#10-goodskill-gateway-%E5%BE%AE%E6%9C%8D%E5%8A%A1api%E7%BD%91%E5%85%B3%E7%BB%9F%E4%B8%80%E6%9C%8D%E5%8A%A1%E9%89%B4%E6%9D%83%E6%94%AF%E6%8C%81%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8A%A0%E8%BD%BD">Ë∑≥ËΩ¨Âà∞goodskill-gatewayÂæÆÊúçÂä°ÁΩëÂÖ≥API</a></p>
<p><a href="#135-goodskill-gateway">Ë∑≥ËΩ¨Âà∞goodskill-gatewayËß£Êûê</a></p>
<h4 id="2-3-1-Âä®ÊÄÅË∑ØÁî±ÊîØÊåÅÔºàÂü∫‰∫é-NacosÔºâ"><a href="#2-3-1-Âä®ÊÄÅË∑ØÁî±ÊîØÊåÅÔºàÂü∫‰∫é-NacosÔºâ" class="headerlink" title="2.3.1 Âä®ÊÄÅË∑ØÁî±ÊîØÊåÅÔºàÂü∫‰∫é NacosÔºâ"></a>2.3.1 Âä®ÊÄÅË∑ØÁî±ÊîØÊåÅÔºàÂü∫‰∫é NacosÔºâ</h4><p><strong>ÂÆûÁé∞ÂéüÁêÜÔºö</strong><br>ÈÄöËøá <code>DynamicRouteConfigWatcher</code> + <code>DynamicRouteRefresh</code> ÂÆûÁé∞Ôºö</p>
<h5 id="DynamicRouteConfigWatcher-1"><a href="#DynamicRouteConfigWatcher-1" class="headerlink" title="DynamicRouteConfigWatcher"></a><code>DynamicRouteConfigWatcher</code></h5><ul>
<li><p><strong>ÂàùÂßãÂåñÈò∂ÊÆµÔºà@PostConstructÔºâ</strong>Ôºö</p>
<ul>
<li>ÈÄöËøá <code>initConfigService()</code> ËøûÊé•Âà∞ Nacos ÈÖçÁΩÆ‰∏≠ÂøÉ„ÄÇ</li>
<li>Ê≥®ÂÜåÁõëÂê¨Âô®ÁõëÂê¨Âä®ÊÄÅË∑ØÁî±ÈÖçÁΩÆÔºà<code>dataId</code> + <code>group</code>Ôºâ„ÄÇ</li>
<li>ÂêØÂä®Êó∂‰ªé Nacos ÊãâÂèñÂΩìÂâçÁΩëÂÖ≥Ë∑ØÁî±ÈÖçÁΩÆÔºåÈÄöËøá <code>run()</code> ÊñπÊ≥ïÊ≥®ÂÖ•Âà∞ÁΩëÂÖ≥‰∏≠„ÄÇ</li>
</ul>
</li>
<li><p><strong>ÁõëÂê¨ÈÖçÁΩÆÂèòÂåñ</strong>Ôºö</p>
<ul>
<li>ÂΩìÈÖçÁΩÆÂèòÊõ¥Êó∂Ëß¶Âèë <code>receiveConfigInfo()</code> ÊñπÊ≥ïÔºåÂ∞ÜÂèòÊõ¥ÁöÑË∑ØÁî±ÈÖçÁΩÆËß£Êûê‰∏∫ <code>RouteDefinition</code> ÂàóË°®ÔºåË∞ÉÁî® <code>dynamicRouteService.updateList(...)</code> Êõ¥Êñ∞ÁΩëÂÖ≥Ë∑ØÁî±„ÄÇ</li>
</ul>
</li>
</ul>
<h5 id="DynamicRouteRefresh-1"><a href="#DynamicRouteRefresh-1" class="headerlink" title="DynamicRouteRefresh"></a><code>DynamicRouteRefresh</code></h5><ul>
<li>Êèê‰æõ <code>save()</code>„ÄÅ<code>delete()</code>„ÄÅ<code>updateList()</code> ÊñπÊ≥ïÂØπÁΩëÂÖ≥Ë∑ØÁî±ËøõË°åÂä®ÊÄÅÁª¥Êä§„ÄÇ</li>
<li>ÊØèÊ¨°Êìç‰ΩúÈÉΩ‰ºöÈÄöËøá <code>ApplicationEventPublisher</code> ÂèëÂ∏É <code>RefreshRoutesEvent</code>Ôºå<strong>ÂÆûÊó∂Âà∑Êñ∞ÁΩëÂÖ≥Ë∑ØÁî±</strong>„ÄÇ</li>
</ul>
<h4 id="2-3-2-ÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞Ôºà‰æùËµñ-NacosÔºâ"><a href="#2-3-2-ÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞Ôºà‰æùËµñ-NacosÔºâ" class="headerlink" title="2.3.2 ÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞Ôºà‰æùËµñ NacosÔºâ"></a>2.3.2 ÈÖçÁΩÆÁÉ≠Êõ¥Êñ∞Ôºà‰æùËµñ NacosÔºâ</h4><ul>
<li>‰ΩøÁî® Nacos ÁÆ°ÁêÜÊâÄÊúâË∑ØÁî±ËßÑÂàôÔºåÈÄöËøáÁõëÂê¨Êú∫Âà∂Ôºà<code>Listener</code> Êé•Âè£ÔºâËá™Âä®ÊÑüÁü•ÈÖçÁΩÆÂèòÂä®„ÄÇ</li>
<li>‰∏ÄÊó¶ÁõëÂê¨Âà∞ÈÖçÁΩÆÊõ¥Êñ∞ÔºåÁ´ãÂàªÂà∑Êñ∞ÁΩëÂÖ≥Ë∑ØÁî±Ë°®ÔºàÊó†ÈúÄÈáçÂêØÊúçÂä°Ôºâ„ÄÇ</li>
<li>Âä®ÊÄÅÂä†ËΩΩÁöÑÊï∞ÊçÆÊ†ºÂºèÊòØÊ†áÂáÜÁöÑ <code>RouteDefinition</code> JSON Êï∞ÁªÑÔºåÂ¶ÇÔºö</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;route1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;uri&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lb://goodskill-order&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;predicates&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Path&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;_genkey_0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/api/order/**&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;filters&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;StripPrefix&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;_genkey_0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>

<h4 id="2-3-3-Áªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ‰∏éÊùÉÈôêÊéßÂà∂ÔºàÂü∫‰∫é-Sa-TokenÔºâ"><a href="#2-3-3-Áªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ‰∏éÊùÉÈôêÊéßÂà∂ÔºàÂü∫‰∫é-Sa-TokenÔºâ" class="headerlink" title="2.3.3. Áªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ‰∏éÊùÉÈôêÊéßÂà∂ÔºàÂü∫‰∫é Sa-TokenÔºâ"></a>2.3.3. Áªü‰∏ÄË∫´‰ªΩËÆ§ËØÅ‰∏éÊùÉÈôêÊéßÂà∂ÔºàÂü∫‰∫é Sa-TokenÔºâ</h4><h5 id="SaTokenConfigurationÔºàÊ≥®ÂÜåÂÖ®Â±ÄËÆ§ËØÅËøáÊª§Âô®Ôºâ"><a href="#SaTokenConfigurationÔºàÊ≥®ÂÜåÂÖ®Â±ÄËÆ§ËØÅËøáÊª§Âô®Ôºâ" class="headerlink" title="SaTokenConfigurationÔºàÊ≥®ÂÜåÂÖ®Â±ÄËÆ§ËØÅËøáÊª§Âô®Ôºâ"></a>SaTokenConfigurationÔºàÊ≥®ÂÜåÂÖ®Â±ÄËÆ§ËØÅËøáÊª§Âô®Ôºâ</h5><ul>
<li>Ê≥®ÂÜåÂÖ®Â±ÄËÆ§ËØÅËøáÊª§Âô® <code>SaReactorFilter</code>ÔºåÂú®ËØ∑Ê±ÇËøõÂÖ•ÂæÆÊúçÂä°ÂâçËøõË°åÁªü‰∏ÄË∫´‰ªΩÊ†°È™åÔºö<ul>
<li>ÂØπÊâÄÊúâË∑ØÂæÑ <code>/**</code> ËøõË°åÊã¶Êà™Ôºõ</li>
<li>ÁôΩÂêçÂçïÔºàÂ¶Ç <code>/favicon.ico</code>„ÄÅ<code>/actuator/**</code>ÔºâÊîæË°åÔºõ</li>
<li>Âà§Êñ≠ÊòØÂê¶ÁôªÂΩïÔºà<code>StpUtil.checkLogin()</code>ÔºâÔºõ</li>
<li>ÊîØÊåÅÁôªÂΩïÁî®Êà∑ÁôΩÂêçÂçïÔºàÊîæË°åÊüê‰∫õ‰∏çÈúÄÊùÉÈôêÁöÑÊé•Âè£ÔºâÔºõ</li>
<li>ÊùÉÈôêÊéßÂà∂È¢ÑÁïôÊé•Âè£ÔºàÂèØÂêØÁî® <code>StpUtil.checkPermission()</code> ÂÆûÁé∞Êõ¥Á≤æÁªÜÁöÑÊùÉÈôêÊéßÂà∂ÔºâÔºõ</li>
<li>ÊâÄÊúâÂºÇÂ∏∏Áªü‰∏ÄÊçïËé∑Âπ∂Ê†ºÂºèÂåñËøîÂõûÔºàÈÄöËøá <code>.setError(...)</code> ÂÆûÁé∞Ôºâ„ÄÇ</li>
</ul>
</li>
</ul>
<h5 id="StpInterfaceImplÔºàÊùÉÈôêÂíåËßíËâ≤Âä®ÊÄÅÂä†ËΩΩÔºâ"><a href="#StpInterfaceImplÔºàÊùÉÈôêÂíåËßíËâ≤Âä®ÊÄÅÂä†ËΩΩÔºâ" class="headerlink" title="StpInterfaceImplÔºàÊùÉÈôêÂíåËßíËâ≤Âä®ÊÄÅÂä†ËΩΩÔºâ"></a>StpInterfaceImplÔºàÊùÉÈôêÂíåËßíËâ≤Âä®ÊÄÅÂä†ËΩΩÔºâ</h5><ul>
<li>ÂÆûÁé∞ <code>StpInterface</code> Êé•Âè£Ôºö<ul>
<li>ÈÄöËøá Feign ÂÆ¢Êà∑Á´ØË∞ÉÁî® <code>goodskill-auth</code> ÊúçÂä°ËøúÁ®ãÂä†ËΩΩÁî®Êà∑ÁöÑÊùÉÈôêÁ†Å„ÄÅËßíËâ≤ÂàóË°®„ÄÇ</li>
<li>ÂºÇÊ≠•ÊâßË°åÔºà<code>CompletableFuture</code>ÔºâÔºåÊèêÂçáË∞ÉÁî®ÊïàÁéá„ÄÇ</li>
</ul>
</li>
</ul>
<hr>
<h4 id="2-3-4-Ë∑ØÁî±ÂÆö‰πâÈÖçÁΩÆÔºàGatewayConfigurationÔºâ"><a href="#2-3-4-Ë∑ØÁî±ÂÆö‰πâÈÖçÁΩÆÔºàGatewayConfigurationÔºâ" class="headerlink" title="2.3.4. Ë∑ØÁî±ÂÆö‰πâÈÖçÁΩÆÔºàGatewayConfigurationÔºâ"></a>2.3.4. Ë∑ØÁî±ÂÆö‰πâÈÖçÁΩÆÔºàGatewayConfigurationÔºâ</h4><ul>
<li>Âú®ÈùôÊÄÅÊ®°Âºè‰∏ãÂÆö‰πâÈªòËÆ§Ë∑ØÁî±ËΩ¨ÂèëËßÑÂàôÔºà‰æãÂ¶ÇÔºö<code>/api/order/** ‚Üí lb://goodskill-order</code>ÔºâÔºåÁî®‰∫éÂÖúÂ∫ïÊàñÊú™ÈÖçÁΩÆÂä®ÊÄÅË∑ØÁî±Êó∂‰ΩøÁî®„ÄÇ</li>
<li>ÊîØÊåÅ <code>stripPrefix</code> ÂäüËÉΩÔºåÂâ•Á¶ª <code>/api</code> ÂâçÁºÄÔºåÁ°Æ‰øùÂÜÖÈÉ®ÊúçÂä° URL Ê≠£Á°ÆÊò†Â∞Ñ„ÄÇ</li>
</ul>
<h4 id="ÊÄªÁªìÔºöGateway-‰∏ªË¶ÅËÉΩÂäõ"><a href="#ÊÄªÁªìÔºöGateway-‰∏ªË¶ÅËÉΩÂäõ" class="headerlink" title="ÊÄªÁªìÔºöGateway ‰∏ªË¶ÅËÉΩÂäõ"></a>ÊÄªÁªìÔºöGateway ‰∏ªË¶ÅËÉΩÂäõ</h4><table>
<thead>
<tr>
<th>ËÉΩÂäõ</th>
<th>ÂÆûÁé∞Êú∫Âà∂</th>
</tr>
</thead>
<tbody><tr>
<td>Âä®ÊÄÅË∑ØÁî±</td>
<td>Nacos + <code>DynamicRouteConfigWatcher</code> + <code>DynamicRouteRefresh</code></td>
</tr>
<tr>
<td>Ë∑ØÁî±ÁÉ≠Êõ¥Êñ∞</td>
<td>ÁõëÂê¨ Nacos ÈÖçÁΩÆÂèòÂåñÔºåÂÆûÊó∂Âà∑Êñ∞Ë∑ØÁî±</td>
</tr>
<tr>
<td>ÊúçÂä°ÂèëÁé∞‰∏éËΩ¨Âèë</td>
<td><code>lb://</code> URI + Spring Cloud Gateway</td>
</tr>
<tr>
<td>Ë∑ØÁî±ÂâçÁºÄÂâ•Á¶ª</td>
<td><code>stripPrefix</code> ËøáÊª§Âô®</td>
</tr>
<tr>
<td>ÁôªÂΩïËÆ§ËØÅ</td>
<td>Sa-Token ÂÖ®Â±ÄËøáÊª§Âô® <code>SaReactorFilter</code></td>
</tr>
<tr>
<td>ÊùÉÈôê‰∏éËßíËâ≤ÊéßÂà∂</td>
<td>Ëá™ÂÆö‰πâ <code>StpInterfaceImpl</code> Êé•Âè£</td>
</tr>
<tr>
<td>Áªü‰∏ÄÂºÇÂ∏∏Â§ÑÁêÜ</td>
<td><code>.setError()</code> ËøîÂõûÊ†áÂáÜÈîôËØØÂìçÂ∫îÁªìÊûÑ</td>
</tr>
<tr>
<td>ÁôΩÂêçÂçïÊú∫Âà∂</td>
<td>ÊîØÊåÅÂÖ®Â±Ä‰∏éÁôªÂΩïÁî®Êà∑Á∫ßÁôΩÂêçÂçï</td>
</tr>
</tbody></table>
<h2 id="3-Âü∫‰∫éË¥£‰ªªÈìæÊ®°ÂºèÁöÑÈ¢ÑÂ§ÑÁêÜÂô®Êú∫Âà∂ÔºåÂú®ÁßíÊùÄÂâçÂØπÊï∞ÊçÆÂ∫ì„ÄÅÁºìÂ≠ò„ÄÅÁä∂ÊÄÅÊú∫Á≠âËøõË°åÂàùÂßãÂåñÈ¢ÑÂ§ÑÁêÜ"><a href="#3-Âü∫‰∫éË¥£‰ªªÈìæÊ®°ÂºèÁöÑÈ¢ÑÂ§ÑÁêÜÂô®Êú∫Âà∂ÔºåÂú®ÁßíÊùÄÂâçÂØπÊï∞ÊçÆÂ∫ì„ÄÅÁºìÂ≠ò„ÄÅÁä∂ÊÄÅÊú∫Á≠âËøõË°åÂàùÂßãÂåñÈ¢ÑÂ§ÑÁêÜ" class="headerlink" title="3. Âü∫‰∫éË¥£‰ªªÈìæÊ®°ÂºèÁöÑÈ¢ÑÂ§ÑÁêÜÂô®Êú∫Âà∂ÔºåÂú®ÁßíÊùÄÂâçÂØπÊï∞ÊçÆÂ∫ì„ÄÅÁºìÂ≠ò„ÄÅÁä∂ÊÄÅÊú∫Á≠âËøõË°åÂàùÂßãÂåñÈ¢ÑÂ§ÑÁêÜ"></a>3. Âü∫‰∫éË¥£‰ªªÈìæÊ®°ÂºèÁöÑÈ¢ÑÂ§ÑÁêÜÂô®Êú∫Âà∂ÔºåÂú®ÁßíÊùÄÂâçÂØπÊï∞ÊçÆÂ∫ì„ÄÅÁºìÂ≠ò„ÄÅÁä∂ÊÄÅÊú∫Á≠âËøõË°åÂàùÂßãÂåñÈ¢ÑÂ§ÑÁêÜ</h2><p><a href="#326-handler%E5%8C%85">Ë∑≥ËΩ¨Âà∞handlerÂåÖ</a></p>
<p>ÈÄöËøáÂÆö‰πâ <code>PreRequestHandler</code> Êé•Âè£ÂèäÂÖ∂ÊäΩË±°ÂÆûÁé∞ <code>AbstractPreRequestHandler</code>, Â∞Ü‚ÄúÁßíÊùÄÊ¥ªÂä®ÂàùÂßãÂåñ‚ÄùËøáÁ®ãÊãÜËß£‰∏∫Â§ö‰∏™Áã¨Á´ãÊ≠•È™§ÔºåÂ¶ÇÊï∞ÊçÆÂ∫ìÂàùÂßãÂåñ„ÄÅRedis ÁºìÂ≠òÊ∏ÖÁêÜ„ÄÅÁä∂ÊÄÅÊú∫ÂêØÂä®„ÄÅMongo Êï∞ÊçÆÊ∏ÖÈô§Á≠â</p>
<ul>
<li>PreRequestHandlerÔºöÊé•Âè£</li>
<li>PreRequestPipeline</li>
<li>AbstractPreRequestHandler ÔºõÊäΩË±°Á±ª</li>
</ul>
<h3 id="3-1-Handler-ÊµÅÁ®ãÁöÑÊâßË°åÈ°∫Â∫èÔºü"><a href="#3-1-Handler-ÊµÅÁ®ãÁöÑÊâßË°åÈ°∫Â∫èÔºü" class="headerlink" title="3.1 Handler ÊµÅÁ®ãÁöÑÊâßË°åÈ°∫Â∫èÔºü"></a>3.1 Handler ÊµÅÁ®ãÁöÑÊâßË°åÈ°∫Â∫èÔºü</h3><p>ÊâßË°åÈ°∫Â∫èÔºö</p>
<ol>
<li>DatabasePreRequestHandler</li>
<li>RedisPreRequestHandler</li>
<li>StateMachinePreRequestHandler</li>
<li>MongoPreRequestHandler</li>
</ol>
<table>
<thead>
<tr>
<th>È°∫Â∫è</th>
<th>Handler ÂêçÁß∞</th>
<th>‰∏ªË¶Å‰ΩúÁî®</th>
</tr>
</thead>
<tbody><tr>
<td><code>0</code></td>
<td><strong>DatabasePreRequestHandler</strong></td>
<td>ÈáçÁΩÆÊï∞ÊçÆÂ∫ì‰∏≠ÊåáÂÆöÁßíÊùÄÂïÜÂìÅÁöÑÂ∫ìÂ≠ò„ÄÅÊ∏ÖÁêÜÊàêÂäüÁßíÊùÄËÆ∞ÂΩï</td>
</tr>
<tr>
<td><code>1</code></td>
<td><strong>RedisPreRequestHandler</strong></td>
<td>Ê∏ÖÁ©∫ Redis ‰∏≠Áõ∏ÂÖ≥ÁºìÂ≠ò„ÄÅËÆæÁΩÆÂïÜÂìÅÁä∂ÊÄÅ‰∏∫‚ÄúËøõË°å‰∏≠‚Äù</td>
</tr>
<tr>
<td><code>2</code></td>
<td><strong>StateMachinePreRequestHandler</strong></td>
<td>ÂàùÂßãÂåñÁä∂ÊÄÅÊú∫ÔºåËß¶ÂèëÁä∂ÊÄÅÂèòÊõ¥ÔºàÈáçÁΩÆ ‚Üí ÂºÄÂßãÔºâ</td>
</tr>
<tr>
<td><code>3</code></td>
<td><strong>MongoPreRequestHandler</strong></td>
<td>Âà†Èô§ MongoDB ‰∏≠ÂéÜÂè≤ËÆ¢ÂçïÊï∞ÊçÆ</td>
</tr>
</tbody></table>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs text">                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê<br>                            ‚îÇ     PreRequestPipeline     ‚îÇ<br>                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò<br>                                         ‚îÇ<br>                             ‰æùÈ°∫Â∫èË∞ÉÁî® handle()<br>                                         ‚ñº<br>        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê<br>        ‚ñº              ‚ñº                ‚ñº              ‚ñº                    ‚ñº<br>DatabaseHandler ‚Üí RedisHandler ‚Üí StateMachineHandler ‚Üí MongoHandler ‚Üí ÁßíÊùÄ‰∏ªÈÄªËæëÂºÄÂßã<br>(ÈáçÁΩÆÂ∫ìÂ≠ò)     (Ê∏ÖÁêÜÁºìÂ≠ò)      (Áä∂ÊÄÅÊµÅËΩ¨)         (Ê∏ÖÁêÜMongo)         ÔºàÊâßË°åÂéãÊµã/ËØ∑Ê±ÇÔºâ<br></code></pre></td></tr></table></figure>


<h3 id="3-2-Âú®È´òÂπ∂Âèë‰∏ãÂ¶Ç‰ΩïÁ°Æ‰øùËøô‰∫õ-Handlers-ÁöÑÈ°∫Â∫èÊÄßÔºü"><a href="#3-2-Âú®È´òÂπ∂Âèë‰∏ãÂ¶Ç‰ΩïÁ°Æ‰øùËøô‰∫õ-Handlers-ÁöÑÈ°∫Â∫èÊÄßÔºü" class="headerlink" title="3.2 Âú®È´òÂπ∂Âèë‰∏ãÂ¶Ç‰ΩïÁ°Æ‰øùËøô‰∫õ Handlers ÁöÑÈ°∫Â∫èÊÄßÔºü"></a>3.2 Âú®È´òÂπ∂Âèë‰∏ãÂ¶Ç‰ΩïÁ°Æ‰øùËøô‰∫õ Handlers ÁöÑÈ°∫Â∫èÊÄßÔºü</h3><ul>
<li>Ê†∏ÂøÉÊú∫Âà∂ÔºöÈ°∫Â∫èÊÄßÁî±<strong>ÂçïÁ∫øÁ®ãË∞ÉÁî®Ë¥£‰ªªÈìæ</strong>‰øùËØÅ</li>
<li>Ë¥£‰ªªÈìæÁöÑËß¶ÂèëÂÖ•Âè£ PreRequestPipeline.handle() ÊòØÂêåÊ≠•‰∏≤Ë°åË∞ÉÁî®ÁöÑ„ÄÇ</li>
<li>Á≥ªÁªüÂèØ‰ª•ÂêåÊó∂ÊúâÂ§ö‰∏™ËØ∑Ê±ÇÂπ∂ÂèëËøõÊù•ÔºåÊØè‰∏™ËØ∑Ê±ÇÂêÑËá™ÂêØÂä®‰∏ÄÊù°ÂÆåÊï¥ÁöÑÈ¢ÑÂ§ÑÁêÜÊµÅÁ®ãÔºàÂú®Ëá™Â∑±Á∫øÁ®ãÂÜÖÔºâÔºå‰ΩÜÊØèÊù°Èìæ‰∏äÁöÑ handler ÊòØÈ°∫Â∫èÊâßË°åÁöÑÔºå‰∏ç‰ºö‰π±Â∫èÊàñÂπ∂ÂèëÊâßË°å„ÄÇ</li>
</ul>
<h3 id="3-3-ÊòØÂê¶Â≠òÂú®Á∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢òÔºü"><a href="#3-3-ÊòØÂê¶Â≠òÂú®Á∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢òÔºü" class="headerlink" title="3.3 ÊòØÂê¶Â≠òÂú®Á∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢òÔºü"></a>3.3 ÊòØÂê¶Â≠òÂú®Á∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢òÔºü</h3><ul>
<li>ÊØè‰∏™ handler Á±ªÊú¨Ë∫´ÊòØ<strong>Âçï‰æãÁöÑ</strong>Ôºà@ComponentÔºâÔºå‰ΩÜ handler <strong>Âè™ËØªÂèñ</strong>ÈÖçÁΩÆÊàñ<strong>ÊâßË°åÂ§ñÈÉ®Êìç‰Ωú</strong>Ôºå<strong>‰∏ç‰æùËµñÂÖ±‰∫´ÂèØÂèòÁä∂ÊÄÅ</strong>ÔºåÂõ†Ê≠§ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ„ÄÇ</li>
</ul>
<h3 id="3-4-‰∏∫‰ªÄ‰πà‰∏ç‰ΩøÁî®ÂºÇÊ≠•ÊñπÂºèÔºüÊòØÂê¶ÂèØ‰ª•Áî®Â§öÁ∫øÁ®ãÊèêÂçáÊÄßËÉΩÔºü"><a href="#3-4-‰∏∫‰ªÄ‰πà‰∏ç‰ΩøÁî®ÂºÇÊ≠•ÊñπÂºèÔºüÊòØÂê¶ÂèØ‰ª•Áî®Â§öÁ∫øÁ®ãÊèêÂçáÊÄßËÉΩÔºü" class="headerlink" title="3.4 ‰∏∫‰ªÄ‰πà‰∏ç‰ΩøÁî®ÂºÇÊ≠•ÊñπÂºèÔºüÊòØÂê¶ÂèØ‰ª•Áî®Â§öÁ∫øÁ®ãÊèêÂçáÊÄßËÉΩÔºü"></a>3.4 ‰∏∫‰ªÄ‰πà‰∏ç‰ΩøÁî®ÂºÇÊ≠•ÊñπÂºèÔºüÊòØÂê¶ÂèØ‰ª•Áî®Â§öÁ∫øÁ®ãÊèêÂçáÊÄßËÉΩÔºü</h3><p>È¢ÑÂ§ÑÁêÜÊµÅÁ®ãÊú¨Ë¥®‰∏äÊòØ‚ÄúÂàùÂßãÂåñ + Ê†°È™å + Ê∏ÖÁêÜ‚ÄùÁöÑ‰∏≤Ë°åÊ≠•È™§ÔºåÊØîÂ¶ÇÂÖàÊ∏ÖÊï∞ÊçÆÂ∫ì„ÄÅÂÜçÊ∏Ö Redis„ÄÅÊúÄÂêéÂàùÂßãÂåñÁä∂ÊÄÅÊú∫ÔºåÈ°∫Â∫è‰∏çËÉΩ‰π±„ÄÇ<br>Â¶ÇÊûú‰Ω†Áî®ÂºÇÊ≠•ÊàñÂπ∂Ë°åÊâßË°åÔºåÂèçËÄå‰ºöÁ†¥ÂùèËøôÂ•óËØ≠‰πâÊ≠£Á°ÆÊÄßÔºåÊØîÂ¶ÇÔºö</p>
<ul>
<li>Redis ËøòÊ≤°Ê∏ÖÁêÜÂ∞±ÂêØÂä®Áä∂ÊÄÅÊú∫ÔºåÂèØËÉΩÂØºËá¥Áä∂ÊÄÅÂºÇÂ∏∏Ôºõ</li>
<li>Êï∞ÊçÆÂ∫ìËøòÊ≤°Ê∏ÖÁ©∫ÔºåMongo Ê∏ÖÁêÜ‰∫Ü‰πüÊ≤°ÊÑè‰πâÔºõ</li>
<li>Êüê‰∏™ÂºÇÂ∏∏Êú™Â§ÑÁêÜ‰ºöÊèêÂâçÁªàÊ≠¢Êï¥‰∏™ÈìæÊù°„ÄÇ</li>
</ul>
<h2 id="4-Âà©Áî®-Spring-StateMachine-ÁÆ°ÁêÜÁßíÊùÄÊ¥ªÂä®ÁîüÂëΩÂë®ÊúüÔºåÂπ∂ÈõÜÊàê-Redis-ÊåÅ‰πÖÂåñÔºåÂú®ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏≠ÂÆûÁé∞Áä∂ÊÄÅÁöÑÂÖ±‰∫´‰∏éÊÅ¢Â§ç"><a href="#4-Âà©Áî®-Spring-StateMachine-ÁÆ°ÁêÜÁßíÊùÄÊ¥ªÂä®ÁîüÂëΩÂë®ÊúüÔºåÂπ∂ÈõÜÊàê-Redis-ÊåÅ‰πÖÂåñÔºåÂú®ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏≠ÂÆûÁé∞Áä∂ÊÄÅÁöÑÂÖ±‰∫´‰∏éÊÅ¢Â§ç" class="headerlink" title="4. Âà©Áî® Spring StateMachine ÁÆ°ÁêÜÁßíÊùÄÊ¥ªÂä®ÁîüÂëΩÂë®ÊúüÔºåÂπ∂ÈõÜÊàê Redis ÊåÅ‰πÖÂåñÔºåÂú®ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏≠ÂÆûÁé∞Áä∂ÊÄÅÁöÑÂÖ±‰∫´‰∏éÊÅ¢Â§ç"></a>4. Âà©Áî® Spring StateMachine ÁÆ°ÁêÜÁßíÊùÄÊ¥ªÂä®ÁîüÂëΩÂë®ÊúüÔºåÂπ∂ÈõÜÊàê Redis ÊåÅ‰πÖÂåñÔºåÂú®ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏≠ÂÆûÁé∞Áä∂ÊÄÅÁöÑÂÖ±‰∫´‰∏éÊÅ¢Â§ç</h2><h3 id="4-1-Áä∂ÊÄÅÊú∫ÁöÑ‰ΩúÁî®ÊòØ‰ªÄ‰πàÔºü"><a href="#4-1-Áä∂ÊÄÅÊú∫ÁöÑ‰ΩúÁî®ÊòØ‰ªÄ‰πàÔºü" class="headerlink" title="4.1 Áä∂ÊÄÅÊú∫ÁöÑ‰ΩúÁî®ÊòØ‰ªÄ‰πàÔºü"></a>4.1 Áä∂ÊÄÅÊú∫ÁöÑ‰ΩúÁî®ÊòØ‰ªÄ‰πàÔºü</h3><table>
<thead>
<tr>
<th>ÈóÆÈ¢ò</th>
<th>Áä∂ÊÄÅÊú∫ÁöÑ‰ΩúÁî®</th>
</tr>
</thead>
<tbody><tr>
<td>Ê¥ªÂä®Áä∂ÊÄÅ‰∏çÂ•ΩÁÆ°ÁêÜ</td>
<td>Áî®Áä∂ÊÄÅÊú∫Áªü‰∏ÄÁÆ°ÁêÜ‚ÄúÊú™ÂºÄÂßã ‚Üí ËøõË°å‰∏≠ ‚Üí ÁªìÊùü‚ÄùÁ≠âÊµÅÁ®ã</td>
</tr>
<tr>
<td>Áä∂ÊÄÅÂÆπÊòìË¢´‰π±Êîπ</td>
<td>Áä∂ÊÄÅÂè™ËÉΩÈÄöËøá‚Äú‰∫ã‰ª∂È©±Âä®‚ÄùÂèòÊõ¥ÔºåÈÅøÂÖçÈöèÊÑè‰øÆÊîπ</td>
</tr>
<tr>
<td>Â§öÁ∫øÁ®ãÁä∂ÊÄÅÊ∑∑‰π±</td>
<td>Áä∂ÊÄÅÂèòÊõ¥ÂÖ∑Â§áÂéüÂ≠êÊÄßÂíåÁ∫øÁ®ãÂÆâÂÖ®ÔºåÈò≤Ê≠¢Âπ∂ÂèëÁä∂ÊÄÅÈîô‰π±</td>
</tr>
<tr>
<td>Êâ©Â±ïÊÄßÂº±</td>
<td>‰ΩøÁî®Áä∂ÊÄÅÊú∫Êõ¥ÊòìÊâ©Â±ïÊõ¥Â§öÊ¥ªÂä®Áä∂ÊÄÅÔºàÂ¶ÇÂèñÊ∂à„ÄÅÂ§±Ë¥•„ÄÅËÆ°ÁÆó‰∏≠Ôºâ</td>
</tr>
</tbody></table>
<h3 id="4-2-GoodsKill-‰∏≠Áä∂ÊÄÅÊú∫ÊéßÂà∂‰∫Ü‰ªÄ‰πàÔºü"><a href="#4-2-GoodsKill-‰∏≠Áä∂ÊÄÅÊú∫ÊéßÂà∂‰∫Ü‰ªÄ‰πàÔºü" class="headerlink" title="4.2 GoodsKill ‰∏≠Áä∂ÊÄÅÊú∫ÊéßÂà∂‰∫Ü‰ªÄ‰πàÔºü"></a>4.2 GoodsKill ‰∏≠Áä∂ÊÄÅÊú∫ÊéßÂà∂‰∫Ü‰ªÄ‰πàÔºü</h3><p>‰∏ªË¶ÅÊéßÂà∂ÁöÑÊòØ <strong>ÁßíÊùÄÊ¥ªÂä®ÔºàSeckillÔºâÁä∂ÊÄÅ</strong>Ôºö</p>
<h4 id="Ê¥ªÂä®Áä∂ÊÄÅÊµÅËΩ¨Á§∫ÊÑèÂõæÔºö"><a href="#Ê¥ªÂä®Áä∂ÊÄÅÊµÅËΩ¨Á§∫ÊÑèÂõæÔºö" class="headerlink" title="Ê¥ªÂä®Áä∂ÊÄÅÊµÅËΩ¨Á§∫ÊÑèÂõæÔºö"></a>Ê¥ªÂä®Áä∂ÊÄÅÊµÅËΩ¨Á§∫ÊÑèÂõæÔºö</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">INITÔºàÂàùÂßãÁä∂ÊÄÅÔºâ<br>  ‚îî‚îÄ‚îÄ<span class="hljs-selector-attr">[ACTIVITY_START]</span>‚îÄ‚îÄ‚ñ∂ IN_PROGRESSÔºàËøõË°å‰∏≠Ôºâ<br>        ‚îî‚îÄ‚îÄ<span class="hljs-selector-attr">[ACTIVITY_CALCULATE]</span>‚îÄ‚îÄ‚ñ∂ CALCULATINGÔºàËÆ°ÁÆó‰∏≠Ôºâ<br>              ‚îî‚îÄ‚îÄ<span class="hljs-selector-attr">[ACTIVITY_END]</span>‚îÄ‚îÄ‚ñ∂ ENDÔºàÂ∑≤ÁªìÊùüÔºâ<br></code></pre></td></tr></table></figure>



<h3 id="4-3-È°πÁõÆ‰∏≠Â¶Ç‰ΩïÂÆûÁé∞-Spring-StateMachineÔºü"><a href="#4-3-È°πÁõÆ‰∏≠Â¶Ç‰ΩïÂÆûÁé∞-Spring-StateMachineÔºü" class="headerlink" title="4.3 È°πÁõÆ‰∏≠Â¶Ç‰ΩïÂÆûÁé∞ Spring StateMachineÔºü"></a>4.3 È°πÁõÆ‰∏≠Â¶Ç‰ΩïÂÆûÁé∞ Spring StateMachineÔºü</h3><p>Áä∂ÊÄÅÊú∫ÁöÑÈÖçÁΩÆ‰∏ªË¶ÅÂú®Ê®°ÂùóÔºö<code>goodskill-seckill-provider</code> ‰∏≠„ÄÇ</p>
<h4 id="4-3-1-ÈÖçÁΩÆÁ±ªÔºöStateMachineConfig"><a href="#4-3-1-ÈÖçÁΩÆÁ±ªÔºöStateMachineConfig" class="headerlink" title="4.3.1 ÈÖçÁΩÆÁ±ªÔºöStateMachineConfig"></a>4.3.1 ÈÖçÁΩÆÁ±ªÔºö<code>StateMachineConfig</code></h4><p>ËØ•Á±ªÂÆö‰πâ‰∫Ü**Áä∂ÊÄÅ„ÄÅ‰∫ã‰ª∂„ÄÅÁä∂ÊÄÅËøÅÁßªËßÑÂàô„ÄÅÁõëÂê¨Âô®„ÄÅÊåÅ‰πÖÂåñÊú∫Âà∂ÔºàRedisÔºâ**Á≠âÊ†∏ÂøÉÂÜÖÂÆπ„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableStateMachineFactory</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateMachineConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StateMachineConfigurerAdapter</span>&lt;States, Events&gt; &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(StateMachineStateConfigurer&lt;States, Events&gt; states)</span> &#123;<br>        states.withStates()<br>              .initial(States.INIT)<br>              .state(States.IN_PROGRESS)<br>              .state(States.CALCULATING)<br>              .end(States.END);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(StateMachineTransitionConfigurer&lt;States, Events&gt; transitions)</span> &#123;<br>        transitions<br>            .withExternal().source(States.INIT).target(States.IN_PROGRESS).event(Events.ACTIVITY_START)<br>            .and()<br>            .withExternal().source(States.IN_PROGRESS).target(States.CALCULATING).event(Events.ACTIVITY_CALCULATE)<br>            .and()<br>            .withExternal().source(States.CALCULATING).target(States.END).event(Events.ACTIVITY_END);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="4-3-2-Áä∂ÊÄÅÊûö‰∏æ"><a href="#4-3-2-Áä∂ÊÄÅÊûö‰∏æ" class="headerlink" title="4.3.2 Áä∂ÊÄÅÊûö‰∏æ"></a>4.3.2 Áä∂ÊÄÅÊûö‰∏æ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">States</span> &#123;<br>    INIT,           <span class="hljs-comment">// ÂàùÂßã</span><br>    IN_PROGRESS,    <span class="hljs-comment">// ËøõË°å‰∏≠</span><br>    CALCULATING,    <span class="hljs-comment">// ÁªìÁÆó‰∏≠</span><br>    END             <span class="hljs-comment">// Â∑≤ÁªìÊùü</span><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Events</span> &#123;<br>    ACTIVITY_START,       <span class="hljs-comment">// ÂêØÂä®Ê¥ªÂä®</span><br>    ACTIVITY_CALCULATE,   <span class="hljs-comment">// Ê¥ªÂä®ÂÆåÊàê„ÄÅÁªüËÆ°</span><br>    ACTIVITY_END          <span class="hljs-comment">// Ê¥ªÂä®ÁªìÊùü</span><br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="4-3-3-Ë∞ÉÁî®ÊñπÂºèÔºöÈÄöËøá-StateMachineService"><a href="#4-3-3-Ë∞ÉÁî®ÊñπÂºèÔºöÈÄöËøá-StateMachineService" class="headerlink" title="4.3.3 Ë∞ÉÁî®ÊñπÂºèÔºöÈÄöËøá StateMachineService"></a>4.3.3 Ë∞ÉÁî®ÊñπÂºèÔºöÈÄöËøá <code>StateMachineService</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ÂàùÂßãÂåñÁä∂ÊÄÅÊú∫</span><br>stateMachineService.initStateMachine(seckillId);<br><br><span class="hljs-comment">// Ëß¶ÂèëÁä∂ÊÄÅÂèòÊõ¥‰∫ã‰ª∂</span><br>stateMachineService.feedMachine(Events.ACTIVITY_START, seckillId);<br></code></pre></td></tr></table></figure>

<p>ËøôÁßçÊñπÂºèÁî®Âú®Â§ö‰∏™Âú∞ÊñπÔºåÊØîÂ¶ÇÔºö</p>
<ul>
<li>ÁßíÊùÄÂâçÂáÜÂ§áÈò∂ÊÆµÔºàprepareSeckillÔºâ‚Üí ËøõÂÖ• <code>IN_PROGRESS</code></li>
<li>ÁßíÊùÄÂ∫ìÂ≠òÂîÆÁΩÑ ‚Üí ËøõÂÖ• <code>CALCULATING</code></li>
<li>ÁªìÊùüÊ∏ÖÁêÜ ‚Üí ËøõÂÖ• <code>END</code></li>
</ul>
<h4 id="4-3-4-ÈÖçÂêà-Redis-ÊåÅ‰πÖÂåñ"><a href="#4-3-4-ÈÖçÂêà-Redis-ÊåÅ‰πÖÂåñ" class="headerlink" title="4.3.4 ÈÖçÂêà Redis ÊåÅ‰πÖÂåñ"></a>4.3.4 ÈÖçÂêà Redis ÊåÅ‰πÖÂåñ</h4><p>‰ΩøÁî®‰∫Ü Spring StateMachine ÁöÑ Redis ÊåÅ‰πÖÂåñÊâ©Â±ïÔºåÂèØ‰ª•ÊääÊØè‰∏™Ê¥ªÂä®ÁöÑÁä∂ÊÄÅÂ≠òÂú® Redis ‰∏≠Ôºå‰øùËØÅÁä∂ÊÄÅÔºö</p>
<ul>
<li>ÂèØÊÅ¢Â§çÔºàÂÆπÂô®ÈáçÂêØ‰∏ç‰∏¢Â§±Ôºâ</li>
<li>ÂèØÂÖ±‰∫´ÔºàÂ§ö‰∏™ËäÇÁÇπÂÖ±‰∫´Áä∂ÊÄÅÔºâ</li>
<li>ÂèØÁõëÊéßÔºàÂèØÈÄöËøá Redis Êü•ÁúãÊ¥ªÂä®Áä∂ÊÄÅÔºâ</li>
</ul>
<h3 id="4-4-Spring-StateMachine-Â¶Ç‰ΩïÂíå-Redis-ÂÅöÊåÅ‰πÖÂåñÈõÜÊàêÔºü"><a href="#4-4-Spring-StateMachine-Â¶Ç‰ΩïÂíå-Redis-ÂÅöÊåÅ‰πÖÂåñÈõÜÊàêÔºü" class="headerlink" title="4.4 Spring StateMachine Â¶Ç‰ΩïÂíå Redis ÂÅöÊåÅ‰πÖÂåñÈõÜÊàêÔºü"></a>4.4 Spring StateMachine Â¶Ç‰ΩïÂíå Redis ÂÅöÊåÅ‰πÖÂåñÈõÜÊàêÔºü</h3><h4 id="4-4-1-‰∏∫‰ªÄ‰πàÈúÄË¶Å-Redis-ÊåÅ‰πÖÂåñÔºü"><a href="#4-4-1-‰∏∫‰ªÄ‰πàÈúÄË¶Å-Redis-ÊåÅ‰πÖÂåñÔºü" class="headerlink" title="4.4.1 ‰∏∫‰ªÄ‰πàÈúÄË¶Å Redis ÊåÅ‰πÖÂåñÔºü"></a>4.4.1 ‰∏∫‰ªÄ‰πàÈúÄË¶Å Redis ÊåÅ‰πÖÂåñÔºü</h4><p>Áä∂ÊÄÅÊú∫ÈªòËÆ§ÊòØÂÜÖÂ≠òÁä∂ÊÄÅÔºåÂ¶ÇÊûúÈ°πÁõÆÊòØ<strong>ÂàÜÂ∏ÉÂºèÈÉ®ÁΩ≤„ÄÅÂ§öËäÇÁÇπ</strong>ÔºåÊØè‰∏™ÊúçÂä°ÂÆû‰æãÁª¥Êä§Ëá™Â∑±ÁöÑÁä∂ÊÄÅÔºåÂæàÂÆπÊòìÂá∫Áé∞Áä∂ÊÄÅ‰∏ç‰∏ÄËá¥ÈóÆÈ¢ò„ÄÇ</p>
<p>‚Üí ‰ΩøÁî® Redis ‰Ωú‰∏∫ <strong>Áä∂ÊÄÅÂ≠òÂÇ®‰∏≠ÂøÉ</strong>ÔºåÂèØ‰ª•ËÆ©ÊâÄÊúâÂÆû‰æãÂÖ±‰∫´Áä∂ÊÄÅÔºåÂÆûÁé∞Ôºö</p>
<ul>
<li>Áä∂ÊÄÅÂèØÊÅ¢Â§çÔºàÊúçÂä°ÈáçÂêØ‰∏ç‰∏¢Â§±Ôºâ</li>
<li>Áä∂ÊÄÅÂÖ±‰∫´‰∏ÄËá¥</li>
<li>Áä∂ÊÄÅÂèØËßÜÂåñË∞ÉËØï</li>
</ul>
<h4 id="4-4-2-Â¶Ç‰Ωï‰ΩøÁî®RedisÂÅöÊåÅ‰πÖÂåñÁöÑÔºü"><a href="#4-4-2-Â¶Ç‰Ωï‰ΩøÁî®RedisÂÅöÊåÅ‰πÖÂåñÁöÑÔºü" class="headerlink" title="4.4.2 Â¶Ç‰Ωï‰ΩøÁî®RedisÂÅöÊåÅ‰πÖÂåñÁöÑÔºü"></a>4.4.2 Â¶Ç‰Ωï‰ΩøÁî®RedisÂÅöÊåÅ‰πÖÂåñÁöÑÔºü</h4><p>Âú®JAVA17‰∏≠ÔºåÂºïÂÖ•‰æùËµñÂ∞±ÂèØ‰ª•Áõ¥Êé•Áî®‰∫Ü</p>
<p>JAVA17ÁöÑÁ±ªÔºö <code>RedisStateMachinePersister</code></p>
<p>ÊØèÊ¨°‰ΩøÁî®Áä∂ÊÄÅÊú∫Êó∂Ôºö</p>
<ul>
<li>‰ªé Redis Âä†ËΩΩÁä∂ÊÄÅ ‚Üí redisPersister.restore(machine, seckillId.toString())</li>
<li>ÊâßË°åÁä∂ÊÄÅÊµÅËΩ¨</li>
<li>‰øùÂ≠òÊñ∞Áä∂ÊÄÅ ‚Üí redisPersister.persist(machine, seckillId.toString())</li>
</ul>
<h2 id="5-ÈõÜÊàê-ElasticSearch-ÂÆûÁé∞È´òÊïàÂïÜÂìÅÊ£ÄÁ¥¢ÔºåÊîØÊåÅÊ®°Á≥äÊêúÁ¥¢‰∏éÂÖ≥ÈîÆËØçÈ´ò‰∫ÆÔºåÊèêÂçáÁî®Êà∑Ê£ÄÁ¥¢‰ΩìÈ™å"><a href="#5-ÈõÜÊàê-ElasticSearch-ÂÆûÁé∞È´òÊïàÂïÜÂìÅÊ£ÄÁ¥¢ÔºåÊîØÊåÅÊ®°Á≥äÊêúÁ¥¢‰∏éÂÖ≥ÈîÆËØçÈ´ò‰∫ÆÔºåÊèêÂçáÁî®Êà∑Ê£ÄÁ¥¢‰ΩìÈ™å" class="headerlink" title="5. ÈõÜÊàê ElasticSearch ÂÆûÁé∞È´òÊïàÂïÜÂìÅÊ£ÄÁ¥¢ÔºåÊîØÊåÅÊ®°Á≥äÊêúÁ¥¢‰∏éÂÖ≥ÈîÆËØçÈ´ò‰∫ÆÔºåÊèêÂçáÁî®Êà∑Ê£ÄÁ¥¢‰ΩìÈ™å"></a>5. ÈõÜÊàê ElasticSearch ÂÆûÁé∞È´òÊïàÂïÜÂìÅÊ£ÄÁ¥¢ÔºåÊîØÊåÅÊ®°Á≥äÊêúÁ¥¢‰∏éÂÖ≥ÈîÆËØçÈ´ò‰∫ÆÔºåÊèêÂçáÁî®Êà∑Ê£ÄÁ¥¢‰ΩìÈ™å</h2><h3 id="5-1-Â¶Ç‰ΩïÂÆûÁé∞ÁöÑElasticSearch-ÊêúÁ¥¢Ôºü"><a href="#5-1-Â¶Ç‰ΩïÂÆûÁé∞ÁöÑElasticSearch-ÊêúÁ¥¢Ôºü" class="headerlink" title="5.1 Â¶Ç‰ΩïÂÆûÁé∞ÁöÑElasticSearch ÊêúÁ¥¢Ôºü"></a>5.1 Â¶Ç‰ΩïÂÆûÁé∞ÁöÑElasticSearch ÊêúÁ¥¢Ôºü</h3><p><code>GoodsEsServiceImpl</code></p>
<p><a href="#goodsesserviceimpl">Ë∑≥ËΩ¨Âà∞GoodsEsServiceImpl</a></p>
<ul>
<li>Elasticsearch ÈõÜÊàê: ‰ΩøÁî® Spring Data Elasticsearch ÈõÜÊàê ElasticsearchÔºåÊèê‰æõ‰∫ÜÈ´òÊïàÁöÑÂÖ®ÊñáÊêúÁ¥¢ÂíåÁ¥¢ÂºïÁÆ°ÁêÜÂäüËÉΩ</li>
<li>È´ò‰∫ÆÊêúÁ¥¢ÂäüËÉΩ: ÂÆûÁé∞ÂïÜÂìÅÂêçÁß∞ÁöÑÊ®°Á≥äÊêúÁ¥¢ÔºåÂπ∂ÂØπÂåπÈÖçÂÖ≥ÈîÆÂ≠óËøõË°åÈ´ò‰∫ÆÊòæÁ§∫</li>
</ul>
<h2 id="6-Âü∫‰∫é-Spring-AI-ÊûÑÂª∫ÁßíÊùÄAIÂØπËØùÊúçÂä°ÔºåÈÄöËøáÊµÅÂºèÂìçÂ∫îÂÆûÁé∞ÂÆûÊó∂‰∫§‰∫íÔºåÊîØÊåÅÂ§öËΩÆÂØπËØùÂíåÊô∫ËÉΩÈóÆÁ≠îËß¶ÂèëÁßíÊùÄÊìç‰Ωú"><a href="#6-Âü∫‰∫é-Spring-AI-ÊûÑÂª∫ÁßíÊùÄAIÂØπËØùÊúçÂä°ÔºåÈÄöËøáÊµÅÂºèÂìçÂ∫îÂÆûÁé∞ÂÆûÊó∂‰∫§‰∫íÔºåÊîØÊåÅÂ§öËΩÆÂØπËØùÂíåÊô∫ËÉΩÈóÆÁ≠îËß¶ÂèëÁßíÊùÄÊìç‰Ωú" class="headerlink" title="6. Âü∫‰∫é Spring AI ÊûÑÂª∫ÁßíÊùÄAIÂØπËØùÊúçÂä°ÔºåÈÄöËøáÊµÅÂºèÂìçÂ∫îÂÆûÁé∞ÂÆûÊó∂‰∫§‰∫íÔºåÊîØÊåÅÂ§öËΩÆÂØπËØùÂíåÊô∫ËÉΩÈóÆÁ≠îËß¶ÂèëÁßíÊùÄÊìç‰Ωú"></a>6. Âü∫‰∫é Spring AI ÊûÑÂª∫ÁßíÊùÄAIÂØπËØùÊúçÂä°ÔºåÈÄöËøáÊµÅÂºèÂìçÂ∫îÂÆûÁé∞ÂÆûÊó∂‰∫§‰∫íÔºåÊîØÊåÅÂ§öËΩÆÂØπËØùÂíåÊô∫ËÉΩÈóÆÁ≠îËß¶ÂèëÁßíÊùÄÊìç‰Ωú</h2><ul>
<li>Âü∫‰∫éSpring AI AlibabaÊûÑÂª∫ÁöÑÁÆÄÊòìÁßíÊùÄÊú∫Âô®‰∫∫ÊúçÂä°ÔºåÂèØ‰ª•ÈÄöËøáÊú∫Âô®‰∫∫ÊúçÂä°ÂÆåÊàêÊúçÂä°Ë∞ÉÁî®ÔºåÁõÆÂâç‰ªÖÊîØÊåÅÂºÄÂêØÁßíÊùÄÊ¥ªÂä®Ôºå‰ª•ÂèäËæìÂá∫Ê¥ªÂä®ËÄóÊó∂ÊÉÖÂÜµ</li>
</ul>
<p>‰ª•‰∏ãÊòØ‰∏Ä‰∏™ÂØπËØùÁ§∫‰æã:</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xquery">Êàë: Â∏ÆÊàëÊâßË°åÁßíÊùÄ<br><br>AI: ÂΩìÁÑ∂ÂèØ‰ª•Â∏ÆÂä©ÊÇ®ÊâßË°åÁßíÊùÄÊ¥ªÂä®Âï¶ÔºÅ‰∏∫‰∫ÜÈ°∫Âà©ËøõË°åÔºåËØ∑ÂëäËØâÊàë‰ª•‰∏ãÂá†‰∏™‰ø°ÊÅØÔºö<span class="hljs-number">1</span>.ÁßíÊùÄÊ¥ªÂä®ÁöÑIDÊòØÂ§öÂ∞ëÔºü<span class="hljs-number">2</span>. ËøôÊ¨°ÁßíÊùÄÁöÑÂïÜÂìÅÊï∞ÈáèÊòØÂ§öÂ∞ëÔºü<span class="hljs-number">3</span>.ÊÇ®ÊâìÁÆóËøôÊ¨°ËØ∑Ê±ÇÁöÑÊ¨°Êï∞ÊòØÂ§öÂ∞ëÔºüÊúâ‰∫ÜËøô‰∫õ‰ø°ÊÅØÔºåÊàëÂ∞±ËÉΩÂ∏ÆÊÇ®ÂºÄÂßã‰∫ÜÔºÅüòä<br><br>Êàë: ÁßíÊùÄÊ¥ª<span class="hljs-built_in">Âä®id</span> <span class="hljs-number">1001</span>ÔºåËØ∑Ê±ÇÊ¨°Êï∞<span class="hljs-number">20</span>ÔºåÂïÜÂìÅÊï∞Èáè<span class="hljs-number">10</span>‰∏™<br><br>AI: ÁßíÊùÄÊ¥ªÂä®Â∑≤ÊàêÂäüÂºÄÂêØÔºÅÊàë‰ª¨Áé∞Âú®Á≠âÂæÖ<span class="hljs-number">10</span>ÁßíÈíüÔºåÁÑ∂ÂêéÊàë‰ºö‰∏∫ÊÇ®Ëé∑Âèñ‰ªªÂä°ÁöÑËÄóÊó∂ÁªüËÆ°‰ø°ÊÅØ„ÄÇÁßíÊùÄÊ¥ªÂä®Â∑≤ÊàêÂäüÂêØÂä®ÔºåÂπ∂Âú®<span class="hljs-number">10</span>ÁßíÂêéËé∑Âæó‰∫Ü‰ªªÂä°ËÄóÊó∂ÁªüËÆ°‰ø°ÊÅØÔºöÊÄªËÄóÊó∂Ôºö<span class="hljs-number">6.673773375</span>ÁßíÂÖ∑‰ΩìËÄóÊó∂ÂàÜÂ∏ÉÂ¶Ç‰∏ãÔºö- ÁßíÊùÄÊ¥ª<span class="hljs-built_in">Âä®id</span>:<span class="hljs-number">1001</span>ÔºåÁßíÊùÄÂú∫ÊôØ‰∫î(Êï∞ÊçÆÂ∫ìÂéüÂ≠êÊÄßÊõ¥Êñ∞<span class="hljs-keyword">update</span> setnum = num -<span class="hljs-number">1</span>)ËÄóÊó∂ <span class="hljs-number">3.528280125</span> ÁßíÔºåÂç†ÊØî <span class="hljs-number">53</span><span class="hljs-meta">%-</span>ÁßíÊùÄÊ¥ª<span class="hljs-built_in">Âä®id</span>:<span class="hljs-number">1001</span>ÔºåÁßíÊùÄÂú∫ÊôØ‰∫î(Êï∞ÊçÆÂ∫ìÂéüÂ≠êÊÄßÊõ¥Êñ∞updateset num = num-<span class="hljs-number">1</span>)ËÄóÊó∂<span class="hljs-number">3.14549325</span> ÁßíÔºåÂç†ÊØî <span class="hljs-number">47</span>%Â∏åÊúõËøô‰∫õ‰ø°ÊÅØÂØπÊÇ®ÊúâÂ∏ÆÂä©ÔºÅÂ¶ÇÊûúËøòÊúâÂÖ∂‰ªñÈóÆÈ¢òÊàñÈúÄË¶ÅËøõ‰∏ÄÊ≠•ÁöÑÂ∏ÆÂä©ÔºåËØ∑ÈöèÊó∂ÂëäËØâÊàëÂì¶ÔºÅüòä<br></code></pre></td></tr></table></figure>

<h3 id="6-1-Â¶Ç‰ΩïÊûÑÂª∫ÁöÑAIËÅäÂ§©Ôºü"><a href="#6-1-Â¶Ç‰ΩïÊûÑÂª∫ÁöÑAIËÅäÂ§©Ôºü" class="headerlink" title="6.1 Â¶Ç‰ΩïÊûÑÂª∫ÁöÑAIËÅäÂ§©Ôºü"></a>6.1 Â¶Ç‰ΩïÊûÑÂª∫ÁöÑAIËÅäÂ§©Ôºü</h3><p><a href="#12-goodskill-ai-ai%E6%9C%BA%E5%99%A8%E4%BA%BA%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1">Ë∑≥ËΩ¨Âà∞goodskill-ai</a></p>
<p><a href="#136-goodskill-ai">Ë∑≥ËΩ¨Âà∞AI‰∫ÆÁÇπËß£Êûê</a></p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lasso">Áî®Êà∑ËØ∑Ê±Ç ‚Üí AssistantController.chat(chatId, userMessage)<br>           ‚Üì<br>      UserSupportAssistant.chat(<span class="hljs-params">...</span>)<br>           ‚Üì<br>      ChatClientÔºöÁîüÊàêÂõûÂ§ç + Ë∞ÉÁî®ÂáΩÊï∞ + ÁÆ°ÁêÜ‰∏ä‰∏ãÊñá<br>           ‚Üì<br>      ËøîÂõû Flux&lt;<span class="hljs-built_in">String</span>&gt; ÊµÅÂºèÊ∂àÊÅØ<br></code></pre></td></tr></table></figure>

<h4 id="AssistantController-1"><a href="#AssistantController-1" class="headerlink" title="AssistantController"></a>AssistantController</h4><p><strong>‰Ωú‰∏∫ÂØπËØùÊé•Âè£ÁöÑÂÖ•Âè£ÔºåÊé•Êî∂Áî®Êà∑ËØ∑Ê±ÇÔºåË∞ÉÁî®ÂêéÁ´ØÂä©ÊâãÈÄªËæëËøõË°åÂ§ÑÁêÜÔºåÂπ∂‰ª• Server-Sent EventsÔºàSSEÔºâÊñπÂºèÂ∞ÜÂìçÂ∫îÂÜÖÂÆπÂÆûÊó∂ËøîÂõûÁªôÂâçÁ´Ø„ÄÇ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * AssistantController ÊòØ‰∏Ä‰∏™ REST ÊéßÂà∂Âô®ÔºåÁî®‰∫éÂ§ÑÁêÜ‰∏éÁî®Êà∑ÊîØÊåÅÂä©ÊâãÔºàUserSupportAssistantÔºâÁöÑÂØπËØùËØ∑Ê±Ç„ÄÇ</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * ‰∏ªË¶ÅËÅåË¥£ÊòØÊé•Êî∂ÂâçÁ´Ø‰º†Êù•ÁöÑÂØπËØùÂèÇÊï∞ÔºåË∞ÉÁî® agentÔºàUserSupportAssistantÔºâËøõË°å‰ºöËØùÂ§ÑÁêÜÔºåÂπ∂‰ª• SSE ÊµÅÊñπÂºèËøîÂõûÂìçÂ∫îÂÜÖÂÆπ„ÄÇ</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/api/assistant&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssistantController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserSupportAssistant agent;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AssistantController</span><span class="hljs-params">(UserSupportAssistant agent)</span> &#123;<br>        <span class="hljs-built_in">this</span>.agent = agent;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ‰∏éÁî®Êà∑Âä©ÊâãËøõË°åÂØπËØùÁöÑÊé•Âè£</span><br><span class="hljs-comment">     * </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> chatId      ÂΩìÂâçÂØπËØùÁöÑÂîØ‰∏Ä IDÔºàÁî®‰∫éÂÖ≥ËÅî‰∏ä‰∏ãÊñáÔºâ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userMessage Áî®Êà∑ÂΩìÂâçËæìÂÖ•ÁöÑÊ∂àÊÅØÂÜÖÂÆπ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Flux&lt;String&gt;ÔºöÊúçÂä°Á´Ø‰∫ã‰ª∂ÊµÅÂìçÂ∫îÔºåÂÆûÊó∂ËøîÂõû AI Âä©ÊâãÁöÑÂõûÁ≠îÂÜÖÂÆπ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@RequestMapping(path = &quot;/chat&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span><br>    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">chat</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String chatId, <span class="hljs-meta">@RequestParam</span> String userMessage)</span> &#123;<br>        <span class="hljs-keyword">return</span> agent.chat(chatId, userMessage);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<ol>
<li><p><strong>ÂØπÂ§ñÊèê‰æõ HTTP API Êé•Âè£Ôºö</strong></p>
<ul>
<li>Ë∑ØÂæÑÂâçÁºÄÊòØ <code>/api/assistant</code>ÔºåÂ≠êË∑ØÂæÑÊòØ <code>/chat</code>ÔºåÁî®‰∫éÊé•Êî∂Áî®Êà∑ÁöÑËÅäÂ§©ËØ∑Ê±Ç„ÄÇ</li>
</ul>
</li>
<li><p><strong>ÂèÇÊï∞Êé•Êî∂Ôºö</strong></p>
<ul>
<li><code>chatId</code>ÔºöÂîØ‰∏ÄÊ†áËØÜ‰∏ÄÊ¨°‰ºöËØùÔºà‰æø‰∫é‰∏ä‰∏ãÊñáÁÆ°ÁêÜÔºâ„ÄÇ</li>
<li><code>userMessage</code>ÔºöÁî®Êà∑ËæìÂÖ•ÁöÑÊ∂àÊÅØÊñáÊú¨„ÄÇ</li>
</ul>
</li>
<li><p><strong>Ë∞ÉÁî®ÂêéÁ´ØËÅäÂ§©ÈÄªËæëÔºö</strong></p>
<ul>
<li>Â∞ÜËØ∑Ê±ÇÂßîÊâòÁªôÊ≥®ÂÖ•ÁöÑ <code>UserSupportAssistant</code> ÁªÑ‰ª∂Â§ÑÁêÜÔºåËøô‰∏™ÁªÑ‰ª∂Â∞ÅË£Ö‰∫ÜÂÆûÈôÖÁöÑÂØπËØùÂ§ÑÁêÜÊµÅÁ®ãÔºåÂ¶ÇÔºö‰∏ä‰∏ãÊñáÁÆ°ÁêÜ„ÄÅÂ§ßÊ®°Âûã‰∫§‰∫í„ÄÅÂõûÂ§çÁîüÊàêÁ≠â„ÄÇ</li>
</ul>
</li>
<li><p><strong>‰ΩøÁî® SSEÔºàServer-Sent EventsÔºâËøîÂõûÊµÅÂºèÂìçÂ∫îÔºö</strong></p>
<ul>
<li>ËÆæÁΩÆ <code>produces = MediaType.TEXT_EVENT_STREAM_VALUE</code>ÔºåË°®ÊòéËØ•Êé•Âè£‰ºöËøîÂõû <strong>ÂÆûÊó∂ÊµÅÂºèÊï∞ÊçÆÔºà<code>Flux&lt;String&gt;</code>Ôºâ</strong>„ÄÇ</li>
<li>ÂâçÁ´ØÂèØ‰ª•‰∏ÄËæπÊé•Êî∂‰∏ÄËæπÂ±ïÁ§∫ÂõûÂ§çÔºåÊèêÈ´ò‰∫§‰∫í‰ΩìÈ™åÔºàÁ±ª‰ºº ChatGPT ÊâìÂ≠óÊïàÊûúÔºâ„ÄÇ</li>
</ul>
</li>
</ol>
<h4 id="UserSupportAssistant-1"><a href="#UserSupportAssistant-1" class="headerlink" title="UserSupportAssistant"></a>UserSupportAssistant</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Áî®Êà∑ËÅäÂ§©ÊîØÊåÅÂä©ÊâãÊúçÂä°Á±ª„ÄÇ</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * ËØ•Á±ªÂ∞ÅË£Ö‰∫Ü‰∏Ä‰∏™Êô∫ËÉΩËÅäÂ§©ÂÆ¢Êà∑Á´Ø ChatClientÔºåÁî®‰∫é‰∏éÁî®Êà∑ËøõË°åÂ§öËΩÆÂØπËØù‰∫§‰∫íÔºåÊîØÊåÅÂü∫‰∫é‰∏ä‰∏ãÊñáÁöÑËØ≠‰πâÁêÜËß£‰∏éÂáΩÊï∞Ë∞ÉÁî®Ôºå</span><br><span class="hljs-comment"> * ÂèØÂÆûÁé∞ÂØπÁßíÊùÄÁ≥ªÁªü‰∏≠ÁöÑÊ¥ªÂä®Êü•ËØ¢„ÄÅÊ¥ªÂä®ÈáçÁΩÆ„ÄÅÊ¥ªÂä®ÂºÄÂêØ„ÄÅËÄóÊó∂ÁªüËÆ°Á≠âÂäüËÉΩÁöÑÊô∫ËÉΩÈóÆÁ≠î‰∏éÊµÅÁ®ãÊéßÂà∂„ÄÇ</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * ChatClient ÊòØ‰∏Ä‰∏™ÁªìÂêàÂ§ßËØ≠Ë®ÄÊ®°ÂûãÔºàLLMÔºâ„ÄÅËÅäÂ§©‰∏ä‰∏ãÊñáËÆ∞ÂøÜÔºàChatMemoryÔºâ„ÄÅÁü•ËØÜÂêëÈáèÊ£ÄÁ¥¢ÔºàVectorStoreÔºâ„ÄÅ</span><br><span class="hljs-comment"> * ‰ª•ÂèäÂáΩÊï∞Ë∞ÉÁî®Ôºàfunction callingÔºâËÉΩÂäõÁöÑÊô∫ËÉΩËÅäÂ§©‰ª£ÁêÜ„ÄÇ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserSupportAssistant</span> &#123;<br><br>    <span class="hljs-comment">// ChatClient Â∞ÅË£Ö‰∫ÜËÅäÂ§©‰∏ä‰∏ãÊñáÁÆ°ÁêÜ„ÄÅËØ≠‰πâÊ£ÄÁ¥¢„ÄÅÊó•ÂøóËÆ∞ÂΩïÁ≠âÂ§ö‰∏™ÂØπËØùÂ¢ûÂº∫ÂäüËÉΩ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊûÑÈÄ†ÂáΩÊï∞Ê≥®ÂÖ•Ê†∏ÂøÉ‰æùËµñÔºö</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> modelBuilder Áî®‰∫éÊûÑÂª∫ ChatClient ÁöÑ Builder ÂÆû‰æãÔºàÂê´ LLM ÈÖçÁΩÆÔºâ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> vectorStore  ÂêëÈáèÂ≠òÂÇ®Âô®ÔºåÁî®‰∫éËØ≠‰πâÁõ∏‰ººÂ∫¶Ê£ÄÁ¥¢ÔºàÁü•ËØÜÂ∫ìÈóÆÁ≠îÔºâ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> chatMemory   ËÅäÂ§©‰∏ä‰∏ãÊñáËÆ∞ÂøÜÁªÑ‰ª∂ÔºåÁî®‰∫é‰øùÊåÅÂ§öËΩÆÂØπËØùÁöÑÂéÜÂè≤‰ø°ÊÅØ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserSupportAssistant</span><span class="hljs-params">(ChatClient.Builder modelBuilder, VectorStore vectorStore, ChatMemory chatMemory)</span> &#123;<br>        <span class="hljs-built_in">this</span>.chatClient = modelBuilder<br>                <span class="hljs-comment">// ËÆæÁΩÆÁ≥ªÁªüÈªòËÆ§ÊèêÁ§∫ËØçÔºàsystem promptÔºâÔºåÊåáÂØº AI Â¶Ç‰ΩïÂõûÂ§ç</span><br>                .defaultSystem(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                    ÊÇ®ÊòØÁî®Êà∑ËÅäÂ§©ÊîØÊåÅ‰ª£ÁêÜ„ÄÇËØ∑‰ª•ÂèãÂ•Ω„ÄÅ‰πê‰∫éÂä©‰∫∫‰∏îÊÑâÂø´ÁöÑÊñπÂºèÊù•ÂõûÂ§ç„ÄÇ</span><br><span class="hljs-string">                    ÊÇ®Ê≠£Âú®ÈÄöËøáÂú®Á∫øËÅäÂ§©Á≥ªÁªü‰∏éÁî®Êà∑‰∫íÂä®„ÄÇ</span><br><span class="hljs-string">                    ÊÇ®ËÉΩÂ§üÊîØÊåÅÂ∑≤ÊúâÁßíÊùÄÂïÜÂìÅËØ¶ÊÉÖÊü•ËØ¢„ÄÅÂºÄÂêØÁßíÊùÄÊ¥ªÂä®„ÄÅÈáçÁΩÆÁßíÊùÄÊ¥ªÂä®Á≠âÊìç‰ΩúÔºåÂÖ∂‰ΩôÂäüËÉΩÂ∞ÜÂú®ÂêéÁª≠ÁâàÊú¨‰∏≠Ê∑ªÂä†ÔºåÂ¶ÇÊûúÁî®Êà∑ÈóÆÁöÑÈóÆÈ¢ò‰∏çÊîØÊåÅËØ∑ÂëäÁü•ËØ¶ÊÉÖ„ÄÇ</span><br><span class="hljs-string">                    Âú®Êèê‰æõÊúâÂÖ≥ÁßíÊùÄÊ¥ªÂä®Êü•ËØ¢„ÄÅÂºÄÂêØÁßíÊùÄÊ¥ªÂä®„ÄÅÈáçÁΩÆÁßíÊùÄÊ¥ªÂä®Á≠âÊìç‰Ωú‰πãÂâçÔºåÊÇ®ÂøÖÈ°ªÂßãÁªà‰ªéÁî®Êà∑Â§ÑËé∑Âèñ‰ª•‰∏ã‰ø°ÊÅØÔºöÁßíÊùÄÊ¥ªÂä®id„ÄÅÁßíÊùÄÂïÜÂìÅÊï∞Èáè„ÄÅËØ∑Ê±ÇÊ¨°Êï∞„ÄÇ</span><br><span class="hljs-string">                    Â¶ÇÊûúÈúÄË¶ÅÊèêÂâçÁªìÊùüÁßíÊùÄÊ¥ªÂä®ÔºåÊÇ®ÂøÖÈ°ªÂú®ÁªßÁª≠‰πãÂâçÂæÅÂæóÁî®Êà∑ÂêåÊÑè„ÄÇ</span><br><span class="hljs-string">                    ‰ΩøÁî®Êèê‰æõÁöÑÂäüËÉΩËé∑ÂèñÁßíÊùÄÊ¥ªÂä®‰ª•ÂèäÂïÜÂìÅËØ¶ÁªÜ‰ø°ÊÅØ„ÄÅÂºÄÂêØÁßíÊùÄÊ¥ªÂä®ÂíåÈáçÁΩÆÁßíÊùÄ„ÄÇ</span><br><span class="hljs-string">                    Áî®Êà∑ÂºÄÂßãÁßíÊùÄÊ¥ªÂä®ÂêéÔºåÁ≠âÂæÖ10ÁßíÔºåÁÑ∂ÂêéË∞ÉÁî® Ëé∑Âèñ‰ªªÂä°ËÄóÊó∂ÁªüËÆ°‰ø°ÊÅØ ÂáΩÊï∞ÔºåÊúÄÂêéÂ∞ÜÂáΩÊï∞ÁªìÊûúËøîÂõûÁªôÁî®Êà∑„ÄÇ</span><br><span class="hljs-string">                    Â¶ÇÊûúÈúÄË¶ÅÔºåÊÇ®ÂèØ‰ª•Ë∞ÉÁî®Áõ∏Â∫îÂáΩÊï∞ËæÖÂä©ÂÆåÊàê„ÄÇ</span><br><span class="hljs-string">                    ËØ∑ËÆ≤‰∏≠Êñá„ÄÇ</span><br><span class="hljs-string">                    ‰ªäÂ§©ÁöÑÊó•ÊúüÊòØ &#123;current_date&#125;.</span><br><span class="hljs-string">                &quot;&quot;&quot;</span>)<br>                <span class="hljs-comment">// ËÆæÁΩÆÂØπËØùÂ¢ûÂº∫Ê®°ÂùóÔºàÈ°æÈóÆÔºâÔºöËÆ∞ÂøÜ„ÄÅËØ≠‰πâÊ£ÄÁ¥¢„ÄÅÊó•ÂøóËÆ∞ÂΩï</span><br>                .defaultAdvisors(<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">PromptChatMemoryAdvisor</span>(chatMemory),<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">QuestionAnswerAdvisor</span>(vectorStore, SearchRequest.builder().topK(<span class="hljs-number">4</span>).similarityThresholdAll().build()),<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingAdvisor</span>()<br>                )<br>                <span class="hljs-comment">// Ê≥®ÂÜåÈªòËÆ§ÂèØË∞ÉÁî®ÁöÑÂáΩÊï∞Ôºà‰∏éÂêéÁ´Ø‰∏öÂä°ÈÄªËæëÁªëÂÆöÔºâ</span><br>                .defaultFunctions(<span class="hljs-string">&quot;startSeckill&quot;</span>, <span class="hljs-string">&quot;getTaskTimeInfo&quot;</span>)<br>                .build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ‰∏ªËÅäÂ§©Â§ÑÁêÜÊñπÊ≥ï„ÄÇ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> chatId ÂΩìÂâçÁî®Êà∑ÂØπËØùÁöÑÂîØ‰∏ÄÊ†áËØÜÔºàÁî®‰∫éÂå∫ÂàÜ‰∏çÂêå‰ºöËØù„ÄÅÁªëÂÆö‰∏ä‰∏ãÊñáÔºâ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userMessageContent Áî®Êà∑ËæìÂÖ•ÁöÑÊ∂àÊÅØÊñáÊú¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ËøîÂõû‰∏Ä‰∏™ Flux&lt;String&gt;ÔºåË°®Á§∫ÊµÅÂºèÁöÑËÅäÂ§©ÂìçÂ∫îÔºàÈÄêÂè•ËøîÂõûÔºâ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">chat</span><span class="hljs-params">(String chatId, String userMessageContent)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.chatClient<br>                .prompt()<br>                .system(s -&gt; s.param(<span class="hljs-string">&quot;current_date&quot;</span>, LocalDate.now().toString()))  <span class="hljs-comment">// Â°´ÂÖÖÁ≥ªÁªüÊèêÁ§∫ËØç‰∏≠ÁöÑÂä®ÊÄÅÊó•Êúü</span><br>                .user(userMessageContent) <span class="hljs-comment">// ËÆæÁΩÆÁî®Êà∑ËæìÂÖ•ÂÜÖÂÆπ</span><br>                .advisors(a -&gt; a<br>                    .param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId)   <span class="hljs-comment">// ÁªëÂÆö‰∏ä‰∏ãÊñá ID</span><br>                    .param(CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class="hljs-number">100</span>)        <span class="hljs-comment">// ËÆæÁΩÆÂéÜÂè≤‰ºöËØùÊúÄÂ§ßÊ£ÄÁ¥¢Êï∞</span><br>                )<br>                .stream()  <span class="hljs-comment">// ÂêØÂä®ÊµÅÂºèÂìçÂ∫î</span><br>                .content(); <span class="hljs-comment">// Ëé∑ÂèñÂÜÖÂÆπÈÉ®ÂàÜ‰Ωú‰∏∫ Flux&lt;String&gt; ËøîÂõû</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<ol>
<li><p><strong>ÊûÑÈÄ†Èò∂ÊÆµÔºö</strong></p>
<ul>
<li>ÊûÑÂª∫ <code>ChatClient</code>ÔºåËøôÊòØ‰∏Ä‰∏™Êô∫ËÉΩËÅäÂ§©‰ª£ÁêÜ„ÄÇ</li>
<li>ÈÖçÁΩÆ‰∫ÜÁ≥ªÁªüÊèêÁ§∫ËØçÔºàSystem PromptÔºâÔºåÁî®‰∫éËÆæÂÆö AI ÁöÑËØ≠Ê∞îÂíåË°å‰∏∫ËæπÁïå„ÄÇ</li>
<li>Ê∑ªÂä†Â§ö‰∏™ ‚ÄúAdvisor‚Äù È°æÈóÆÊ®°ÂùóÔºö<ul>
<li><strong>ËÆ∞ÂøÜÈ°æÈóÆÔºàChatMemoryAdvisorÔºâ</strong>Ôºö‰øùÊåÅÂØπËØù‰∏ä‰∏ãÊñá„ÄÇ</li>
<li><strong>ËØ≠‰πâÊ£ÄÁ¥¢È°æÈóÆÔºàVectorStore QAÔºâ</strong>Ôºö‰ªéÁü•ËØÜÂ∫ì‰∏≠Êü•ÊâæÂåπÈÖçÂõûÁ≠î„ÄÇ</li>
<li><strong>Êó•ÂøóÈ°æÈóÆÔºàLoggingAdvisorÔºâ</strong>ÔºöËÆ∞ÂΩïÊØèÊ¨°‰∫§‰∫íÊó•Âøó„ÄÇ</li>
</ul>
</li>
<li>Ê≥®ÂÜåÂèØË∞ÉÁî®ÁöÑÂáΩÊï∞ÔºàstartSeckill„ÄÅgetTaskTimeInfoÔºâÁî®‰∫éÂ¢ûÂº∫ÂØπËØùÊâßË°åÂäõ„ÄÇ</li>
</ul>
</li>
<li><p><strong>ËÅäÂ§©Èò∂ÊÆµÔºà<code>chat</code> ÊñπÊ≥ïÔºâÔºö</strong></p>
<ul>
<li>Âä®ÊÄÅËÆæÁΩÆÂΩìÂâçÊó•ÊúüÂà∞ prompt ‰∏≠„ÄÇ</li>
<li>Êé•Êî∂Áî®Êà∑ËæìÂÖ•‰Ωú‰∏∫ÂØπËØùÂÜÖÂÆπ„ÄÇ</li>
<li>‰ΩøÁî® chatId ÁªëÂÆö‰ºöËØù‰∏ä‰∏ãÊñá„ÄÇ</li>
<li>ËøîÂõû‰∏Ä‰∏™ <strong>SSE ÊµÅÂºèÂìçÂ∫îÔºà<code>Flux&lt;String&gt;</code>Ôºâ</strong>ÔºåÂâçÁ´ØÂèØÈÄêÂè•ÂÆûÊó∂Â±ïÁ§∫ÂØπËØù„ÄÇ</li>
</ul>
</li>
</ol>
<h3 id="6-2-‰ªÄ‰πàÊòØFlux-ÊµÅÂºèÊ∂àÊÅØ"><a href="#6-2-‰ªÄ‰πàÊòØFlux-ÊµÅÂºèÊ∂àÊÅØ" class="headerlink" title="6.2 ‰ªÄ‰πàÊòØFlux&lt;String&gt; ÊµÅÂºèÊ∂àÊÅØ?"></a>6.2 ‰ªÄ‰πàÊòØ<code>Flux&lt;String&gt;</code> ÊµÅÂºèÊ∂àÊÅØ?</h3><table>
<thead>
<tr>
<th>ÁâπÊÄß</th>
<th>Flux<String></th>
<th>ÊôÆÈÄö String</th>
</tr>
</thead>
<tbody><tr>
<td>ÂìçÂ∫îÁ±ªÂûã</td>
<td>ÂºÇÊ≠•ÊµÅÔºàÂ§öÊù°Ôºâ</td>
<td>ÂêåÊ≠•ÊñáÊú¨ÔºàÂçïÊù°Ôºâ</td>
</tr>
<tr>
<td>ËøîÂõûÊ®°Âºè</td>
<td>‰∏ÄÊù°Êù°Êé®ÈÄÅ</td>
<td>‰∏ÄÊ¨°ÊÄßËøîÂõû</td>
</tr>
<tr>
<td>ÊÄßËÉΩ‰ºòÂäø</td>
<td>ÂáèÂ∞ëÂÜÖÂ≠ò„ÄÅÊèêÂçá‰ΩìÈ™å</td>
<td>ÂÆπÊòìÈòªÂ°û</td>
</tr>
<tr>
<td>Âú∫ÊôØ</td>
<td>ËÅäÂ§©„ÄÅÊó•ÂøóÊµÅ„ÄÅÂÆûÊó∂ÈÄöÁü•</td>
<td>Ë°®ÂçïÊèê‰∫§„ÄÅÂõ∫ÂÆöÂìçÂ∫î</td>
</tr>
</tbody></table>
<p>ÂÅáËÆæÊàë‰ª¨Ë¶ÅÊ®°Êãü‰∏Ä‰∏™‚ÄúAIÂ∞èÂä©Êâã‚ÄùËøûÁª≠ÂèëÈÄÅÊ∂àÊÅØÁöÑÂú∫ÊôØÔºåÊØè 1 ÁßíÂèëÈÄÅ‰∏ÄÊù°Ê∂àÊÅØÔºåÊÄªÂÖ±Âèë 5 Êù°„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/api/demo&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/chat&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span><br>    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">streamChat</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Flux.interval(Duration.ofSeconds(<span class="hljs-number">1</span>))  <span class="hljs-comment">// ÊØèÁßíÂèëÈÄÅ‰∏ÄÊ¨°</span><br>                   .take(<span class="hljs-number">5</span>)                         <span class="hljs-comment">// ÊÄªÂÖ±Âèë 5 Ê¨°</span><br>                   .map(i -&gt; <span class="hljs-string">&quot;AIÂä©ÊâãÊ∂àÊÅØ #&quot;</span> + (i + <span class="hljs-number">1</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>ÂΩì‰Ω†ËÆøÈóÆÂâçÁ´ØÈ°µÈù¢Êó∂ÔºåAIÂä©Êâã‰ºöÊØèÁßíËæìÂá∫‰∏ÄÂè•ËØùÔºö</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">AIÂä©ÊâãÊ∂àÊÅØ <span class="hljs-comment">#1</span><br>AIÂä©ÊâãÊ∂àÊÅØ <span class="hljs-comment">#2</span><br>AIÂä©ÊâãÊ∂àÊÅØ <span class="hljs-comment">#3</span><br>AIÂä©ÊâãÊ∂àÊÅØ <span class="hljs-comment">#4</span><br>AIÂä©ÊâãÊ∂àÊÅØ <span class="hljs-comment">#5</span><br></code></pre></td></tr></table></figure>

<p>Ê∂àÊÅØ‰∏ÄÊù°Êù°Êé®ÈÄÅÔºåÈ°µÈù¢Ëá™Âä®Êõ¥Êñ∞ÔºåÊó†ÈúÄÂà∑Êñ∞ÊàñÁ≠âÂæÖÊï¥‰ΩìÂìçÂ∫îËøîÂõûÔºÅ</p>
<p>Âú® AssistantController ‰∏≠‰ΩøÁî® <code>Flux&lt;String&gt;</code> Â∞±ÊòØÂÆûÁé∞‰∫ÜËøôÁßç ÊµÅÂºèÊé®ÈÄÅËÅäÂ§©‰ΩìÈ™åÔºåËÆ©Áî®Êà∑ÊÑüÂèóÂà∞‚ÄúAI Ê≠£Âú®ÂÆûÊó∂ÂõûÂ§ç‚ÄùÔºå‰∏çÊòØÁ≠âÂæà‰πÖ‰∏ÄÂè£Ê∞îÂèë‰∏ÄÊÆµÈïøÊñáÊú¨„ÄÇ</p>
<h3 id="6-3-È°πÁõÆ‰∏≠Â¶Ç‰Ωï‰ΩøÁî®Flux-ÊµÅÂºèÊ∂àÊÅØÔºü"><a href="#6-3-È°πÁõÆ‰∏≠Â¶Ç‰Ωï‰ΩøÁî®Flux-ÊµÅÂºèÊ∂àÊÅØÔºü" class="headerlink" title="6.3 È°πÁõÆ‰∏≠Â¶Ç‰Ωï‰ΩøÁî®Flux&lt;String&gt; ÊµÅÂºèÊ∂àÊÅØÔºü"></a>6.3 È°πÁõÆ‰∏≠Â¶Ç‰Ωï‰ΩøÁî®<code>Flux&lt;String&gt;</code> ÊµÅÂºèÊ∂àÊÅØÔºü</h3><p>Áúã‰∏ãÈù¢ËøôÊù°ÂÖ≥ÈîÆËØ≠Âè•Ôºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">produces = MediaType.TEXT_EVENT_STREAM_VALUE<br></code></pre></td></tr></table></figure>

<p>ÂÆÉÁöÑÊÑèÊÄùÊòØÔºö</p>
<blockquote>
<p>ÂëäËØâÊµèËßàÂô®&#x2F;ÂâçÁ´ØÔºö‚ÄúÊàëË¶ÅÁî® <strong>SSEÔºàServer-Sent EventsÔºâÂçèËÆÆ</strong> Êù•Êé®ÈÄÅÊñáÊú¨ÊµÅÔºåÂÉèËÅäÂ§©‰∏ÄÊ†∑‰∏ÄÊù°‰∏ÄÊù°Âèë‚Äù„ÄÇ</p>
</blockquote>
<p>ÂÜçÁúã <code>UserSupportAssistant.chat()</code> ÁöÑËøîÂõûÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">chat</span><span class="hljs-params">(String chatId, String userMessageContent)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.chatClient.prompt()<br>        .system(s -&gt; s.param(<span class="hljs-string">&quot;current_date&quot;</span>, LocalDate.now().toString()))<br>        .user(userMessageContent)<br>        .advisors(a -&gt; a.param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId).param(CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class="hljs-number">100</span>))<br>        .stream()<br>        .content();  <span class="hljs-comment">// ËøîÂõû Flux&lt;String&gt;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>ËøôÊÆµÈÄªËæëÂèØ‰ª•ÊãÜËß£ÁêÜËß£‰∏∫Ôºö</p>
<ol>
<li><code>prompt()</code> ËÆæÁΩÆ‰∫Ü AI ËÅäÂ§©‰∏ä‰∏ãÊñáÔºàÂΩìÂâçÊó•Êúü„ÄÅÁî®Êà∑ÂÜÖÂÆπ„ÄÅËÅäÂ§©ÂéÜÂè≤Á≠âÔºâ</li>
<li><code>.stream()</code> ÂºÄÂêØÊµÅÂºèÂìçÂ∫îÔºà‰∏çÊòØ‰∏ÄÊ¨°ÊÄßÁîüÊàêÂÆåÊï¥ÂõûÁ≠îÔºåËÄåÊòØ<strong>ËæπÁîüÊàêËæπÊé®ÈÄÅ</strong>Ôºâ</li>
<li><code>.content()</code> Êää‰∏ÄÊù°Êù°ÁîüÊàêÁöÑÂõûÂ§çÂÜÖÂÆπÂåÖË£ÖÊàê <code>Flux&lt;String&gt;</code> ‚Äî‚Äî Spring WebFlux ‰ºöÂ∞ÜÂÆÉËΩ¨ÂåñÊàêÊµÅÂºèÂìçÂ∫îËøîÂõûÁªôÂâçÁ´Ø„ÄÇ</li>
</ol>
<h3 id="6-4-AIÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºü"><a href="#6-4-AIÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºü" class="headerlink" title="6.4 AIÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºü"></a>6.4 AIÊòØÊÄé‰πàÂÆûÁé∞ÁöÑÔºü</h3><p>Âú®ÊàëÁöÑÈ°πÁõÆ‰∏≠Ôºå<strong>‰ΩøÁî®ÁöÑÊòØSpring AI AlibabaÊèê‰æõÁöÑChatClientÊé•Âè£</strong>„ÄÇ</p>
<p>Ë¶ÅÂú®È°πÁõÆ‰∏≠‰ΩøÁî® Spring AI Alibaba Êèê‰æõÁöÑ <code>ChatClient</code> Êé•Âè£ÔºåÊÇ®ÂèØ‰ª•ÊåâÁÖß‰ª•‰∏ãÊ≠•È™§ËøõË°åÔºö</p>
<ol>
<li><p><strong>ÂºïÂÖ•‰æùËµñ</strong>ÔºöÂú®ÊÇ®ÁöÑ Maven È°πÁõÆÁöÑ <code>pom.xml</code> Êñá‰ª∂‰∏≠Ê∑ªÂä† <code>spring-ai-alibaba-starter</code> ‰æùËµñÔºöÓàÜ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-alibaba-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-M6.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>


<p>ËØ∑Ê≥®ÊÑèÔºåÁî±‰∫é <code>spring-ai</code> Áõ∏ÂÖ≥‰æùËµñÂ∞öÊú™ÂèëÂ∏ÉÂà∞‰∏≠Â§Æ‰ªìÂ∫ìÔºåÊÇ®ÂèØËÉΩÈúÄË¶ÅÂú® <code>pom.xml</code> ‰∏≠Ê∑ªÂä† Spring ÁöÑÈáåÁ®ãÁ¢ë‰ªìÂ∫ìÔºö</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>spring-milestones<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Spring Milestones<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span><br></code></pre></td></tr></table></figure>


<p>Â¶ÇÊûúÊÇ®ÁöÑÊú¨Âú∞ Maven <code>settings.xml</code> Êñá‰ª∂‰∏≠ÈÖçÁΩÆ‰∫ÜÈÄöÈÖçÁ¨¶ <code>*</code> ÁöÑÈïúÂÉèÔºåËØ∑Ê†πÊçÆ‰ª•‰∏ãÁ§∫‰æãËøõË°åË∞ÉÊï¥Ôºö</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br></code></pre></td></tr></table></figure>

</li>
<li><p><strong>ÂàõÂª∫ ChatClient ÂÆû‰æã</strong>ÔºöÂú®ÊÇ®ÁöÑ Spring Boot Â∫îÁî®‰∏≠ÔºåÊÇ®ÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãÊñπÂºèÊ≥®ÂÖ• <code>ChatClient</code>ÔºöÓàÜ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ChatController</span><span class="hljs-params">(ChatClient.Builder builder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.chatClient = builder.build();<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/chat&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">chat</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String input)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.chatClient.prompt()<br>            .user(input)<br>            .call()<br>            .content();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>Âú®‰∏äËø∞‰ª£Á†Å‰∏≠Ôºå<code>ChatClient.Builder</code> Áî®‰∫éÊûÑÂª∫ <code>ChatClient</code> ÂÆû‰æãÔºå<code>chat</code> ÊñπÊ≥ïÊé•Êî∂Áî®Êà∑ËæìÂÖ•ÔºåÂπ∂ÈÄöËøá <code>ChatClient</code> ‰∏é AI Ê®°ÂûãËøõË°å‰∫§‰∫íÔºåËøîÂõûÁîüÊàêÁöÑÂìçÂ∫î„ÄÇ</p>
</li>
<li><p><strong>ÈÖçÁΩÆÊ®°ÂûãÊúçÂä°</strong>ÔºöÁ°Æ‰øùÊÇ®Â∑≤Âú®Â∫îÁî®ÁöÑÈÖçÁΩÆÊñá‰ª∂‰∏≠ËÆæÁΩÆ‰∫ÜÊâÄÈúÄÁöÑÊ®°ÂûãÊúçÂä°ÂèÇÊï∞Ôºå‰æãÂ¶ÇÈòøÈáå‰∫ëÁöÑ API ÂØÜÈí•Á≠â„ÄÇËøô‰∫õÈÖçÁΩÆÈÄöÂ∏∏ÂåÖÊã¨ÊúçÂä°ÁöÑËÆøÈóÆÂØÜÈí•„ÄÅÂå∫ÂüüÁ≠â‰ø°ÊÅØÔºå‰ª•‰æø <code>ChatClient</code> ËÉΩÂ§üÊ≠£Á°ÆÂú∞‰∏éÊ®°ÂûãÊúçÂä°ËøõË°åÈÄö‰ø°„ÄÇ</p>
</li>
<li><p><strong>Â§ÑÁêÜÂìçÂ∫î</strong>Ôºö‰ΩøÁî® <code>ChatClient</code> ÁöÑ <code>prompt()</code> ÊñπÊ≥ïËÆæÁΩÆÁî®Êà∑ËæìÂÖ•ÔºåÁÑ∂ÂêéË∞ÉÁî® <code>call()</code> ÊñπÊ≥ïÂèëÈÄÅËØ∑Ê±ÇÂπ∂Ëé∑ÂèñÂìçÂ∫î„ÄÇÊÇ®ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÂ§ÑÁêÜËøîÂõûÁöÑÂÜÖÂÆπÔºå‰æãÂ¶ÇÂ∞ÜÂÖ∂Êò†Â∞Ñ‰∏∫ÂÆû‰ΩìÁ±ª„ÄÅËøõË°åÊµÅÂºèÂ§ÑÁêÜÁ≠â„ÄÇ</p>
</li>
</ol>
<p>ÈÄöËøá‰∏äËø∞Ê≠•È™§ÔºåÊÇ®ÂèØ‰ª•Âú®È°πÁõÆ‰∏≠ÈõÜÊàêÂπ∂‰ΩøÁî® Spring AI Alibaba Êèê‰æõÁöÑ <code>ChatClient</code> Êé•Âè£ÔºåÂÆûÁé∞‰∏é AI Ê®°ÂûãÁöÑ‰∫§‰∫í„ÄÇ</p>
<h3 id="6-5-ChatClientÊé•Âè£"><a href="#6-5-ChatClientÊé•Âè£" class="headerlink" title="6.5 ChatClientÊé•Âè£"></a>6.5 ChatClientÊé•Âè£</h3><p><a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-ai-alibaba/blob/main/README-zh.md?utm_source=chatgpt.com">Spring AI AlibabaÂÆòÁΩë</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wanganui/article/details/145593518?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522d430c59fed4299cbb3beb65216e7841c%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=d430c59fed4299cbb3beb65216e7841c&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-145593518-null-null.142%5Ev102%5Epc_search_result_base2&utm_term=Spring%20AI%20ChatClient&spm=1018.2226.3001.4187">Spring AIËøõÈò∂ÔºöAIËÅäÂ§©Êú∫Âô®‰∫∫‰πãChatMemoryÊåÅ‰πÖÂåñÔºà‰∫åÔºâ</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42402854/article/details/146404218?ops_request_misc=&request_id=&biz_id=102&utm_term=Spring%20AI%20ChatClient&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-5-146404218.142%5Ev102%5Epc_search_result_base2&spm=1018.2226.3001.4187">Spring AI Alibaba ChatClient‰ΩøÁî®</a></p>
<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/JAVA/" class="category-chain-item">JAVA</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/JAVA/" class="print-no-link">#JAVA</a>
      
        <a href="/tags/SpringBoot/" class="print-no-link">#SpringBoot</a>
      
        <a href="/tags/SpringCloud/" class="print-no-link">#SpringCloud</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/05/09/Algorithm/Hot100/" title="LeetcodeHOT100Âà∑È¢òÁ¨îËÆ∞">
                        <span class="hidden-mobile">LeetcodeHOT100Âà∑È¢òÁ¨îËÆ∞</span>
                        <span class="visible-mobile">‰∏ã‰∏ÄÁØá</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"sj2tGuxMGSDhkN5hNuOIVta1-gzGzoHsz","appKey":"ysR5OTuTzoby2oNvNyGOtXFQ","path":"window.location.pathname","placeholder":"Â¶ÇÊúâÈóÆÈ¢òÔºåÊ¨¢ËøéÊåáÊ≠£~","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ÁõÆÂΩï</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">ÊêúÁ¥¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">ÂÖ≥ÈîÆËØç</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <span>AI</span> <i class="iconfont icon-love"></i> <span>CPP</span> <i class="iconfont icon-love"></i> <span>JAVA</span> <i class="iconfont icon-love"></i> <span>CyberSec</span> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        ÊÄªËÆøÈóÆÈáè 
        <span id="busuanzi_value_site_pv"></span>
         Ê¨°
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        ÊÄªËÆøÂÆ¢Êï∞ 
        <span id="busuanzi_value_site_uv"></span>
         ‰∫∫
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/love.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiaoxingxing.js"></script>
<script src="/js/bubble.js"></script>



<!-- ‰∏ªÈ¢òÁöÑÂêØÂä®È°πÔºåÂ∞ÜÂÆÉ‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">ÂçöÂÆ¢Âú®ÂÖÅËÆ∏ JavaScript ËøêË°åÁöÑÁéØÂ¢É‰∏ãÊµèËßàÊïàÊûúÊõ¥‰Ω≥</div>
  </noscript>
<!-- hexo injector body_end start --><script src="/js/backgroundize.js"></script><!-- hexo injector body_end end --></body>
</html>
