

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/about/dogs.jpg">
  <link rel="icon" href="/img/about/dogs.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="ranzier">
  <meta name="keywords" content="">
  
    <meta name="description" content="ËãçÁ©πÂ§ñÂçñÂ≠¶‰π†Á¨îËÆ∞  ‰∏Ä. È°πÁõÆÊ¶ÇËø∞„ÄÅÁéØÂ¢ÉÊê≠Âª∫1. ËΩØ‰ª∂ÂºÄÂèëÊï¥‰ΩìÊµÅÁ®ã ÈúÄÊ±ÇÂàÜÊûê: ÈúÄÊ±ÇËßÑÊ†ºËØ¥Êòé‰π¶„ÄÅ‰∫ßÂìÅÂéüÂûã ËÆæËÆ°: UIËÆæËÆ°„ÄÅÊï∞ÊçÆÂ∫ìËÆæËÆ°„ÄÅÊé•Âè£ËÆæËÆ° ÁºñÁ†Å: È°πÁõÆ‰ª£Á†Å„ÄÅÂçïÂÖÉÊµãËØï ÊµãËØï: ÊµãËØïÁî®‰æã„ÄÅÊµãËØïÊä•Âëä ‰∏äÁ∫øËøêÁª¥: ËΩØ‰ª∂ÁéØÂ¢ÉÂÆâË£Ö„ÄÅÈÖçÁΩÆ  2. ÊäÄÊúØÈÄâÂûãÈ°πÁõÆ‰∏≠‰ΩøÁî®Âà∞ÁöÑÊäÄÊúØÊ°ÜÊû∂Âíå‰∏≠Èó¥‰ª∂ 3. ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫3.1 ÂâçÁ´ØÁéØÂ¢ÉÊê≠Âª∫(nginx)ÂâçÁ´ØÊàë‰ª¨Â∞±‰∏çËá™Â∑±ÂÜô‰ª£Á†Å‰∫ÜÁõ¥Êé•ÊâìÂºÄnginx.exeËøêË°åÔºåÊâìÂºÄloc">
<meta property="og:type" content="article">
<meta property="og:title" content="ËãçÁ©πÂ§ñÂçñÂ≠¶‰π†Á¨îËÆ∞(Ë∑≥ËøáÂæÆ‰ø°ÊîØ‰ªò)">
<meta property="og:url" content="http://example.com/2025/03/03/JAVA/CangqiongTakeout/index.html">
<meta property="og:site_name" content="RANZIER">
<meta property="og:description" content="ËãçÁ©πÂ§ñÂçñÂ≠¶‰π†Á¨îËÆ∞  ‰∏Ä. È°πÁõÆÊ¶ÇËø∞„ÄÅÁéØÂ¢ÉÊê≠Âª∫1. ËΩØ‰ª∂ÂºÄÂèëÊï¥‰ΩìÊµÅÁ®ã ÈúÄÊ±ÇÂàÜÊûê: ÈúÄÊ±ÇËßÑÊ†ºËØ¥Êòé‰π¶„ÄÅ‰∫ßÂìÅÂéüÂûã ËÆæËÆ°: UIËÆæËÆ°„ÄÅÊï∞ÊçÆÂ∫ìËÆæËÆ°„ÄÅÊé•Âè£ËÆæËÆ° ÁºñÁ†Å: È°πÁõÆ‰ª£Á†Å„ÄÅÂçïÂÖÉÊµãËØï ÊµãËØï: ÊµãËØïÁî®‰æã„ÄÅÊµãËØïÊä•Âëä ‰∏äÁ∫øËøêÁª¥: ËΩØ‰ª∂ÁéØÂ¢ÉÂÆâË£Ö„ÄÅÈÖçÁΩÆ  2. ÊäÄÊúØÈÄâÂûãÈ°πÁõÆ‰∏≠‰ΩøÁî®Âà∞ÁöÑÊäÄÊúØÊ°ÜÊû∂Âíå‰∏≠Èó¥‰ª∂ 3. ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫3.1 ÂâçÁ´ØÁéØÂ¢ÉÊê≠Âª∫(nginx)ÂâçÁ´ØÊàë‰ª¨Â∞±‰∏çËá™Â∑±ÂÜô‰ª£Á†Å‰∫ÜÁõ¥Êé•ÊâìÂºÄnginx.exeËøêË°åÔºåÊâìÂºÄloc">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/bg/27.jpg">
<meta property="article:published_time" content="2025-03-03T09:12:02.000Z">
<meta property="article:modified_time" content="2025-10-14T03:13:05.006Z">
<meta property="article:author" content="ranzier">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="javase">
<meta property="article:tag" content="ËãçÁ©πÂ§ñÂçñ">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/bg/27.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>ËãçÁ©πÂ§ñÂçñÂ≠¶‰π†Á¨îËÆ∞(Ë∑≥ËøáÂæÆ‰ø°ÊîØ‰ªò) - RANZIER</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ‰∏ªÈ¢ò‰æùËµñÁöÑÂõæÊ†áÂ∫ìÔºå‰∏çË¶ÅËá™Ë°å‰øÆÊîπ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3846514_kabxni94auf.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/gundongtiao.css">
<link rel="stylesheet" href="/css/bubble.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"üåü","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>RANZIER</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>È¶ñÈ°µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>ÂΩíÊ°£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>ÂàÜÁ±ª</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Ê†áÁ≠æ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>ÂÖ≥‰∫é</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bg/3.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.35)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ËãçÁ©πÂ§ñÂçñÂ≠¶‰π†Á¨îËÆ∞(Ë∑≥ËøáÂæÆ‰ø°ÊîØ‰ªò)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-03-03 17:12" pubdate>
          2025Âπ¥3Êúà3Êó• ‰∏ãÂçà
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          22k Â≠ó
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          112 ÂàÜÈíü
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          Êú¨ÊñáÈòÖËØªÊ¨°Êï∞Ôºö<span id="busuanzi_value_page_pv"></span> Ê¨°
        </span>
        

      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ËãçÁ©πÂ§ñÂçñÂ≠¶‰π†Á¨îËÆ∞(Ë∑≥ËøáÂæÆ‰ø°ÊîØ‰ªò)</h1>
            
            
              <div class="markdown-body">
                
                <h1 align="center">ËãçÁ©πÂ§ñÂçñÂ≠¶‰π†Á¨îËÆ∞</h1>

<h1 id="‰∏Ä-È°πÁõÆÊ¶ÇËø∞„ÄÅÁéØÂ¢ÉÊê≠Âª∫"><a href="#‰∏Ä-È°πÁõÆÊ¶ÇËø∞„ÄÅÁéØÂ¢ÉÊê≠Âª∫" class="headerlink" title="‰∏Ä. È°πÁõÆÊ¶ÇËø∞„ÄÅÁéØÂ¢ÉÊê≠Âª∫"></a>‰∏Ä. È°πÁõÆÊ¶ÇËø∞„ÄÅÁéØÂ¢ÉÊê≠Âª∫</h1><h2 id="1-ËΩØ‰ª∂ÂºÄÂèëÊï¥‰ΩìÊµÅÁ®ã"><a href="#1-ËΩØ‰ª∂ÂºÄÂèëÊï¥‰ΩìÊµÅÁ®ã" class="headerlink" title="1. ËΩØ‰ª∂ÂºÄÂèëÊï¥‰ΩìÊµÅÁ®ã"></a>1. ËΩØ‰ª∂ÂºÄÂèëÊï¥‰ΩìÊµÅÁ®ã</h2><ol>
<li><strong>ÈúÄÊ±ÇÂàÜÊûê</strong>: ÈúÄÊ±ÇËßÑÊ†ºËØ¥Êòé‰π¶„ÄÅ‰∫ßÂìÅÂéüÂûã</li>
<li><strong>ËÆæËÆ°</strong>: UIËÆæËÆ°„ÄÅÊï∞ÊçÆÂ∫ìËÆæËÆ°„ÄÅÊé•Âè£ËÆæËÆ°</li>
<li><strong>ÁºñÁ†Å</strong>: È°πÁõÆ‰ª£Á†Å„ÄÅÂçïÂÖÉÊµãËØï</li>
<li><strong>ÊµãËØï</strong>: ÊµãËØïÁî®‰æã„ÄÅÊµãËØïÊä•Âëä</li>
<li><strong>‰∏äÁ∫øËøêÁª¥</strong>: ËΩØ‰ª∂ÁéØÂ¢ÉÂÆâË£Ö„ÄÅÈÖçÁΩÆ</li>
</ol>
<h2 id="2-ÊäÄÊúØÈÄâÂûã"><a href="#2-ÊäÄÊúØÈÄâÂûã" class="headerlink" title="2. ÊäÄÊúØÈÄâÂûã"></a>2. ÊäÄÊúØÈÄâÂûã</h2><p>È°πÁõÆ‰∏≠‰ΩøÁî®Âà∞ÁöÑÊäÄÊúØÊ°ÜÊû∂Âíå‰∏≠Èó¥‰ª∂<br><img src="/img/blogs/java/cangqiongtakeout/1.2.1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="3-ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫"><a href="#3-ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫" class="headerlink" title="3. ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫"></a>3. ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫</h2><h3 id="3-1-ÂâçÁ´ØÁéØÂ¢ÉÊê≠Âª∫-nginx"><a href="#3-1-ÂâçÁ´ØÁéØÂ¢ÉÊê≠Âª∫-nginx" class="headerlink" title="3.1 ÂâçÁ´ØÁéØÂ¢ÉÊê≠Âª∫(nginx)"></a>3.1 ÂâçÁ´ØÁéØÂ¢ÉÊê≠Âª∫(nginx)</h3><p>ÂâçÁ´ØÊàë‰ª¨Â∞±‰∏çËá™Â∑±ÂÜô‰ª£Á†Å‰∫Ü<br>Áõ¥Êé•ÊâìÂºÄ<strong>nginx.exe</strong>ËøêË°åÔºåÊâìÂºÄ<code>localhost:80</code>Á´ØÂè£ËÆøÈóÆÂâçÁ´ØÈ°µÈù¢</p>
<h3 id="3-2-ÂêéÁ´ØÁéØÂ¢ÉÊê≠Âª∫"><a href="#3-2-ÂêéÁ´ØÁéØÂ¢ÉÊê≠Âª∫" class="headerlink" title="3.2 ÂêéÁ´ØÁéØÂ¢ÉÊê≠Âª∫"></a>3.2 ÂêéÁ´ØÁéØÂ¢ÉÊê≠Âª∫</h3><h4 id="3-2-1-ÁÜüÊÇâÈ°πÁõÆÁªìÊûÑ"><a href="#3-2-1-ÁÜüÊÇâÈ°πÁõÆÁªìÊûÑ" class="headerlink" title="3.2.1 ÁÜüÊÇâÈ°πÁõÆÁªìÊûÑ"></a>3.2.1 ÁÜüÊÇâÈ°πÁõÆÁªìÊûÑ</h4><ul>
<li>ÂêéÁ´ØÂ∑•Á®ãÂü∫‰∫é<strong>maven</strong>ËøõË°åÈ°πÁõÆÊûÑÂª∫ÔºåÂπ∂‰∏îËøõË°å<strong>ÂàÜÊ®°Âùó</strong>ÂºÄÂèë</li>
<li>Áî®ideaÊâìÂºÄ<code>sky-take-out</code>Â∑•Á®ã</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.1.png" srcset="/img/loading.gif" lazyload></p>
<table>
<thead>
<tr>
<th>Â∫èÂè∑</th>
<th>ÂêçÁß∞</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>sky-take-out</td>
<td>mavenÁà∂Â∑•Á®ãÔºåÁªü‰∏ÄÁÆ°ÁêÜ‰æùËµñÁâàÊú¨ÔºåËÅöÂêàÂÖ∂‰ªñÂ≠êÊ®°Âùó</td>
</tr>
<tr>
<td>2</td>
<td>sky-common</td>
<td>Â≠êÊ®°ÂùóÔºåÂ≠òÊîæÂÖ¨ÂÖ±Á±ªÔºå‰æãÂ¶ÇÔºöÂ∑•ÂÖ∑Á±ª„ÄÅÂ∏∏ÈáèÁ±ª„ÄÅÂºÇÂ∏∏Á±ªÁ≠â</td>
</tr>
<tr>
<td>3</td>
<td>sky-pojo</td>
<td>Â≠êÊ®°ÂùóÔºåÂ≠òÊîæÂÆû‰ΩìÁ±ª„ÄÅVO„ÄÅDTOÁ≠â</td>
</tr>
<tr>
<td>4</td>
<td>sky-server</td>
<td>Â≠êÊ®°ÂùóÔºåÂêéÁ´ØÊúçÂä°ÔºåÂ≠òÊîæÈÖçÁΩÆÊñá‰ª∂„ÄÅController„ÄÅService„ÄÅMapperÁ≠â</td>
</tr>
</tbody></table>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.2.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.3.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.4.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="3-2-2-‰ΩøÁî®GitËøõË°åÁâàÊú¨ÊéßÂà∂"><a href="#3-2-2-‰ΩøÁî®GitËøõË°åÁâàÊú¨ÊéßÂà∂" class="headerlink" title="3.2.2 ‰ΩøÁî®GitËøõË°åÁâàÊú¨ÊéßÂà∂"></a>3.2.2 ‰ΩøÁî®GitËøõË°åÁâàÊú¨ÊéßÂà∂</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_68356693/article/details/145806694?spm=1001.2014.3001.5501">GitÂ≠¶‰π†Á¨îËÆ∞</a></p>
<h5 id="3-2-2-1-ÂàõÂª∫Êú¨Âú∞‰ªìÂ∫ì"><a href="#3-2-2-1-ÂàõÂª∫Êú¨Âú∞‰ªìÂ∫ì" class="headerlink" title="3.2.2.1 ÂàõÂª∫Êú¨Âú∞‰ªìÂ∫ì"></a>3.2.2.1 ÂàõÂª∫Êú¨Âú∞‰ªìÂ∫ì</h5><ul>
<li>ÁÇπÂáªËèúÂçï-VCS-Create Git Repository-ÊâæÂà∞ÂΩìÂâçÈ°πÁõÆÁõÆÂΩï-ÁÇπÂáªOK</li>
<li>Â∞ÜÊú¨Âú∞Êñá‰ª∂ÂÖ®ÈÉ®Êèê‰∫§Âà∞Êú¨Âú∞‰ªìÂ∫ì(commit)</li>
</ul>
<h5 id="3-2-2-2-ÂàõÂª∫ËøúÁ®ã‰ªìÂ∫ì"><a href="#3-2-2-2-ÂàõÂª∫ËøúÁ®ã‰ªìÂ∫ì" class="headerlink" title="3.2.2.2 ÂàõÂª∫ËøúÁ®ã‰ªìÂ∫ì"></a>3.2.2.2 ÂàõÂª∫ËøúÁ®ã‰ªìÂ∫ì</h5><p>ÊâìÂºÄGiteeÔºåÁÇπÂáªÂä†Âè∑ÂàõÂª∫ËøúÁ®ã‰ªìÂ∫ì</p>
<h5 id="3-2-2-3-Â∞ÜÊú¨Âú∞Êñá‰ª∂Êé®ÈÄÅÂà∞GitËøúÁ®ã‰ªìÂ∫ì"><a href="#3-2-2-3-Â∞ÜÊú¨Âú∞Êñá‰ª∂Êé®ÈÄÅÂà∞GitËøúÁ®ã‰ªìÂ∫ì" class="headerlink" title="3.2.2.3 Â∞ÜÊú¨Âú∞Êñá‰ª∂Êé®ÈÄÅÂà∞GitËøúÁ®ã‰ªìÂ∫ì"></a>3.2.2.3 Â∞ÜÊú¨Âú∞Êñá‰ª∂Êé®ÈÄÅÂà∞GitËøúÁ®ã‰ªìÂ∫ì</h5><p>ÁÇπÂáªpush,ËæìÂÖ•ËøúÁ®ã‰ªìÂ∫ìurlÔºåËæìÂÖ•Ë¥¶Âè∑ÂØÜÁ†ÅÔºåÊàêÂäüpush</p>
<h4 id="3-2-3-Êï∞ÊçÆÂ∫ìÁéØÂ¢ÉÊê≠Âª∫"><a href="#3-2-3-Êï∞ÊçÆÂ∫ìÁéØÂ¢ÉÊê≠Âª∫" class="headerlink" title="3.2.3 Êï∞ÊçÆÂ∫ìÁéØÂ¢ÉÊê≠Âª∫"></a>3.2.3 Êï∞ÊçÆÂ∫ìÁéØÂ¢ÉÊê≠Âª∫</h4><p>ËÆ∞ÂæóÂú®ÂëΩ‰ª§Ë°å‰∏≠ÊâìÂºÄmysqlËøûÊé•Ôºö<code>net start mysql</code><br>Âú®navicatÊâìÂºÄsqlÊñá‰ª∂ÔºåËøêË°åÂàõÂª∫Êï∞ÊçÆÂ∫ìÂÜÖÂÆπ<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/tkf021004/article/details/136098343">navicatËøêË°åsqlÊñá‰ª∂</a></p>
<h4 id="3-2-4-ÂâçÂêéÁ´ØËÅîË∞É"><a href="#3-2-4-ÂâçÂêéÁ´ØËÅîË∞É" class="headerlink" title="3.2.4 ÂâçÂêéÁ´ØËÅîË∞É"></a>3.2.4 ÂâçÂêéÁ´ØËÅîË∞É</h4><p><img src="/img/blogs/java/cangqiongtakeout/1.3.5.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>nginxÂèçÂêë‰ª£ÁêÜ</strong>:Â∞±ÊòØÂ∞ÜÂâçÁ´ØÂèëÈÄÅÁöÑÂä®ÊÄÅËØ∑Ê±ÇÁî±nginxËΩ¨ÂèëÂà∞ÂêéÁ´ØÊúçÂä°Âô®</p>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.6.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-3-ÂÆåÂñÑÁôªÂΩïÂäüËÉΩ"><a href="#3-3-ÂÆåÂñÑÁôªÂΩïÂäüËÉΩ" class="headerlink" title="3.3 ÂÆåÂñÑÁôªÂΩïÂäüËÉΩ"></a>3.3 ÂÆåÂñÑÁôªÂΩïÂäüËÉΩ</h3><p>‰ΩøÁî®md5Âä†ÂØÜÁÆóÊ≥ïÂ∞ÜÊòéÊñá123456Âä†ÂØÜ:<code>e10adc3949ba59abbe56e057f20f883e</code></p>
<ul>
<li>Êï∞ÊçÆÂ∫ì‰∏≠‰øÆÊîπÁÆ°ÁêÜÂëòÂØÜÁ†Å</li>
<li>java‰ª£Á†Å‰øÆÊîπÂØÜÁ†Å</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">password = DigestUtils.md5DigestAsHex(password.getBytes());<br></code></pre></td></tr></table></figure>

<h2 id="4-ÂØºÂÖ•Êé•Âè£ÊñáÊ°£"><a href="#4-ÂØºÂÖ•Êé•Âè£ÊñáÊ°£" class="headerlink" title="4. ÂØºÂÖ•Êé•Âè£ÊñáÊ°£"></a>4. ÂØºÂÖ•Êé•Âè£ÊñáÊ°£</h2><p>‰ΩøÁî®Apifox-ÂØºÂÖ•-ÈÄâÊã©YApi-Â∞ÜjsonÊñá‰ª∂ÂØºÂÖ•</p>
<h2 id="5-Swagger"><a href="#5-Swagger" class="headerlink" title="5. Swagger"></a>5. Swagger</h2><table>
<thead>
<tr>
<th>Ê≥®Ëß£</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td>@Api</td>
<td>Áî®Âú®Á±ª‰∏äÔºå‰æãÂ¶ÇControllerÔºåË°®Á§∫ÂØπÁ±ªÁöÑËØ¥Êòé</td>
</tr>
<tr>
<td>@ApiModel</td>
<td>Áî®Âú®Á±ª‰∏äÔºå‰æãÂ¶Çentity„ÄÅDTO„ÄÅVO</td>
</tr>
<tr>
<td>@ApiModelProperty</td>
<td>Áî®Âú®Â±ûÊÄß‰∏äÔºåÊèèËø∞Â±ûÊÄß‰ø°ÊÅØ</td>
</tr>
<tr>
<td>@ApiOperation</td>
<td>Áî®Âú®ÊñπÊ≥ï‰∏äÔºå‰æãÂ¶ÇControllerÁöÑÊñπÊ≥ïÔºåËØ¥ÊòéÊñπÊ≥ïÁöÑÁî®ÈÄî„ÄÅ‰ΩúÁî®</td>
</tr>
</tbody></table>
<h1 id="‰∫å-ÂëòÂ∑•ÁÆ°ÁêÜ„ÄÅÂàÜÁ±ªÁÆ°ÁêÜ"><a href="#‰∫å-ÂëòÂ∑•ÁÆ°ÁêÜ„ÄÅÂàÜÁ±ªÁÆ°ÁêÜ" class="headerlink" title="‰∫å. ÂëòÂ∑•ÁÆ°ÁêÜ„ÄÅÂàÜÁ±ªÁÆ°ÁêÜ"></a>‰∫å. ÂëòÂ∑•ÁÆ°ÁêÜ„ÄÅÂàÜÁ±ªÁÆ°ÁêÜ</h1><h2 id="1-Êñ∞Â¢ûÂëòÂ∑•"><a href="#1-Êñ∞Â¢ûÂëòÂ∑•" class="headerlink" title="1. Êñ∞Â¢ûÂëòÂ∑•"></a>1. Êñ∞Â¢ûÂëòÂ∑•</h2><h3 id="1-1-ÂëòÂ∑•ÁöÑDTOÁ±ª-EmployeeDTO"><a href="#1-1-ÂëòÂ∑•ÁöÑDTOÁ±ª-EmployeeDTO" class="headerlink" title="1.1 ÂëòÂ∑•ÁöÑDTOÁ±ª(EmployeeDTO)"></a>1.1 ÂëòÂ∑•ÁöÑDTOÁ±ª(EmployeeDTO)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.dto;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmployeeDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String phone;<br>    <span class="hljs-keyword">private</span> String sex;<br>    <span class="hljs-keyword">private</span> String idNumber;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-ControllerÂ±Ç"><a href="#1-2-ControllerÂ±Ç" class="headerlink" title="1.2 ControllerÂ±Ç"></a>1.2 ControllerÂ±Ç</h3><p>Âú®EmployeeController‰∏≠<strong>ÂàõÂª∫Êñ∞Â¢ûÂëòÂ∑•ÊñπÊ≥ï</strong>ÔºåÊé•Êî∂ÂâçÁ´ØÊèê‰∫§ÁöÑÂèÇÊï∞„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.controller.admin.EmployeeController;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êñ∞Â¢ûÂëòÂ∑•</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-meta">@ApiOperation(&quot;Êñ∞Â¢ûÂëòÂ∑•&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;Êñ∞Â¢ûÂëòÂ∑•Ôºö&#123;&#125;&quot;</span>,employeeDTO);<br>    employeeService.save(employeeDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-ServiceÂ±Ç"><a href="#1-3-ServiceÂ±Ç" class="headerlink" title="1.3 ServiceÂ±Ç"></a>1.3 ServiceÂ±Ç</h3><h4 id="1-3-1-ServiceÂ±ÇÊé•Âè£"><a href="#1-3-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="1.3.1 ServiceÂ±ÇÊé•Âè£"></a>1.3.1 ServiceÂ±ÇÊé•Âè£</h4><p><strong>Âú®EmployeeServiceÊé•Âè£‰∏≠Â£∞ÊòéÊñ∞Â¢ûÂëòÂ∑•ÊñπÊ≥ï</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// package com.sky.server.EmployeeService;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êñ∞Â¢ûÂëòÂ∑•</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(EmployeeDTO employeeDTO)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#1-3-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="1.3.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>1.3.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><p><strong>Âú®EmployeeServiceImpl‰∏≠ÂÆûÁé∞Êñ∞Â¢ûÂëòÂ∑•ÊñπÊ≥ï</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.server.impl.EmployeeServiceImpl;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êñ∞Â¢ûÂëòÂ∑•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(EmployeeDTO employeeDTO)</span> &#123;<br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>();<br><br>    <span class="hljs-comment">//ÂØπË±°Â±ûÊÄßÊã∑Ë¥ù</span><br>    BeanUtils.copyProperties(employeeDTO, employee);<br><br>    <span class="hljs-comment">//ËÆæÁΩÆË¥¶Âè∑ÁöÑÁä∂ÊÄÅÔºåÈªòËÆ§Ê≠£Â∏∏Áä∂ÊÄÅ 1Ë°®Á§∫Ê≠£Â∏∏ 0Ë°®Á§∫ÈîÅÂÆö</span><br>    employee.setStatus(StatusConstant.ENABLE);<br><br>    <span class="hljs-comment">//ËÆæÁΩÆÂØÜÁ†ÅÔºåÈªòËÆ§ÂØÜÁ†Å123456</span><br>    employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes()));<br><br>    <span class="hljs-comment">//ËÆæÁΩÆÂΩìÂâçËÆ∞ÂΩïÁöÑÂàõÂª∫Êó∂Èó¥Âíå‰øÆÊîπÊó∂Èó¥</span><br>    employee.setCreateTime(LocalDateTime.now());<br>    employee.setUpdateTime(LocalDateTime.now());<br><br>    <span class="hljs-comment">//ËÆæÁΩÆÂΩìÂâçËÆ∞ÂΩïÂàõÂª∫‰∫∫idÂíå‰øÆÊîπ‰∫∫id</span><br>    employee.setCreateUser(BaseContext.getCurrentId());<br>    employee.setUpdateUser(BaseContext.getCurrentId());<br><br>    employeeMapper.insert(employee);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-4-MapperÂ±Ç"><a href="#1-4-MapperÂ±Ç" class="headerlink" title="1.4 MapperÂ±Ç"></a>1.4 MapperÂ±Ç</h3><p><strong>Âú®EmployeeMapper‰∏≠Â£∞ÊòéinsertÊñπÊ≥ï</strong></p>
<p>‰∏≠Ê∑ªÂä†ÊñπÊ≥ï</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.EmployeeMapper;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÊèíÂÖ•ÂëòÂ∑•Êï∞ÊçÆ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employee</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Insert(&quot;insert into employee (name, username, password, phone, sex, id_number, create_time, update_time, create_user, update_user,status) &quot; +</span><br><span class="hljs-meta">        &quot;values &quot; +</span><br><span class="hljs-meta">        &quot;(#&#123;name&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;phone&#125;,#&#123;sex&#125;,#&#123;idNumber&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;,#&#123;createUser&#125;,#&#123;updateUser&#125;,#&#123;status&#125;)&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Employee employee)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-5-Â§ÑÁêÜSQLÂºÇÂ∏∏ÊäõÂá∫"><a href="#1-5-Â§ÑÁêÜSQLÂºÇÂ∏∏ÊäõÂá∫" class="headerlink" title="1.5 Â§ÑÁêÜSQLÂºÇÂ∏∏ÊäõÂá∫"></a>1.5 Â§ÑÁêÜSQLÂºÇÂ∏∏ÊäõÂá∫</h3><ul>
<li><strong>ÈóÆÈ¢ò</strong>ÔºöÂΩìÂΩïÂÖ•ÁöÑÁî®Êà∑ÂêçÂ∑≤ÁªèÂ≠òÂú®Êó∂ÔºåÊäõÂá∫ÁöÑÂºÇÂ∏∏ÂêéÊ≤°ÊúâÂ§ÑÁêÜ</li>
<li><strong>ÂéüÂõ†</strong>ÔºöusernameÂ∑≤ÁªèÊ∑ªÂä†‰∫ÜÂîØ‰∏ÄÁ∫¶ÊùüÔºå‰∏çËÉΩÈáçÂ§ç</li>
<li><strong>Ëß£ÂÜ≥ÊñπÊ°à</strong>ÔºöÈÄöËøáÂÖ®Â±ÄÂºÇÂ∏∏Â§ÑÁêÜÂô®Â§ÑÁêÜ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.handler.GlobalExceptionHandler;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Â§ÑÁêÜSQLÂºÇÂ∏∏</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ex</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ExceptionHandler</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">exceptionHandler</span><span class="hljs-params">(SQLIntegrityConstraintViolationException ex)</span>&#123;<br>    <span class="hljs-comment">//Duplicate entry &#x27;zhangsan&#x27; for key &#x27;employee.idx_username&#x27;</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> ex.getMessage();<br>    <span class="hljs-keyword">if</span>(message.contains(<span class="hljs-string">&quot;Duplicate entry&quot;</span>))&#123;<br>        String[] split = message.split(<span class="hljs-string">&quot; &quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> split[<span class="hljs-number">2</span>];<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> username + MessageConstant.ALREADY_EXISTS;<br>        <span class="hljs-keyword">return</span> Result.error(msg);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> Result.error(MessageConstant.UNKNOWN_ERROR);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ÁÑ∂ÂêéÂÆö‰πâÊ∑ªÂä†Áõ∏Â∫îÁöÑÊ∂àÊÅØÂ∏∏Èáè</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.constant.MessageConstant;</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ALREADY_EXISTS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Â∑≤Â≠òÂú®&quot;</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-6-ThreadLocal"><a href="#1-6-ThreadLocal" class="headerlink" title="1.6 ThreadLocal"></a>1.6 ThreadLocal</h3><ul>
<li>ThreadLocal Âπ∂‰∏çÊòØ‰∏Ä‰∏™ThreadÔºåËÄåÊòØ<strong>ThreadÁöÑÂ±ÄÈÉ®ÂèòÈáè</strong>„ÄÇ</li>
<li>ThreadLocal‰∏∫ÊØè‰∏™Á∫øÁ®ãÊèê‰æõÂçïÁã¨‰∏Ä‰ªΩÂ≠òÂÇ®Á©∫Èó¥ÔºåÂÖ∑ÊúâÁ∫øÁ®ãÈöîÁ¶ªÁöÑÊïàÊûúÔºåÂè™ÊúâÂú®Á∫øÁ®ãÂÜÖÊâçËÉΩËé∑ÂèñÂà∞ÂØπÂ∫îÁöÑÂÄºÔºåÁ∫øÁ®ãÂ§ñÂàô‰∏çËÉΩËÆøÈóÆ„ÄÇ</li>
</ul>
<p><strong>Â∏∏Áî®ÊñπÊ≥ï</strong></p>
<table>
<thead>
<tr>
<th>Â∏∏Áî®ÊñπÊ≥ï</th>
<th>‰ΩúÁî®</th>
</tr>
</thead>
<tbody><tr>
<td>public void set(T value)</td>
<td>ËÆæÁΩÆÂΩìÂâçÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáèÁöÑÂÄº</td>
</tr>
<tr>
<td>public T get()</td>
<td>ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÊâÄÂØπÂ∫îÁöÑÁ∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáèÁöÑÂÄº</td>
</tr>
<tr>
<td>public void remove()</td>
<td>ÁßªÈô§ÂΩìÂâçÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáè</td>
</tr>
</tbody></table>
<h3 id="1-7-Ëé∑ÂèñÂΩìÂâçÁôªÂΩïÂëòÂ∑•ÁöÑID"><a href="#1-7-Ëé∑ÂèñÂΩìÂâçÁôªÂΩïÂëòÂ∑•ÁöÑID" class="headerlink" title="1.7 Ëé∑ÂèñÂΩìÂâçÁôªÂΩïÂëòÂ∑•ÁöÑID"></a>1.7 Ëé∑ÂèñÂΩìÂâçÁôªÂΩïÂëòÂ∑•ÁöÑID</h3><ul>
<li><strong>ÈóÆÈ¢ò</strong>ÔºöÂëòÂ∑•ÁôªÂΩïÊàêÂäüÂêé‰ºöÁîüÊàêJWT‰ª§ÁâåÂπ∂ÂìçÂ∫îÁªôÂâçÁ´Ø„ÄÇÂêéÁª≠ËØ∑Ê±Ç‰∏≠ÔºåÂâçÁ´Ø‰ºöÊê∫Â∏¶JWT‰ª§ÁâåÔºåÈÄöËøáJWT‰ª§ÁâåÂèØ‰ª•Ëß£ÊûêÂá∫ÂΩìÂâçÁôªÂΩïÂëòÂ∑•idÔºö</li>
<li><strong>Ëß£ÂÜ≥ÊñπÊ°à</strong>ÔºöÈÄöËøáThreadLocalËøõË°å‰º†ÈÄí„ÄÇ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.interceptor.JwtTokenAdminInterceptor;</span><br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtTokenAdminInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br>		<span class="hljs-comment">//.............................</span><br>        <span class="hljs-comment">//2„ÄÅÊ†°È™å‰ª§Áâå</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//.................</span><br>            <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> JwtUtil.parseJWT(jwtProperties.getAdminSecretKey(), token);<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">empId</span> <span class="hljs-operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.EMP_ID).toString());<br>            log.info(<span class="hljs-string">&quot;ÂΩìÂâçÂëòÂ∑•idÔºö&quot;</span>, empId);<br>            <span class="hljs-comment">/////Â∞ÜÁî®Êà∑idÂ≠òÂÇ®Âà∞ThreadLocal////////</span><br>            BaseContext.setCurrentId(empId);<br>            <span class="hljs-comment">////////////////////////////////////</span><br>            <span class="hljs-comment">//3„ÄÅÈÄöËøáÔºåÊîæË°å</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            <span class="hljs-comment">//......................</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢"><a href="#2-ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢" class="headerlink" title="2. ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢"></a>2. ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢</h2><h3 id="2-1-ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢ÁöÑDTO"><a href="#2-1-ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢ÁöÑDTO" class="headerlink" title="2.1 ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢ÁöÑDTO"></a>2.1 ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢ÁöÑDTO</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.dto;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmployeePageQueryDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-comment">//ÂëòÂ∑•ÂßìÂêç</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-comment">//È°µÁ†Å</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> page;<br><br>    <span class="hljs-comment">//ÊØèÈ°µÊòæÁ§∫ËÆ∞ÂΩïÊï∞</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> pageSize;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-ControllerÂ±Ç"><a href="#2-2-ControllerÂ±Ç" class="headerlink" title="2.2 ControllerÂ±Ç"></a>2.2 ControllerÂ±Ç</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// package com.sky.controller.admin.EmployeeController;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeePageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(EmployeePageQueryDTO employeePageQueryDTO)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;ÂëòÂ∑•ÂàÜÈ°µÊü•ËØ¢ÔºåÂèÇÊï∞‰∏∫Ôºö&#123;&#125;&quot;</span>, employeePageQueryDTO);<br>    <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> employeeService.pageQuery(employeePageQueryDTO);<span class="hljs-comment">//ÂêéÁª≠ÂÆö‰πâ</span><br>    <span class="hljs-keyword">return</span> Result.success(pageResult);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-ServiceÂ±Ç"><a href="#2-3-ServiceÂ±Ç" class="headerlink" title="2.3 ServiceÂ±Ç"></a>2.3 ServiceÂ±Ç</h3><h4 id="2-3-1-ServiceÂ±ÇÊé•Âè£"><a href="#2-3-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="2.3.1 ServiceÂ±ÇÊé•Âè£"></a>2.3.1 ServiceÂ±ÇÊé•Âè£</h4><p>Âú®EmployeeServiceÊé•Âè£‰∏≠Â£∞ÊòépageQueryÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeePageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="2-3-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#2-3-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="2.3.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>2.3.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><p>Âú®EmployeeServiceImpl‰∏≠ÂÆûÁé∞pageQueryÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeePageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(EmployeePageQueryDTO employeePageQueryDTO)</span> &#123;<br>    <span class="hljs-comment">// select * from employee limit 0,10</span><br>    <span class="hljs-comment">//ÂºÄÂßãÂàÜÈ°µÊü•ËØ¢</span><br>    PageHelper.startPage(employeePageQueryDTO.getPage(), employeePageQueryDTO.getPageSize());<br><br>    Page&lt;Employee&gt; page = employeeMapper.pageQuery(employeePageQueryDTO);<br><br>    <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> page.getTotal();<br>    List&lt;Employee&gt; records = page.getResult();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(total, records);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-MapperÂ±Ç"><a href="#2-4-MapperÂ±Ç" class="headerlink" title="2.4 MapperÂ±Ç"></a>2.4 MapperÂ±Ç</h3><p>Âú® EmployeeMapper ‰∏≠Â£∞Êòé pageQuery ÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeePageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>Page&lt;Employee&gt; <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<p>Âú® src&#x2F;main&#x2F;resources&#x2F;mapper&#x2F;EmployeeMapper.xml ‰∏≠ÁºñÂÜôSQLÔºö</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> id<span class="hljs-operator">=</span>&quot;pageQuery&quot; resultType<span class="hljs-operator">=</span>&quot;com.sky.entity.Employee&quot;<span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee<br>        <span class="hljs-operator">&lt;</span><span class="hljs-keyword">where</span><span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;name != null and name != &#x27;&#x27;&quot;<span class="hljs-operator">&gt;</span><br>                <span class="hljs-keyword">and</span> name <span class="hljs-keyword">like</span> concat(<span class="hljs-string">&#x27;%&#x27;</span>,#&#123;name&#125;,<span class="hljs-string">&#x27;%&#x27;</span>)<br>            <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>        <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">where</span><span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> create_time <span class="hljs-keyword">desc</span><br>    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">select</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="2-5-Êó•ÊúüÊ†ºÂºèÂåñ"><a href="#2-5-Êó•ÊúüÊ†ºÂºèÂåñ" class="headerlink" title="2.5 Êó•ÊúüÊ†ºÂºèÂåñ"></a>2.5 Êó•ÊúüÊ†ºÂºèÂåñ</h3><ul>
<li><strong>ÈóÆÈ¢ò</strong>ÔºöÊìç‰ΩúÊó∂Èó¥Â≠óÊÆµÊòæÁ§∫ÊúâÈóÆÈ¢ò„ÄÇÂâçÁ´ØÊòæÁ§∫ÁöÑÊó∂Èó¥Ê†ºÂºè‰∏çÊ†áÂáÜ</li>
<li><strong>Ëß£ÂÜ≥ÊñπÊ°à</strong>ÔºöÂú®WebMvcConfiguration‰∏≠Êâ©Â±ïSpringMVCÁöÑÊ∂àÊÅØËΩ¨Êç¢Âô®ÔºåÁªü‰∏ÄÂØπÊó•ÊúüÁ±ªÂûãËøõË°åÊ†ºÂºèÂ§ÑÁêÜ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êâ©Â±ïSpring MVCÊ°ÜÊû∂ÁöÑÊ∂àÊÅØËΩ¨ÂåñÂô®</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> converters</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extendMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;Êâ©Â±ïÊ∂àÊÅØËΩ¨Êç¢Âô®...&quot;</span>);<br>    <span class="hljs-comment">//ÂàõÂª∫‰∏Ä‰∏™Ê∂àÊÅØËΩ¨Êç¢Âô®ÂØπË±°</span><br>    <span class="hljs-type">MappingJackson2HttpMessageConverter</span> <span class="hljs-variable">converter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2HttpMessageConverter</span>();<br>    <span class="hljs-comment">//ÈúÄË¶Å‰∏∫Ê∂àÊÅØËΩ¨Êç¢Âô®ËÆæÁΩÆ‰∏Ä‰∏™ÂØπË±°ËΩ¨Êç¢Âô®ÔºåÂØπË±°ËΩ¨Êç¢Âô®ÂèØ‰ª•Â∞ÜJavaÂØπË±°Â∫èÂàóÂåñ‰∏∫jsonÊï∞ÊçÆ</span><br>    converter.setObjectMapper(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JacksonObjectMapper</span>());<br>    <span class="hljs-comment">//Â∞ÜËá™Â∑±ÁöÑÊ∂àÊÅØËΩ¨ÂåñÂô®Âä†ÂÖ•ÂÆπÂô®‰∏≠</span><br>    converters.add(<span class="hljs-number">0</span>,converter);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑"><a href="#3-ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑" class="headerlink" title="3. ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑"></a>3. ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑</h2><h3 id="3-1-ControllerÂ±Ç"><a href="#3-1-ControllerÂ±Ç" class="headerlink" title="3.1 ControllerÂ±Ç"></a>3.1 ControllerÂ±Ç</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// package com.sky.controller.admin.EmployeeController;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status,Long id)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑Ôºö&#123;&#125;,&#123;&#125;&quot;</span>,status,id);<br>    employeeService.startOrStop(status,id);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂÆö‰πâ</span><br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-ServiceÂ±Ç"><a href="#3-2-ServiceÂ±Ç" class="headerlink" title="3.2 ServiceÂ±Ç"></a>3.2 ServiceÂ±Ç</h3><h4 id="3-2-1-ServiceÂ±ÇÊé•Âè£"><a href="#3-2-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="3.2.1 ServiceÂ±ÇÊé•Âè£"></a>3.2.1 ServiceÂ±ÇÊé•Âè£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-comment">//package com.sky.service.EmployeeService;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#3-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="3.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>3.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-comment">//package com.sky.service.impl.EmployeeServiceImpl;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span> &#123;<br>       <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> Employee.builder()<br>               .status(status)<br>               .id(id)<br>               .build();<br><br>       employeeMapper.update(employee);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-MapperÂ±Ç"><a href="#3-3-MapperÂ±Ç" class="headerlink" title="3.3 MapperÂ±Ç"></a>3.3 MapperÂ±Ç</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-comment">//package com.sky.mapper.EmployeeMapper;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆ‰∏ªÈîÆÂä®ÊÄÅ‰øÆÊîπÂ±ûÊÄß</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> employee</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Employee employee)</span>;<br></code></pre></td></tr></table></figure>

<p>Âú® EmployeeMapper.xml ‰∏≠ÁºñÂÜôSQLÔºö</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">update</span> id<span class="hljs-operator">=</span>&quot;update&quot; parameterType<span class="hljs-operator">=</span>&quot;Employee&quot;<span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">update</span> employee<br>        <span class="hljs-operator">&lt;</span><span class="hljs-keyword">set</span><span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;name != null&quot;<span class="hljs-operator">&gt;</span>name <span class="hljs-operator">=</span> #&#123;name&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;username != null&quot;<span class="hljs-operator">&gt;</span>username <span class="hljs-operator">=</span> #&#123;username&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;password != null&quot;<span class="hljs-operator">&gt;</span>password <span class="hljs-operator">=</span> #&#123;password&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;phone != null&quot;<span class="hljs-operator">&gt;</span>phone <span class="hljs-operator">=</span> #&#123;phone&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;sex != null&quot;<span class="hljs-operator">&gt;</span>sex <span class="hljs-operator">=</span> #&#123;sex&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;idNumber != null&quot;<span class="hljs-operator">&gt;</span>id_Number <span class="hljs-operator">=</span> #&#123;idNumber&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;updateTime != null&quot;<span class="hljs-operator">&gt;</span>update_Time <span class="hljs-operator">=</span> #&#123;updateTime&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;updateUser != null&quot;<span class="hljs-operator">&gt;</span>update_User <span class="hljs-operator">=</span> #&#123;updateUser&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;status != null&quot;<span class="hljs-operator">&gt;</span>status <span class="hljs-operator">=</span> #&#123;status&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>        <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">set</span><span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> #&#123;id&#125;<br>    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">update</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="4-ÁºñËæëÂëòÂ∑•"><a href="#4-ÁºñËæëÂëòÂ∑•" class="headerlink" title="4. ÁºñËæëÂëòÂ∑•"></a>4. ÁºñËæëÂëòÂ∑•</h2><h3 id="4-1-ÂõûÊòæÂëòÂ∑•‰ø°ÊÅØÂäüËÉΩ"><a href="#4-1-ÂõûÊòæÂëòÂ∑•‰ø°ÊÅØÂäüËÉΩ" class="headerlink" title="4.1 ÂõûÊòæÂëòÂ∑•‰ø°ÊÅØÂäüËÉΩ"></a>4.1 ÂõûÊòæÂëòÂ∑•‰ø°ÊÅØÂäüËÉΩ</h3><h4 id="4-1-1-ControllerÂ±Ç"><a href="#4-1-1-ControllerÂ±Ç" class="headerlink" title="4.1.1 ControllerÂ±Ç"></a>4.1.1 ControllerÂ±Ç</h4><p>Âú® EmployeeController ‰∏≠ÂàõÂª∫ getById ÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆidÊü•ËØ¢ÂëòÂ∑•‰ø°ÊÅØ</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Ê†πÊçÆidÊü•ËØ¢ÂëòÂ∑•‰ø°ÊÅØ&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;Employee&gt; <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span>&#123;<br>       <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> employeeService.getById(id);<br>       <span class="hljs-keyword">return</span> Result.success(employee);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-1-2-ServiceÂ±Ç"><a href="#4-1-2-ServiceÂ±Ç" class="headerlink" title="4.1.2 ServiceÂ±Ç"></a>4.1.2 ServiceÂ±Ç</h4><h5 id="4-1-2-1-ServiceÂ±ÇÊé•Âè£"><a href="#4-1-2-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="4.1.2.1 ServiceÂ±ÇÊé•Âè£"></a>4.1.2.1 ServiceÂ±ÇÊé•Âè£</h5><p>Âú® EmployeeService Êé•Âè£‰∏≠Â£∞Êòé getById ÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê†πÊçÆidÊü•ËØ¢ÂëòÂ∑•</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>Employee <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h5 id="4-1-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#4-1-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="4.1.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>4.1.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h5><p>Âú® EmployeeServiceImpl ‰∏≠ÂÆûÁé∞ getById ÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê†πÊçÆidÊü•ËØ¢ÂëòÂ∑•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> Employee <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> employeeMapper.getById(id);<br>    employee.setPassword(<span class="hljs-string">&quot;****&quot;</span>);<br>    <span class="hljs-keyword">return</span> employee;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-1-3-MapperÂ±Ç"><a href="#4-1-3-MapperÂ±Ç" class="headerlink" title="4.1.3 MapperÂ±Ç"></a>4.1.3 MapperÂ±Ç</h4><p>Âú® EmployeeMapper Êé•Âè£‰∏≠Â£∞Êòé getById ÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê†πÊçÆidÊü•ËØ¢ÂëòÂ∑•‰ø°ÊÅØ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Select(&quot;select * from employee where id = #&#123;id&#125;&quot;)</span><br>Employee <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-‰øÆÊîπÂëòÂ∑•‰ø°ÊÅØÂäüËÉΩ"><a href="#4-2-‰øÆÊîπÂëòÂ∑•‰ø°ÊÅØÂäüËÉΩ" class="headerlink" title="4.2 ‰øÆÊîπÂëòÂ∑•‰ø°ÊÅØÂäüËÉΩ"></a>4.2 ‰øÆÊîπÂëòÂ∑•‰ø°ÊÅØÂäüËÉΩ</h3><h4 id="4-2-1-ControllerÂ±Ç"><a href="#4-2-1-ControllerÂ±Ç" class="headerlink" title="4.2.1 ControllerÂ±Ç"></a>4.2.1 ControllerÂ±Ç</h4><p>Âú® EmployeeController ‰∏≠ÂàõÂª∫ update ÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÁºñËæëÂëòÂ∑•‰ø°ÊÅØ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping</span><br><span class="hljs-meta">@ApiOperation(&quot;ÁºñËæëÂëòÂ∑•‰ø°ÊÅØ&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;ÁºñËæëÂëòÂ∑•‰ø°ÊÅØÔºö&#123;&#125;&quot;</span>, employeeDTO);<br>    employeeService.update(employeeDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-2-2-ServiceÂ±Ç"><a href="#4-2-2-ServiceÂ±Ç" class="headerlink" title="4.2.2 ServiceÂ±Ç"></a>4.2.2 ServiceÂ±Ç</h4><h5 id="4-2-2-1-ServiceÂ±ÇÊé•Âè£"><a href="#4-2-2-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="4.2.2.1 ServiceÂ±ÇÊé•Âè£"></a>4.2.2.1 ServiceÂ±ÇÊé•Âè£</h5><p>Âú® EmployeeService Êé•Âè£‰∏≠Â£∞Êòé update ÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÁºñËæëÂëòÂ∑•‰ø°ÊÅØ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(EmployeeDTO employeeDTO)</span>;<br></code></pre></td></tr></table></figure>

<h5 id="4-2-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#4-2-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="4.2.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>4.2.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h5><p>Âú® EmployeeServiceImpl ‰∏≠ÂÆûÁé∞ update ÊñπÊ≥ïÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÁºñËæëÂëòÂ∑•‰ø°ÊÅØ</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(EmployeeDTO employeeDTO)</span> &#123;<br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>();<br>    BeanUtils.copyProperties(employeeDTO, employee);<br><br>    employee.setUpdateTime(LocalDateTime.now());<br>    employee.setUpdateUser(BaseContext.getCurrentId());<br><br>    employeeMapper.update(employee);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-2-3-MapperÂ±Ç"><a href="#4-2-3-MapperÂ±Ç" class="headerlink" title="4.2.3 MapperÂ±Ç"></a>4.2.3 MapperÂ±Ç</h4><p>Âú®ÂÆûÁé∞<strong>ÂêØÁî®Á¶ÅÁî®ÂëòÂ∑•Ë¥¶Âè∑</strong>ÂäüËÉΩÊó∂ÔºåÂ∑≤ÂÆûÁé∞employeeMapper.update(employee)ÔºåÂú®Ê≠§‰∏çÈúÄÂÜôMapperÂ±Ç‰ª£Á†Å„ÄÇ</p>
<h2 id="5-ËèúÂìÅÂàÜÁ±ªÂíåÂ•óÈ§êÂàÜÁ±ª"><a href="#5-ËèúÂìÅÂàÜÁ±ªÂíåÂ•óÈ§êÂàÜÁ±ª" class="headerlink" title="5. ËèúÂìÅÂàÜÁ±ªÂíåÂ•óÈ§êÂàÜÁ±ª"></a>5. ËèúÂìÅÂàÜÁ±ªÂíåÂ•óÈ§êÂàÜÁ±ª</h2><p>Áõ¥Êé•ÂØºÂÖ•Áõ∏Â∫î‰ª£Á†ÅÂ∑•Á®ã</p>
<h1 id="‰∏â-ËèúÂìÅÁÆ°ÁêÜ"><a href="#‰∏â-ËèúÂìÅÁÆ°ÁêÜ" class="headerlink" title="‰∏â. ËèúÂìÅÁÆ°ÁêÜ"></a>‰∏â. ËèúÂìÅÁÆ°ÁêÜ</h1><h2 id="1-ÂÖ¨ÂÖ±Â≠óÊÆµËá™Âä®Â°´ÂÖÖ"><a href="#1-ÂÖ¨ÂÖ±Â≠óÊÆµËá™Âä®Â°´ÂÖÖ" class="headerlink" title="1. ÂÖ¨ÂÖ±Â≠óÊÆµËá™Âä®Â°´ÂÖÖ"></a>1. ÂÖ¨ÂÖ±Â≠óÊÆµËá™Âä®Â°´ÂÖÖ</h2><h3 id="1-1-ÂÆûÁé∞ÊÄùË∑Ø"><a href="#1-1-ÂÆûÁé∞ÊÄùË∑Ø" class="headerlink" title="1.1 ÂÆûÁé∞ÊÄùË∑Ø"></a>1.1 ÂÆûÁé∞ÊÄùË∑Ø</h3><p><strong>ÂÆûÁé∞Ê≠•È™§</strong>Ôºö</p>
<ol>
<li>Ëá™ÂÆö‰πâÊ≥®Ëß£ AutoFillÔºåÁî®‰∫éÊ†áËØÜÈúÄË¶ÅËøõË°åÂÖ¨ÂÖ±Â≠óÊÆµËá™Âä®Â°´ÂÖÖÁöÑÊñπÊ≥ï</li>
<li>Ëá™ÂÆö‰πâÂàáÈù¢Á±ª AutoFillAspectÔºåÁªü‰∏ÄÊã¶Êà™Âä†ÂÖ•‰∫Ü AutoFill Ê≥®Ëß£ÁöÑÊñπÊ≥ïÔºåÈÄöËøáÂèçÂ∞Ñ‰∏∫ÂÖ¨ÂÖ±Â≠óÊÆµËµãÂÄº</li>
<li>Âú® Mapper ÁöÑÊñπÊ≥ï‰∏äÂä†ÂÖ• AutoFill Ê≥®Ëß£</li>
</ol>
<p><strong>ÊäÄÊúØÁÇπ</strong>ÔºöÊûö‰∏æ„ÄÅÊ≥®Ëß£„ÄÅAOP„ÄÅÂèçÂ∞Ñ</p>
<h3 id="1-2-Ëá™ÂÆö‰πâÊ≥®Ëß£-AutoFill"><a href="#1-2-Ëá™ÂÆö‰πâÊ≥®Ëß£-AutoFill" class="headerlink" title="1.2 Ëá™ÂÆö‰πâÊ≥®Ëß£ AutoFill"></a>1.2 Ëá™ÂÆö‰πâÊ≥®Ëß£ AutoFill</h3><p>ËøõÂÖ•Âà∞sky-serverÊ®°ÂùóÔºåÂàõÂª∫com.sky.annotationÂåÖ„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.annotation;<br><br><span class="hljs-keyword">import</span> com.sky.enumeration.OperationType;<br><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ëá™ÂÆö‰πâÊ≥®Ëß£ÔºåÁî®‰∫éÊ†áËØÜÊüê‰∏™ÊñπÊ≥ïÈúÄË¶ÅËøõË°åÂäüËÉΩÂ≠óÊÆµËá™Âä®Â°´ÂÖÖÂ§ÑÁêÜ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoFill &#123;<br>    <span class="hljs-comment">//Êï∞ÊçÆÂ∫ìÊìç‰ΩúÁ±ªÂûãÔºöUPDATE INSERT</span><br>    OperationType <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-Ëá™ÂÆö‰πâÂàáÈù¢-AutoFillAspect"><a href="#1-3-Ëá™ÂÆö‰πâÂàáÈù¢-AutoFillAspect" class="headerlink" title="1.3 Ëá™ÂÆö‰πâÂàáÈù¢ AutoFillAspect"></a>1.3 Ëá™ÂÆö‰πâÂàáÈù¢ AutoFillAspect</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.aspect;<br><br><span class="hljs-keyword">import</span> com.sky.annotation.AutoFill;<br><span class="hljs-keyword">import</span> com.sky.constant.AutoFillConstant;<br><span class="hljs-keyword">import</span> com.sky.context.BaseContext;<br><span class="hljs-keyword">import</span> com.sky.enumeration.OperationType;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.aspectj.lang.JoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;<br><span class="hljs-keyword">import</span> org.aspectj.lang.reflect.MethodSignature;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ëá™ÂÆö‰πâÂàáÈù¢ÔºåÂÆûÁé∞ÂÖ¨ÂÖ±Â≠óÊÆµËá™Âä®Â°´ÂÖÖÂ§ÑÁêÜÈÄªËæë</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoFillAspect</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂàáÂÖ•ÁÇπ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">autoFillPointCut</span><span class="hljs-params">()</span>&#123;&#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂâçÁΩÆÈÄöÁü•ÔºåÂú®ÈÄöÁü•‰∏≠ËøõË°åÂÖ¨ÂÖ±Â≠óÊÆµÁöÑËµãÂÄº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Before(&quot;autoFillPointCut()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">autoFill</span><span class="hljs-params">(JoinPoint joinPoint)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;ÂºÄÂßãËøõË°åÂÖ¨ÂÖ±Â≠óÊÆµËá™Âä®Â°´ÂÖÖ...&quot;</span>);<br><br>        <span class="hljs-comment">//Ëé∑ÂèñÂà∞ÂΩìÂâçË¢´Êã¶Êà™ÁöÑÊñπÊ≥ï‰∏äÁöÑÊï∞ÊçÆÂ∫ìÊìç‰ΩúÁ±ªÂûã</span><br>        <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) joinPoint.getSignature();<span class="hljs-comment">//ÊñπÊ≥ïÁ≠æÂêçÂØπË±°</span><br>        <span class="hljs-type">AutoFill</span> <span class="hljs-variable">autoFill</span> <span class="hljs-operator">=</span> signature.getMethod().getAnnotation(AutoFill.class);<span class="hljs-comment">//Ëé∑ÂæóÊñπÊ≥ï‰∏äÁöÑÊ≥®Ëß£ÂØπË±°</span><br>        <span class="hljs-type">OperationType</span> <span class="hljs-variable">operationType</span> <span class="hljs-operator">=</span> autoFill.value();<span class="hljs-comment">//Ëé∑ÂæóÊï∞ÊçÆÂ∫ìÊìç‰ΩúÁ±ªÂûã</span><br><br>        <span class="hljs-comment">//Ëé∑ÂèñÂà∞ÂΩìÂâçË¢´Êã¶Êà™ÁöÑÊñπÊ≥ïÁöÑÂèÇÊï∞--ÂÆû‰ΩìÂØπË±°</span><br>        Object[] args = joinPoint.getArgs();<br>        <span class="hljs-keyword">if</span>(args == <span class="hljs-literal">null</span> || args.length == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> args[<span class="hljs-number">0</span>];<br><br>        <span class="hljs-comment">//ÂáÜÂ§áËµãÂÄºÁöÑÊï∞ÊçÆ</span><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">currentId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>        <span class="hljs-comment">//Ê†πÊçÆÂΩìÂâç‰∏çÂêåÁöÑÊìç‰ΩúÁ±ªÂûãÔºå‰∏∫ÂØπÂ∫îÁöÑÂ±ûÊÄßÈÄöËøáÂèçÂ∞ÑÊù•ËµãÂÄº</span><br>        <span class="hljs-keyword">if</span>(operationType == OperationType.INSERT)&#123;<br>            <span class="hljs-comment">//‰∏∫4‰∏™ÂÖ¨ÂÖ±Â≠óÊÆµËµãÂÄº</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setCreateTime</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME, LocalDateTime.class);<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setCreateUser</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER, Long.class);<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setUpdateTime</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setUpdateUser</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);<br><br>                <span class="hljs-comment">//ÈÄöËøáÂèçÂ∞Ñ‰∏∫ÂØπË±°Â±ûÊÄßËµãÂÄº</span><br>                setCreateTime.invoke(entity,now);<br>                setCreateUser.invoke(entity,currentId);<br>                setUpdateTime.invoke(entity,now);<br>                setUpdateUser.invoke(entity,currentId);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(operationType == OperationType.UPDATE)&#123;<br>            <span class="hljs-comment">//‰∏∫2‰∏™ÂÖ¨ÂÖ±Â≠óÊÆµËµãÂÄº</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setUpdateTime</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setUpdateUser</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);<br><br>                <span class="hljs-comment">//ÈÄöËøáÂèçÂ∞Ñ‰∏∫ÂØπË±°Â±ûÊÄßËµãÂÄº</span><br>                setUpdateTime.invoke(entity,now);<br>                setUpdateUser.invoke(entity,currentId);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-4-Âú®MapperÊé•Âè£ÁöÑÊñπÊ≥ï‰∏äÂä†ÂÖ•-AutoFill-Ê≥®Ëß£"><a href="#1-4-Âú®MapperÊé•Âè£ÁöÑÊñπÊ≥ï‰∏äÂä†ÂÖ•-AutoFill-Ê≥®Ëß£" class="headerlink" title="1.4 Âú®MapperÊé•Âè£ÁöÑÊñπÊ≥ï‰∏äÂä†ÂÖ• AutoFill Ê≥®Ëß£"></a>1.4 Âú®MapperÊé•Âè£ÁöÑÊñπÊ≥ï‰∏äÂä†ÂÖ• AutoFill Ê≥®Ëß£</h3><p>‰ª•<strong>CategoryMapper</strong>‰∏∫‰æãÔºåÂàÜÂà´Âú®Êñ∞Â¢ûÂíå‰øÆÊîπÊñπÊ≥ïÊ∑ªÂä†@AutoFill()Ê≥®Ëß£Ôºå‰πüÈúÄË¶Å<strong>EmployeeMapper</strong>ÂÅöÁõ∏ÂêåÊìç‰ΩúÔºõÂêåÊó∂Ê≥®ÈáäÊéâÂéüÊúâÁöÑÊñ∞Â¢ûÂíåÊ∑ªÂä†‰ª£Á†Å</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CategoryMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊèíÂÖ•Êï∞ÊçÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> category</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Insert(&quot;insert into category(type, name, sort, status, create_time, update_time, create_user, update_user)&quot; +</span><br><span class="hljs-meta">            &quot; VALUES&quot; +</span><br><span class="hljs-meta">            &quot; (#&#123;type&#125;, #&#123;name&#125;, #&#123;sort&#125;, #&#123;status&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;)&quot;)</span><br>    <span class="hljs-meta">@AutoFill(value = OperationType.INSERT)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Category category)</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆid‰øÆÊîπÂàÜÁ±ª</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> category</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@AutoFill(value = OperationType.UPDATE)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Category category)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-Êñá‰ª∂‰∏ä‰º†"><a href="#2-Êñá‰ª∂‰∏ä‰º†" class="headerlink" title="2. Êñá‰ª∂‰∏ä‰º†"></a>2. Êñá‰ª∂‰∏ä‰º†</h2><ul>
<li>Âõ†‰∏∫Âú®Êñ∞Â¢ûËèúÂìÅÊó∂ÔºåÈúÄË¶Å‰∏ä‰º†ËèúÂìÅÂØπÂ∫îÁöÑÂõæÁâá(Êñá‰ª∂)ÔºåÂåÖÊã¨ÂêéÁª™ÂÖ∂ÂÆÉÂäüËÉΩ‰πü‰ºö‰ΩøÁî®Âà∞Êñá‰ª∂‰∏ä‰º†ÔºåÊïÖË¶ÅÂÆûÁé∞ÈÄöÁî®ÁöÑÊñá‰ª∂‰∏ä‰º†Êé•Âè£„ÄÇ</li>
<li>Âú®Êú¨È°πÁõÆÈÄâÁî®ÈòøÈáå‰∫ëÁöÑOSSÊúçÂä°ËøõË°åÊñá‰ª∂Â≠òÂÇ®„ÄÇ</li>
</ul>
<h3 id="2-1-ÂÆö‰πâOSSÁõ∏ÂÖ≥ÈÖçÁΩÆ"><a href="#2-1-ÂÆö‰πâOSSÁõ∏ÂÖ≥ÈÖçÁΩÆ" class="headerlink" title="2.1 ÂÆö‰πâOSSÁõ∏ÂÖ≥ÈÖçÁΩÆ"></a>2.1 ÂÆö‰πâOSSÁõ∏ÂÖ≥ÈÖçÁΩÆ</h3><p>Âú®sky-serverÊ®°Âùó</p>
<ul>
<li>application-dev.yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">alioss:</span><br>    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">oss-cn-hangzhou.aliyuncs.com</span><br>    <span class="hljs-attr">bucket-name:</span> <span class="hljs-string">sky-take-out</span><br></code></pre></td></tr></table></figure>

<ul>
<li>application.yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span>    <span class="hljs-comment">#ËÆæÁΩÆÁéØÂ¢É</span><br><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">alioss:</span><br>    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">$&#123;sky.alioss.endpoint&#125;</span><br>    <span class="hljs-attr">bucket-name:</span> <span class="hljs-string">$&#123;sky.alioss.bucket-name&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="2-2-OSSÂ∑•ÂÖ∑Á±ªÂØπË±°"><a href="#2-2-OSSÂ∑•ÂÖ∑Á±ªÂØπË±°" class="headerlink" title="2.2 OSSÂ∑•ÂÖ∑Á±ªÂØπË±°"></a>2.2 OSSÂ∑•ÂÖ∑Á±ªÂØπË±°</h3><p>Âú®sky-serverÊ®°Âùó</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.config;<br><br><span class="hljs-keyword">import</span> com.sky.properties.AliOssProperties;<br><span class="hljs-keyword">import</span> com.sky.utils.AliOssUtil;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÈÖçÁΩÆÁ±ªÔºåÁî®‰∫éÂàõÂª∫AliOssUtilÂØπË±°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OssConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> AliOssUtil <span class="hljs-title function_">aliOssUtil</span><span class="hljs-params">(AliOssProperties aliOssProperties)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;ÂºÄÂßãÂàõÂª∫ÈòøÈáå‰∫ëÊñá‰ª∂‰∏ä‰º†Â∑•ÂÖ∑Á±ªÂØπË±°Ôºö&#123;&#125;&quot;</span>,aliOssProperties);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AliOssUtil</span>(aliOssProperties.getEndpoint(),<br>                aliOssProperties.getAccessKeyId(),<br>                aliOssProperties.getAccessKeySecret(),<br>                aliOssProperties.getBucketName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-ÂÆö‰πâÊñá‰ª∂‰∏ä‰º†Êé•Âè£"><a href="#2-3-ÂÆö‰πâÊñá‰ª∂‰∏ä‰º†Êé•Âè£" class="headerlink" title="2.3 ÂÆö‰πâÊñá‰ª∂‰∏ä‰º†Êé•Âè£"></a>2.3 ÂÆö‰πâÊñá‰ª∂‰∏ä‰º†Êé•Âè£</h3><p>Âú®sky-serverÊ®°Âùó‰∏≠ÂÆö‰πâÊé•Âè£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.admin;<br><br><span class="hljs-keyword">import</span> com.sky.constant.MessageConstant;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.utils.AliOssUtil;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.UUID;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÈÄöÁî®Êé•Âè£</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/common&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;ÈÄöÁî®Êé•Âè£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AliOssUtil aliOssUtil;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êñá‰ª∂‰∏ä‰º†</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Êñá‰ª∂‰∏ä‰º†&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;Êñá‰ª∂‰∏ä‰º†Ôºö&#123;&#125;&quot;</span>,file);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//ÂéüÂßãÊñá‰ª∂Âêç</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>            <span class="hljs-comment">//Êà™ÂèñÂéüÂßãÊñá‰ª∂ÂêçÁöÑÂêéÁºÄ </span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">extension</span> <span class="hljs-operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br>            <span class="hljs-comment">//ÊûÑÈÄ†Êñ∞Êñá‰ª∂ÂêçÁß∞</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">objectName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString() + extension;<br><br>            <span class="hljs-comment">//Êñá‰ª∂ÁöÑËØ∑Ê±ÇË∑ØÂæÑ</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> aliOssUtil.upload(file.getBytes(), objectName);<br>            <span class="hljs-keyword">return</span> Result.success(filePath);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            log.error(<span class="hljs-string">&quot;Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•Ôºö&#123;&#125;&quot;</span>, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.error(MessageConstant.UPLOAD_FAILED);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-Êñ∞Â¢ûËèúÂìÅ"><a href="#3-Êñ∞Â¢ûËèúÂìÅ" class="headerlink" title="3. Êñ∞Â¢ûËèúÂìÅ"></a>3. Êñ∞Â¢ûËèúÂìÅ</h2><h3 id="3-1-ControllerÂ±Ç-1"><a href="#3-1-ControllerÂ±Ç-1" class="headerlink" title="3.1 ControllerÂ±Ç"></a>3.1 ControllerÂ±Ç</h3><p>ËøõÂÖ•Âà∞sky-serverÊ®°Âùó</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.admin;<br><br><span class="hljs-keyword">import</span> com.sky.dto.DishDTO;<br><span class="hljs-keyword">import</span> com.sky.dto.DishPageQueryDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.Dish;<br><span class="hljs-keyword">import</span> com.sky.result.PageResult;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.DishService;<br><span class="hljs-keyword">import</span> com.sky.vo.DishVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Set;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ËèúÂìÅÁÆ°ÁêÜ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/dish&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;ËèúÂìÅÁõ∏ÂÖ≥Êé•Âè£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishService dishService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êñ∞Â¢ûËèúÂìÅ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Êñ∞Â¢ûËèúÂìÅ&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;Êñ∞Â¢ûËèúÂìÅÔºö&#123;&#125;&quot;</span>, dishDTO);<br>        dishService.saveWithFlavor(dishDTO);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂºÄÂèë</span><br>        <span class="hljs-keyword">return</span> Result.success();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-ServiceÂ±Ç-1"><a href="#3-2-ServiceÂ±Ç-1" class="headerlink" title="3.2 ServiceÂ±Ç"></a>3.2 ServiceÂ±Ç</h3><h4 id="3-2-1-ServiceÂ±ÇÊé•Âè£-1"><a href="#3-2-1-ServiceÂ±ÇÊé•Âè£-1" class="headerlink" title="3.2.1 ServiceÂ±ÇÊé•Âè£"></a>3.2.1 ServiceÂ±ÇÊé•Âè£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.DishDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.Dish;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DishService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êñ∞Â¢ûËèúÂìÅÂíåÂØπÂ∫îÁöÑÂè£Âë≥</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithFlavor</span><span class="hljs-params">(DishDTO dishDTO)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª-1"><a href="#3-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª-1" class="headerlink" title="3.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>3.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DishService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishMapper dishMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishFlavorMapper dishFlavorMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êñ∞Â¢ûËèúÂìÅÂíåÂØπÂ∫îÁöÑÂè£Âë≥</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithFlavor</span><span class="hljs-params">(DishDTO dishDTO)</span> &#123;<br><br>        <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>        BeanUtils.copyProperties(dishDTO, dish);<br><br>        <span class="hljs-comment">//ÂêëËèúÂìÅË°®ÊèíÂÖ•1Êù°Êï∞ÊçÆ</span><br>        dishMapper.insert(dish);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂÆûÁé∞</span><br><br>        <span class="hljs-comment">//Ëé∑ÂèñinsertËØ≠Âè•ÁîüÊàêÁöÑ‰∏ªÈîÆÂÄº</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">dishId</span> <span class="hljs-operator">=</span> dish.getId();<br><br>        List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();<br>        <span class="hljs-keyword">if</span> (flavors != <span class="hljs-literal">null</span> &amp;&amp; flavors.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            flavors.forEach(dishFlavor -&gt; &#123;<br>                dishFlavor.setDishId(dishId);<br>            &#125;);<br>            <span class="hljs-comment">//ÂêëÂè£Âë≥Ë°®ÊèíÂÖ•nÊù°Êï∞ÊçÆ</span><br>            dishFlavorMapper.insertBatch(flavors);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂÆûÁé∞</span><br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-MapperÂ±Ç-1"><a href="#3-3-MapperÂ±Ç-1" class="headerlink" title="3.3 MapperÂ±Ç"></a>3.3 MapperÂ±Ç</h3><h4 id="3-3-1-DishMapper-java"><a href="#3-3-1-DishMapper-java" class="headerlink" title="3.3.1 DishMapper.java"></a>3.3.1 DishMapper.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ÊèíÂÖ•ËèúÂìÅÊï∞ÊçÆ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@AutoFill(value = OperationType.INSERT)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Dish dish)</span>;<br></code></pre></td></tr></table></figure>

<p>Âú®&#x2F;resources&#x2F;mapper‰∏≠ÂàõÂª∫DishMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.DishMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>        insert into dish (name, category_id, price, image, description, create_time, update_time, create_user,update_user, status)<br>        values (#&#123;name&#125;, #&#123;categoryId&#125;, #&#123;price&#125;, #&#123;image&#125;, #&#123;description&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;, #&#123;status&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="3-3-2-DishFlavorMapper-java"><a href="#3-3-2-DishFlavorMapper-java" class="headerlink" title="3.3.2 DishFlavorMapper.java"></a>3.3.2 DishFlavorMapper.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.DishFlavor;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DishFlavorMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊâπÈáèÊèíÂÖ•Âè£Âë≥Êï∞ÊçÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> flavors</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBatch</span><span class="hljs-params">(List&lt;DishFlavor&gt; flavors)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>Âú®&#x2F;resources&#x2F;mapper‰∏≠ÂàõÂª∫DishFlavorMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.DishFlavorMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertBatch&quot;</span>&gt;</span><br>        insert into dish_flavor (dish_id, name, value) VALUES<br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;flavors&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;df&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>            (#&#123;df.dishId&#125;,#&#123;df.name&#125;,#&#123;df.value&#125;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="4-ËèúÂìÅÂàÜÈ°µÊü•ËØ¢"><a href="#4-ËèúÂìÅÂàÜÈ°µÊü•ËØ¢" class="headerlink" title="4. ËèúÂìÅÂàÜÈ°µÊü•ËØ¢"></a>4. ËèúÂìÅÂàÜÈ°µÊü•ËØ¢</h2><h3 id="4-1-ControllerÂ±Ç"><a href="#4-1-ControllerÂ±Ç" class="headerlink" title="4.1  ControllerÂ±Ç"></a>4.1  ControllerÂ±Ç</h3><p><strong>Ê†πÊçÆÊé•Âè£ÂÆö‰πâÂàõÂª∫DishControllerÁöÑpageÂàÜÈ°µÊü•ËØ¢ÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËèúÂìÅÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishPageQueryDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;ËèúÂìÅÂàÜÈ°µÊü•ËØ¢&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;ËèúÂìÅÂàÜÈ°µÊü•ËØ¢:&#123;&#125;&quot;</span>, dishPageQueryDTO);<br>       <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> dishService.pageQuery(dishPageQueryDTO);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂÆö‰πâ</span><br>       <span class="hljs-keyword">return</span> Result.success(pageResult);<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="4-2-ServiceÂ±Ç"><a href="#4-2-ServiceÂ±Ç" class="headerlink" title="4.2 ServiceÂ±Ç"></a>4.2 ServiceÂ±Ç</h3><h4 id="4-2-1-ServiceÂ±ÇÊé•Âè£"><a href="#4-2-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="4.2.1 ServiceÂ±ÇÊé•Âè£"></a>4.2.1 ServiceÂ±ÇÊé•Âè£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËèúÂìÅÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishPageQueryDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(DishPageQueryDTO dishPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>



<h4 id="4-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#4-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="4.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>4.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><p><strong>Âú® DishServiceImpl ‰∏≠ÂÆûÁé∞ÂàÜÈ°µÊü•ËØ¢ÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËèúÂìÅÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishPageQueryDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;<br>       PageHelper.startPage(dishPageQueryDTO.getPage(), dishPageQueryDTO.getPageSize());<br>       Page&lt;DishVO&gt; page = dishMapper.pageQuery(dishPageQueryDTO);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂÆûÁé∞</span><br>       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(page.getTotal(), page.getResult());<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="4-3-MapperÂ±Ç"><a href="#4-3-MapperÂ±Ç" class="headerlink" title="4.3 MapperÂ±Ç"></a>4.3 MapperÂ±Ç</h3><p><strong>Âú® DishMapper Êé•Âè£‰∏≠Â£∞Êòé pageQuery ÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËèúÂìÅÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishPageQueryDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   Page&lt;DishVO&gt; <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(DishPageQueryDTO dishPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âú® DishMapper.xml ‰∏≠ÁºñÂÜôSQLÔºö</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pageQuery&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sky.vo.DishVO&quot;</span>&gt;</span><br>        select d.* , c.name as categoryName from dish d left outer join category c on d.category_id = c.id<br>        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>                and d.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>                and d.category_id = #&#123;categoryId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                and d.status = #&#123;status&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>        order by d.create_time desc<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="5-Âà†Èô§ËèúÂìÅ"><a href="#5-Âà†Èô§ËèúÂìÅ" class="headerlink" title="5. Âà†Èô§ËèúÂìÅ"></a>5. Âà†Èô§ËèúÂìÅ</h2><h3 id="5-1-ControllerÂ±Ç"><a href="#5-1-ControllerÂ±Ç" class="headerlink" title="5.1 ControllerÂ±Ç"></a>5.1 ControllerÂ±Ç</h3><p><strong>Ê†πÊçÆÂà†Èô§ËèúÂìÅÁöÑÊé•Âè£ÂÆö‰πâÂú®DishController‰∏≠ÂàõÂª∫ÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËèúÂìÅÊâπÈáèÂà†Èô§</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@DeleteMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;ËèúÂìÅÊâπÈáèÂà†Èô§&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;ËèúÂìÅÊâπÈáèÂà†Èô§Ôºö&#123;&#125;&quot;</span>, ids);<br>       dishService.deleteBatch(ids);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-2-ServiceÂ±Ç"><a href="#5-2-ServiceÂ±Ç" class="headerlink" title="5.2 ServiceÂ±Ç"></a>5.2 ServiceÂ±Ç</h3><h4 id="5-2-1-ServiceÂ±ÇÊé•Âè£"><a href="#5-2-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="5.2.1 ServiceÂ±ÇÊé•Âè£"></a>5.2.1 ServiceÂ±ÇÊé•Âè£</h4><p><strong>Âú®DishServiceÊé•Âè£‰∏≠Â£∞ÊòédeleteBatchÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËèúÂìÅÊâπÈáèÂà†Èô§</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBatch</span><span class="hljs-params">(List&lt;Long&gt; ids)</span>;<br></code></pre></td></tr></table></figure>



<h4 id="5-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#5-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="5.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>5.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><p><strong>Âú®DishServiceImpl‰∏≠ÂÆûÁé∞deleteBatchÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> SetmealDishMapper setmealDishMapper;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËèúÂìÅÊâπÈáèÂà†Èô§</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Transactional</span><span class="hljs-comment">//‰∫ãÂä°</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBatch</span><span class="hljs-params">(List&lt;Long&gt; ids)</span> &#123;<br>       <span class="hljs-comment">//Âà§Êñ≠ÂΩìÂâçËèúÂìÅÊòØÂê¶ËÉΩÂ§üÂà†Èô§---ÊòØÂê¶Â≠òÂú®Ëµ∑ÂîÆ‰∏≠ÁöÑËèúÂìÅÔºüÔºü</span><br>       <span class="hljs-keyword">for</span> (Long id : ids) &#123;<br>           <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> dishMapper.getById(id);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂÆûÁé∞</span><br>           <span class="hljs-keyword">if</span> (dish.getStatus() == StatusConstant.ENABLE) &#123;<br>               <span class="hljs-comment">//ÂΩìÂâçËèúÂìÅÂ§Ñ‰∫éËµ∑ÂîÆ‰∏≠Ôºå‰∏çËÉΩÂà†Èô§</span><br>               <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_ON_SALE);<br>           &#125;<br>       &#125;<br><br>       <span class="hljs-comment">//Âà§Êñ≠ÂΩìÂâçËèúÂìÅÊòØÂê¶ËÉΩÂ§üÂà†Èô§---ÊòØÂê¶Ë¢´Â•óÈ§êÂÖ≥ËÅî‰∫ÜÔºüÔºü</span><br>       List&lt;Long&gt; setmealIds = setmealDishMapper.getSetmealIdsByDishIds(ids);<br>       <span class="hljs-keyword">if</span> (setmealIds != <span class="hljs-literal">null</span> &amp;&amp; setmealIds.size() &gt; <span class="hljs-number">0</span>) &#123;<br>           <span class="hljs-comment">//ÂΩìÂâçËèúÂìÅË¢´Â•óÈ§êÂÖ≥ËÅî‰∫ÜÔºå‰∏çËÉΩÂà†Èô§</span><br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_BE_RELATED_BY_SETMEAL);<br>       &#125;<br><br>       <span class="hljs-comment">//Âà†Èô§ËèúÂìÅË°®‰∏≠ÁöÑËèúÂìÅÊï∞ÊçÆ</span><br>       <span class="hljs-keyword">for</span> (Long id : ids) &#123;<br>           dishMapper.deleteById(id);<br>           <span class="hljs-comment">//Âà†Èô§ËèúÂìÅÂÖ≥ËÅîÁöÑÂè£Âë≥Êï∞ÊçÆ</span><br>           dishFlavorMapper.deleteByDishId(id);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="5-3-MapperÂ±Ç"><a href="#5-3-MapperÂ±Ç" class="headerlink" title="5.3 MapperÂ±Ç"></a>5.3 MapperÂ±Ç</h3><p><strong>Âú®DishMapper‰∏≠Â£∞ÊòégetByIdÊñπÊ≥ïÔºåÂπ∂ÈÖçÁΩÆSQLÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆ‰∏ªÈîÆÊü•ËØ¢ËèúÂìÅ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select * from dish where id = #&#123;id&#125;&quot;)</span><br>   Dish <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>ÂàõÂª∫SetmealDishMapperÔºåÂ£∞ÊòégetSetmealIdsByDishIdsÊñπÊ≥ïÔºåÂπ∂Âú®xmlÊñá‰ª∂‰∏≠ÁºñÂÜôSQLÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.SetmealDish;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Delete;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SetmealDishMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆËèúÂìÅidÊü•ËØ¢ÂØπÂ∫îÁöÑÂ•óÈ§êid</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dishIds</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//select setmeal_id from setmeal_dish where dish_id in (1,2,3,4)</span><br>    List&lt;Long&gt; <span class="hljs-title function_">getSetmealIdsByDishIds</span><span class="hljs-params">(List&lt;Long&gt; dishIds)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>SetmealDishMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.SetmealDishMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getSetmealIdsByDishIds&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Long&quot;</span>&gt;</span><br>        select setmeal_id from setmeal_dish where dish_id in<br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;dishIds&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;dishId&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span><br>            #&#123;dishId&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>Âú®DishMapper.java‰∏≠Â£∞ÊòédeleteByIdÊñπÊ≥ïÂπ∂ÈÖçÁΩÆSQLÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆ‰∏ªÈîÆÂà†Èô§ËèúÂìÅÊï∞ÊçÆ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Delete(&quot;delete from dish where id = #&#123;id&#125;&quot;)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®DishFlavorMapper‰∏≠Â£∞ÊòédeleteByDishIdÊñπÊ≥ïÂπ∂ÈÖçÁΩÆSQLÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê†πÊçÆËèúÂìÅidÂà†Èô§ÂØπÂ∫îÁöÑÂè£Âë≥Êï∞ÊçÆ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> dishId</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Delete(&quot;delete from dish_flavor where dish_id = #&#123;dishId&#125;&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteByDishId</span><span class="hljs-params">(Long dishId)</span>;<br></code></pre></td></tr></table></figure>

<h2 id="6-‰øÆÊîπËèúÂìÅ"><a href="#6-‰øÆÊîπËèúÂìÅ" class="headerlink" title="6. ‰øÆÊîπËèúÂìÅ"></a>6. ‰øÆÊîπËèúÂìÅ</h2><h3 id="6-1-ControllerÂ±Ç"><a href="#6-1-ControllerÂ±Ç" class="headerlink" title="6.1 ControllerÂ±Ç"></a>6.1 ControllerÂ±Ç</h3><p><strong>Ê†πÊçÆ‰øÆÊîπËèúÂìÅÁöÑÊé•Âè£ÂÆö‰πâÂú®DishController‰∏≠ÂàõÂª∫ÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ‰øÆÊîπËèúÂìÅ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PutMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;‰øÆÊîπËèúÂìÅ&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;‰øÆÊîπËèúÂìÅÔºö&#123;&#125;&quot;</span>, dishDTO);<br>       dishService.updateWithFlavor(dishDTO);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="6-2-ServiceÂ±Ç"><a href="#6-2-ServiceÂ±Ç" class="headerlink" title="6.2 ServiceÂ±Ç"></a>6.2 ServiceÂ±Ç</h3><h4 id="6-2-1-ServiceÂ±ÇÊé•Âè£"><a href="#6-2-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="6.2.1 ServiceÂ±ÇÊé•Âè£"></a>6.2.1 ServiceÂ±ÇÊé•Âè£</h4><p><strong>Âú®DishServiceÊé•Âè£‰∏≠Â£∞ÊòéupdateWithFlavorÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆid‰øÆÊîπËèúÂìÅÂü∫Êú¨‰ø°ÊÅØÂíåÂØπÂ∫îÁöÑÂè£Âë≥‰ø°ÊÅØ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWithFlavor</span><span class="hljs-params">(DishDTO dishDTO)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="6-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#6-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="6.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>6.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><p><strong>Âú®DishServiceImpl‰∏≠ÂÆûÁé∞updateWithFlavorÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆid‰øÆÊîπËèúÂìÅÂü∫Êú¨‰ø°ÊÅØÂíåÂØπÂ∫îÁöÑÂè£Âë≥‰ø°ÊÅØ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWithFlavor</span><span class="hljs-params">(DishDTO dishDTO)</span> &#123;<br>       <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>       BeanUtils.copyProperties(dishDTO, dish);<br><br>       <span class="hljs-comment">//‰øÆÊîπËèúÂìÅË°®Âü∫Êú¨‰ø°ÊÅØ</span><br>       dishMapper.update(dish);<br><br>       <span class="hljs-comment">//Âà†Èô§ÂéüÊúâÁöÑÂè£Âë≥Êï∞ÊçÆ</span><br>       dishFlavorMapper.deleteByDishId(dishDTO.getId());<br><br>       <span class="hljs-comment">//ÈáçÊñ∞ÊèíÂÖ•Âè£Âë≥Êï∞ÊçÆ</span><br>       List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();<br>       <span class="hljs-keyword">if</span> (flavors != <span class="hljs-literal">null</span> &amp;&amp; flavors.size() &gt; <span class="hljs-number">0</span>) &#123;<br>           flavors.forEach(dishFlavor -&gt; &#123;<br>               dishFlavor.setDishId(dishDTO.getId());<br>           &#125;);<br>           <span class="hljs-comment">//ÂêëÂè£Âë≥Ë°®ÊèíÂÖ•nÊù°Êï∞ÊçÆ</span><br>           dishFlavorMapper.insertBatch(flavors);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="6-3-MapperÂ±Ç"><a href="#6-3-MapperÂ±Ç" class="headerlink" title="6.3 MapperÂ±Ç"></a>6.3 MapperÂ±Ç</h3><p><strong>Âú®DishMapper‰∏≠ÔºåÂ£∞ÊòéupdateÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆidÂä®ÊÄÅ‰øÆÊîπËèúÂìÅÊï∞ÊçÆ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@AutoFill(value = OperationType.UPDATE)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Dish dish)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âπ∂Âú®DishMapper.xmlÊñá‰ª∂‰∏≠ÁºñÂÜôSQL:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span>&gt;</span><br>        update dish<br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span>name = #&#123;name&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span>category_id = #&#123;categoryId&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;price != null&quot;</span>&gt;</span>price = #&#123;price&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;image != null&quot;</span>&gt;</span>image = #&#123;image&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;description != null&quot;</span>&gt;</span>description = #&#123;description&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span>status = #&#123;status&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;updateTime != null&quot;</span>&gt;</span>update_time = #&#123;updateTime&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;updateUser != null&quot;</span>&gt;</span>update_user = #&#123;updateUser&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>        where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="7-ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆÂäüËÉΩ"><a href="#7-ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆÂäüËÉΩ" class="headerlink" title="7. ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆÂäüËÉΩ"></a>7. ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆÂäüËÉΩ</h2><h3 id="7-1-ControllerÂ±Ç"><a href="#7-1-ControllerÂ±Ç" class="headerlink" title="7.1  ControllerÂ±Ç"></a>7.1  ControllerÂ±Ç</h3><p><strong>DishController</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status, Long id)</span>&#123;<br>    dishService.startOrStop(status,id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="7-2-ServiceÂ±Ç"><a href="#7-2-ServiceÂ±Ç" class="headerlink" title="7.2 ServiceÂ±Ç"></a>7.2 ServiceÂ±Ç</h3><h4 id="7-2-1-DishServiceÊé•Âè£"><a href="#7-2-1-DishServiceÊé•Âè£" class="headerlink" title="7.2.1 DishServiceÊé•Âè£"></a>7.2.1 DishServiceÊé•Âè£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="7-2-2-DishServiceImplÂÆûÁé∞Á±ª"><a href="#7-2-2-DishServiceImplÂÆûÁé∞Á±ª" class="headerlink" title="7.2.2 DishServiceImplÂÆûÁé∞Á±ª"></a>7.2.2 DishServiceImplÂÆûÁé∞Á±ª</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowire</span><br><span class="hljs-keyword">private</span> SetmealMapper setmealMapper;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span> &#123;<br>    <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> Dish.builder()<br>        .id(id)<br>        .status(status)<br>        .build();<br>    dishMapper.update(dish);<br><br>    <span class="hljs-keyword">if</span> (status == StatusConstant.DISABLE) &#123;<br>        <span class="hljs-comment">// Â¶ÇÊûúÊòØÂÅúÂîÆÊìç‰ΩúÔºåËøòÈúÄË¶ÅÂ∞ÜÂåÖÂê´ÂΩìÂâçËèúÂìÅÁöÑÂ•óÈ§ê‰πüÂÅúÂîÆ</span><br>        List&lt;Long&gt; dishIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        dishIds.add(id);<br>        <span class="hljs-comment">// select setmeal_id from setmeal_dish where dish_id in (?,?,?)</span><br>        List&lt;Long&gt; setmealIds = setmealDishMapper.getSetmealIdsByDishIds(dishIds);<br>        <span class="hljs-keyword">if</span> (setmealIds != <span class="hljs-literal">null</span> &amp;&amp; setmealIds.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Long setmealId : setmealIds) &#123;<br>                <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> Setmeal.builder()<br>                    .id(setmealId)<br>                    .status(StatusConstant.DISABLE)<br>                    .build();<br>                setmealMapper.update(setmeal);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="7-3-MapperÂ±Ç"><a href="#7-3-MapperÂ±Ç" class="headerlink" title="7.3 MapperÂ±Ç"></a>7.3 MapperÂ±Ç</h3><h4 id="7-3-1-SetmealMapper"><a href="#7-3-1-SetmealMapper" class="headerlink" title="7.3.1 SetmealMapper"></a>7.3.1 SetmealMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆid‰øÆÊîπÂ•óÈ§ê</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@AutoFill(OperationType.UPDATE)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Setmeal setmeal)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="7-3-2-SetmealMapper-xml"><a href="#7-3-2-SetmealMapper-xml" class="headerlink" title="7.3.2 SetmealMapper.xml"></a>7.3.2 SetmealMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.SetmealMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Setmeal&quot;</span>&gt;</span><br>        update setmeal<br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>                name = #&#123;name&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>                category_id = #&#123;categoryId&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;price != null&quot;</span>&gt;</span><br>                price = #&#123;price&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                status = #&#123;status&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;description != null&quot;</span>&gt;</span><br>                description = #&#123;description&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;image != null&quot;</span>&gt;</span><br>                image = #&#123;image&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;updateTime != null&quot;</span>&gt;</span><br>                update_time = #&#123;updateTime&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;updateUser != null&quot;</span>&gt;</span><br>                update_user = #&#123;updateUser&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>        where id = #&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h1 id="Âõõ-Â•óÈ§êÁÆ°ÁêÜ"><a href="#Âõõ-Â•óÈ§êÁÆ°ÁêÜ" class="headerlink" title="Âõõ. Â•óÈ§êÁÆ°ÁêÜ"></a>Âõõ. Â•óÈ§êÁÆ°ÁêÜ</h1><h2 id="1-Êñ∞Â¢ûÂ•óÈ§ê"><a href="#1-Êñ∞Â¢ûÂ•óÈ§ê" class="headerlink" title="1. Êñ∞Â¢ûÂ•óÈ§ê"></a>1. Êñ∞Â¢ûÂ•óÈ§ê</h2><h3 id="1-1-ControllerÂ±Ç"><a href="#1-1-ControllerÂ±Ç" class="headerlink" title="1.1 ControllerÂ±Ç"></a>1.1 ControllerÂ±Ç</h3><p><strong>DishController</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢ËèúÂìÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢ËèúÂìÅ&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;List&lt;Dish&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span>&#123;<br>    List&lt;Dish&gt; list = dishService.list(categoryId);<br>    <span class="hljs-keyword">return</span> Result.success(list);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-ServiceÂ±Ç"><a href="#1-2-ServiceÂ±Ç" class="headerlink" title="1.2 ServiceÂ±Ç"></a>1.2 ServiceÂ±Ç</h3><h4 id="1-2-1-ServiceÂ±ÇÊé•Âè£"><a href="#1-2-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="1.2.1 ServiceÂ±ÇÊé•Âè£"></a>1.2.1 ServiceÂ±ÇÊé•Âè£</h4><p><strong>DishService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢ËèúÂìÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>List&lt;Dish&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#1-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="1.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>1.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><p><strong>DishServiceImpl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢ËèúÂìÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> List&lt;Dish&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br>    <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> Dish.builder()<br>        .categoryId(categoryId)<br>        .status(StatusConstant.ENABLE)<br>        .build();<br>    <span class="hljs-keyword">return</span> dishMapper.list(dish);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-MapperÂ±Ç"><a href="#1-3-MapperÂ±Ç" class="headerlink" title="1.3 MapperÂ±Ç"></a>1.3 MapperÂ±Ç</h3><h4 id="1-3-1-DishMapper"><a href="#1-3-1-DishMapper" class="headerlink" title="1.3.1 DishMapper"></a>1.3.1 DishMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Âä®ÊÄÅÊù°‰ª∂Êü•ËØ¢ËèúÂìÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>List&lt;Dish&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Dish dish)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-2-DishMapper-xml"><a href="#1-3-2-DishMapper-xml" class="headerlink" title="1.3.2 DishMapper.xml"></a>1.3.2 DishMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Dish&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Dish&quot;</span>&gt;</span><br>    select * from dish<br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>            and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>            and category_id = #&#123;categoryId&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>            and status = #&#123;status&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    order by create_time desc<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-4-SetmealController"><a href="#1-4-SetmealController" class="headerlink" title="1.4 SetmealController"></a>1.4 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Â•óÈ§êÁÆ°ÁêÜ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/setmeal&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;Â•óÈ§êÁõ∏ÂÖ≥Êé•Âè£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealService setmealService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êñ∞Â¢ûÂ•óÈ§ê</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Êñ∞Â¢ûÂ•óÈ§ê&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;<br>        setmealService.saveWithDish(setmealDTO);<br>        <span class="hljs-keyword">return</span> Result.success();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-5-ServiceÂ±Ç"><a href="#1-5-ServiceÂ±Ç" class="headerlink" title="1.5 ServiceÂ±Ç"></a>1.5 ServiceÂ±Ç</h3><h4 id="1-5-1-SetmealServiceÊé•Âè£"><a href="#1-5-1-SetmealServiceÊé•Âè£" class="headerlink" title="1.5.1 SetmealServiceÊé•Âè£"></a>1.5.1 SetmealServiceÊé•Âè£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SetmealService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êñ∞Â¢ûÂ•óÈ§êÔºåÂêåÊó∂ÈúÄË¶Å‰øùÂ≠òÂ•óÈ§êÂíåËèúÂìÅÁöÑÂÖ≥ËÅîÂÖ≥Á≥ª</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithDish</span><span class="hljs-params">(SetmealDTO setmealDTO)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="1-5-2-SetmealServiceImplÂÆûÁé∞Á±ª"><a href="#1-5-2-SetmealServiceImplÂÆûÁé∞Á±ª" class="headerlink" title="1.5.2 SetmealServiceImplÂÆûÁé∞Á±ª"></a>1.5.2 SetmealServiceImplÂÆûÁé∞Á±ª</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Â•óÈ§ê‰∏öÂä°ÂÆûÁé∞</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SetmealService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealMapper setmealMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealDishMapper setmealDishMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishMapper dishMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êñ∞Â¢ûÂ•óÈ§êÔºåÂêåÊó∂ÈúÄË¶Å‰øùÂ≠òÂ•óÈ§êÂíåËèúÂìÅÁöÑÂÖ≥ËÅîÂÖ≥Á≥ª</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithDish</span><span class="hljs-params">(SetmealDTO setmealDTO)</span> &#123;<br>        <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Setmeal</span>();<br>        BeanUtils.copyProperties(setmealDTO, setmeal);<br><br>        <span class="hljs-comment">//ÂêëÂ•óÈ§êË°®ÊèíÂÖ•Êï∞ÊçÆ</span><br>        setmealMapper.insert(setmeal);<br><br>        <span class="hljs-comment">//Ëé∑ÂèñÁîüÊàêÁöÑÂ•óÈ§êid</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">setmealId</span> <span class="hljs-operator">=</span> setmeal.getId();<br><br>        List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();<br>        setmealDishes.forEach(setmealDish -&gt; &#123;<br>            setmealDish.setSetmealId(setmealId);<br>        &#125;);<br><br>        <span class="hljs-comment">//‰øùÂ≠òÂ•óÈ§êÂíåËèúÂìÅÁöÑÂÖ≥ËÅîÂÖ≥Á≥ª</span><br>        setmealDishMapper.insertBatch(setmealDishes);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-6-MapperÂ±Ç"><a href="#1-6-MapperÂ±Ç" class="headerlink" title="1.6 MapperÂ±Ç"></a>1.6 MapperÂ±Ç</h3><h4 id="1-6-1-SetmealMapper"><a href="#1-6-1-SetmealMapper" class="headerlink" title="1.6.1 SetmealMapper"></a>1.6.1 SetmealMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êñ∞Â¢ûÂ•óÈ§ê</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@AutoFill(OperationType.INSERT)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Setmeal setmeal)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-6-2-SetmealMapper-xml"><a href="#1-6-2-SetmealMapper-xml" class="headerlink" title="1.6.2 SetmealMapper.xml"></a>1.6.2 SetmealMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Setmeal&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>    insert into setmeal<br>    (category_id, name, price, status, description, image, create_time, update_time, create_user, update_user)<br>    values (#&#123;categoryId&#125;, #&#123;name&#125;, #&#123;price&#125;, #&#123;status&#125;, #&#123;description&#125;, #&#123;image&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;,<br>    #&#123;createUser&#125;, #&#123;updateUser&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="1-6-3-SetmealDishMapper"><a href="#1-6-3-SetmealDishMapper" class="headerlink" title="1.6.3 SetmealDishMapper"></a>1.6.3 SetmealDishMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊâπÈáè‰øùÂ≠òÂ•óÈ§êÂíåËèúÂìÅÁöÑÂÖ≥ËÅîÂÖ≥Á≥ª</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDishes</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBatch</span><span class="hljs-params">(List&lt;SetmealDish&gt; setmealDishes)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-6-4-SetmealDishMapper-xml"><a href="#1-6-4-SetmealDishMapper-xml" class="headerlink" title="1.6.4 SetmealDishMapper.xml"></a>1.6.4 SetmealDishMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertBatch&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>    insert into setmeal_dish<br>    (setmeal_id,dish_id,name,price,copies)<br>    values<br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;setmealDishes&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;sd&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>        (#&#123;sd.setmealId&#125;,#&#123;sd.dishId&#125;,#&#123;sd.name&#125;,#&#123;sd.price&#125;,#&#123;sd.copies&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="2-Â•óÈ§êÂàÜÈ°µÊü•ËØ¢"><a href="#2-Â•óÈ§êÂàÜÈ°µÊü•ËØ¢" class="headerlink" title="2. Â•óÈ§êÂàÜÈ°µÊü•ËØ¢"></a>2. Â•óÈ§êÂàÜÈ°µÊü•ËØ¢</h2><h3 id="2-1-SetmealController"><a href="#2-1-SetmealController" class="headerlink" title="2.1 SetmealController"></a>2.1 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂàÜÈ°µÊü•ËØ¢&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;<br>    <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> setmealService.pageQuery(setmealPageQueryDTO);<br>    <span class="hljs-keyword">return</span> Result.success(pageResult);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-SetmealService"><a href="#2-2-SetmealService" class="headerlink" title="2.2 SetmealService"></a>2.2 SetmealService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(SetmealPageQueryDTO setmealPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-SetmealServiceImpl"><a href="#2-3-SetmealServiceImpl" class="headerlink" title="2.3 SetmealServiceImpl"></a>2.3 SetmealServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">pageNum</span> <span class="hljs-operator">=</span> setmealPageQueryDTO.getPage();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> setmealPageQueryDTO.getPageSize();<br><br>    PageHelper.startPage(pageNum, pageSize);<br>    Page&lt;SetmealVO&gt; page = setmealMapper.pageQuery(setmealPageQueryDTO);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(page.getTotal(), page.getResult());<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-SetmealMapper"><a href="#2-4-SetmealMapper" class="headerlink" title="2.4 SetmealMapper"></a>2.4 SetmealMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>Page&lt;SetmealVO&gt; <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(SetmealPageQueryDTO setmealPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-5-SetmealMapper-xml"><a href="#2-5-SetmealMapper-xml" class="headerlink" title="2.5 SetmealMapper.xml"></a>2.5 SetmealMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pageQuery&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sky.vo.SetmealVO&quot;</span>&gt;</span><br>    select<br>    	s.*,c.name categoryName<br>    from<br>    	setmeal s<br>    left join<br>    	category c<br>    on<br>    	s.category_id = c.id<br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>            and s.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>            and s.status = #&#123;status&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>            and s.category_id = #&#123;categoryId&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    order by s.create_time desc<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="3-Âà†Èô§Â•óÈ§ê"><a href="#3-Âà†Èô§Â•óÈ§ê" class="headerlink" title="3. Âà†Èô§Â•óÈ§ê"></a>3. Âà†Èô§Â•óÈ§ê</h2><h3 id="3-1-SetmealController"><a href="#3-1-SetmealController" class="headerlink" title="3.1 SetmealController"></a>3.1 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊâπÈáèÂà†Èô§Â•óÈ§ê</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-meta">@ApiOperation(&quot;ÊâπÈáèÂà†Èô§Â•óÈ§ê&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;<br>    setmealService.deleteBatch(ids);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-SetmealService"><a href="#3-2-SetmealService" class="headerlink" title="3.2 SetmealService"></a>3.2 SetmealService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊâπÈáèÂà†Èô§Â•óÈ§ê</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBatch</span><span class="hljs-params">(List&lt;Long&gt; ids)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-SetmealServiceImpl"><a href="#3-3-SetmealServiceImpl" class="headerlink" title="3.3 SetmealServiceImpl"></a>3.3 SetmealServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊâπÈáèÂà†Èô§Â•óÈ§ê</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBatch</span><span class="hljs-params">(List&lt;Long&gt; ids)</span> &#123;<br>    ids.forEach(id -&gt; &#123;<br>        <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> setmealMapper.getById(id);<br>        <span class="hljs-keyword">if</span>(StatusConstant.ENABLE == setmeal.getStatus())&#123;<br>            <span class="hljs-comment">//Ëµ∑ÂîÆ‰∏≠ÁöÑÂ•óÈ§ê‰∏çËÉΩÂà†Èô§</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeletionNotAllowedException</span>(MessageConstant.SETMEAL_ON_SALE);<br>        &#125;<br>    &#125;);<br><br>    ids.forEach(setmealId -&gt; &#123;<br>        <span class="hljs-comment">//Âà†Èô§Â•óÈ§êË°®‰∏≠ÁöÑÊï∞ÊçÆ</span><br>        setmealMapper.deleteById(setmealId);<br>        <span class="hljs-comment">//Âà†Èô§Â•óÈ§êËèúÂìÅÂÖ≥Á≥ªË°®‰∏≠ÁöÑÊï∞ÊçÆ</span><br>        setmealDishMapper.deleteBySetmealId(setmealId);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-4-SetmealMapper"><a href="#3-4-SetmealMapper" class="headerlink" title="3.4 SetmealMapper"></a>3.4 SetmealMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆidÊü•ËØ¢Â•óÈ§ê</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Select(&quot;select * from setmeal where id = #&#123;id&#125;&quot;)</span><br>Setmeal <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆidÂà†Èô§Â•óÈ§ê</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Delete(&quot;delete from setmeal where id = #&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="3-5-SetmealDishMapper"><a href="#3-5-SetmealDishMapper" class="headerlink" title="3.5 SetmealDishMapper"></a>3.5 SetmealDishMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÂ•óÈ§êidÂà†Èô§Â•óÈ§êÂíåËèúÂìÅÁöÑÂÖ≥ËÅîÂÖ≥Á≥ª</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Delete(&quot;delete from setmeal_dish where setmeal_id = #&#123;setmealId&#125;&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBySetmealId</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>


<h2 id="4-‰øÆÊîπÂ•óÈ§ê"><a href="#4-‰øÆÊîπÂ•óÈ§ê" class="headerlink" title="4. ‰øÆÊîπÂ•óÈ§ê"></a>4. ‰øÆÊîπÂ•óÈ§ê</h2><h3 id="4-1-SetmealController"><a href="#4-1-SetmealController" class="headerlink" title="4.1 SetmealController"></a>4.1 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆidÊü•ËØ¢Â•óÈ§êÔºåÁî®‰∫é‰øÆÊîπÈ°µÈù¢ÂõûÊòæÊï∞ÊçÆ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;Ê†πÊçÆidÊü•ËØ¢Â•óÈ§ê&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;SetmealVO&gt; <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>    <span class="hljs-type">SetmealVO</span> <span class="hljs-variable">setmealVO</span> <span class="hljs-operator">=</span> setmealService.getByIdWithDish(id);<br>    <span class="hljs-keyword">return</span> Result.success(setmealVO);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ‰øÆÊîπÂ•óÈ§ê</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PutMapping</span><br><span class="hljs-meta">@ApiOperation(&quot;‰øÆÊîπÂ•óÈ§ê&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;<br>    setmealService.update(setmealDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-SetmealService"><a href="#4-2-SetmealService" class="headerlink" title="4.2 SetmealService"></a>4.2 SetmealService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆidÊü•ËØ¢Â•óÈ§êÂíåÂÖ≥ËÅîÁöÑËèúÂìÅÊï∞ÊçÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>SetmealVO <span class="hljs-title function_">getByIdWithDish</span><span class="hljs-params">(Long id)</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ‰øÆÊîπÂ•óÈ§ê</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(SetmealDTO setmealDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-SetmealServiceImpl"><a href="#4-3-SetmealServiceImpl" class="headerlink" title="4.3 SetmealServiceImpl"></a>4.3 SetmealServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆidÊü•ËØ¢Â•óÈ§êÂíåÂ•óÈ§êËèúÂìÅÂÖ≥Á≥ª</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> SetmealVO <span class="hljs-title function_">getByIdWithDish</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> setmealMapper.getById(id);<br>    List&lt;SetmealDish&gt; setmealDishes = setmealDishMapper.getBySetmealId(id);<br><br>    <span class="hljs-type">SetmealVO</span> <span class="hljs-variable">setmealVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetmealVO</span>();<br>    BeanUtils.copyProperties(setmeal, setmealVO);<br>    setmealVO.setSetmealDishes(setmealDishes);<br>    <br>    <span class="hljs-keyword">return</span> setmealVO;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ‰øÆÊîπÂ•óÈ§ê</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(SetmealDTO setmealDTO)</span> &#123;<br>    <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Setmeal</span>();<br>    BeanUtils.copyProperties(setmealDTO, setmeal);<br><br>    <span class="hljs-comment">//1„ÄÅ‰øÆÊîπÂ•óÈ§êË°®ÔºåÊâßË°åupdate</span><br>    setmealMapper.update(setmeal);<br><br>    <span class="hljs-comment">//Â•óÈ§êid</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">setmealId</span> <span class="hljs-operator">=</span> setmealDTO.getId();<br><br>    <span class="hljs-comment">//2„ÄÅÂà†Èô§Â•óÈ§êÂíåËèúÂìÅÁöÑÂÖ≥ËÅîÂÖ≥Á≥ªÔºåÊìç‰Ωúsetmeal_dishË°®ÔºåÊâßË°ådelete</span><br>    setmealDishMapper.deleteBySetmealId(setmealId);<br><br>    List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();<br>    setmealDishes.forEach(setmealDish -&gt; &#123;<br>        setmealDish.setSetmealId(setmealId);<br>    &#125;);<br>    <span class="hljs-comment">//3„ÄÅÈáçÊñ∞ÊèíÂÖ•Â•óÈ§êÂíåËèúÂìÅÁöÑÂÖ≥ËÅîÂÖ≥Á≥ªÔºåÊìç‰Ωúsetmeal_dishË°®ÔºåÊâßË°åinsert</span><br>    setmealDishMapper.insertBatch(setmealDishes);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-SetmealDishMapper"><a href="#4-4-SetmealDishMapper" class="headerlink" title="4.4 SetmealDishMapper"></a>4.4 SetmealDishMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆÂ•óÈ§êidÊü•ËØ¢Â•óÈ§êÂíåËèúÂìÅÁöÑÂÖ≥ËÅîÂÖ≥Á≥ª</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select * from setmeal_dish where setmeal_id = #&#123;setmealId&#125;&quot;)</span><br>   List&lt;SetmealDish&gt; <span class="hljs-title function_">getBySetmealId</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>

<h2 id="5-Ëµ∑ÂîÆÂÅúÂîÆÂ•óÈ§ê"><a href="#5-Ëµ∑ÂîÆÂÅúÂîÆÂ•óÈ§ê" class="headerlink" title="5. Ëµ∑ÂîÆÂÅúÂîÆÂ•óÈ§ê"></a>5. Ëµ∑ÂîÆÂÅúÂîÆÂ•óÈ§ê</h2><h3 id="5-1-SetmealController"><a href="#5-1-SetmealController" class="headerlink" title="5.1 SetmealController"></a>5.1 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Â•óÈ§êËµ∑ÂîÆÂÅúÂîÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;Â•óÈ§êËµ∑ÂîÆÂÅúÂîÆ&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status, Long id)</span> &#123;<br>    setmealService.startOrStop(status, id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-2-SetmealService"><a href="#5-2-SetmealService" class="headerlink" title="5.2 SetmealService"></a>5.2 SetmealService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Â•óÈ§êËµ∑ÂîÆ„ÄÅÂÅúÂîÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="5-3-SetmealServiceImpl"><a href="#5-3-SetmealServiceImpl" class="headerlink" title="5.3 SetmealServiceImpl"></a>5.3 SetmealServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Â•óÈ§êËµ∑ÂîÆ„ÄÅÂÅúÂîÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span> &#123;<br>    <span class="hljs-comment">//Ëµ∑ÂîÆÂ•óÈ§êÊó∂ÔºåÂà§Êñ≠Â•óÈ§êÂÜÖÊòØÂê¶ÊúâÂÅúÂîÆËèúÂìÅÔºåÊúâÂÅúÂîÆËèúÂìÅÊèêÁ§∫&quot;Â•óÈ§êÂÜÖÂåÖÂê´Êú™ÂêØÂîÆËèúÂìÅÔºåÊó†Ê≥ïÂêØÂîÆ&quot;</span><br>    <span class="hljs-keyword">if</span>(status == StatusConstant.ENABLE)&#123;<br>        <span class="hljs-comment">//select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = ?</span><br>        List&lt;Dish&gt; dishList = dishMapper.getBySetmealId(id);<br>        <span class="hljs-keyword">if</span>(dishList != <span class="hljs-literal">null</span> &amp;&amp; dishList.size() &gt; <span class="hljs-number">0</span>)&#123;<br>            dishList.forEach(dish -&gt; &#123;<br>                <span class="hljs-keyword">if</span>(StatusConstant.DISABLE == dish.getStatus())&#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetmealEnableFailedException</span>(MessageConstant.SETMEAL_ENABLE_FAILED);<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> Setmeal.builder()<br>        .id(id)<br>        .status(status)<br>        .build();<br>    setmealMapper.update(setmeal);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-4-DishMapper"><a href="#5-4-DishMapper" class="headerlink" title="5.4 DishMapper"></a>5.4 DishMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÂ•óÈ§êidÊü•ËØ¢ËèúÂìÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Select(&quot;select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = #&#123;setmealId&#125;&quot;)</span><br>List&lt;Dish&gt; <span class="hljs-title function_">getBySetmealId</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>


<h1 id="‰∫î-Redis"><a href="#‰∫î-Redis" class="headerlink" title="‰∫î. Redis"></a>‰∫î. Redis</h1><h2 id="1-RedisÁÆÄ‰ªã"><a href="#1-RedisÁÆÄ‰ªã" class="headerlink" title="1. RedisÁÆÄ‰ªã"></a>1. RedisÁÆÄ‰ªã</h2><p>RedisÊòØ‰∏Ä‰∏™Âü∫‰∫é<strong>ÂÜÖÂ≠ò</strong>ÁöÑkey-valueÁªìÊûÑÊï∞ÊçÆÂ∫ì„ÄÇRedis ÊòØ‰∫íËÅîÁΩëÊäÄÊúØÈ¢ÜÂüü‰ΩøÁî®ÊúÄ‰∏∫ÂπøÊ≥õÁöÑ<strong>Â≠òÂÇ®‰∏≠Èó¥‰ª∂</strong>„ÄÇ</p>
<p><strong>‰∏ªË¶ÅÁâπÁÇπÔºö</strong></p>
<ul>
<li>Âü∫‰∫éÂÜÖÂ≠òÂ≠òÂÇ®ÔºåËØªÂÜôÊÄßËÉΩÈ´ò  </li>
<li>ÈÄÇÂêàÂ≠òÂÇ®ÁÉ≠ÁÇπÊï∞ÊçÆÔºàÁÉ≠ÁÇπÂïÜÂìÅ„ÄÅËµÑËÆØ„ÄÅÊñ∞ÈóªÔºâ</li>
<li>‰ºÅ‰∏öÂ∫îÁî®ÂπøÊ≥õ</li>
</ul>
<p><strong>ÂêØÂä®Redis</strong>:Âú®RedisÂÆâË£ÖÁõÆÂΩïcmd‰ª•‰∏ãÂëΩ‰ª§<br><code>redis-server.exe redis.windows.conf</code></p>
<h2 id="2-RedisÊï∞ÊçÆÁ±ªÂûã"><a href="#2-RedisÊï∞ÊçÆÁ±ªÂûã" class="headerlink" title="2. RedisÊï∞ÊçÆÁ±ªÂûã"></a>2. RedisÊï∞ÊçÆÁ±ªÂûã</h2><h3 id="2-1-‰∫îÁßçÂ∏∏Áî®Êï∞ÊçÆÁ±ªÂûã‰ªãÁªç"><a href="#2-1-‰∫îÁßçÂ∏∏Áî®Êï∞ÊçÆÁ±ªÂûã‰ªãÁªç" class="headerlink" title="2.1 ‰∫îÁßçÂ∏∏Áî®Êï∞ÊçÆÁ±ªÂûã‰ªãÁªç"></a>2.1 ‰∫îÁßçÂ∏∏Áî®Êï∞ÊçÆÁ±ªÂûã‰ªãÁªç</h3><p>RedisÂ≠òÂÇ®ÁöÑÊòØkey-valueÁªìÊûÑÁöÑÊï∞ÊçÆÔºåÂÖ∂‰∏≠keyÊòØÂ≠óÁ¨¶‰∏≤Á±ªÂûãÔºåvalueÊúâ5ÁßçÂ∏∏Áî®ÁöÑÊï∞ÊçÆÁ±ªÂûã:</p>
<ul>
<li>Â≠óÁ¨¶‰∏≤ string</li>
<li>ÂìàÂ∏å hash</li>
<li>ÂàóË°® list</li>
<li>ÈõÜÂêà set</li>
<li>ÊúâÂ∫èÈõÜÂêà sorted set &#x2F; zset</li>
</ul>
<h3 id="2-2-ÂêÑÁßçÊï∞ÊçÆÁ±ªÂûãÁâπÁÇπ"><a href="#2-2-ÂêÑÁßçÊï∞ÊçÆÁ±ªÂûãÁâπÁÇπ" class="headerlink" title="2.2 ÂêÑÁßçÊï∞ÊçÆÁ±ªÂûãÁâπÁÇπ"></a>2.2 ÂêÑÁßçÊï∞ÊçÆÁ±ªÂûãÁâπÁÇπ</h3><p><img src="/img/blogs/java/cangqiongtakeout/5.2.1.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>Ëß£ÈáäËØ¥ÊòéÔºö</strong></p>
<ul>
<li>Â≠óÁ¨¶‰∏≤(string)ÔºöÊôÆÈÄöÂ≠óÁ¨¶‰∏≤ÔºåRedis‰∏≠ÊúÄÁÆÄÂçïÁöÑÊï∞ÊçÆÁ±ªÂûã</li>
<li>ÂìàÂ∏å(hash)Ôºö‰πüÂè´Êï£ÂàóÔºåÁ±ª‰ºº‰∫éJava‰∏≠ÁöÑHashMapÁªìÊûÑ</li>
<li>ÂàóË°®(list)ÔºöÊåâÁÖßÊèíÂÖ•È°∫Â∫èÊéíÂ∫èÔºåÂèØ‰ª•ÊúâÈáçÂ§çÂÖÉÁ¥†ÔºåÁ±ª‰ºº‰∫éJava‰∏≠ÁöÑLinkedList</li>
<li>ÈõÜÂêà(set)ÔºöÊó†Â∫èÈõÜÂêàÔºåÊ≤°ÊúâÈáçÂ§çÂÖÉÁ¥†ÔºåÁ±ª‰ºº‰∫éJava‰∏≠ÁöÑHashSet</li>
<li>ÊúâÂ∫èÈõÜÂêà(sorted set&#x2F;zset)ÔºöÈõÜÂêà‰∏≠ÊØè‰∏™ÂÖÉÁ¥†ÂÖ≥ËÅî‰∏Ä‰∏™ÂàÜÊï∞(score)ÔºåÊ†πÊçÆÂàÜÊï∞ÂçáÂ∫èÊéíÂ∫èÔºåÊ≤°ÊúâÈáçÂ§çÂÖÉÁ¥†</li>
</ul>
<h2 id="3-RedisÂ∏∏Áî®ÂëΩ‰ª§"><a href="#3-RedisÂ∏∏Áî®ÂëΩ‰ª§" class="headerlink" title="3. RedisÂ∏∏Áî®ÂëΩ‰ª§"></a>3. RedisÂ∏∏Áî®ÂëΩ‰ª§</h2><h3 id="3-1-Â≠óÁ¨¶‰∏≤Êìç‰ΩúÂëΩ‰ª§"><a href="#3-1-Â≠óÁ¨¶‰∏≤Êìç‰ΩúÂëΩ‰ª§" class="headerlink" title="3.1 Â≠óÁ¨¶‰∏≤Êìç‰ΩúÂëΩ‰ª§"></a>3.1 Â≠óÁ¨¶‰∏≤Êìç‰ΩúÂëΩ‰ª§</h3><p>Redis ‰∏≠Â≠óÁ¨¶‰∏≤Á±ªÂûãÂ∏∏Áî®ÂëΩ‰ª§Ôºö</p>
<ul>
<li><strong>SET</strong> key value 					         ËÆæÁΩÆÊåáÂÆökeyÁöÑÂÄº</li>
<li><strong>GET</strong> key                                        Ëé∑ÂèñÊåáÂÆökeyÁöÑÂÄº</li>
<li><strong>SETEX</strong> key seconds value         ËÆæÁΩÆÊåáÂÆökeyÁöÑÂÄºÔºåÂπ∂Â∞Ü key ÁöÑËøáÊúüÊó∂Èó¥ËÆæ‰∏∫ seconds Áßí</li>
<li><strong>SETNX</strong> key value                        Âè™ÊúâÂú® key    ‰∏çÂ≠òÂú®Êó∂ËÆæÁΩÆ key ÁöÑÂÄº</li>
</ul>
<h3 id="3-2-ÂìàÂ∏åÊìç‰ΩúÂëΩ‰ª§"><a href="#3-2-ÂìàÂ∏åÊìç‰ΩúÂëΩ‰ª§" class="headerlink" title="3.2 ÂìàÂ∏åÊìç‰ΩúÂëΩ‰ª§"></a>3.2 ÂìàÂ∏åÊìç‰ΩúÂëΩ‰ª§</h3><p>Redis hash ÊòØ‰∏Ä‰∏™stringÁ±ªÂûãÁöÑ field Âíå value ÁöÑÊò†Â∞ÑË°®ÔºåhashÁâπÂà´ÈÄÇÂêàÁî®‰∫éÂ≠òÂÇ®ÂØπË±°ÔºåÂ∏∏Áî®ÂëΩ‰ª§Ôºö</p>
<ul>
<li><strong>HSET</strong> key field value             Â∞ÜÂìàÂ∏åË°® key ‰∏≠ÁöÑÂ≠óÊÆµ field ÁöÑÂÄºËÆæ‰∏∫ value</li>
<li><strong>HGET</strong> key field                       Ëé∑ÂèñÂ≠òÂÇ®Âú®ÂìàÂ∏åË°®‰∏≠ÊåáÂÆöÂ≠óÊÆµÁöÑÂÄº</li>
<li><strong>HDEL</strong> key field                       Âà†Èô§Â≠òÂÇ®Âú®ÂìàÂ∏åË°®‰∏≠ÁöÑÊåáÂÆöÂ≠óÊÆµ</li>
<li><strong>HKEYS</strong> key                              Ëé∑ÂèñÂìàÂ∏åË°®‰∏≠ÊâÄÊúâÂ≠óÊÆµ</li>
<li><strong>HVALS</strong> key                              Ëé∑ÂèñÂìàÂ∏åË°®‰∏≠ÊâÄÊúâÂÄº</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/5.3.1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-3-ÂàóË°®Êìç‰ΩúÂëΩ‰ª§"><a href="#3-3-ÂàóË°®Êìç‰ΩúÂëΩ‰ª§" class="headerlink" title="3.3 ÂàóË°®Êìç‰ΩúÂëΩ‰ª§"></a>3.3 ÂàóË°®Êìç‰ΩúÂëΩ‰ª§</h3><p>Redis ÂàóË°®ÊòØÁÆÄÂçïÁöÑÂ≠óÁ¨¶‰∏≤ÂàóË°®ÔºåÊåâÁÖßÊèíÂÖ•È°∫Â∫èÊéíÂ∫èÔºåÂ∏∏Áî®ÂëΩ‰ª§Ôºö</p>
<ul>
<li><strong>LPUSH</strong> key value1 [value2]         Â∞Ü‰∏Ä‰∏™ÊàñÂ§ö‰∏™ÂÄºÊèíÂÖ•Âà∞ÂàóË°®Â§¥ÈÉ®</li>
<li><strong>LRANGE</strong> key start stop                Ëé∑ÂèñÂàóË°®ÊåáÂÆöËåÉÂõ¥ÂÜÖÁöÑÂÖÉÁ¥†</li>
<li><strong>RPOP</strong> key                                       ÁßªÈô§Âπ∂Ëé∑ÂèñÂàóË°®ÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥†</li>
<li><strong>LLEN</strong> key                                        Ëé∑ÂèñÂàóË°®ÈïøÂ∫¶</li>
<li><strong>BRPOP</strong> key1 [key2 ] timeout       ÁßªÂá∫Âπ∂Ëé∑ÂèñÂàóË°®ÁöÑÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥†Ôºå Â¶ÇÊûúÂàóË°®Ê≤°ÊúâÂÖÉÁ¥†‰ºöÈòªÂ°ûÂàóË°®Áõ¥Âà∞Á≠âÂæÖË∂Ö    Êó∂ÊàñÂèëÁé∞ÂèØÂºπÂá∫ÂÖÉÁ¥†‰∏∫Ê≠¢</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/5.3.2.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-4-ÈõÜÂêàÊìç‰ΩúÂëΩ‰ª§"><a href="#3-4-ÈõÜÂêàÊìç‰ΩúÂëΩ‰ª§" class="headerlink" title="3.4 ÈõÜÂêàÊìç‰ΩúÂëΩ‰ª§"></a>3.4 ÈõÜÂêàÊìç‰ΩúÂëΩ‰ª§</h3><p>Redis set ÊòØstringÁ±ªÂûãÁöÑÊó†Â∫èÈõÜÂêà„ÄÇÈõÜÂêàÊàêÂëòÊòØÂîØ‰∏ÄÁöÑÔºåËøôÂ∞±ÊÑèÂë≥ÁùÄÈõÜÂêà‰∏≠‰∏çËÉΩÂá∫Áé∞ÈáçÂ§çÁöÑÊï∞ÊçÆÔºåÂ∏∏Áî®ÂëΩ‰ª§Ôºö</p>
<ul>
<li><strong>SADD</strong> key member1 [member2]            ÂêëÈõÜÂêàÊ∑ªÂä†‰∏Ä‰∏™ÊàñÂ§ö‰∏™ÊàêÂëò</li>
<li><strong>SMEMBERS</strong> key                                         ËøîÂõûÈõÜÂêà‰∏≠ÁöÑÊâÄÊúâÊàêÂëò</li>
<li><strong>SCARD</strong> key                                                  Ëé∑ÂèñÈõÜÂêàÁöÑÊàêÂëòÊï∞</li>
<li><strong>SINTER</strong> key1 [key2]                                   ËøîÂõûÁªôÂÆöÊâÄÊúâÈõÜÂêàÁöÑ‰∫§ÈõÜ</li>
<li><strong>SUNION</strong> key1 [key2]                                 ËøîÂõûÊâÄÊúâÁªôÂÆöÈõÜÂêàÁöÑÂπ∂ÈõÜ</li>
<li><strong>SREM</strong> key member1 [member2]            ÁßªÈô§ÈõÜÂêà‰∏≠‰∏Ä‰∏™ÊàñÂ§ö‰∏™ÊàêÂëò</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/5.3.3.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-5-ÊúâÂ∫èÈõÜÂêàÊìç‰ΩúÂëΩ‰ª§"><a href="#3-5-ÊúâÂ∫èÈõÜÂêàÊìç‰ΩúÂëΩ‰ª§" class="headerlink" title="3.5 ÊúâÂ∫èÈõÜÂêàÊìç‰ΩúÂëΩ‰ª§"></a>3.5 ÊúâÂ∫èÈõÜÂêàÊìç‰ΩúÂëΩ‰ª§</h3><p>RedisÊúâÂ∫èÈõÜÂêàÊòØstringÁ±ªÂûãÂÖÉÁ¥†ÁöÑÈõÜÂêàÔºå‰∏î‰∏çÂÖÅËÆ∏ÊúâÈáçÂ§çÊàêÂëò„ÄÇÊØè‰∏™ÂÖÉÁ¥†ÈÉΩ‰ºöÂÖ≥ËÅî‰∏Ä‰∏™doubleÁ±ªÂûãÁöÑÂàÜÊï∞„ÄÇÂ∏∏Áî®ÂëΩ‰ª§Ôºö</p>
<p>Â∏∏Áî®ÂëΩ‰ª§Ôºö</p>
<ul>
<li><strong>ZADD</strong> key score1 member1 [score2 member2]     ÂêëÊúâÂ∫èÈõÜÂêàÊ∑ªÂä†‰∏Ä‰∏™ÊàñÂ§ö‰∏™ÊàêÂëò</li>
<li><strong>ZRANGE</strong> key start stop [WITHSCORES]                     ÈÄöËøáÁ¥¢ÂºïÂå∫Èó¥ËøîÂõûÊúâÂ∫èÈõÜÂêà‰∏≠ÊåáÂÆöÂå∫Èó¥ÂÜÖÁöÑÊàêÂëò</li>
<li><strong>ZINCRBY</strong> key increment member                              ÊúâÂ∫èÈõÜÂêà‰∏≠ÂØπÊåáÂÆöÊàêÂëòÁöÑÂàÜÊï∞Âä†‰∏äÂ¢ûÈáè increment</li>
<li><strong>ZREM</strong> key member [member ‚Ä¶]                                ÁßªÈô§ÊúâÂ∫èÈõÜÂêà‰∏≠ÁöÑ‰∏Ä‰∏™ÊàñÂ§ö‰∏™ÊàêÂëò</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/5.3.4.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-6-ÈÄöÁî®ÂëΩ‰ª§"><a href="#3-6-ÈÄöÁî®ÂëΩ‰ª§" class="headerlink" title="3.6 ÈÄöÁî®ÂëΩ‰ª§"></a>3.6 ÈÄöÁî®ÂëΩ‰ª§</h3><p>RedisÁöÑÈÄöÁî®ÂëΩ‰ª§ÊòØ‰∏çÂàÜÊï∞ÊçÆÁ±ªÂûãÁöÑÔºåÈÉΩÂèØ‰ª•‰ΩøÁî®ÁöÑÂëΩ‰ª§Ôºö</p>
<ul>
<li>KEYS pattern 		Êü•ÊâæÊâÄÊúâÁ¨¶ÂêàÁªôÂÆöÊ®°Âºè( pattern)ÁöÑ key </li>
<li>EXISTS key 		Ê£ÄÊü•ÁªôÂÆö key ÊòØÂê¶Â≠òÂú®</li>
<li>TYPE key 		ËøîÂõû key ÊâÄÂÇ®Â≠òÁöÑÂÄºÁöÑÁ±ªÂûã</li>
<li>DEL key 		ËØ•ÂëΩ‰ª§Áî®‰∫éÂú® key Â≠òÂú®ÊòØÂà†Èô§ key</li>
</ul>
<h2 id="4-Âú®java‰∏≠Êìç‰ΩúRedis"><a href="#4-Âú®java‰∏≠Êìç‰ΩúRedis" class="headerlink" title="4. Âú®java‰∏≠Êìç‰ΩúRedis"></a>4. Âú®java‰∏≠Êìç‰ΩúRedis</h2><h3 id="4-1-Spring-Data-Redis"><a href="#4-1-Spring-Data-Redis" class="headerlink" title="4.1 Spring Data Redis"></a>4.1 Spring Data Redis</h3><p>Spring ÂØπ Redis ÂÆ¢Êà∑Á´ØËøõË°å‰∫ÜÊï¥ÂêàÔºåÊèê‰æõ‰∫Ü Spring Data RedisÔºåÊàë‰ª¨ÈáçÁÇπÂ≠¶‰π†<strong>Spring Data Redis</strong>„ÄÇ</p>
<p>Spring Data Redis‰∏≠Êèê‰æõ‰∫Ü‰∏Ä‰∏™È´òÂ∫¶Â∞ÅË£ÖÁöÑÁ±ªÔºö<strong>RedisTemplate</strong>ÔºåÂØπÁõ∏ÂÖ≥apiËøõË°å‰∫ÜÂΩíÁ±ªÂ∞ÅË£Ö,Â∞ÜÂêå‰∏ÄÁ±ªÂûãÊìç‰ΩúÂ∞ÅË£Ö‰∏∫operationÊé•Âè£ÔºåÂÖ∑‰ΩìÂàÜÁ±ªÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>ValueOperationsÔºöstringÊï∞ÊçÆÊìç‰Ωú</li>
<li>SetOperationsÔºösetÁ±ªÂûãÊï∞ÊçÆÊìç‰Ωú</li>
<li>ZSetOperationsÔºözsetÁ±ªÂûãÊï∞ÊçÆÊìç‰Ωú</li>
<li>HashOperationsÔºöhashÁ±ªÂûãÁöÑÊï∞ÊçÆÊìç‰Ωú</li>
<li>ListOperationsÔºölistÁ±ªÂûãÁöÑÊï∞ÊçÆÊìç‰Ωú</li>
</ul>
<h3 id="4-2-ÈÄöËøáRedisTemplateÂØπË±°Êìç‰ΩúRedis"><a href="#4-2-ÈÄöËøáRedisTemplateÂØπË±°Êìç‰ΩúRedis" class="headerlink" title="4.2 ÈÄöËøáRedisTemplateÂØπË±°Êìç‰ΩúRedis"></a>4.2 ÈÄöËøáRedisTemplateÂØπË±°Êìç‰ΩúRedis</h3><p>Âú®test‰∏ãÊñ∞Âª∫ÊµãËØïÁ±ª</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.test;<br><br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.*;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringDataRedisTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedisTemplate</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(redisTemplate);<br>        <span class="hljs-comment">//stringÊï∞ÊçÆÊìç‰Ωú</span><br>        <span class="hljs-type">ValueOperations</span> <span class="hljs-variable">valueOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue();<br>        <span class="hljs-comment">//hashÁ±ªÂûãÁöÑÊï∞ÊçÆÊìç‰Ωú</span><br>        <span class="hljs-type">HashOperations</span> <span class="hljs-variable">hashOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForHash();<br>        <span class="hljs-comment">//listÁ±ªÂûãÁöÑÊï∞ÊçÆÊìç‰Ωú</span><br>        <span class="hljs-type">ListOperations</span> <span class="hljs-variable">listOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForList();<br>        <span class="hljs-comment">//setÁ±ªÂûãÊï∞ÊçÆÊìç‰Ωú</span><br>        <span class="hljs-type">SetOperations</span> <span class="hljs-variable">setOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForSet();<br>        <span class="hljs-comment">//zsetÁ±ªÂûãÊï∞ÊçÆÊìç‰Ωú</span><br>        <span class="hljs-type">ZSetOperations</span> <span class="hljs-variable">zSetOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForZSet();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-Êìç‰ΩúÂ∏∏ËßÅÁ±ªÂûãÊï∞ÊçÆ"><a href="#4-3-Êìç‰ΩúÂ∏∏ËßÅÁ±ªÂûãÊï∞ÊçÆ" class="headerlink" title="4.3 Êìç‰ΩúÂ∏∏ËßÅÁ±ªÂûãÊï∞ÊçÆ"></a>4.3 Êìç‰ΩúÂ∏∏ËßÅÁ±ªÂûãÊï∞ÊçÆ</h3><p><strong>1). Êìç‰ΩúÂ≠óÁ¨¶‰∏≤Á±ªÂûãÊï∞ÊçÆ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êìç‰ΩúÂ≠óÁ¨¶‰∏≤Á±ªÂûãÁöÑÊï∞ÊçÆ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testString</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">// set get setex setnx</span><br>    redisTemplate.opsForValue().set(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;Â∞èÊòé&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">city</span> <span class="hljs-operator">=</span> (String) redisTemplate.opsForValue().get(<span class="hljs-string">&quot;name&quot;</span>);<br>    System.out.println(city);<br>    redisTemplate.opsForValue().set(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-string">&quot;1234&quot;</span>,<span class="hljs-number">3</span>, TimeUnit.MINUTES);<br>    redisTemplate.opsForValue().setIfAbsent(<span class="hljs-string">&quot;lock&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>);<br>    redisTemplate.opsForValue().setIfAbsent(<span class="hljs-string">&quot;lock&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>2). Êìç‰ΩúÂìàÂ∏åÁ±ªÂûãÊï∞ÊçÆ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êìç‰ΩúÂìàÂ∏åÁ±ªÂûãÁöÑÊï∞ÊçÆ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testHash</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//hset hget hdel hkeys hvals</span><br>    <span class="hljs-type">HashOperations</span> <span class="hljs-variable">hashOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForHash();<br><br>    hashOperations.put(<span class="hljs-string">&quot;100&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;tom&quot;</span>);<br>    hashOperations.put(<span class="hljs-string">&quot;100&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-string">&quot;20&quot;</span>);<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) hashOperations.get(<span class="hljs-string">&quot;100&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>);<br>    System.out.println(name);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">keys</span> <span class="hljs-operator">=</span> hashOperations.keys(<span class="hljs-string">&quot;100&quot;</span>);<br>    System.out.println(keys);<br><br>    <span class="hljs-type">List</span> <span class="hljs-variable">values</span> <span class="hljs-operator">=</span> hashOperations.values(<span class="hljs-string">&quot;100&quot;</span>);<br>    System.out.println(values);<br><br>    hashOperations.delete(<span class="hljs-string">&quot;100&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>3). Êìç‰ΩúÂàóË°®Á±ªÂûãÊï∞ÊçÆ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êìç‰ΩúÂàóË°®Á±ªÂûãÁöÑÊï∞ÊçÆ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testList</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//lpush lrange rpop llen</span><br>    <span class="hljs-type">ListOperations</span> <span class="hljs-variable">listOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForList();<br><br>    listOperations.leftPushAll(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>);<br>    listOperations.leftPush(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>);<br><br>    <span class="hljs-type">List</span> <span class="hljs-variable">mylist</span> <span class="hljs-operator">=</span> listOperations.range(<span class="hljs-string">&quot;mylist&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>    System.out.println(mylist);<br><br>    listOperations.rightPop(<span class="hljs-string">&quot;mylist&quot;</span>);<br><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> listOperations.size(<span class="hljs-string">&quot;mylist&quot;</span>);<br>    System.out.println(size);<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>4). Êìç‰ΩúÈõÜÂêàÁ±ªÂûãÊï∞ÊçÆ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êìç‰ΩúÈõÜÂêàÁ±ªÂûãÁöÑÊï∞ÊçÆ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSet</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//sadd smembers scard sinter sunion srem</span><br>    <span class="hljs-type">SetOperations</span> <span class="hljs-variable">setOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForSet();<br><br>    setOperations.add(<span class="hljs-string">&quot;set1&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>);<br>    setOperations.add(<span class="hljs-string">&quot;set2&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;x&quot;</span>,<span class="hljs-string">&quot;y&quot;</span>);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">members</span> <span class="hljs-operator">=</span> setOperations.members(<span class="hljs-string">&quot;set1&quot;</span>);<br>    System.out.println(members);<br><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> setOperations.size(<span class="hljs-string">&quot;set1&quot;</span>);<br>    System.out.println(size);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">intersect</span> <span class="hljs-operator">=</span> setOperations.intersect(<span class="hljs-string">&quot;set1&quot;</span>, <span class="hljs-string">&quot;set2&quot;</span>);<br>    System.out.println(intersect);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">union</span> <span class="hljs-operator">=</span> setOperations.union(<span class="hljs-string">&quot;set1&quot;</span>, <span class="hljs-string">&quot;set2&quot;</span>);<br>    System.out.println(union);<br><br>    setOperations.remove(<span class="hljs-string">&quot;set1&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>


<p><strong>5). Êìç‰ΩúÊúâÂ∫èÈõÜÂêàÁ±ªÂûãÊï∞ÊçÆ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êìç‰ΩúÊúâÂ∫èÈõÜÂêàÁ±ªÂûãÁöÑÊï∞ÊçÆ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testZset</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//zadd zrange zincrby zrem</span><br>    <span class="hljs-type">ZSetOperations</span> <span class="hljs-variable">zSetOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForZSet();<br><br>    zSetOperations.add(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-number">10</span>);<br>    zSetOperations.add(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-number">12</span>);<br>    zSetOperations.add(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-number">9</span>);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">zset1</span> <span class="hljs-operator">=</span> zSetOperations.range(<span class="hljs-string">&quot;zset1&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>    System.out.println(zset1);<br><br>    zSetOperations.incrementScore(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-number">10</span>);<br><br>    zSetOperations.remove(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>6). ÈÄöÁî®ÂëΩ‰ª§Êìç‰Ωú</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÈÄöÁî®ÂëΩ‰ª§Êìç‰Ωú</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCommon</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//keys exists type del</span><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">keys</span> <span class="hljs-operator">=</span> redisTemplate.keys(<span class="hljs-string">&quot;*&quot;</span>);<br>    System.out.println(keys);<br><br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(<span class="hljs-string">&quot;name&quot;</span>);<br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">set1</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(<span class="hljs-string">&quot;set1&quot;</span>);<br><br>    <span class="hljs-keyword">for</span> (Object key : keys) &#123;<br>        <span class="hljs-type">DataType</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> redisTemplate.type(key);<br>        System.out.println(type.name());<br>    &#125;<br><br>    redisTemplate.delete(<span class="hljs-string">&quot;mylist&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="ÂÖ≠-Â∫óÈì∫Ëê•‰∏öÁä∂ÊÄÅ"><a href="#ÂÖ≠-Â∫óÈì∫Ëê•‰∏öÁä∂ÊÄÅ" class="headerlink" title="ÂÖ≠. Â∫óÈì∫Ëê•‰∏öÁä∂ÊÄÅ"></a>ÂÖ≠. Â∫óÈì∫Ëê•‰∏öÁä∂ÊÄÅ</h1><p>Ëê•‰∏öÁä∂ÊÄÅÂàÜ‰∏∫<strong>Ëê•‰∏ö‰∏≠</strong>Âíå<strong>ÊâìÁÉä‰∏≠</strong></p>
<h2 id="1-ËÆæÁΩÆËê•‰∏öÁä∂ÊÄÅ"><a href="#1-ËÆæÁΩÆËê•‰∏öÁä∂ÊÄÅ" class="headerlink" title="1. ËÆæÁΩÆËê•‰∏öÁä∂ÊÄÅ"></a>1. ËÆæÁΩÆËê•‰∏öÁä∂ÊÄÅ</h2><p>Âú®sky-serverÊ®°Âùó‰∏≠ÔºåÂàõÂª∫ShopController.java</p>
<p><strong>Ê†πÊçÆÊé•Âè£ÂÆö‰πâÂàõÂª∫ShopControllerÁöÑsetStatusËÆæÁΩÆËê•‰∏öÁä∂ÊÄÅÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.admin;<br><br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PutMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@RestController(&quot;adminShopController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/shop&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;Â∫óÈì∫Áõ∏ÂÖ≥Êé•Âè£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopController</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SHOP_STATUS&quot;</span>;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ËÆæÁΩÆÂ∫óÈì∫ÁöÑËê•‰∏öÁä∂ÊÄÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PutMapping(&quot;/&#123;status&#125;&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;ËÆæÁΩÆÂ∫óÈì∫ÁöÑËê•‰∏öÁä∂ÊÄÅ&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">setStatus</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;ËÆæÁΩÆÂ∫óÈì∫ÁöÑËê•‰∏öÁä∂ÊÄÅ‰∏∫Ôºö&#123;&#125;&quot;</span>,status == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;Ëê•‰∏ö‰∏≠&quot;</span> : <span class="hljs-string">&quot;ÊâìÁÉä‰∏≠&quot;</span>);<br>        redisTemplate.opsForValue().set(KEY,status);<br>        <span class="hljs-keyword">return</span> Result.success();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="2-ÁÆ°ÁêÜÁ´ØÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅ"><a href="#2-ÁÆ°ÁêÜÁ´ØÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅ" class="headerlink" title="2. ÁÆ°ÁêÜÁ´ØÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅ"></a>2. ÁÆ°ÁêÜÁ´ØÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅ</h2><p><strong>Ê†πÊçÆÊé•Âè£ÂÆö‰πâÂàõÂª∫ShopControllerÁöÑgetStatusÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ëé∑ÂèñÂ∫óÈì∫ÁöÑËê•‰∏öÁä∂ÊÄÅ</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/status&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Ëé∑ÂèñÂ∫óÈì∫ÁöÑËê•‰∏öÁä∂ÊÄÅ&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;Integer&gt; <span class="hljs-title function_">getStatus</span><span class="hljs-params">()</span>&#123;<br>       <span class="hljs-type">Integer</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);<br>       log.info(<span class="hljs-string">&quot;Ëé∑ÂèñÂà∞Â∫óÈì∫ÁöÑËê•‰∏öÁä∂ÊÄÅ‰∏∫Ôºö&#123;&#125;&quot;</span>,status == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;Ëê•‰∏ö‰∏≠&quot;</span> : <span class="hljs-string">&quot;ÊâìÁÉä‰∏≠&quot;</span>);<br>       <span class="hljs-keyword">return</span> Result.success(status);<br>   &#125;<br></code></pre></td></tr></table></figure>



<h2 id="3-Áî®Êà∑Á´ØÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅ"><a href="#3-Áî®Êà∑Á´ØÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅ" class="headerlink" title="3. Áî®Êà∑Á´ØÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅ"></a>3. Áî®Êà∑Á´ØÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅ</h2><p>ÂàõÂª∫com.sky.controller.userÂåÖÔºåÂú®ËØ•ÂåÖ‰∏ãÂàõÂª∫ShopController.java</p>
<p><strong>Ê†πÊçÆÊé•Âè£ÂÆö‰πâÂàõÂª∫ShopControllerÁöÑgetStatusÊü•ËØ¢Ëê•‰∏öÁä∂ÊÄÅÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-meta">@RestController(&quot;userShopController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/shop&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;Â∫óÈì∫Áõ∏ÂÖ≥Êé•Âè£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopController</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SHOP_STATUS&quot;</span>;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ëé∑ÂèñÂ∫óÈì∫ÁöÑËê•‰∏öÁä∂ÊÄÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/status&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Ëé∑ÂèñÂ∫óÈì∫ÁöÑËê•‰∏öÁä∂ÊÄÅ&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;Integer&gt; <span class="hljs-title function_">getStatus</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);<br>        log.info(<span class="hljs-string">&quot;Ëé∑ÂèñÂà∞Â∫óÈì∫ÁöÑËê•‰∏öÁä∂ÊÄÅ‰∏∫Ôºö&#123;&#125;&quot;</span>,status == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;Ëê•‰∏ö‰∏≠&quot;</span> : <span class="hljs-string">&quot;ÊâìÁÉä‰∏≠&quot;</span>);<br>        <span class="hljs-keyword">return</span> Result.success(status);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="‰∏É-HttpClient"><a href="#‰∏É-HttpClient" class="headerlink" title="‰∏É. HttpClient"></a>‰∏É. HttpClient</h1><p>HttpClient ÊòØApache Jakarta Common ‰∏ãÁöÑÂ≠êÈ°πÁõÆÔºåÂèØ‰ª•Áî®Êù•Êèê‰æõÈ´òÊïàÁöÑ„ÄÅÊúÄÊñ∞ÁöÑ„ÄÅÂäüËÉΩ‰∏∞ÂØåÁöÑÊîØÊåÅ HTTP ÂçèËÆÆÁöÑÂÆ¢Êà∑Á´ØÁºñÁ®ãÂ∑•ÂÖ∑ÂåÖÔºåÂπ∂‰∏îÂÆÉÊîØÊåÅ HTTP ÂçèËÆÆÊúÄÊñ∞ÁöÑÁâàÊú¨ÂíåÂª∫ËÆÆ„ÄÇ</p>
<p><strong>HttpClient‰ΩúÁî®Ôºö</strong></p>
<ul>
<li>ÂèëÈÄÅHTTPËØ∑Ê±Ç</li>
<li>Êé•Êî∂ÂìçÂ∫îÊï∞ÊçÆ</li>
</ul>
<p><strong>HttpClientÁöÑÊ†∏ÂøÉAPIÔºö</strong></p>
<ul>
<li>HttpClientÔºöHttpÂÆ¢Êà∑Á´ØÂØπË±°Á±ªÂûãÔºå‰ΩøÁî®ËØ•Á±ªÂûãÂØπË±°ÂèØÂèëËµ∑HttpËØ∑Ê±Ç„ÄÇ</li>
<li>HttpClientsÔºöÂèØËÆ§‰∏∫ÊòØÊûÑÂª∫Âô®ÔºåÂèØÂàõÂª∫HttpClientÂØπË±°„ÄÇ</li>
<li>CloseableHttpClientÔºöÂÆûÁé∞Á±ªÔºåÂÆûÁé∞‰∫ÜHttpClientÊé•Âè£„ÄÇ</li>
<li>HttpGetÔºöGetÊñπÂºèËØ∑Ê±ÇÁ±ªÂûã„ÄÇ</li>
<li>HttpPostÔºöPostÊñπÂºèËØ∑Ê±ÇÁ±ªÂûã„ÄÇ</li>
</ul>
<p><strong>HttpClientÂèëÈÄÅËØ∑Ê±ÇÊ≠•È™§Ôºö</strong></p>
<ul>
<li>ÂàõÂª∫HttpClientÂØπË±°</li>
<li>ÂàõÂª∫HttpËØ∑Ê±ÇÂØπË±°</li>
<li>Ë∞ÉÁî®HttpClientÁöÑexecuteÊñπÊ≥ïÂèëÈÄÅËØ∑Ê±Ç</li>
</ul>
<h1 id="ÂÖ´-ÂæÆ‰ø°ÁôªÂΩï"><a href="#ÂÖ´-ÂæÆ‰ø°ÁôªÂΩï" class="headerlink" title="ÂÖ´. ÂæÆ‰ø°ÁôªÂΩï"></a>ÂÖ´. ÂæÆ‰ø°ÁôªÂΩï</h1><h2 id="1-ÂÆö‰πâÁõ∏ÂÖ≥ÈÖçÁΩÆ"><a href="#1-ÂÆö‰πâÁõ∏ÂÖ≥ÈÖçÁΩÆ" class="headerlink" title="1. ÂÆö‰πâÁõ∏ÂÖ≥ÈÖçÁΩÆ"></a>1. ÂÆö‰πâÁõ∏ÂÖ≥ÈÖçÁΩÆ</h2><h3 id="1-1-ÈÖçÁΩÆÂæÆ‰ø°ÁôªÂΩïÊâÄÈúÄÈÖçÁΩÆÈ°π"><a href="#1-1-ÈÖçÁΩÆÂæÆ‰ø°ÁôªÂΩïÊâÄÈúÄÈÖçÁΩÆÈ°π" class="headerlink" title="1.1 ÈÖçÁΩÆÂæÆ‰ø°ÁôªÂΩïÊâÄÈúÄÈÖçÁΩÆÈ°π"></a>1.1 ÈÖçÁΩÆÂæÆ‰ø°ÁôªÂΩïÊâÄÈúÄÈÖçÁΩÆÈ°π</h3><p>application-dev.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">wechat:</span><br>    <span class="hljs-attr">appid:</span> <span class="hljs-string">wxffb3637a228223b8</span><br>    <span class="hljs-attr">secret:</span> <span class="hljs-string">84311df9199ecacdf4f12d27b6b9522d</span><br></code></pre></td></tr></table></figure>

<p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">wechat:</span><br>    <span class="hljs-attr">appid:</span> <span class="hljs-string">$&#123;sky.wechat.appid&#125;</span><br>    <span class="hljs-attr">secret:</span> <span class="hljs-string">$&#123;sky.wechat.secret&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-2-ÈÖçÁΩÆ‰∏∫ÂæÆ‰ø°Áî®Êà∑ÁîüÊàêjwt‰ª§ÁâåÊó∂‰ΩøÁî®ÁöÑÈÖçÁΩÆÈ°π"><a href="#1-2-ÈÖçÁΩÆ‰∏∫ÂæÆ‰ø°Áî®Êà∑ÁîüÊàêjwt‰ª§ÁâåÊó∂‰ΩøÁî®ÁöÑÈÖçÁΩÆÈ°π" class="headerlink" title="1.2 ÈÖçÁΩÆ‰∏∫ÂæÆ‰ø°Áî®Êà∑ÁîüÊàêjwt‰ª§ÁâåÊó∂‰ΩøÁî®ÁöÑÈÖçÁΩÆÈ°π"></a>1.2 ÈÖçÁΩÆ‰∏∫ÂæÆ‰ø°Áî®Êà∑ÁîüÊàêjwt‰ª§ÁâåÊó∂‰ΩøÁî®ÁöÑÈÖçÁΩÆÈ°π</h3><p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">jwt:</span><br>    <span class="hljs-comment"># ËÆæÁΩÆjwtÁ≠æÂêçÂä†ÂØÜÊó∂‰ΩøÁî®ÁöÑÁßòÈí•</span><br>    <span class="hljs-attr">admin-secret-key:</span> <span class="hljs-string">itcast</span><br>    <span class="hljs-comment"># ËÆæÁΩÆjwtËøáÊúüÊó∂Èó¥</span><br>    <span class="hljs-attr">admin-ttl:</span> <span class="hljs-number">7200000</span><br>    <span class="hljs-comment"># ËÆæÁΩÆÂâçÁ´Ø‰º†ÈÄíËøáÊù•ÁöÑ‰ª§ÁâåÂêçÁß∞</span><br>    <span class="hljs-attr">admin-token-name:</span> <span class="hljs-string">token</span><br>    <span class="hljs-attr">user-secret-key:</span> <span class="hljs-string">itheima</span><br>    <span class="hljs-attr">user-ttl:</span> <span class="hljs-number">7200000</span><br>    <span class="hljs-attr">user-token-name:</span> <span class="hljs-string">authentication</span><br></code></pre></td></tr></table></figure>



<h2 id="2-DTOËÆæËÆ°"><a href="#2-DTOËÆæËÆ°" class="headerlink" title="2. DTOËÆæËÆ°"></a>2. DTOËÆæËÆ°</h2><p><strong>Ê†πÊçÆ‰º†ÂÖ•ÂèÇÊï∞ËÆæËÆ°DTOÁ±ªÔºö</strong></p>
<img src="assets/image-20221205183625049.png" srcset="/img/loading.gif" lazyload alt="image-20221205183625049" style="zoom:50%;" /> 

<p>Âú®sky-pojoÊ®°ÂùóÔºåUserLoginDTO.javaÂ∑≤ÂÆö‰πâ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.dto;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * CÁ´ØÁî®Êà∑ÁôªÂΩï</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLoginDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String code;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="3-VOËÆæËÆ°"><a href="#3-VOËÆæËÆ°" class="headerlink" title="3. VOËÆæËÆ°"></a>3. VOËÆæËÆ°</h2><p><strong>Ê†πÊçÆËøîÂõûÊï∞ÊçÆËÆæËÆ°VOÁ±ªÔºö</strong></p>
<img src="assets/image-20221205183923272.png" srcset="/img/loading.gif" lazyload alt="image-20221205183923272" style="zoom:50%;" /> 

<p>Âú®sky-pojoÊ®°ÂùóÔºåUserLoginVO.javaÂ∑≤ÂÆö‰πâ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.vo;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Builder;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Builder</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLoginVO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String openid;<br>    <span class="hljs-keyword">private</span> String token;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="4-ControllerÂ±Ç"><a href="#4-ControllerÂ±Ç" class="headerlink" title="4. ControllerÂ±Ç"></a>4. ControllerÂ±Ç</h2><p><strong>Ê†πÊçÆÊé•Âè£ÂÆö‰πâÂàõÂª∫UserControllerÁöÑloginÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.constant.JwtClaimsConstant;<br><span class="hljs-keyword">import</span> com.sky.dto.UserLoginDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.User;<br><span class="hljs-keyword">import</span> com.sky.properties.JwtProperties;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.UserService;<br><span class="hljs-keyword">import</span> com.sky.utils.JwtUtil;<br><span class="hljs-keyword">import</span> com.sky.vo.UserLoginVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/user&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;CÁ´ØÁî®Êà∑Áõ∏ÂÖ≥Êé•Âè£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JwtProperties jwtProperties;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂæÆ‰ø°ÁôªÂΩï</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userLoginDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;ÂæÆ‰ø°ÁôªÂΩï&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;UserLoginVO&gt; <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> UserLoginDTO userLoginDTO)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;ÂæÆ‰ø°Áî®Êà∑ÁôªÂΩïÔºö&#123;&#125;&quot;</span>,userLoginDTO.getCode());<br><br>        <span class="hljs-comment">//ÂæÆ‰ø°ÁôªÂΩï</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.wxLogin(userLoginDTO);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂÆûÁé∞</span><br><br>        <span class="hljs-comment">//‰∏∫ÂæÆ‰ø°Áî®Êà∑ÁîüÊàêjwt‰ª§Áâå</span><br>        Map&lt;String, Object&gt; claims = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        claims.put(JwtClaimsConstant.USER_ID,user.getId());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JwtUtil.createJWT(jwtProperties.getUserSecretKey(), jwtProperties.getUserTtl(), claims);<br><br>        <span class="hljs-type">UserLoginVO</span> <span class="hljs-variable">userLoginVO</span> <span class="hljs-operator">=</span> UserLoginVO.builder()<br>                .id(user.getId())<br>                .openid(user.getOpenid())<br>                .token(token)<br>                .build();<br>        <span class="hljs-keyword">return</span> Result.success(userLoginVO);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="5-ServiceÂ±Ç"><a href="#5-ServiceÂ±Ç" class="headerlink" title="5. ServiceÂ±Ç"></a>5. ServiceÂ±Ç</h2><h3 id="5-1-ServiceÂ±ÇÊé•Âè£"><a href="#5-1-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="5.1 ServiceÂ±ÇÊé•Âè£"></a>5.1 ServiceÂ±ÇÊé•Âè£</h3><p><strong>ÂàõÂª∫UserServiceÊé•Âè£Ôºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.UserLoginDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.User;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂæÆ‰ø°ÁôªÂΩï</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userLoginDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    User <span class="hljs-title function_">wxLogin</span><span class="hljs-params">(UserLoginDTO userLoginDTO)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-2-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#5-2-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="5.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>5.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h3><p>**ÂàõÂª∫UserServiceImplÂÆûÁé∞Á±ªÔºö**ÂÆûÁé∞Ëé∑ÂèñÂæÆ‰ø°Áî®Êà∑ÁöÑopenidÂíåÂæÆ‰ø°ÁôªÂΩïÂäüËÉΩ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><span class="hljs-keyword">import</span> com.sky.constant.MessageConstant;<br><span class="hljs-keyword">import</span> com.sky.dto.UserLoginDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.User;<br><span class="hljs-keyword">import</span> com.sky.exception.LoginFailedException;<br><span class="hljs-keyword">import</span> com.sky.mapper.UserMapper;<br><span class="hljs-keyword">import</span> com.sky.properties.WeChatProperties;<br><span class="hljs-keyword">import</span> com.sky.service.UserService;<br><span class="hljs-keyword">import</span> com.sky.utils.HttpClientUtil;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-comment">//ÂæÆ‰ø°ÊúçÂä°Êé•Âè£Âú∞ÂùÄ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">WX_LOGIN</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://api.weixin.qq.com/sns/jscode2session&quot;</span>;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> WeChatProperties weChatProperties;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÂæÆ‰ø°ÁôªÂΩï</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userLoginDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">wxLogin</span><span class="hljs-params">(UserLoginDTO userLoginDTO)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">openid</span> <span class="hljs-operator">=</span> getOpenid(userLoginDTO.getCode());<br><br>        <span class="hljs-comment">//Âà§Êñ≠openidÊòØÂê¶‰∏∫Á©∫ÔºåÂ¶ÇÊûú‰∏∫Á©∫Ë°®Á§∫ÁôªÂΩïÂ§±Ë¥•ÔºåÊäõÂá∫‰∏öÂä°ÂºÇÂ∏∏</span><br>        <span class="hljs-keyword">if</span>(openid == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginFailedException</span>(MessageConstant.LOGIN_FAILED);<br>        &#125;<br><br>        <span class="hljs-comment">//Âà§Êñ≠ÂΩìÂâçÁî®Êà∑ÊòØÂê¶‰∏∫Êñ∞Áî®Êà∑</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.getByOpenid(openid);<br><br>        <span class="hljs-comment">//Â¶ÇÊûúÊòØÊñ∞Áî®Êà∑ÔºåËá™Âä®ÂÆåÊàêÊ≥®ÂÜå</span><br>        <span class="hljs-keyword">if</span>(user == <span class="hljs-literal">null</span>)&#123;<br>            user = User.builder()<br>                    .openid(openid)<br>                    .createTime(LocalDateTime.now())<br>                    .build();<br>            userMapper.insert(user);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂÆûÁé∞</span><br>        &#125;<br><br>        <span class="hljs-comment">//ËøîÂõûËøô‰∏™Áî®Êà∑ÂØπË±°</span><br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ë∞ÉÁî®ÂæÆ‰ø°Êé•Âè£ÊúçÂä°ÔºåËé∑ÂèñÂæÆ‰ø°Áî®Êà∑ÁöÑopenid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getOpenid</span><span class="hljs-params">(String code)</span>&#123;<br>        <span class="hljs-comment">//Ë∞ÉÁî®ÂæÆ‰ø°Êé•Âè£ÊúçÂä°ÔºåËé∑ÂæóÂΩìÂâçÂæÆ‰ø°Áî®Êà∑ÁöÑopenid</span><br>        Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;appid&quot;</span>,weChatProperties.getAppid());<br>        map.put(<span class="hljs-string">&quot;secret&quot;</span>,weChatProperties.getSecret());<br>        map.put(<span class="hljs-string">&quot;js_code&quot;</span>,code);<br>        map.put(<span class="hljs-string">&quot;grant_type&quot;</span>,<span class="hljs-string">&quot;authorization_code&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> HttpClientUtil.doGet(WX_LOGIN, map);<br><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> JSON.parseObject(json);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">openid</span> <span class="hljs-operator">=</span> jsonObject.getString(<span class="hljs-string">&quot;openid&quot;</span>);<br>        <span class="hljs-keyword">return</span> openid;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="6-MapperÂ±Ç"><a href="#6-MapperÂ±Ç" class="headerlink" title="6. MapperÂ±Ç"></a>6. MapperÂ±Ç</h2><p><strong>ÂàõÂª∫UserMapperÊé•Âè£Ôºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.User;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Select;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆopenidÊü•ËØ¢Áî®Êà∑</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> openid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Select(&quot;select * from user where openid = #&#123;openid&#125;&quot;)</span><br>    User <span class="hljs-title function_">getByOpenid</span><span class="hljs-params">(String openid)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊèíÂÖ•Êï∞ÊçÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> user</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(User user)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ÂàõÂª∫UserMapper.xmlÊò†Â∞ÑÊñá‰ª∂Ôºö</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.UserMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>        insert into user (openid, name, phone, sex, id_number, avatar, create_time)<br>        values (#&#123;openid&#125;, #&#123;name&#125;, #&#123;phone&#125;, #&#123;sex&#125;, #&#123;idNumber&#125;, #&#123;avatar&#125;, #&#123;createTime&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="7-ÁºñÂÜôÊã¶Êà™Âô®"><a href="#7-ÁºñÂÜôÊã¶Êà™Âô®" class="headerlink" title="7. ÁºñÂÜôÊã¶Êà™Âô®"></a>7. ÁºñÂÜôÊã¶Êà™Âô®</h2><p>**ÁºñÂÜôÊã¶Êà™Âô®JwtTokenUserInterceptorÔºö**Áªü‰∏ÄÊã¶Êà™Áî®Êà∑Á´ØÂèëÈÄÅÁöÑËØ∑Ê±ÇÂπ∂ËøõË°åjwtÊ†°È™å</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.interceptor;<br><br><span class="hljs-keyword">import</span> com.sky.constant.JwtClaimsConstant;<br><span class="hljs-keyword">import</span> com.sky.context.BaseContext;<br><span class="hljs-keyword">import</span> com.sky.properties.JwtProperties;<br><span class="hljs-keyword">import</span> com.sky.utils.JwtUtil;<br><span class="hljs-keyword">import</span> io.jsonwebtoken.Claims;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.method.HandlerMethod;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * jwt‰ª§ÁâåÊ†°È™åÁöÑÊã¶Êà™Âô®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtTokenUserInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JwtProperties jwtProperties;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†°È™åjwt</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//Âà§Êñ≠ÂΩìÂâçÊã¶Êà™Âà∞ÁöÑÊòØControllerÁöÑÊñπÊ≥ïËøòÊòØÂÖ∂‰ªñËµÑÊ∫ê</span><br>        <span class="hljs-keyword">if</span> (!(handler <span class="hljs-keyword">instanceof</span> HandlerMethod)) &#123;<br>            <span class="hljs-comment">//ÂΩìÂâçÊã¶Êà™Âà∞ÁöÑ‰∏çÊòØÂä®ÊÄÅÊñπÊ≥ïÔºåÁõ¥Êé•ÊîæË°å</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//1„ÄÅ‰ªéËØ∑Ê±ÇÂ§¥‰∏≠Ëé∑Âèñ‰ª§Áâå</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(jwtProperties.getUserTokenName());<br><br>        <span class="hljs-comment">//2„ÄÅÊ†°È™å‰ª§Áâå</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            log.info(<span class="hljs-string">&quot;jwtÊ†°È™å:&#123;&#125;&quot;</span>, token);<br>            <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> JwtUtil.parseJWT(jwtProperties.getUserSecretKey(), token);<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.USER_ID).toString());<br>            log.info(<span class="hljs-string">&quot;ÂΩìÂâçÁî®Êà∑ÁöÑidÔºö&quot;</span>, userId);<br>            BaseContext.setCurrentId(userId);<br>            <span class="hljs-comment">//3„ÄÅÈÄöËøáÔºåÊîæË°å</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            <span class="hljs-comment">//4„ÄÅ‰∏çÈÄöËøáÔºåÂìçÂ∫î401Áä∂ÊÄÅÁ†Å</span><br>            response.setStatus(<span class="hljs-number">401</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®WebMvcConfigurationÈÖçÁΩÆÁ±ª‰∏≠Ê≥®ÂÜåÊã¶Êà™Âô®Ôºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> JwtTokenUserInterceptor jwtTokenUserInterceptor;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê≥®ÂÜåËá™ÂÆö‰πâÊã¶Êà™Âô®</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> registry</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;ÂºÄÂßãÊ≥®ÂÜåËá™ÂÆö‰πâÊã¶Êà™Âô®...&quot;</span>);<br>    <span class="hljs-comment">//.........</span><br><br>    registry.addInterceptor(jwtTokenUserInterceptor)<br>            .addPathPatterns(<span class="hljs-string">&quot;/user/**&quot;</span>)<br>            .excludePathPatterns(<span class="hljs-string">&quot;/user/user/login&quot;</span>)<br>            .excludePathPatterns(<span class="hljs-string">&quot;/user/shop/status&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="‰πù-ÂïÜÂìÅÊµèËßàÂäüËÉΩ"><a href="#‰πù-ÂïÜÂìÅÊµèËßàÂäüËÉΩ" class="headerlink" title="‰πù. ÂïÜÂìÅÊµèËßàÂäüËÉΩ"></a>‰πù. ÂïÜÂìÅÊµèËßàÂäüËÉΩ</h1><p>ËøôÈáåÂØºÂÖ•Áõ∏ÂÖ≥‰ª£Á†Å</p>
<h2 id="1-MapperÂ±Ç"><a href="#1-MapperÂ±Ç" class="headerlink" title="1. MapperÂ±Ç"></a>1. MapperÂ±Ç</h2><p><strong>Âú®SetmealMapper.java‰∏≠Ê∑ªÂä†listÂíågetDishItemBySetmealId‰∏§‰∏™ÊñπÊ≥ï</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Âä®ÊÄÅÊù°‰ª∂Êü•ËØ¢Â•óÈ§ê</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   List&lt;Setmeal&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Setmeal setmeal)</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆÂ•óÈ§êidÊü•ËØ¢ËèúÂìÅÈÄâÈ°π</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select sd.name, sd.copies, d.image, d.description &quot; +</span><br><span class="hljs-meta">           &quot;from setmeal_dish sd left join dish d on sd.dish_id = d.id &quot; +</span><br><span class="hljs-meta">           &quot;where sd.setmeal_id = #&#123;setmealId&#125;&quot;)</span><br>   List&lt;DishItemVO&gt; <span class="hljs-title function_">getDishItemBySetmealId</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>ÂàõÂª∫SetmealMapper.xmlÊñá‰ª∂</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.SetmealMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Setmeal&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Setmeal&quot;</span>&gt;</span><br>        select * from setmeal<br>        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>                and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>                and category_id = #&#123;categoryId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                and status = #&#123;status&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="2-ServiceÂ±Ç"><a href="#2-ServiceÂ±Ç" class="headerlink" title="2. ServiceÂ±Ç"></a>2. ServiceÂ±Ç</h2><p><strong>ÂàõÂª∫SetmealService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.SetmealDTO;<br><span class="hljs-keyword">import</span> com.sky.dto.SetmealPageQueryDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.sky.result.PageResult;<br><span class="hljs-keyword">import</span> com.sky.vo.DishItemVO;<br><span class="hljs-keyword">import</span> com.sky.vo.SetmealVO;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SetmealService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êù°‰ª∂Êü•ËØ¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;Setmeal&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Setmeal setmeal)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆidÊü•ËØ¢ËèúÂìÅÈÄâÈ°π</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;DishItemVO&gt; <span class="hljs-title function_">getDishItemById</span><span class="hljs-params">(Long id)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ÂàõÂª∫SetmealServiceImpl.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><span class="hljs-keyword">import</span> com.sky.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.sky.mapper.DishMapper;<br><span class="hljs-keyword">import</span> com.sky.mapper.SetmealDishMapper;<br><span class="hljs-keyword">import</span> com.sky.mapper.SetmealMapper;<br><span class="hljs-keyword">import</span> com.sky.service.SetmealService;<br><span class="hljs-keyword">import</span> com.sky.vo.DishItemVO;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Â•óÈ§ê‰∏öÂä°ÂÆûÁé∞</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SetmealService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealMapper setmealMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealDishMapper setmealDishMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishMapper dishMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êù°‰ª∂Êü•ËØ¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;Setmeal&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Setmeal setmeal)</span> &#123;<br>        List&lt;Setmeal&gt; list = setmealMapper.list(setmeal);<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆidÊü•ËØ¢ËèúÂìÅÈÄâÈ°π</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;DishItemVO&gt; <span class="hljs-title function_">getDishItemById</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> setmealMapper.getDishItemBySetmealId(id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®DishService.java‰∏≠Ê∑ªÂä†listWithFlavorÊñπÊ≥ïÂÆö‰πâ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Êù°‰ª∂Êü•ËØ¢ËèúÂìÅÂíåÂè£Âë≥</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   List&lt;DishVO&gt; <span class="hljs-title function_">listWithFlavor</span><span class="hljs-params">(Dish dish)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®DishServiceImpl.java‰∏≠ÂÆûÁé∞listWithFlavorÊñπÊ≥ï</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Êù°‰ª∂Êü•ËØ¢ËèúÂìÅÂíåÂè£Âë≥</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> List&lt;DishVO&gt; <span class="hljs-title function_">listWithFlavor</span><span class="hljs-params">(Dish dish)</span> &#123;<br>       List&lt;Dish&gt; dishList = dishMapper.list(dish);<br><br>       List&lt;DishVO&gt; dishVOList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>       <span class="hljs-keyword">for</span> (Dish d : dishList) &#123;<br>           <span class="hljs-type">DishVO</span> <span class="hljs-variable">dishVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DishVO</span>();<br>           BeanUtils.copyProperties(d,dishVO);<br><br>           <span class="hljs-comment">//Ê†πÊçÆËèúÂìÅidÊü•ËØ¢ÂØπÂ∫îÁöÑÂè£Âë≥</span><br>           List&lt;DishFlavor&gt; flavors = dishFlavorMapper.getByDishId(d.getId());<br><br>           dishVO.setFlavors(flavors);<br>           dishVOList.add(dishVO);<br>       &#125;<br><br>       <span class="hljs-keyword">return</span> dishVOList;<br>   &#125;<br></code></pre></td></tr></table></figure>



<h2 id="3-ControllerÂ±Ç"><a href="#3-ControllerÂ±Ç" class="headerlink" title="3. ControllerÂ±Ç"></a>3. ControllerÂ±Ç</h2><p><strong>ÂàõÂª∫DishController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.constant.StatusConstant;<br><span class="hljs-keyword">import</span> com.sky.entity.Dish;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.DishService;<br><span class="hljs-keyword">import</span> com.sky.vo.DishVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController(&quot;userDishController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/dish&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;CÁ´Ø-ËèúÂìÅÊµèËßàÊé•Âè£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishService dishService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢ËèúÂìÅ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢ËèúÂìÅ&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br>        <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>        dish.setCategoryId(categoryId);<br>        dish.setStatus(StatusConstant.ENABLE);<span class="hljs-comment">//Êü•ËØ¢Ëµ∑ÂîÆ‰∏≠ÁöÑËèúÂìÅ</span><br><br>        List&lt;DishVO&gt; list = dishService.listWithFlavor(dish);<br><br>        <span class="hljs-keyword">return</span> Result.success(list);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ÂàõÂª∫CategoryController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.entity.Category;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.CategoryService;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController(&quot;userCategoryController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/category&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;CÁ´Ø-ÂàÜÁ±ªÊé•Âè£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CategoryController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CategoryService categoryService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êü•ËØ¢ÂàÜÁ±ª</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> type</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Êü•ËØ¢ÂàÜÁ±ª&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;Category&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Integer type)</span> &#123;<br>        List&lt;Category&gt; list = categoryService.list(type);<br>        <span class="hljs-keyword">return</span> Result.success(list);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ÂàõÂª∫SetmealController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.constant.StatusConstant;<br><span class="hljs-keyword">import</span> com.sky.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.SetmealService;<br><span class="hljs-keyword">import</span> com.sky.vo.DishItemVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController(&quot;userSetmealController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/setmeal&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;CÁ´Ø-Â•óÈ§êÊµèËßàÊé•Âè£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealService setmealService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êù°‰ª∂Êü•ËØ¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢Â•óÈ§ê&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;Setmeal&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br>        <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Setmeal</span>();<br>        setmeal.setCategoryId(categoryId);<br>        setmeal.setStatus(StatusConstant.ENABLE);<br><br>        List&lt;Setmeal&gt; list = setmealService.list(setmeal);<br>        <span class="hljs-keyword">return</span> Result.success(list);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÂ•óÈ§êidÊü•ËØ¢ÂåÖÂê´ÁöÑËèúÂìÅÂàóË°®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/dish/&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Ê†πÊçÆÂ•óÈ§êidÊü•ËØ¢ÂåÖÂê´ÁöÑËèúÂìÅÂàóË°®&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;DishItemVO&gt;&gt; <span class="hljs-title function_">dishList</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>        List&lt;DishItemVO&gt; list = setmealService.getDishItemById(id);<br>        <span class="hljs-keyword">return</span> Result.success(list);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="ÂçÅ-ÁºìÂ≠òËèúÂìÅÂíåÂ•óÈ§ê"><a href="#ÂçÅ-ÁºìÂ≠òËèúÂìÅÂíåÂ•óÈ§ê" class="headerlink" title="ÂçÅ. ÁºìÂ≠òËèúÂìÅÂíåÂ•óÈ§ê"></a>ÂçÅ. ÁºìÂ≠òËèúÂìÅÂíåÂ•óÈ§ê</h1><h2 id="1-ÁºìÂ≠òËèúÂìÅ"><a href="#1-ÁºìÂ≠òËèúÂìÅ" class="headerlink" title="1. ÁºìÂ≠òËèúÂìÅ"></a>1. ÁºìÂ≠òËèúÂìÅ</h2><h3 id="1-1-ÈóÆÈ¢òÂàÜÊûê"><a href="#1-1-ÈóÆÈ¢òÂàÜÊûê" class="headerlink" title="1.1 ÈóÆÈ¢òÂàÜÊûê"></a>1.1 ÈóÆÈ¢òÂàÜÊûê</h3><p>Áî®Êà∑Á´ØÂ∞èÁ®ãÂ∫èÂ±ïÁ§∫ÁöÑËèúÂìÅÊï∞ÊçÆÈÉΩÊòØÈÄöËøáÊü•ËØ¢Êï∞ÊçÆÂ∫ìËé∑ÂæóÔºåÂ¶ÇÊûúÁî®Êà∑Á´ØËÆøÈóÆÈáèÊØîËæÉÂ§ßÔºåÊï∞ÊçÆÂ∫ìËÆøÈóÆÂéãÂäõÈöè‰πãÂ¢ûÂ§ß„ÄÇÈÄöËøá<strong>RedisÊù•ÁºìÂ≠òËèúÂìÅÊï∞ÊçÆÔºåÂáèÂ∞ëÊï∞ÊçÆÂ∫ìÊü•ËØ¢Êìç‰Ωú</strong>„ÄÇ</p>
<ul>
<li>ÊØè‰∏™ÂàÜÁ±ª‰∏ãÁöÑËèúÂìÅ‰øùÂ≠ò‰∏Ä‰ªΩÁºìÂ≠òÊï∞ÊçÆ</li>
<li>Êï∞ÊçÆÂ∫ì‰∏≠ËèúÂìÅÊï∞ÊçÆÊúâÂèòÊõ¥Êó∂Ê∏ÖÁêÜÁºìÂ≠òÊï∞ÊçÆ</li>
</ul>
<p>‰∏∫‰∫Ü‰øùËØÅÊï∞ÊçÆÂ∫ìÂíåRedis‰∏≠ÁöÑ<strong>Êï∞ÊçÆ‰øùÊåÅ‰∏ÄËá¥</strong>Ôºå‰øÆÊîπ<strong>ÁÆ°ÁêÜÁ´ØÊé•Âè£ DishController</strong> ÁöÑÁõ∏ÂÖ≥ÊñπÊ≥ïÔºåÂä†ÂÖ•Ê∏ÖÁêÜÁºìÂ≠òÈÄªËæë„ÄÇ</p>
<p>ÈúÄË¶ÅÊîπÈÄ†ÁöÑÊñπÊ≥ïÔºö</p>
<ul>
<li>Êñ∞Â¢ûËèúÂìÅ</li>
<li>‰øÆÊîπËèúÂìÅ</li>
<li>ÊâπÈáèÂà†Èô§ËèúÂìÅ</li>
<li>Ëµ∑ÂîÆ„ÄÅÂÅúÂîÆËèúÂìÅ</li>
</ul>
<h3 id="1-2-Áî®Êà∑Á´ØÊé•Âè£DishController"><a href="#1-2-Áî®Êà∑Á´ØÊé•Âè£DishController" class="headerlink" title="1.2 Áî®Êà∑Á´ØÊé•Âè£DishController"></a>1.2 Áî®Êà∑Á´ØÊé•Âè£DishController</h3><p><strong>‰øÆÊîπÁî®Êà∑Á´ØÊé•Âè£ DishController ÁöÑ list ÊñπÊ≥ïÔºåÂä†ÂÖ•ÁºìÂ≠òÂ§ÑÁêÜÈÄªËæëÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢ËèúÂìÅ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢ËèúÂìÅ&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br><br>       <span class="hljs-comment">//ÊûÑÈÄ†redis‰∏≠ÁöÑkeyÔºåËßÑÂàôÔºödish_ÂàÜÁ±ªid</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dish_&quot;</span> + categoryId;<br><br>       <span class="hljs-comment">//Êü•ËØ¢redis‰∏≠ÊòØÂê¶Â≠òÂú®ËèúÂìÅÊï∞ÊçÆ</span><br>       List&lt;DishVO&gt; list = (List&lt;DishVO&gt;) redisTemplate.opsForValue().get(key);<br>       <span class="hljs-keyword">if</span>(list != <span class="hljs-literal">null</span> &amp;&amp; list.size() &gt; <span class="hljs-number">0</span>)&#123;<br>           <span class="hljs-comment">//Â¶ÇÊûúÂ≠òÂú®ÔºåÁõ¥Êé•ËøîÂõûÔºåÊó†È°ªÊü•ËØ¢Êï∞ÊçÆÂ∫ì</span><br>           <span class="hljs-keyword">return</span> Result.success(list);<br>       &#125;<br>	<span class="hljs-comment">////////////////////////////////////////////////////////</span><br>       <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>       dish.setCategoryId(categoryId);<br>       dish.setStatus(StatusConstant.ENABLE);<span class="hljs-comment">//Êü•ËØ¢Ëµ∑ÂîÆ‰∏≠ÁöÑËèúÂìÅ</span><br><br>       <span class="hljs-comment">//Â¶ÇÊûú‰∏çÂ≠òÂú®ÔºåÊü•ËØ¢Êï∞ÊçÆÂ∫ìÔºåÂ∞ÜÊü•ËØ¢Âà∞ÁöÑÊï∞ÊçÆÊîæÂÖ•redis‰∏≠</span><br>       list = dishService.listWithFlavor(dish);<br>       <span class="hljs-comment">////////////////////////////////////////////////////////</span><br>       redisTemplate.opsForValue().set(key, list);<br><br>       <span class="hljs-keyword">return</span> Result.success(list);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-ÁÆ°ÁêÜÁ´ØÊé•Âè£DishController"><a href="#1-3-ÁÆ°ÁêÜÁ´ØÊé•Âè£DishController" class="headerlink" title="1.3 ÁÆ°ÁêÜÁ´ØÊé•Âè£DishController"></a>1.3 ÁÆ°ÁêÜÁ´ØÊé•Âè£DishController</h3><h4 id="1-3-1-ÊäΩÂèñÊ∏ÖÁêÜÁºìÂ≠òÁöÑÊñπÊ≥ï"><a href="#1-3-1-ÊäΩÂèñÊ∏ÖÁêÜÁºìÂ≠òÁöÑÊñπÊ≥ï" class="headerlink" title="1.3.1 ÊäΩÂèñÊ∏ÖÁêÜÁºìÂ≠òÁöÑÊñπÊ≥ï"></a>1.3.1 ÊäΩÂèñÊ∏ÖÁêÜÁºìÂ≠òÁöÑÊñπÊ≥ï</h4><p>Âú®ÁÆ°ÁêÜÁ´ØDishController‰∏≠Ê∑ªÂä†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê∏ÖÁêÜÁºìÂ≠òÊï∞ÊçÆ</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> pattern</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanCache</span><span class="hljs-params">(String pattern)</span>&#123;<br>       <span class="hljs-type">Set</span> <span class="hljs-variable">keys</span> <span class="hljs-operator">=</span> redisTemplate.keys(pattern);<br>       redisTemplate.delete(keys);<br>   &#125;<br></code></pre></td></tr></table></figure>


<h4 id="1-3-2-Êñ∞Â¢ûËèúÂìÅ‰ºòÂåñ"><a href="#1-3-2-Êñ∞Â¢ûËèúÂìÅ‰ºòÂåñ" class="headerlink" title="1.3.2 Êñ∞Â¢ûËèúÂìÅ‰ºòÂåñ"></a>1.3.2 Êñ∞Â¢ûËèúÂìÅ‰ºòÂåñ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Êñ∞Â¢ûËèúÂìÅ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PostMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Êñ∞Â¢ûËèúÂìÅ&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;Êñ∞Â¢ûËèúÂìÅÔºö&#123;&#125;&quot;</span>, dishDTO);<br>       dishService.saveWithFlavor(dishDTO);<br><br>       <span class="hljs-comment">//Ê∏ÖÁêÜÁºìÂ≠òÊï∞ÊçÆ</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dish_&quot;</span> + dishDTO.getCategoryId();<br>       cleanCache(key);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-3-ËèúÂìÅÊâπÈáèÂà†Èô§‰ºòÂåñ"><a href="#1-3-3-ËèúÂìÅÊâπÈáèÂà†Èô§‰ºòÂåñ" class="headerlink" title="1.3.3 ËèúÂìÅÊâπÈáèÂà†Èô§‰ºòÂåñ"></a>1.3.3 ËèúÂìÅÊâπÈáèÂà†Èô§‰ºòÂåñ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËèúÂìÅÊâπÈáèÂà†Èô§</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@DeleteMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;ËèúÂìÅÊâπÈáèÂà†Èô§&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;ËèúÂìÅÊâπÈáèÂà†Èô§Ôºö&#123;&#125;&quot;</span>, ids);<br>       dishService.deleteBatch(ids);<br><br>       <span class="hljs-comment">//Â∞ÜÊâÄÊúâÁöÑËèúÂìÅÁºìÂ≠òÊï∞ÊçÆÊ∏ÖÁêÜÊéâÔºåÊâÄÊúâ‰ª•dish_ÂºÄÂ§¥ÁöÑkey</span><br>       cleanCache(<span class="hljs-string">&quot;dish_*&quot;</span>);<br><br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-4-‰øÆÊîπËèúÂìÅ‰ºòÂåñ"><a href="#1-3-4-‰øÆÊîπËèúÂìÅ‰ºòÂåñ" class="headerlink" title="1.3.4 ‰øÆÊîπËèúÂìÅ‰ºòÂåñ"></a>1.3.4 ‰øÆÊîπËèúÂìÅ‰ºòÂåñ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ‰øÆÊîπËèúÂìÅ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PutMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;‰øÆÊîπËèúÂìÅ&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;‰øÆÊîπËèúÂìÅÔºö&#123;&#125;&quot;</span>, dishDTO);<br>       dishService.updateWithFlavor(dishDTO);<br><br>       <span class="hljs-comment">//Â∞ÜÊâÄÊúâÁöÑËèúÂìÅÁºìÂ≠òÊï∞ÊçÆÊ∏ÖÁêÜÊéâÔºåÊâÄÊúâ‰ª•dish_ÂºÄÂ§¥ÁöÑkey</span><br>       cleanCache(<span class="hljs-string">&quot;dish_*&quot;</span>);<br><br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-5-ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ‰ºòÂåñ"><a href="#1-3-5-ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ‰ºòÂåñ" class="headerlink" title="1.3.5 ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ‰ºòÂåñ"></a>1.3.5 ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ‰ºòÂåñ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;ËèúÂìÅËµ∑ÂîÆÂÅúÂîÆ&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status, Long id)</span> &#123;<br>       dishService.startOrStop(status, id);<br><br>       <span class="hljs-comment">//Â∞ÜÊâÄÊúâÁöÑËèúÂìÅÁºìÂ≠òÊï∞ÊçÆÊ∏ÖÁêÜÊéâÔºåÊâÄÊúâ‰ª•dish_ÂºÄÂ§¥ÁöÑkey</span><br>       cleanCache(<span class="hljs-string">&quot;dish_*&quot;</span>);<br><br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-ÁºìÂ≠òÂ•óÈ§ê"><a href="#2-ÁºìÂ≠òÂ•óÈ§ê" class="headerlink" title="2. ÁºìÂ≠òÂ•óÈ§ê"></a>2. ÁºìÂ≠òÂ•óÈ§ê</h2><h3 id="2-1-Spring-Cache"><a href="#2-1-Spring-Cache" class="headerlink" title="2.1 Spring Cache"></a>2.1 Spring Cache</h3><p>Spring Cache ÊòØ‰∏Ä‰∏™Ê°ÜÊû∂ÔºåÂÆûÁé∞‰∫ÜÂü∫‰∫éÊ≥®Ëß£ÁöÑÁºìÂ≠òÂäüËÉΩÔºåÂè™ÈúÄË¶ÅÁÆÄÂçïÂú∞Âä†‰∏Ä‰∏™Ê≥®Ëß£ÔºåÂ∞±ËÉΩÂÆûÁé∞ÁºìÂ≠òÂäüËÉΩ„ÄÇ</p>
<h4 id="2-1-1-Â∏∏Áî®Ê≥®Ëß£"><a href="#2-1-1-Â∏∏Áî®Ê≥®Ëß£" class="headerlink" title="2.1.1 Â∏∏Áî®Ê≥®Ëß£"></a>2.1.1 Â∏∏Áî®Ê≥®Ëß£</h4><p>Âú®SpringCache‰∏≠Êèê‰æõ‰∫ÜÂæàÂ§öÁºìÂ≠òÊìç‰ΩúÁöÑÊ≥®Ëß£ÔºåÂ∏∏ËßÅÁöÑÊòØ‰ª•‰∏ãÁöÑÂá†‰∏™Ôºö</p>
<table>
<thead>
<tr>
<th><strong>Ê≥®Ëß£</strong></th>
<th><strong>ËØ¥Êòé</strong></th>
</tr>
</thead>
<tbody><tr>
<td>@EnableCaching</td>
<td>ÂºÄÂêØÁºìÂ≠òÊ≥®Ëß£ÂäüËÉΩÔºåÈÄöÂ∏∏Âä†Âú®ÂêØÂä®Á±ª‰∏ä</td>
</tr>
<tr>
<td>@Cacheable</td>
<td>Âú®ÊñπÊ≥ïÊâßË°åÂâçÂÖàÊü•ËØ¢ÁºìÂ≠ò‰∏≠ÊòØÂê¶ÊúâÊï∞ÊçÆÔºåÂ¶ÇÊûúÊúâÊï∞ÊçÆÔºåÂàôÁõ¥Êé•ËøîÂõûÁºìÂ≠òÊï∞ÊçÆÔºõÂ¶ÇÊûúÊ≤°ÊúâÁºìÂ≠òÊï∞ÊçÆÔºåË∞ÉÁî®ÊñπÊ≥ïÂπ∂Â∞ÜÊñπÊ≥ïËøîÂõûÂÄºÊîæÂà∞ÁºìÂ≠ò‰∏≠</td>
</tr>
<tr>
<td>@CachePut</td>
<td>Â∞ÜÊñπÊ≥ïÁöÑËøîÂõûÂÄºÊîæÂà∞ÁºìÂ≠ò‰∏≠</td>
</tr>
<tr>
<td>@CacheEvict</td>
<td>Â∞Ü‰∏ÄÊù°ÊàñÂ§öÊù°Êï∞ÊçÆ‰ªéÁºìÂ≠ò‰∏≠Âà†Èô§</td>
</tr>
</tbody></table>
<h4 id="2-1-2-EnableCaching"><a href="#2-1-2-EnableCaching" class="headerlink" title="2.1.2 @EnableCaching"></a>2.1.2 @EnableCaching</h4><p><strong>ÂêØÂä®Á±ª‰∏äÂä†@EnableCaching:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cache.annotation.EnableCaching;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableCaching</span><span class="hljs-comment">//ÂºÄÂêØÁºìÂ≠òÊ≥®Ëß£ÂäüËÉΩ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheDemoApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(CacheDemoApplication.class,args);<br>        log.info(<span class="hljs-string">&quot;È°πÁõÆÂêØÂä®ÊàêÂäü...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-1-3-CachePutÊ≥®Ëß£"><a href="#2-1-3-CachePutÊ≥®Ëß£" class="headerlink" title="2.1.3 @CachePutÊ≥®Ëß£"></a>2.1.3 @CachePutÊ≥®Ëß£</h4><p><strong>@CachePut ËØ¥ÊòéÔºö</strong> </p>
<ul>
<li>‚Äã‰ΩúÁî®: Â∞ÜÊñπÊ≥ïËøîÂõûÂÄºÔºåÊîæÂÖ•ÁºìÂ≠ò</li>
<li>‚Äãvalue: ÁºìÂ≠òÁöÑÂêçÁß∞, ÊØè‰∏™ÁºìÂ≠òÂêçÁß∞‰∏ãÈù¢ÂèØ‰ª•ÊúâÂæàÂ§ökey</li>
<li>‚Äãkey: ÁºìÂ≠òÁöÑkey  ‚Äî‚Äî‚Äî-&gt; ÊîØÊåÅSpringÁöÑË°®ËææÂºèËØ≠Ë®ÄSPELËØ≠Ê≥ï</li>
</ul>
<p><strong>Âú®saveÊñπÊ≥ï‰∏äÂä†Ê≥®Ëß£@CachePut</strong></p>
<p>ÂΩìÂâçUserControllerÁöÑsaveÊñπÊ≥ïÊòØÁî®Êù•‰øùÂ≠òÁî®Êà∑‰ø°ÊÅØÁöÑÔºåÊàë‰ª¨Â∏åÊúõÂú®ËØ•Áî®Êà∑‰ø°ÊÅØ‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÁöÑÂêåÊó∂Ôºå‰πüÂæÄÁºìÂ≠ò‰∏≠ÁºìÂ≠ò‰∏Ä‰ªΩÊï∞ÊçÆÔºåÊàë‰ª¨ÂèØ‰ª•Âú®saveÊñπÊ≥ï‰∏äÂä†‰∏äÊ≥®Ëß£ @CachePutÔºåÁî®Ê≥ïÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* CachePutÔºöÂ∞ÜÊñπÊ≥ïËøîÂõûÂÄºÊîæÂÖ•ÁºìÂ≠ò</span><br><span class="hljs-comment">* valueÔºöÁºìÂ≠òÁöÑÂêçÁß∞ÔºåÊØè‰∏™ÁºìÂ≠òÂêçÁß∞‰∏ãÈù¢ÂèØ‰ª•ÊúâÂ§ö‰∏™key</span><br><span class="hljs-comment">* keyÔºöÁºìÂ≠òÁöÑkey</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-meta">@CachePut(value = &quot;userCache&quot;, key = &quot;#user.id&quot;)</span><span class="hljs-comment">//keyÁöÑÁîüÊàêÔºöuserCache::1</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span>&#123;<br>    userMapper.insert(user);<br>    <span class="hljs-keyword">return</span> user;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>**ËØ¥ÊòéÔºö**keyÁöÑÂÜôÊ≥ïÂ¶Ç‰∏ã</p>
<p>#user.id : #userÊåáÁöÑÊòØÊñπÊ≥ïÂΩ¢ÂèÇÁöÑÂêçÁß∞, idÊåáÁöÑÊòØuserÁöÑidÂ±ûÊÄß , ‰πüÂ∞±ÊòØ‰ΩøÁî®userÁöÑidÂ±ûÊÄß‰Ωú‰∏∫key ;</p>
<h4 id="2-1-4-CacheableÊ≥®Ëß£"><a href="#2-1-4-CacheableÊ≥®Ëß£" class="headerlink" title="2.1.4 @CacheableÊ≥®Ëß£"></a>2.1.4 @CacheableÊ≥®Ëß£</h4><p><strong>@Cacheable ËØ¥Êòé:</strong></p>
<ul>
<li>‚Äã‰ΩúÁî®: Âú®ÊñπÊ≥ïÊâßË°åÂâçÔºåspringÂÖàÊü•ÁúãÁºìÂ≠ò‰∏≠ÊòØÂê¶ÊúâÊï∞ÊçÆÔºåÂ¶ÇÊûúÊúâÊï∞ÊçÆÔºåÂàôÁõ¥Êé•ËøîÂõûÁºìÂ≠òÊï∞ÊçÆÔºõËã•Ê≤°ÊúâÊï∞ÊçÆÔºåË∞ÉÁî®ÊñπÊ≥ïÂπ∂Â∞ÜÊñπÊ≥ïËøîÂõûÂÄºÊîæÂà∞ÁºìÂ≠ò‰∏≠</li>
<li>‚Äãvalue: ÁºìÂ≠òÁöÑÂêçÁß∞ÔºåÊØè‰∏™ÁºìÂ≠òÂêçÁß∞‰∏ãÈù¢ÂèØ‰ª•ÊúâÂ§ö‰∏™key</li>
<li>‚Äãkey: ÁºìÂ≠òÁöÑkey  ‚Äî‚Äî‚Äî-&gt; ÊîØÊåÅSpringÁöÑË°®ËææÂºèËØ≠Ë®ÄSPELËØ≠Ê≥ï</li>
</ul>
<p> <strong>Âú®getById‰∏äÂä†Ê≥®Ëß£@Cacheable</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* CacheableÔºöÂú®ÊñπÊ≥ïÊâßË°åÂâçspringÂÖàÊü•ÁúãÁºìÂ≠ò‰∏≠ÊòØÂê¶ÊúâÊï∞ÊçÆÔºåÂ¶ÇÊûúÊúâÊï∞ÊçÆÔºåÂàôÁõ¥Êé•ËøîÂõûÁºìÂ≠òÊï∞ÊçÆÔºõËã•Ê≤°ÊúâÊï∞ÊçÆÔºå	  *Ë∞ÉÁî®ÊñπÊ≥ïÂπ∂Â∞ÜÊñπÊ≥ïËøîÂõûÂÄºÊîæÂà∞ÁºìÂ≠ò‰∏≠</span><br><span class="hljs-comment">* valueÔºöÁºìÂ≠òÁöÑÂêçÁß∞ÔºåÊØè‰∏™ÁºìÂ≠òÂêçÁß∞‰∏ãÈù¢ÂèØ‰ª•ÊúâÂ§ö‰∏™key</span><br><span class="hljs-comment">* keyÔºöÁºìÂ≠òÁöÑkey</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping</span><br><span class="hljs-meta">@Cacheable(cacheNames = &quot;userCache&quot;,key=&quot;#id&quot;)</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>&#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.getById(id);<br>    <span class="hljs-keyword">return</span> user;<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="2-1-5-CacheEvictÊ≥®Ëß£"><a href="#2-1-5-CacheEvictÊ≥®Ëß£" class="headerlink" title="2.1.5 @CacheEvictÊ≥®Ëß£"></a>2.1.5 @CacheEvictÊ≥®Ëß£</h4><p><strong>@CacheEvict ËØ¥ÊòéÔºö</strong> </p>
<ul>
<li>‰ΩúÁî®: Ê∏ÖÁêÜÊåáÂÆöÁºìÂ≠ò</li>
<li>value: ÁºìÂ≠òÁöÑÂêçÁß∞ÔºåÊØè‰∏™ÁºìÂ≠òÂêçÁß∞‰∏ãÈù¢ÂèØ‰ª•ÊúâÂ§ö‰∏™key</li>
<li>key: ÁºìÂ≠òÁöÑkey  ‚Äî‚Äî‚Äî-&gt; ÊîØÊåÅSpringÁöÑË°®ËææÂºèËØ≠Ë®ÄSPELËØ≠Ê≥ï</li>
</ul>
<p><strong>Âú® delete ÊñπÊ≥ï‰∏äÂä†Ê≥®Ëß£@CacheEvict</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-meta">@CacheEvict(cacheNames = &quot;userCache&quot;,key = &quot;#id&quot;)</span><span class="hljs-comment">//Âà†Èô§Êüê‰∏™keyÂØπÂ∫îÁöÑÁºìÂ≠òÊï∞ÊçÆ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Long id)</span>&#123;<br>    userMapper.deleteById(id);<br>&#125;<br><br><span class="hljs-meta">@DeleteMapping(&quot;/delAll&quot;)</span><br><span class="hljs-meta">@CacheEvict(cacheNames = &quot;userCache&quot;,allEntries = true)</span><span class="hljs-comment">//Âà†Èô§userCache‰∏ãÊâÄÊúâÁöÑÁºìÂ≠òÊï∞ÊçÆ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteAll</span><span class="hljs-params">()</span>&#123;<br>    userMapper.deleteAll();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-ÂÆûÁé∞ÊÄùË∑Ø"><a href="#2-2-ÂÆûÁé∞ÊÄùË∑Ø" class="headerlink" title="2.2 ÂÆûÁé∞ÊÄùË∑Ø"></a>2.2 ÂÆûÁé∞ÊÄùË∑Ø</h3><p><strong>ÂÆûÁé∞Ê≠•È™§Ôºö</strong></p>
<p>1). ÂØºÂÖ•Spring CacheÂíåRedisÁõ∏ÂÖ≥mavenÂùêÊ†á</p>
<p>2). Âú®ÂêØÂä®Á±ª‰∏äÂä†ÂÖ•@EnableCachingÊ≥®Ëß£ÔºåÂºÄÂêØÁºìÂ≠òÊ≥®Ëß£ÂäüËÉΩ</p>
<p>3). Âú®Áî®Êà∑Á´ØÊé•Âè£SetmealControllerÁöÑ list ÊñπÊ≥ï‰∏äÂä†ÂÖ•@CacheableÊ≥®Ëß£</p>
<p>4). Âú®ÁÆ°ÁêÜÁ´ØÊé•Âè£SetmealControllerÁöÑ save„ÄÅdelete„ÄÅupdate„ÄÅstartOrStopÁ≠âÊñπÊ≥ï‰∏äÂä†ÂÖ•CacheEvictÊ≥®Ëß£</p>
<h3 id="2-3-‰ª£Á†ÅÂºÄÂèë"><a href="#2-3-‰ª£Á†ÅÂºÄÂèë" class="headerlink" title="2.3 ‰ª£Á†ÅÂºÄÂèë"></a>2.3 ‰ª£Á†ÅÂºÄÂèë</h3><h4 id="2-3-1-EnableCaching"><a href="#2-3-1-EnableCaching" class="headerlink" title="2.3.1 @EnableCaching"></a>2.3.1 @EnableCaching</h4><p><strong>Âú®ÂêØÂä®Á±ª‰∏äÂä†ÂÖ•@EnableCachingÊ≥®Ëß£ÔºåÂºÄÂêØÁºìÂ≠òÊ≥®Ëß£ÂäüËÉΩ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cache.annotation.EnableCaching;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableTransactionManagement</span> <span class="hljs-comment">//ÂºÄÂêØÊ≥®Ëß£ÊñπÂºèÁöÑ‰∫ãÂä°ÁÆ°ÁêÜ</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SkyApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(SkyApplication.class, args);<br>        log.info(<span class="hljs-string">&quot;server started&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="2-3-2-Áî®Êà∑Á´ØÊé•Âè£"><a href="#2-3-2-Áî®Êà∑Á´ØÊé•Âè£" class="headerlink" title="2.3.2 Áî®Êà∑Á´ØÊé•Âè£"></a>2.3.2 Áî®Êà∑Á´ØÊé•Âè£</h4><p><strong>Âú®Áî®Êà∑Á´ØÊé•Âè£SetmealControllerÁöÑ list ÊñπÊ≥ï‰∏äÂä†ÂÖ•@CacheableÊ≥®Ëß£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Êù°‰ª∂Êü•ËØ¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Ê†πÊçÆÂàÜÁ±ªidÊü•ËØ¢Â•óÈ§ê&quot;)</span><br>   <span class="hljs-meta">@Cacheable(cacheNames = &quot;setmealCache&quot;,key = &quot;#categoryId&quot;)</span> <span class="hljs-comment">//key: setmealCache::100</span><br>   <span class="hljs-keyword">public</span> Result&lt;List&lt;Setmeal&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br>       <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Setmeal</span>();<br>       setmeal.setCategoryId(categoryId);<br>       setmeal.setStatus(StatusConstant.ENABLE);<br><br>       List&lt;Setmeal&gt; list = setmealService.list(setmeal);<br>       <span class="hljs-keyword">return</span> Result.success(list);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-3-3-ÁÆ°ÁêÜÁ´ØÊé•Âè£"><a href="#2-3-3-ÁÆ°ÁêÜÁ´ØÊé•Âè£" class="headerlink" title="2.3.3 ÁÆ°ÁêÜÁ´ØÊé•Âè£"></a>2.3.3 ÁÆ°ÁêÜÁ´ØÊé•Âè£</h4><p><strong>Âú®ÁÆ°ÁêÜÁ´ØÊé•Âè£SetmealControllerÁöÑ save„ÄÅdelete„ÄÅupdate„ÄÅstartOrStopÁ≠âÊñπÊ≥ï‰∏äÂä†ÂÖ•CacheEvictÊ≥®Ëß£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Êñ∞Â¢ûÂ•óÈ§ê</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PostMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Êñ∞Â¢ûÂ•óÈ§ê&quot;)</span><br>   <span class="hljs-meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,key = &quot;#setmealDTO.categoryId&quot;)</span><span class="hljs-comment">//key: setmealCache::100</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;<br>       setmealService.saveWithDish(setmealDTO);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ÊâπÈáèÂà†Èô§Â•óÈ§ê</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@DeleteMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;ÊâπÈáèÂà†Èô§Â•óÈ§ê&quot;)</span><br>   <span class="hljs-meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;<br>       setmealService.deleteBatch(ids);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ‰øÆÊîπÂ•óÈ§ê</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PutMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;‰øÆÊîπÂ•óÈ§ê&quot;)</span><br>   <span class="hljs-meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;<br>       setmealService.update(setmealDTO);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Â•óÈ§êËµ∑ÂîÆÂÅúÂîÆ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Â•óÈ§êËµ∑ÂîÆÂÅúÂîÆ&quot;)</span><br>   <span class="hljs-meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status, Long id)</span> &#123;<br>       setmealService.startOrStop(status, id);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h1 id="ÂçÅ‰∏Ä-Ë¥≠Áâ©ËΩ¶ÁÆ°ÁêÜ"><a href="#ÂçÅ‰∏Ä-Ë¥≠Áâ©ËΩ¶ÁÆ°ÁêÜ" class="headerlink" title="ÂçÅ‰∏Ä. Ë¥≠Áâ©ËΩ¶ÁÆ°ÁêÜ"></a>ÂçÅ‰∏Ä. Ë¥≠Áâ©ËΩ¶ÁÆ°ÁêÜ</h1><h2 id="1-Ê∑ªÂä†Ë¥≠Áâ©ËΩ¶"><a href="#1-Ê∑ªÂä†Ë¥≠Áâ©ËΩ¶" class="headerlink" title="1. Ê∑ªÂä†Ë¥≠Áâ©ËΩ¶"></a>1. Ê∑ªÂä†Ë¥≠Áâ©ËΩ¶</h2><h3 id="1-1-ControllerÂ±Ç-1"><a href="#1-1-ControllerÂ±Ç-1" class="headerlink" title="1.1 ControllerÂ±Ç"></a>1.1 ControllerÂ±Ç</h3><p><strong>Ê†πÊçÆÊ∑ªÂä†Ë¥≠Áâ©ËΩ¶Êé•Âè£ÂàõÂª∫ShoppingCartControllerÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><br><span class="hljs-keyword">import</span> com.sky.dto.ShoppingCartDTO;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ë¥≠Áâ©ËΩ¶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/shoppingCart&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;CÁ´Ø-Ë¥≠Áâ©ËΩ¶Êé•Âè£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShoppingCartController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ShoppingCartService shoppingCartService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê∑ªÂä†Ë¥≠Áâ©ËΩ¶</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Ê∑ªÂä†Ë¥≠Áâ©ËΩ¶&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;Ê∑ªÂä†Ë¥≠Áâ©ËΩ¶Ôºö&#123;&#125;&quot;</span>, shoppingCartDTO);<br>        shoppingCartService.addShoppingCart(shoppingCartDTO);<span class="hljs-comment">//ÂêéÁª™Ê≠•È™§ÂÆûÁé∞</span><br>        <span class="hljs-keyword">return</span> Result.success();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-2-ServiceÂ±Ç-1"><a href="#1-2-ServiceÂ±Ç-1" class="headerlink" title="1.2 ServiceÂ±Ç"></a>1.2 ServiceÂ±Ç</h3><h4 id="1-2-1-ServiceÂ±ÇÊé•Âè£-1"><a href="#1-2-1-ServiceÂ±ÇÊé•Âè£-1" class="headerlink" title="1.2.1 ServiceÂ±ÇÊé•Âè£"></a>1.2.1 ServiceÂ±ÇÊé•Âè£</h4><p><strong>ÂàõÂª∫ShoppingCartServiceÊé•Âè£Ôºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.ShoppingCartDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.ShoppingCart;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShoppingCartService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê∑ªÂä†Ë¥≠Áâ©ËΩ¶</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addShoppingCart</span><span class="hljs-params">(ShoppingCartDTO shoppingCartDTO)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="1-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª-1"><a href="#1-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª-1" class="headerlink" title="1.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>1.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><p><strong>ÂàõÂª∫ShoppingCartServiceImplÂÆûÁé∞Á±ªÔºåÂπ∂ÂÆûÁé∞addÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><br><span class="hljs-keyword">import</span> com.sky.context.BaseContext;<br><span class="hljs-keyword">import</span> com.sky.dto.ShoppingCartDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.Dish;<br><span class="hljs-keyword">import</span> com.sky.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.sky.entity.ShoppingCart;<br><span class="hljs-keyword">import</span> com.sky.mapper.DishMapper;<br><span class="hljs-keyword">import</span> com.sky.mapper.SetmealMapper;<br><span class="hljs-keyword">import</span> com.sky.service.ShoppingCartService;<br><span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShoppingCartServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ShoppingCartService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ShoppingCartMapper shoppingCartMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishMapper dishMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealMapper setmealMapper;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê∑ªÂä†Ë¥≠Áâ©ËΩ¶</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addShoppingCart</span><span class="hljs-params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;<br>        <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">shoppingCart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCart</span>();<br>        BeanUtils.copyProperties(shoppingCartDTO, shoppingCart);<br>        <span class="hljs-comment">//Âè™ËÉΩÊü•ËØ¢Ëá™Â∑±ÁöÑË¥≠Áâ©ËΩ¶Êï∞ÊçÆ</span><br>        shoppingCart.setUserId(BaseContext.getCurrentId());<br><br>        <span class="hljs-comment">//Âà§Êñ≠ÂΩìÂâçÂïÜÂìÅÊòØÂê¶Âú®Ë¥≠Áâ©ËΩ¶‰∏≠</span><br>        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.list(shoppingCart);<br><br>        <span class="hljs-keyword">if</span> (shoppingCartList != <span class="hljs-literal">null</span> &amp;&amp; shoppingCartList.size() == <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-comment">//Â¶ÇÊûúÂ∑≤ÁªèÂ≠òÂú®ÔºåÂ∞±Êõ¥Êñ∞Êï∞ÈáèÔºåÊï∞ÈáèÂä†1</span><br>            shoppingCart = shoppingCartList.get(<span class="hljs-number">0</span>);<br>            shoppingCart.setNumber(shoppingCart.getNumber() + <span class="hljs-number">1</span>);<br>            shoppingCartMapper.updateNumberById(shoppingCart);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//Â¶ÇÊûú‰∏çÂ≠òÂú®ÔºåÊèíÂÖ•Êï∞ÊçÆÔºåÊï∞ÈáèÂ∞±ÊòØ1</span><br><br>            <span class="hljs-comment">//Âà§Êñ≠ÂΩìÂâçÊ∑ªÂä†Âà∞Ë¥≠Áâ©ËΩ¶ÁöÑÊòØËèúÂìÅËøòÊòØÂ•óÈ§ê</span><br>            <span class="hljs-type">Long</span> <span class="hljs-variable">dishId</span> <span class="hljs-operator">=</span> shoppingCartDTO.getDishId();<br>            <span class="hljs-keyword">if</span> (dishId != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">//Ê∑ªÂä†Âà∞Ë¥≠Áâ©ËΩ¶ÁöÑÊòØËèúÂìÅ</span><br>                <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> dishMapper.getById(dishId);<br>                shoppingCart.setName(dish.getName());<br>                shoppingCart.setImage(dish.getImage());<br>                shoppingCart.setAmount(dish.getPrice());<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">//Ê∑ªÂä†Âà∞Ë¥≠Áâ©ËΩ¶ÁöÑÊòØÂ•óÈ§ê</span><br>                <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> setmealMapper.getById(shoppingCartDTO.getSetmealId());<br>                shoppingCart.setName(setmeal.getName());<br>                shoppingCart.setImage(setmeal.getImage());<br>                shoppingCart.setAmount(setmeal.getPrice());<br>            &#125;<br>            shoppingCart.setNumber(<span class="hljs-number">1</span>);<br>            shoppingCart.setCreateTime(LocalDateTime.now());<br>            shoppingCartMapper.insert(shoppingCart);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="1-3-MapperÂ±Ç-1"><a href="#1-3-MapperÂ±Ç-1" class="headerlink" title="1.3 MapperÂ±Ç"></a>1.3 MapperÂ±Ç</h3><p><strong>ÂàõÂª∫ShoppingCartMapperÊé•Âè£:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.ShoppingCart;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Delete;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Insert;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Update;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShoppingCartMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êù°‰ª∂Êü•ËØ¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCart</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;ShoppingCart&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(ShoppingCart shoppingCart)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êõ¥Êñ∞ÂïÜÂìÅÊï∞Èáè</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCart</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Update(&quot;update shopping_cart set number = #&#123;number&#125; where id = #&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNumberById</span><span class="hljs-params">(ShoppingCart shoppingCart)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊèíÂÖ•Ë¥≠Áâ©ËΩ¶Êï∞ÊçÆ</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCart</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Insert(&quot;insert into shopping_cart (name, user_id, dish_id, setmeal_id, dish_flavor, number, amount, image, create_time) &quot; +</span><br><span class="hljs-meta">            &quot; values (#&#123;name&#125;,#&#123;userId&#125;,#&#123;dishId&#125;,#&#123;setmealId&#125;,#&#123;dishFlavor&#125;,#&#123;number&#125;,#&#123;amount&#125;,#&#123;image&#125;,#&#123;createTime&#125;)&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(ShoppingCart shoppingCart)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ÂàõÂª∫ShoppingCartMapper.xmlÔºö</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.ShoppingCartMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;ShoppingCart&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;ShoppingCart&quot;</span>&gt;</span><br>        select * from shopping_cart<br>        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;userId != null&quot;</span>&gt;</span><br>                and user_id = #&#123;userId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;dishId != null&quot;</span>&gt;</span><br>                and dish_id = #&#123;dishId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;setmealId != null&quot;</span>&gt;</span><br>                and setmeal_id = #&#123;setmealId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;dishFlavor != null&quot;</span>&gt;</span><br>                and dish_flavor = #&#123;dishFlavor&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>        order by create_time desc<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h2 id="2-Êü•ÁúãË¥≠Áâ©ËΩ¶"><a href="#2-Êü•ÁúãË¥≠Áâ©ËΩ¶" class="headerlink" title="2. Êü•ÁúãË¥≠Áâ©ËΩ¶"></a>2. Êü•ÁúãË¥≠Áâ©ËΩ¶</h2><h3 id="2-1-ControllerÂ±Ç"><a href="#2-1-ControllerÂ±Ç" class="headerlink" title="2.1 ControllerÂ±Ç"></a>2.1 ControllerÂ±Ç</h3><p><strong>Âú®ShoppingCartController‰∏≠ÂàõÂª∫Êü•ÁúãË¥≠Áâ©ËΩ¶ÁöÑÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Êü•ÁúãË¥≠Áâ©ËΩ¶</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Êü•ÁúãË¥≠Áâ©ËΩ¶&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;List&lt;ShoppingCart&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">()</span>&#123;<br>       <span class="hljs-keyword">return</span> Result.success(shoppingCartService.showShoppingCart());<br>   &#125;<br></code></pre></td></tr></table></figure>


<h3 id="2-2-ServiceÂ±ÇÊé•Âè£"><a href="#2-2-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="2.2 ServiceÂ±ÇÊé•Âè£"></a>2.2 ServiceÂ±ÇÊé•Âè£</h3><p><strong>Âú®ShoppingCartServiceÊé•Âè£‰∏≠Â£∞ÊòéÊü•ÁúãË¥≠Áâ©ËΩ¶ÁöÑÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Êü•ÁúãË¥≠Áâ©ËΩ¶</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   List&lt;ShoppingCart&gt; <span class="hljs-title function_">showShoppingCart</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure>


<h3 id="2-3-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#2-3-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="2.3 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>2.3 ServiceÂ±ÇÂÆûÁé∞Á±ª</h3><p><strong>Âú®ShoppingCartServiceImpl‰∏≠ÂÆûÁé∞Êü•ÁúãË¥≠Áâ©ËΩ¶ÁöÑÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Êü•ÁúãË¥≠Áâ©ËΩ¶</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> List&lt;ShoppingCart&gt; <span class="hljs-title function_">showShoppingCart</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> shoppingCartMapper.list(ShoppingCart.<br>                                      builder().<br>                                      userId(BaseContext.getCurrentId()).<br>                                      build());<br>   &#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶"><a href="#3-Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶" class="headerlink" title="3. Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶"></a>3. Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶</h2><h3 id="3-1-ControllerÂ±Ç-2"><a href="#3-1-ControllerÂ±Ç-2" class="headerlink" title="3.1 ControllerÂ±Ç"></a>3.1 ControllerÂ±Ç</h3><p><strong>Âú®ShoppingCartController‰∏≠ÂàõÂª∫Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶ÁöÑÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶ÂïÜÂìÅ</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@DeleteMapping(&quot;/clean&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶ÂïÜÂìÅ&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">clean</span><span class="hljs-params">()</span>&#123;<br>       shoppingCartService.cleanShoppingCart();<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>


<h3 id="3-2-ServiceÂ±ÇÊé•Âè£"><a href="#3-2-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="3.2 ServiceÂ±ÇÊé•Âè£"></a>3.2 ServiceÂ±ÇÊé•Âè£</h3><p><strong>Âú®ShoppingCartServiceÊé•Âè£‰∏≠Â£∞ÊòéÊ∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶ÁöÑÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶ÂïÜÂìÅ</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanShoppingCart</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure>


<h3 id="3-3-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#3-3-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="3.3 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>3.3 ServiceÂ±ÇÂÆûÁé∞Á±ª</h3><p><strong>Âú®ShoppingCartServiceImpl‰∏≠ÂÆûÁé∞Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶ÁöÑÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶ÂïÜÂìÅ</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanShoppingCart</span><span class="hljs-params">()</span> &#123;<br>       shoppingCartMapper.deleteByUserId(BaseContext.getCurrentId());<br>   &#125;<br></code></pre></td></tr></table></figure>


<h3 id="3-4-MapperÂ±Ç"><a href="#3-4-MapperÂ±Ç" class="headerlink" title="3.4 MapperÂ±Ç"></a>3.4 MapperÂ±Ç</h3><p><strong>Âú®ShoppingCartMapperÊé•Âè£‰∏≠ÂàõÂª∫Âà†Èô§Ë¥≠Áâ©ËΩ¶Êï∞ÊçÆÁöÑÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆÁî®Êà∑idÂà†Èô§Ë¥≠Áâ©ËΩ¶Êï∞ÊçÆ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> userId</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Delete(&quot;delete from shopping_cart where user_id = #&#123;userId&#125;&quot;)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteByUserId</span><span class="hljs-params">(Long userId)</span>;<br></code></pre></td></tr></table></figure>

<h2 id="4-Âà†Èô§Ë¥≠Áâ©ËΩ¶‰∏≠Âçï‰∏™ÂïÜÂìÅ"><a href="#4-Âà†Èô§Ë¥≠Áâ©ËΩ¶‰∏≠Âçï‰∏™ÂïÜÂìÅ" class="headerlink" title="4. Âà†Èô§Ë¥≠Áâ©ËΩ¶‰∏≠Âçï‰∏™ÂïÜÂìÅ"></a>4. Âà†Èô§Ë¥≠Áâ©ËΩ¶‰∏≠Âçï‰∏™ÂïÜÂìÅ</h2><h3 id="4-1-ShoppingCartController"><a href="#4-1-ShoppingCartController" class="headerlink" title="4.1 ShoppingCartController"></a>4.1 ShoppingCartController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Âà†Èô§Ë¥≠Áâ©ËΩ¶‰∏≠‰∏Ä‰∏™ÂïÜÂìÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PostMapping(&quot;/sub&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;Âà†Èô§Ë¥≠Áâ©ËΩ¶‰∏≠‰∏Ä‰∏™ÂïÜÂìÅ&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">sub</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;Âà†Èô§Ë¥≠Áâ©ËΩ¶‰∏≠‰∏Ä‰∏™ÂïÜÂìÅÔºåÂïÜÂìÅÔºö&#123;&#125;&quot;</span>, shoppingCartDTO);<br>    shoppingCartService.subShoppingCart(shoppingCartDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="4-2-ShoppingCartService"><a href="#4-2-ShoppingCartService" class="headerlink" title="4.2 ShoppingCartService"></a>4.2 ShoppingCartService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Âà†Èô§Ë¥≠Áâ©ËΩ¶‰∏≠‰∏Ä‰∏™ÂïÜÂìÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">subShoppingCart</span><span class="hljs-params">(ShoppingCartDTO shoppingCartDTO)</span>;<br></code></pre></td></tr></table></figure>



<h3 id="4-3-ShoppingCartServiceImpl"><a href="#4-3-ShoppingCartServiceImpl" class="headerlink" title="4.3 ShoppingCartServiceImpl"></a>4.3 ShoppingCartServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Âà†Èô§Ë¥≠Áâ©ËΩ¶‰∏≠‰∏Ä‰∏™ÂïÜÂìÅ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subShoppingCart</span><span class="hljs-params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;<br>    <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">shoppingCart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCart</span>();<br>    BeanUtils.copyProperties(shoppingCartDTO,shoppingCart);<br>    <span class="hljs-comment">//ËÆæÁΩÆÊü•ËØ¢Êù°‰ª∂ÔºåÊü•ËØ¢ÂΩìÂâçÁôªÂΩïÁî®Êà∑ÁöÑË¥≠Áâ©ËΩ¶Êï∞ÊçÆ</span><br>    shoppingCart.setUserId(BaseContext.getCurrentId());<br><br>    List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);<br><br>    <span class="hljs-keyword">if</span>(list != <span class="hljs-literal">null</span> &amp;&amp; list.size() &gt; <span class="hljs-number">0</span>)&#123;<br>        shoppingCart = list.get(<span class="hljs-number">0</span>);<br><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> shoppingCart.getNumber();<br>        <span class="hljs-keyword">if</span>(number == <span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-comment">//ÂΩìÂâçÂïÜÂìÅÂú®Ë¥≠Áâ©ËΩ¶‰∏≠ÁöÑ‰ªΩÊï∞‰∏∫1ÔºåÁõ¥Êé•Âà†Èô§ÂΩìÂâçËÆ∞ÂΩï</span><br>            shoppingCartMapper.deleteById(shoppingCart.getId());<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//ÂΩìÂâçÂïÜÂìÅÂú®Ë¥≠Áâ©ËΩ¶‰∏≠ÁöÑ‰ªΩÊï∞‰∏ç‰∏∫1Ôºå‰øÆÊîπ‰ªΩÊï∞Âç≥ÂèØ</span><br>            shoppingCart.setNumber(shoppingCart.getNumber() - <span class="hljs-number">1</span>);<br>            shoppingCartMapper.updateNumberById(shoppingCart);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-ShoppingCartMapper"><a href="#4-4-ShoppingCartMapper" class="headerlink" title="4.4 ShoppingCartMapper"></a>4.4 ShoppingCartMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆidÂà†Èô§Ë¥≠Áâ©ËΩ¶Êï∞ÊçÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Delete(&quot;delete from shopping_cart where id = #&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>


<h1 id="ÂçÅ‰∫å-Áî®Êà∑‰∏ãÂçïÂíåËÆ¢ÂçïÊîØ‰ªò"><a href="#ÂçÅ‰∫å-Áî®Êà∑‰∏ãÂçïÂíåËÆ¢ÂçïÊîØ‰ªò" class="headerlink" title="ÂçÅ‰∫å. Áî®Êà∑‰∏ãÂçïÂíåËÆ¢ÂçïÊîØ‰ªò"></a>ÂçÅ‰∫å. Áî®Êà∑‰∏ãÂçïÂíåËÆ¢ÂçïÊîØ‰ªò</h1><h2 id="1-Áî®Êà∑‰∏ãÂçï"><a href="#1-Áî®Êà∑‰∏ãÂçï" class="headerlink" title="1. Áî®Êà∑‰∏ãÂçï"></a>1. Áî®Êà∑‰∏ãÂçï</h2><h3 id="1-1-ControllerÂ±Ç-2"><a href="#1-1-ControllerÂ±Ç-2" class="headerlink" title="1.1 ControllerÂ±Ç"></a>1.1 ControllerÂ±Ç</h3><p><strong>ÂàõÂª∫OrderControllerÂπ∂Êèê‰æõÁî®Êà∑‰∏ãÂçïÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.dto.OrdersPaymentDTO;<br><span class="hljs-keyword">import</span> com.sky.dto.OrdersSubmitDTO;<br><span class="hljs-keyword">import</span> com.sky.result.PageResult;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.OrderService;<br><span class="hljs-keyword">import</span> com.sky.vo.OrderPaymentVO;<br><span class="hljs-keyword">import</span> com.sky.vo.OrderSubmitVO;<br><span class="hljs-keyword">import</span> com.sky.vo.OrderVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ËÆ¢Âçï</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController(&quot;userOrderController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/order&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;CÁ´Ø-ËÆ¢ÂçïÊé•Âè£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Áî®Êà∑‰∏ãÂçï</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ordersSubmitDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/submit&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Áî®Êà∑‰∏ãÂçï&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;OrderSubmitVO&gt; <span class="hljs-title function_">submit</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersSubmitDTO ordersSubmitDTO)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;Áî®Êà∑‰∏ãÂçïÔºö&#123;&#125;&quot;</span>, ordersSubmitDTO);<br>        <span class="hljs-type">OrderSubmitVO</span> <span class="hljs-variable">orderSubmitVO</span> <span class="hljs-operator">=</span> orderService.submitOrder(ordersSubmitDTO);<br>        <span class="hljs-keyword">return</span> Result.success(orderSubmitVO);<br>    &#125; <br><br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="1-2-ServiceÂ±Ç-2"><a href="#1-2-ServiceÂ±Ç-2" class="headerlink" title="1.2 ServiceÂ±Ç"></a>1.2 ServiceÂ±Ç</h3><h4 id="1-2-1-ServiceÊé•Âè£"><a href="#1-2-1-ServiceÊé•Âè£" class="headerlink" title="1.2.1 ServiceÊé•Âè£"></a>1.2.1 ServiceÊé•Âè£</h4><p><strong>ÂàõÂª∫OrderServiceÊé•Âè£ÔºåÂπ∂Â£∞ÊòéÁî®Êà∑‰∏ãÂçïÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.*;<br><span class="hljs-keyword">import</span> com.sky.vo.OrderSubmitVO;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Áî®Êà∑‰∏ãÂçï</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ordersSubmitDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    OrderSubmitVO <span class="hljs-title function_">submitOrder</span><span class="hljs-params">(OrdersSubmitDTO ordersSubmitDTO)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="1-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª-2"><a href="#1-2-2-ServiceÂ±ÇÂÆûÁé∞Á±ª-2" class="headerlink" title="1.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>1.2.2 ServiceÂ±ÇÂÆûÁé∞Á±ª</h4><p><strong>ÂàõÂª∫OrderServiceImplÂÆûÁé∞OrderServiceÊé•Âè£Ôºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ËÆ¢Âçï</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderMapper orderMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderDetailMapper orderDetailMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ShoppingCartMapper shoppingCartMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AddressBookMapper addressBookMapper;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Áî®Êà∑‰∏ãÂçï</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ordersSubmitDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> OrderSubmitVO <span class="hljs-title function_">submitOrder</span><span class="hljs-params">(OrdersSubmitDTO ordersSubmitDTO)</span> &#123;<br>        <span class="hljs-comment">//ÂºÇÂ∏∏ÊÉÖÂÜµÁöÑÂ§ÑÁêÜÔºàÊî∂Ë¥ßÂú∞ÂùÄ‰∏∫Á©∫„ÄÅË∂ÖÂá∫ÈÖçÈÄÅËåÉÂõ¥„ÄÅË¥≠Áâ©ËΩ¶‰∏∫Á©∫Ôºâ</span><br>        <span class="hljs-type">AddressBook</span> <span class="hljs-variable">addressBook</span> <span class="hljs-operator">=</span> addressBookMapper.getById(ordersSubmitDTO.getAddressBookId());<br>        <span class="hljs-keyword">if</span> (addressBook == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddressBookBusinessException</span>(MessageConstant.ADDRESS_BOOK_IS_NULL);<br>        &#125;<br><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br>        <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">shoppingCart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCart</span>();<br>        shoppingCart.setUserId(userId);<br><br>        <span class="hljs-comment">//Êü•ËØ¢ÂΩìÂâçÁî®Êà∑ÁöÑË¥≠Áâ©ËΩ¶Êï∞ÊçÆ</span><br>        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.list(shoppingCart);<br>        <span class="hljs-keyword">if</span> (shoppingCartList == <span class="hljs-literal">null</span> || shoppingCartList.size() == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCartBusinessException</span>(MessageConstant.SHOPPING_CART_IS_NULL);<br>        &#125;<br><br>        <span class="hljs-comment">//ÊûÑÈÄ†ËÆ¢ÂçïÊï∞ÊçÆ</span><br>        <span class="hljs-type">Orders</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>        BeanUtils.copyProperties(ordersSubmitDTO,order);<br>        order.setPhone(addressBook.getPhone());<br>        order.setAddress(addressBook.getDetail());<br>        order.setConsignee(addressBook.getConsignee());<br>        order.setNumber(String.valueOf(System.currentTimeMillis()));<br>        order.setUserId(userId);<br>        order.setStatus(Orders.PENDING_PAYMENT);<br>        order.setPayStatus(Orders.UN_PAID);<br>        order.setOrderTime(LocalDateTime.now());<br><br>        <span class="hljs-comment">//ÂêëËÆ¢ÂçïË°®ÊèíÂÖ•1Êù°Êï∞ÊçÆ</span><br>        orderMapper.insert(order);<br><br>        <span class="hljs-comment">//ËÆ¢ÂçïÊòéÁªÜÊï∞ÊçÆ</span><br>        List&lt;OrderDetail&gt; orderDetailList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (ShoppingCart cart : shoppingCartList) &#123;<br>            <span class="hljs-type">OrderDetail</span> <span class="hljs-variable">orderDetail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDetail</span>();<br>            BeanUtils.copyProperties(cart, orderDetail);<br>            orderDetail.setOrderId(order.getId());<br>            orderDetailList.add(orderDetail);<br>        &#125;<br><br>        <span class="hljs-comment">//ÂêëÊòéÁªÜË°®ÊèíÂÖ•nÊù°Êï∞ÊçÆ</span><br>        orderDetailMapper.insertBatch(orderDetailList);<br><br>        <span class="hljs-comment">//Ê∏ÖÁêÜË¥≠Áâ©ËΩ¶‰∏≠ÁöÑÊï∞ÊçÆ</span><br>        shoppingCartMapper.deleteByUserId(userId);<br><br>        <span class="hljs-comment">//Â∞ÅË£ÖËøîÂõûÁªìÊûú</span><br>        <span class="hljs-type">OrderSubmitVO</span> <span class="hljs-variable">orderSubmitVO</span> <span class="hljs-operator">=</span> OrderSubmitVO.builder()<br>                .id(order.getId())<br>                .orderNumber(order.getNumber())<br>                .orderAmount(order.getAmount())<br>                .orderTime(order.getOrderTime())<br>                .build();<br><br>        <span class="hljs-keyword">return</span> orderSubmitVO;<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-MapperÂ±Ç-2"><a href="#1-3-MapperÂ±Ç-2" class="headerlink" title="1.3 MapperÂ±Ç"></a>1.3 MapperÂ±Ç</h3><h4 id="1-3-1-ÂàõÂª∫OrderMapperÊé•Âè£ÂíåÂØπÂ∫îÁöÑxmlÊò†Â∞ÑÊñá‰ª∂"><a href="#1-3-1-ÂàõÂª∫OrderMapperÊé•Âè£ÂíåÂØπÂ∫îÁöÑxmlÊò†Â∞ÑÊñá‰ª∂" class="headerlink" title="1.3.1 ÂàõÂª∫OrderMapperÊé•Âè£ÂíåÂØπÂ∫îÁöÑxmlÊò†Â∞ÑÊñá‰ª∂"></a>1.3.1 ÂàõÂª∫OrderMapperÊé•Âè£ÂíåÂØπÂ∫îÁöÑxmlÊò†Â∞ÑÊñá‰ª∂</h4><p>OrderMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊèíÂÖ•ËÆ¢ÂçïÊï∞ÊçÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> order</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Orders order)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>OrderMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.OrderMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Orders&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>        insert into orders<br>        (number, status, user_id, address_book_id, order_time, checkout_time, pay_method, pay_status, amount, remark,<br>         phone, address, consignee, estimated_delivery_time, delivery_status, pack_amount, tableware_number,<br>         tableware_status)<br>        values (#&#123;number&#125;, #&#123;status&#125;, #&#123;userId&#125;, #&#123;addressBookId&#125;, #&#123;orderTime&#125;, #&#123;checkoutTime&#125;, #&#123;payMethod&#125;,<br>                #&#123;payStatus&#125;, #&#123;amount&#125;, #&#123;remark&#125;, #&#123;phone&#125;, #&#123;address&#125;, #&#123;consignee&#125;,<br>                #&#123;estimatedDeliveryTime&#125;, #&#123;deliveryStatus&#125;, #&#123;packAmount&#125;, #&#123;tablewareNumber&#125;, #&#123;tablewareStatus&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<h4 id="1-3-2-ÂàõÂª∫OrderDetailMapperÊé•Âè£ÂíåÂØπÂ∫îÁöÑxmlÊò†Â∞ÑÊñá‰ª∂"><a href="#1-3-2-ÂàõÂª∫OrderDetailMapperÊé•Âè£ÂíåÂØπÂ∫îÁöÑxmlÊò†Â∞ÑÊñá‰ª∂" class="headerlink" title="1.3.2 ÂàõÂª∫OrderDetailMapperÊé•Âè£ÂíåÂØπÂ∫îÁöÑxmlÊò†Â∞ÑÊñá‰ª∂"></a>1.3.2 ÂàõÂª∫OrderDetailMapperÊé•Âè£ÂíåÂØπÂ∫îÁöÑxmlÊò†Â∞ÑÊñá‰ª∂</h4><p>OrderDetailMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.OrderDetail;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderDetailMapper</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ÊâπÈáèÊèíÂÖ•ËÆ¢ÂçïÊòéÁªÜÊï∞ÊçÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderDetails</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBatch</span><span class="hljs-params">(List&lt;OrderDetail&gt; orderDetails)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>OrderDetailMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.OrderDetailMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertBatch&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>        insert into order_detail<br>        (name, order_id, dish_id, setmeal_id, dish_flavor, number, amount, image)<br>        values<br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;orderDetails&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;od&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>            (#&#123;od.name&#125;,#&#123;od.orderId&#125;,#&#123;od.dishId&#125;,#&#123;od.setmealId&#125;,#&#123;od.dishFlavor&#125;,<br>             #&#123;od.number&#125;,#&#123;od.amount&#125;,#&#123;od.image&#125;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="2-ËÆ¢ÂçïÊîØ‰ªò"><a href="#2-ËÆ¢ÂçïÊîØ‰ªò" class="headerlink" title="2. ËÆ¢ÂçïÊîØ‰ªò"></a>2. ËÆ¢ÂçïÊîØ‰ªò</h2><h3 id="2-1-ÂæÆ‰ø°ÊîØ‰ªòÊµÅÁ®ã"><a href="#2-1-ÂæÆ‰ø°ÊîØ‰ªòÊµÅÁ®ã" class="headerlink" title="2.1 ÂæÆ‰ø°ÊîØ‰ªòÊµÅÁ®ã"></a>2.1 ÂæÆ‰ø°ÊîØ‰ªòÊµÅÁ®ã</h3><p><img src="/img/blogs/java/cangqiongtakeout/12.2.1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-2-‰ª£Á†ÅÂØºÂÖ•"><a href="#2-2-‰ª£Á†ÅÂØºÂÖ•" class="headerlink" title="2.2 ‰ª£Á†ÅÂØºÂÖ•"></a>2.2 ‰ª£Á†ÅÂØºÂÖ•</h3><h4 id="2-2-1-MapperÂ±Ç"><a href="#2-2-1-MapperÂ±Ç" class="headerlink" title="2.2.1 MapperÂ±Ç"></a>2.2.1 MapperÂ±Ç</h4><p><strong>Âú®OrderMapper.java‰∏≠Ê∑ªÂä†getByNumberAndUserIdÂíåupdate‰∏§‰∏™ÊñπÊ≥ï</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆËÆ¢ÂçïÂè∑ÂíåÁî®Êà∑idÊü•ËØ¢ËÆ¢Âçï</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> orderNumber</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> userId</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select * from orders where number = #&#123;orderNumber&#125; and user_id= #&#123;userId&#125;&quot;)</span><br>   Orders <span class="hljs-title function_">getByNumberAndUserId</span><span class="hljs-params">(String orderNumber, Long userId)</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ‰øÆÊîπËÆ¢Âçï‰ø°ÊÅØ</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> orders</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Orders orders)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®OrderMapper.xml‰∏≠Ê∑ªÂä†</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.sky.entity.Orders&quot;</span>&gt;</span><br>        update orders<br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;cancelReason != null and cancelReason!=&#x27;&#x27; &quot;</span>&gt;</span><br>                cancel_reason=#&#123;cancelReason&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;rejectionReason != null and rejectionReason!=&#x27;&#x27; &quot;</span>&gt;</span><br>                rejection_reason=#&#123;rejectionReason&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;cancelTime != null&quot;</span>&gt;</span><br>                cancel_time=#&#123;cancelTime&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;payStatus != null&quot;</span>&gt;</span><br>                pay_status=#&#123;payStatus&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;payMethod != null&quot;</span>&gt;</span><br>                pay_method=#&#123;payMethod&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;checkoutTime != null&quot;</span>&gt;</span><br>                checkout_time=#&#123;checkoutTime&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                status = #&#123;status&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;deliveryTime != null&quot;</span>&gt;</span><br>                delivery_time = #&#123;deliveryTime&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>        where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h4 id="2-2-2-ServiceÂ±Ç"><a href="#2-2-2-ServiceÂ±Ç" class="headerlink" title="2.2.2 ServiceÂ±Ç"></a>2.2.2 ServiceÂ±Ç</h4><p><strong>Âú®OrderService.java‰∏≠Ê∑ªÂä†paymentÂíåpaySuccess‰∏§‰∏™ÊñπÊ≥ïÂÆö‰πâ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËÆ¢ÂçïÊîØ‰ªò</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ordersPaymentDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   OrderPaymentVO <span class="hljs-title function_">payment</span><span class="hljs-params">(OrdersPaymentDTO ordersPaymentDTO)</span> <span class="hljs-keyword">throws</span> Exception;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ÊîØ‰ªòÊàêÂäüÔºå‰øÆÊîπËÆ¢ÂçïÁä∂ÊÄÅ</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> outTradeNo</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">paySuccess</span><span class="hljs-params">(String outTradeNo)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®OrderServiceImpl.java‰∏≠ÂÆûÁé∞paymentÂíåpaySuccess‰∏§‰∏™ÊñπÊ≥ï</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java">	<span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> UserMapper userMapper;<br><span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> WeChatPayUtil weChatPayUtil;<br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ËÆ¢ÂçïÊîØ‰ªò</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ordersPaymentDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> OrderPaymentVO <span class="hljs-title function_">payment</span><span class="hljs-params">(OrdersPaymentDTO ordersPaymentDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>       <span class="hljs-comment">// ÂΩìÂâçÁôªÂΩïÁî®Êà∑id</span><br>       <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br>       <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.getById(userId);<br><br>       <span class="hljs-comment">//Ë∞ÉÁî®ÂæÆ‰ø°ÊîØ‰ªòÊé•Âè£ÔºåÁîüÊàêÈ¢ÑÊîØ‰ªò‰∫§ÊòìÂçï</span><br>       <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> weChatPayUtil.pay(<br>               ordersPaymentDTO.getOrderNumber(), <span class="hljs-comment">//ÂïÜÊà∑ËÆ¢ÂçïÂè∑</span><br>               <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>), <span class="hljs-comment">//ÊîØ‰ªòÈáëÈ¢ùÔºåÂçï‰Ωç ÂÖÉ</span><br>               <span class="hljs-string">&quot;ËãçÁ©πÂ§ñÂçñËÆ¢Âçï&quot;</span>, <span class="hljs-comment">//ÂïÜÂìÅÊèèËø∞</span><br>               user.getOpenid() <span class="hljs-comment">//ÂæÆ‰ø°Áî®Êà∑ÁöÑopenid</span><br>       );<br><br>       <span class="hljs-keyword">if</span> (jsonObject.getString(<span class="hljs-string">&quot;code&quot;</span>) != <span class="hljs-literal">null</span> &amp;&amp; jsonObject.getString(<span class="hljs-string">&quot;code&quot;</span>).equals(<span class="hljs-string">&quot;ORDERPAID&quot;</span>)) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(<span class="hljs-string">&quot;ËØ•ËÆ¢ÂçïÂ∑≤ÊîØ‰ªò&quot;</span>);<br>       &#125;<br><br>       <span class="hljs-type">OrderPaymentVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> jsonObject.toJavaObject(OrderPaymentVO.class);<br>       vo.setPackageStr(jsonObject.getString(<span class="hljs-string">&quot;package&quot;</span>));<br><br>       <span class="hljs-keyword">return</span> vo;<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ÊîØ‰ªòÊàêÂäüÔºå‰øÆÊîπËÆ¢ÂçïÁä∂ÊÄÅ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> outTradeNo</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">paySuccess</span><span class="hljs-params">(String outTradeNo)</span> &#123;<br>       <span class="hljs-comment">// ÂΩìÂâçÁôªÂΩïÁî®Êà∑id</span><br>       <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>       <span class="hljs-comment">// Ê†πÊçÆËÆ¢ÂçïÂè∑Êü•ËØ¢ÂΩìÂâçÁî®Êà∑ÁöÑËÆ¢Âçï</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getByNumberAndUserId(outTradeNo, userId);<br><br>       <span class="hljs-comment">// Ê†πÊçÆËÆ¢ÂçïidÊõ¥Êñ∞ËÆ¢ÂçïÁöÑÁä∂ÊÄÅ„ÄÅÊîØ‰ªòÊñπÂºè„ÄÅÊîØ‰ªòÁä∂ÊÄÅ„ÄÅÁªìË¥¶Êó∂Èó¥</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> Orders.builder()<br>               .id(ordersDB.getId())<br>               .status(Orders.TO_BE_CONFIRMED)<br>               .payStatus(Orders.PAID)<br>               .checkoutTime(LocalDateTime.now())<br>               .build();<br><br>       orderMapper.update(orders);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-2-3-ControllerÂ±Ç"><a href="#2-2-3-ControllerÂ±Ç" class="headerlink" title="2.2.3 ControllerÂ±Ç"></a>2.2.3 ControllerÂ±Ç</h4><p><strong>Âú®OrderController.java‰∏≠Ê∑ªÂä†paymentÊñπÊ≥ï</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ËÆ¢ÂçïÊîØ‰ªò</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> ordersPaymentDTO</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-meta">@PutMapping(&quot;/payment&quot;)</span><br>  <span class="hljs-meta">@ApiOperation(&quot;ËÆ¢ÂçïÊîØ‰ªò&quot;)</span><br>  <span class="hljs-keyword">public</span> Result&lt;OrderPaymentVO&gt; <span class="hljs-title function_">payment</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersPaymentDTO ordersPaymentDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      log.info(<span class="hljs-string">&quot;ËÆ¢ÂçïÊîØ‰ªòÔºö&#123;&#125;&quot;</span>, ordersPaymentDTO);<br>      <span class="hljs-type">OrderPaymentVO</span> <span class="hljs-variable">orderPaymentVO</span> <span class="hljs-operator">=</span> orderService.payment(ordersPaymentDTO);<br>      log.info(<span class="hljs-string">&quot;ÁîüÊàêÈ¢ÑÊîØ‰ªò‰∫§ÊòìÂçïÔºö&#123;&#125;&quot;</span>, orderPaymentVO);<br>      <span class="hljs-keyword">return</span> Result.success(orderPaymentVO);<br>  &#125;<br></code></pre></td></tr></table></figure>

<p><strong>ÂØºÂÖ•PayNotifyController.java</strong></p>
<h3 id="2-3-Ë∑≥ËøáÂæÆ‰ø°ÊîØ‰ªò"><a href="#2-3-Ë∑≥ËøáÂæÆ‰ø°ÊîØ‰ªò" class="headerlink" title="2.3 Ë∑≥ËøáÂæÆ‰ø°ÊîØ‰ªò"></a>2.3 Ë∑≥ËøáÂæÆ‰ø°ÊîØ‰ªò</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/XZY__one/article/details/135818055">Ë∑≥ËøáÂæÆ‰ø°ÊîØ‰ªò</a></p>
<h1 id="ÂçÅ‰∏â-Áî®Êà∑Á´ØÂéÜÂè≤ËÆ¢ÂçïÊ®°Âùó"><a href="#ÂçÅ‰∏â-Áî®Êà∑Á´ØÂéÜÂè≤ËÆ¢ÂçïÊ®°Âùó" class="headerlink" title="ÂçÅ‰∏â. Áî®Êà∑Á´ØÂéÜÂè≤ËÆ¢ÂçïÊ®°Âùó"></a>ÂçÅ‰∏â. Áî®Êà∑Á´ØÂéÜÂè≤ËÆ¢ÂçïÊ®°Âùó</h1><h2 id="1-ÂéÜÂè≤ËÆ¢ÂçïÊü•ËØ¢"><a href="#1-ÂéÜÂè≤ËÆ¢ÂçïÊü•ËØ¢" class="headerlink" title="1. ÂéÜÂè≤ËÆ¢ÂçïÊü•ËØ¢"></a>1. ÂéÜÂè≤ËÆ¢ÂçïÊü•ËØ¢</h2><h3 id="1-1-user-OrderController"><a href="#1-1-user-OrderController" class="headerlink" title="1.1 user&#x2F;OrderController"></a>1.1 user&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂéÜÂè≤ËÆ¢ÂçïÊü•ËØ¢</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageSize</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> status   ËÆ¢ÂçïÁä∂ÊÄÅ 1ÂæÖ‰ªòÊ¨æ 2ÂæÖÊé•Âçï 3Â∑≤Êé•Âçï 4Ê¥æÈÄÅ‰∏≠ 5Â∑≤ÂÆåÊàê 6Â∑≤ÂèñÊ∂à</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/historyOrders&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂéÜÂè≤ËÆ¢ÂçïÊü•ËØ¢&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, Integer status)</span> &#123;<br>    <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> orderService.pageQuery4User(page, pageSize, status);<br>    <span class="hljs-keyword">return</span> Result.success(pageResult);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-OrderService"><a href="#1-2-OrderService" class="headerlink" title="1.2 OrderService"></a>1.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Áî®Êà∑Á´ØËÆ¢ÂçïÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageSize</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>PageResult <span class="hljs-title function_">pageQuery4User</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, Integer status)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-OrderServiceImpl"><a href="#1-3-OrderServiceImpl" class="headerlink" title="1.3 OrderServiceImpl"></a>1.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Áî®Êà∑Á´ØËÆ¢ÂçïÂàÜÈ°µÊü•ËØ¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageNum</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageSize</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">pageQuery4User</span><span class="hljs-params">(<span class="hljs-type">int</span> pageNum, <span class="hljs-type">int</span> pageSize, Integer status)</span> &#123;<br>        <span class="hljs-comment">// ËÆæÁΩÆÂàÜÈ°µ</span><br>        PageHelper.startPage(pageNum, pageSize);<br><br>        <span class="hljs-type">OrdersPageQueryDTO</span> <span class="hljs-variable">ordersPageQueryDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrdersPageQueryDTO</span>();<br>        ordersPageQueryDTO.setUserId(BaseContext.getCurrentId());<br>        ordersPageQueryDTO.setStatus(status);<br><br>        <span class="hljs-comment">// ÂàÜÈ°µÊù°‰ª∂Êü•ËØ¢</span><br>        Page&lt;Orders&gt; page = orderMapper.pageQuery(ordersPageQueryDTO);<br><br>        List&lt;OrderVO&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br><br>        <span class="hljs-comment">// Êü•ËØ¢Âá∫ËÆ¢ÂçïÊòéÁªÜÔºåÂπ∂Â∞ÅË£ÖÂÖ•OrderVOËøõË°åÂìçÂ∫î</span><br>        <span class="hljs-keyword">if</span> (page != <span class="hljs-literal">null</span> &amp;&amp; page.getTotal() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Orders orders : page) &#123;<br>                <span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> orders.getId();<span class="hljs-comment">// ËÆ¢Âçïid</span><br><br>                <span class="hljs-comment">// Êü•ËØ¢ËÆ¢ÂçïÊòéÁªÜ</span><br>                List&lt;OrderDetail&gt; orderDetails = orderDetailMapper.getByOrderId(orderId);<br><br>                <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderVO</span>();<br>                BeanUtils.copyProperties(orders, orderVO);<br>                orderVO.setOrderDetailList(orderDetails);<br><br>                list.add(orderVO);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(page.getTotal(), list);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-4-OrderMapper"><a href="#1-4-OrderMapper" class="headerlink" title="1.4 OrderMapper"></a>1.4 OrderMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂàÜÈ°µÊù°‰ª∂Êü•ËØ¢Âπ∂Êåâ‰∏ãÂçïÊó∂Èó¥ÊéíÂ∫è</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersPageQueryDTO</span><br><span class="hljs-comment"> */</span><br>Page&lt;Orders&gt; <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(OrdersPageQueryDTO ordersPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-5-OrderMapper-xml"><a href="#1-5-OrderMapper-xml" class="headerlink" title="1.5 OrderMapper.xml"></a>1.5 OrderMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pageQuery&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Orders&quot;</span>&gt;</span><br>    select * from orders<br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;number != null and number!=&#x27;&#x27;&quot;</span>&gt;</span><br>            and number like concat(&#x27;%&#x27;,#&#123;number&#125;,&#x27;%&#x27;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;phone != null and phone!=&#x27;&#x27;&quot;</span>&gt;</span><br>            and phone like concat(&#x27;%&#x27;,#&#123;phone&#125;,&#x27;%&#x27;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;userId != null&quot;</span>&gt;</span><br>            and user_id = #&#123;userId&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>            and status = #&#123;status&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;beginTime != null&quot;</span>&gt;</span><br>            and order_time <span class="hljs-symbol">&amp;gt;</span>= #&#123;beginTime&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;endTime != null&quot;</span>&gt;</span><br>            and order_time <span class="hljs-symbol">&amp;lt;</span>= #&#123;endTime&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    order by order_time desc<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-6-OrderDetailMapper"><a href="#1-6-OrderDetailMapper" class="headerlink" title="1.6 OrderDetailMapper"></a>1.6 OrderDetailMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê†πÊçÆËÆ¢ÂçïidÊü•ËØ¢ËÆ¢ÂçïÊòéÁªÜ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> orderId</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Select(&quot;select * from order_detail where order_id = #&#123;orderId&#125;&quot;)</span><br>List&lt;OrderDetail&gt; <span class="hljs-title function_">getByOrderId</span><span class="hljs-params">(Long orderId)</span>;<br></code></pre></td></tr></table></figure>



<h2 id="2-Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ"><a href="#2-Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ" class="headerlink" title="2. Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ"></a>2. Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ</h2><h3 id="2-1-user-OrderController"><a href="#2-1-user-OrderController" class="headerlink" title="2.1 user&#x2F;OrderController"></a>2.1 user&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/orderDetail/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;OrderVO&gt; <span class="hljs-title function_">details</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>    <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> orderService.details(id);<br>    <span class="hljs-keyword">return</span> Result.success(orderVO);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-OrderService"><a href="#2-2-OrderService" class="headerlink" title="2.2 OrderService"></a>2.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>OrderVO <span class="hljs-title function_">details</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-OrderServiceImpl"><a href="#2-3-OrderServiceImpl" class="headerlink" title="2.3 OrderServiceImpl"></a>2.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> OrderVO <span class="hljs-title function_">details</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// Ê†πÊçÆidÊü•ËØ¢ËÆ¢Âçï</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br><br>    <span class="hljs-comment">// Êü•ËØ¢ËØ•ËÆ¢ÂçïÂØπÂ∫îÁöÑËèúÂìÅ/Â•óÈ§êÊòéÁªÜ</span><br>    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId());<br><br>    <span class="hljs-comment">// Â∞ÜËØ•ËÆ¢ÂçïÂèäÂÖ∂ËØ¶ÊÉÖÂ∞ÅË£ÖÂà∞OrderVOÂπ∂ËøîÂõû</span><br>    <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderVO</span>();<br>    BeanUtils.copyProperties(orders, orderVO);<br>    orderVO.setOrderDetailList(orderDetailList);<br><br>    <span class="hljs-keyword">return</span> orderVO;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-OrderMapper"><a href="#2-4-OrderMapper" class="headerlink" title="2.4 OrderMapper"></a>2.4 OrderMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê†πÊçÆidÊü•ËØ¢ËÆ¢Âçï</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Select(&quot;select * from orders where id=#&#123;id&#125;&quot;)</span><br>Orders <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>


<h2 id="3-ÂèñÊ∂àËÆ¢Âçï"><a href="#3-ÂèñÊ∂àËÆ¢Âçï" class="headerlink" title="3. ÂèñÊ∂àËÆ¢Âçï"></a>3. ÂèñÊ∂àËÆ¢Âçï</h2><h3 id="3-1-user-OrderController"><a href="#3-1-user-OrderController" class="headerlink" title="3.1 user&#x2F;OrderController"></a>3.1 user&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Áî®Êà∑ÂèñÊ∂àËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/cancel/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂèñÊ∂àËÆ¢Âçï&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">cancel</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    orderService.userCancelById(id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-OrderService"><a href="#3-2-OrderService" class="headerlink" title="3.2 OrderService"></a>3.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Áî®Êà∑ÂèñÊ∂àËÆ¢Âçï</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">userCancelById</span><span class="hljs-params">(Long id)</span> <span class="hljs-keyword">throws</span> Exception;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-OrderServiceImpl"><a href="#3-3-OrderServiceImpl" class="headerlink" title="3.3 OrderServiceImpl"></a>3.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Áî®Êà∑ÂèñÊ∂àËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">userCancelById</span><span class="hljs-params">(Long id)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// Ê†πÊçÆidÊü•ËØ¢ËÆ¢Âçï</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br><br>    <span class="hljs-comment">// Ê†°È™åËÆ¢ÂçïÊòØÂê¶Â≠òÂú®</span><br>    <span class="hljs-keyword">if</span> (ordersDB == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_NOT_FOUND);<br>    &#125;<br><br>    <span class="hljs-comment">//ËÆ¢ÂçïÁä∂ÊÄÅ 1ÂæÖ‰ªòÊ¨æ 2ÂæÖÊé•Âçï 3Â∑≤Êé•Âçï 4Ê¥æÈÄÅ‰∏≠ 5Â∑≤ÂÆåÊàê 6Â∑≤ÂèñÊ∂à</span><br>    <span class="hljs-keyword">if</span> (ordersDB.getStatus() &gt; <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);<br>    &#125;<br><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersDB.getId());<br><br>    <span class="hljs-comment">// ËÆ¢ÂçïÂ§Ñ‰∫éÂæÖÊé•ÂçïÁä∂ÊÄÅ‰∏ãÂèñÊ∂àÔºåÈúÄË¶ÅËøõË°åÈÄÄÊ¨æ</span><br>    <span class="hljs-keyword">if</span> (ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) &#123;<br>        <span class="hljs-comment">//Ë∞ÉÁî®ÂæÆ‰ø°ÊîØ‰ªòÈÄÄÊ¨æÊé•Âè£</span><br>        weChatPayUtil.refund(<br>                ordersDB.getNumber(), <span class="hljs-comment">//ÂïÜÊà∑ËÆ¢ÂçïÂè∑</span><br>                ordersDB.getNumber(), <span class="hljs-comment">//ÂïÜÊà∑ÈÄÄÊ¨æÂçïÂè∑</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>),<span class="hljs-comment">//ÈÄÄÊ¨æÈáëÈ¢ùÔºåÂçï‰Ωç ÂÖÉ</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>));<span class="hljs-comment">//ÂéüËÆ¢ÂçïÈáëÈ¢ù</span><br><br>        <span class="hljs-comment">//ÊîØ‰ªòÁä∂ÊÄÅ‰øÆÊîπ‰∏∫ ÈÄÄÊ¨æ</span><br>        orders.setPayStatus(Orders.REFUND);<br>    &#125;<br><br>    <span class="hljs-comment">// Êõ¥Êñ∞ËÆ¢ÂçïÁä∂ÊÄÅ„ÄÅÂèñÊ∂àÂéüÂõ†„ÄÅÂèñÊ∂àÊó∂Èó¥</span><br>    orders.setStatus(Orders.CANCELLED);<br>    orders.setCancelReason(<span class="hljs-string">&quot;Áî®Êà∑ÂèñÊ∂à&quot;</span>);<br>    orders.setCancelTime(LocalDateTime.now());<br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="4-ÂÜçÊù•‰∏ÄÂçï"><a href="#4-ÂÜçÊù•‰∏ÄÂçï" class="headerlink" title="4. ÂÜçÊù•‰∏ÄÂçï"></a>4. ÂÜçÊù•‰∏ÄÂçï</h2><h3 id="4-1-user-OrderController"><a href="#4-1-user-OrderController" class="headerlink" title="4.1 user&#x2F;OrderController"></a>4.1 user&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂÜçÊù•‰∏ÄÂçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping(&quot;/repetition/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂÜçÊù•‰∏ÄÂçï&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">repetition</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>    orderService.repetition(id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-OrderService"><a href="#4-2-OrderService" class="headerlink" title="4.2 OrderService"></a>4.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂÜçÊù•‰∏ÄÂçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">repetition</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-OrderServiceImpl"><a href="#4-3-OrderServiceImpl" class="headerlink" title="4.3 OrderServiceImpl"></a>4.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂÜçÊù•‰∏ÄÂçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">repetition</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// Êü•ËØ¢ÂΩìÂâçÁî®Êà∑id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>    <span class="hljs-comment">// Ê†πÊçÆËÆ¢ÂçïidÊü•ËØ¢ÂΩìÂâçËÆ¢ÂçïËØ¶ÊÉÖ</span><br>    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(id);<br><br>    <span class="hljs-comment">// Â∞ÜËÆ¢ÂçïËØ¶ÊÉÖÂØπË±°ËΩ¨Êç¢‰∏∫Ë¥≠Áâ©ËΩ¶ÂØπË±°</span><br>    List&lt;ShoppingCart&gt; shoppingCartList = orderDetailList.stream().map(x -&gt; &#123;<br>        <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">shoppingCart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCart</span>();<br><br>        <span class="hljs-comment">// Â∞ÜÂéüËÆ¢ÂçïËØ¶ÊÉÖÈáåÈù¢ÁöÑËèúÂìÅ‰ø°ÊÅØÈáçÊñ∞Â§çÂà∂Âà∞Ë¥≠Áâ©ËΩ¶ÂØπË±°‰∏≠</span><br>        BeanUtils.copyProperties(x, shoppingCart, <span class="hljs-string">&quot;id&quot;</span>);<br>        shoppingCart.setUserId(userId);<br>        shoppingCart.setCreateTime(LocalDateTime.now());<br><br>        <span class="hljs-keyword">return</span> shoppingCart;<br>    &#125;).collect(Collectors.toList());<br><br>    <span class="hljs-comment">// Â∞ÜË¥≠Áâ©ËΩ¶ÂØπË±°ÊâπÈáèÊ∑ªÂä†Âà∞Êï∞ÊçÆÂ∫ì</span><br>    shoppingCartMapper.insertBatch(shoppingCartList);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-ShoppingCartMapper-1"><a href="#4-4-ShoppingCartMapper-1" class="headerlink" title="4.4 ShoppingCartMapper"></a>4.4 ShoppingCartMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÊâπÈáèÊèíÂÖ•Ë¥≠Áâ©ËΩ¶Êï∞ÊçÆ</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> shoppingCartList</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBatch</span><span class="hljs-params">(List&lt;ShoppingCart&gt; shoppingCartList)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-5-ShoppingCartMapper-xml"><a href="#4-5-ShoppingCartMapper-xml" class="headerlink" title="4.5 ShoppingCartMapper.xml"></a>4.5 ShoppingCartMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertBatch&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>        insert into shopping_cart<br>        (name, image, user_id, dish_id, setmeal_id, dish_flavor, number, amount, create_time)<br>        values<br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;shoppingCartList&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;sc&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>            (#&#123;sc.name&#125;,#&#123;sc.image&#125;,#&#123;sc.userId&#125;,#&#123;sc.dishId&#125;,#&#123;sc.setmealId&#125;,#&#123;sc.dishFlavor&#125;,#&#123;sc.number&#125;,#&#123;sc.amount&#125;,#&#123;sc.createTime&#125;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h1 id="ÂçÅÂõõ-ÂïÜÂÆ∂Á´ØËÆ¢ÂçïÁÆ°ÁêÜÊ®°Âùó"><a href="#ÂçÅÂõõ-ÂïÜÂÆ∂Á´ØËÆ¢ÂçïÁÆ°ÁêÜÊ®°Âùó" class="headerlink" title="ÂçÅÂõõ. ÂïÜÂÆ∂Á´ØËÆ¢ÂçïÁÆ°ÁêÜÊ®°Âùó"></a>ÂçÅÂõõ. ÂïÜÂÆ∂Á´ØËÆ¢ÂçïÁÆ°ÁêÜÊ®°Âùó</h1><h2 id="1-ËÆ¢ÂçïÊêúÁ¥¢"><a href="#1-ËÆ¢ÂçïÊêúÁ¥¢" class="headerlink" title="1. ËÆ¢ÂçïÊêúÁ¥¢"></a>1. ËÆ¢ÂçïÊêúÁ¥¢</h2><h3 id="1-1-admin-OrderController"><a href="#1-1-admin-OrderController" class="headerlink" title="1.1 admin&#x2F;OrderController"></a>1.1 admin&#x2F;OrderController</h3><p>Âú®adminÂåÖ‰∏ãÂàõÂª∫OrderController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ËÆ¢ÂçïÁÆ°ÁêÜ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController(&quot;adminOrderController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/order&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;ËÆ¢ÂçïÁÆ°ÁêÜÊé•Âè£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ËÆ¢ÂçïÊêúÁ¥¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ordersPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/conditionSearch&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;ËÆ¢ÂçïÊêúÁ¥¢&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">conditionSearch</span><span class="hljs-params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;<br>        <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> orderService.conditionSearch(ordersPageQueryDTO);<br>        <span class="hljs-keyword">return</span> Result.success(pageResult);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-OrderService-1"><a href="#1-2-OrderService-1" class="headerlink" title="1.2 OrderService"></a>1.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êù°‰ª∂ÊêúÁ¥¢ËÆ¢Âçï</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersPageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>PageResult <span class="hljs-title function_">conditionSearch</span><span class="hljs-params">(OrdersPageQueryDTO ordersPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-OrderServiceImpl-1"><a href="#1-3-OrderServiceImpl-1" class="headerlink" title="1.3 OrderServiceImpl"></a>1.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ËÆ¢ÂçïÊêúÁ¥¢</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersPageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">conditionSearch</span><span class="hljs-params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;<br>    PageHelper.startPage(ordersPageQueryDTO.getPage(), ordersPageQueryDTO.getPageSize());<br><br>    Page&lt;Orders&gt; page = orderMapper.pageQuery(ordersPageQueryDTO);<br><br>    <span class="hljs-comment">// ÈÉ®ÂàÜËÆ¢ÂçïÁä∂ÊÄÅÔºåÈúÄË¶ÅÈ¢ùÂ§ñËøîÂõûËÆ¢ÂçïËèúÂìÅ‰ø°ÊÅØÔºåÂ∞ÜOrdersËΩ¨Âåñ‰∏∫OrderVO</span><br>    List&lt;OrderVO&gt; orderVOList = getOrderVOList(page);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(page.getTotal(), orderVOList);<br>&#125;<br><br><span class="hljs-keyword">private</span> List&lt;OrderVO&gt; <span class="hljs-title function_">getOrderVOList</span><span class="hljs-params">(Page&lt;Orders&gt; page)</span> &#123;<br>    <span class="hljs-comment">// ÈúÄË¶ÅËøîÂõûËÆ¢ÂçïËèúÂìÅ‰ø°ÊÅØÔºåËá™ÂÆö‰πâOrderVOÂìçÂ∫îÁªìÊûú</span><br>    List&lt;OrderVO&gt; orderVOList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    List&lt;Orders&gt; ordersList = page.getResult();<br>    <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(ordersList)) &#123;<br>        <span class="hljs-keyword">for</span> (Orders orders : ordersList) &#123;<br>            <span class="hljs-comment">// Â∞ÜÂÖ±ÂêåÂ≠óÊÆµÂ§çÂà∂Âà∞OrderVO</span><br>            <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderVO</span>();<br>            BeanUtils.copyProperties(orders, orderVO);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">orderDishes</span> <span class="hljs-operator">=</span> getOrderDishesStr(orders);<br><br>            <span class="hljs-comment">// Â∞ÜËÆ¢ÂçïËèúÂìÅ‰ø°ÊÅØÂ∞ÅË£ÖÂà∞orderVO‰∏≠ÔºåÂπ∂Ê∑ªÂä†Âà∞orderVOList</span><br>            orderVO.setOrderDishes(orderDishes);<br>            orderVOList.add(orderVO);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> orderVOList;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê†πÊçÆËÆ¢ÂçïidËé∑ÂèñËèúÂìÅ‰ø°ÊÅØÂ≠óÁ¨¶‰∏≤</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> orders</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> String <span class="hljs-title function_">getOrderDishesStr</span><span class="hljs-params">(Orders orders)</span> &#123;<br>    <span class="hljs-comment">// Êü•ËØ¢ËÆ¢ÂçïËèúÂìÅËØ¶ÊÉÖ‰ø°ÊÅØÔºàËÆ¢Âçï‰∏≠ÁöÑËèúÂìÅÂíåÊï∞ÈáèÔºâ</span><br>    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId());<br><br>    <span class="hljs-comment">// Â∞ÜÊØè‰∏ÄÊù°ËÆ¢ÂçïËèúÂìÅ‰ø°ÊÅØÊãºÊé•‰∏∫Â≠óÁ¨¶‰∏≤ÔºàÊ†ºÂºèÔºöÂÆ´‰øùÈ∏°‰∏Å*3ÔºõÔºâ</span><br>    List&lt;String&gt; orderDishList = orderDetailList.stream().map(x -&gt; &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">orderDish</span> <span class="hljs-operator">=</span> x.getName() + <span class="hljs-string">&quot;*&quot;</span> + x.getNumber() + <span class="hljs-string">&quot;;&quot;</span>;<br>        <span class="hljs-keyword">return</span> orderDish;<br>    &#125;).collect(Collectors.toList());<br><br>    <span class="hljs-comment">// Â∞ÜËØ•ËÆ¢ÂçïÂØπÂ∫îÁöÑÊâÄÊúâËèúÂìÅ‰ø°ÊÅØÊãºÊé•Âú®‰∏ÄËµ∑</span><br>    <span class="hljs-keyword">return</span> String.join(<span class="hljs-string">&quot;&quot;</span>, orderDishList);<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="2-ÂêÑ‰∏™Áä∂ÊÄÅÁöÑËÆ¢ÂçïÊï∞ÈáèÁªüËÆ°"><a href="#2-ÂêÑ‰∏™Áä∂ÊÄÅÁöÑËÆ¢ÂçïÊï∞ÈáèÁªüËÆ°" class="headerlink" title="2. ÂêÑ‰∏™Áä∂ÊÄÅÁöÑËÆ¢ÂçïÊï∞ÈáèÁªüËÆ°"></a>2. ÂêÑ‰∏™Áä∂ÊÄÅÁöÑËÆ¢ÂçïÊï∞ÈáèÁªüËÆ°</h2><h3 id="2-1-admin-OrderController"><a href="#2-1-admin-OrderController" class="headerlink" title="2.1 admin&#x2F;OrderController"></a>2.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂêÑ‰∏™Áä∂ÊÄÅÁöÑËÆ¢ÂçïÊï∞ÈáèÁªüËÆ°</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/statistics&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂêÑ‰∏™Áä∂ÊÄÅÁöÑËÆ¢ÂçïÊï∞ÈáèÁªüËÆ°&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;OrderStatisticsVO&gt; <span class="hljs-title function_">statistics</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">OrderStatisticsVO</span> <span class="hljs-variable">orderStatisticsVO</span> <span class="hljs-operator">=</span> orderService.statistics();<br>    <span class="hljs-keyword">return</span> Result.success(orderStatisticsVO);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-OrderService-1"><a href="#2-2-OrderService-1" class="headerlink" title="2.2 OrderService"></a>2.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂêÑ‰∏™Áä∂ÊÄÅÁöÑËÆ¢ÂçïÊï∞ÈáèÁªüËÆ°</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>OrderStatisticsVO <span class="hljs-title function_">statistics</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-OrderServiceImpl-1"><a href="#2-3-OrderServiceImpl-1" class="headerlink" title="2.3 OrderServiceImpl"></a>2.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂêÑ‰∏™Áä∂ÊÄÅÁöÑËÆ¢ÂçïÊï∞ÈáèÁªüËÆ°</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> OrderStatisticsVO <span class="hljs-title function_">statistics</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// Ê†πÊçÆÁä∂ÊÄÅÔºåÂàÜÂà´Êü•ËØ¢Âá∫ÂæÖÊé•Âçï„ÄÅÂæÖÊ¥æÈÄÅ„ÄÅÊ¥æÈÄÅ‰∏≠ÁöÑËÆ¢ÂçïÊï∞Èáè</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">toBeConfirmed</span> <span class="hljs-operator">=</span> orderMapper.countStatus(Orders.TO_BE_CONFIRMED);<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">confirmed</span> <span class="hljs-operator">=</span> orderMapper.countStatus(Orders.CONFIRMED);<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">deliveryInProgress</span> <span class="hljs-operator">=</span> orderMapper.countStatus(Orders.DELIVERY_IN_PROGRESS);<br><br>    <span class="hljs-comment">// Â∞ÜÊü•ËØ¢Âá∫ÁöÑÊï∞ÊçÆÂ∞ÅË£ÖÂà∞orderStatisticsVO‰∏≠ÂìçÂ∫î</span><br>    <span class="hljs-type">OrderStatisticsVO</span> <span class="hljs-variable">orderStatisticsVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderStatisticsVO</span>();<br>    orderStatisticsVO.setToBeConfirmed(toBeConfirmed);<br>    orderStatisticsVO.setConfirmed(confirmed);<br>    orderStatisticsVO.setDeliveryInProgress(deliveryInProgress);<br>    <span class="hljs-keyword">return</span> orderStatisticsVO;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-OrderMapper-1"><a href="#2-4-OrderMapper-1" class="headerlink" title="2.4 OrderMapper"></a>2.4 OrderMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê†πÊçÆÁä∂ÊÄÅÁªüËÆ°ËÆ¢ÂçïÊï∞Èáè</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Select(&quot;select count(id) from orders where status = #&#123;status&#125;&quot;)</span><br>Integer <span class="hljs-title function_">countStatus</span><span class="hljs-params">(Integer status)</span>;<br></code></pre></td></tr></table></figure>


<h2 id="3-Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ"><a href="#3-Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ" class="headerlink" title="3. Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ"></a>3. Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ</h2><h3 id="3-1-admin-OrderController"><a href="#3-1-admin-OrderController" class="headerlink" title="3.1 admin&#x2F;OrderController"></a>3.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ËÆ¢ÂçïËØ¶ÊÉÖ</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/details/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;Êü•ËØ¢ËÆ¢ÂçïËØ¶ÊÉÖ&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;OrderVO&gt; <span class="hljs-title function_">details</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>    <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> orderService.details(id);<br>    <span class="hljs-keyword">return</span> Result.success(orderVO);<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="4-Êé•Âçï"><a href="#4-Êé•Âçï" class="headerlink" title="4. Êé•Âçï"></a>4. Êé•Âçï</h2><h3 id="4-1-admin-OrderController"><a href="#4-1-admin-OrderController" class="headerlink" title="4.1 admin&#x2F;OrderController"></a>4.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êé•Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/confirm&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;Êé•Âçï&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">confirm</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersConfirmDTO ordersConfirmDTO)</span> &#123;<br>    orderService.confirm(ordersConfirmDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-OrderService-1"><a href="#4-2-OrderService-1" class="headerlink" title="4.2 OrderService"></a>4.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êé•Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersConfirmDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(OrdersConfirmDTO ordersConfirmDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-OrderServiceImpl-1"><a href="#4-3-OrderServiceImpl-1" class="headerlink" title="4.3 OrderServiceImpl"></a>4.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êé•Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersConfirmDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(OrdersConfirmDTO ordersConfirmDTO)</span> &#123;<br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> Orders.builder()<br>            .id(ordersConfirmDTO.getId())<br>            .status(Orders.CONFIRMED)<br>            .build();<br><br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-ÊãíÂçï"><a href="#5-ÊãíÂçï" class="headerlink" title="5. ÊãíÂçï"></a>5. ÊãíÂçï</h2><h3 id="5-1-admin-OrderController"><a href="#5-1-admin-OrderController" class="headerlink" title="5.1 admin&#x2F;OrderController"></a>5.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÊãíÂçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/rejection&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÊãíÂçï&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">rejection</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersRejectionDTO ordersRejectionDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    orderService.rejection(ordersRejectionDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-2-OrderService"><a href="#5-2-OrderService" class="headerlink" title="5.2 OrderService"></a>5.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÊãíÂçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersRejectionDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">rejection</span><span class="hljs-params">(OrdersRejectionDTO ordersRejectionDTO)</span> <span class="hljs-keyword">throws</span> Exception;<br></code></pre></td></tr></table></figure>

<h3 id="5-3-OrderServiceImpl"><a href="#5-3-OrderServiceImpl" class="headerlink" title="5.3 OrderServiceImpl"></a>5.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÊãíÂçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersRejectionDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejection</span><span class="hljs-params">(OrdersRejectionDTO ordersRejectionDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// Ê†πÊçÆidÊü•ËØ¢ËÆ¢Âçï</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(ordersRejectionDTO.getId());<br><br>    <span class="hljs-comment">// ËÆ¢ÂçïÂè™ÊúâÂ≠òÂú®‰∏îÁä∂ÊÄÅ‰∏∫2ÔºàÂæÖÊé•ÂçïÔºâÊâçÂèØ‰ª•ÊãíÂçï</span><br>    <span class="hljs-keyword">if</span> (ordersDB == <span class="hljs-literal">null</span> || !ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);<br>    &#125;<br><br>    <span class="hljs-comment">//ÊîØ‰ªòÁä∂ÊÄÅ</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">payStatus</span> <span class="hljs-operator">=</span> ordersDB.getPayStatus();<br>    <span class="hljs-keyword">if</span> (payStatus == Orders.PAID) &#123;<br>        <span class="hljs-comment">//Áî®Êà∑Â∑≤ÊîØ‰ªòÔºåÈúÄË¶ÅÈÄÄÊ¨æ</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">refund</span> <span class="hljs-operator">=</span> weChatPayUtil.refund(<br>                ordersDB.getNumber(),<br>                ordersDB.getNumber(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>));<br>        log.info(<span class="hljs-string">&quot;Áî≥ËØ∑ÈÄÄÊ¨æÔºö&#123;&#125;&quot;</span>, refund);<br>    &#125;<br><br>    <span class="hljs-comment">// ÊãíÂçïÈúÄË¶ÅÈÄÄÊ¨æÔºåÊ†πÊçÆËÆ¢ÂçïidÊõ¥Êñ∞ËÆ¢ÂçïÁä∂ÊÄÅ„ÄÅÊãíÂçïÂéüÂõ†„ÄÅÂèñÊ∂àÊó∂Èó¥</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersDB.getId());<br>    orders.setStatus(Orders.CANCELLED);<br>    orders.setRejectionReason(ordersRejectionDTO.getRejectionReason());<br>    orders.setCancelTime(LocalDateTime.now());<br><br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="6-ÂèñÊ∂àËÆ¢Âçï"><a href="#6-ÂèñÊ∂àËÆ¢Âçï" class="headerlink" title="6. ÂèñÊ∂àËÆ¢Âçï"></a>6. ÂèñÊ∂àËÆ¢Âçï</h2><h3 id="6-1-admin-OrderController"><a href="#6-1-admin-OrderController" class="headerlink" title="6.1 admin&#x2F;OrderController"></a>6.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂèñÊ∂àËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/cancel&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂèñÊ∂àËÆ¢Âçï&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">cancel</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersCancelDTO ordersCancelDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    orderService.cancel(ordersCancelDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="6-2-OrderService"><a href="#6-2-OrderService" class="headerlink" title="6.2 OrderService"></a>6.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂïÜÂÆ∂ÂèñÊ∂àËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersCancelDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(OrdersCancelDTO ordersCancelDTO)</span> <span class="hljs-keyword">throws</span> Exception;<br></code></pre></td></tr></table></figure>

<h3 id="6-3-OrderServiceImpl"><a href="#6-3-OrderServiceImpl" class="headerlink" title="6.3 OrderServiceImpl"></a>6.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂèñÊ∂àËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersCancelDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(OrdersCancelDTO ordersCancelDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// Ê†πÊçÆidÊü•ËØ¢ËÆ¢Âçï</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(ordersCancelDTO.getId());<br><br>    <span class="hljs-comment">//ÊîØ‰ªòÁä∂ÊÄÅ</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">payStatus</span> <span class="hljs-operator">=</span> ordersDB.getPayStatus();<br>    <span class="hljs-keyword">if</span> (payStatus == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">//Áî®Êà∑Â∑≤ÊîØ‰ªòÔºåÈúÄË¶ÅÈÄÄÊ¨æ</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">refund</span> <span class="hljs-operator">=</span> weChatPayUtil.refund(<br>                ordersDB.getNumber(),<br>                ordersDB.getNumber(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>));<br>        log.info(<span class="hljs-string">&quot;Áî≥ËØ∑ÈÄÄÊ¨æÔºö&#123;&#125;&quot;</span>, refund);<br>    &#125;<br><br>    <span class="hljs-comment">// ÁÆ°ÁêÜÁ´ØÂèñÊ∂àËÆ¢ÂçïÈúÄË¶ÅÈÄÄÊ¨æÔºåÊ†πÊçÆËÆ¢ÂçïidÊõ¥Êñ∞ËÆ¢ÂçïÁä∂ÊÄÅ„ÄÅÂèñÊ∂àÂéüÂõ†„ÄÅÂèñÊ∂àÊó∂Èó¥</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersCancelDTO.getId());<br>    orders.setStatus(Orders.CANCELLED);<br>    orders.setCancelReason(ordersCancelDTO.getCancelReason());<br>    orders.setCancelTime(LocalDateTime.now());<br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="7-Ê¥æÈÄÅËÆ¢Âçï"><a href="#7-Ê¥æÈÄÅËÆ¢Âçï" class="headerlink" title="7. Ê¥æÈÄÅËÆ¢Âçï"></a>7. Ê¥æÈÄÅËÆ¢Âçï</h2><h3 id="7-1-admin-OrderController"><a href="#7-1-admin-OrderController" class="headerlink" title="7.1 admin&#x2F;OrderController"></a>7.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê¥æÈÄÅËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/delivery/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;Ê¥æÈÄÅËÆ¢Âçï&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delivery</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>    orderService.delivery(id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="7-2-OrderService"><a href="#7-2-OrderService" class="headerlink" title="7.2 OrderService"></a>7.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê¥æÈÄÅËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">delivery</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="7-3-OrderServiceImpl"><a href="#7-3-OrderServiceImpl" class="headerlink" title="7.3 OrderServiceImpl"></a>7.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ê¥æÈÄÅËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delivery</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// Ê†πÊçÆidÊü•ËØ¢ËÆ¢Âçï</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br><br>    <span class="hljs-comment">// Ê†°È™åËÆ¢ÂçïÊòØÂê¶Â≠òÂú®ÔºåÂπ∂‰∏îÁä∂ÊÄÅ‰∏∫3</span><br>    <span class="hljs-keyword">if</span> (ordersDB == <span class="hljs-literal">null</span> || !ordersDB.getStatus().equals(Orders.CONFIRMED)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);<br>    &#125;<br><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersDB.getId());<br>    <span class="hljs-comment">// Êõ¥Êñ∞ËÆ¢ÂçïÁä∂ÊÄÅ,Áä∂ÊÄÅËΩ¨‰∏∫Ê¥æÈÄÅ‰∏≠</span><br>    orders.setStatus(Orders.DELIVERY_IN_PROGRESS);<br><br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="8-ÂÆåÊàêËÆ¢Âçï"><a href="#8-ÂÆåÊàêËÆ¢Âçï" class="headerlink" title="8. ÂÆåÊàêËÆ¢Âçï"></a>8. ÂÆåÊàêËÆ¢Âçï</h2><h3 id="8-1-admin-OrderController"><a href="#8-1-admin-OrderController" class="headerlink" title="8.1 admin&#x2F;OrderController"></a>8.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂÆåÊàêËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/complete/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂÆåÊàêËÆ¢Âçï&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">complete</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>    orderService.complete(id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="8-2-OrderService"><a href="#8-2-OrderService" class="headerlink" title="8.2 OrderService"></a>8.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂÆåÊàêËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">complete</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="8-3-OrderServiceImpl"><a href="#8-3-OrderServiceImpl" class="headerlink" title="8.3 OrderServiceImpl"></a>8.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂÆåÊàêËÆ¢Âçï</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">complete</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// Ê†πÊçÆidÊü•ËØ¢ËÆ¢Âçï</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br><br>    <span class="hljs-comment">// Ê†°È™åËÆ¢ÂçïÊòØÂê¶Â≠òÂú®ÔºåÂπ∂‰∏îÁä∂ÊÄÅ‰∏∫4</span><br>    <span class="hljs-keyword">if</span> (ordersDB == <span class="hljs-literal">null</span> || !ordersDB.getStatus().equals(Orders.DELIVERY_IN_PROGRESS)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);<br>    &#125;<br><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersDB.getId());<br>    <span class="hljs-comment">// Êõ¥Êñ∞ËÆ¢ÂçïÁä∂ÊÄÅ,Áä∂ÊÄÅËΩ¨‰∏∫ÂÆåÊàê</span><br>    orders.setStatus(Orders.COMPLETED);<br>    orders.setDeliveryTime(LocalDateTime.now());<br><br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="ÂçÅ‰∫î-Spring-Task-Âíå-ËÆ¢ÂçïÁä∂ÊÄÅÂÆöÊó∂Â§ÑÁêÜ"><a href="#ÂçÅ‰∫î-Spring-Task-Âíå-ËÆ¢ÂçïÁä∂ÊÄÅÂÆöÊó∂Â§ÑÁêÜ" class="headerlink" title="ÂçÅ‰∫î. Spring Task Âíå ËÆ¢ÂçïÁä∂ÊÄÅÂÆöÊó∂Â§ÑÁêÜ"></a>ÂçÅ‰∫î. Spring Task Âíå ËÆ¢ÂçïÁä∂ÊÄÅÂÆöÊó∂Â§ÑÁêÜ</h1><h2 id="1-Spring-Task"><a href="#1-Spring-Task" class="headerlink" title="1. Spring Task"></a>1. Spring Task</h2><h3 id="1-1-‰ªãÁªç"><a href="#1-1-‰ªãÁªç" class="headerlink" title="1.1 ‰ªãÁªç"></a>1.1 ‰ªãÁªç</h3><ul>
<li><strong>Spring Task</strong> ÊòØSpringÊ°ÜÊû∂Êèê‰æõÁöÑ‰ªªÂä°Ë∞ÉÂ∫¶Â∑•ÂÖ∑ÔºåÂèØ‰ª•ÊåâÁÖßÁ∫¶ÂÆöÁöÑÊó∂Èó¥Ëá™Âä®ÊâßË°åÊüê‰∏™‰ª£Á†ÅÈÄªËæë„ÄÇ</li>
<li><strong>‰ΩúÁî®</strong>ÂÆöÊó∂Ëá™Âä®ÊâßË°åÊüêÊÆµJava‰ª£Á†Å</li>
</ul>
<h3 id="1-2-cronË°®ËææÂºè"><a href="#1-2-cronË°®ËææÂºè" class="headerlink" title="1.2 cronË°®ËææÂºè"></a>1.2 cronË°®ËææÂºè</h3><p><strong>cronË°®ËææÂºè</strong>ÂÖ∂ÂÆûÂ∞±ÊòØ‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÔºåÈÄöËøácronË°®ËææÂºèÂèØ‰ª•<strong>ÂÆö‰πâ‰ªªÂä°Ëß¶ÂèëÁöÑÊó∂Èó¥</strong></p>
<p>**ÊûÑÊàêËßÑÂàôÔºö**ÂàÜ‰∏∫6Êàñ7‰∏™ÂüüÔºåÁî±Á©∫Ê†ºÂàÜÈöîÂºÄÔºåÊØè‰∏™Âüü‰ª£Ë°®‰∏Ä‰∏™Âê´‰πâ</p>
<p>ÊØè‰∏™ÂüüÁöÑÂê´‰πâÂàÜÂà´‰∏∫ÔºöÁßí„ÄÅÂàÜÈíü„ÄÅÂ∞èÊó∂„ÄÅÊó•„ÄÅÊúà„ÄÅÂë®„ÄÅÂπ¥(ÂèØÈÄâ)</p>
<p><strong>‰∏æ‰æãÔºö</strong></p>
<p>2022Âπ¥10Êúà12Êó•‰∏äÂçà9ÁÇπÊï¥ ÂØπÂ∫îÁöÑcronË°®ËææÂºè‰∏∫Ôºö<strong>0 0 9 12 10 ? 2022</strong></p>
<h3 id="1-3-Spring-Task‰ΩøÁî®Ê≠•È™§"><a href="#1-3-Spring-Task‰ΩøÁî®Ê≠•È™§" class="headerlink" title="1.3 Spring Task‰ΩøÁî®Ê≠•È™§"></a>1.3 Spring Task‰ΩøÁî®Ê≠•È™§</h3><ol>
<li>ÂØºÂÖ•mavenÂùêÊ†á spring-context</li>
<li>ÂêØÂä®Á±ªÊ∑ªÂä†Ê≥®Ëß£ @EnableScheduling ÂºÄÂêØ‰ªªÂä°Ë∞ÉÂ∫¶</li>
<li>Ëá™ÂÆö‰πâÂÆöÊó∂‰ªªÂä°Á±ª</li>
</ol>
<h2 id="2-ËÆ¢ÂçïÁä∂ÊÄÅÂÆöÊó∂Â§ÑÁêÜ"><a href="#2-ËÆ¢ÂçïÁä∂ÊÄÅÂÆöÊó∂Â§ÑÁêÜ" class="headerlink" title="2. ËÆ¢ÂçïÁä∂ÊÄÅÂÆöÊó∂Â§ÑÁêÜ"></a>2. ËÆ¢ÂçïÁä∂ÊÄÅÂÆöÊó∂Â§ÑÁêÜ</h2><h3 id="2-1-ÈóÆÈ¢òÂàÜÊûê"><a href="#2-1-ÈóÆÈ¢òÂàÜÊûê" class="headerlink" title="2.1 ÈóÆÈ¢òÂàÜÊûê"></a>2.1 ÈóÆÈ¢òÂàÜÊûê</h3><ul>
<li>‰∏ãÂçïÂêéÊú™ÊîØ‰ªòÔºåËÆ¢Âçï‰∏ÄÁõ¥Â§Ñ‰∫é**‚ÄúÂæÖÊîØ‰ªò‚Äù**Áä∂ÊÄÅ</li>
<li>Áî®Êà∑Êî∂Ë¥ßÂêéÁÆ°ÁêÜÁ´ØÊú™ÁÇπÂáªÂÆåÊàêÊåâÈíÆÔºåËÆ¢Âçï‰∏ÄÁõ¥Â§Ñ‰∫é**‚ÄúÊ¥æÈÄÅ‰∏≠‚Äù**Áä∂ÊÄÅ</li>
</ul>
<p>ÂØπ‰∫é‰∏äÈù¢‰∏§ÁßçÊÉÖÂÜµÈúÄË¶ÅÈÄöËøá<strong>ÂÆöÊó∂‰ªªÂä°</strong>Êù•‰øÆÊîπËÆ¢ÂçïÁä∂ÊÄÅÔºåÂÖ∑‰ΩìÈÄªËæë‰∏∫Ôºö</p>
<ul>
<li>ÈÄöËøáÂÆöÊó∂‰ªªÂä°ÊØèÂàÜÈíüÊ£ÄÊü•‰∏ÄÊ¨°ÊòØÂê¶Â≠òÂú®ÊîØ‰ªòË∂ÖÊó∂ËÆ¢ÂçïÔºà‰∏ãÂçïÂêéË∂ÖËøá15ÂàÜÈíü‰ªçÊú™ÊîØ‰ªòÂàôÂà§ÂÆö‰∏∫ÊîØ‰ªòË∂ÖÊó∂ËÆ¢ÂçïÔºâÔºåÂ¶ÇÊûúÂ≠òÂú®Âàô‰øÆÊîπËÆ¢ÂçïÁä∂ÊÄÅ‰∏∫‚ÄúÂ∑≤ÂèñÊ∂à‚Äù</li>
<li>ÈÄöËøáÂÆöÊó∂‰ªªÂä°ÊØèÂ§©ÂáåÊô®1ÁÇπÊ£ÄÊü•‰∏ÄÊ¨°ÊòØÂê¶Â≠òÂú®‚ÄúÊ¥æÈÄÅ‰∏≠‚ÄùÁöÑËÆ¢ÂçïÔºåÂ¶ÇÊûúÂ≠òÂú®Âàô‰øÆÊîπËÆ¢ÂçïÁä∂ÊÄÅ‰∏∫‚ÄúÂ∑≤ÂÆåÊàê‚Äù</li>
</ul>
<h3 id="2-2-Ëá™ÂÆö‰πâÂÆöÊó∂‰ªªÂä°Á±ªOrderTask"><a href="#2-2-Ëá™ÂÆö‰πâÂÆöÊó∂‰ªªÂä°Á±ªOrderTask" class="headerlink" title="2.2 Ëá™ÂÆö‰πâÂÆöÊó∂‰ªªÂä°Á±ªOrderTask"></a>2.2 Ëá™ÂÆö‰πâÂÆöÊó∂‰ªªÂä°Á±ªOrderTask</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.task;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ëá™ÂÆö‰πâÂÆöÊó∂‰ªªÂä°ÔºåÂÆûÁé∞ËÆ¢ÂçïÁä∂ÊÄÅÂÆöÊó∂Â§ÑÁêÜ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTask</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderMapper orderMapper;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Â§ÑÁêÜÊîØ‰ªòË∂ÖÊó∂ËÆ¢Âçï</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Scheduled(cron = &quot;0 * * * * ?&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processTimeoutOrder</span><span class="hljs-params">()</span>&#123;<br>        log.info(<span class="hljs-string">&quot;Â§ÑÁêÜÊîØ‰ªòË∂ÖÊó∂ËÆ¢ÂçïÔºö&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> LocalDateTime.now().plusMinutes(-<span class="hljs-number">15</span>);<br><br>        <span class="hljs-comment">// select * from orders where status = 1 and order_time &lt; ÂΩìÂâçÊó∂Èó¥-15ÂàÜÈíü</span><br>        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrdertimeLT(Orders.PENDING_PAYMENT, time);<br>        <span class="hljs-keyword">if</span>(ordersList != <span class="hljs-literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="hljs-number">0</span>)&#123;<br>            ordersList.forEach(order -&gt; &#123;<br>                order.setStatus(Orders.CANCELLED);<br>                order.setCancelReason(<span class="hljs-string">&quot;ÊîØ‰ªòË∂ÖÊó∂ÔºåËá™Âä®ÂèñÊ∂à&quot;</span>);<br>                order.setCancelTime(LocalDateTime.now());<br>                orderMapper.update(order);<br>            &#125;);<br>        &#125;<br>    &#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Â§ÑÁêÜ‚ÄúÊ¥æÈÄÅ‰∏≠‚ÄùÁä∂ÊÄÅÁöÑËÆ¢Âçï</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processDeliveryOrder</span><span class="hljs-params">()</span>&#123;<br>        log.info(<span class="hljs-string">&quot;Â§ÑÁêÜÊ¥æÈÄÅ‰∏≠ËÆ¢ÂçïÔºö&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        <span class="hljs-comment">// select * from orders where status = 4 and order_time &lt; ÂΩìÂâçÊó∂Èó¥-1Â∞èÊó∂</span><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> LocalDateTime.now().plusMinutes(-<span class="hljs-number">60</span>);<br>        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrdertimeLT(Orders.DELIVERY_IN_PROGRESS, time);<br><br>        <span class="hljs-keyword">if</span>(ordersList != <span class="hljs-literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="hljs-number">0</span>)&#123;<br>            ordersList.forEach(order -&gt; &#123;<br>                order.setStatus(Orders.COMPLETED);<br>                orderMapper.update(order);<br>            &#125;);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="2-3-Âú®OrderMapperÊé•Âè£‰∏≠Êâ©Â±ïÊñπÊ≥ï"><a href="#2-3-Âú®OrderMapperÊé•Âè£‰∏≠Êâ©Â±ïÊñπÊ≥ï" class="headerlink" title="2.3 Âú®OrderMapperÊé•Âè£‰∏≠Êâ©Â±ïÊñπÊ≥ï"></a>2.3 Âú®OrderMapperÊé•Âè£‰∏≠Êâ©Â±ïÊñπÊ≥ï</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆÁä∂ÊÄÅÂíå‰∏ãÂçïÊó∂Èó¥Êü•ËØ¢ËÆ¢Âçï</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> orderTime</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select * from orders where status = #&#123;status&#125; and order_time &lt; #&#123;orderTime&#125;&quot;)</span><br>   List&lt;Orders&gt; <span class="hljs-title function_">getByStatusAndOrdertimeLT</span><span class="hljs-params">(Integer status, LocalDateTime orderTime)</span>;<br></code></pre></td></tr></table></figure>

<h1 id="ÂçÅÂÖ≠-WebSocket-Âíå-Áî®Êà∑Êù•ÂçïÂÇ¨ÂçïÊèêÈÜí"><a href="#ÂçÅÂÖ≠-WebSocket-Âíå-Áî®Êà∑Êù•ÂçïÂÇ¨ÂçïÊèêÈÜí" class="headerlink" title="ÂçÅÂÖ≠. WebSocket Âíå Áî®Êà∑Êù•ÂçïÂÇ¨ÂçïÊèêÈÜí"></a>ÂçÅÂÖ≠. WebSocket Âíå Áî®Êà∑Êù•ÂçïÂÇ¨ÂçïÊèêÈÜí</h1><h2 id="1-WebSocket"><a href="#1-WebSocket" class="headerlink" title="1. WebSocket"></a>1. WebSocket</h2><p>WebSocket ÊòØÂü∫‰∫é TCP ÁöÑ‰∏ÄÁßçÊñ∞ÁöÑ<strong>ÁΩëÁªúÂçèËÆÆ</strong>„ÄÇÂÆÉÂÆûÁé∞‰∫ÜÊµèËßàÂô®‰∏éÊúçÂä°Âô®ÂÖ®ÂèåÂ∑•ÈÄö‰ø°‚Äî‚ÄîÊµèËßàÂô®ÂíåÊúçÂä°Âô®Âè™ÈúÄË¶ÅÂÆåÊàê‰∏ÄÊ¨°Êè°ÊâãÔºå‰∏§ËÄÖ‰πãÈó¥Â∞±ÂèØ‰ª•ÂàõÂª∫<strong>ÊåÅ‰πÖÊÄß</strong>ÁöÑËøûÊé•Ôºå Âπ∂ËøõË°å<strong>ÂèåÂêë</strong>Êï∞ÊçÆ‰º†Ëæì„ÄÇ</p>
<p><strong>HTTPÂçèËÆÆÂíåWebSocketÂçèËÆÆÂØπÊØîÔºö</strong></p>
<ul>
<li>HTTPÊòØ<strong>Áü≠ËøûÊé•</strong></li>
<li>WebSocketÊòØ<strong>ÈïøËøûÊé•</strong></li>
<li>HTTPÈÄö‰ø°ÊòØ<strong>ÂçïÂêë</strong>ÁöÑÔºåÂü∫‰∫éËØ∑Ê±ÇÂìçÂ∫îÊ®°Âºè</li>
<li>WebSocketÊîØÊåÅ<strong>ÂèåÂêë</strong>ÈÄö‰ø°</li>
<li>HTTPÂíåWebSocketÂ∫ïÂ±ÇÈÉΩÊòØTCPËøûÊé•</li>
</ul>
<h2 id="2-Áî®Êà∑Êù•ÂçïÊèêÈÜí"><a href="#2-Áî®Êà∑Êù•ÂçïÊèêÈÜí" class="headerlink" title="2. Áî®Êà∑Êù•ÂçïÊèêÈÜí"></a>2. Áî®Êà∑Êù•ÂçïÊèêÈÜí</h2><h3 id="2-1-ÂÆûÁé∞ÊÄùË∑Ø"><a href="#2-1-ÂÆûÁé∞ÊÄùË∑Ø" class="headerlink" title="2.1 ÂÆûÁé∞ÊÄùË∑Ø"></a>2.1 ÂÆûÁé∞ÊÄùË∑Ø</h3><ul>
<li>ÈÄöËøáWebSocketÂÆûÁé∞ÁÆ°ÁêÜÁ´ØÈ°µÈù¢ÂíåÊúçÂä°Á´Ø‰øùÊåÅÈïøËøûÊé•Áä∂ÊÄÅ</li>
<li>ÂΩìÂÆ¢Êà∑ÊîØ‰ªòÂêéÔºåË∞ÉÁî®WebSocketÁöÑÁõ∏ÂÖ≥APIÂÆûÁé∞ÊúçÂä°Á´ØÂêëÂÆ¢Êà∑Á´ØÊé®ÈÄÅÊ∂àÊÅØ</li>
<li>ÂÆ¢Êà∑Á´ØÊµèËßàÂô®Ëß£ÊûêÊúçÂä°Á´ØÊé®ÈÄÅÁöÑÊ∂àÊÅØÔºåÂà§Êñ≠ÊòØÊù•ÂçïÊèêÈÜíËøòÊòØÂÆ¢Êà∑ÂÇ¨ÂçïÔºåËøõË°åÁõ∏Â∫îÁöÑÊ∂àÊÅØÊèêÁ§∫ÂíåËØ≠Èü≥Êí≠Êä•</li>
<li>Á∫¶ÂÆöÊúçÂä°Á´ØÂèëÈÄÅÁªôÂÆ¢Êà∑Á´ØÊµèËßàÂô®ÁöÑÊï∞ÊçÆÊ†ºÂºè‰∏∫JSONÔºåÂ≠óÊÆµÂåÖÊã¨ÔºötypeÔºåorderIdÔºåcontent<ul>
<li>type ‰∏∫Ê∂àÊÅØÁ±ªÂûãÔºå1‰∏∫Êù•ÂçïÊèêÈÜí 2‰∏∫ÂÆ¢Êà∑ÂÇ¨Âçï</li>
<li>orderId ‰∏∫ËÆ¢Âçïid</li>
<li>content ‰∏∫Ê∂àÊÅØÂÜÖÂÆπ</li>
</ul>
</li>
</ul>
<h3 id="2-2-‰ª£Á†ÅÂºÄÂèë"><a href="#2-2-‰ª£Á†ÅÂºÄÂèë" class="headerlink" title="2.2 ‰ª£Á†ÅÂºÄÂèë"></a>2.2 ‰ª£Á†ÅÂºÄÂèë</h3><p><strong>Âú®OrderServiceImpl‰∏≠Ê≥®ÂÖ•WebSocketServerÂØπË±°Ôºå‰øÆÊîπpaySuccessÊñπÊ≥ïÔºåÂä†ÂÖ•Â¶Ç‰∏ã‰ª£Á†ÅÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> WebSocketServer webSocketServer;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ÊîØ‰ªòÊàêÂäüÔºå‰øÆÊîπËÆ¢ÂçïÁä∂ÊÄÅ</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> outTradeNo</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">paySuccess</span><span class="hljs-params">(String outTradeNo)</span> &#123;<br>       <span class="hljs-comment">// ÂΩìÂâçÁôªÂΩïÁî®Êà∑id</span><br>       <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>       <span class="hljs-comment">// Ê†πÊçÆËÆ¢ÂçïÂè∑Êü•ËØ¢ÂΩìÂâçÁî®Êà∑ÁöÑËÆ¢Âçï</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getByNumberAndUserId(outTradeNo, userId);<br><br>       <span class="hljs-comment">// Ê†πÊçÆËÆ¢ÂçïidÊõ¥Êñ∞ËÆ¢ÂçïÁöÑÁä∂ÊÄÅ„ÄÅÊîØ‰ªòÊñπÂºè„ÄÅÊîØ‰ªòÁä∂ÊÄÅ„ÄÅÁªìË¥¶Êó∂Èó¥</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> Orders.builder()<br>               .id(ordersDB.getId())<br>               .status(Orders.TO_BE_CONFIRMED)<br>               .payStatus(Orders.PAID)<br>               .checkoutTime(LocalDateTime.now())<br>               .build();<br><br>       orderMapper.update(orders);<br>	<span class="hljs-comment">//////////////////////////////////////////////</span><br>       <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>       map.put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-number">1</span>);<span class="hljs-comment">//Ê∂àÊÅØÁ±ªÂûãÔºå1Ë°®Á§∫Êù•ÂçïÊèêÈÜí</span><br>       map.put(<span class="hljs-string">&quot;orderId&quot;</span>, orders.getId());<br>       map.put(<span class="hljs-string">&quot;content&quot;</span>, <span class="hljs-string">&quot;ËÆ¢ÂçïÂè∑Ôºö&quot;</span> + outTradeNo);<br><br>       <span class="hljs-comment">//ÈÄöËøáWebSocketÂÆûÁé∞Êù•ÂçïÊèêÈÜíÔºåÂêëÂÆ¢Êà∑Á´ØÊµèËßàÂô®Êé®ÈÄÅÊ∂àÊÅØ</span><br>       webSocketServer.sendToAllClient(JSON.toJSONString(map));<br>       <span class="hljs-comment">///////////////////////////////////////////////////</span><br>   &#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-Áî®Êà∑ÂÇ¨ÂçïÊèêÈÜí"><a href="#3-Áî®Êà∑ÂÇ¨ÂçïÊèêÈÜí" class="headerlink" title="3. Áî®Êà∑ÂÇ¨ÂçïÊèêÈÜí"></a>3. Áî®Êà∑ÂÇ¨ÂçïÊèêÈÜí</h2><h3 id="3-1-ControllerÂ±Ç-3"><a href="#3-1-ControllerÂ±Ç-3" class="headerlink" title="3.1 ControllerÂ±Ç"></a>3.1 ControllerÂ±Ç</h3><p><strong>Ê†πÊçÆÁî®Êà∑ÂÇ¨ÂçïÁöÑÊé•Âè£ÂÆö‰πâÔºåÂú®user&#x2F;OrderController‰∏≠ÂàõÂª∫ÂÇ¨ÂçïÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Áî®Êà∑ÂÇ¨Âçï</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/reminder/&#123;id&#125;&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;Áî®Êà∑ÂÇ¨Âçï&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">reminder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>       orderService.reminder(id);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-ServiceÂ±ÇÊé•Âè£-1"><a href="#3-2-ServiceÂ±ÇÊé•Âè£-1" class="headerlink" title="3.2 ServiceÂ±ÇÊé•Âè£"></a>3.2 ServiceÂ±ÇÊé•Âè£</h3><p><strong>Âú®OrderServiceÊé•Âè£‰∏≠Â£∞ÊòéreminderÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Áî®Êà∑ÂÇ¨Âçï</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">reminder</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-ServiceÂ±ÇÂÆûÁé∞Á±ª-1"><a href="#3-3-ServiceÂ±ÇÂÆûÁé∞Á±ª-1" class="headerlink" title="3.3 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>3.3 ServiceÂ±ÇÂÆûÁé∞Á±ª</h3><p><strong>Âú®OrderServiceImpl‰∏≠ÂÆûÁé∞reminderÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Áî®Êà∑ÂÇ¨Âçï</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reminder</span><span class="hljs-params">(Long id)</span> &#123;<br>       <span class="hljs-comment">// Êü•ËØ¢ËÆ¢ÂçïÊòØÂê¶Â≠òÂú®</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br>       <span class="hljs-keyword">if</span> (orders == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_NOT_FOUND);<br>       &#125;<br><br>       <span class="hljs-comment">//Âü∫‰∫éWebSocketÂÆûÁé∞ÂÇ¨Âçï</span><br>       <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>       map.put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-number">2</span>);<span class="hljs-comment">//2‰ª£Ë°®Áî®Êà∑ÂÇ¨Âçï</span><br>       map.put(<span class="hljs-string">&quot;orderId&quot;</span>, id);<br>       map.put(<span class="hljs-string">&quot;content&quot;</span>, <span class="hljs-string">&quot;ËÆ¢ÂçïÂè∑Ôºö&quot;</span> + orders.getNumber());<br>       webSocketServer.sendToAllClient(JSON.toJSONString(map));<br>   &#125;<br></code></pre></td></tr></table></figure>

<h1 id="ÂçÅ‰∏É-Êï∞ÊçÆÁªüËÆ°ÂäüËÉΩ"><a href="#ÂçÅ‰∏É-Êï∞ÊçÆÁªüËÆ°ÂäüËÉΩ" class="headerlink" title="ÂçÅ‰∏É. Êï∞ÊçÆÁªüËÆ°ÂäüËÉΩ"></a>ÂçÅ‰∏É. Êï∞ÊçÆÁªüËÆ°ÂäüËÉΩ</h1><h2 id="1-Ëê•‰∏öÈ¢ùÁªüËÆ°"><a href="#1-Ëê•‰∏öÈ¢ùÁªüËÆ°" class="headerlink" title="1. Ëê•‰∏öÈ¢ùÁªüËÆ°"></a>1. Ëê•‰∏öÈ¢ùÁªüËÆ°</h2><h3 id="1-1-ControllerÂ±Ç-3"><a href="#1-1-ControllerÂ±Ç-3" class="headerlink" title="1.1 ControllerÂ±Ç"></a>1.1 ControllerÂ±Ç</h3><p><strong>Ê†πÊçÆÊé•Âè£ÂÆö‰πâÂàõÂª∫ReportControllerÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.admin;<br><br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.ReportService;<br><span class="hljs-keyword">import</span> com.sky.vo.TurnoverReportVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.format.annotation.DateTimeFormat;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.time.LocalDate;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Êä•Ë°®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/report&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;ÁªüËÆ°Êä•Ë°®Áõ∏ÂÖ≥Êé•Âè£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReportController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ReportService reportService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ëê•‰∏öÈ¢ùÊï∞ÊçÆÁªüËÆ°</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/turnoverStatistics&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Ëê•‰∏öÈ¢ùÊï∞ÊçÆÁªüËÆ°&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;TurnoverReportVO&gt; <span class="hljs-title function_">turnoverStatistics</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="hljs-params">                    LocalDate begin,</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="hljs-params">                    LocalDate end)</span> &#123;<br>        <span class="hljs-keyword">return</span> Result.success(reportService.getTurnover(begin, end));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-2-ServiceÂ±ÇÊé•Âè£"><a href="#1-2-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="1.2 ServiceÂ±ÇÊé•Âè£"></a>1.2 ServiceÂ±ÇÊé•Âè£</h3><p><strong>ÂàõÂª∫ReportServiceÊé•Âè£ÔºåÂ£∞ÊòégetTurnoverÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.vo.TurnoverReportVO;<br><span class="hljs-keyword">import</span> java.time.LocalDate;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ReportService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÊó∂Èó¥Âå∫Èó¥ÁªüËÆ°Ëê•‰∏öÈ¢ù</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> beginTime</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> endTime</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    TurnoverReportVO <span class="hljs-title function_">getTurnover</span><span class="hljs-params">(LocalDate beginTime, LocalDate endTime)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-3-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#1-3-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="1.3 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>1.3 ServiceÂ±ÇÂÆûÁé∞Á±ª</h3><p><strong>ÂàõÂª∫ReportServiceImplÂÆûÁé∞Á±ªÔºåÂÆûÁé∞getTurnoverÊñπÊ≥ï:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><span class="hljs-keyword">import</span> com.sky.entity.Orders;<br><span class="hljs-keyword">import</span> com.sky.mapper.OrderMapper;<br><span class="hljs-keyword">import</span> com.sky.service.ReportService;<br><span class="hljs-keyword">import</span> com.sky.vo.TurnoverReportVO;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.apache.commons.lang.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> java.time.LocalDate;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.time.LocalTime;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReportServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ReportService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderMapper orderMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Ê†πÊçÆÊó∂Èó¥Âå∫Èó¥ÁªüËÆ°Ëê•‰∏öÈ¢ù</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> TurnoverReportVO <span class="hljs-title function_">getTurnover</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span> &#123;<br>        List&lt;LocalDate&gt; dateList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        dateList.add(begin);<br><br>        <span class="hljs-keyword">while</span> (!begin.equals(end))&#123;<br>            begin = begin.plusDays(<span class="hljs-number">1</span>);<span class="hljs-comment">//Êó•ÊúüËÆ°ÁÆóÔºåËé∑ÂæóÊåáÂÆöÊó•ÊúüÂêé1Â§©ÁöÑÊó•Êúü</span><br>            dateList.add(begin);<br>        &#125;<br>        <br>       List&lt;Double&gt; turnoverList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (LocalDate date : dateList) &#123;<br>            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">beginTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MIN);<br>            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MAX);<br>            <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        	map.put(<span class="hljs-string">&quot;status&quot;</span>, Orders.COMPLETED);<br>        	map.put(<span class="hljs-string">&quot;begin&quot;</span>,beginTime);<br>        	map.put(<span class="hljs-string">&quot;end&quot;</span>, endTime);<br>            <span class="hljs-type">Double</span> <span class="hljs-variable">turnover</span> <span class="hljs-operator">=</span> orderMapper.sumByMap(map); <br>            turnover = turnover == <span class="hljs-literal">null</span> ? <span class="hljs-number">0.0</span> : turnover;<br>            turnoverList.add(turnover);<br>        &#125;<br><br>        <span class="hljs-comment">//Êï∞ÊçÆÂ∞ÅË£Ö</span><br>        <span class="hljs-keyword">return</span> TurnoverReportVO.builder()<br>                .dateList(StringUtils.join(dateList,<span class="hljs-string">&quot;,&quot;</span>))<br>                .turnoverList(StringUtils.join(turnoverList,<span class="hljs-string">&quot;,&quot;</span>))<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-4-MapperÂ±Ç-1"><a href="#1-4-MapperÂ±Ç-1" class="headerlink" title="1.4 MapperÂ±Ç"></a>1.4 MapperÂ±Ç</h3><p><strong>Âú®OrderMapperÊé•Âè£Â£∞ÊòésumByMapÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆÂä®ÊÄÅÊù°‰ª∂ÁªüËÆ°Ëê•‰∏öÈ¢ù</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> map</span><br><span class="hljs-comment">    */</span><br>   Double <span class="hljs-title function_">sumByMap</span><span class="hljs-params">(Map map)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®OrderMapper.xmlÊñá‰ª∂‰∏≠ÁºñÂÜôÂä®ÊÄÅSQLÔºö</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sumByMap&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Double&quot;</span>&gt;</span><br>        select sum(amount) from orders<br>        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                and status = #&#123;status&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;begin != null&quot;</span>&gt;</span><br>                and order_time <span class="hljs-symbol">&amp;gt;</span>= #&#123;begin&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;end != null&quot;</span>&gt;</span><br>                and order_time <span class="hljs-symbol">&amp;lt;</span>= #&#123;end&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="2-Áî®Êà∑ÁªüËÆ°"><a href="#2-Áî®Êà∑ÁªüËÆ°" class="headerlink" title="2. Áî®Êà∑ÁªüËÆ°"></a>2. Áî®Êà∑ÁªüËÆ°</h2><h3 id="2-1-ControllerÂ±Ç-1"><a href="#2-1-ControllerÂ±Ç-1" class="headerlink" title="2.1 ControllerÂ±Ç"></a>2.1 ControllerÂ±Ç</h3><p><strong>Ê†πÊçÆÊé•Âè£ÂÆö‰πâÔºåÂú®ReportController‰∏≠ÂàõÂª∫userStatisticsÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Áî®Êà∑Êï∞ÊçÆÁªüËÆ°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/userStatistics&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Áî®Êà∑Êï∞ÊçÆÁªüËÆ°&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;UserReportVO&gt; <span class="hljs-title function_">userStatistics</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span>&#123;<br><br>        <span class="hljs-keyword">return</span> Result.success(reportService.getUserStatistics(begin,end));            <br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-ServiceÂ±ÇÊé•Âè£-1"><a href="#2-2-ServiceÂ±ÇÊé•Âè£-1" class="headerlink" title="2.2 ServiceÂ±ÇÊé•Âè£"></a>2.2 ServiceÂ±ÇÊé•Âè£</h3><p><strong>Âú®ReportServiceÊé•Âè£‰∏≠Â£∞ÊòégetUserStatisticsÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆÊó∂Èó¥Âå∫Èó¥ÁªüËÆ°Áî®Êà∑Êï∞Èáè</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   UserReportVO <span class="hljs-title function_">getUserStatistics</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-ServiceÂ±ÇÂÆûÁé∞Á±ª-1"><a href="#2-3-ServiceÂ±ÇÂÆûÁé∞Á±ª-1" class="headerlink" title="2.3 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>2.3 ServiceÂ±ÇÂÆûÁé∞Á±ª</h3><p><strong>Âú®ReportServiceImplÂÆûÁé∞Á±ª‰∏≠ÂÆûÁé∞getUserStatisticsÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> UserReportVO <span class="hljs-title function_">getUserStatistics</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span> &#123;<br>       List&lt;LocalDate&gt; dateList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>       dateList.add(begin);<br><br>       <span class="hljs-keyword">while</span> (!begin.equals(end))&#123;<br>           begin = begin.plusDays(<span class="hljs-number">1</span>);<br>           dateList.add(begin);<br>       &#125;<br>       List&lt;Integer&gt; newUserList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(); <span class="hljs-comment">//Êñ∞Â¢ûÁî®Êà∑Êï∞</span><br>       List&lt;Integer&gt; totalUserList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(); <span class="hljs-comment">//ÊÄªÁî®Êà∑Êï∞</span><br><br>       <span class="hljs-keyword">for</span> (LocalDate date : dateList) &#123;<br>           <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">beginTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MIN);<br>           <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MAX);<br>           <span class="hljs-comment">//Êñ∞Â¢ûÁî®Êà∑Êï∞Èáè select count(id) from user where create_time &gt; ? and create_time &lt; ?</span><br>           <span class="hljs-type">Integer</span> <span class="hljs-variable">newUser</span> <span class="hljs-operator">=</span> getUserCount(beginTime, endTime);<br>           <span class="hljs-comment">//ÊÄªÁî®Êà∑Êï∞Èáè select count(id) from user where  create_time &lt; ?</span><br>           <span class="hljs-type">Integer</span> <span class="hljs-variable">totalUser</span> <span class="hljs-operator">=</span> getUserCount(<span class="hljs-literal">null</span>, endTime);<br><br>           newUserList.add(newUser);<br>           totalUserList.add(totalUser);<br>       &#125;<br><br>       <span class="hljs-keyword">return</span> UserReportVO.builder()<br>               .dateList(StringUtils.join(dateList,<span class="hljs-string">&quot;,&quot;</span>))<br>               .newUserList(StringUtils.join(newUserList,<span class="hljs-string">&quot;,&quot;</span>))<br>               .totalUserList(StringUtils.join(totalUserList,<span class="hljs-string">&quot;,&quot;</span>))<br>               .build();<br>   &#125;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®ReportServiceImplÂÆûÁé∞Á±ª‰∏≠ÂàõÂª∫ÁßÅÊúâÊñπÊ≥ïgetUserCountÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆÊó∂Èó¥Âå∫Èó¥ÁªüËÆ°Áî®Êà∑Êï∞Èáè</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beginTime</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> endTime</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">private</span> Integer <span class="hljs-title function_">getUserCount</span><span class="hljs-params">(LocalDateTime beginTime, LocalDateTime endTime)</span> &#123;<br>       <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>       map.put(<span class="hljs-string">&quot;begin&quot;</span>,beginTime);<br>       map.put(<span class="hljs-string">&quot;end&quot;</span>, endTime);<br>       <span class="hljs-keyword">return</span> userMapper.countByMap(map);<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="2-4-MapperÂ±Ç-1"><a href="#2-4-MapperÂ±Ç-1" class="headerlink" title="2.4 MapperÂ±Ç"></a>2.4 MapperÂ±Ç</h3><p><strong>Âú®UserMapperÊé•Âè£‰∏≠Â£∞ÊòécountByMapÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Ê†πÊçÆÂä®ÊÄÅÊù°‰ª∂ÁªüËÆ°Áî®Êà∑Êï∞Èáè</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> map</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   Integer <span class="hljs-title function_">countByMap</span><span class="hljs-params">(Map map)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®UserMapper.xmlÊñá‰ª∂‰∏≠ÁºñÂÜôÂä®ÊÄÅSQLÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;select id=<span class="hljs-string">&quot;countByMap&quot;</span> resultType=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;<br>        select <span class="hljs-title function_">count</span><span class="hljs-params">(id)</span> from user<br>        &lt;where&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;begin != null&quot;</span>&gt;<br>                and create_time &amp;gt;= #&#123;begin&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;end != null&quot;</span>&gt;<br>                and create_time &amp;lt;= #&#123;end&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>        &lt;/where&gt;<br>&lt;/select&gt;<br></code></pre></td></tr></table></figure>


<h2 id="3-ËÆ¢ÂçïÁªüËÆ°"><a href="#3-ËÆ¢ÂçïÁªüËÆ°" class="headerlink" title="3. ËÆ¢ÂçïÁªüËÆ°"></a>3. ËÆ¢ÂçïÁªüËÆ°</h2><h3 id="3-1-ControllerÂ±Ç-4"><a href="#3-1-ControllerÂ±Ç-4" class="headerlink" title="3.1 ControllerÂ±Ç"></a>3.1 ControllerÂ±Ç</h3><p><strong>Âú®ReportController‰∏≠Ê†πÊçÆËÆ¢ÂçïÁªüËÆ°Êé•Âè£ÂàõÂª∫orderStatisticsÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ËÆ¢ÂçïÊï∞ÊçÆÁªüËÆ°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/ordersStatistics&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;Áî®Êà∑Êï∞ÊçÆÁªüËÆ°&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;OrderReportVO&gt; <span class="hljs-title function_">orderStatistics</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="hljs-params">                    LocalDate begin,</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="hljs-params">                    LocalDate end)</span>&#123;<br><br>        <span class="hljs-keyword">return</span> Result.success(reportService.getOrderStatistics(begin,end));<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-ServiceÂ±ÇÊé•Âè£-2"><a href="#3-2-ServiceÂ±ÇÊé•Âè£-2" class="headerlink" title="3.2 ServiceÂ±ÇÊé•Âè£"></a>3.2 ServiceÂ±ÇÊé•Âè£</h3><p><strong>Âú®ReportServiceÊé•Âè£‰∏≠Â£∞ÊòégetOrderStatisticsÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* Ê†πÊçÆÊó∂Èó¥Âå∫Èó¥ÁªüËÆ°ËÆ¢ÂçïÊï∞Èáè</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin </span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span> </span><br><span class="hljs-comment">*/</span><br>OrderReportVO <span class="hljs-title function_">getOrderStatistics</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>;<br></code></pre></td></tr></table></figure>


<h3 id="3-3-ServiceÂ±ÇÂÆûÁé∞Á±ª-2"><a href="#3-3-ServiceÂ±ÇÂÆûÁé∞Á±ª-2" class="headerlink" title="3.3 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>3.3 ServiceÂ±ÇÂÆûÁé∞Á±ª</h3><p><strong>Âú®ReportServiceImplÂÆûÁé∞Á±ª‰∏≠ÂÆûÁé∞getOrderStatisticsÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* Ê†πÊçÆÊó∂Èó¥Âå∫Èó¥ÁªüËÆ°ËÆ¢ÂçïÊï∞Èáè</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin </span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span> </span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> OrderReportVO <span class="hljs-title function_">getOrderStatistics</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>&#123;<br>	List&lt;LocalDate&gt; dateList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    dateList.add(begin);<br><br>    <span class="hljs-keyword">while</span> (!begin.equals(end))&#123;<br>          begin = begin.plusDays(<span class="hljs-number">1</span>);<br>          dateList.add(begin);<br>     &#125;<br>    <span class="hljs-comment">//ÊØèÂ§©ËÆ¢ÂçïÊÄªÊï∞ÈõÜÂêà</span><br>     List&lt;Integer&gt; orderCountList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-comment">//ÊØèÂ§©ÊúâÊïàËÆ¢ÂçïÊï∞ÈõÜÂêà</span><br>    List&lt;Integer&gt; validOrderCountList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (LocalDate date : dateList) &#123;<br>         <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">beginTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MIN);<br>         <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MAX);<br>   <span class="hljs-comment">//Êü•ËØ¢ÊØèÂ§©ÁöÑÊÄªËÆ¢ÂçïÊï∞ select count(id) from orders where order_time &gt; ? and order_time &lt; ?</span><br>         <span class="hljs-type">Integer</span> <span class="hljs-variable">orderCount</span> <span class="hljs-operator">=</span> getOrderCount(beginTime, endTime, <span class="hljs-literal">null</span>);<br><br>  <span class="hljs-comment">//Êü•ËØ¢ÊØèÂ§©ÁöÑÊúâÊïàËÆ¢ÂçïÊï∞ select count(id) from orders where order_time &gt; ? and order_time &lt; ? and status = ?</span><br>         <span class="hljs-type">Integer</span> <span class="hljs-variable">validOrderCount</span> <span class="hljs-operator">=</span> getOrderCount(beginTime, endTime, Orders.COMPLETED);<br><br>         orderCountList.add(orderCount);<br>         validOrderCountList.add(validOrderCount);<br>        &#125;<br><br>    <span class="hljs-comment">//Êó∂Èó¥Âå∫Èó¥ÂÜÖÁöÑÊÄªËÆ¢ÂçïÊï∞</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">totalOrderCount</span> <span class="hljs-operator">=</span> orderCountList.stream().reduce(Integer::sum).get();<br>    <span class="hljs-comment">//Êó∂Èó¥Âå∫Èó¥ÂÜÖÁöÑÊÄªÊúâÊïàËÆ¢ÂçïÊï∞</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">validOrderCount</span> <span class="hljs-operator">=</span> validOrderCountList.stream().reduce(Integer::sum).get();<br>    <span class="hljs-comment">//ËÆ¢ÂçïÂÆåÊàêÁéá</span><br>    <span class="hljs-type">Double</span> <span class="hljs-variable">orderCompletionRate</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>;<br>    <span class="hljs-keyword">if</span>(totalOrderCount != <span class="hljs-number">0</span>)&#123;<br>         orderCompletionRate = validOrderCount.doubleValue() / totalOrderCount;<br>     &#125;<br>    <span class="hljs-keyword">return</span> OrderReportVO.builder()<br>                .dateList(StringUtils.join(dateList, <span class="hljs-string">&quot;,&quot;</span>))<br>                .orderCountList(StringUtils.join(orderCountList, <span class="hljs-string">&quot;,&quot;</span>))<br>                .validOrderCountList(StringUtils.join(validOrderCountList, <span class="hljs-string">&quot;,&quot;</span>))<br>                .totalOrderCount(totalOrderCount)<br>                .validOrderCount(validOrderCount)<br>                .orderCompletionRate(orderCompletionRate)<br>                .build();<br>    <br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®ReportServiceImplÂÆûÁé∞Á±ª‰∏≠Êèê‰æõÁßÅÊúâÊñπÊ≥ïgetOrderCountÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* Ê†πÊçÆÊó∂Èó¥Âå∫Èó¥ÁªüËÆ°ÊåáÂÆöÁä∂ÊÄÅÁöÑËÆ¢ÂçïÊï∞Èáè</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> beginTime</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> endTime</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">private</span> Integer <span class="hljs-title function_">getOrderCount</span><span class="hljs-params">(LocalDateTime beginTime, LocalDateTime endTime, Integer status)</span> &#123;<br>	<span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>	map.put(<span class="hljs-string">&quot;status&quot;</span>, status);<br>	map.put(<span class="hljs-string">&quot;begin&quot;</span>,beginTime);<br>	map.put(<span class="hljs-string">&quot;end&quot;</span>, endTime);<br>	<span class="hljs-keyword">return</span> orderMapper.countByMap(map);<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="3-4-MapperÂ±Ç-1"><a href="#3-4-MapperÂ±Ç-1" class="headerlink" title="3.4 MapperÂ±Ç"></a>3.4 MapperÂ±Ç</h3><p><strong>Âú®OrderMapperÊé•Âè£‰∏≠Â£∞ÊòécountByMapÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*Ê†πÊçÆÂä®ÊÄÅÊù°‰ª∂ÁªüËÆ°ËÆ¢ÂçïÊï∞Èáè</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> map</span><br><span class="hljs-comment">*/</span><br>Integer <span class="hljs-title function_">countByMap</span><span class="hljs-params">(Map map)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®OrderMapper.xmlÊñá‰ª∂‰∏≠ÁºñÂÜôÂä®ÊÄÅSQLÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;select id=<span class="hljs-string">&quot;countByMap&quot;</span> resultType=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;<br>        select <span class="hljs-title function_">count</span><span class="hljs-params">(id)</span> from orders<br>        &lt;where&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;status != null&quot;</span>&gt;<br>                <span class="hljs-type">and</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> #&#123;status&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;begin != null&quot;</span>&gt;<br>                and order_time &amp;gt;= #&#123;begin&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;end != null&quot;</span>&gt;<br>                and order_time &amp;lt;= #&#123;end&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>        &lt;/where&gt;<br>&lt;/select&gt;<br></code></pre></td></tr></table></figure>


<h2 id="4-ÈîÄÈáèÊéíÂêçTop10"><a href="#4-ÈîÄÈáèÊéíÂêçTop10" class="headerlink" title="4. ÈîÄÈáèÊéíÂêçTop10"></a>4. ÈîÄÈáèÊéíÂêçTop10</h2><h3 id="4-1-ControllerÂ±Ç-1"><a href="#4-1-ControllerÂ±Ç-1" class="headerlink" title="4.1 ControllerÂ±Ç"></a>4.1 ControllerÂ±Ç</h3><p><strong>Âú®ReportController‰∏≠Ê†πÊçÆÈîÄÈáèÊéíÂêçÊé•Âè£ÂàõÂª∫top10ÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* ÈîÄÈáèÊéíÂêçÁªüËÆ°</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping(&quot;/top10&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÈîÄÈáèÊéíÂêçÁªüËÆ°&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;SalesTop10ReportVO&gt; <span class="hljs-title function_">top10</span><span class="hljs-params">(</span><br><span class="hljs-params">    <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span><br><span class="hljs-params">    <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span>&#123;<br>	<span class="hljs-keyword">return</span> Result.success(reportService.getSalesTop10(begin,end));<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-ServiceÂ±ÇÊé•Âè£"><a href="#4-2-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="4.2 ServiceÂ±ÇÊé•Âè£"></a>4.2 ServiceÂ±ÇÊé•Âè£</h3><p><strong>Âú®ReportServiceÊé•Âè£‰∏≠Â£∞ÊòégetSalesTop10ÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* Êü•ËØ¢ÊåáÂÆöÊó∂Èó¥Âå∫Èó¥ÂÜÖÁöÑÈîÄÈáèÊéíÂêçtop10 </span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>SalesTop10ReportVO <span class="hljs-title function_">getSalesTop10</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>;<br></code></pre></td></tr></table></figure>


<h3 id="4-3-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#4-3-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="4.3 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>4.3 ServiceÂ±ÇÂÆûÁé∞Á±ª</h3><p><strong>Âú®ReportServiceImplÂÆûÁé∞Á±ª‰∏≠ÂÆûÁé∞getSalesTop10ÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Êü•ËØ¢ÊåáÂÆöÊó∂Èó¥Âå∫Èó¥ÂÜÖÁöÑÈîÄÈáèÊéíÂêçtop10</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * */</span><br>    <span class="hljs-keyword">public</span> SalesTop10ReportVO <span class="hljs-title function_">getSalesTop10</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>&#123;<br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">beginTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(begin, LocalTime.MIN);<br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(end, LocalTime.MAX);<br>        List&lt;GoodsSalesDTO&gt; goodsSalesDTOList = orderMapper.getSalesTop10(beginTime, endTime);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">nameList</span> <span class="hljs-operator">=</span> StringUtils.join(goodsSalesDTOList.stream().map(GoodsSalesDTO::getName).collect(Collectors.toList()),<span class="hljs-string">&quot;,&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">numberList</span> <span class="hljs-operator">=</span> StringUtils.join(goodsSalesDTOList.stream().map(GoodsSalesDTO::getNumber).collect(Collectors.toList()),<span class="hljs-string">&quot;,&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> SalesTop10ReportVO.builder()<br>                .nameList(nameList)<br>                .numberList(numberList)<br>                .build();<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-MapperÂ±Ç"><a href="#4-4-MapperÂ±Ç" class="headerlink" title="4.4 MapperÂ±Ç"></a>4.4 MapperÂ±Ç</h3><p><strong>Âú®OrderMapperÊé•Âè£‰∏≠Â£∞ÊòégetSalesTop10ÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* Êü•ËØ¢ÂïÜÂìÅÈîÄÈáèÊéíÂêç</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">*/</span><br>List&lt;GoodsSalesDTO&gt; <span class="hljs-title function_">getSalesTop10</span><span class="hljs-params">(LocalDateTime begin, LocalDateTime end)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Âú®OrderMapper.xmlÊñá‰ª∂‰∏≠ÁºñÂÜôÂä®ÊÄÅSQLÔºö</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getSalesTop10&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sky.dto.GoodsSalesDTO&quot;</span>&gt;</span><br>        select od.name name,sum(od.number) number from order_detail od ,orders o<br>        where od.order_id = o.id<br>            and o.status = 5<br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;begin != null&quot;</span>&gt;</span><br>                and order_time <span class="hljs-symbol">&amp;gt;</span>= #&#123;begin&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;end != null&quot;</span>&gt;</span><br>                and order_time <span class="hljs-symbol">&amp;lt;</span>= #&#123;end&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        group by name<br>        order by number desc<br>        limit 0, 10<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h1 id="ÂçÅÂÖ´-Apache-POI-Âíå-ÂØºÂá∫ËøêËê•Êï∞ÊçÆ"><a href="#ÂçÅÂÖ´-Apache-POI-Âíå-ÂØºÂá∫ËøêËê•Êï∞ÊçÆ" class="headerlink" title="ÂçÅÂÖ´. Apache POI Âíå ÂØºÂá∫ËøêËê•Êï∞ÊçÆ"></a>ÂçÅÂÖ´. Apache POI Âíå ÂØºÂá∫ËøêËê•Êï∞ÊçÆ</h1><h2 id="1-Apache-POI"><a href="#1-Apache-POI" class="headerlink" title="1. Apache POI"></a>1. Apache POI</h2><p>‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÔºåPOI ÈÉΩÊòØÁî®‰∫éÊìç‰Ωú Excel Êñá‰ª∂„ÄÇ</p>
<h3 id="1-1-Â∞ÜÊï∞ÊçÆÂÜôÂÖ•ExcelÊñá‰ª∂"><a href="#1-1-Â∞ÜÊï∞ÊçÆÂÜôÂÖ•ExcelÊñá‰ª∂" class="headerlink" title="1.1 Â∞ÜÊï∞ÊçÆÂÜôÂÖ•ExcelÊñá‰ª∂"></a>1.1 Â∞ÜÊï∞ÊçÆÂÜôÂÖ•ExcelÊñá‰ª∂</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.test;<br><br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFCell;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFRow;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">POITest</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Âü∫‰∫éPOIÂêëExcelÊñá‰ª∂ÂÜôÂÖ•Êï∞ÊçÆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">//Âú®ÂÜÖÂ≠ò‰∏≠ÂàõÂª∫‰∏Ä‰∏™ExcelÊñá‰ª∂ÂØπË±°</span><br>        <span class="hljs-type">XSSFWorkbook</span> <span class="hljs-variable">excel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XSSFWorkbook</span>();<br>        <span class="hljs-comment">//ÂàõÂª∫SheetÈ°µ</span><br>        <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> excel.createSheet(<span class="hljs-string">&quot;itcast&quot;</span>);<br><br>        <span class="hljs-comment">//Âú®SheetÈ°µ‰∏≠ÂàõÂª∫Ë°åÔºå0Ë°®Á§∫Á¨¨1Ë°å</span><br>        <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">row1</span> <span class="hljs-operator">=</span> sheet.createRow(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">//ÂàõÂª∫ÂçïÂÖÉÊ†ºÂπ∂Âú®ÂçïÂÖÉÊ†º‰∏≠ËÆæÁΩÆÂÄºÔºåÂçïÂÖÉÊ†ºÁºñÂè∑‰πüÊòØ‰ªé0ÂºÄÂßãÔºå1Ë°®Á§∫Á¨¨2‰∏™ÂçïÂÖÉÊ†º</span><br>        row1.createCell(<span class="hljs-number">1</span>).setCellValue(<span class="hljs-string">&quot;ÂßìÂêç&quot;</span>);<br>        row1.createCell(<span class="hljs-number">2</span>).setCellValue(<span class="hljs-string">&quot;ÂüéÂ∏Ç&quot;</span>);<br><br>        <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">row2</span> <span class="hljs-operator">=</span> sheet.createRow(<span class="hljs-number">1</span>);<br>        row2.createCell(<span class="hljs-number">1</span>).setCellValue(<span class="hljs-string">&quot;Âº†‰∏â&quot;</span>);<br>        row2.createCell(<span class="hljs-number">2</span>).setCellValue(<span class="hljs-string">&quot;Âåó‰∫¨&quot;</span>);<br><br>        <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">row3</span> <span class="hljs-operator">=</span> sheet.createRow(<span class="hljs-number">2</span>);<br>        row3.createCell(<span class="hljs-number">1</span>).setCellValue(<span class="hljs-string">&quot;ÊùéÂõõ&quot;</span>);<br>        row3.createCell(<span class="hljs-number">2</span>).setCellValue(<span class="hljs-string">&quot;‰∏äÊµ∑&quot;</span>);<br><br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;D:\\itcast.xlsx&quot;</span>));<br>        <span class="hljs-comment">//ÈÄöËøáËæìÂá∫ÊµÅÂ∞ÜÂÜÖÂ≠ò‰∏≠ÁöÑExcelÊñá‰ª∂ÂÜôÂÖ•Âà∞Á£ÅÁõò‰∏ä</span><br>        excel.write(out);<br><br>        <span class="hljs-comment">//ÂÖ≥Èó≠ËµÑÊ∫ê</span><br>        out.flush();<br>        out.close();<br>        excel.close();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        write();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-ËØªÂèñExcelÊñá‰ª∂‰∏≠ÁöÑÊï∞ÊçÆ"><a href="#1-2-ËØªÂèñExcelÊñá‰ª∂‰∏≠ÁöÑÊï∞ÊçÆ" class="headerlink" title="1.2 ËØªÂèñExcelÊñá‰ª∂‰∏≠ÁöÑÊï∞ÊçÆ"></a>1.2 ËØªÂèñExcelÊñá‰ª∂‰∏≠ÁöÑÊï∞ÊçÆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.test;<br><br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFCell;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFRow;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">POITest</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Âü∫‰∫éPOIËØªÂèñExcelÊñá‰ª∂</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">read</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;D:\\itcast.xlsx&quot;</span>));<br>        <span class="hljs-comment">//ÈÄöËøáËæìÂÖ•ÊµÅËØªÂèñÊåáÂÆöÁöÑExcelÊñá‰ª∂</span><br>        <span class="hljs-type">XSSFWorkbook</span> <span class="hljs-variable">excel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XSSFWorkbook</span>(in);<br>        <span class="hljs-comment">//Ëé∑ÂèñExcelÊñá‰ª∂ÁöÑÁ¨¨1‰∏™SheetÈ°µ</span><br>        <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> excel.getSheetAt(<span class="hljs-number">0</span>);<br><br>        <span class="hljs-comment">//Ëé∑ÂèñSheetÈ°µ‰∏≠ÁöÑÊúÄÂêé‰∏ÄË°åÁöÑË°åÂè∑</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">lastRowNum</span> <span class="hljs-operator">=</span> sheet.getLastRowNum();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt;= lastRowNum; i++) &#123;<br>            <span class="hljs-comment">//Ëé∑ÂèñSheetÈ°µ‰∏≠ÁöÑË°å</span><br>            <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">titleRow</span> <span class="hljs-operator">=</span> sheet.getRow(i);<br>            <span class="hljs-comment">//Ëé∑ÂèñË°åÁöÑÁ¨¨2‰∏™ÂçïÂÖÉÊ†º</span><br>            <span class="hljs-type">XSSFCell</span> <span class="hljs-variable">cell1</span> <span class="hljs-operator">=</span> titleRow.getCell(<span class="hljs-number">1</span>);<br>            <span class="hljs-comment">//Ëé∑ÂèñÂçïÂÖÉÊ†º‰∏≠ÁöÑÊñáÊú¨ÂÜÖÂÆπ</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">cellValue1</span> <span class="hljs-operator">=</span> cell1.getStringCellValue();<br>            <span class="hljs-comment">//Ëé∑ÂèñË°åÁöÑÁ¨¨3‰∏™ÂçïÂÖÉÊ†º</span><br>            <span class="hljs-type">XSSFCell</span> <span class="hljs-variable">cell2</span> <span class="hljs-operator">=</span> titleRow.getCell(<span class="hljs-number">2</span>);<br>            <span class="hljs-comment">//Ëé∑ÂèñÂçïÂÖÉÊ†º‰∏≠ÁöÑÊñáÊú¨ÂÜÖÂÆπ</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">cellValue2</span> <span class="hljs-operator">=</span> cell2.getStringCellValue();<br><br>            System.out.println(cellValue1 + <span class="hljs-string">&quot; &quot;</span> +cellValue2);<br>        &#125;<br><br>        <span class="hljs-comment">//ÂÖ≥Èó≠ËµÑÊ∫ê</span><br>        in.close();<br>        excel.close();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        read();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="2-ÂØºÂá∫ËøêËê•Êï∞ÊçÆExcelÊä•Ë°®"><a href="#2-ÂØºÂá∫ËøêËê•Êï∞ÊçÆExcelÊä•Ë°®" class="headerlink" title="2. ÂØºÂá∫ËøêËê•Êï∞ÊçÆExcelÊä•Ë°®"></a>2. ÂØºÂá∫ËøêËê•Êï∞ÊçÆExcelÊä•Ë°®</h2><h3 id="2-1-ÂÆûÁé∞Ê≠•È™§"><a href="#2-1-ÂÆûÁé∞Ê≠•È™§" class="headerlink" title="2.1 ÂÆûÁé∞Ê≠•È™§"></a>2.1 ÂÆûÁé∞Ê≠•È™§</h3><ol>
<li>ËÆæËÆ°ExcelÊ®°ÊùøÊñá‰ª∂</li>
<li>Êü•ËØ¢Ëøë30Â§©ÁöÑËøêËê•Êï∞ÊçÆ</li>
<li>Â∞ÜÊü•ËØ¢Âà∞ÁöÑËøêËê•Êï∞ÊçÆÂÜôÂÖ•Ê®°ÊùøÊñá‰ª∂</li>
<li>ÈÄöËøáËæìÂá∫ÊµÅÂ∞ÜExcelÊñá‰ª∂‰∏ãËΩΩÂà∞ÂÆ¢Êà∑Á´ØÊµèËßàÂô®</li>
</ol>
<h3 id="2-2-ControllerÂ±Ç-1"><a href="#2-2-ControllerÂ±Ç-1" class="headerlink" title="2.2 ControllerÂ±Ç"></a>2.2 ControllerÂ±Ç</h3><p><strong>Ê†πÊçÆÊé•Âè£ÂÆö‰πâÔºåÂú®ReportController‰∏≠ÂàõÂª∫exportÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂØºÂá∫ËøêËê•Êï∞ÊçÆÊä•Ë°®</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/export&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;ÂØºÂá∫ËøêËê•Êï∞ÊçÆÊä•Ë°®&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">export</span><span class="hljs-params">(HttpServletResponse response)</span>&#123;<br>    reportService.exportBusinessData(response);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-ServiceÂ±ÇÊé•Âè£"><a href="#2-3-ServiceÂ±ÇÊé•Âè£" class="headerlink" title="2.3 ServiceÂ±ÇÊé•Âè£"></a>2.3 ServiceÂ±ÇÊé•Âè£</h3><p><strong>Âú®ReportServiceÊé•Âè£‰∏≠Â£∞ÊòéÂØºÂá∫ËøêËê•Êï∞ÊçÆÊä•Ë°®ÁöÑÊñπÊ≥ïÔºö</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ÂØºÂá∫Ëøë30Â§©ÁöÑËøêËê•Êï∞ÊçÆÊä•Ë°®</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">exportBusinessData</span><span class="hljs-params">(HttpServletResponse response)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-ServiceÂ±ÇÂÆûÁé∞Á±ª"><a href="#2-4-ServiceÂ±ÇÂÆûÁé∞Á±ª" class="headerlink" title="2.4 ServiceÂ±ÇÂÆûÁé∞Á±ª"></a>2.4 ServiceÂ±ÇÂÆûÁé∞Á±ª</h3><p><strong>Âú®ReportServiceImplÂÆûÁé∞Á±ª‰∏≠ÂÆûÁé∞ÂØºÂá∫ËøêËê•Êï∞ÊçÆÊä•Ë°®ÁöÑÊñπÊ≥ï:</strong></p>
<p>ÊèêÂâçÂ∞ÜËµÑÊñô‰∏≠ÁöÑ<strong>ËøêËê•Êï∞ÊçÆÊä•Ë°®Ê®°Êùø.xlsx</strong>Êã∑Ë¥ùÂà∞È°πÁõÆÁöÑresources&#x2F;templateÁõÆÂΩï‰∏≠</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**ÂØºÂá∫Ëøë30Â§©ÁöÑËøêËê•Êï∞ÊçÆÊä•Ë°®</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exportBusinessData</span><span class="hljs-params">(HttpServletResponse response)</span> &#123;<br>    <span class="hljs-type">LocalDate</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> LocalDate.now().minusDays(<span class="hljs-number">30</span>);<br>    <span class="hljs-type">LocalDate</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> LocalDate.now().minusDays(<span class="hljs-number">1</span>);<br>    <span class="hljs-comment">//Êü•ËØ¢Ê¶ÇËßàËøêËê•Êï∞ÊçÆÔºåÊèê‰æõÁªôExcelÊ®°ÊùøÊñá‰ª∂</span><br>    <span class="hljs-type">BusinessDataVO</span> <span class="hljs-variable">businessData</span> <span class="hljs-operator">=</span> workspaceService.getBusinessData(LocalDateTime.of(begin,LocalTime.MIN), LocalDateTime.of(end, LocalTime.MAX));<br>    <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;template/ËøêËê•Êï∞ÊçÆÊä•Ë°®Ê®°Êùø.xlsx&quot;</span>);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//Âü∫‰∫éÊèê‰æõÂ•ΩÁöÑÊ®°ÊùøÊñá‰ª∂ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑExcelË°®Ê†ºÂØπË±°</span><br>        <span class="hljs-type">XSSFWorkbook</span> <span class="hljs-variable">excel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XSSFWorkbook</span>(inputStream);<br>        <span class="hljs-comment">//Ëé∑ÂæóExcelÊñá‰ª∂‰∏≠ÁöÑ‰∏Ä‰∏™SheetÈ°µ</span><br>        <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> excel.getSheet(<span class="hljs-string">&quot;Sheet1&quot;</span>);<br><br>        sheet.getRow(<span class="hljs-number">1</span>).getCell(<span class="hljs-number">1</span>).setCellValue(begin + <span class="hljs-string">&quot;Ëá≥&quot;</span> + end);<br>        <span class="hljs-comment">//Ëé∑ÂæóÁ¨¨4Ë°å</span><br>        <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> sheet.getRow(<span class="hljs-number">3</span>);<br>        <span class="hljs-comment">//Ëé∑ÂèñÂçïÂÖÉÊ†º</span><br>        row.getCell(<span class="hljs-number">2</span>).setCellValue(businessData.getTurnover());<br>        row.getCell(<span class="hljs-number">4</span>).setCellValue(businessData.getOrderCompletionRate());<br>        row.getCell(<span class="hljs-number">6</span>).setCellValue(businessData.getNewUsers());<br>        row = sheet.getRow(<span class="hljs-number">4</span>);<br>        row.getCell(<span class="hljs-number">2</span>).setCellValue(businessData.getValidOrderCount());<br>        row.getCell(<span class="hljs-number">4</span>).setCellValue(businessData.getUnitPrice());<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) &#123;<br>            <span class="hljs-type">LocalDate</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> begin.plusDays(i);<br>           <span class="hljs-comment">//ÂáÜÂ§áÊòéÁªÜÊï∞ÊçÆ</span><br>            businessData = workspaceService.getBusinessData(LocalDateTime.of(date,LocalTime.MIN), LocalDateTime.of(date, LocalTime.MAX));<br>            row = sheet.getRow(<span class="hljs-number">7</span> + i);<br>            row.getCell(<span class="hljs-number">1</span>).setCellValue(date.toString());<br>            row.getCell(<span class="hljs-number">2</span>).setCellValue(businessData.getTurnover());<br>            row.getCell(<span class="hljs-number">3</span>).setCellValue(businessData.getValidOrderCount());<br>            row.getCell(<span class="hljs-number">4</span>).setCellValue(businessData.getOrderCompletionRate());<br>            row.getCell(<span class="hljs-number">5</span>).setCellValue(businessData.getUnitPrice());<br>            row.getCell(<span class="hljs-number">6</span>).setCellValue(businessData.getNewUsers());<br>        &#125;<br>        <span class="hljs-comment">//ÈÄöËøáËæìÂá∫ÊµÅÂ∞ÜÊñá‰ª∂‰∏ãËΩΩÂà∞ÂÆ¢Êà∑Á´ØÊµèËßàÂô®‰∏≠</span><br>        <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> response.getOutputStream();<br>        excel.write(out);<br>        <span class="hljs-comment">//ÂÖ≥Èó≠ËµÑÊ∫ê</span><br>        out.flush();<br>        out.close();<br>        excel.close();<br><br>    &#125;<span class="hljs-keyword">catch</span> (IOException e)&#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/JAVA/" class="category-chain-item">JAVA</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/JAVA/" class="print-no-link">#JAVA</a>
      
        <a href="/tags/javase/" class="print-no-link">#javase</a>
      
        <a href="/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/" class="print-no-link">#ËãçÁ©πÂ§ñÂçñ</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/03/05/JAVA/SpringCloud/MybatisPlus/" title="MybatisPlusÂ≠¶‰π†Á¨îËÆ∞">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MybatisPlusÂ≠¶‰π†Á¨îËÆ∞</span>
                        <span class="visible-mobile">‰∏ä‰∏ÄÁØá</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/03/03/JAVA/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96DebugAndResolve/" title="ËãçÁ©πÂ§ñÂçñËÆ¢ÂçïÊîØ‰ªòË∑≥ËøáÂæÆ‰ø°ÊîØ‰ªòÂèäËß£ÂÜ≥ÂêéÁª≠ËÆ¢ÂçïÂèñÊ∂à„ÄÅÊãíÂçïÁ≠âÈóÆÈ¢ò">
                        <span class="hidden-mobile">ËãçÁ©πÂ§ñÂçñËÆ¢ÂçïÊîØ‰ªòË∑≥ËøáÂæÆ‰ø°ÊîØ‰ªòÂèäËß£ÂÜ≥ÂêéÁª≠ËÆ¢ÂçïÂèñÊ∂à„ÄÅÊãíÂçïÁ≠âÈóÆÈ¢ò</span>
                        <span class="visible-mobile">‰∏ã‰∏ÄÁØá</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"sj2tGuxMGSDhkN5hNuOIVta1-gzGzoHsz","appKey":"ysR5OTuTzoby2oNvNyGOtXFQ","path":"window.location.pathname","placeholder":"Â¶ÇÊúâÈóÆÈ¢òÔºåÊ¨¢ËøéÊåáÊ≠£~","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ÁõÆÂΩï</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">ÊêúÁ¥¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">ÂÖ≥ÈîÆËØç</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <span>AI</span> <i class="iconfont icon-love"></i> <span>CPP</span> <i class="iconfont icon-love"></i> <span>JAVA</span> <i class="iconfont icon-love"></i> <span>CyberSec</span> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        ÊÄªËÆøÈóÆÈáè 
        <span id="busuanzi_value_site_pv"></span>
         Ê¨°
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        ÊÄªËÆøÂÆ¢Êï∞ 
        <span id="busuanzi_value_site_uv"></span>
         ‰∫∫
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/love.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiaoxingxing.js"></script>
<script src="/js/bubble.js"></script>



<!-- ‰∏ªÈ¢òÁöÑÂêØÂä®È°πÔºåÂ∞ÜÂÆÉ‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">ÂçöÂÆ¢Âú®ÂÖÅËÆ∏ JavaScript ËøêË°åÁöÑÁéØÂ¢É‰∏ãÊµèËßàÊïàÊûúÊõ¥‰Ω≥</div>
  </noscript>
</body>
</html>
