

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/about/dogs.jpg">
  <link rel="icon" href="/img/about/dogs.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="ranzier">
  <meta name="keywords" content="">
  
    <meta name="description" content="è‹ç©¹å¤–å–å­¦ä¹ ç¬”è®°  ä¸€. é¡¹ç›®æ¦‚è¿°ã€ç¯å¢ƒæ­å»º1. è½¯ä»¶å¼€å‘æ•´ä½“æµç¨‹ éœ€æ±‚åˆ†æ: éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ã€äº§å“åŸå‹ è®¾è®¡: UIè®¾è®¡ã€æ•°æ®åº“è®¾è®¡ã€æ¥å£è®¾è®¡ ç¼–ç : é¡¹ç›®ä»£ç ã€å•å…ƒæµ‹è¯• æµ‹è¯•: æµ‹è¯•ç”¨ä¾‹ã€æµ‹è¯•æŠ¥å‘Š ä¸Šçº¿è¿ç»´: è½¯ä»¶ç¯å¢ƒå®‰è£…ã€é…ç½®  2. æŠ€æœ¯é€‰å‹é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ¡†æ¶å’Œä¸­é—´ä»¶ 3. å¼€å‘ç¯å¢ƒæ­å»º3.1 å‰ç«¯ç¯å¢ƒæ­å»º(nginx)å‰ç«¯æˆ‘ä»¬å°±ä¸è‡ªå·±å†™ä»£ç äº†ç›´æ¥æ‰“å¼€nginx.exeè¿è¡Œï¼Œæ‰“å¼€loc">
<meta property="og:type" content="article">
<meta property="og:title" content="è‹ç©¹å¤–å–å­¦ä¹ ç¬”è®°(è·³è¿‡å¾®ä¿¡æ”¯ä»˜)">
<meta property="og:url" content="http://example.com/2025/03/03/JAVA/CangqiongTakeout/index.html">
<meta property="og:site_name" content="RANZIER">
<meta property="og:description" content="è‹ç©¹å¤–å–å­¦ä¹ ç¬”è®°  ä¸€. é¡¹ç›®æ¦‚è¿°ã€ç¯å¢ƒæ­å»º1. è½¯ä»¶å¼€å‘æ•´ä½“æµç¨‹ éœ€æ±‚åˆ†æ: éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ã€äº§å“åŸå‹ è®¾è®¡: UIè®¾è®¡ã€æ•°æ®åº“è®¾è®¡ã€æ¥å£è®¾è®¡ ç¼–ç : é¡¹ç›®ä»£ç ã€å•å…ƒæµ‹è¯• æµ‹è¯•: æµ‹è¯•ç”¨ä¾‹ã€æµ‹è¯•æŠ¥å‘Š ä¸Šçº¿è¿ç»´: è½¯ä»¶ç¯å¢ƒå®‰è£…ã€é…ç½®  2. æŠ€æœ¯é€‰å‹é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ¡†æ¶å’Œä¸­é—´ä»¶ 3. å¼€å‘ç¯å¢ƒæ­å»º3.1 å‰ç«¯ç¯å¢ƒæ­å»º(nginx)å‰ç«¯æˆ‘ä»¬å°±ä¸è‡ªå·±å†™ä»£ç äº†ç›´æ¥æ‰“å¼€nginx.exeè¿è¡Œï¼Œæ‰“å¼€loc">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/bg/27.jpg">
<meta property="article:published_time" content="2025-03-03T09:12:02.000Z">
<meta property="article:modified_time" content="2025-10-14T03:13:05.006Z">
<meta property="article:author" content="ranzier">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="javase">
<meta property="article:tag" content="è‹ç©¹å¤–å–">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/bg/27.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>è‹ç©¹å¤–å–å­¦ä¹ ç¬”è®°(è·³è¿‡å¾®ä¿¡æ”¯ä»˜) - RANZIER</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3846514_kabxni94auf.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/gundongtiao.css">
<link rel="stylesheet" href="/css/bubble.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"ğŸŒŸ","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>RANZIER</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bg/3.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.35)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="è‹ç©¹å¤–å–å­¦ä¹ ç¬”è®°(è·³è¿‡å¾®ä¿¡æ”¯ä»˜)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-03-03 17:12" pubdate>
          2025å¹´3æœˆ3æ—¥ ä¸‹åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          22k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          112 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          æœ¬æ–‡é˜…è¯»æ¬¡æ•°ï¼š<span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        

      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">è‹ç©¹å¤–å–å­¦ä¹ ç¬”è®°(è·³è¿‡å¾®ä¿¡æ”¯ä»˜)</h1>
            
            
              <div class="markdown-body">
                
                <h1 align="center">è‹ç©¹å¤–å–å­¦ä¹ ç¬”è®°</h1>

<h1 id="ä¸€-é¡¹ç›®æ¦‚è¿°ã€ç¯å¢ƒæ­å»º"><a href="#ä¸€-é¡¹ç›®æ¦‚è¿°ã€ç¯å¢ƒæ­å»º" class="headerlink" title="ä¸€. é¡¹ç›®æ¦‚è¿°ã€ç¯å¢ƒæ­å»º"></a>ä¸€. é¡¹ç›®æ¦‚è¿°ã€ç¯å¢ƒæ­å»º</h1><h2 id="1-è½¯ä»¶å¼€å‘æ•´ä½“æµç¨‹"><a href="#1-è½¯ä»¶å¼€å‘æ•´ä½“æµç¨‹" class="headerlink" title="1. è½¯ä»¶å¼€å‘æ•´ä½“æµç¨‹"></a>1. è½¯ä»¶å¼€å‘æ•´ä½“æµç¨‹</h2><ol>
<li><strong>éœ€æ±‚åˆ†æ</strong>: éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ã€äº§å“åŸå‹</li>
<li><strong>è®¾è®¡</strong>: UIè®¾è®¡ã€æ•°æ®åº“è®¾è®¡ã€æ¥å£è®¾è®¡</li>
<li><strong>ç¼–ç </strong>: é¡¹ç›®ä»£ç ã€å•å…ƒæµ‹è¯•</li>
<li><strong>æµ‹è¯•</strong>: æµ‹è¯•ç”¨ä¾‹ã€æµ‹è¯•æŠ¥å‘Š</li>
<li><strong>ä¸Šçº¿è¿ç»´</strong>: è½¯ä»¶ç¯å¢ƒå®‰è£…ã€é…ç½®</li>
</ol>
<h2 id="2-æŠ€æœ¯é€‰å‹"><a href="#2-æŠ€æœ¯é€‰å‹" class="headerlink" title="2. æŠ€æœ¯é€‰å‹"></a>2. æŠ€æœ¯é€‰å‹</h2><p>é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ¡†æ¶å’Œä¸­é—´ä»¶<br><img src="/img/blogs/java/cangqiongtakeout/1.2.1.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="3-å¼€å‘ç¯å¢ƒæ­å»º"><a href="#3-å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="3. å¼€å‘ç¯å¢ƒæ­å»º"></a>3. å¼€å‘ç¯å¢ƒæ­å»º</h2><h3 id="3-1-å‰ç«¯ç¯å¢ƒæ­å»º-nginx"><a href="#3-1-å‰ç«¯ç¯å¢ƒæ­å»º-nginx" class="headerlink" title="3.1 å‰ç«¯ç¯å¢ƒæ­å»º(nginx)"></a>3.1 å‰ç«¯ç¯å¢ƒæ­å»º(nginx)</h3><p>å‰ç«¯æˆ‘ä»¬å°±ä¸è‡ªå·±å†™ä»£ç äº†<br>ç›´æ¥æ‰“å¼€<strong>nginx.exe</strong>è¿è¡Œï¼Œæ‰“å¼€<code>localhost:80</code>ç«¯å£è®¿é—®å‰ç«¯é¡µé¢</p>
<h3 id="3-2-åç«¯ç¯å¢ƒæ­å»º"><a href="#3-2-åç«¯ç¯å¢ƒæ­å»º" class="headerlink" title="3.2 åç«¯ç¯å¢ƒæ­å»º"></a>3.2 åç«¯ç¯å¢ƒæ­å»º</h3><h4 id="3-2-1-ç†Ÿæ‚‰é¡¹ç›®ç»“æ„"><a href="#3-2-1-ç†Ÿæ‚‰é¡¹ç›®ç»“æ„" class="headerlink" title="3.2.1 ç†Ÿæ‚‰é¡¹ç›®ç»“æ„"></a>3.2.1 ç†Ÿæ‚‰é¡¹ç›®ç»“æ„</h4><ul>
<li>åç«¯å·¥ç¨‹åŸºäº<strong>maven</strong>è¿›è¡Œé¡¹ç›®æ„å»ºï¼Œå¹¶ä¸”è¿›è¡Œ<strong>åˆ†æ¨¡å—</strong>å¼€å‘</li>
<li>ç”¨ideaæ‰“å¼€<code>sky-take-out</code>å·¥ç¨‹</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.1.png" srcset="/img/loading.gif" lazyload></p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>åç§°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>sky-take-out</td>
<td>mavençˆ¶å·¥ç¨‹ï¼Œç»Ÿä¸€ç®¡ç†ä¾èµ–ç‰ˆæœ¬ï¼Œèšåˆå…¶ä»–å­æ¨¡å—</td>
</tr>
<tr>
<td>2</td>
<td>sky-common</td>
<td>å­æ¨¡å—ï¼Œå­˜æ”¾å…¬å…±ç±»ï¼Œä¾‹å¦‚ï¼šå·¥å…·ç±»ã€å¸¸é‡ç±»ã€å¼‚å¸¸ç±»ç­‰</td>
</tr>
<tr>
<td>3</td>
<td>sky-pojo</td>
<td>å­æ¨¡å—ï¼Œå­˜æ”¾å®ä½“ç±»ã€VOã€DTOç­‰</td>
</tr>
<tr>
<td>4</td>
<td>sky-server</td>
<td>å­æ¨¡å—ï¼Œåç«¯æœåŠ¡ï¼Œå­˜æ”¾é…ç½®æ–‡ä»¶ã€Controllerã€Serviceã€Mapperç­‰</td>
</tr>
</tbody></table>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.2.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.3.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.4.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="3-2-2-ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶"><a href="#3-2-2-ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="3.2.2 ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶"></a>3.2.2 ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_68356693/article/details/145806694?spm=1001.2014.3001.5501">Gitå­¦ä¹ ç¬”è®°</a></p>
<h5 id="3-2-2-1-åˆ›å»ºæœ¬åœ°ä»“åº“"><a href="#3-2-2-1-åˆ›å»ºæœ¬åœ°ä»“åº“" class="headerlink" title="3.2.2.1 åˆ›å»ºæœ¬åœ°ä»“åº“"></a>3.2.2.1 åˆ›å»ºæœ¬åœ°ä»“åº“</h5><ul>
<li>ç‚¹å‡»èœå•-VCS-Create Git Repository-æ‰¾åˆ°å½“å‰é¡¹ç›®ç›®å½•-ç‚¹å‡»OK</li>
<li>å°†æœ¬åœ°æ–‡ä»¶å…¨éƒ¨æäº¤åˆ°æœ¬åœ°ä»“åº“(commit)</li>
</ul>
<h5 id="3-2-2-2-åˆ›å»ºè¿œç¨‹ä»“åº“"><a href="#3-2-2-2-åˆ›å»ºè¿œç¨‹ä»“åº“" class="headerlink" title="3.2.2.2 åˆ›å»ºè¿œç¨‹ä»“åº“"></a>3.2.2.2 åˆ›å»ºè¿œç¨‹ä»“åº“</h5><p>æ‰“å¼€Giteeï¼Œç‚¹å‡»åŠ å·åˆ›å»ºè¿œç¨‹ä»“åº“</p>
<h5 id="3-2-2-3-å°†æœ¬åœ°æ–‡ä»¶æ¨é€åˆ°Gitè¿œç¨‹ä»“åº“"><a href="#3-2-2-3-å°†æœ¬åœ°æ–‡ä»¶æ¨é€åˆ°Gitè¿œç¨‹ä»“åº“" class="headerlink" title="3.2.2.3 å°†æœ¬åœ°æ–‡ä»¶æ¨é€åˆ°Gitè¿œç¨‹ä»“åº“"></a>3.2.2.3 å°†æœ¬åœ°æ–‡ä»¶æ¨é€åˆ°Gitè¿œç¨‹ä»“åº“</h5><p>ç‚¹å‡»push,è¾“å…¥è¿œç¨‹ä»“åº“urlï¼Œè¾“å…¥è´¦å·å¯†ç ï¼ŒæˆåŠŸpush</p>
<h4 id="3-2-3-æ•°æ®åº“ç¯å¢ƒæ­å»º"><a href="#3-2-3-æ•°æ®åº“ç¯å¢ƒæ­å»º" class="headerlink" title="3.2.3 æ•°æ®åº“ç¯å¢ƒæ­å»º"></a>3.2.3 æ•°æ®åº“ç¯å¢ƒæ­å»º</h4><p>è®°å¾—åœ¨å‘½ä»¤è¡Œä¸­æ‰“å¼€mysqlè¿æ¥ï¼š<code>net start mysql</code><br>åœ¨navicatæ‰“å¼€sqlæ–‡ä»¶ï¼Œè¿è¡Œåˆ›å»ºæ•°æ®åº“å†…å®¹<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/tkf021004/article/details/136098343">navicatè¿è¡Œsqlæ–‡ä»¶</a></p>
<h4 id="3-2-4-å‰åç«¯è”è°ƒ"><a href="#3-2-4-å‰åç«¯è”è°ƒ" class="headerlink" title="3.2.4 å‰åç«¯è”è°ƒ"></a>3.2.4 å‰åç«¯è”è°ƒ</h4><p><img src="/img/blogs/java/cangqiongtakeout/1.3.5.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>nginxåå‘ä»£ç†</strong>:å°±æ˜¯å°†å‰ç«¯å‘é€çš„åŠ¨æ€è¯·æ±‚ç”±nginxè½¬å‘åˆ°åç«¯æœåŠ¡å™¨</p>
<p><img src="/img/blogs/java/cangqiongtakeout/1.3.6.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-3-å®Œå–„ç™»å½•åŠŸèƒ½"><a href="#3-3-å®Œå–„ç™»å½•åŠŸèƒ½" class="headerlink" title="3.3 å®Œå–„ç™»å½•åŠŸèƒ½"></a>3.3 å®Œå–„ç™»å½•åŠŸèƒ½</h3><p>ä½¿ç”¨md5åŠ å¯†ç®—æ³•å°†æ˜æ–‡123456åŠ å¯†:<code>e10adc3949ba59abbe56e057f20f883e</code></p>
<ul>
<li>æ•°æ®åº“ä¸­ä¿®æ”¹ç®¡ç†å‘˜å¯†ç </li>
<li>javaä»£ç ä¿®æ”¹å¯†ç </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">password = DigestUtils.md5DigestAsHex(password.getBytes());<br></code></pre></td></tr></table></figure>

<h2 id="4-å¯¼å…¥æ¥å£æ–‡æ¡£"><a href="#4-å¯¼å…¥æ¥å£æ–‡æ¡£" class="headerlink" title="4. å¯¼å…¥æ¥å£æ–‡æ¡£"></a>4. å¯¼å…¥æ¥å£æ–‡æ¡£</h2><p>ä½¿ç”¨Apifox-å¯¼å…¥-é€‰æ‹©YApi-å°†jsonæ–‡ä»¶å¯¼å…¥</p>
<h2 id="5-Swagger"><a href="#5-Swagger" class="headerlink" title="5. Swagger"></a>5. Swagger</h2><table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>@Api</td>
<td>ç”¨åœ¨ç±»ä¸Šï¼Œä¾‹å¦‚Controllerï¼Œè¡¨ç¤ºå¯¹ç±»çš„è¯´æ˜</td>
</tr>
<tr>
<td>@ApiModel</td>
<td>ç”¨åœ¨ç±»ä¸Šï¼Œä¾‹å¦‚entityã€DTOã€VO</td>
</tr>
<tr>
<td>@ApiModelProperty</td>
<td>ç”¨åœ¨å±æ€§ä¸Šï¼Œæè¿°å±æ€§ä¿¡æ¯</td>
</tr>
<tr>
<td>@ApiOperation</td>
<td>ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œä¾‹å¦‚Controllerçš„æ–¹æ³•ï¼Œè¯´æ˜æ–¹æ³•çš„ç”¨é€”ã€ä½œç”¨</td>
</tr>
</tbody></table>
<h1 id="äºŒ-å‘˜å·¥ç®¡ç†ã€åˆ†ç±»ç®¡ç†"><a href="#äºŒ-å‘˜å·¥ç®¡ç†ã€åˆ†ç±»ç®¡ç†" class="headerlink" title="äºŒ. å‘˜å·¥ç®¡ç†ã€åˆ†ç±»ç®¡ç†"></a>äºŒ. å‘˜å·¥ç®¡ç†ã€åˆ†ç±»ç®¡ç†</h1><h2 id="1-æ–°å¢å‘˜å·¥"><a href="#1-æ–°å¢å‘˜å·¥" class="headerlink" title="1. æ–°å¢å‘˜å·¥"></a>1. æ–°å¢å‘˜å·¥</h2><h3 id="1-1-å‘˜å·¥çš„DTOç±»-EmployeeDTO"><a href="#1-1-å‘˜å·¥çš„DTOç±»-EmployeeDTO" class="headerlink" title="1.1 å‘˜å·¥çš„DTOç±»(EmployeeDTO)"></a>1.1 å‘˜å·¥çš„DTOç±»(EmployeeDTO)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.dto;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmployeeDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String phone;<br>    <span class="hljs-keyword">private</span> String sex;<br>    <span class="hljs-keyword">private</span> String idNumber;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-Controllerå±‚"><a href="#1-2-Controllerå±‚" class="headerlink" title="1.2 Controllerå±‚"></a>1.2 Controllerå±‚</h3><p>åœ¨EmployeeControllerä¸­<strong>åˆ›å»ºæ–°å¢å‘˜å·¥æ–¹æ³•</strong>ï¼Œæ¥æ”¶å‰ç«¯æäº¤çš„å‚æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.controller.admin.EmployeeController;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–°å¢å‘˜å·¥</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-meta">@ApiOperation(&quot;æ–°å¢å‘˜å·¥&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;æ–°å¢å‘˜å·¥ï¼š&#123;&#125;&quot;</span>,employeeDTO);<br>    employeeService.save(employeeDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-Serviceå±‚"><a href="#1-3-Serviceå±‚" class="headerlink" title="1.3 Serviceå±‚"></a>1.3 Serviceå±‚</h3><h4 id="1-3-1-Serviceå±‚æ¥å£"><a href="#1-3-1-Serviceå±‚æ¥å£" class="headerlink" title="1.3.1 Serviceå±‚æ¥å£"></a>1.3.1 Serviceå±‚æ¥å£</h4><p><strong>åœ¨EmployeeServiceæ¥å£ä¸­å£°æ˜æ–°å¢å‘˜å·¥æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// package com.sky.server.EmployeeService;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–°å¢å‘˜å·¥</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(EmployeeDTO employeeDTO)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-2-Serviceå±‚å®ç°ç±»"><a href="#1-3-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="1.3.2 Serviceå±‚å®ç°ç±»"></a>1.3.2 Serviceå±‚å®ç°ç±»</h4><p><strong>åœ¨EmployeeServiceImplä¸­å®ç°æ–°å¢å‘˜å·¥æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.server.impl.EmployeeServiceImpl;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–°å¢å‘˜å·¥</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(EmployeeDTO employeeDTO)</span> &#123;<br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>();<br><br>    <span class="hljs-comment">//å¯¹è±¡å±æ€§æ‹·è´</span><br>    BeanUtils.copyProperties(employeeDTO, employee);<br><br>    <span class="hljs-comment">//è®¾ç½®è´¦å·çš„çŠ¶æ€ï¼Œé»˜è®¤æ­£å¸¸çŠ¶æ€ 1è¡¨ç¤ºæ­£å¸¸ 0è¡¨ç¤ºé”å®š</span><br>    employee.setStatus(StatusConstant.ENABLE);<br><br>    <span class="hljs-comment">//è®¾ç½®å¯†ç ï¼Œé»˜è®¤å¯†ç 123456</span><br>    employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes()));<br><br>    <span class="hljs-comment">//è®¾ç½®å½“å‰è®°å½•çš„åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´</span><br>    employee.setCreateTime(LocalDateTime.now());<br>    employee.setUpdateTime(LocalDateTime.now());<br><br>    <span class="hljs-comment">//è®¾ç½®å½“å‰è®°å½•åˆ›å»ºäººidå’Œä¿®æ”¹äººid</span><br>    employee.setCreateUser(BaseContext.getCurrentId());<br>    employee.setUpdateUser(BaseContext.getCurrentId());<br><br>    employeeMapper.insert(employee);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-4-Mapperå±‚"><a href="#1-4-Mapperå±‚" class="headerlink" title="1.4 Mapperå±‚"></a>1.4 Mapperå±‚</h3><p><strong>åœ¨EmployeeMapperä¸­å£°æ˜insertæ–¹æ³•</strong></p>
<p>ä¸­æ·»åŠ æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.EmployeeMapper;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ’å…¥å‘˜å·¥æ•°æ®</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employee</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Insert(&quot;insert into employee (name, username, password, phone, sex, id_number, create_time, update_time, create_user, update_user,status) &quot; +</span><br><span class="hljs-meta">        &quot;values &quot; +</span><br><span class="hljs-meta">        &quot;(#&#123;name&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;phone&#125;,#&#123;sex&#125;,#&#123;idNumber&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;,#&#123;createUser&#125;,#&#123;updateUser&#125;,#&#123;status&#125;)&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Employee employee)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-5-å¤„ç†SQLå¼‚å¸¸æŠ›å‡º"><a href="#1-5-å¤„ç†SQLå¼‚å¸¸æŠ›å‡º" class="headerlink" title="1.5 å¤„ç†SQLå¼‚å¸¸æŠ›å‡º"></a>1.5 å¤„ç†SQLå¼‚å¸¸æŠ›å‡º</h3><ul>
<li><strong>é—®é¢˜</strong>ï¼šå½“å½•å…¥çš„ç”¨æˆ·åå·²ç»å­˜åœ¨æ—¶ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸åæ²¡æœ‰å¤„ç†</li>
<li><strong>åŸå› </strong>ï¼šusernameå·²ç»æ·»åŠ äº†å”¯ä¸€çº¦æŸï¼Œä¸èƒ½é‡å¤</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé€šè¿‡å…¨å±€å¼‚å¸¸å¤„ç†å™¨å¤„ç†</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.handler.GlobalExceptionHandler;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¤„ç†SQLå¼‚å¸¸</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ex</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ExceptionHandler</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">exceptionHandler</span><span class="hljs-params">(SQLIntegrityConstraintViolationException ex)</span>&#123;<br>    <span class="hljs-comment">//Duplicate entry &#x27;zhangsan&#x27; for key &#x27;employee.idx_username&#x27;</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> ex.getMessage();<br>    <span class="hljs-keyword">if</span>(message.contains(<span class="hljs-string">&quot;Duplicate entry&quot;</span>))&#123;<br>        String[] split = message.split(<span class="hljs-string">&quot; &quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> split[<span class="hljs-number">2</span>];<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> username + MessageConstant.ALREADY_EXISTS;<br>        <span class="hljs-keyword">return</span> Result.error(msg);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> Result.error(MessageConstant.UNKNOWN_ERROR);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ç„¶åå®šä¹‰æ·»åŠ ç›¸åº”çš„æ¶ˆæ¯å¸¸é‡</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.constant.MessageConstant;</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ALREADY_EXISTS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;å·²å­˜åœ¨&quot;</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-6-ThreadLocal"><a href="#1-6-ThreadLocal" class="headerlink" title="1.6 ThreadLocal"></a>1.6 ThreadLocal</h3><ul>
<li>ThreadLocal å¹¶ä¸æ˜¯ä¸€ä¸ªThreadï¼Œè€Œæ˜¯<strong>Threadçš„å±€éƒ¨å˜é‡</strong>ã€‚</li>
<li>ThreadLocalä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›å•ç‹¬ä¸€ä»½å­˜å‚¨ç©ºé—´ï¼Œå…·æœ‰çº¿ç¨‹éš”ç¦»çš„æ•ˆæœï¼Œåªæœ‰åœ¨çº¿ç¨‹å†…æ‰èƒ½è·å–åˆ°å¯¹åº”çš„å€¼ï¼Œçº¿ç¨‹å¤–åˆ™ä¸èƒ½è®¿é—®ã€‚</li>
</ul>
<p><strong>å¸¸ç”¨æ–¹æ³•</strong></p>
<table>
<thead>
<tr>
<th>å¸¸ç”¨æ–¹æ³•</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>public void set(T value)</td>
<td>è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</td>
</tr>
<tr>
<td>public T get()</td>
<td>è¿”å›å½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</td>
</tr>
<tr>
<td>public void remove()</td>
<td>ç§»é™¤å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡</td>
</tr>
</tbody></table>
<h3 id="1-7-è·å–å½“å‰ç™»å½•å‘˜å·¥çš„ID"><a href="#1-7-è·å–å½“å‰ç™»å½•å‘˜å·¥çš„ID" class="headerlink" title="1.7 è·å–å½“å‰ç™»å½•å‘˜å·¥çš„ID"></a>1.7 è·å–å½“å‰ç™»å½•å‘˜å·¥çš„ID</h3><ul>
<li><strong>é—®é¢˜</strong>ï¼šå‘˜å·¥ç™»å½•æˆåŠŸåä¼šç”ŸæˆJWTä»¤ç‰Œå¹¶å“åº”ç»™å‰ç«¯ã€‚åç»­è¯·æ±‚ä¸­ï¼Œå‰ç«¯ä¼šæºå¸¦JWTä»¤ç‰Œï¼Œé€šè¿‡JWTä»¤ç‰Œå¯ä»¥è§£æå‡ºå½“å‰ç™»å½•å‘˜å·¥idï¼š</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé€šè¿‡ThreadLocalè¿›è¡Œä¼ é€’ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.sky.interceptor.JwtTokenAdminInterceptor;</span><br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtTokenAdminInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br>		<span class="hljs-comment">//.............................</span><br>        <span class="hljs-comment">//2ã€æ ¡éªŒä»¤ç‰Œ</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//.................</span><br>            <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> JwtUtil.parseJWT(jwtProperties.getAdminSecretKey(), token);<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">empId</span> <span class="hljs-operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.EMP_ID).toString());<br>            log.info(<span class="hljs-string">&quot;å½“å‰å‘˜å·¥idï¼š&quot;</span>, empId);<br>            <span class="hljs-comment">/////å°†ç”¨æˆ·idå­˜å‚¨åˆ°ThreadLocal////////</span><br>            BaseContext.setCurrentId(empId);<br>            <span class="hljs-comment">////////////////////////////////////</span><br>            <span class="hljs-comment">//3ã€é€šè¿‡ï¼Œæ”¾è¡Œ</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            <span class="hljs-comment">//......................</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-å‘˜å·¥åˆ†é¡µæŸ¥è¯¢"><a href="#2-å‘˜å·¥åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="2. å‘˜å·¥åˆ†é¡µæŸ¥è¯¢"></a>2. å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</h2><h3 id="2-1-å‘˜å·¥åˆ†é¡µæŸ¥è¯¢çš„DTO"><a href="#2-1-å‘˜å·¥åˆ†é¡µæŸ¥è¯¢çš„DTO" class="headerlink" title="2.1 å‘˜å·¥åˆ†é¡µæŸ¥è¯¢çš„DTO"></a>2.1 å‘˜å·¥åˆ†é¡µæŸ¥è¯¢çš„DTO</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.dto;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmployeePageQueryDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-comment">//å‘˜å·¥å§“å</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-comment">//é¡µç </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> page;<br><br>    <span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> pageSize;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-Controllerå±‚"><a href="#2-2-Controllerå±‚" class="headerlink" title="2.2 Controllerå±‚"></a>2.2 Controllerå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// package com.sky.controller.admin.EmployeeController;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeePageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å‘˜å·¥åˆ†é¡µæŸ¥è¯¢&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(EmployeePageQueryDTO employeePageQueryDTO)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;å‘˜å·¥åˆ†é¡µæŸ¥è¯¢ï¼Œå‚æ•°ä¸ºï¼š&#123;&#125;&quot;</span>, employeePageQueryDTO);<br>    <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> employeeService.pageQuery(employeePageQueryDTO);<span class="hljs-comment">//åç»­å®šä¹‰</span><br>    <span class="hljs-keyword">return</span> Result.success(pageResult);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-Serviceå±‚"><a href="#2-3-Serviceå±‚" class="headerlink" title="2.3 Serviceå±‚"></a>2.3 Serviceå±‚</h3><h4 id="2-3-1-Serviceå±‚æ¥å£"><a href="#2-3-1-Serviceå±‚æ¥å£" class="headerlink" title="2.3.1 Serviceå±‚æ¥å£"></a>2.3.1 Serviceå±‚æ¥å£</h4><p>åœ¨EmployeeServiceæ¥å£ä¸­å£°æ˜pageQueryæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeePageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="2-3-2-Serviceå±‚å®ç°ç±»"><a href="#2-3-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="2.3.2 Serviceå±‚å®ç°ç±»"></a>2.3.2 Serviceå±‚å®ç°ç±»</h4><p>åœ¨EmployeeServiceImplä¸­å®ç°pageQueryæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeePageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(EmployeePageQueryDTO employeePageQueryDTO)</span> &#123;<br>    <span class="hljs-comment">// select * from employee limit 0,10</span><br>    <span class="hljs-comment">//å¼€å§‹åˆ†é¡µæŸ¥è¯¢</span><br>    PageHelper.startPage(employeePageQueryDTO.getPage(), employeePageQueryDTO.getPageSize());<br><br>    Page&lt;Employee&gt; page = employeeMapper.pageQuery(employeePageQueryDTO);<br><br>    <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> page.getTotal();<br>    List&lt;Employee&gt; records = page.getResult();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(total, records);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-Mapperå±‚"><a href="#2-4-Mapperå±‚" class="headerlink" title="2.4 Mapperå±‚"></a>2.4 Mapperå±‚</h3><p>åœ¨ EmployeeMapper ä¸­å£°æ˜ pageQuery æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeePageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>Page&lt;Employee&gt; <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<p>åœ¨ src&#x2F;main&#x2F;resources&#x2F;mapper&#x2F;EmployeeMapper.xml ä¸­ç¼–å†™SQLï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> id<span class="hljs-operator">=</span>&quot;pageQuery&quot; resultType<span class="hljs-operator">=</span>&quot;com.sky.entity.Employee&quot;<span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> employee<br>        <span class="hljs-operator">&lt;</span><span class="hljs-keyword">where</span><span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;name != null and name != &#x27;&#x27;&quot;<span class="hljs-operator">&gt;</span><br>                <span class="hljs-keyword">and</span> name <span class="hljs-keyword">like</span> concat(<span class="hljs-string">&#x27;%&#x27;</span>,#&#123;name&#125;,<span class="hljs-string">&#x27;%&#x27;</span>)<br>            <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>        <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">where</span><span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> create_time <span class="hljs-keyword">desc</span><br>    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">select</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="2-5-æ—¥æœŸæ ¼å¼åŒ–"><a href="#2-5-æ—¥æœŸæ ¼å¼åŒ–" class="headerlink" title="2.5 æ—¥æœŸæ ¼å¼åŒ–"></a>2.5 æ—¥æœŸæ ¼å¼åŒ–</h3><ul>
<li><strong>é—®é¢˜</strong>ï¼šæ“ä½œæ—¶é—´å­—æ®µæ˜¾ç¤ºæœ‰é—®é¢˜ã€‚å‰ç«¯æ˜¾ç¤ºçš„æ—¶é—´æ ¼å¼ä¸æ ‡å‡†</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨WebMvcConfigurationä¸­æ‰©å±•SpringMVCçš„æ¶ˆæ¯è½¬æ¢å™¨ï¼Œç»Ÿä¸€å¯¹æ—¥æœŸç±»å‹è¿›è¡Œæ ¼å¼å¤„ç†</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰©å±•Spring MVCæ¡†æ¶çš„æ¶ˆæ¯è½¬åŒ–å™¨</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> converters</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extendMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;æ‰©å±•æ¶ˆæ¯è½¬æ¢å™¨...&quot;</span>);<br>    <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡</span><br>    <span class="hljs-type">MappingJackson2HttpMessageConverter</span> <span class="hljs-variable">converter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2HttpMessageConverter</span>();<br>    <span class="hljs-comment">//éœ€è¦ä¸ºæ¶ˆæ¯è½¬æ¢å™¨è®¾ç½®ä¸€ä¸ªå¯¹è±¡è½¬æ¢å™¨ï¼Œå¯¹è±¡è½¬æ¢å™¨å¯ä»¥å°†Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonæ•°æ®</span><br>    converter.setObjectMapper(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JacksonObjectMapper</span>());<br>    <span class="hljs-comment">//å°†è‡ªå·±çš„æ¶ˆæ¯è½¬åŒ–å™¨åŠ å…¥å®¹å™¨ä¸­</span><br>    converters.add(<span class="hljs-number">0</span>,converter);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·"><a href="#3-å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·" class="headerlink" title="3. å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·"></a>3. å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</h2><h3 id="3-1-Controllerå±‚"><a href="#3-1-Controllerå±‚" class="headerlink" title="3.1 Controllerå±‚"></a>3.1 Controllerå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// package com.sky.controller.admin.EmployeeController;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status,Long id)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·ï¼š&#123;&#125;,&#123;&#125;&quot;</span>,status,id);<br>    employeeService.startOrStop(status,id);<span class="hljs-comment">//åç»ªæ­¥éª¤å®šä¹‰</span><br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-Serviceå±‚"><a href="#3-2-Serviceå±‚" class="headerlink" title="3.2 Serviceå±‚"></a>3.2 Serviceå±‚</h3><h4 id="3-2-1-Serviceå±‚æ¥å£"><a href="#3-2-1-Serviceå±‚æ¥å£" class="headerlink" title="3.2.1 Serviceå±‚æ¥å£"></a>3.2.1 Serviceå±‚æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-comment">//package com.sky.service.EmployeeService;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-Serviceå±‚å®ç°ç±»"><a href="#3-2-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="3.2.2 Serviceå±‚å®ç°ç±»"></a>3.2.2 Serviceå±‚å®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-comment">//package com.sky.service.impl.EmployeeServiceImpl;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span> &#123;<br>       <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> Employee.builder()<br>               .status(status)<br>               .id(id)<br>               .build();<br><br>       employeeMapper.update(employee);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-Mapperå±‚"><a href="#3-3-Mapperå±‚" class="headerlink" title="3.3 Mapperå±‚"></a>3.3 Mapperå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-comment">//package com.sky.mapper.EmployeeMapper;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®ä¸»é”®åŠ¨æ€ä¿®æ”¹å±æ€§</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> employee</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Employee employee)</span>;<br></code></pre></td></tr></table></figure>

<p>åœ¨ EmployeeMapper.xml ä¸­ç¼–å†™SQLï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">update</span> id<span class="hljs-operator">=</span>&quot;update&quot; parameterType<span class="hljs-operator">=</span>&quot;Employee&quot;<span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">update</span> employee<br>        <span class="hljs-operator">&lt;</span><span class="hljs-keyword">set</span><span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;name != null&quot;<span class="hljs-operator">&gt;</span>name <span class="hljs-operator">=</span> #&#123;name&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;username != null&quot;<span class="hljs-operator">&gt;</span>username <span class="hljs-operator">=</span> #&#123;username&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;password != null&quot;<span class="hljs-operator">&gt;</span>password <span class="hljs-operator">=</span> #&#123;password&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;phone != null&quot;<span class="hljs-operator">&gt;</span>phone <span class="hljs-operator">=</span> #&#123;phone&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;sex != null&quot;<span class="hljs-operator">&gt;</span>sex <span class="hljs-operator">=</span> #&#123;sex&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;idNumber != null&quot;<span class="hljs-operator">&gt;</span>id_Number <span class="hljs-operator">=</span> #&#123;idNumber&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;updateTime != null&quot;<span class="hljs-operator">&gt;</span>update_Time <span class="hljs-operator">=</span> #&#123;updateTime&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;updateUser != null&quot;<span class="hljs-operator">&gt;</span>update_User <span class="hljs-operator">=</span> #&#123;updateUser&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>            <span class="hljs-operator">&lt;</span>if test<span class="hljs-operator">=</span>&quot;status != null&quot;<span class="hljs-operator">&gt;</span>status <span class="hljs-operator">=</span> #&#123;status&#125;,<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>if<span class="hljs-operator">&gt;</span><br>        <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">set</span><span class="hljs-operator">&gt;</span><br>        <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> #&#123;id&#125;<br>    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">update</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="4-ç¼–è¾‘å‘˜å·¥"><a href="#4-ç¼–è¾‘å‘˜å·¥" class="headerlink" title="4. ç¼–è¾‘å‘˜å·¥"></a>4. ç¼–è¾‘å‘˜å·¥</h2><h3 id="4-1-å›æ˜¾å‘˜å·¥ä¿¡æ¯åŠŸèƒ½"><a href="#4-1-å›æ˜¾å‘˜å·¥ä¿¡æ¯åŠŸèƒ½" class="headerlink" title="4.1 å›æ˜¾å‘˜å·¥ä¿¡æ¯åŠŸèƒ½"></a>4.1 å›æ˜¾å‘˜å·¥ä¿¡æ¯åŠŸèƒ½</h3><h4 id="4-1-1-Controllerå±‚"><a href="#4-1-1-Controllerå±‚" class="headerlink" title="4.1.1 Controllerå±‚"></a>4.1.1 Controllerå±‚</h4><p>åœ¨ EmployeeController ä¸­åˆ›å»º getById æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;Employee&gt; <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span>&#123;<br>       <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> employeeService.getById(id);<br>       <span class="hljs-keyword">return</span> Result.success(employee);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-1-2-Serviceå±‚"><a href="#4-1-2-Serviceå±‚" class="headerlink" title="4.1.2 Serviceå±‚"></a>4.1.2 Serviceå±‚</h4><h5 id="4-1-2-1-Serviceå±‚æ¥å£"><a href="#4-1-2-1-Serviceå±‚æ¥å£" class="headerlink" title="4.1.2.1 Serviceå±‚æ¥å£"></a>4.1.2.1 Serviceå±‚æ¥å£</h5><p>åœ¨ EmployeeService æ¥å£ä¸­å£°æ˜ getById æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>Employee <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h5 id="4-1-2-2-Serviceå±‚å®ç°ç±»"><a href="#4-1-2-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="4.1.2.2 Serviceå±‚å®ç°ç±»"></a>4.1.2.2 Serviceå±‚å®ç°ç±»</h5><p>åœ¨ EmployeeServiceImpl ä¸­å®ç° getById æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> Employee <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> employeeMapper.getById(id);<br>    employee.setPassword(<span class="hljs-string">&quot;****&quot;</span>);<br>    <span class="hljs-keyword">return</span> employee;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-1-3-Mapperå±‚"><a href="#4-1-3-Mapperå±‚" class="headerlink" title="4.1.3 Mapperå±‚"></a>4.1.3 Mapperå±‚</h4><p>åœ¨ EmployeeMapper æ¥å£ä¸­å£°æ˜ getById æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Select(&quot;select * from employee where id = #&#123;id&#125;&quot;)</span><br>Employee <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-ä¿®æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½"><a href="#4-2-ä¿®æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½" class="headerlink" title="4.2 ä¿®æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½"></a>4.2 ä¿®æ”¹å‘˜å·¥ä¿¡æ¯åŠŸèƒ½</h3><h4 id="4-2-1-Controllerå±‚"><a href="#4-2-1-Controllerå±‚" class="headerlink" title="4.2.1 Controllerå±‚"></a>4.2.1 Controllerå±‚</h4><p>åœ¨ EmployeeController ä¸­åˆ›å»º update æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping</span><br><span class="hljs-meta">@ApiOperation(&quot;ç¼–è¾‘å‘˜å·¥ä¿¡æ¯&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;ç¼–è¾‘å‘˜å·¥ä¿¡æ¯ï¼š&#123;&#125;&quot;</span>, employeeDTO);<br>    employeeService.update(employeeDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-2-2-Serviceå±‚"><a href="#4-2-2-Serviceå±‚" class="headerlink" title="4.2.2 Serviceå±‚"></a>4.2.2 Serviceå±‚</h4><h5 id="4-2-2-1-Serviceå±‚æ¥å£"><a href="#4-2-2-1-Serviceå±‚æ¥å£" class="headerlink" title="4.2.2.1 Serviceå±‚æ¥å£"></a>4.2.2.1 Serviceå±‚æ¥å£</h5><p>åœ¨ EmployeeService æ¥å£ä¸­å£°æ˜ update æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(EmployeeDTO employeeDTO)</span>;<br></code></pre></td></tr></table></figure>

<h5 id="4-2-2-2-Serviceå±‚å®ç°ç±»"><a href="#4-2-2-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="4.2.2.2 Serviceå±‚å®ç°ç±»"></a>4.2.2.2 Serviceå±‚å®ç°ç±»</h5><p>åœ¨ EmployeeServiceImpl ä¸­å®ç° update æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> employeeDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(EmployeeDTO employeeDTO)</span> &#123;<br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>();<br>    BeanUtils.copyProperties(employeeDTO, employee);<br><br>    employee.setUpdateTime(LocalDateTime.now());<br>    employee.setUpdateUser(BaseContext.getCurrentId());<br><br>    employeeMapper.update(employee);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-2-3-Mapperå±‚"><a href="#4-2-3-Mapperå±‚" class="headerlink" title="4.2.3 Mapperå±‚"></a>4.2.3 Mapperå±‚</h4><p>åœ¨å®ç°<strong>å¯ç”¨ç¦ç”¨å‘˜å·¥è´¦å·</strong>åŠŸèƒ½æ—¶ï¼Œå·²å®ç°employeeMapper.update(employee)ï¼Œåœ¨æ­¤ä¸éœ€å†™Mapperå±‚ä»£ç ã€‚</p>
<h2 id="5-èœå“åˆ†ç±»å’Œå¥—é¤åˆ†ç±»"><a href="#5-èœå“åˆ†ç±»å’Œå¥—é¤åˆ†ç±»" class="headerlink" title="5. èœå“åˆ†ç±»å’Œå¥—é¤åˆ†ç±»"></a>5. èœå“åˆ†ç±»å’Œå¥—é¤åˆ†ç±»</h2><p>ç›´æ¥å¯¼å…¥ç›¸åº”ä»£ç å·¥ç¨‹</p>
<h1 id="ä¸‰-èœå“ç®¡ç†"><a href="#ä¸‰-èœå“ç®¡ç†" class="headerlink" title="ä¸‰. èœå“ç®¡ç†"></a>ä¸‰. èœå“ç®¡ç†</h1><h2 id="1-å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"><a href="#1-å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……" class="headerlink" title="1. å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"></a>1. å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</h2><h3 id="1-1-å®ç°æ€è·¯"><a href="#1-1-å®ç°æ€è·¯" class="headerlink" title="1.1 å®ç°æ€è·¯"></a>1.1 å®ç°æ€è·¯</h3><p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>è‡ªå®šä¹‰æ³¨è§£ AutoFillï¼Œç”¨äºæ ‡è¯†éœ€è¦è¿›è¡Œå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……çš„æ–¹æ³•</li>
<li>è‡ªå®šä¹‰åˆ‡é¢ç±» AutoFillAspectï¼Œç»Ÿä¸€æ‹¦æˆªåŠ å…¥äº† AutoFill æ³¨è§£çš„æ–¹æ³•ï¼Œé€šè¿‡åå°„ä¸ºå…¬å…±å­—æ®µèµ‹å€¼</li>
<li>åœ¨ Mapper çš„æ–¹æ³•ä¸ŠåŠ å…¥ AutoFill æ³¨è§£</li>
</ol>
<p><strong>æŠ€æœ¯ç‚¹</strong>ï¼šæšä¸¾ã€æ³¨è§£ã€AOPã€åå°„</p>
<h3 id="1-2-è‡ªå®šä¹‰æ³¨è§£-AutoFill"><a href="#1-2-è‡ªå®šä¹‰æ³¨è§£-AutoFill" class="headerlink" title="1.2 è‡ªå®šä¹‰æ³¨è§£ AutoFill"></a>1.2 è‡ªå®šä¹‰æ³¨è§£ AutoFill</h3><p>è¿›å…¥åˆ°sky-serveræ¨¡å—ï¼Œåˆ›å»ºcom.sky.annotationåŒ…ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.annotation;<br><br><span class="hljs-keyword">import</span> com.sky.enumeration.OperationType;<br><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰æ³¨è§£ï¼Œç”¨äºæ ‡è¯†æŸä¸ªæ–¹æ³•éœ€è¦è¿›è¡ŒåŠŸèƒ½å­—æ®µè‡ªåŠ¨å¡«å……å¤„ç†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoFill &#123;<br>    <span class="hljs-comment">//æ•°æ®åº“æ“ä½œç±»å‹ï¼šUPDATE INSERT</span><br>    OperationType <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-è‡ªå®šä¹‰åˆ‡é¢-AutoFillAspect"><a href="#1-3-è‡ªå®šä¹‰åˆ‡é¢-AutoFillAspect" class="headerlink" title="1.3 è‡ªå®šä¹‰åˆ‡é¢ AutoFillAspect"></a>1.3 è‡ªå®šä¹‰åˆ‡é¢ AutoFillAspect</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.aspect;<br><br><span class="hljs-keyword">import</span> com.sky.annotation.AutoFill;<br><span class="hljs-keyword">import</span> com.sky.constant.AutoFillConstant;<br><span class="hljs-keyword">import</span> com.sky.context.BaseContext;<br><span class="hljs-keyword">import</span> com.sky.enumeration.OperationType;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.aspectj.lang.JoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;<br><span class="hljs-keyword">import</span> org.aspectj.lang.reflect.MethodSignature;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰åˆ‡é¢ï¼Œå®ç°å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……å¤„ç†é€»è¾‘</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoFillAspect</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ‡å…¥ç‚¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">autoFillPointCut</span><span class="hljs-params">()</span>&#123;&#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‰ç½®é€šçŸ¥ï¼Œåœ¨é€šçŸ¥ä¸­è¿›è¡Œå…¬å…±å­—æ®µçš„èµ‹å€¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Before(&quot;autoFillPointCut()&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">autoFill</span><span class="hljs-params">(JoinPoint joinPoint)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;å¼€å§‹è¿›è¡Œå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……...&quot;</span>);<br><br>        <span class="hljs-comment">//è·å–åˆ°å½“å‰è¢«æ‹¦æˆªçš„æ–¹æ³•ä¸Šçš„æ•°æ®åº“æ“ä½œç±»å‹</span><br>        <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) joinPoint.getSignature();<span class="hljs-comment">//æ–¹æ³•ç­¾åå¯¹è±¡</span><br>        <span class="hljs-type">AutoFill</span> <span class="hljs-variable">autoFill</span> <span class="hljs-operator">=</span> signature.getMethod().getAnnotation(AutoFill.class);<span class="hljs-comment">//è·å¾—æ–¹æ³•ä¸Šçš„æ³¨è§£å¯¹è±¡</span><br>        <span class="hljs-type">OperationType</span> <span class="hljs-variable">operationType</span> <span class="hljs-operator">=</span> autoFill.value();<span class="hljs-comment">//è·å¾—æ•°æ®åº“æ“ä½œç±»å‹</span><br><br>        <span class="hljs-comment">//è·å–åˆ°å½“å‰è¢«æ‹¦æˆªçš„æ–¹æ³•çš„å‚æ•°--å®ä½“å¯¹è±¡</span><br>        Object[] args = joinPoint.getArgs();<br>        <span class="hljs-keyword">if</span>(args == <span class="hljs-literal">null</span> || args.length == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> args[<span class="hljs-number">0</span>];<br><br>        <span class="hljs-comment">//å‡†å¤‡èµ‹å€¼çš„æ•°æ®</span><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">currentId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>        <span class="hljs-comment">//æ ¹æ®å½“å‰ä¸åŒçš„æ“ä½œç±»å‹ï¼Œä¸ºå¯¹åº”çš„å±æ€§é€šè¿‡åå°„æ¥èµ‹å€¼</span><br>        <span class="hljs-keyword">if</span>(operationType == OperationType.INSERT)&#123;<br>            <span class="hljs-comment">//ä¸º4ä¸ªå…¬å…±å­—æ®µèµ‹å€¼</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setCreateTime</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME, LocalDateTime.class);<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setCreateUser</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER, Long.class);<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setUpdateTime</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setUpdateUser</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);<br><br>                <span class="hljs-comment">//é€šè¿‡åå°„ä¸ºå¯¹è±¡å±æ€§èµ‹å€¼</span><br>                setCreateTime.invoke(entity,now);<br>                setCreateUser.invoke(entity,currentId);<br>                setUpdateTime.invoke(entity,now);<br>                setUpdateUser.invoke(entity,currentId);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(operationType == OperationType.UPDATE)&#123;<br>            <span class="hljs-comment">//ä¸º2ä¸ªå…¬å…±å­—æ®µèµ‹å€¼</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setUpdateTime</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">setUpdateUser</span> <span class="hljs-operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);<br><br>                <span class="hljs-comment">//é€šè¿‡åå°„ä¸ºå¯¹è±¡å±æ€§èµ‹å€¼</span><br>                setUpdateTime.invoke(entity,now);<br>                setUpdateUser.invoke(entity,currentId);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-4-åœ¨Mapperæ¥å£çš„æ–¹æ³•ä¸ŠåŠ å…¥-AutoFill-æ³¨è§£"><a href="#1-4-åœ¨Mapperæ¥å£çš„æ–¹æ³•ä¸ŠåŠ å…¥-AutoFill-æ³¨è§£" class="headerlink" title="1.4 åœ¨Mapperæ¥å£çš„æ–¹æ³•ä¸ŠåŠ å…¥ AutoFill æ³¨è§£"></a>1.4 åœ¨Mapperæ¥å£çš„æ–¹æ³•ä¸ŠåŠ å…¥ AutoFill æ³¨è§£</h3><p>ä»¥<strong>CategoryMapper</strong>ä¸ºä¾‹ï¼Œåˆ†åˆ«åœ¨æ–°å¢å’Œä¿®æ”¹æ–¹æ³•æ·»åŠ @AutoFill()æ³¨è§£ï¼Œä¹Ÿéœ€è¦<strong>EmployeeMapper</strong>åšç›¸åŒæ“ä½œï¼›åŒæ—¶æ³¨é‡Šæ‰åŸæœ‰çš„æ–°å¢å’Œæ·»åŠ ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CategoryMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ’å…¥æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> category</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Insert(&quot;insert into category(type, name, sort, status, create_time, update_time, create_user, update_user)&quot; +</span><br><span class="hljs-meta">            &quot; VALUES&quot; +</span><br><span class="hljs-meta">            &quot; (#&#123;type&#125;, #&#123;name&#125;, #&#123;sort&#125;, #&#123;status&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;)&quot;)</span><br>    <span class="hljs-meta">@AutoFill(value = OperationType.INSERT)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Category category)</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idä¿®æ”¹åˆ†ç±»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> category</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@AutoFill(value = OperationType.UPDATE)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Category category)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-æ–‡ä»¶ä¸Šä¼ "><a href="#2-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="2. æ–‡ä»¶ä¸Šä¼ "></a>2. æ–‡ä»¶ä¸Šä¼ </h2><ul>
<li>å› ä¸ºåœ¨æ–°å¢èœå“æ—¶ï¼Œéœ€è¦ä¸Šä¼ èœå“å¯¹åº”çš„å›¾ç‰‡(æ–‡ä»¶)ï¼ŒåŒ…æ‹¬åç»ªå…¶å®ƒåŠŸèƒ½ä¹Ÿä¼šä½¿ç”¨åˆ°æ–‡ä»¶ä¸Šä¼ ï¼Œæ•…è¦å®ç°é€šç”¨çš„æ–‡ä»¶ä¸Šä¼ æ¥å£ã€‚</li>
<li>åœ¨æœ¬é¡¹ç›®é€‰ç”¨é˜¿é‡Œäº‘çš„OSSæœåŠ¡è¿›è¡Œæ–‡ä»¶å­˜å‚¨ã€‚</li>
</ul>
<h3 id="2-1-å®šä¹‰OSSç›¸å…³é…ç½®"><a href="#2-1-å®šä¹‰OSSç›¸å…³é…ç½®" class="headerlink" title="2.1 å®šä¹‰OSSç›¸å…³é…ç½®"></a>2.1 å®šä¹‰OSSç›¸å…³é…ç½®</h3><p>åœ¨sky-serveræ¨¡å—</p>
<ul>
<li>application-dev.yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">alioss:</span><br>    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">oss-cn-hangzhou.aliyuncs.com</span><br>    <span class="hljs-attr">bucket-name:</span> <span class="hljs-string">sky-take-out</span><br></code></pre></td></tr></table></figure>

<ul>
<li>application.yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span>    <span class="hljs-comment">#è®¾ç½®ç¯å¢ƒ</span><br><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">alioss:</span><br>    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">$&#123;sky.alioss.endpoint&#125;</span><br>    <span class="hljs-attr">bucket-name:</span> <span class="hljs-string">$&#123;sky.alioss.bucket-name&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="2-2-OSSå·¥å…·ç±»å¯¹è±¡"><a href="#2-2-OSSå·¥å…·ç±»å¯¹è±¡" class="headerlink" title="2.2 OSSå·¥å…·ç±»å¯¹è±¡"></a>2.2 OSSå·¥å…·ç±»å¯¹è±¡</h3><p>åœ¨sky-serveræ¨¡å—</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.config;<br><br><span class="hljs-keyword">import</span> com.sky.properties.AliOssProperties;<br><span class="hljs-keyword">import</span> com.sky.utils.AliOssUtil;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é…ç½®ç±»ï¼Œç”¨äºåˆ›å»ºAliOssUtilå¯¹è±¡</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OssConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> AliOssUtil <span class="hljs-title function_">aliOssUtil</span><span class="hljs-params">(AliOssProperties aliOssProperties)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;å¼€å§‹åˆ›å»ºé˜¿é‡Œäº‘æ–‡ä»¶ä¸Šä¼ å·¥å…·ç±»å¯¹è±¡ï¼š&#123;&#125;&quot;</span>,aliOssProperties);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AliOssUtil</span>(aliOssProperties.getEndpoint(),<br>                aliOssProperties.getAccessKeyId(),<br>                aliOssProperties.getAccessKeySecret(),<br>                aliOssProperties.getBucketName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-å®šä¹‰æ–‡ä»¶ä¸Šä¼ æ¥å£"><a href="#2-3-å®šä¹‰æ–‡ä»¶ä¸Šä¼ æ¥å£" class="headerlink" title="2.3 å®šä¹‰æ–‡ä»¶ä¸Šä¼ æ¥å£"></a>2.3 å®šä¹‰æ–‡ä»¶ä¸Šä¼ æ¥å£</h3><p>åœ¨sky-serveræ¨¡å—ä¸­å®šä¹‰æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.admin;<br><br><span class="hljs-keyword">import</span> com.sky.constant.MessageConstant;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.utils.AliOssUtil;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.UUID;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é€šç”¨æ¥å£</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/common&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;é€šç”¨æ¥å£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AliOssUtil aliOssUtil;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ä»¶ä¸Šä¼ </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;æ–‡ä»¶ä¸Šä¼ &quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ ï¼š&#123;&#125;&quot;</span>,file);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//åŸå§‹æ–‡ä»¶å</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>            <span class="hljs-comment">//æˆªå–åŸå§‹æ–‡ä»¶åçš„åç¼€ </span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">extension</span> <span class="hljs-operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br>            <span class="hljs-comment">//æ„é€ æ–°æ–‡ä»¶åç§°</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">objectName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString() + extension;<br><br>            <span class="hljs-comment">//æ–‡ä»¶çš„è¯·æ±‚è·¯å¾„</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> aliOssUtil.upload(file.getBytes(), objectName);<br>            <span class="hljs-keyword">return</span> Result.success(filePath);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            log.error(<span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š&#123;&#125;&quot;</span>, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.error(MessageConstant.UPLOAD_FAILED);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-æ–°å¢èœå“"><a href="#3-æ–°å¢èœå“" class="headerlink" title="3. æ–°å¢èœå“"></a>3. æ–°å¢èœå“</h2><h3 id="3-1-Controllerå±‚-1"><a href="#3-1-Controllerå±‚-1" class="headerlink" title="3.1 Controllerå±‚"></a>3.1 Controllerå±‚</h3><p>è¿›å…¥åˆ°sky-serveræ¨¡å—</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.admin;<br><br><span class="hljs-keyword">import</span> com.sky.dto.DishDTO;<br><span class="hljs-keyword">import</span> com.sky.dto.DishPageQueryDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.Dish;<br><span class="hljs-keyword">import</span> com.sky.result.PageResult;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.DishService;<br><span class="hljs-keyword">import</span> com.sky.vo.DishVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Set;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * èœå“ç®¡ç†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/dish&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;èœå“ç›¸å…³æ¥å£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishService dishService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢èœå“</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-meta">@ApiOperation(&quot;æ–°å¢èœå“&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;æ–°å¢èœå“ï¼š&#123;&#125;&quot;</span>, dishDTO);<br>        dishService.saveWithFlavor(dishDTO);<span class="hljs-comment">//åç»ªæ­¥éª¤å¼€å‘</span><br>        <span class="hljs-keyword">return</span> Result.success();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-Serviceå±‚-1"><a href="#3-2-Serviceå±‚-1" class="headerlink" title="3.2 Serviceå±‚"></a>3.2 Serviceå±‚</h3><h4 id="3-2-1-Serviceå±‚æ¥å£-1"><a href="#3-2-1-Serviceå±‚æ¥å£-1" class="headerlink" title="3.2.1 Serviceå±‚æ¥å£"></a>3.2.1 Serviceå±‚æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.DishDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.Dish;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DishService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢èœå“å’Œå¯¹åº”çš„å£å‘³</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithFlavor</span><span class="hljs-params">(DishDTO dishDTO)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-Serviceå±‚å®ç°ç±»-1"><a href="#3-2-2-Serviceå±‚å®ç°ç±»-1" class="headerlink" title="3.2.2 Serviceå±‚å®ç°ç±»"></a>3.2.2 Serviceå±‚å®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DishService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishMapper dishMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishFlavorMapper dishFlavorMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢èœå“å’Œå¯¹åº”çš„å£å‘³</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithFlavor</span><span class="hljs-params">(DishDTO dishDTO)</span> &#123;<br><br>        <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>        BeanUtils.copyProperties(dishDTO, dish);<br><br>        <span class="hljs-comment">//å‘èœå“è¡¨æ’å…¥1æ¡æ•°æ®</span><br>        dishMapper.insert(dish);<span class="hljs-comment">//åç»ªæ­¥éª¤å®ç°</span><br><br>        <span class="hljs-comment">//è·å–insertè¯­å¥ç”Ÿæˆçš„ä¸»é”®å€¼</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">dishId</span> <span class="hljs-operator">=</span> dish.getId();<br><br>        List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();<br>        <span class="hljs-keyword">if</span> (flavors != <span class="hljs-literal">null</span> &amp;&amp; flavors.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            flavors.forEach(dishFlavor -&gt; &#123;<br>                dishFlavor.setDishId(dishId);<br>            &#125;);<br>            <span class="hljs-comment">//å‘å£å‘³è¡¨æ’å…¥næ¡æ•°æ®</span><br>            dishFlavorMapper.insertBatch(flavors);<span class="hljs-comment">//åç»ªæ­¥éª¤å®ç°</span><br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-Mapperå±‚-1"><a href="#3-3-Mapperå±‚-1" class="headerlink" title="3.3 Mapperå±‚"></a>3.3 Mapperå±‚</h3><h4 id="3-3-1-DishMapper-java"><a href="#3-3-1-DishMapper-java" class="headerlink" title="3.3.1 DishMapper.java"></a>3.3.1 DishMapper.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ’å…¥èœå“æ•°æ®</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@AutoFill(value = OperationType.INSERT)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Dish dish)</span>;<br></code></pre></td></tr></table></figure>

<p>åœ¨&#x2F;resources&#x2F;mapperä¸­åˆ›å»ºDishMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.DishMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>        insert into dish (name, category_id, price, image, description, create_time, update_time, create_user,update_user, status)<br>        values (#&#123;name&#125;, #&#123;categoryId&#125;, #&#123;price&#125;, #&#123;image&#125;, #&#123;description&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;, #&#123;status&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="3-3-2-DishFlavorMapper-java"><a href="#3-3-2-DishFlavorMapper-java" class="headerlink" title="3.3.2 DishFlavorMapper.java"></a>3.3.2 DishFlavorMapper.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.DishFlavor;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DishFlavorMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰¹é‡æ’å…¥å£å‘³æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> flavors</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBatch</span><span class="hljs-params">(List&lt;DishFlavor&gt; flavors)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>åœ¨&#x2F;resources&#x2F;mapperä¸­åˆ›å»ºDishFlavorMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.DishFlavorMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertBatch&quot;</span>&gt;</span><br>        insert into dish_flavor (dish_id, name, value) VALUES<br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;flavors&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;df&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>            (#&#123;df.dishId&#125;,#&#123;df.name&#125;,#&#123;df.value&#125;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="4-èœå“åˆ†é¡µæŸ¥è¯¢"><a href="#4-èœå“åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="4. èœå“åˆ†é¡µæŸ¥è¯¢"></a>4. èœå“åˆ†é¡µæŸ¥è¯¢</h2><h3 id="4-1-Controllerå±‚"><a href="#4-1-Controllerå±‚" class="headerlink" title="4.1  Controllerå±‚"></a>4.1  Controllerå±‚</h3><p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºDishControllerçš„pageåˆ†é¡µæŸ¥è¯¢æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * èœå“åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishPageQueryDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;èœå“åˆ†é¡µæŸ¥è¯¢&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;èœå“åˆ†é¡µæŸ¥è¯¢:&#123;&#125;&quot;</span>, dishPageQueryDTO);<br>       <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> dishService.pageQuery(dishPageQueryDTO);<span class="hljs-comment">//åç»ªæ­¥éª¤å®šä¹‰</span><br>       <span class="hljs-keyword">return</span> Result.success(pageResult);<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="4-2-Serviceå±‚"><a href="#4-2-Serviceå±‚" class="headerlink" title="4.2 Serviceå±‚"></a>4.2 Serviceå±‚</h3><h4 id="4-2-1-Serviceå±‚æ¥å£"><a href="#4-2-1-Serviceå±‚æ¥å£" class="headerlink" title="4.2.1 Serviceå±‚æ¥å£"></a>4.2.1 Serviceå±‚æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * èœå“åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishPageQueryDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(DishPageQueryDTO dishPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>



<h4 id="4-2-2-Serviceå±‚å®ç°ç±»"><a href="#4-2-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="4.2.2 Serviceå±‚å®ç°ç±»"></a>4.2.2 Serviceå±‚å®ç°ç±»</h4><p><strong>åœ¨ DishServiceImpl ä¸­å®ç°åˆ†é¡µæŸ¥è¯¢æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * èœå“åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishPageQueryDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;<br>       PageHelper.startPage(dishPageQueryDTO.getPage(), dishPageQueryDTO.getPageSize());<br>       Page&lt;DishVO&gt; page = dishMapper.pageQuery(dishPageQueryDTO);<span class="hljs-comment">//åç»ªæ­¥éª¤å®ç°</span><br>       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(page.getTotal(), page.getResult());<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="4-3-Mapperå±‚"><a href="#4-3-Mapperå±‚" class="headerlink" title="4.3 Mapperå±‚"></a>4.3 Mapperå±‚</h3><p><strong>åœ¨ DishMapper æ¥å£ä¸­å£°æ˜ pageQuery æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * èœå“åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishPageQueryDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   Page&lt;DishVO&gt; <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(DishPageQueryDTO dishPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨ DishMapper.xml ä¸­ç¼–å†™SQLï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pageQuery&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sky.vo.DishVO&quot;</span>&gt;</span><br>        select d.* , c.name as categoryName from dish d left outer join category c on d.category_id = c.id<br>        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>                and d.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>                and d.category_id = #&#123;categoryId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                and d.status = #&#123;status&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>        order by d.create_time desc<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="5-åˆ é™¤èœå“"><a href="#5-åˆ é™¤èœå“" class="headerlink" title="5. åˆ é™¤èœå“"></a>5. åˆ é™¤èœå“</h2><h3 id="5-1-Controllerå±‚"><a href="#5-1-Controllerå±‚" class="headerlink" title="5.1 Controllerå±‚"></a>5.1 Controllerå±‚</h3><p><strong>æ ¹æ®åˆ é™¤èœå“çš„æ¥å£å®šä¹‰åœ¨DishControllerä¸­åˆ›å»ºæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * èœå“æ‰¹é‡åˆ é™¤</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@DeleteMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;èœå“æ‰¹é‡åˆ é™¤&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;èœå“æ‰¹é‡åˆ é™¤ï¼š&#123;&#125;&quot;</span>, ids);<br>       dishService.deleteBatch(ids);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-2-Serviceå±‚"><a href="#5-2-Serviceå±‚" class="headerlink" title="5.2 Serviceå±‚"></a>5.2 Serviceå±‚</h3><h4 id="5-2-1-Serviceå±‚æ¥å£"><a href="#5-2-1-Serviceå±‚æ¥å£" class="headerlink" title="5.2.1 Serviceå±‚æ¥å£"></a>5.2.1 Serviceå±‚æ¥å£</h4><p><strong>åœ¨DishServiceæ¥å£ä¸­å£°æ˜deleteBatchæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * èœå“æ‰¹é‡åˆ é™¤</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBatch</span><span class="hljs-params">(List&lt;Long&gt; ids)</span>;<br></code></pre></td></tr></table></figure>



<h4 id="5-2-2-Serviceå±‚å®ç°ç±»"><a href="#5-2-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="5.2.2 Serviceå±‚å®ç°ç±»"></a>5.2.2 Serviceå±‚å®ç°ç±»</h4><p><strong>åœ¨DishServiceImplä¸­å®ç°deleteBatchæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> SetmealDishMapper setmealDishMapper;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * èœå“æ‰¹é‡åˆ é™¤</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Transactional</span><span class="hljs-comment">//äº‹åŠ¡</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBatch</span><span class="hljs-params">(List&lt;Long&gt; ids)</span> &#123;<br>       <span class="hljs-comment">//åˆ¤æ–­å½“å‰èœå“æ˜¯å¦èƒ½å¤Ÿåˆ é™¤---æ˜¯å¦å­˜åœ¨èµ·å”®ä¸­çš„èœå“ï¼Ÿï¼Ÿ</span><br>       <span class="hljs-keyword">for</span> (Long id : ids) &#123;<br>           <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> dishMapper.getById(id);<span class="hljs-comment">//åç»ªæ­¥éª¤å®ç°</span><br>           <span class="hljs-keyword">if</span> (dish.getStatus() == StatusConstant.ENABLE) &#123;<br>               <span class="hljs-comment">//å½“å‰èœå“å¤„äºèµ·å”®ä¸­ï¼Œä¸èƒ½åˆ é™¤</span><br>               <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_ON_SALE);<br>           &#125;<br>       &#125;<br><br>       <span class="hljs-comment">//åˆ¤æ–­å½“å‰èœå“æ˜¯å¦èƒ½å¤Ÿåˆ é™¤---æ˜¯å¦è¢«å¥—é¤å…³è”äº†ï¼Ÿï¼Ÿ</span><br>       List&lt;Long&gt; setmealIds = setmealDishMapper.getSetmealIdsByDishIds(ids);<br>       <span class="hljs-keyword">if</span> (setmealIds != <span class="hljs-literal">null</span> &amp;&amp; setmealIds.size() &gt; <span class="hljs-number">0</span>) &#123;<br>           <span class="hljs-comment">//å½“å‰èœå“è¢«å¥—é¤å…³è”äº†ï¼Œä¸èƒ½åˆ é™¤</span><br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_BE_RELATED_BY_SETMEAL);<br>       &#125;<br><br>       <span class="hljs-comment">//åˆ é™¤èœå“è¡¨ä¸­çš„èœå“æ•°æ®</span><br>       <span class="hljs-keyword">for</span> (Long id : ids) &#123;<br>           dishMapper.deleteById(id);<br>           <span class="hljs-comment">//åˆ é™¤èœå“å…³è”çš„å£å‘³æ•°æ®</span><br>           dishFlavorMapper.deleteByDishId(id);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="5-3-Mapperå±‚"><a href="#5-3-Mapperå±‚" class="headerlink" title="5.3 Mapperå±‚"></a>5.3 Mapperå±‚</h3><p><strong>åœ¨DishMapperä¸­å£°æ˜getByIdæ–¹æ³•ï¼Œå¹¶é…ç½®SQLï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®ä¸»é”®æŸ¥è¯¢èœå“</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select * from dish where id = #&#123;id&#125;&quot;)</span><br>   Dish <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºSetmealDishMapperï¼Œå£°æ˜getSetmealIdsByDishIdsæ–¹æ³•ï¼Œå¹¶åœ¨xmlæ–‡ä»¶ä¸­ç¼–å†™SQLï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.SetmealDish;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Delete;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SetmealDishMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®èœå“idæŸ¥è¯¢å¯¹åº”çš„å¥—é¤id</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dishIds</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//select setmeal_id from setmeal_dish where dish_id in (1,2,3,4)</span><br>    List&lt;Long&gt; <span class="hljs-title function_">getSetmealIdsByDishIds</span><span class="hljs-params">(List&lt;Long&gt; dishIds)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>SetmealDishMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.SetmealDishMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getSetmealIdsByDishIds&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Long&quot;</span>&gt;</span><br>        select setmeal_id from setmeal_dish where dish_id in<br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;dishIds&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;dishId&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span><br>            #&#123;dishId&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>åœ¨DishMapper.javaä¸­å£°æ˜deleteByIdæ–¹æ³•å¹¶é…ç½®SQLï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®ä¸»é”®åˆ é™¤èœå“æ•°æ®</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Delete(&quot;delete from dish where id = #&#123;id&#125;&quot;)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨DishFlavorMapperä¸­å£°æ˜deleteByDishIdæ–¹æ³•å¹¶é…ç½®SQLï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®èœå“idåˆ é™¤å¯¹åº”çš„å£å‘³æ•°æ®</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> dishId</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Delete(&quot;delete from dish_flavor where dish_id = #&#123;dishId&#125;&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteByDishId</span><span class="hljs-params">(Long dishId)</span>;<br></code></pre></td></tr></table></figure>

<h2 id="6-ä¿®æ”¹èœå“"><a href="#6-ä¿®æ”¹èœå“" class="headerlink" title="6. ä¿®æ”¹èœå“"></a>6. ä¿®æ”¹èœå“</h2><h3 id="6-1-Controllerå±‚"><a href="#6-1-Controllerå±‚" class="headerlink" title="6.1 Controllerå±‚"></a>6.1 Controllerå±‚</h3><p><strong>æ ¹æ®ä¿®æ”¹èœå“çš„æ¥å£å®šä¹‰åœ¨DishControllerä¸­åˆ›å»ºæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ä¿®æ”¹èœå“</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PutMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;ä¿®æ”¹èœå“&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;ä¿®æ”¹èœå“ï¼š&#123;&#125;&quot;</span>, dishDTO);<br>       dishService.updateWithFlavor(dishDTO);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="6-2-Serviceå±‚"><a href="#6-2-Serviceå±‚" class="headerlink" title="6.2 Serviceå±‚"></a>6.2 Serviceå±‚</h3><h4 id="6-2-1-Serviceå±‚æ¥å£"><a href="#6-2-1-Serviceå±‚æ¥å£" class="headerlink" title="6.2.1 Serviceå±‚æ¥å£"></a>6.2.1 Serviceå±‚æ¥å£</h4><p><strong>åœ¨DishServiceæ¥å£ä¸­å£°æ˜updateWithFlavoræ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®idä¿®æ”¹èœå“åŸºæœ¬ä¿¡æ¯å’Œå¯¹åº”çš„å£å‘³ä¿¡æ¯</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWithFlavor</span><span class="hljs-params">(DishDTO dishDTO)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="6-2-2-Serviceå±‚å®ç°ç±»"><a href="#6-2-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="6.2.2 Serviceå±‚å®ç°ç±»"></a>6.2.2 Serviceå±‚å®ç°ç±»</h4><p><strong>åœ¨DishServiceImplä¸­å®ç°updateWithFlavoræ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®idä¿®æ”¹èœå“åŸºæœ¬ä¿¡æ¯å’Œå¯¹åº”çš„å£å‘³ä¿¡æ¯</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWithFlavor</span><span class="hljs-params">(DishDTO dishDTO)</span> &#123;<br>       <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>       BeanUtils.copyProperties(dishDTO, dish);<br><br>       <span class="hljs-comment">//ä¿®æ”¹èœå“è¡¨åŸºæœ¬ä¿¡æ¯</span><br>       dishMapper.update(dish);<br><br>       <span class="hljs-comment">//åˆ é™¤åŸæœ‰çš„å£å‘³æ•°æ®</span><br>       dishFlavorMapper.deleteByDishId(dishDTO.getId());<br><br>       <span class="hljs-comment">//é‡æ–°æ’å…¥å£å‘³æ•°æ®</span><br>       List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();<br>       <span class="hljs-keyword">if</span> (flavors != <span class="hljs-literal">null</span> &amp;&amp; flavors.size() &gt; <span class="hljs-number">0</span>) &#123;<br>           flavors.forEach(dishFlavor -&gt; &#123;<br>               dishFlavor.setDishId(dishDTO.getId());<br>           &#125;);<br>           <span class="hljs-comment">//å‘å£å‘³è¡¨æ’å…¥næ¡æ•°æ®</span><br>           dishFlavorMapper.insertBatch(flavors);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="6-3-Mapperå±‚"><a href="#6-3-Mapperå±‚" class="headerlink" title="6.3 Mapperå±‚"></a>6.3 Mapperå±‚</h3><p><strong>åœ¨DishMapperä¸­ï¼Œå£°æ˜updateæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®idåŠ¨æ€ä¿®æ”¹èœå“æ•°æ®</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@AutoFill(value = OperationType.UPDATE)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Dish dish)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>å¹¶åœ¨DishMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™SQL:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span>&gt;</span><br>        update dish<br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span>name = #&#123;name&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span>category_id = #&#123;categoryId&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;price != null&quot;</span>&gt;</span>price = #&#123;price&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;image != null&quot;</span>&gt;</span>image = #&#123;image&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;description != null&quot;</span>&gt;</span>description = #&#123;description&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span>status = #&#123;status&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;updateTime != null&quot;</span>&gt;</span>update_time = #&#123;updateTime&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;updateUser != null&quot;</span>&gt;</span>update_user = #&#123;updateUser&#125;,<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>        where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="7-èœå“èµ·å”®åœå”®åŠŸèƒ½"><a href="#7-èœå“èµ·å”®åœå”®åŠŸèƒ½" class="headerlink" title="7. èœå“èµ·å”®åœå”®åŠŸèƒ½"></a>7. èœå“èµ·å”®åœå”®åŠŸèƒ½</h2><h3 id="7-1-Controllerå±‚"><a href="#7-1-Controllerå±‚" class="headerlink" title="7.1  Controllerå±‚"></a>7.1  Controllerå±‚</h3><p><strong>DishController</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * èœå“èµ·å”®åœå”®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;èœå“èµ·å”®åœå”®&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status, Long id)</span>&#123;<br>    dishService.startOrStop(status,id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="7-2-Serviceå±‚"><a href="#7-2-Serviceå±‚" class="headerlink" title="7.2 Serviceå±‚"></a>7.2 Serviceå±‚</h3><h4 id="7-2-1-DishServiceæ¥å£"><a href="#7-2-1-DishServiceæ¥å£" class="headerlink" title="7.2.1 DishServiceæ¥å£"></a>7.2.1 DishServiceæ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * èœå“èµ·å”®åœå”®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="7-2-2-DishServiceImplå®ç°ç±»"><a href="#7-2-2-DishServiceImplå®ç°ç±»" class="headerlink" title="7.2.2 DishServiceImplå®ç°ç±»"></a>7.2.2 DishServiceImplå®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowire</span><br><span class="hljs-keyword">private</span> SetmealMapper setmealMapper;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * èœå“èµ·å”®åœå”®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span> &#123;<br>    <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> Dish.builder()<br>        .id(id)<br>        .status(status)<br>        .build();<br>    dishMapper.update(dish);<br><br>    <span class="hljs-keyword">if</span> (status == StatusConstant.DISABLE) &#123;<br>        <span class="hljs-comment">// å¦‚æœæ˜¯åœå”®æ“ä½œï¼Œè¿˜éœ€è¦å°†åŒ…å«å½“å‰èœå“çš„å¥—é¤ä¹Ÿåœå”®</span><br>        List&lt;Long&gt; dishIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        dishIds.add(id);<br>        <span class="hljs-comment">// select setmeal_id from setmeal_dish where dish_id in (?,?,?)</span><br>        List&lt;Long&gt; setmealIds = setmealDishMapper.getSetmealIdsByDishIds(dishIds);<br>        <span class="hljs-keyword">if</span> (setmealIds != <span class="hljs-literal">null</span> &amp;&amp; setmealIds.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Long setmealId : setmealIds) &#123;<br>                <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> Setmeal.builder()<br>                    .id(setmealId)<br>                    .status(StatusConstant.DISABLE)<br>                    .build();<br>                setmealMapper.update(setmeal);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="7-3-Mapperå±‚"><a href="#7-3-Mapperå±‚" class="headerlink" title="7.3 Mapperå±‚"></a>7.3 Mapperå±‚</h3><h4 id="7-3-1-SetmealMapper"><a href="#7-3-1-SetmealMapper" class="headerlink" title="7.3.1 SetmealMapper"></a>7.3.1 SetmealMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idä¿®æ”¹å¥—é¤</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@AutoFill(OperationType.UPDATE)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Setmeal setmeal)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="7-3-2-SetmealMapper-xml"><a href="#7-3-2-SetmealMapper-xml" class="headerlink" title="7.3.2 SetmealMapper.xml"></a>7.3.2 SetmealMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.SetmealMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Setmeal&quot;</span>&gt;</span><br>        update setmeal<br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>                name = #&#123;name&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>                category_id = #&#123;categoryId&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;price != null&quot;</span>&gt;</span><br>                price = #&#123;price&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                status = #&#123;status&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;description != null&quot;</span>&gt;</span><br>                description = #&#123;description&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;image != null&quot;</span>&gt;</span><br>                image = #&#123;image&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;updateTime != null&quot;</span>&gt;</span><br>                update_time = #&#123;updateTime&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;updateUser != null&quot;</span>&gt;</span><br>                update_user = #&#123;updateUser&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>        where id = #&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h1 id="å››-å¥—é¤ç®¡ç†"><a href="#å››-å¥—é¤ç®¡ç†" class="headerlink" title="å››. å¥—é¤ç®¡ç†"></a>å››. å¥—é¤ç®¡ç†</h1><h2 id="1-æ–°å¢å¥—é¤"><a href="#1-æ–°å¢å¥—é¤" class="headerlink" title="1. æ–°å¢å¥—é¤"></a>1. æ–°å¢å¥—é¤</h2><h3 id="1-1-Controllerå±‚"><a href="#1-1-Controllerå±‚" class="headerlink" title="1.1 Controllerå±‚"></a>1.1 Controllerå±‚</h3><p><strong>DishController</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;List&lt;Dish&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span>&#123;<br>    List&lt;Dish&gt; list = dishService.list(categoryId);<br>    <span class="hljs-keyword">return</span> Result.success(list);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-Serviceå±‚"><a href="#1-2-Serviceå±‚" class="headerlink" title="1.2 Serviceå±‚"></a>1.2 Serviceå±‚</h3><h4 id="1-2-1-Serviceå±‚æ¥å£"><a href="#1-2-1-Serviceå±‚æ¥å£" class="headerlink" title="1.2.1 Serviceå±‚æ¥å£"></a>1.2.1 Serviceå±‚æ¥å£</h4><p><strong>DishService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>List&lt;Dish&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-2-2-Serviceå±‚å®ç°ç±»"><a href="#1-2-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="1.2.2 Serviceå±‚å®ç°ç±»"></a>1.2.2 Serviceå±‚å®ç°ç±»</h4><p><strong>DishServiceImpl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> List&lt;Dish&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br>    <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> Dish.builder()<br>        .categoryId(categoryId)<br>        .status(StatusConstant.ENABLE)<br>        .build();<br>    <span class="hljs-keyword">return</span> dishMapper.list(dish);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-Mapperå±‚"><a href="#1-3-Mapperå±‚" class="headerlink" title="1.3 Mapperå±‚"></a>1.3 Mapperå±‚</h3><h4 id="1-3-1-DishMapper"><a href="#1-3-1-DishMapper" class="headerlink" title="1.3.1 DishMapper"></a>1.3.1 DishMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŠ¨æ€æ¡ä»¶æŸ¥è¯¢èœå“</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>List&lt;Dish&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Dish dish)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-2-DishMapper-xml"><a href="#1-3-2-DishMapper-xml" class="headerlink" title="1.3.2 DishMapper.xml"></a>1.3.2 DishMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Dish&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Dish&quot;</span>&gt;</span><br>    select * from dish<br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>            and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>            and category_id = #&#123;categoryId&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>            and status = #&#123;status&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    order by create_time desc<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-4-SetmealController"><a href="#1-4-SetmealController" class="headerlink" title="1.4 SetmealController"></a>1.4 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¥—é¤ç®¡ç†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/setmeal&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;å¥—é¤ç›¸å…³æ¥å£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealService setmealService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢å¥—é¤</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-meta">@ApiOperation(&quot;æ–°å¢å¥—é¤&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;<br>        setmealService.saveWithDish(setmealDTO);<br>        <span class="hljs-keyword">return</span> Result.success();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-5-Serviceå±‚"><a href="#1-5-Serviceå±‚" class="headerlink" title="1.5 Serviceå±‚"></a>1.5 Serviceå±‚</h3><h4 id="1-5-1-SetmealServiceæ¥å£"><a href="#1-5-1-SetmealServiceæ¥å£" class="headerlink" title="1.5.1 SetmealServiceæ¥å£"></a>1.5.1 SetmealServiceæ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SetmealService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢å¥—é¤ï¼ŒåŒæ—¶éœ€è¦ä¿å­˜å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithDish</span><span class="hljs-params">(SetmealDTO setmealDTO)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="1-5-2-SetmealServiceImplå®ç°ç±»"><a href="#1-5-2-SetmealServiceImplå®ç°ç±»" class="headerlink" title="1.5.2 SetmealServiceImplå®ç°ç±»"></a>1.5.2 SetmealServiceImplå®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¥—é¤ä¸šåŠ¡å®ç°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SetmealService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealMapper setmealMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealDishMapper setmealDishMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishMapper dishMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢å¥—é¤ï¼ŒåŒæ—¶éœ€è¦ä¿å­˜å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveWithDish</span><span class="hljs-params">(SetmealDTO setmealDTO)</span> &#123;<br>        <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Setmeal</span>();<br>        BeanUtils.copyProperties(setmealDTO, setmeal);<br><br>        <span class="hljs-comment">//å‘å¥—é¤è¡¨æ’å…¥æ•°æ®</span><br>        setmealMapper.insert(setmeal);<br><br>        <span class="hljs-comment">//è·å–ç”Ÿæˆçš„å¥—é¤id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">setmealId</span> <span class="hljs-operator">=</span> setmeal.getId();<br><br>        List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();<br>        setmealDishes.forEach(setmealDish -&gt; &#123;<br>            setmealDish.setSetmealId(setmealId);<br>        &#125;);<br><br>        <span class="hljs-comment">//ä¿å­˜å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span><br>        setmealDishMapper.insertBatch(setmealDishes);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-6-Mapperå±‚"><a href="#1-6-Mapperå±‚" class="headerlink" title="1.6 Mapperå±‚"></a>1.6 Mapperå±‚</h3><h4 id="1-6-1-SetmealMapper"><a href="#1-6-1-SetmealMapper" class="headerlink" title="1.6.1 SetmealMapper"></a>1.6.1 SetmealMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢å¥—é¤</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@AutoFill(OperationType.INSERT)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Setmeal setmeal)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-6-2-SetmealMapper-xml"><a href="#1-6-2-SetmealMapper-xml" class="headerlink" title="1.6.2 SetmealMapper.xml"></a>1.6.2 SetmealMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Setmeal&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>    insert into setmeal<br>    (category_id, name, price, status, description, image, create_time, update_time, create_user, update_user)<br>    values (#&#123;categoryId&#125;, #&#123;name&#125;, #&#123;price&#125;, #&#123;status&#125;, #&#123;description&#125;, #&#123;image&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;,<br>    #&#123;createUser&#125;, #&#123;updateUser&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="1-6-3-SetmealDishMapper"><a href="#1-6-3-SetmealDishMapper" class="headerlink" title="1.6.3 SetmealDishMapper"></a>1.6.3 SetmealDishMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰¹é‡ä¿å­˜å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDishes</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBatch</span><span class="hljs-params">(List&lt;SetmealDish&gt; setmealDishes)</span>;<br></code></pre></td></tr></table></figure>

<h4 id="1-6-4-SetmealDishMapper-xml"><a href="#1-6-4-SetmealDishMapper-xml" class="headerlink" title="1.6.4 SetmealDishMapper.xml"></a>1.6.4 SetmealDishMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertBatch&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>    insert into setmeal_dish<br>    (setmeal_id,dish_id,name,price,copies)<br>    values<br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;setmealDishes&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;sd&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>        (#&#123;sd.setmealId&#125;,#&#123;sd.dishId&#125;,#&#123;sd.name&#125;,#&#123;sd.price&#125;,#&#123;sd.copies&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="2-å¥—é¤åˆ†é¡µæŸ¥è¯¢"><a href="#2-å¥—é¤åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="2. å¥—é¤åˆ†é¡µæŸ¥è¯¢"></a>2. å¥—é¤åˆ†é¡µæŸ¥è¯¢</h2><h3 id="2-1-SetmealController"><a href="#2-1-SetmealController" class="headerlink" title="2.1 SetmealController"></a>2.1 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;åˆ†é¡µæŸ¥è¯¢&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;<br>    <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> setmealService.pageQuery(setmealPageQueryDTO);<br>    <span class="hljs-keyword">return</span> Result.success(pageResult);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-SetmealService"><a href="#2-2-SetmealService" class="headerlink" title="2.2 SetmealService"></a>2.2 SetmealService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(SetmealPageQueryDTO setmealPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-SetmealServiceImpl"><a href="#2-3-SetmealServiceImpl" class="headerlink" title="2.3 SetmealServiceImpl"></a>2.3 SetmealServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">pageNum</span> <span class="hljs-operator">=</span> setmealPageQueryDTO.getPage();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> setmealPageQueryDTO.getPageSize();<br><br>    PageHelper.startPage(pageNum, pageSize);<br>    Page&lt;SetmealVO&gt; page = setmealMapper.pageQuery(setmealPageQueryDTO);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(page.getTotal(), page.getResult());<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-SetmealMapper"><a href="#2-4-SetmealMapper" class="headerlink" title="2.4 SetmealMapper"></a>2.4 SetmealMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>Page&lt;SetmealVO&gt; <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(SetmealPageQueryDTO setmealPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-5-SetmealMapper-xml"><a href="#2-5-SetmealMapper-xml" class="headerlink" title="2.5 SetmealMapper.xml"></a>2.5 SetmealMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pageQuery&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sky.vo.SetmealVO&quot;</span>&gt;</span><br>    select<br>    	s.*,c.name categoryName<br>    from<br>    	setmeal s<br>    left join<br>    	category c<br>    on<br>    	s.category_id = c.id<br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>            and s.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>            and s.status = #&#123;status&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>            and s.category_id = #&#123;categoryId&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    order by s.create_time desc<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="3-åˆ é™¤å¥—é¤"><a href="#3-åˆ é™¤å¥—é¤" class="headerlink" title="3. åˆ é™¤å¥—é¤"></a>3. åˆ é™¤å¥—é¤</h2><h3 id="3-1-SetmealController"><a href="#3-1-SetmealController" class="headerlink" title="3.1 SetmealController"></a>3.1 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰¹é‡åˆ é™¤å¥—é¤</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-meta">@ApiOperation(&quot;æ‰¹é‡åˆ é™¤å¥—é¤&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;<br>    setmealService.deleteBatch(ids);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-SetmealService"><a href="#3-2-SetmealService" class="headerlink" title="3.2 SetmealService"></a>3.2 SetmealService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰¹é‡åˆ é™¤å¥—é¤</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBatch</span><span class="hljs-params">(List&lt;Long&gt; ids)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-SetmealServiceImpl"><a href="#3-3-SetmealServiceImpl" class="headerlink" title="3.3 SetmealServiceImpl"></a>3.3 SetmealServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰¹é‡åˆ é™¤å¥—é¤</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBatch</span><span class="hljs-params">(List&lt;Long&gt; ids)</span> &#123;<br>    ids.forEach(id -&gt; &#123;<br>        <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> setmealMapper.getById(id);<br>        <span class="hljs-keyword">if</span>(StatusConstant.ENABLE == setmeal.getStatus())&#123;<br>            <span class="hljs-comment">//èµ·å”®ä¸­çš„å¥—é¤ä¸èƒ½åˆ é™¤</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeletionNotAllowedException</span>(MessageConstant.SETMEAL_ON_SALE);<br>        &#125;<br>    &#125;);<br><br>    ids.forEach(setmealId -&gt; &#123;<br>        <span class="hljs-comment">//åˆ é™¤å¥—é¤è¡¨ä¸­çš„æ•°æ®</span><br>        setmealMapper.deleteById(setmealId);<br>        <span class="hljs-comment">//åˆ é™¤å¥—é¤èœå“å…³ç³»è¡¨ä¸­çš„æ•°æ®</span><br>        setmealDishMapper.deleteBySetmealId(setmealId);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-4-SetmealMapper"><a href="#3-4-SetmealMapper" class="headerlink" title="3.4 SetmealMapper"></a>3.4 SetmealMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idæŸ¥è¯¢å¥—é¤</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Select(&quot;select * from setmeal where id = #&#123;id&#125;&quot;)</span><br>Setmeal <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idåˆ é™¤å¥—é¤</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Delete(&quot;delete from setmeal where id = #&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="3-5-SetmealDishMapper"><a href="#3-5-SetmealDishMapper" class="headerlink" title="3.5 SetmealDishMapper"></a>3.5 SetmealDishMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®å¥—é¤idåˆ é™¤å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Delete(&quot;delete from setmeal_dish where setmeal_id = #&#123;setmealId&#125;&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBySetmealId</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>


<h2 id="4-ä¿®æ”¹å¥—é¤"><a href="#4-ä¿®æ”¹å¥—é¤" class="headerlink" title="4. ä¿®æ”¹å¥—é¤"></a>4. ä¿®æ”¹å¥—é¤</h2><h3 id="4-1-SetmealController"><a href="#4-1-SetmealController" class="headerlink" title="4.1 SetmealController"></a>4.1 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idæŸ¥è¯¢å¥—é¤ï¼Œç”¨äºä¿®æ”¹é¡µé¢å›æ˜¾æ•°æ®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢å¥—é¤&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;SetmealVO&gt; <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>    <span class="hljs-type">SetmealVO</span> <span class="hljs-variable">setmealVO</span> <span class="hljs-operator">=</span> setmealService.getByIdWithDish(id);<br>    <span class="hljs-keyword">return</span> Result.success(setmealVO);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¿®æ”¹å¥—é¤</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PutMapping</span><br><span class="hljs-meta">@ApiOperation(&quot;ä¿®æ”¹å¥—é¤&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;<br>    setmealService.update(setmealDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-SetmealService"><a href="#4-2-SetmealService" class="headerlink" title="4.2 SetmealService"></a>4.2 SetmealService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idæŸ¥è¯¢å¥—é¤å’Œå…³è”çš„èœå“æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>SetmealVO <span class="hljs-title function_">getByIdWithDish</span><span class="hljs-params">(Long id)</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¿®æ”¹å¥—é¤</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(SetmealDTO setmealDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-SetmealServiceImpl"><a href="#4-3-SetmealServiceImpl" class="headerlink" title="4.3 SetmealServiceImpl"></a>4.3 SetmealServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idæŸ¥è¯¢å¥—é¤å’Œå¥—é¤èœå“å…³ç³»</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> SetmealVO <span class="hljs-title function_">getByIdWithDish</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> setmealMapper.getById(id);<br>    List&lt;SetmealDish&gt; setmealDishes = setmealDishMapper.getBySetmealId(id);<br><br>    <span class="hljs-type">SetmealVO</span> <span class="hljs-variable">setmealVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetmealVO</span>();<br>    BeanUtils.copyProperties(setmeal, setmealVO);<br>    setmealVO.setSetmealDishes(setmealDishes);<br>    <br>    <span class="hljs-keyword">return</span> setmealVO;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¿®æ”¹å¥—é¤</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(SetmealDTO setmealDTO)</span> &#123;<br>    <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Setmeal</span>();<br>    BeanUtils.copyProperties(setmealDTO, setmeal);<br><br>    <span class="hljs-comment">//1ã€ä¿®æ”¹å¥—é¤è¡¨ï¼Œæ‰§è¡Œupdate</span><br>    setmealMapper.update(setmeal);<br><br>    <span class="hljs-comment">//å¥—é¤id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">setmealId</span> <span class="hljs-operator">=</span> setmealDTO.getId();<br><br>    <span class="hljs-comment">//2ã€åˆ é™¤å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»ï¼Œæ“ä½œsetmeal_dishè¡¨ï¼Œæ‰§è¡Œdelete</span><br>    setmealDishMapper.deleteBySetmealId(setmealId);<br><br>    List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();<br>    setmealDishes.forEach(setmealDish -&gt; &#123;<br>        setmealDish.setSetmealId(setmealId);<br>    &#125;);<br>    <span class="hljs-comment">//3ã€é‡æ–°æ’å…¥å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»ï¼Œæ“ä½œsetmeal_dishè¡¨ï¼Œæ‰§è¡Œinsert</span><br>    setmealDishMapper.insertBatch(setmealDishes);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-SetmealDishMapper"><a href="#4-4-SetmealDishMapper" class="headerlink" title="4.4 SetmealDishMapper"></a>4.4 SetmealDishMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®å¥—é¤idæŸ¥è¯¢å¥—é¤å’Œèœå“çš„å…³è”å…³ç³»</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select * from setmeal_dish where setmeal_id = #&#123;setmealId&#125;&quot;)</span><br>   List&lt;SetmealDish&gt; <span class="hljs-title function_">getBySetmealId</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>

<h2 id="5-èµ·å”®åœå”®å¥—é¤"><a href="#5-èµ·å”®åœå”®å¥—é¤" class="headerlink" title="5. èµ·å”®åœå”®å¥—é¤"></a>5. èµ·å”®åœå”®å¥—é¤</h2><h3 id="5-1-SetmealController"><a href="#5-1-SetmealController" class="headerlink" title="5.1 SetmealController"></a>5.1 SetmealController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¥—é¤èµ·å”®åœå”®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å¥—é¤èµ·å”®åœå”®&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status, Long id)</span> &#123;<br>    setmealService.startOrStop(status, id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-2-SetmealService"><a href="#5-2-SetmealService" class="headerlink" title="5.2 SetmealService"></a>5.2 SetmealService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¥—é¤èµ·å”®ã€åœå”®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="5-3-SetmealServiceImpl"><a href="#5-3-SetmealServiceImpl" class="headerlink" title="5.3 SetmealServiceImpl"></a>5.3 SetmealServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¥—é¤èµ·å”®ã€åœå”®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(Integer status, Long id)</span> &#123;<br>    <span class="hljs-comment">//èµ·å”®å¥—é¤æ—¶ï¼Œåˆ¤æ–­å¥—é¤å†…æ˜¯å¦æœ‰åœå”®èœå“ï¼Œæœ‰åœå”®èœå“æç¤º&quot;å¥—é¤å†…åŒ…å«æœªå¯å”®èœå“ï¼Œæ— æ³•å¯å”®&quot;</span><br>    <span class="hljs-keyword">if</span>(status == StatusConstant.ENABLE)&#123;<br>        <span class="hljs-comment">//select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = ?</span><br>        List&lt;Dish&gt; dishList = dishMapper.getBySetmealId(id);<br>        <span class="hljs-keyword">if</span>(dishList != <span class="hljs-literal">null</span> &amp;&amp; dishList.size() &gt; <span class="hljs-number">0</span>)&#123;<br>            dishList.forEach(dish -&gt; &#123;<br>                <span class="hljs-keyword">if</span>(StatusConstant.DISABLE == dish.getStatus())&#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetmealEnableFailedException</span>(MessageConstant.SETMEAL_ENABLE_FAILED);<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> Setmeal.builder()<br>        .id(id)<br>        .status(status)<br>        .build();<br>    setmealMapper.update(setmeal);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-4-DishMapper"><a href="#5-4-DishMapper" class="headerlink" title="5.4 DishMapper"></a>5.4 DishMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®å¥—é¤idæŸ¥è¯¢èœå“</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Select(&quot;select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = #&#123;setmealId&#125;&quot;)</span><br>List&lt;Dish&gt; <span class="hljs-title function_">getBySetmealId</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>


<h1 id="äº”-Redis"><a href="#äº”-Redis" class="headerlink" title="äº”. Redis"></a>äº”. Redis</h1><h2 id="1-Redisç®€ä»‹"><a href="#1-Redisç®€ä»‹" class="headerlink" title="1. Redisç®€ä»‹"></a>1. Redisç®€ä»‹</h2><p>Redisæ˜¯ä¸€ä¸ªåŸºäº<strong>å†…å­˜</strong>çš„key-valueç»“æ„æ•°æ®åº“ã€‚Redis æ˜¯äº’è”ç½‘æŠ€æœ¯é¢†åŸŸä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„<strong>å­˜å‚¨ä¸­é—´ä»¶</strong>ã€‚</p>
<p><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>åŸºäºå†…å­˜å­˜å‚¨ï¼Œè¯»å†™æ€§èƒ½é«˜  </li>
<li>é€‚åˆå­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼ˆçƒ­ç‚¹å•†å“ã€èµ„è®¯ã€æ–°é—»ï¼‰</li>
<li>ä¼ä¸šåº”ç”¨å¹¿æ³›</li>
</ul>
<p><strong>å¯åŠ¨Redis</strong>:åœ¨Rediså®‰è£…ç›®å½•cmdä»¥ä¸‹å‘½ä»¤<br><code>redis-server.exe redis.windows.conf</code></p>
<h2 id="2-Redisæ•°æ®ç±»å‹"><a href="#2-Redisæ•°æ®ç±»å‹" class="headerlink" title="2. Redisæ•°æ®ç±»å‹"></a>2. Redisæ•°æ®ç±»å‹</h2><h3 id="2-1-äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹ä»‹ç»"><a href="#2-1-äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹ä»‹ç»" class="headerlink" title="2.1 äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹ä»‹ç»"></a>2.1 äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹ä»‹ç»</h3><p>Rediså­˜å‚¨çš„æ˜¯key-valueç»“æ„çš„æ•°æ®ï¼Œå…¶ä¸­keyæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œvalueæœ‰5ç§å¸¸ç”¨çš„æ•°æ®ç±»å‹:</p>
<ul>
<li>å­—ç¬¦ä¸² string</li>
<li>å“ˆå¸Œ hash</li>
<li>åˆ—è¡¨ list</li>
<li>é›†åˆ set</li>
<li>æœ‰åºé›†åˆ sorted set &#x2F; zset</li>
</ul>
<h3 id="2-2-å„ç§æ•°æ®ç±»å‹ç‰¹ç‚¹"><a href="#2-2-å„ç§æ•°æ®ç±»å‹ç‰¹ç‚¹" class="headerlink" title="2.2 å„ç§æ•°æ®ç±»å‹ç‰¹ç‚¹"></a>2.2 å„ç§æ•°æ®ç±»å‹ç‰¹ç‚¹</h3><p><img src="/img/blogs/java/cangqiongtakeout/5.2.1.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>è§£é‡Šè¯´æ˜ï¼š</strong></p>
<ul>
<li>å­—ç¬¦ä¸²(string)ï¼šæ™®é€šå­—ç¬¦ä¸²ï¼ŒRedisä¸­æœ€ç®€å•çš„æ•°æ®ç±»å‹</li>
<li>å“ˆå¸Œ(hash)ï¼šä¹Ÿå«æ•£åˆ—ï¼Œç±»ä¼¼äºJavaä¸­çš„HashMapç»“æ„</li>
<li>åˆ—è¡¨(list)ï¼šæŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œå¯ä»¥æœ‰é‡å¤å…ƒç´ ï¼Œç±»ä¼¼äºJavaä¸­çš„LinkedList</li>
<li>é›†åˆ(set)ï¼šæ— åºé›†åˆï¼Œæ²¡æœ‰é‡å¤å…ƒç´ ï¼Œç±»ä¼¼äºJavaä¸­çš„HashSet</li>
<li>æœ‰åºé›†åˆ(sorted set&#x2F;zset)ï¼šé›†åˆä¸­æ¯ä¸ªå…ƒç´ å…³è”ä¸€ä¸ªåˆ†æ•°(score)ï¼Œæ ¹æ®åˆ†æ•°å‡åºæ’åºï¼Œæ²¡æœ‰é‡å¤å…ƒç´ </li>
</ul>
<h2 id="3-Rediså¸¸ç”¨å‘½ä»¤"><a href="#3-Rediså¸¸ç”¨å‘½ä»¤" class="headerlink" title="3. Rediså¸¸ç”¨å‘½ä»¤"></a>3. Rediså¸¸ç”¨å‘½ä»¤</h2><h3 id="3-1-å­—ç¬¦ä¸²æ“ä½œå‘½ä»¤"><a href="#3-1-å­—ç¬¦ä¸²æ“ä½œå‘½ä»¤" class="headerlink" title="3.1 å­—ç¬¦ä¸²æ“ä½œå‘½ä»¤"></a>3.1 å­—ç¬¦ä¸²æ“ä½œå‘½ä»¤</h3><p>Redis ä¸­å­—ç¬¦ä¸²ç±»å‹å¸¸ç”¨å‘½ä»¤ï¼š</p>
<ul>
<li><strong>SET</strong> key value 					         è®¾ç½®æŒ‡å®škeyçš„å€¼</li>
<li><strong>GET</strong> key                                        è·å–æŒ‡å®škeyçš„å€¼</li>
<li><strong>SETEX</strong> key seconds value         è®¾ç½®æŒ‡å®škeyçš„å€¼ï¼Œå¹¶å°† key çš„è¿‡æœŸæ—¶é—´è®¾ä¸º seconds ç§’</li>
<li><strong>SETNX</strong> key value                        åªæœ‰åœ¨ key    ä¸å­˜åœ¨æ—¶è®¾ç½® key çš„å€¼</li>
</ul>
<h3 id="3-2-å“ˆå¸Œæ“ä½œå‘½ä»¤"><a href="#3-2-å“ˆå¸Œæ“ä½œå‘½ä»¤" class="headerlink" title="3.2 å“ˆå¸Œæ“ä½œå‘½ä»¤"></a>3.2 å“ˆå¸Œæ“ä½œå‘½ä»¤</h3><p>Redis hash æ˜¯ä¸€ä¸ªstringç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œå¸¸ç”¨å‘½ä»¤ï¼š</p>
<ul>
<li><strong>HSET</strong> key field value             å°†å“ˆå¸Œè¡¨ key ä¸­çš„å­—æ®µ field çš„å€¼è®¾ä¸º value</li>
<li><strong>HGET</strong> key field                       è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼</li>
<li><strong>HDEL</strong> key field                       åˆ é™¤å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­çš„æŒ‡å®šå­—æ®µ</li>
<li><strong>HKEYS</strong> key                              è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å­—æ®µ</li>
<li><strong>HVALS</strong> key                              è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å€¼</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/5.3.1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-3-åˆ—è¡¨æ“ä½œå‘½ä»¤"><a href="#3-3-åˆ—è¡¨æ“ä½œå‘½ä»¤" class="headerlink" title="3.3 åˆ—è¡¨æ“ä½œå‘½ä»¤"></a>3.3 åˆ—è¡¨æ“ä½œå‘½ä»¤</h3><p>Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œå¸¸ç”¨å‘½ä»¤ï¼š</p>
<ul>
<li><strong>LPUSH</strong> key value1 [value2]         å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨</li>
<li><strong>LRANGE</strong> key start stop                è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ </li>
<li><strong>RPOP</strong> key                                       ç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ </li>
<li><strong>LLEN</strong> key                                        è·å–åˆ—è¡¨é•¿åº¦</li>
<li><strong>BRPOP</strong> key1 [key2 ] timeout       ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…    æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/5.3.2.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-4-é›†åˆæ“ä½œå‘½ä»¤"><a href="#3-4-é›†åˆæ“ä½œå‘½ä»¤" class="headerlink" title="3.4 é›†åˆæ“ä½œå‘½ä»¤"></a>3.4 é›†åˆæ“ä½œå‘½ä»¤</h3><p>Redis set æ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œè¿™å°±æ„å‘³ç€é›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ï¼Œå¸¸ç”¨å‘½ä»¤ï¼š</p>
<ul>
<li><strong>SADD</strong> key member1 [member2]            å‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</li>
<li><strong>SMEMBERS</strong> key                                         è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜</li>
<li><strong>SCARD</strong> key                                                  è·å–é›†åˆçš„æˆå‘˜æ•°</li>
<li><strong>SINTER</strong> key1 [key2]                                   è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›†</li>
<li><strong>SUNION</strong> key1 [key2]                                 è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†</li>
<li><strong>SREM</strong> key member1 [member2]            ç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/5.3.3.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-5-æœ‰åºé›†åˆæ“ä½œå‘½ä»¤"><a href="#3-5-æœ‰åºé›†åˆæ“ä½œå‘½ä»¤" class="headerlink" title="3.5 æœ‰åºé›†åˆæ“ä½œå‘½ä»¤"></a>3.5 æœ‰åºé›†åˆæ“ä½œå‘½ä»¤</h3><p>Redisæœ‰åºé›†åˆæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆï¼Œä¸”ä¸å…è®¸æœ‰é‡å¤æˆå‘˜ã€‚æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚å¸¸ç”¨å‘½ä»¤ï¼š</p>
<p>å¸¸ç”¨å‘½ä»¤ï¼š</p>
<ul>
<li><strong>ZADD</strong> key score1 member1 [score2 member2]     å‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</li>
<li><strong>ZRANGE</strong> key start stop [WITHSCORES]                     é€šè¿‡ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šåŒºé—´å†…çš„æˆå‘˜</li>
<li><strong>ZINCRBY</strong> key increment member                              æœ‰åºé›†åˆä¸­å¯¹æŒ‡å®šæˆå‘˜çš„åˆ†æ•°åŠ ä¸Šå¢é‡ increment</li>
<li><strong>ZREM</strong> key member [member â€¦]                                ç§»é™¤æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</li>
</ul>
<p><img src="/img/blogs/java/cangqiongtakeout/5.3.4.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-6-é€šç”¨å‘½ä»¤"><a href="#3-6-é€šç”¨å‘½ä»¤" class="headerlink" title="3.6 é€šç”¨å‘½ä»¤"></a>3.6 é€šç”¨å‘½ä»¤</h3><p>Redisçš„é€šç”¨å‘½ä»¤æ˜¯ä¸åˆ†æ•°æ®ç±»å‹çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤ï¼š</p>
<ul>
<li>KEYS pattern 		æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼( pattern)çš„ key </li>
<li>EXISTS key 		æ£€æŸ¥ç»™å®š key æ˜¯å¦å­˜åœ¨</li>
<li>TYPE key 		è¿”å› key æ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹</li>
<li>DEL key 		è¯¥å‘½ä»¤ç”¨äºåœ¨ key å­˜åœ¨æ˜¯åˆ é™¤ key</li>
</ul>
<h2 id="4-åœ¨javaä¸­æ“ä½œRedis"><a href="#4-åœ¨javaä¸­æ“ä½œRedis" class="headerlink" title="4. åœ¨javaä¸­æ“ä½œRedis"></a>4. åœ¨javaä¸­æ“ä½œRedis</h2><h3 id="4-1-Spring-Data-Redis"><a href="#4-1-Spring-Data-Redis" class="headerlink" title="4.1 Spring Data Redis"></a>4.1 Spring Data Redis</h3><p>Spring å¯¹ Redis å®¢æˆ·ç«¯è¿›è¡Œäº†æ•´åˆï¼Œæä¾›äº† Spring Data Redisï¼Œæˆ‘ä»¬é‡ç‚¹å­¦ä¹ <strong>Spring Data Redis</strong>ã€‚</p>
<p>Spring Data Redisä¸­æä¾›äº†ä¸€ä¸ªé«˜åº¦å°è£…çš„ç±»ï¼š<strong>RedisTemplate</strong>ï¼Œå¯¹ç›¸å…³apiè¿›è¡Œäº†å½’ç±»å°è£…,å°†åŒä¸€ç±»å‹æ“ä½œå°è£…ä¸ºoperationæ¥å£ï¼Œå…·ä½“åˆ†ç±»å¦‚ä¸‹ï¼š</p>
<ul>
<li>ValueOperationsï¼šstringæ•°æ®æ“ä½œ</li>
<li>SetOperationsï¼šsetç±»å‹æ•°æ®æ“ä½œ</li>
<li>ZSetOperationsï¼šzsetç±»å‹æ•°æ®æ“ä½œ</li>
<li>HashOperationsï¼šhashç±»å‹çš„æ•°æ®æ“ä½œ</li>
<li>ListOperationsï¼šlistç±»å‹çš„æ•°æ®æ“ä½œ</li>
</ul>
<h3 id="4-2-é€šè¿‡RedisTemplateå¯¹è±¡æ“ä½œRedis"><a href="#4-2-é€šè¿‡RedisTemplateå¯¹è±¡æ“ä½œRedis" class="headerlink" title="4.2 é€šè¿‡RedisTemplateå¯¹è±¡æ“ä½œRedis"></a>4.2 é€šè¿‡RedisTemplateå¯¹è±¡æ“ä½œRedis</h3><p>åœ¨testä¸‹æ–°å»ºæµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.test;<br><br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.*;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringDataRedisTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedisTemplate</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(redisTemplate);<br>        <span class="hljs-comment">//stringæ•°æ®æ“ä½œ</span><br>        <span class="hljs-type">ValueOperations</span> <span class="hljs-variable">valueOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue();<br>        <span class="hljs-comment">//hashç±»å‹çš„æ•°æ®æ“ä½œ</span><br>        <span class="hljs-type">HashOperations</span> <span class="hljs-variable">hashOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForHash();<br>        <span class="hljs-comment">//listç±»å‹çš„æ•°æ®æ“ä½œ</span><br>        <span class="hljs-type">ListOperations</span> <span class="hljs-variable">listOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForList();<br>        <span class="hljs-comment">//setç±»å‹æ•°æ®æ“ä½œ</span><br>        <span class="hljs-type">SetOperations</span> <span class="hljs-variable">setOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForSet();<br>        <span class="hljs-comment">//zsetç±»å‹æ•°æ®æ“ä½œ</span><br>        <span class="hljs-type">ZSetOperations</span> <span class="hljs-variable">zSetOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForZSet();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-æ“ä½œå¸¸è§ç±»å‹æ•°æ®"><a href="#4-3-æ“ä½œå¸¸è§ç±»å‹æ•°æ®" class="headerlink" title="4.3 æ“ä½œå¸¸è§ç±»å‹æ•°æ®"></a>4.3 æ“ä½œå¸¸è§ç±»å‹æ•°æ®</h3><p><strong>1). æ“ä½œå­—ç¬¦ä¸²ç±»å‹æ•°æ®</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ“ä½œå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testString</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">// set get setex setnx</span><br>    redisTemplate.opsForValue().set(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;å°æ˜&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">city</span> <span class="hljs-operator">=</span> (String) redisTemplate.opsForValue().get(<span class="hljs-string">&quot;name&quot;</span>);<br>    System.out.println(city);<br>    redisTemplate.opsForValue().set(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-string">&quot;1234&quot;</span>,<span class="hljs-number">3</span>, TimeUnit.MINUTES);<br>    redisTemplate.opsForValue().setIfAbsent(<span class="hljs-string">&quot;lock&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>);<br>    redisTemplate.opsForValue().setIfAbsent(<span class="hljs-string">&quot;lock&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>2). æ“ä½œå“ˆå¸Œç±»å‹æ•°æ®</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ“ä½œå“ˆå¸Œç±»å‹çš„æ•°æ®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testHash</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//hset hget hdel hkeys hvals</span><br>    <span class="hljs-type">HashOperations</span> <span class="hljs-variable">hashOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForHash();<br><br>    hashOperations.put(<span class="hljs-string">&quot;100&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;tom&quot;</span>);<br>    hashOperations.put(<span class="hljs-string">&quot;100&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-string">&quot;20&quot;</span>);<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) hashOperations.get(<span class="hljs-string">&quot;100&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>);<br>    System.out.println(name);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">keys</span> <span class="hljs-operator">=</span> hashOperations.keys(<span class="hljs-string">&quot;100&quot;</span>);<br>    System.out.println(keys);<br><br>    <span class="hljs-type">List</span> <span class="hljs-variable">values</span> <span class="hljs-operator">=</span> hashOperations.values(<span class="hljs-string">&quot;100&quot;</span>);<br>    System.out.println(values);<br><br>    hashOperations.delete(<span class="hljs-string">&quot;100&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>3). æ“ä½œåˆ—è¡¨ç±»å‹æ•°æ®</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ“ä½œåˆ—è¡¨ç±»å‹çš„æ•°æ®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testList</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//lpush lrange rpop llen</span><br>    <span class="hljs-type">ListOperations</span> <span class="hljs-variable">listOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForList();<br><br>    listOperations.leftPushAll(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>);<br>    listOperations.leftPush(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>);<br><br>    <span class="hljs-type">List</span> <span class="hljs-variable">mylist</span> <span class="hljs-operator">=</span> listOperations.range(<span class="hljs-string">&quot;mylist&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>    System.out.println(mylist);<br><br>    listOperations.rightPop(<span class="hljs-string">&quot;mylist&quot;</span>);<br><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> listOperations.size(<span class="hljs-string">&quot;mylist&quot;</span>);<br>    System.out.println(size);<br>&#125;<br></code></pre></td></tr></table></figure>



<p><strong>4). æ“ä½œé›†åˆç±»å‹æ•°æ®</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ“ä½œé›†åˆç±»å‹çš„æ•°æ®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSet</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//sadd smembers scard sinter sunion srem</span><br>    <span class="hljs-type">SetOperations</span> <span class="hljs-variable">setOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForSet();<br><br>    setOperations.add(<span class="hljs-string">&quot;set1&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>);<br>    setOperations.add(<span class="hljs-string">&quot;set2&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;x&quot;</span>,<span class="hljs-string">&quot;y&quot;</span>);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">members</span> <span class="hljs-operator">=</span> setOperations.members(<span class="hljs-string">&quot;set1&quot;</span>);<br>    System.out.println(members);<br><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> setOperations.size(<span class="hljs-string">&quot;set1&quot;</span>);<br>    System.out.println(size);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">intersect</span> <span class="hljs-operator">=</span> setOperations.intersect(<span class="hljs-string">&quot;set1&quot;</span>, <span class="hljs-string">&quot;set2&quot;</span>);<br>    System.out.println(intersect);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">union</span> <span class="hljs-operator">=</span> setOperations.union(<span class="hljs-string">&quot;set1&quot;</span>, <span class="hljs-string">&quot;set2&quot;</span>);<br>    System.out.println(union);<br><br>    setOperations.remove(<span class="hljs-string">&quot;set1&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>


<p><strong>5). æ“ä½œæœ‰åºé›†åˆç±»å‹æ•°æ®</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ“ä½œæœ‰åºé›†åˆç±»å‹çš„æ•°æ®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testZset</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//zadd zrange zincrby zrem</span><br>    <span class="hljs-type">ZSetOperations</span> <span class="hljs-variable">zSetOperations</span> <span class="hljs-operator">=</span> redisTemplate.opsForZSet();<br><br>    zSetOperations.add(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-number">10</span>);<br>    zSetOperations.add(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-number">12</span>);<br>    zSetOperations.add(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-number">9</span>);<br><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">zset1</span> <span class="hljs-operator">=</span> zSetOperations.range(<span class="hljs-string">&quot;zset1&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>    System.out.println(zset1);<br><br>    zSetOperations.incrementScore(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-number">10</span>);<br><br>    zSetOperations.remove(<span class="hljs-string">&quot;zset1&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>6). é€šç”¨å‘½ä»¤æ“ä½œ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é€šç”¨å‘½ä»¤æ“ä½œ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCommon</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//keys exists type del</span><br>    <span class="hljs-type">Set</span> <span class="hljs-variable">keys</span> <span class="hljs-operator">=</span> redisTemplate.keys(<span class="hljs-string">&quot;*&quot;</span>);<br>    System.out.println(keys);<br><br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(<span class="hljs-string">&quot;name&quot;</span>);<br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">set1</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(<span class="hljs-string">&quot;set1&quot;</span>);<br><br>    <span class="hljs-keyword">for</span> (Object key : keys) &#123;<br>        <span class="hljs-type">DataType</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> redisTemplate.type(key);<br>        System.out.println(type.name());<br>    &#125;<br><br>    redisTemplate.delete(<span class="hljs-string">&quot;mylist&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="å…­-åº—é“ºè¥ä¸šçŠ¶æ€"><a href="#å…­-åº—é“ºè¥ä¸šçŠ¶æ€" class="headerlink" title="å…­. åº—é“ºè¥ä¸šçŠ¶æ€"></a>å…­. åº—é“ºè¥ä¸šçŠ¶æ€</h1><p>è¥ä¸šçŠ¶æ€åˆ†ä¸º<strong>è¥ä¸šä¸­</strong>å’Œ<strong>æ‰“çƒŠä¸­</strong></p>
<h2 id="1-è®¾ç½®è¥ä¸šçŠ¶æ€"><a href="#1-è®¾ç½®è¥ä¸šçŠ¶æ€" class="headerlink" title="1. è®¾ç½®è¥ä¸šçŠ¶æ€"></a>1. è®¾ç½®è¥ä¸šçŠ¶æ€</h2><p>åœ¨sky-serveræ¨¡å—ä¸­ï¼Œåˆ›å»ºShopController.java</p>
<p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºShopControllerçš„setStatusè®¾ç½®è¥ä¸šçŠ¶æ€æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.admin;<br><br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PutMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@RestController(&quot;adminShopController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/shop&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;åº—é“ºç›¸å…³æ¥å£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopController</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SHOP_STATUS&quot;</span>;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®åº—é“ºçš„è¥ä¸šçŠ¶æ€</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PutMapping(&quot;/&#123;status&#125;&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;è®¾ç½®åº—é“ºçš„è¥ä¸šçŠ¶æ€&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">setStatus</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;è®¾ç½®åº—é“ºçš„è¥ä¸šçŠ¶æ€ä¸ºï¼š&#123;&#125;&quot;</span>,status == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;è¥ä¸šä¸­&quot;</span> : <span class="hljs-string">&quot;æ‰“çƒŠä¸­&quot;</span>);<br>        redisTemplate.opsForValue().set(KEY,status);<br>        <span class="hljs-keyword">return</span> Result.success();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="2-ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€"><a href="#2-ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€" class="headerlink" title="2. ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€"></a>2. ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</h2><p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºShopControllerçš„getStatusæŸ¥è¯¢è¥ä¸šçŠ¶æ€æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * è·å–åº—é“ºçš„è¥ä¸šçŠ¶æ€</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/status&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;è·å–åº—é“ºçš„è¥ä¸šçŠ¶æ€&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;Integer&gt; <span class="hljs-title function_">getStatus</span><span class="hljs-params">()</span>&#123;<br>       <span class="hljs-type">Integer</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);<br>       log.info(<span class="hljs-string">&quot;è·å–åˆ°åº—é“ºçš„è¥ä¸šçŠ¶æ€ä¸ºï¼š&#123;&#125;&quot;</span>,status == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;è¥ä¸šä¸­&quot;</span> : <span class="hljs-string">&quot;æ‰“çƒŠä¸­&quot;</span>);<br>       <span class="hljs-keyword">return</span> Result.success(status);<br>   &#125;<br></code></pre></td></tr></table></figure>



<h2 id="3-ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€"><a href="#3-ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€" class="headerlink" title="3. ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€"></a>3. ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</h2><p>åˆ›å»ºcom.sky.controller.useråŒ…ï¼Œåœ¨è¯¥åŒ…ä¸‹åˆ›å»ºShopController.java</p>
<p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºShopControllerçš„getStatusæŸ¥è¯¢è¥ä¸šçŠ¶æ€æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-meta">@RestController(&quot;userShopController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/shop&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;åº—é“ºç›¸å…³æ¥å£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopController</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SHOP_STATUS&quot;</span>;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–åº—é“ºçš„è¥ä¸šçŠ¶æ€</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/status&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;è·å–åº—é“ºçš„è¥ä¸šçŠ¶æ€&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;Integer&gt; <span class="hljs-title function_">getStatus</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);<br>        log.info(<span class="hljs-string">&quot;è·å–åˆ°åº—é“ºçš„è¥ä¸šçŠ¶æ€ä¸ºï¼š&#123;&#125;&quot;</span>,status == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;è¥ä¸šä¸­&quot;</span> : <span class="hljs-string">&quot;æ‰“çƒŠä¸­&quot;</span>);<br>        <span class="hljs-keyword">return</span> Result.success(status);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="ä¸ƒ-HttpClient"><a href="#ä¸ƒ-HttpClient" class="headerlink" title="ä¸ƒ. HttpClient"></a>ä¸ƒ. HttpClient</h1><p>HttpClient æ˜¯Apache Jakarta Common ä¸‹çš„å­é¡¹ç›®ï¼Œå¯ä»¥ç”¨æ¥æä¾›é«˜æ•ˆçš„ã€æœ€æ–°çš„ã€åŠŸèƒ½ä¸°å¯Œçš„æ”¯æŒ HTTP åè®®çš„å®¢æˆ·ç«¯ç¼–ç¨‹å·¥å…·åŒ…ï¼Œå¹¶ä¸”å®ƒæ”¯æŒ HTTP åè®®æœ€æ–°çš„ç‰ˆæœ¬å’Œå»ºè®®ã€‚</p>
<p><strong>HttpClientä½œç”¨ï¼š</strong></p>
<ul>
<li>å‘é€HTTPè¯·æ±‚</li>
<li>æ¥æ”¶å“åº”æ•°æ®</li>
</ul>
<p><strong>HttpClientçš„æ ¸å¿ƒAPIï¼š</strong></p>
<ul>
<li>HttpClientï¼šHttpå®¢æˆ·ç«¯å¯¹è±¡ç±»å‹ï¼Œä½¿ç”¨è¯¥ç±»å‹å¯¹è±¡å¯å‘èµ·Httpè¯·æ±‚ã€‚</li>
<li>HttpClientsï¼šå¯è®¤ä¸ºæ˜¯æ„å»ºå™¨ï¼Œå¯åˆ›å»ºHttpClientå¯¹è±¡ã€‚</li>
<li>CloseableHttpClientï¼šå®ç°ç±»ï¼Œå®ç°äº†HttpClientæ¥å£ã€‚</li>
<li>HttpGetï¼šGetæ–¹å¼è¯·æ±‚ç±»å‹ã€‚</li>
<li>HttpPostï¼šPostæ–¹å¼è¯·æ±‚ç±»å‹ã€‚</li>
</ul>
<p><strong>HttpClientå‘é€è¯·æ±‚æ­¥éª¤ï¼š</strong></p>
<ul>
<li>åˆ›å»ºHttpClientå¯¹è±¡</li>
<li>åˆ›å»ºHttpè¯·æ±‚å¯¹è±¡</li>
<li>è°ƒç”¨HttpClientçš„executeæ–¹æ³•å‘é€è¯·æ±‚</li>
</ul>
<h1 id="å…«-å¾®ä¿¡ç™»å½•"><a href="#å…«-å¾®ä¿¡ç™»å½•" class="headerlink" title="å…«. å¾®ä¿¡ç™»å½•"></a>å…«. å¾®ä¿¡ç™»å½•</h1><h2 id="1-å®šä¹‰ç›¸å…³é…ç½®"><a href="#1-å®šä¹‰ç›¸å…³é…ç½®" class="headerlink" title="1. å®šä¹‰ç›¸å…³é…ç½®"></a>1. å®šä¹‰ç›¸å…³é…ç½®</h2><h3 id="1-1-é…ç½®å¾®ä¿¡ç™»å½•æ‰€éœ€é…ç½®é¡¹"><a href="#1-1-é…ç½®å¾®ä¿¡ç™»å½•æ‰€éœ€é…ç½®é¡¹" class="headerlink" title="1.1 é…ç½®å¾®ä¿¡ç™»å½•æ‰€éœ€é…ç½®é¡¹"></a>1.1 é…ç½®å¾®ä¿¡ç™»å½•æ‰€éœ€é…ç½®é¡¹</h3><p>application-dev.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">wechat:</span><br>    <span class="hljs-attr">appid:</span> <span class="hljs-string">wxffb3637a228223b8</span><br>    <span class="hljs-attr">secret:</span> <span class="hljs-string">84311df9199ecacdf4f12d27b6b9522d</span><br></code></pre></td></tr></table></figure>

<p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">wechat:</span><br>    <span class="hljs-attr">appid:</span> <span class="hljs-string">$&#123;sky.wechat.appid&#125;</span><br>    <span class="hljs-attr">secret:</span> <span class="hljs-string">$&#123;sky.wechat.secret&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-2-é…ç½®ä¸ºå¾®ä¿¡ç”¨æˆ·ç”Ÿæˆjwtä»¤ç‰Œæ—¶ä½¿ç”¨çš„é…ç½®é¡¹"><a href="#1-2-é…ç½®ä¸ºå¾®ä¿¡ç”¨æˆ·ç”Ÿæˆjwtä»¤ç‰Œæ—¶ä½¿ç”¨çš„é…ç½®é¡¹" class="headerlink" title="1.2 é…ç½®ä¸ºå¾®ä¿¡ç”¨æˆ·ç”Ÿæˆjwtä»¤ç‰Œæ—¶ä½¿ç”¨çš„é…ç½®é¡¹"></a>1.2 é…ç½®ä¸ºå¾®ä¿¡ç”¨æˆ·ç”Ÿæˆjwtä»¤ç‰Œæ—¶ä½¿ç”¨çš„é…ç½®é¡¹</h3><p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">sky:</span><br>  <span class="hljs-attr">jwt:</span><br>    <span class="hljs-comment"># è®¾ç½®jwtç­¾ååŠ å¯†æ—¶ä½¿ç”¨çš„ç§˜é’¥</span><br>    <span class="hljs-attr">admin-secret-key:</span> <span class="hljs-string">itcast</span><br>    <span class="hljs-comment"># è®¾ç½®jwtè¿‡æœŸæ—¶é—´</span><br>    <span class="hljs-attr">admin-ttl:</span> <span class="hljs-number">7200000</span><br>    <span class="hljs-comment"># è®¾ç½®å‰ç«¯ä¼ é€’è¿‡æ¥çš„ä»¤ç‰Œåç§°</span><br>    <span class="hljs-attr">admin-token-name:</span> <span class="hljs-string">token</span><br>    <span class="hljs-attr">user-secret-key:</span> <span class="hljs-string">itheima</span><br>    <span class="hljs-attr">user-ttl:</span> <span class="hljs-number">7200000</span><br>    <span class="hljs-attr">user-token-name:</span> <span class="hljs-string">authentication</span><br></code></pre></td></tr></table></figure>



<h2 id="2-DTOè®¾è®¡"><a href="#2-DTOè®¾è®¡" class="headerlink" title="2. DTOè®¾è®¡"></a>2. DTOè®¾è®¡</h2><p><strong>æ ¹æ®ä¼ å…¥å‚æ•°è®¾è®¡DTOç±»ï¼š</strong></p>
<img src="assets/image-20221205183625049.png" srcset="/img/loading.gif" lazyload alt="image-20221205183625049" style="zoom:50%;" /> 

<p>åœ¨sky-pojoæ¨¡å—ï¼ŒUserLoginDTO.javaå·²å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.dto;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Cç«¯ç”¨æˆ·ç™»å½•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLoginDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String code;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="3-VOè®¾è®¡"><a href="#3-VOè®¾è®¡" class="headerlink" title="3. VOè®¾è®¡"></a>3. VOè®¾è®¡</h2><p><strong>æ ¹æ®è¿”å›æ•°æ®è®¾è®¡VOç±»ï¼š</strong></p>
<img src="assets/image-20221205183923272.png" srcset="/img/loading.gif" lazyload alt="image-20221205183923272" style="zoom:50%;" /> 

<p>åœ¨sky-pojoæ¨¡å—ï¼ŒUserLoginVO.javaå·²å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.vo;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Builder;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Builder</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLoginVO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String openid;<br>    <span class="hljs-keyword">private</span> String token;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="4-Controllerå±‚"><a href="#4-Controllerå±‚" class="headerlink" title="4. Controllerå±‚"></a>4. Controllerå±‚</h2><p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºUserControllerçš„loginæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.constant.JwtClaimsConstant;<br><span class="hljs-keyword">import</span> com.sky.dto.UserLoginDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.User;<br><span class="hljs-keyword">import</span> com.sky.properties.JwtProperties;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.UserService;<br><span class="hljs-keyword">import</span> com.sky.utils.JwtUtil;<br><span class="hljs-keyword">import</span> com.sky.vo.UserLoginVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/user&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;Cç«¯ç”¨æˆ·ç›¸å…³æ¥å£&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JwtProperties jwtProperties;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¾®ä¿¡ç™»å½•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userLoginDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;å¾®ä¿¡ç™»å½•&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;UserLoginVO&gt; <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> UserLoginDTO userLoginDTO)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;å¾®ä¿¡ç”¨æˆ·ç™»å½•ï¼š&#123;&#125;&quot;</span>,userLoginDTO.getCode());<br><br>        <span class="hljs-comment">//å¾®ä¿¡ç™»å½•</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.wxLogin(userLoginDTO);<span class="hljs-comment">//åç»ªæ­¥éª¤å®ç°</span><br><br>        <span class="hljs-comment">//ä¸ºå¾®ä¿¡ç”¨æˆ·ç”Ÿæˆjwtä»¤ç‰Œ</span><br>        Map&lt;String, Object&gt; claims = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        claims.put(JwtClaimsConstant.USER_ID,user.getId());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JwtUtil.createJWT(jwtProperties.getUserSecretKey(), jwtProperties.getUserTtl(), claims);<br><br>        <span class="hljs-type">UserLoginVO</span> <span class="hljs-variable">userLoginVO</span> <span class="hljs-operator">=</span> UserLoginVO.builder()<br>                .id(user.getId())<br>                .openid(user.getOpenid())<br>                .token(token)<br>                .build();<br>        <span class="hljs-keyword">return</span> Result.success(userLoginVO);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="5-Serviceå±‚"><a href="#5-Serviceå±‚" class="headerlink" title="5. Serviceå±‚"></a>5. Serviceå±‚</h2><h3 id="5-1-Serviceå±‚æ¥å£"><a href="#5-1-Serviceå±‚æ¥å£" class="headerlink" title="5.1 Serviceå±‚æ¥å£"></a>5.1 Serviceå±‚æ¥å£</h3><p><strong>åˆ›å»ºUserServiceæ¥å£ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.UserLoginDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.User;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¾®ä¿¡ç™»å½•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userLoginDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    User <span class="hljs-title function_">wxLogin</span><span class="hljs-params">(UserLoginDTO userLoginDTO)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-2-Serviceå±‚å®ç°ç±»"><a href="#5-2-Serviceå±‚å®ç°ç±»" class="headerlink" title="5.2 Serviceå±‚å®ç°ç±»"></a>5.2 Serviceå±‚å®ç°ç±»</h3><p>**åˆ›å»ºUserServiceImplå®ç°ç±»ï¼š**å®ç°è·å–å¾®ä¿¡ç”¨æˆ·çš„openidå’Œå¾®ä¿¡ç™»å½•åŠŸèƒ½</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><span class="hljs-keyword">import</span> com.sky.constant.MessageConstant;<br><span class="hljs-keyword">import</span> com.sky.dto.UserLoginDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.User;<br><span class="hljs-keyword">import</span> com.sky.exception.LoginFailedException;<br><span class="hljs-keyword">import</span> com.sky.mapper.UserMapper;<br><span class="hljs-keyword">import</span> com.sky.properties.WeChatProperties;<br><span class="hljs-keyword">import</span> com.sky.service.UserService;<br><span class="hljs-keyword">import</span> com.sky.utils.HttpClientUtil;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-comment">//å¾®ä¿¡æœåŠ¡æ¥å£åœ°å€</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">WX_LOGIN</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://api.weixin.qq.com/sns/jscode2session&quot;</span>;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> WeChatProperties weChatProperties;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¾®ä¿¡ç™»å½•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userLoginDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">wxLogin</span><span class="hljs-params">(UserLoginDTO userLoginDTO)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">openid</span> <span class="hljs-operator">=</span> getOpenid(userLoginDTO.getCode());<br><br>        <span class="hljs-comment">//åˆ¤æ–­openidæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºç™»å½•å¤±è´¥ï¼ŒæŠ›å‡ºä¸šåŠ¡å¼‚å¸¸</span><br>        <span class="hljs-keyword">if</span>(openid == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginFailedException</span>(MessageConstant.LOGIN_FAILED);<br>        &#125;<br><br>        <span class="hljs-comment">//åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºæ–°ç”¨æˆ·</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.getByOpenid(openid);<br><br>        <span class="hljs-comment">//å¦‚æœæ˜¯æ–°ç”¨æˆ·ï¼Œè‡ªåŠ¨å®Œæˆæ³¨å†Œ</span><br>        <span class="hljs-keyword">if</span>(user == <span class="hljs-literal">null</span>)&#123;<br>            user = User.builder()<br>                    .openid(openid)<br>                    .createTime(LocalDateTime.now())<br>                    .build();<br>            userMapper.insert(user);<span class="hljs-comment">//åç»ªæ­¥éª¤å®ç°</span><br>        &#125;<br><br>        <span class="hljs-comment">//è¿”å›è¿™ä¸ªç”¨æˆ·å¯¹è±¡</span><br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è°ƒç”¨å¾®ä¿¡æ¥å£æœåŠ¡ï¼Œè·å–å¾®ä¿¡ç”¨æˆ·çš„openid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getOpenid</span><span class="hljs-params">(String code)</span>&#123;<br>        <span class="hljs-comment">//è°ƒç”¨å¾®ä¿¡æ¥å£æœåŠ¡ï¼Œè·å¾—å½“å‰å¾®ä¿¡ç”¨æˆ·çš„openid</span><br>        Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;appid&quot;</span>,weChatProperties.getAppid());<br>        map.put(<span class="hljs-string">&quot;secret&quot;</span>,weChatProperties.getSecret());<br>        map.put(<span class="hljs-string">&quot;js_code&quot;</span>,code);<br>        map.put(<span class="hljs-string">&quot;grant_type&quot;</span>,<span class="hljs-string">&quot;authorization_code&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> HttpClientUtil.doGet(WX_LOGIN, map);<br><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> JSON.parseObject(json);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">openid</span> <span class="hljs-operator">=</span> jsonObject.getString(<span class="hljs-string">&quot;openid&quot;</span>);<br>        <span class="hljs-keyword">return</span> openid;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="6-Mapperå±‚"><a href="#6-Mapperå±‚" class="headerlink" title="6. Mapperå±‚"></a>6. Mapperå±‚</h2><p><strong>åˆ›å»ºUserMapperæ¥å£ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.User;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Select;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®openidæŸ¥è¯¢ç”¨æˆ·</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> openid</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Select(&quot;select * from user where openid = #&#123;openid&#125;&quot;)</span><br>    User <span class="hljs-title function_">getByOpenid</span><span class="hljs-params">(String openid)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ’å…¥æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> user</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(User user)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºUserMapper.xmlæ˜ å°„æ–‡ä»¶ï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.UserMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>        insert into user (openid, name, phone, sex, id_number, avatar, create_time)<br>        values (#&#123;openid&#125;, #&#123;name&#125;, #&#123;phone&#125;, #&#123;sex&#125;, #&#123;idNumber&#125;, #&#123;avatar&#125;, #&#123;createTime&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="7-ç¼–å†™æ‹¦æˆªå™¨"><a href="#7-ç¼–å†™æ‹¦æˆªå™¨" class="headerlink" title="7. ç¼–å†™æ‹¦æˆªå™¨"></a>7. ç¼–å†™æ‹¦æˆªå™¨</h2><p>**ç¼–å†™æ‹¦æˆªå™¨JwtTokenUserInterceptorï¼š**ç»Ÿä¸€æ‹¦æˆªç”¨æˆ·ç«¯å‘é€çš„è¯·æ±‚å¹¶è¿›è¡Œjwtæ ¡éªŒ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.interceptor;<br><br><span class="hljs-keyword">import</span> com.sky.constant.JwtClaimsConstant;<br><span class="hljs-keyword">import</span> com.sky.context.BaseContext;<br><span class="hljs-keyword">import</span> com.sky.properties.JwtProperties;<br><span class="hljs-keyword">import</span> com.sky.utils.JwtUtil;<br><span class="hljs-keyword">import</span> io.jsonwebtoken.Claims;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.method.HandlerMethod;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * jwtä»¤ç‰Œæ ¡éªŒçš„æ‹¦æˆªå™¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtTokenUserInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JwtProperties jwtProperties;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¡éªŒjwt</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//åˆ¤æ–­å½“å‰æ‹¦æˆªåˆ°çš„æ˜¯Controllerçš„æ–¹æ³•è¿˜æ˜¯å…¶ä»–èµ„æº</span><br>        <span class="hljs-keyword">if</span> (!(handler <span class="hljs-keyword">instanceof</span> HandlerMethod)) &#123;<br>            <span class="hljs-comment">//å½“å‰æ‹¦æˆªåˆ°çš„ä¸æ˜¯åŠ¨æ€æ–¹æ³•ï¼Œç›´æ¥æ”¾è¡Œ</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//1ã€ä»è¯·æ±‚å¤´ä¸­è·å–ä»¤ç‰Œ</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(jwtProperties.getUserTokenName());<br><br>        <span class="hljs-comment">//2ã€æ ¡éªŒä»¤ç‰Œ</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            log.info(<span class="hljs-string">&quot;jwtæ ¡éªŒ:&#123;&#125;&quot;</span>, token);<br>            <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> JwtUtil.parseJWT(jwtProperties.getUserSecretKey(), token);<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.USER_ID).toString());<br>            log.info(<span class="hljs-string">&quot;å½“å‰ç”¨æˆ·çš„idï¼š&quot;</span>, userId);<br>            BaseContext.setCurrentId(userId);<br>            <span class="hljs-comment">//3ã€é€šè¿‡ï¼Œæ”¾è¡Œ</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            <span class="hljs-comment">//4ã€ä¸é€šè¿‡ï¼Œå“åº”401çŠ¶æ€ç </span><br>            response.setStatus(<span class="hljs-number">401</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨WebMvcConfigurationé…ç½®ç±»ä¸­æ³¨å†Œæ‹¦æˆªå™¨ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> JwtTokenUserInterceptor jwtTokenUserInterceptor;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> registry</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>    log.info(<span class="hljs-string">&quot;å¼€å§‹æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨...&quot;</span>);<br>    <span class="hljs-comment">//.........</span><br><br>    registry.addInterceptor(jwtTokenUserInterceptor)<br>            .addPathPatterns(<span class="hljs-string">&quot;/user/**&quot;</span>)<br>            .excludePathPatterns(<span class="hljs-string">&quot;/user/user/login&quot;</span>)<br>            .excludePathPatterns(<span class="hljs-string">&quot;/user/shop/status&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="ä¹-å•†å“æµè§ˆåŠŸèƒ½"><a href="#ä¹-å•†å“æµè§ˆåŠŸèƒ½" class="headerlink" title="ä¹. å•†å“æµè§ˆåŠŸèƒ½"></a>ä¹. å•†å“æµè§ˆåŠŸèƒ½</h1><p>è¿™é‡Œå¯¼å…¥ç›¸å…³ä»£ç </p>
<h2 id="1-Mapperå±‚"><a href="#1-Mapperå±‚" class="headerlink" title="1. Mapperå±‚"></a>1. Mapperå±‚</h2><p><strong>åœ¨SetmealMapper.javaä¸­æ·»åŠ listå’ŒgetDishItemBySetmealIdä¸¤ä¸ªæ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * åŠ¨æ€æ¡ä»¶æŸ¥è¯¢å¥—é¤</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   List&lt;Setmeal&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Setmeal setmeal)</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®å¥—é¤idæŸ¥è¯¢èœå“é€‰é¡¹</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmealId</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select sd.name, sd.copies, d.image, d.description &quot; +</span><br><span class="hljs-meta">           &quot;from setmeal_dish sd left join dish d on sd.dish_id = d.id &quot; +</span><br><span class="hljs-meta">           &quot;where sd.setmeal_id = #&#123;setmealId&#125;&quot;)</span><br>   List&lt;DishItemVO&gt; <span class="hljs-title function_">getDishItemBySetmealId</span><span class="hljs-params">(Long setmealId)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºSetmealMapper.xmlæ–‡ä»¶</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.SetmealMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Setmeal&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Setmeal&quot;</span>&gt;</span><br>        select * from setmeal<br>        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null&quot;</span>&gt;</span><br>                and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;categoryId != null&quot;</span>&gt;</span><br>                and category_id = #&#123;categoryId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                and status = #&#123;status&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="2-Serviceå±‚"><a href="#2-Serviceå±‚" class="headerlink" title="2. Serviceå±‚"></a>2. Serviceå±‚</h2><p><strong>åˆ›å»ºSetmealService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.SetmealDTO;<br><span class="hljs-keyword">import</span> com.sky.dto.SetmealPageQueryDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.sky.result.PageResult;<br><span class="hljs-keyword">import</span> com.sky.vo.DishItemVO;<br><span class="hljs-keyword">import</span> com.sky.vo.SetmealVO;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SetmealService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¡ä»¶æŸ¥è¯¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;Setmeal&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Setmeal setmeal)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idæŸ¥è¯¢èœå“é€‰é¡¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;DishItemVO&gt; <span class="hljs-title function_">getDishItemById</span><span class="hljs-params">(Long id)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºSetmealServiceImpl.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><span class="hljs-keyword">import</span> com.sky.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.sky.mapper.DishMapper;<br><span class="hljs-keyword">import</span> com.sky.mapper.SetmealDishMapper;<br><span class="hljs-keyword">import</span> com.sky.mapper.SetmealMapper;<br><span class="hljs-keyword">import</span> com.sky.service.SetmealService;<br><span class="hljs-keyword">import</span> com.sky.vo.DishItemVO;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¥—é¤ä¸šåŠ¡å®ç°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SetmealService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealMapper setmealMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealDishMapper setmealDishMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishMapper dishMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¡ä»¶æŸ¥è¯¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> setmeal</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;Setmeal&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Setmeal setmeal)</span> &#123;<br>        List&lt;Setmeal&gt; list = setmealMapper.list(setmeal);<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idæŸ¥è¯¢èœå“é€‰é¡¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;DishItemVO&gt; <span class="hljs-title function_">getDishItemById</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> setmealMapper.getDishItemBySetmealId(id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨DishService.javaä¸­æ·»åŠ listWithFlavoræ–¹æ³•å®šä¹‰</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ¡ä»¶æŸ¥è¯¢èœå“å’Œå£å‘³</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   List&lt;DishVO&gt; <span class="hljs-title function_">listWithFlavor</span><span class="hljs-params">(Dish dish)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨DishServiceImpl.javaä¸­å®ç°listWithFlavoræ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ¡ä»¶æŸ¥è¯¢èœå“å’Œå£å‘³</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dish</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> List&lt;DishVO&gt; <span class="hljs-title function_">listWithFlavor</span><span class="hljs-params">(Dish dish)</span> &#123;<br>       List&lt;Dish&gt; dishList = dishMapper.list(dish);<br><br>       List&lt;DishVO&gt; dishVOList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>       <span class="hljs-keyword">for</span> (Dish d : dishList) &#123;<br>           <span class="hljs-type">DishVO</span> <span class="hljs-variable">dishVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DishVO</span>();<br>           BeanUtils.copyProperties(d,dishVO);<br><br>           <span class="hljs-comment">//æ ¹æ®èœå“idæŸ¥è¯¢å¯¹åº”çš„å£å‘³</span><br>           List&lt;DishFlavor&gt; flavors = dishFlavorMapper.getByDishId(d.getId());<br><br>           dishVO.setFlavors(flavors);<br>           dishVOList.add(dishVO);<br>       &#125;<br><br>       <span class="hljs-keyword">return</span> dishVOList;<br>   &#125;<br></code></pre></td></tr></table></figure>



<h2 id="3-Controllerå±‚"><a href="#3-Controllerå±‚" class="headerlink" title="3. Controllerå±‚"></a>3. Controllerå±‚</h2><p><strong>åˆ›å»ºDishController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.constant.StatusConstant;<br><span class="hljs-keyword">import</span> com.sky.entity.Dish;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.DishService;<br><span class="hljs-keyword">import</span> com.sky.vo.DishVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController(&quot;userDishController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/dish&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;Cç«¯-èœå“æµè§ˆæ¥å£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DishController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishService dishService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br>        <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>        dish.setCategoryId(categoryId);<br>        dish.setStatus(StatusConstant.ENABLE);<span class="hljs-comment">//æŸ¥è¯¢èµ·å”®ä¸­çš„èœå“</span><br><br>        List&lt;DishVO&gt; list = dishService.listWithFlavor(dish);<br><br>        <span class="hljs-keyword">return</span> Result.success(list);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºCategoryController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.entity.Category;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.CategoryService;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController(&quot;userCategoryController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/category&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;Cç«¯-åˆ†ç±»æ¥å£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CategoryController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CategoryService categoryService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŸ¥è¯¢åˆ†ç±»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> type</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;æŸ¥è¯¢åˆ†ç±»&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;Category&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Integer type)</span> &#123;<br>        List&lt;Category&gt; list = categoryService.list(type);<br>        <span class="hljs-keyword">return</span> Result.success(list);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºSetmealController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.constant.StatusConstant;<br><span class="hljs-keyword">import</span> com.sky.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.SetmealService;<br><span class="hljs-keyword">import</span> com.sky.vo.DishItemVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController(&quot;userSetmealController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/setmeal&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;Cç«¯-å¥—é¤æµè§ˆæ¥å£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetmealController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealService setmealService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¡ä»¶æŸ¥è¯¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;Setmeal&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br>        <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Setmeal</span>();<br>        setmeal.setCategoryId(categoryId);<br>        setmeal.setStatus(StatusConstant.ENABLE);<br><br>        List&lt;Setmeal&gt; list = setmealService.list(setmeal);<br>        <span class="hljs-keyword">return</span> Result.success(list);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“åˆ—è¡¨</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/dish/&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“åˆ—è¡¨&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;DishItemVO&gt;&gt; <span class="hljs-title function_">dishList</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>        List&lt;DishItemVO&gt; list = setmealService.getDishItemById(id);<br>        <span class="hljs-keyword">return</span> Result.success(list);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="å-ç¼“å­˜èœå“å’Œå¥—é¤"><a href="#å-ç¼“å­˜èœå“å’Œå¥—é¤" class="headerlink" title="å. ç¼“å­˜èœå“å’Œå¥—é¤"></a>å. ç¼“å­˜èœå“å’Œå¥—é¤</h1><h2 id="1-ç¼“å­˜èœå“"><a href="#1-ç¼“å­˜èœå“" class="headerlink" title="1. ç¼“å­˜èœå“"></a>1. ç¼“å­˜èœå“</h2><h3 id="1-1-é—®é¢˜åˆ†æ"><a href="#1-1-é—®é¢˜åˆ†æ" class="headerlink" title="1.1 é—®é¢˜åˆ†æ"></a>1.1 é—®é¢˜åˆ†æ</h3><p>ç”¨æˆ·ç«¯å°ç¨‹åºå±•ç¤ºçš„èœå“æ•°æ®éƒ½æ˜¯é€šè¿‡æŸ¥è¯¢æ•°æ®åº“è·å¾—ï¼Œå¦‚æœç”¨æˆ·ç«¯è®¿é—®é‡æ¯”è¾ƒå¤§ï¼Œæ•°æ®åº“è®¿é—®å‹åŠ›éšä¹‹å¢å¤§ã€‚é€šè¿‡<strong>Redisæ¥ç¼“å­˜èœå“æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ“ä½œ</strong>ã€‚</p>
<ul>
<li>æ¯ä¸ªåˆ†ç±»ä¸‹çš„èœå“ä¿å­˜ä¸€ä»½ç¼“å­˜æ•°æ®</li>
<li>æ•°æ®åº“ä¸­èœå“æ•°æ®æœ‰å˜æ›´æ—¶æ¸…ç†ç¼“å­˜æ•°æ®</li>
</ul>
<p>ä¸ºäº†ä¿è¯æ•°æ®åº“å’ŒRedisä¸­çš„<strong>æ•°æ®ä¿æŒä¸€è‡´</strong>ï¼Œä¿®æ”¹<strong>ç®¡ç†ç«¯æ¥å£ DishController</strong> çš„ç›¸å…³æ–¹æ³•ï¼ŒåŠ å…¥æ¸…ç†ç¼“å­˜é€»è¾‘ã€‚</p>
<p>éœ€è¦æ”¹é€ çš„æ–¹æ³•ï¼š</p>
<ul>
<li>æ–°å¢èœå“</li>
<li>ä¿®æ”¹èœå“</li>
<li>æ‰¹é‡åˆ é™¤èœå“</li>
<li>èµ·å”®ã€åœå”®èœå“</li>
</ul>
<h3 id="1-2-ç”¨æˆ·ç«¯æ¥å£DishController"><a href="#1-2-ç”¨æˆ·ç«¯æ¥å£DishController" class="headerlink" title="1.2 ç”¨æˆ·ç«¯æ¥å£DishController"></a>1.2 ç”¨æˆ·ç«¯æ¥å£DishController</h3><p><strong>ä¿®æ”¹ç”¨æˆ·ç«¯æ¥å£ DishController çš„ list æ–¹æ³•ï¼ŒåŠ å…¥ç¼“å­˜å¤„ç†é€»è¾‘ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br><br>       <span class="hljs-comment">//æ„é€ redisä¸­çš„keyï¼Œè§„åˆ™ï¼šdish_åˆ†ç±»id</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dish_&quot;</span> + categoryId;<br><br>       <span class="hljs-comment">//æŸ¥è¯¢redisä¸­æ˜¯å¦å­˜åœ¨èœå“æ•°æ®</span><br>       List&lt;DishVO&gt; list = (List&lt;DishVO&gt;) redisTemplate.opsForValue().get(key);<br>       <span class="hljs-keyword">if</span>(list != <span class="hljs-literal">null</span> &amp;&amp; list.size() &gt; <span class="hljs-number">0</span>)&#123;<br>           <span class="hljs-comment">//å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œæ— é¡»æŸ¥è¯¢æ•°æ®åº“</span><br>           <span class="hljs-keyword">return</span> Result.success(list);<br>       &#125;<br>	<span class="hljs-comment">////////////////////////////////////////////////////////</span><br>       <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dish</span>();<br>       dish.setCategoryId(categoryId);<br>       dish.setStatus(StatusConstant.ENABLE);<span class="hljs-comment">//æŸ¥è¯¢èµ·å”®ä¸­çš„èœå“</span><br><br>       <span class="hljs-comment">//å¦‚æœä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æŸ¥è¯¢åˆ°çš„æ•°æ®æ”¾å…¥redisä¸­</span><br>       list = dishService.listWithFlavor(dish);<br>       <span class="hljs-comment">////////////////////////////////////////////////////////</span><br>       redisTemplate.opsForValue().set(key, list);<br><br>       <span class="hljs-keyword">return</span> Result.success(list);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-ç®¡ç†ç«¯æ¥å£DishController"><a href="#1-3-ç®¡ç†ç«¯æ¥å£DishController" class="headerlink" title="1.3 ç®¡ç†ç«¯æ¥å£DishController"></a>1.3 ç®¡ç†ç«¯æ¥å£DishController</h3><h4 id="1-3-1-æŠ½å–æ¸…ç†ç¼“å­˜çš„æ–¹æ³•"><a href="#1-3-1-æŠ½å–æ¸…ç†ç¼“å­˜çš„æ–¹æ³•" class="headerlink" title="1.3.1 æŠ½å–æ¸…ç†ç¼“å­˜çš„æ–¹æ³•"></a>1.3.1 æŠ½å–æ¸…ç†ç¼“å­˜çš„æ–¹æ³•</h4><p>åœ¨ç®¡ç†ç«¯DishControllerä¸­æ·»åŠ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ¸…ç†ç¼“å­˜æ•°æ®</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> pattern</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanCache</span><span class="hljs-params">(String pattern)</span>&#123;<br>       <span class="hljs-type">Set</span> <span class="hljs-variable">keys</span> <span class="hljs-operator">=</span> redisTemplate.keys(pattern);<br>       redisTemplate.delete(keys);<br>   &#125;<br></code></pre></td></tr></table></figure>


<h4 id="1-3-2-æ–°å¢èœå“ä¼˜åŒ–"><a href="#1-3-2-æ–°å¢èœå“ä¼˜åŒ–" class="headerlink" title="1.3.2 æ–°å¢èœå“ä¼˜åŒ–"></a>1.3.2 æ–°å¢èœå“ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ–°å¢èœå“</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PostMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;æ–°å¢èœå“&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;æ–°å¢èœå“ï¼š&#123;&#125;&quot;</span>, dishDTO);<br>       dishService.saveWithFlavor(dishDTO);<br><br>       <span class="hljs-comment">//æ¸…ç†ç¼“å­˜æ•°æ®</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dish_&quot;</span> + dishDTO.getCategoryId();<br>       cleanCache(key);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-3-èœå“æ‰¹é‡åˆ é™¤ä¼˜åŒ–"><a href="#1-3-3-èœå“æ‰¹é‡åˆ é™¤ä¼˜åŒ–" class="headerlink" title="1.3.3 èœå“æ‰¹é‡åˆ é™¤ä¼˜åŒ–"></a>1.3.3 èœå“æ‰¹é‡åˆ é™¤ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * èœå“æ‰¹é‡åˆ é™¤</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@DeleteMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;èœå“æ‰¹é‡åˆ é™¤&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;èœå“æ‰¹é‡åˆ é™¤ï¼š&#123;&#125;&quot;</span>, ids);<br>       dishService.deleteBatch(ids);<br><br>       <span class="hljs-comment">//å°†æ‰€æœ‰çš„èœå“ç¼“å­˜æ•°æ®æ¸…ç†æ‰ï¼Œæ‰€æœ‰ä»¥dish_å¼€å¤´çš„key</span><br>       cleanCache(<span class="hljs-string">&quot;dish_*&quot;</span>);<br><br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-4-ä¿®æ”¹èœå“ä¼˜åŒ–"><a href="#1-3-4-ä¿®æ”¹èœå“ä¼˜åŒ–" class="headerlink" title="1.3.4 ä¿®æ”¹èœå“ä¼˜åŒ–"></a>1.3.4 ä¿®æ”¹èœå“ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ä¿®æ”¹èœå“</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> dishDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PutMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;ä¿®æ”¹èœå“&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;<br>       log.info(<span class="hljs-string">&quot;ä¿®æ”¹èœå“ï¼š&#123;&#125;&quot;</span>, dishDTO);<br>       dishService.updateWithFlavor(dishDTO);<br><br>       <span class="hljs-comment">//å°†æ‰€æœ‰çš„èœå“ç¼“å­˜æ•°æ®æ¸…ç†æ‰ï¼Œæ‰€æœ‰ä»¥dish_å¼€å¤´çš„key</span><br>       cleanCache(<span class="hljs-string">&quot;dish_*&quot;</span>);<br><br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-5-èœå“èµ·å”®åœå”®ä¼˜åŒ–"><a href="#1-3-5-èœå“èµ·å”®åœå”®ä¼˜åŒ–" class="headerlink" title="1.3.5 èœå“èµ·å”®åœå”®ä¼˜åŒ–"></a>1.3.5 èœå“èµ·å”®åœå”®ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * èœå“èµ·å”®åœå”®</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;èœå“èµ·å”®åœå”®&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status, Long id)</span> &#123;<br>       dishService.startOrStop(status, id);<br><br>       <span class="hljs-comment">//å°†æ‰€æœ‰çš„èœå“ç¼“å­˜æ•°æ®æ¸…ç†æ‰ï¼Œæ‰€æœ‰ä»¥dish_å¼€å¤´çš„key</span><br>       cleanCache(<span class="hljs-string">&quot;dish_*&quot;</span>);<br><br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-ç¼“å­˜å¥—é¤"><a href="#2-ç¼“å­˜å¥—é¤" class="headerlink" title="2. ç¼“å­˜å¥—é¤"></a>2. ç¼“å­˜å¥—é¤</h2><h3 id="2-1-Spring-Cache"><a href="#2-1-Spring-Cache" class="headerlink" title="2.1 Spring Cache"></a>2.1 Spring Cache</h3><p>Spring Cache æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ç°äº†åŸºäºæ³¨è§£çš„ç¼“å­˜åŠŸèƒ½ï¼Œåªéœ€è¦ç®€å•åœ°åŠ ä¸€ä¸ªæ³¨è§£ï¼Œå°±èƒ½å®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p>
<h4 id="2-1-1-å¸¸ç”¨æ³¨è§£"><a href="#2-1-1-å¸¸ç”¨æ³¨è§£" class="headerlink" title="2.1.1 å¸¸ç”¨æ³¨è§£"></a>2.1.1 å¸¸ç”¨æ³¨è§£</h4><p>åœ¨SpringCacheä¸­æä¾›äº†å¾ˆå¤šç¼“å­˜æ“ä½œçš„æ³¨è§£ï¼Œå¸¸è§çš„æ˜¯ä»¥ä¸‹çš„å‡ ä¸ªï¼š</p>
<table>
<thead>
<tr>
<th><strong>æ³¨è§£</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td>@EnableCaching</td>
<td>å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½ï¼Œé€šå¸¸åŠ åœ¨å¯åŠ¨ç±»ä¸Š</td>
</tr>
<tr>
<td>@Cacheable</td>
<td>åœ¨æ–¹æ³•æ‰§è¡Œå‰å…ˆæŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›å¦‚æœæ²¡æœ‰ç¼“å­˜æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td>
</tr>
<tr>
<td>@CachePut</td>
<td>å°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td>
</tr>
<tr>
<td>@CacheEvict</td>
<td>å°†ä¸€æ¡æˆ–å¤šæ¡æ•°æ®ä»ç¼“å­˜ä¸­åˆ é™¤</td>
</tr>
</tbody></table>
<h4 id="2-1-2-EnableCaching"><a href="#2-1-2-EnableCaching" class="headerlink" title="2.1.2 @EnableCaching"></a>2.1.2 @EnableCaching</h4><p><strong>å¯åŠ¨ç±»ä¸ŠåŠ @EnableCaching:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cache.annotation.EnableCaching;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableCaching</span><span class="hljs-comment">//å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheDemoApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(CacheDemoApplication.class,args);<br>        log.info(<span class="hljs-string">&quot;é¡¹ç›®å¯åŠ¨æˆåŠŸ...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-1-3-CachePutæ³¨è§£"><a href="#2-1-3-CachePutæ³¨è§£" class="headerlink" title="2.1.3 @CachePutæ³¨è§£"></a>2.1.3 @CachePutæ³¨è§£</h4><p><strong>@CachePut è¯´æ˜ï¼š</strong> </p>
<ul>
<li>â€‹ä½œç”¨: å°†æ–¹æ³•è¿”å›å€¼ï¼Œæ”¾å…¥ç¼“å­˜</li>
<li>â€‹value: ç¼“å­˜çš„åç§°, æ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¾ˆå¤škey</li>
<li>â€‹key: ç¼“å­˜çš„key  â€”â€”â€”-&gt; æ”¯æŒSpringçš„è¡¨è¾¾å¼è¯­è¨€SPELè¯­æ³•</li>
</ul>
<p><strong>åœ¨saveæ–¹æ³•ä¸ŠåŠ æ³¨è§£@CachePut</strong></p>
<p>å½“å‰UserControllerçš„saveæ–¹æ³•æ˜¯ç”¨æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è¯¥ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“çš„åŒæ—¶ï¼Œä¹Ÿå¾€ç¼“å­˜ä¸­ç¼“å­˜ä¸€ä»½æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨saveæ–¹æ³•ä¸ŠåŠ ä¸Šæ³¨è§£ @CachePutï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* CachePutï¼šå°†æ–¹æ³•è¿”å›å€¼æ”¾å…¥ç¼“å­˜</span><br><span class="hljs-comment">* valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</span><br><span class="hljs-comment">* keyï¼šç¼“å­˜çš„key</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PostMapping</span><br><span class="hljs-meta">@CachePut(value = &quot;userCache&quot;, key = &quot;#user.id&quot;)</span><span class="hljs-comment">//keyçš„ç”Ÿæˆï¼šuserCache::1</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span>&#123;<br>    userMapper.insert(user);<br>    <span class="hljs-keyword">return</span> user;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>**è¯´æ˜ï¼š**keyçš„å†™æ³•å¦‚ä¸‹</p>
<p>#user.id : #useræŒ‡çš„æ˜¯æ–¹æ³•å½¢å‚çš„åç§°, idæŒ‡çš„æ˜¯userçš„idå±æ€§ , ä¹Ÿå°±æ˜¯ä½¿ç”¨userçš„idå±æ€§ä½œä¸ºkey ;</p>
<h4 id="2-1-4-Cacheableæ³¨è§£"><a href="#2-1-4-Cacheableæ³¨è§£" class="headerlink" title="2.1.4 @Cacheableæ³¨è§£"></a>2.1.4 @Cacheableæ³¨è§£</h4><p><strong>@Cacheable è¯´æ˜:</strong></p>
<ul>
<li>â€‹ä½œç”¨: åœ¨æ–¹æ³•æ‰§è¡Œå‰ï¼Œspringå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›è‹¥æ²¡æœ‰æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</li>
<li>â€‹value: ç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</li>
<li>â€‹key: ç¼“å­˜çš„key  â€”â€”â€”-&gt; æ”¯æŒSpringçš„è¡¨è¾¾å¼è¯­è¨€SPELè¯­æ³•</li>
</ul>
<p> <strong>åœ¨getByIdä¸ŠåŠ æ³¨è§£@Cacheable</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* Cacheableï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰springå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›è‹¥æ²¡æœ‰æ•°æ®ï¼Œ	  *è°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</span><br><span class="hljs-comment">* valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</span><br><span class="hljs-comment">* keyï¼šç¼“å­˜çš„key</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping</span><br><span class="hljs-meta">@Cacheable(cacheNames = &quot;userCache&quot;,key=&quot;#id&quot;)</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>&#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.getById(id);<br>    <span class="hljs-keyword">return</span> user;<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="2-1-5-CacheEvictæ³¨è§£"><a href="#2-1-5-CacheEvictæ³¨è§£" class="headerlink" title="2.1.5 @CacheEvictæ³¨è§£"></a>2.1.5 @CacheEvictæ³¨è§£</h4><p><strong>@CacheEvict è¯´æ˜ï¼š</strong> </p>
<ul>
<li>ä½œç”¨: æ¸…ç†æŒ‡å®šç¼“å­˜</li>
<li>value: ç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</li>
<li>key: ç¼“å­˜çš„key  â€”â€”â€”-&gt; æ”¯æŒSpringçš„è¡¨è¾¾å¼è¯­è¨€SPELè¯­æ³•</li>
</ul>
<p><strong>åœ¨ delete æ–¹æ³•ä¸ŠåŠ æ³¨è§£@CacheEvict</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DeleteMapping</span><br><span class="hljs-meta">@CacheEvict(cacheNames = &quot;userCache&quot;,key = &quot;#id&quot;)</span><span class="hljs-comment">//åˆ é™¤æŸä¸ªkeyå¯¹åº”çš„ç¼“å­˜æ•°æ®</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Long id)</span>&#123;<br>    userMapper.deleteById(id);<br>&#125;<br><br><span class="hljs-meta">@DeleteMapping(&quot;/delAll&quot;)</span><br><span class="hljs-meta">@CacheEvict(cacheNames = &quot;userCache&quot;,allEntries = true)</span><span class="hljs-comment">//åˆ é™¤userCacheä¸‹æ‰€æœ‰çš„ç¼“å­˜æ•°æ®</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteAll</span><span class="hljs-params">()</span>&#123;<br>    userMapper.deleteAll();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-å®ç°æ€è·¯"><a href="#2-2-å®ç°æ€è·¯" class="headerlink" title="2.2 å®ç°æ€è·¯"></a>2.2 å®ç°æ€è·¯</h3><p><strong>å®ç°æ­¥éª¤ï¼š</strong></p>
<p>1). å¯¼å…¥Spring Cacheå’ŒRedisç›¸å…³mavenåæ ‡</p>
<p>2). åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCachingæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</p>
<p>3). åœ¨ç”¨æˆ·ç«¯æ¥å£SetmealControllerçš„ list æ–¹æ³•ä¸ŠåŠ å…¥@Cacheableæ³¨è§£</p>
<p>4). åœ¨ç®¡ç†ç«¯æ¥å£SetmealControllerçš„ saveã€deleteã€updateã€startOrStopç­‰æ–¹æ³•ä¸ŠåŠ å…¥CacheEvictæ³¨è§£</p>
<h3 id="2-3-ä»£ç å¼€å‘"><a href="#2-3-ä»£ç å¼€å‘" class="headerlink" title="2.3 ä»£ç å¼€å‘"></a>2.3 ä»£ç å¼€å‘</h3><h4 id="2-3-1-EnableCaching"><a href="#2-3-1-EnableCaching" class="headerlink" title="2.3.1 @EnableCaching"></a>2.3.1 @EnableCaching</h4><p><strong>åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCachingæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cache.annotation.EnableCaching;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableTransactionManagement</span> <span class="hljs-comment">//å¼€å¯æ³¨è§£æ–¹å¼çš„äº‹åŠ¡ç®¡ç†</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SkyApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(SkyApplication.class, args);<br>        log.info(<span class="hljs-string">&quot;server started&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="2-3-2-ç”¨æˆ·ç«¯æ¥å£"><a href="#2-3-2-ç”¨æˆ·ç«¯æ¥å£" class="headerlink" title="2.3.2 ç”¨æˆ·ç«¯æ¥å£"></a>2.3.2 ç”¨æˆ·ç«¯æ¥å£</h4><p><strong>åœ¨ç”¨æˆ·ç«¯æ¥å£SetmealControllerçš„ list æ–¹æ³•ä¸ŠåŠ å…¥@Cacheableæ³¨è§£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ¡ä»¶æŸ¥è¯¢</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> categoryId</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤&quot;)</span><br>   <span class="hljs-meta">@Cacheable(cacheNames = &quot;setmealCache&quot;,key = &quot;#categoryId&quot;)</span> <span class="hljs-comment">//key: setmealCache::100</span><br>   <span class="hljs-keyword">public</span> Result&lt;List&lt;Setmeal&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long categoryId)</span> &#123;<br>       <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Setmeal</span>();<br>       setmeal.setCategoryId(categoryId);<br>       setmeal.setStatus(StatusConstant.ENABLE);<br><br>       List&lt;Setmeal&gt; list = setmealService.list(setmeal);<br>       <span class="hljs-keyword">return</span> Result.success(list);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-3-3-ç®¡ç†ç«¯æ¥å£"><a href="#2-3-3-ç®¡ç†ç«¯æ¥å£" class="headerlink" title="2.3.3 ç®¡ç†ç«¯æ¥å£"></a>2.3.3 ç®¡ç†ç«¯æ¥å£</h4><p><strong>åœ¨ç®¡ç†ç«¯æ¥å£SetmealControllerçš„ saveã€deleteã€updateã€startOrStopç­‰æ–¹æ³•ä¸ŠåŠ å…¥CacheEvictæ³¨è§£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ–°å¢å¥—é¤</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PostMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;æ–°å¢å¥—é¤&quot;)</span><br>   <span class="hljs-meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,key = &quot;#setmealDTO.categoryId&quot;)</span><span class="hljs-comment">//key: setmealCache::100</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;<br>       setmealService.saveWithDish(setmealDTO);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ‰¹é‡åˆ é™¤å¥—é¤</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ids</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@DeleteMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;æ‰¹é‡åˆ é™¤å¥—é¤&quot;)</span><br>   <span class="hljs-meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;<br>       setmealService.deleteBatch(ids);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ä¿®æ”¹å¥—é¤</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> setmealDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PutMapping</span><br>   <span class="hljs-meta">@ApiOperation(&quot;ä¿®æ”¹å¥—é¤&quot;)</span><br>   <span class="hljs-meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;<br>       setmealService.update(setmealDTO);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * å¥—é¤èµ·å”®åœå”®</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;å¥—é¤èµ·å”®åœå”®&quot;)</span><br>   <span class="hljs-meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">startOrStop</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer status, Long id)</span> &#123;<br>       setmealService.startOrStop(status, id);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h1 id="åä¸€-è´­ç‰©è½¦ç®¡ç†"><a href="#åä¸€-è´­ç‰©è½¦ç®¡ç†" class="headerlink" title="åä¸€. è´­ç‰©è½¦ç®¡ç†"></a>åä¸€. è´­ç‰©è½¦ç®¡ç†</h1><h2 id="1-æ·»åŠ è´­ç‰©è½¦"><a href="#1-æ·»åŠ è´­ç‰©è½¦" class="headerlink" title="1. æ·»åŠ è´­ç‰©è½¦"></a>1. æ·»åŠ è´­ç‰©è½¦</h2><h3 id="1-1-Controllerå±‚-1"><a href="#1-1-Controllerå±‚-1" class="headerlink" title="1.1 Controllerå±‚"></a>1.1 Controllerå±‚</h3><p><strong>æ ¹æ®æ·»åŠ è´­ç‰©è½¦æ¥å£åˆ›å»ºShoppingCartControllerï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><br><span class="hljs-keyword">import</span> com.sky.dto.ShoppingCartDTO;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è´­ç‰©è½¦</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/shoppingCart&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;Cç«¯-è´­ç‰©è½¦æ¥å£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShoppingCartController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ShoppingCartService shoppingCartService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ·»åŠ è´­ç‰©è½¦</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;æ·»åŠ è´­ç‰©è½¦&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span>&#123;<br>        log.info(<span class="hljs-string">&quot;æ·»åŠ è´­ç‰©è½¦ï¼š&#123;&#125;&quot;</span>, shoppingCartDTO);<br>        shoppingCartService.addShoppingCart(shoppingCartDTO);<span class="hljs-comment">//åç»ªæ­¥éª¤å®ç°</span><br>        <span class="hljs-keyword">return</span> Result.success();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-2-Serviceå±‚-1"><a href="#1-2-Serviceå±‚-1" class="headerlink" title="1.2 Serviceå±‚"></a>1.2 Serviceå±‚</h3><h4 id="1-2-1-Serviceå±‚æ¥å£-1"><a href="#1-2-1-Serviceå±‚æ¥å£-1" class="headerlink" title="1.2.1 Serviceå±‚æ¥å£"></a>1.2.1 Serviceå±‚æ¥å£</h4><p><strong>åˆ›å»ºShoppingCartServiceæ¥å£ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.ShoppingCartDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.ShoppingCart;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShoppingCartService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ·»åŠ è´­ç‰©è½¦</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addShoppingCart</span><span class="hljs-params">(ShoppingCartDTO shoppingCartDTO)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="1-2-2-Serviceå±‚å®ç°ç±»-1"><a href="#1-2-2-Serviceå±‚å®ç°ç±»-1" class="headerlink" title="1.2.2 Serviceå±‚å®ç°ç±»"></a>1.2.2 Serviceå±‚å®ç°ç±»</h4><p><strong>åˆ›å»ºShoppingCartServiceImplå®ç°ç±»ï¼Œå¹¶å®ç°addæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><br><span class="hljs-keyword">import</span> com.sky.context.BaseContext;<br><span class="hljs-keyword">import</span> com.sky.dto.ShoppingCartDTO;<br><span class="hljs-keyword">import</span> com.sky.entity.Dish;<br><span class="hljs-keyword">import</span> com.sky.entity.Setmeal;<br><span class="hljs-keyword">import</span> com.sky.entity.ShoppingCart;<br><span class="hljs-keyword">import</span> com.sky.mapper.DishMapper;<br><span class="hljs-keyword">import</span> com.sky.mapper.SetmealMapper;<br><span class="hljs-keyword">import</span> com.sky.service.ShoppingCartService;<br><span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShoppingCartServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ShoppingCartService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ShoppingCartMapper shoppingCartMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DishMapper dishMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SetmealMapper setmealMapper;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ·»åŠ è´­ç‰©è½¦</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addShoppingCart</span><span class="hljs-params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;<br>        <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">shoppingCart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCart</span>();<br>        BeanUtils.copyProperties(shoppingCartDTO, shoppingCart);<br>        <span class="hljs-comment">//åªèƒ½æŸ¥è¯¢è‡ªå·±çš„è´­ç‰©è½¦æ•°æ®</span><br>        shoppingCart.setUserId(BaseContext.getCurrentId());<br><br>        <span class="hljs-comment">//åˆ¤æ–­å½“å‰å•†å“æ˜¯å¦åœ¨è´­ç‰©è½¦ä¸­</span><br>        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.list(shoppingCart);<br><br>        <span class="hljs-keyword">if</span> (shoppingCartList != <span class="hljs-literal">null</span> &amp;&amp; shoppingCartList.size() == <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-comment">//å¦‚æœå·²ç»å­˜åœ¨ï¼Œå°±æ›´æ–°æ•°é‡ï¼Œæ•°é‡åŠ 1</span><br>            shoppingCart = shoppingCartList.get(<span class="hljs-number">0</span>);<br>            shoppingCart.setNumber(shoppingCart.getNumber() + <span class="hljs-number">1</span>);<br>            shoppingCartMapper.updateNumberById(shoppingCart);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//å¦‚æœä¸å­˜åœ¨ï¼Œæ’å…¥æ•°æ®ï¼Œæ•°é‡å°±æ˜¯1</span><br><br>            <span class="hljs-comment">//åˆ¤æ–­å½“å‰æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯èœå“è¿˜æ˜¯å¥—é¤</span><br>            <span class="hljs-type">Long</span> <span class="hljs-variable">dishId</span> <span class="hljs-operator">=</span> shoppingCartDTO.getDishId();<br>            <span class="hljs-keyword">if</span> (dishId != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">//æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯èœå“</span><br>                <span class="hljs-type">Dish</span> <span class="hljs-variable">dish</span> <span class="hljs-operator">=</span> dishMapper.getById(dishId);<br>                shoppingCart.setName(dish.getName());<br>                shoppingCart.setImage(dish.getImage());<br>                shoppingCart.setAmount(dish.getPrice());<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">//æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯å¥—é¤</span><br>                <span class="hljs-type">Setmeal</span> <span class="hljs-variable">setmeal</span> <span class="hljs-operator">=</span> setmealMapper.getById(shoppingCartDTO.getSetmealId());<br>                shoppingCart.setName(setmeal.getName());<br>                shoppingCart.setImage(setmeal.getImage());<br>                shoppingCart.setAmount(setmeal.getPrice());<br>            &#125;<br>            shoppingCart.setNumber(<span class="hljs-number">1</span>);<br>            shoppingCart.setCreateTime(LocalDateTime.now());<br>            shoppingCartMapper.insert(shoppingCart);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="1-3-Mapperå±‚-1"><a href="#1-3-Mapperå±‚-1" class="headerlink" title="1.3 Mapperå±‚"></a>1.3 Mapperå±‚</h3><p><strong>åˆ›å»ºShoppingCartMapperæ¥å£:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.ShoppingCart;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Delete;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Insert;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Update;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShoppingCartMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¡ä»¶æŸ¥è¯¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCart</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;ShoppingCart&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(ShoppingCart shoppingCart)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ›´æ–°å•†å“æ•°é‡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCart</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Update(&quot;update shopping_cart set number = #&#123;number&#125; where id = #&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNumberById</span><span class="hljs-params">(ShoppingCart shoppingCart)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ’å…¥è´­ç‰©è½¦æ•°æ®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCart</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Insert(&quot;insert into shopping_cart (name, user_id, dish_id, setmeal_id, dish_flavor, number, amount, image, create_time) &quot; +</span><br><span class="hljs-meta">            &quot; values (#&#123;name&#125;,#&#123;userId&#125;,#&#123;dishId&#125;,#&#123;setmealId&#125;,#&#123;dishFlavor&#125;,#&#123;number&#125;,#&#123;amount&#125;,#&#123;image&#125;,#&#123;createTime&#125;)&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(ShoppingCart shoppingCart)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºShoppingCartMapper.xmlï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.ShoppingCartMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;ShoppingCart&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;ShoppingCart&quot;</span>&gt;</span><br>        select * from shopping_cart<br>        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;userId != null&quot;</span>&gt;</span><br>                and user_id = #&#123;userId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;dishId != null&quot;</span>&gt;</span><br>                and dish_id = #&#123;dishId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;setmealId != null&quot;</span>&gt;</span><br>                and setmeal_id = #&#123;setmealId&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;dishFlavor != null&quot;</span>&gt;</span><br>                and dish_flavor = #&#123;dishFlavor&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>        order by create_time desc<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h2 id="2-æŸ¥çœ‹è´­ç‰©è½¦"><a href="#2-æŸ¥çœ‹è´­ç‰©è½¦" class="headerlink" title="2. æŸ¥çœ‹è´­ç‰©è½¦"></a>2. æŸ¥çœ‹è´­ç‰©è½¦</h2><h3 id="2-1-Controllerå±‚"><a href="#2-1-Controllerå±‚" class="headerlink" title="2.1 Controllerå±‚"></a>2.1 Controllerå±‚</h3><p><strong>åœ¨ShoppingCartControllerä¸­åˆ›å»ºæŸ¥çœ‹è´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æŸ¥çœ‹è´­ç‰©è½¦</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;æŸ¥çœ‹è´­ç‰©è½¦&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;List&lt;ShoppingCart&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">()</span>&#123;<br>       <span class="hljs-keyword">return</span> Result.success(shoppingCartService.showShoppingCart());<br>   &#125;<br></code></pre></td></tr></table></figure>


<h3 id="2-2-Serviceå±‚æ¥å£"><a href="#2-2-Serviceå±‚æ¥å£" class="headerlink" title="2.2 Serviceå±‚æ¥å£"></a>2.2 Serviceå±‚æ¥å£</h3><p><strong>åœ¨ShoppingCartServiceæ¥å£ä¸­å£°æ˜æŸ¥çœ‹è´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æŸ¥çœ‹è´­ç‰©è½¦</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   List&lt;ShoppingCart&gt; <span class="hljs-title function_">showShoppingCart</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure>


<h3 id="2-3-Serviceå±‚å®ç°ç±»"><a href="#2-3-Serviceå±‚å®ç°ç±»" class="headerlink" title="2.3 Serviceå±‚å®ç°ç±»"></a>2.3 Serviceå±‚å®ç°ç±»</h3><p><strong>åœ¨ShoppingCartServiceImplä¸­å®ç°æŸ¥çœ‹è´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æŸ¥çœ‹è´­ç‰©è½¦</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> List&lt;ShoppingCart&gt; <span class="hljs-title function_">showShoppingCart</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> shoppingCartMapper.list(ShoppingCart.<br>                                      builder().<br>                                      userId(BaseContext.getCurrentId()).<br>                                      build());<br>   &#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-æ¸…ç©ºè´­ç‰©è½¦"><a href="#3-æ¸…ç©ºè´­ç‰©è½¦" class="headerlink" title="3. æ¸…ç©ºè´­ç‰©è½¦"></a>3. æ¸…ç©ºè´­ç‰©è½¦</h2><h3 id="3-1-Controllerå±‚-2"><a href="#3-1-Controllerå±‚-2" class="headerlink" title="3.1 Controllerå±‚"></a>3.1 Controllerå±‚</h3><p><strong>åœ¨ShoppingCartControllerä¸­åˆ›å»ºæ¸…ç©ºè´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ¸…ç©ºè´­ç‰©è½¦å•†å“</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@DeleteMapping(&quot;/clean&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;æ¸…ç©ºè´­ç‰©è½¦å•†å“&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">clean</span><span class="hljs-params">()</span>&#123;<br>       shoppingCartService.cleanShoppingCart();<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>


<h3 id="3-2-Serviceå±‚æ¥å£"><a href="#3-2-Serviceå±‚æ¥å£" class="headerlink" title="3.2 Serviceå±‚æ¥å£"></a>3.2 Serviceå±‚æ¥å£</h3><p><strong>åœ¨ShoppingCartServiceæ¥å£ä¸­å£°æ˜æ¸…ç©ºè´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ¸…ç©ºè´­ç‰©è½¦å•†å“</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanShoppingCart</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure>


<h3 id="3-3-Serviceå±‚å®ç°ç±»"><a href="#3-3-Serviceå±‚å®ç°ç±»" class="headerlink" title="3.3 Serviceå±‚å®ç°ç±»"></a>3.3 Serviceå±‚å®ç°ç±»</h3><p><strong>åœ¨ShoppingCartServiceImplä¸­å®ç°æ¸…ç©ºè´­ç‰©è½¦çš„æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ¸…ç©ºè´­ç‰©è½¦å•†å“</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanShoppingCart</span><span class="hljs-params">()</span> &#123;<br>       shoppingCartMapper.deleteByUserId(BaseContext.getCurrentId());<br>   &#125;<br></code></pre></td></tr></table></figure>


<h3 id="3-4-Mapperå±‚"><a href="#3-4-Mapperå±‚" class="headerlink" title="3.4 Mapperå±‚"></a>3.4 Mapperå±‚</h3><p><strong>åœ¨ShoppingCartMapperæ¥å£ä¸­åˆ›å»ºåˆ é™¤è´­ç‰©è½¦æ•°æ®çš„æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®ç”¨æˆ·idåˆ é™¤è´­ç‰©è½¦æ•°æ®</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> userId</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Delete(&quot;delete from shopping_cart where user_id = #&#123;userId&#125;&quot;)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteByUserId</span><span class="hljs-params">(Long userId)</span>;<br></code></pre></td></tr></table></figure>

<h2 id="4-åˆ é™¤è´­ç‰©è½¦ä¸­å•ä¸ªå•†å“"><a href="#4-åˆ é™¤è´­ç‰©è½¦ä¸­å•ä¸ªå•†å“" class="headerlink" title="4. åˆ é™¤è´­ç‰©è½¦ä¸­å•ä¸ªå•†å“"></a>4. åˆ é™¤è´­ç‰©è½¦ä¸­å•ä¸ªå•†å“</h2><h3 id="4-1-ShoppingCartController"><a href="#4-1-ShoppingCartController" class="headerlink" title="4.1 ShoppingCartController"></a>4.1 ShoppingCartController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@PostMapping(&quot;/sub&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">sub</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“ï¼Œå•†å“ï¼š&#123;&#125;&quot;</span>, shoppingCartDTO);<br>    shoppingCartService.subShoppingCart(shoppingCartDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="4-2-ShoppingCartService"><a href="#4-2-ShoppingCartService" class="headerlink" title="4.2 ShoppingCartService"></a>4.2 ShoppingCartService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">subShoppingCart</span><span class="hljs-params">(ShoppingCartDTO shoppingCartDTO)</span>;<br></code></pre></td></tr></table></figure>



<h3 id="4-3-ShoppingCartServiceImpl"><a href="#4-3-ShoppingCartServiceImpl" class="headerlink" title="4.3 ShoppingCartServiceImpl"></a>4.3 ShoppingCartServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> shoppingCartDTO</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subShoppingCart</span><span class="hljs-params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;<br>    <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">shoppingCart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCart</span>();<br>    BeanUtils.copyProperties(shoppingCartDTO,shoppingCart);<br>    <span class="hljs-comment">//è®¾ç½®æŸ¥è¯¢æ¡ä»¶ï¼ŒæŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®</span><br>    shoppingCart.setUserId(BaseContext.getCurrentId());<br><br>    List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);<br><br>    <span class="hljs-keyword">if</span>(list != <span class="hljs-literal">null</span> &amp;&amp; list.size() &gt; <span class="hljs-number">0</span>)&#123;<br>        shoppingCart = list.get(<span class="hljs-number">0</span>);<br><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> shoppingCart.getNumber();<br>        <span class="hljs-keyword">if</span>(number == <span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-comment">//å½“å‰å•†å“åœ¨è´­ç‰©è½¦ä¸­çš„ä»½æ•°ä¸º1ï¼Œç›´æ¥åˆ é™¤å½“å‰è®°å½•</span><br>            shoppingCartMapper.deleteById(shoppingCart.getId());<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//å½“å‰å•†å“åœ¨è´­ç‰©è½¦ä¸­çš„ä»½æ•°ä¸ä¸º1ï¼Œä¿®æ”¹ä»½æ•°å³å¯</span><br>            shoppingCart.setNumber(shoppingCart.getNumber() - <span class="hljs-number">1</span>);<br>            shoppingCartMapper.updateNumberById(shoppingCart);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-ShoppingCartMapper"><a href="#4-4-ShoppingCartMapper" class="headerlink" title="4.4 ShoppingCartMapper"></a>4.4 ShoppingCartMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®idåˆ é™¤è´­ç‰©è½¦æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Delete(&quot;delete from shopping_cart where id = #&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>


<h1 id="åäºŒ-ç”¨æˆ·ä¸‹å•å’Œè®¢å•æ”¯ä»˜"><a href="#åäºŒ-ç”¨æˆ·ä¸‹å•å’Œè®¢å•æ”¯ä»˜" class="headerlink" title="åäºŒ. ç”¨æˆ·ä¸‹å•å’Œè®¢å•æ”¯ä»˜"></a>åäºŒ. ç”¨æˆ·ä¸‹å•å’Œè®¢å•æ”¯ä»˜</h1><h2 id="1-ç”¨æˆ·ä¸‹å•"><a href="#1-ç”¨æˆ·ä¸‹å•" class="headerlink" title="1. ç”¨æˆ·ä¸‹å•"></a>1. ç”¨æˆ·ä¸‹å•</h2><h3 id="1-1-Controllerå±‚-2"><a href="#1-1-Controllerå±‚-2" class="headerlink" title="1.1 Controllerå±‚"></a>1.1 Controllerå±‚</h3><p><strong>åˆ›å»ºOrderControllerå¹¶æä¾›ç”¨æˆ·ä¸‹å•æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.user;<br><br><span class="hljs-keyword">import</span> com.sky.dto.OrdersPaymentDTO;<br><span class="hljs-keyword">import</span> com.sky.dto.OrdersSubmitDTO;<br><span class="hljs-keyword">import</span> com.sky.result.PageResult;<br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.OrderService;<br><span class="hljs-keyword">import</span> com.sky.vo.OrderPaymentVO;<br><span class="hljs-keyword">import</span> com.sky.vo.OrderSubmitVO;<br><span class="hljs-keyword">import</span> com.sky.vo.OrderVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è®¢å•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController(&quot;userOrderController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/user/order&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;Cç«¯-è®¢å•æ¥å£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·ä¸‹å•</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ordersSubmitDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/submit&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;ç”¨æˆ·ä¸‹å•&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;OrderSubmitVO&gt; <span class="hljs-title function_">submit</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersSubmitDTO ordersSubmitDTO)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;ç”¨æˆ·ä¸‹å•ï¼š&#123;&#125;&quot;</span>, ordersSubmitDTO);<br>        <span class="hljs-type">OrderSubmitVO</span> <span class="hljs-variable">orderSubmitVO</span> <span class="hljs-operator">=</span> orderService.submitOrder(ordersSubmitDTO);<br>        <span class="hljs-keyword">return</span> Result.success(orderSubmitVO);<br>    &#125; <br><br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="1-2-Serviceå±‚-2"><a href="#1-2-Serviceå±‚-2" class="headerlink" title="1.2 Serviceå±‚"></a>1.2 Serviceå±‚</h3><h4 id="1-2-1-Serviceæ¥å£"><a href="#1-2-1-Serviceæ¥å£" class="headerlink" title="1.2.1 Serviceæ¥å£"></a>1.2.1 Serviceæ¥å£</h4><p><strong>åˆ›å»ºOrderServiceæ¥å£ï¼Œå¹¶å£°æ˜ç”¨æˆ·ä¸‹å•æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.dto.*;<br><span class="hljs-keyword">import</span> com.sky.vo.OrderSubmitVO;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·ä¸‹å•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ordersSubmitDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    OrderSubmitVO <span class="hljs-title function_">submitOrder</span><span class="hljs-params">(OrdersSubmitDTO ordersSubmitDTO)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="1-2-2-Serviceå±‚å®ç°ç±»-2"><a href="#1-2-2-Serviceå±‚å®ç°ç±»-2" class="headerlink" title="1.2.2 Serviceå±‚å®ç°ç±»"></a>1.2.2 Serviceå±‚å®ç°ç±»</h4><p><strong>åˆ›å»ºOrderServiceImplå®ç°OrderServiceæ¥å£ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è®¢å•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderMapper orderMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderDetailMapper orderDetailMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ShoppingCartMapper shoppingCartMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AddressBookMapper addressBookMapper;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·ä¸‹å•</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ordersSubmitDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> OrderSubmitVO <span class="hljs-title function_">submitOrder</span><span class="hljs-params">(OrdersSubmitDTO ordersSubmitDTO)</span> &#123;<br>        <span class="hljs-comment">//å¼‚å¸¸æƒ…å†µçš„å¤„ç†ï¼ˆæ”¶è´§åœ°å€ä¸ºç©ºã€è¶…å‡ºé…é€èŒƒå›´ã€è´­ç‰©è½¦ä¸ºç©ºï¼‰</span><br>        <span class="hljs-type">AddressBook</span> <span class="hljs-variable">addressBook</span> <span class="hljs-operator">=</span> addressBookMapper.getById(ordersSubmitDTO.getAddressBookId());<br>        <span class="hljs-keyword">if</span> (addressBook == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddressBookBusinessException</span>(MessageConstant.ADDRESS_BOOK_IS_NULL);<br>        &#125;<br><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br>        <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">shoppingCart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCart</span>();<br>        shoppingCart.setUserId(userId);<br><br>        <span class="hljs-comment">//æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®</span><br>        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.list(shoppingCart);<br>        <span class="hljs-keyword">if</span> (shoppingCartList == <span class="hljs-literal">null</span> || shoppingCartList.size() == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCartBusinessException</span>(MessageConstant.SHOPPING_CART_IS_NULL);<br>        &#125;<br><br>        <span class="hljs-comment">//æ„é€ è®¢å•æ•°æ®</span><br>        <span class="hljs-type">Orders</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>        BeanUtils.copyProperties(ordersSubmitDTO,order);<br>        order.setPhone(addressBook.getPhone());<br>        order.setAddress(addressBook.getDetail());<br>        order.setConsignee(addressBook.getConsignee());<br>        order.setNumber(String.valueOf(System.currentTimeMillis()));<br>        order.setUserId(userId);<br>        order.setStatus(Orders.PENDING_PAYMENT);<br>        order.setPayStatus(Orders.UN_PAID);<br>        order.setOrderTime(LocalDateTime.now());<br><br>        <span class="hljs-comment">//å‘è®¢å•è¡¨æ’å…¥1æ¡æ•°æ®</span><br>        orderMapper.insert(order);<br><br>        <span class="hljs-comment">//è®¢å•æ˜ç»†æ•°æ®</span><br>        List&lt;OrderDetail&gt; orderDetailList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (ShoppingCart cart : shoppingCartList) &#123;<br>            <span class="hljs-type">OrderDetail</span> <span class="hljs-variable">orderDetail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDetail</span>();<br>            BeanUtils.copyProperties(cart, orderDetail);<br>            orderDetail.setOrderId(order.getId());<br>            orderDetailList.add(orderDetail);<br>        &#125;<br><br>        <span class="hljs-comment">//å‘æ˜ç»†è¡¨æ’å…¥næ¡æ•°æ®</span><br>        orderDetailMapper.insertBatch(orderDetailList);<br><br>        <span class="hljs-comment">//æ¸…ç†è´­ç‰©è½¦ä¸­çš„æ•°æ®</span><br>        shoppingCartMapper.deleteByUserId(userId);<br><br>        <span class="hljs-comment">//å°è£…è¿”å›ç»“æœ</span><br>        <span class="hljs-type">OrderSubmitVO</span> <span class="hljs-variable">orderSubmitVO</span> <span class="hljs-operator">=</span> OrderSubmitVO.builder()<br>                .id(order.getId())<br>                .orderNumber(order.getNumber())<br>                .orderAmount(order.getAmount())<br>                .orderTime(order.getOrderTime())<br>                .build();<br><br>        <span class="hljs-keyword">return</span> orderSubmitVO;<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-Mapperå±‚-2"><a href="#1-3-Mapperå±‚-2" class="headerlink" title="1.3 Mapperå±‚"></a>1.3 Mapperå±‚</h3><h4 id="1-3-1-åˆ›å»ºOrderMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶"><a href="#1-3-1-åˆ›å»ºOrderMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶" class="headerlink" title="1.3.1 åˆ›å»ºOrderMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶"></a>1.3.1 åˆ›å»ºOrderMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶</h4><p>OrderMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ’å…¥è®¢å•æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> order</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Orders order)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>OrderMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.OrderMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insert&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Orders&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>        insert into orders<br>        (number, status, user_id, address_book_id, order_time, checkout_time, pay_method, pay_status, amount, remark,<br>         phone, address, consignee, estimated_delivery_time, delivery_status, pack_amount, tableware_number,<br>         tableware_status)<br>        values (#&#123;number&#125;, #&#123;status&#125;, #&#123;userId&#125;, #&#123;addressBookId&#125;, #&#123;orderTime&#125;, #&#123;checkoutTime&#125;, #&#123;payMethod&#125;,<br>                #&#123;payStatus&#125;, #&#123;amount&#125;, #&#123;remark&#125;, #&#123;phone&#125;, #&#123;address&#125;, #&#123;consignee&#125;,<br>                #&#123;estimatedDeliveryTime&#125;, #&#123;deliveryStatus&#125;, #&#123;packAmount&#125;, #&#123;tablewareNumber&#125;, #&#123;tablewareStatus&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<h4 id="1-3-2-åˆ›å»ºOrderDetailMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶"><a href="#1-3-2-åˆ›å»ºOrderDetailMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶" class="headerlink" title="1.3.2 åˆ›å»ºOrderDetailMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶"></a>1.3.2 åˆ›å»ºOrderDetailMapperæ¥å£å’Œå¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶</h4><p>OrderDetailMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.mapper;<br><br><span class="hljs-keyword">import</span> com.sky.entity.OrderDetail;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderDetailMapper</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰¹é‡æ’å…¥è®¢å•æ˜ç»†æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderDetails</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBatch</span><span class="hljs-params">(List&lt;OrderDetail&gt; orderDetails)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>OrderDetailMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.sky.mapper.OrderDetailMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertBatch&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>        insert into order_detail<br>        (name, order_id, dish_id, setmeal_id, dish_flavor, number, amount, image)<br>        values<br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;orderDetails&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;od&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>            (#&#123;od.name&#125;,#&#123;od.orderId&#125;,#&#123;od.dishId&#125;,#&#123;od.setmealId&#125;,#&#123;od.dishFlavor&#125;,<br>             #&#123;od.number&#125;,#&#123;od.amount&#125;,#&#123;od.image&#125;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="2-è®¢å•æ”¯ä»˜"><a href="#2-è®¢å•æ”¯ä»˜" class="headerlink" title="2. è®¢å•æ”¯ä»˜"></a>2. è®¢å•æ”¯ä»˜</h2><h3 id="2-1-å¾®ä¿¡æ”¯ä»˜æµç¨‹"><a href="#2-1-å¾®ä¿¡æ”¯ä»˜æµç¨‹" class="headerlink" title="2.1 å¾®ä¿¡æ”¯ä»˜æµç¨‹"></a>2.1 å¾®ä¿¡æ”¯ä»˜æµç¨‹</h3><p><img src="/img/blogs/java/cangqiongtakeout/12.2.1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-2-ä»£ç å¯¼å…¥"><a href="#2-2-ä»£ç å¯¼å…¥" class="headerlink" title="2.2 ä»£ç å¯¼å…¥"></a>2.2 ä»£ç å¯¼å…¥</h3><h4 id="2-2-1-Mapperå±‚"><a href="#2-2-1-Mapperå±‚" class="headerlink" title="2.2.1 Mapperå±‚"></a>2.2.1 Mapperå±‚</h4><p><strong>åœ¨OrderMapper.javaä¸­æ·»åŠ getByNumberAndUserIdå’Œupdateä¸¤ä¸ªæ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®è®¢å•å·å’Œç”¨æˆ·idæŸ¥è¯¢è®¢å•</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> orderNumber</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> userId</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select * from orders where number = #&#123;orderNumber&#125; and user_id= #&#123;userId&#125;&quot;)</span><br>   Orders <span class="hljs-title function_">getByNumberAndUserId</span><span class="hljs-params">(String orderNumber, Long userId)</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ä¿®æ”¹è®¢å•ä¿¡æ¯</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> orders</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Orders orders)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨OrderMapper.xmlä¸­æ·»åŠ </strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;update&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.sky.entity.Orders&quot;</span>&gt;</span><br>        update orders<br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;cancelReason != null and cancelReason!=&#x27;&#x27; &quot;</span>&gt;</span><br>                cancel_reason=#&#123;cancelReason&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;rejectionReason != null and rejectionReason!=&#x27;&#x27; &quot;</span>&gt;</span><br>                rejection_reason=#&#123;rejectionReason&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;cancelTime != null&quot;</span>&gt;</span><br>                cancel_time=#&#123;cancelTime&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;payStatus != null&quot;</span>&gt;</span><br>                pay_status=#&#123;payStatus&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;payMethod != null&quot;</span>&gt;</span><br>                pay_method=#&#123;payMethod&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;checkoutTime != null&quot;</span>&gt;</span><br>                checkout_time=#&#123;checkoutTime&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                status = #&#123;status&#125;,<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;deliveryTime != null&quot;</span>&gt;</span><br>                delivery_time = #&#123;deliveryTime&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>        where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h4 id="2-2-2-Serviceå±‚"><a href="#2-2-2-Serviceå±‚" class="headerlink" title="2.2.2 Serviceå±‚"></a>2.2.2 Serviceå±‚</h4><p><strong>åœ¨OrderService.javaä¸­æ·»åŠ paymentå’ŒpaySuccessä¸¤ä¸ªæ–¹æ³•å®šä¹‰</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * è®¢å•æ”¯ä»˜</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ordersPaymentDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   OrderPaymentVO <span class="hljs-title function_">payment</span><span class="hljs-params">(OrdersPaymentDTO ordersPaymentDTO)</span> <span class="hljs-keyword">throws</span> Exception;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ”¯ä»˜æˆåŠŸï¼Œä¿®æ”¹è®¢å•çŠ¶æ€</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> outTradeNo</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">paySuccess</span><span class="hljs-params">(String outTradeNo)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨OrderServiceImpl.javaä¸­å®ç°paymentå’ŒpaySuccessä¸¤ä¸ªæ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java">	<span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> UserMapper userMapper;<br><span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> WeChatPayUtil weChatPayUtil;<br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * è®¢å•æ”¯ä»˜</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ordersPaymentDTO</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> OrderPaymentVO <span class="hljs-title function_">payment</span><span class="hljs-params">(OrdersPaymentDTO ordersPaymentDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>       <span class="hljs-comment">// å½“å‰ç™»å½•ç”¨æˆ·id</span><br>       <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br>       <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.getById(userId);<br><br>       <span class="hljs-comment">//è°ƒç”¨å¾®ä¿¡æ”¯ä»˜æ¥å£ï¼Œç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•</span><br>       <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> weChatPayUtil.pay(<br>               ordersPaymentDTO.getOrderNumber(), <span class="hljs-comment">//å•†æˆ·è®¢å•å·</span><br>               <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>), <span class="hljs-comment">//æ”¯ä»˜é‡‘é¢ï¼Œå•ä½ å…ƒ</span><br>               <span class="hljs-string">&quot;è‹ç©¹å¤–å–è®¢å•&quot;</span>, <span class="hljs-comment">//å•†å“æè¿°</span><br>               user.getOpenid() <span class="hljs-comment">//å¾®ä¿¡ç”¨æˆ·çš„openid</span><br>       );<br><br>       <span class="hljs-keyword">if</span> (jsonObject.getString(<span class="hljs-string">&quot;code&quot;</span>) != <span class="hljs-literal">null</span> &amp;&amp; jsonObject.getString(<span class="hljs-string">&quot;code&quot;</span>).equals(<span class="hljs-string">&quot;ORDERPAID&quot;</span>)) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(<span class="hljs-string">&quot;è¯¥è®¢å•å·²æ”¯ä»˜&quot;</span>);<br>       &#125;<br><br>       <span class="hljs-type">OrderPaymentVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> jsonObject.toJavaObject(OrderPaymentVO.class);<br>       vo.setPackageStr(jsonObject.getString(<span class="hljs-string">&quot;package&quot;</span>));<br><br>       <span class="hljs-keyword">return</span> vo;<br>   &#125;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ”¯ä»˜æˆåŠŸï¼Œä¿®æ”¹è®¢å•çŠ¶æ€</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> outTradeNo</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">paySuccess</span><span class="hljs-params">(String outTradeNo)</span> &#123;<br>       <span class="hljs-comment">// å½“å‰ç™»å½•ç”¨æˆ·id</span><br>       <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>       <span class="hljs-comment">// æ ¹æ®è®¢å•å·æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è®¢å•</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getByNumberAndUserId(outTradeNo, userId);<br><br>       <span class="hljs-comment">// æ ¹æ®è®¢å•idæ›´æ–°è®¢å•çš„çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ã€æ”¯ä»˜çŠ¶æ€ã€ç»“è´¦æ—¶é—´</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> Orders.builder()<br>               .id(ordersDB.getId())<br>               .status(Orders.TO_BE_CONFIRMED)<br>               .payStatus(Orders.PAID)<br>               .checkoutTime(LocalDateTime.now())<br>               .build();<br><br>       orderMapper.update(orders);<br>   &#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-2-3-Controllerå±‚"><a href="#2-2-3-Controllerå±‚" class="headerlink" title="2.2.3 Controllerå±‚"></a>2.2.3 Controllerå±‚</h4><p><strong>åœ¨OrderController.javaä¸­æ·»åŠ paymentæ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">   * è®¢å•æ”¯ä»˜</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> ordersPaymentDTO</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-meta">@PutMapping(&quot;/payment&quot;)</span><br>  <span class="hljs-meta">@ApiOperation(&quot;è®¢å•æ”¯ä»˜&quot;)</span><br>  <span class="hljs-keyword">public</span> Result&lt;OrderPaymentVO&gt; <span class="hljs-title function_">payment</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersPaymentDTO ordersPaymentDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      log.info(<span class="hljs-string">&quot;è®¢å•æ”¯ä»˜ï¼š&#123;&#125;&quot;</span>, ordersPaymentDTO);<br>      <span class="hljs-type">OrderPaymentVO</span> <span class="hljs-variable">orderPaymentVO</span> <span class="hljs-operator">=</span> orderService.payment(ordersPaymentDTO);<br>      log.info(<span class="hljs-string">&quot;ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼š&#123;&#125;&quot;</span>, orderPaymentVO);<br>      <span class="hljs-keyword">return</span> Result.success(orderPaymentVO);<br>  &#125;<br></code></pre></td></tr></table></figure>

<p><strong>å¯¼å…¥PayNotifyController.java</strong></p>
<h3 id="2-3-è·³è¿‡å¾®ä¿¡æ”¯ä»˜"><a href="#2-3-è·³è¿‡å¾®ä¿¡æ”¯ä»˜" class="headerlink" title="2.3 è·³è¿‡å¾®ä¿¡æ”¯ä»˜"></a>2.3 è·³è¿‡å¾®ä¿¡æ”¯ä»˜</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/XZY__one/article/details/135818055">è·³è¿‡å¾®ä¿¡æ”¯ä»˜</a></p>
<h1 id="åä¸‰-ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—"><a href="#åä¸‰-ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—" class="headerlink" title="åä¸‰. ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—"></a>åä¸‰. ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—</h1><h2 id="1-å†å²è®¢å•æŸ¥è¯¢"><a href="#1-å†å²è®¢å•æŸ¥è¯¢" class="headerlink" title="1. å†å²è®¢å•æŸ¥è¯¢"></a>1. å†å²è®¢å•æŸ¥è¯¢</h2><h3 id="1-1-user-OrderController"><a href="#1-1-user-OrderController" class="headerlink" title="1.1 user&#x2F;OrderController"></a>1.1 user&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å†å²è®¢å•æŸ¥è¯¢</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageSize</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> status   è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/historyOrders&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å†å²è®¢å•æŸ¥è¯¢&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, Integer status)</span> &#123;<br>    <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> orderService.pageQuery4User(page, pageSize, status);<br>    <span class="hljs-keyword">return</span> Result.success(pageResult);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-OrderService"><a href="#1-2-OrderService" class="headerlink" title="1.2 OrderService"></a>1.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨æˆ·ç«¯è®¢å•åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageSize</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>PageResult <span class="hljs-title function_">pageQuery4User</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, Integer status)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-OrderServiceImpl"><a href="#1-3-OrderServiceImpl" class="headerlink" title="1.3 OrderServiceImpl"></a>1.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·ç«¯è®¢å•åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageNum</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageSize</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">pageQuery4User</span><span class="hljs-params">(<span class="hljs-type">int</span> pageNum, <span class="hljs-type">int</span> pageSize, Integer status)</span> &#123;<br>        <span class="hljs-comment">// è®¾ç½®åˆ†é¡µ</span><br>        PageHelper.startPage(pageNum, pageSize);<br><br>        <span class="hljs-type">OrdersPageQueryDTO</span> <span class="hljs-variable">ordersPageQueryDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrdersPageQueryDTO</span>();<br>        ordersPageQueryDTO.setUserId(BaseContext.getCurrentId());<br>        ordersPageQueryDTO.setStatus(status);<br><br>        <span class="hljs-comment">// åˆ†é¡µæ¡ä»¶æŸ¥è¯¢</span><br>        Page&lt;Orders&gt; page = orderMapper.pageQuery(ordersPageQueryDTO);<br><br>        List&lt;OrderVO&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br><br>        <span class="hljs-comment">// æŸ¥è¯¢å‡ºè®¢å•æ˜ç»†ï¼Œå¹¶å°è£…å…¥OrderVOè¿›è¡Œå“åº”</span><br>        <span class="hljs-keyword">if</span> (page != <span class="hljs-literal">null</span> &amp;&amp; page.getTotal() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Orders orders : page) &#123;<br>                <span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> orders.getId();<span class="hljs-comment">// è®¢å•id</span><br><br>                <span class="hljs-comment">// æŸ¥è¯¢è®¢å•æ˜ç»†</span><br>                List&lt;OrderDetail&gt; orderDetails = orderDetailMapper.getByOrderId(orderId);<br><br>                <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderVO</span>();<br>                BeanUtils.copyProperties(orders, orderVO);<br>                orderVO.setOrderDetailList(orderDetails);<br><br>                list.add(orderVO);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(page.getTotal(), list);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-4-OrderMapper"><a href="#1-4-OrderMapper" class="headerlink" title="1.4 OrderMapper"></a>1.4 OrderMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ†é¡µæ¡ä»¶æŸ¥è¯¢å¹¶æŒ‰ä¸‹å•æ—¶é—´æ’åº</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersPageQueryDTO</span><br><span class="hljs-comment"> */</span><br>Page&lt;Orders&gt; <span class="hljs-title function_">pageQuery</span><span class="hljs-params">(OrdersPageQueryDTO ordersPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-5-OrderMapper-xml"><a href="#1-5-OrderMapper-xml" class="headerlink" title="1.5 OrderMapper.xml"></a>1.5 OrderMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pageQuery&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Orders&quot;</span>&gt;</span><br>    select * from orders<br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;number != null and number!=&#x27;&#x27;&quot;</span>&gt;</span><br>            and number like concat(&#x27;%&#x27;,#&#123;number&#125;,&#x27;%&#x27;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;phone != null and phone!=&#x27;&#x27;&quot;</span>&gt;</span><br>            and phone like concat(&#x27;%&#x27;,#&#123;phone&#125;,&#x27;%&#x27;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;userId != null&quot;</span>&gt;</span><br>            and user_id = #&#123;userId&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>            and status = #&#123;status&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;beginTime != null&quot;</span>&gt;</span><br>            and order_time <span class="hljs-symbol">&amp;gt;</span>= #&#123;beginTime&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;endTime != null&quot;</span>&gt;</span><br>            and order_time <span class="hljs-symbol">&amp;lt;</span>= #&#123;endTime&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br>    order by order_time desc<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-6-OrderDetailMapper"><a href="#1-6-OrderDetailMapper" class="headerlink" title="1.6 OrderDetailMapper"></a>1.6 OrderDetailMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®è®¢å•idæŸ¥è¯¢è®¢å•æ˜ç»†</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> orderId</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Select(&quot;select * from order_detail where order_id = #&#123;orderId&#125;&quot;)</span><br>List&lt;OrderDetail&gt; <span class="hljs-title function_">getByOrderId</span><span class="hljs-params">(Long orderId)</span>;<br></code></pre></td></tr></table></figure>



<h2 id="2-æŸ¥è¯¢è®¢å•è¯¦æƒ…"><a href="#2-æŸ¥è¯¢è®¢å•è¯¦æƒ…" class="headerlink" title="2. æŸ¥è¯¢è®¢å•è¯¦æƒ…"></a>2. æŸ¥è¯¢è®¢å•è¯¦æƒ…</h2><h3 id="2-1-user-OrderController"><a href="#2-1-user-OrderController" class="headerlink" title="2.1 user&#x2F;OrderController"></a>2.1 user&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŸ¥è¯¢è®¢å•è¯¦æƒ…</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/orderDetail/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;æŸ¥è¯¢è®¢å•è¯¦æƒ…&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;OrderVO&gt; <span class="hljs-title function_">details</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>    <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> orderService.details(id);<br>    <span class="hljs-keyword">return</span> Result.success(orderVO);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-OrderService"><a href="#2-2-OrderService" class="headerlink" title="2.2 OrderService"></a>2.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŸ¥è¯¢è®¢å•è¯¦æƒ…</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>OrderVO <span class="hljs-title function_">details</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-OrderServiceImpl"><a href="#2-3-OrderServiceImpl" class="headerlink" title="2.3 OrderServiceImpl"></a>2.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŸ¥è¯¢è®¢å•è¯¦æƒ…</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> OrderVO <span class="hljs-title function_">details</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br><br>    <span class="hljs-comment">// æŸ¥è¯¢è¯¥è®¢å•å¯¹åº”çš„èœå“/å¥—é¤æ˜ç»†</span><br>    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId());<br><br>    <span class="hljs-comment">// å°†è¯¥è®¢å•åŠå…¶è¯¦æƒ…å°è£…åˆ°OrderVOå¹¶è¿”å›</span><br>    <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderVO</span>();<br>    BeanUtils.copyProperties(orders, orderVO);<br>    orderVO.setOrderDetailList(orderDetailList);<br><br>    <span class="hljs-keyword">return</span> orderVO;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-OrderMapper"><a href="#2-4-OrderMapper" class="headerlink" title="2.4 OrderMapper"></a>2.4 OrderMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®idæŸ¥è¯¢è®¢å•</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Select(&quot;select * from orders where id=#&#123;id&#125;&quot;)</span><br>Orders <span class="hljs-title function_">getById</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>


<h2 id="3-å–æ¶ˆè®¢å•"><a href="#3-å–æ¶ˆè®¢å•" class="headerlink" title="3. å–æ¶ˆè®¢å•"></a>3. å–æ¶ˆè®¢å•</h2><h3 id="3-1-user-OrderController"><a href="#3-1-user-OrderController" class="headerlink" title="3.1 user&#x2F;OrderController"></a>3.1 user&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨æˆ·å–æ¶ˆè®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/cancel/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å–æ¶ˆè®¢å•&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">cancel</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    orderService.userCancelById(id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-OrderService"><a href="#3-2-OrderService" class="headerlink" title="3.2 OrderService"></a>3.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨æˆ·å–æ¶ˆè®¢å•</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">userCancelById</span><span class="hljs-params">(Long id)</span> <span class="hljs-keyword">throws</span> Exception;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-OrderServiceImpl"><a href="#3-3-OrderServiceImpl" class="headerlink" title="3.3 OrderServiceImpl"></a>3.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨æˆ·å–æ¶ˆè®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">userCancelById</span><span class="hljs-params">(Long id)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br><br>    <span class="hljs-comment">// æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> (ordersDB == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_NOT_FOUND);<br>    &#125;<br><br>    <span class="hljs-comment">//è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ</span><br>    <span class="hljs-keyword">if</span> (ordersDB.getStatus() &gt; <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);<br>    &#125;<br><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersDB.getId());<br><br>    <span class="hljs-comment">// è®¢å•å¤„äºå¾…æ¥å•çŠ¶æ€ä¸‹å–æ¶ˆï¼Œéœ€è¦è¿›è¡Œé€€æ¬¾</span><br>    <span class="hljs-keyword">if</span> (ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) &#123;<br>        <span class="hljs-comment">//è°ƒç”¨å¾®ä¿¡æ”¯ä»˜é€€æ¬¾æ¥å£</span><br>        weChatPayUtil.refund(<br>                ordersDB.getNumber(), <span class="hljs-comment">//å•†æˆ·è®¢å•å·</span><br>                ordersDB.getNumber(), <span class="hljs-comment">//å•†æˆ·é€€æ¬¾å•å·</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>),<span class="hljs-comment">//é€€æ¬¾é‡‘é¢ï¼Œå•ä½ å…ƒ</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>));<span class="hljs-comment">//åŸè®¢å•é‡‘é¢</span><br><br>        <span class="hljs-comment">//æ”¯ä»˜çŠ¶æ€ä¿®æ”¹ä¸º é€€æ¬¾</span><br>        orders.setPayStatus(Orders.REFUND);<br>    &#125;<br><br>    <span class="hljs-comment">// æ›´æ–°è®¢å•çŠ¶æ€ã€å–æ¶ˆåŸå› ã€å–æ¶ˆæ—¶é—´</span><br>    orders.setStatus(Orders.CANCELLED);<br>    orders.setCancelReason(<span class="hljs-string">&quot;ç”¨æˆ·å–æ¶ˆ&quot;</span>);<br>    orders.setCancelTime(LocalDateTime.now());<br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="4-å†æ¥ä¸€å•"><a href="#4-å†æ¥ä¸€å•" class="headerlink" title="4. å†æ¥ä¸€å•"></a>4. å†æ¥ä¸€å•</h2><h3 id="4-1-user-OrderController"><a href="#4-1-user-OrderController" class="headerlink" title="4.1 user&#x2F;OrderController"></a>4.1 user&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å†æ¥ä¸€å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PostMapping(&quot;/repetition/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å†æ¥ä¸€å•&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">repetition</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>    orderService.repetition(id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-OrderService"><a href="#4-2-OrderService" class="headerlink" title="4.2 OrderService"></a>4.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å†æ¥ä¸€å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">repetition</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-OrderServiceImpl"><a href="#4-3-OrderServiceImpl" class="headerlink" title="4.3 OrderServiceImpl"></a>4.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å†æ¥ä¸€å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">repetition</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// æŸ¥è¯¢å½“å‰ç”¨æˆ·id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>    <span class="hljs-comment">// æ ¹æ®è®¢å•idæŸ¥è¯¢å½“å‰è®¢å•è¯¦æƒ…</span><br>    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(id);<br><br>    <span class="hljs-comment">// å°†è®¢å•è¯¦æƒ…å¯¹è±¡è½¬æ¢ä¸ºè´­ç‰©è½¦å¯¹è±¡</span><br>    List&lt;ShoppingCart&gt; shoppingCartList = orderDetailList.stream().map(x -&gt; &#123;<br>        <span class="hljs-type">ShoppingCart</span> <span class="hljs-variable">shoppingCart</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCart</span>();<br><br>        <span class="hljs-comment">// å°†åŸè®¢å•è¯¦æƒ…é‡Œé¢çš„èœå“ä¿¡æ¯é‡æ–°å¤åˆ¶åˆ°è´­ç‰©è½¦å¯¹è±¡ä¸­</span><br>        BeanUtils.copyProperties(x, shoppingCart, <span class="hljs-string">&quot;id&quot;</span>);<br>        shoppingCart.setUserId(userId);<br>        shoppingCart.setCreateTime(LocalDateTime.now());<br><br>        <span class="hljs-keyword">return</span> shoppingCart;<br>    &#125;).collect(Collectors.toList());<br><br>    <span class="hljs-comment">// å°†è´­ç‰©è½¦å¯¹è±¡æ‰¹é‡æ·»åŠ åˆ°æ•°æ®åº“</span><br>    shoppingCartMapper.insertBatch(shoppingCartList);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-ShoppingCartMapper-1"><a href="#4-4-ShoppingCartMapper-1" class="headerlink" title="4.4 ShoppingCartMapper"></a>4.4 ShoppingCartMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰¹é‡æ’å…¥è´­ç‰©è½¦æ•°æ®</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> shoppingCartList</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBatch</span><span class="hljs-params">(List&lt;ShoppingCart&gt; shoppingCartList)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-5-ShoppingCartMapper-xml"><a href="#4-5-ShoppingCartMapper-xml" class="headerlink" title="4.5 ShoppingCartMapper.xml"></a>4.5 ShoppingCartMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertBatch&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>        insert into shopping_cart<br>        (name, image, user_id, dish_id, setmeal_id, dish_flavor, number, amount, create_time)<br>        values<br>        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;shoppingCartList&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;sc&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>            (#&#123;sc.name&#125;,#&#123;sc.image&#125;,#&#123;sc.userId&#125;,#&#123;sc.dishId&#125;,#&#123;sc.setmealId&#125;,#&#123;sc.dishFlavor&#125;,#&#123;sc.number&#125;,#&#123;sc.amount&#125;,#&#123;sc.createTime&#125;)<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h1 id="åå››-å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—"><a href="#åå››-å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—" class="headerlink" title="åå››. å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—"></a>åå››. å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—</h1><h2 id="1-è®¢å•æœç´¢"><a href="#1-è®¢å•æœç´¢" class="headerlink" title="1. è®¢å•æœç´¢"></a>1. è®¢å•æœç´¢</h2><h3 id="1-1-admin-OrderController"><a href="#1-1-admin-OrderController" class="headerlink" title="1.1 admin&#x2F;OrderController"></a>1.1 admin&#x2F;OrderController</h3><p>åœ¨adminåŒ…ä¸‹åˆ›å»ºOrderController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è®¢å•ç®¡ç†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController(&quot;adminOrderController&quot;)</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/order&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;è®¢å•ç®¡ç†æ¥å£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¢å•æœç´¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ordersPageQueryDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/conditionSearch&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;è®¢å•æœç´¢&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;PageResult&gt; <span class="hljs-title function_">conditionSearch</span><span class="hljs-params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;<br>        <span class="hljs-type">PageResult</span> <span class="hljs-variable">pageResult</span> <span class="hljs-operator">=</span> orderService.conditionSearch(ordersPageQueryDTO);<br>        <span class="hljs-keyword">return</span> Result.success(pageResult);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-OrderService-1"><a href="#1-2-OrderService-1" class="headerlink" title="1.2 OrderService"></a>1.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¡ä»¶æœç´¢è®¢å•</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersPageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>PageResult <span class="hljs-title function_">conditionSearch</span><span class="hljs-params">(OrdersPageQueryDTO ordersPageQueryDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-OrderServiceImpl-1"><a href="#1-3-OrderServiceImpl-1" class="headerlink" title="1.3 OrderServiceImpl"></a>1.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è®¢å•æœç´¢</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersPageQueryDTO</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">conditionSearch</span><span class="hljs-params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;<br>    PageHelper.startPage(ordersPageQueryDTO.getPage(), ordersPageQueryDTO.getPageSize());<br><br>    Page&lt;Orders&gt; page = orderMapper.pageQuery(ordersPageQueryDTO);<br><br>    <span class="hljs-comment">// éƒ¨åˆ†è®¢å•çŠ¶æ€ï¼Œéœ€è¦é¢å¤–è¿”å›è®¢å•èœå“ä¿¡æ¯ï¼Œå°†Ordersè½¬åŒ–ä¸ºOrderVO</span><br>    List&lt;OrderVO&gt; orderVOList = getOrderVOList(page);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(page.getTotal(), orderVOList);<br>&#125;<br><br><span class="hljs-keyword">private</span> List&lt;OrderVO&gt; <span class="hljs-title function_">getOrderVOList</span><span class="hljs-params">(Page&lt;Orders&gt; page)</span> &#123;<br>    <span class="hljs-comment">// éœ€è¦è¿”å›è®¢å•èœå“ä¿¡æ¯ï¼Œè‡ªå®šä¹‰OrderVOå“åº”ç»“æœ</span><br>    List&lt;OrderVO&gt; orderVOList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    List&lt;Orders&gt; ordersList = page.getResult();<br>    <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(ordersList)) &#123;<br>        <span class="hljs-keyword">for</span> (Orders orders : ordersList) &#123;<br>            <span class="hljs-comment">// å°†å…±åŒå­—æ®µå¤åˆ¶åˆ°OrderVO</span><br>            <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderVO</span>();<br>            BeanUtils.copyProperties(orders, orderVO);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">orderDishes</span> <span class="hljs-operator">=</span> getOrderDishesStr(orders);<br><br>            <span class="hljs-comment">// å°†è®¢å•èœå“ä¿¡æ¯å°è£…åˆ°orderVOä¸­ï¼Œå¹¶æ·»åŠ åˆ°orderVOList</span><br>            orderVO.setOrderDishes(orderDishes);<br>            orderVOList.add(orderVO);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> orderVOList;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®è®¢å•idè·å–èœå“ä¿¡æ¯å­—ç¬¦ä¸²</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> orders</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> String <span class="hljs-title function_">getOrderDishesStr</span><span class="hljs-params">(Orders orders)</span> &#123;<br>    <span class="hljs-comment">// æŸ¥è¯¢è®¢å•èœå“è¯¦æƒ…ä¿¡æ¯ï¼ˆè®¢å•ä¸­çš„èœå“å’Œæ•°é‡ï¼‰</span><br>    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId());<br><br>    <span class="hljs-comment">// å°†æ¯ä¸€æ¡è®¢å•èœå“ä¿¡æ¯æ‹¼æ¥ä¸ºå­—ç¬¦ä¸²ï¼ˆæ ¼å¼ï¼šå®«ä¿é¸¡ä¸*3ï¼›ï¼‰</span><br>    List&lt;String&gt; orderDishList = orderDetailList.stream().map(x -&gt; &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">orderDish</span> <span class="hljs-operator">=</span> x.getName() + <span class="hljs-string">&quot;*&quot;</span> + x.getNumber() + <span class="hljs-string">&quot;;&quot;</span>;<br>        <span class="hljs-keyword">return</span> orderDish;<br>    &#125;).collect(Collectors.toList());<br><br>    <span class="hljs-comment">// å°†è¯¥è®¢å•å¯¹åº”çš„æ‰€æœ‰èœå“ä¿¡æ¯æ‹¼æ¥åœ¨ä¸€èµ·</span><br>    <span class="hljs-keyword">return</span> String.join(<span class="hljs-string">&quot;&quot;</span>, orderDishList);<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="2-å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡"><a href="#2-å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡" class="headerlink" title="2. å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡"></a>2. å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</h2><h3 id="2-1-admin-OrderController"><a href="#2-1-admin-OrderController" class="headerlink" title="2.1 admin&#x2F;OrderController"></a>2.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/statistics&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;OrderStatisticsVO&gt; <span class="hljs-title function_">statistics</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">OrderStatisticsVO</span> <span class="hljs-variable">orderStatisticsVO</span> <span class="hljs-operator">=</span> orderService.statistics();<br>    <span class="hljs-keyword">return</span> Result.success(orderStatisticsVO);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-OrderService-1"><a href="#2-2-OrderService-1" class="headerlink" title="2.2 OrderService"></a>2.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br>OrderStatisticsVO <span class="hljs-title function_">statistics</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-OrderServiceImpl-1"><a href="#2-3-OrderServiceImpl-1" class="headerlink" title="2.3 OrderServiceImpl"></a>2.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> OrderStatisticsVO <span class="hljs-title function_">statistics</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// æ ¹æ®çŠ¶æ€ï¼Œåˆ†åˆ«æŸ¥è¯¢å‡ºå¾…æ¥å•ã€å¾…æ´¾é€ã€æ´¾é€ä¸­çš„è®¢å•æ•°é‡</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">toBeConfirmed</span> <span class="hljs-operator">=</span> orderMapper.countStatus(Orders.TO_BE_CONFIRMED);<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">confirmed</span> <span class="hljs-operator">=</span> orderMapper.countStatus(Orders.CONFIRMED);<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">deliveryInProgress</span> <span class="hljs-operator">=</span> orderMapper.countStatus(Orders.DELIVERY_IN_PROGRESS);<br><br>    <span class="hljs-comment">// å°†æŸ¥è¯¢å‡ºçš„æ•°æ®å°è£…åˆ°orderStatisticsVOä¸­å“åº”</span><br>    <span class="hljs-type">OrderStatisticsVO</span> <span class="hljs-variable">orderStatisticsVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderStatisticsVO</span>();<br>    orderStatisticsVO.setToBeConfirmed(toBeConfirmed);<br>    orderStatisticsVO.setConfirmed(confirmed);<br>    orderStatisticsVO.setDeliveryInProgress(deliveryInProgress);<br>    <span class="hljs-keyword">return</span> orderStatisticsVO;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-OrderMapper-1"><a href="#2-4-OrderMapper-1" class="headerlink" title="2.4 OrderMapper"></a>2.4 OrderMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®çŠ¶æ€ç»Ÿè®¡è®¢å•æ•°é‡</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Select(&quot;select count(id) from orders where status = #&#123;status&#125;&quot;)</span><br>Integer <span class="hljs-title function_">countStatus</span><span class="hljs-params">(Integer status)</span>;<br></code></pre></td></tr></table></figure>


<h2 id="3-æŸ¥è¯¢è®¢å•è¯¦æƒ…"><a href="#3-æŸ¥è¯¢è®¢å•è¯¦æƒ…" class="headerlink" title="3. æŸ¥è¯¢è®¢å•è¯¦æƒ…"></a>3. æŸ¥è¯¢è®¢å•è¯¦æƒ…</h2><h3 id="3-1-admin-OrderController"><a href="#3-1-admin-OrderController" class="headerlink" title="3.1 admin&#x2F;OrderController"></a>3.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è®¢å•è¯¦æƒ…</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/details/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;æŸ¥è¯¢è®¢å•è¯¦æƒ…&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;OrderVO&gt; <span class="hljs-title function_">details</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>    <span class="hljs-type">OrderVO</span> <span class="hljs-variable">orderVO</span> <span class="hljs-operator">=</span> orderService.details(id);<br>    <span class="hljs-keyword">return</span> Result.success(orderVO);<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="4-æ¥å•"><a href="#4-æ¥å•" class="headerlink" title="4. æ¥å•"></a>4. æ¥å•</h2><h3 id="4-1-admin-OrderController"><a href="#4-1-admin-OrderController" class="headerlink" title="4.1 admin&#x2F;OrderController"></a>4.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¥å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/confirm&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;æ¥å•&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">confirm</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersConfirmDTO ordersConfirmDTO)</span> &#123;<br>    orderService.confirm(ordersConfirmDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-OrderService-1"><a href="#4-2-OrderService-1" class="headerlink" title="4.2 OrderService"></a>4.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¥å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersConfirmDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(OrdersConfirmDTO ordersConfirmDTO)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-OrderServiceImpl-1"><a href="#4-3-OrderServiceImpl-1" class="headerlink" title="4.3 OrderServiceImpl"></a>4.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¥å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersConfirmDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(OrdersConfirmDTO ordersConfirmDTO)</span> &#123;<br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> Orders.builder()<br>            .id(ordersConfirmDTO.getId())<br>            .status(Orders.CONFIRMED)<br>            .build();<br><br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-æ‹’å•"><a href="#5-æ‹’å•" class="headerlink" title="5. æ‹’å•"></a>5. æ‹’å•</h2><h3 id="5-1-admin-OrderController"><a href="#5-1-admin-OrderController" class="headerlink" title="5.1 admin&#x2F;OrderController"></a>5.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‹’å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/rejection&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;æ‹’å•&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">rejection</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersRejectionDTO ordersRejectionDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    orderService.rejection(ordersRejectionDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-2-OrderService"><a href="#5-2-OrderService" class="headerlink" title="5.2 OrderService"></a>5.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‹’å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersRejectionDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">rejection</span><span class="hljs-params">(OrdersRejectionDTO ordersRejectionDTO)</span> <span class="hljs-keyword">throws</span> Exception;<br></code></pre></td></tr></table></figure>

<h3 id="5-3-OrderServiceImpl"><a href="#5-3-OrderServiceImpl" class="headerlink" title="5.3 OrderServiceImpl"></a>5.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‹’å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersRejectionDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejection</span><span class="hljs-params">(OrdersRejectionDTO ordersRejectionDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(ordersRejectionDTO.getId());<br><br>    <span class="hljs-comment">// è®¢å•åªæœ‰å­˜åœ¨ä¸”çŠ¶æ€ä¸º2ï¼ˆå¾…æ¥å•ï¼‰æ‰å¯ä»¥æ‹’å•</span><br>    <span class="hljs-keyword">if</span> (ordersDB == <span class="hljs-literal">null</span> || !ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);<br>    &#125;<br><br>    <span class="hljs-comment">//æ”¯ä»˜çŠ¶æ€</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">payStatus</span> <span class="hljs-operator">=</span> ordersDB.getPayStatus();<br>    <span class="hljs-keyword">if</span> (payStatus == Orders.PAID) &#123;<br>        <span class="hljs-comment">//ç”¨æˆ·å·²æ”¯ä»˜ï¼Œéœ€è¦é€€æ¬¾</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">refund</span> <span class="hljs-operator">=</span> weChatPayUtil.refund(<br>                ordersDB.getNumber(),<br>                ordersDB.getNumber(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>));<br>        log.info(<span class="hljs-string">&quot;ç”³è¯·é€€æ¬¾ï¼š&#123;&#125;&quot;</span>, refund);<br>    &#125;<br><br>    <span class="hljs-comment">// æ‹’å•éœ€è¦é€€æ¬¾ï¼Œæ ¹æ®è®¢å•idæ›´æ–°è®¢å•çŠ¶æ€ã€æ‹’å•åŸå› ã€å–æ¶ˆæ—¶é—´</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersDB.getId());<br>    orders.setStatus(Orders.CANCELLED);<br>    orders.setRejectionReason(ordersRejectionDTO.getRejectionReason());<br>    orders.setCancelTime(LocalDateTime.now());<br><br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="6-å–æ¶ˆè®¢å•"><a href="#6-å–æ¶ˆè®¢å•" class="headerlink" title="6. å–æ¶ˆè®¢å•"></a>6. å–æ¶ˆè®¢å•</h2><h3 id="6-1-admin-OrderController"><a href="#6-1-admin-OrderController" class="headerlink" title="6.1 admin&#x2F;OrderController"></a>6.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å–æ¶ˆè®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/cancel&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å–æ¶ˆè®¢å•&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">cancel</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrdersCancelDTO ordersCancelDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    orderService.cancel(ordersCancelDTO);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="6-2-OrderService"><a href="#6-2-OrderService" class="headerlink" title="6.2 OrderService"></a>6.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å•†å®¶å–æ¶ˆè®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersCancelDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(OrdersCancelDTO ordersCancelDTO)</span> <span class="hljs-keyword">throws</span> Exception;<br></code></pre></td></tr></table></figure>

<h3 id="6-3-OrderServiceImpl"><a href="#6-3-OrderServiceImpl" class="headerlink" title="6.3 OrderServiceImpl"></a>6.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å–æ¶ˆè®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> ordersCancelDTO</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(OrdersCancelDTO ordersCancelDTO)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(ordersCancelDTO.getId());<br><br>    <span class="hljs-comment">//æ”¯ä»˜çŠ¶æ€</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">payStatus</span> <span class="hljs-operator">=</span> ordersDB.getPayStatus();<br>    <span class="hljs-keyword">if</span> (payStatus == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">//ç”¨æˆ·å·²æ”¯ä»˜ï¼Œéœ€è¦é€€æ¬¾</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">refund</span> <span class="hljs-operator">=</span> weChatPayUtil.refund(<br>                ordersDB.getNumber(),<br>                ordersDB.getNumber(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.01</span>));<br>        log.info(<span class="hljs-string">&quot;ç”³è¯·é€€æ¬¾ï¼š&#123;&#125;&quot;</span>, refund);<br>    &#125;<br><br>    <span class="hljs-comment">// ç®¡ç†ç«¯å–æ¶ˆè®¢å•éœ€è¦é€€æ¬¾ï¼Œæ ¹æ®è®¢å•idæ›´æ–°è®¢å•çŠ¶æ€ã€å–æ¶ˆåŸå› ã€å–æ¶ˆæ—¶é—´</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersCancelDTO.getId());<br>    orders.setStatus(Orders.CANCELLED);<br>    orders.setCancelReason(ordersCancelDTO.getCancelReason());<br>    orders.setCancelTime(LocalDateTime.now());<br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="7-æ´¾é€è®¢å•"><a href="#7-æ´¾é€è®¢å•" class="headerlink" title="7. æ´¾é€è®¢å•"></a>7. æ´¾é€è®¢å•</h2><h3 id="7-1-admin-OrderController"><a href="#7-1-admin-OrderController" class="headerlink" title="7.1 admin&#x2F;OrderController"></a>7.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ´¾é€è®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/delivery/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;æ´¾é€è®¢å•&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">delivery</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>    orderService.delivery(id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="7-2-OrderService"><a href="#7-2-OrderService" class="headerlink" title="7.2 OrderService"></a>7.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ´¾é€è®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">delivery</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="7-3-OrderServiceImpl"><a href="#7-3-OrderServiceImpl" class="headerlink" title="7.3 OrderServiceImpl"></a>7.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ´¾é€è®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delivery</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br><br>    <span class="hljs-comment">// æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”çŠ¶æ€ä¸º3</span><br>    <span class="hljs-keyword">if</span> (ordersDB == <span class="hljs-literal">null</span> || !ordersDB.getStatus().equals(Orders.CONFIRMED)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);<br>    &#125;<br><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersDB.getId());<br>    <span class="hljs-comment">// æ›´æ–°è®¢å•çŠ¶æ€,çŠ¶æ€è½¬ä¸ºæ´¾é€ä¸­</span><br>    orders.setStatus(Orders.DELIVERY_IN_PROGRESS);<br><br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="8-å®Œæˆè®¢å•"><a href="#8-å®Œæˆè®¢å•" class="headerlink" title="8. å®Œæˆè®¢å•"></a>8. å®Œæˆè®¢å•</h2><h3 id="8-1-admin-OrderController"><a href="#8-1-admin-OrderController" class="headerlink" title="8.1 admin&#x2F;OrderController"></a>8.1 admin&#x2F;OrderController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å®Œæˆè®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@PutMapping(&quot;/complete/&#123;id&#125;&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å®Œæˆè®¢å•&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">complete</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>    orderService.complete(id);<br>    <span class="hljs-keyword">return</span> Result.success();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="8-2-OrderService"><a href="#8-2-OrderService" class="headerlink" title="8.2 OrderService"></a>8.2 OrderService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å®Œæˆè®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">complete</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="8-3-OrderServiceImpl"><a href="#8-3-OrderServiceImpl" class="headerlink" title="8.3 OrderServiceImpl"></a>8.3 OrderServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å®Œæˆè®¢å•</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">complete</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br><br>    <span class="hljs-comment">// æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”çŠ¶æ€ä¸º4</span><br>    <span class="hljs-keyword">if</span> (ordersDB == <span class="hljs-literal">null</span> || !ordersDB.getStatus().equals(Orders.DELIVERY_IN_PROGRESS)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);<br>    &#125;<br><br>    <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>    orders.setId(ordersDB.getId());<br>    <span class="hljs-comment">// æ›´æ–°è®¢å•çŠ¶æ€,çŠ¶æ€è½¬ä¸ºå®Œæˆ</span><br>    orders.setStatus(Orders.COMPLETED);<br>    orders.setDeliveryTime(LocalDateTime.now());<br><br>    orderMapper.update(orders);<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="åäº”-Spring-Task-å’Œ-è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†"><a href="#åäº”-Spring-Task-å’Œ-è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†" class="headerlink" title="åäº”. Spring Task å’Œ è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†"></a>åäº”. Spring Task å’Œ è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</h1><h2 id="1-Spring-Task"><a href="#1-Spring-Task" class="headerlink" title="1. Spring Task"></a>1. Spring Task</h2><h3 id="1-1-ä»‹ç»"><a href="#1-1-ä»‹ç»" class="headerlink" title="1.1 ä»‹ç»"></a>1.1 ä»‹ç»</h3><ul>
<li><strong>Spring Task</strong> æ˜¯Springæ¡†æ¶æä¾›çš„ä»»åŠ¡è°ƒåº¦å·¥å…·ï¼Œå¯ä»¥æŒ‰ç…§çº¦å®šçš„æ—¶é—´è‡ªåŠ¨æ‰§è¡ŒæŸä¸ªä»£ç é€»è¾‘ã€‚</li>
<li><strong>ä½œç”¨</strong>å®šæ—¶è‡ªåŠ¨æ‰§è¡ŒæŸæ®µJavaä»£ç </li>
</ul>
<h3 id="1-2-cronè¡¨è¾¾å¼"><a href="#1-2-cronè¡¨è¾¾å¼" class="headerlink" title="1.2 cronè¡¨è¾¾å¼"></a>1.2 cronè¡¨è¾¾å¼</h3><p><strong>cronè¡¨è¾¾å¼</strong>å…¶å®å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡cronè¡¨è¾¾å¼å¯ä»¥<strong>å®šä¹‰ä»»åŠ¡è§¦å‘çš„æ—¶é—´</strong></p>
<p>**æ„æˆè§„åˆ™ï¼š**åˆ†ä¸º6æˆ–7ä¸ªåŸŸï¼Œç”±ç©ºæ ¼åˆ†éš”å¼€ï¼Œæ¯ä¸ªåŸŸä»£è¡¨ä¸€ä¸ªå«ä¹‰</p>
<p>æ¯ä¸ªåŸŸçš„å«ä¹‰åˆ†åˆ«ä¸ºï¼šç§’ã€åˆ†é’Ÿã€å°æ—¶ã€æ—¥ã€æœˆã€å‘¨ã€å¹´(å¯é€‰)</p>
<p><strong>ä¸¾ä¾‹ï¼š</strong></p>
<p>2022å¹´10æœˆ12æ—¥ä¸Šåˆ9ç‚¹æ•´ å¯¹åº”çš„cronè¡¨è¾¾å¼ä¸ºï¼š<strong>0 0 9 12 10 ? 2022</strong></p>
<h3 id="1-3-Spring-Taskä½¿ç”¨æ­¥éª¤"><a href="#1-3-Spring-Taskä½¿ç”¨æ­¥éª¤" class="headerlink" title="1.3 Spring Taskä½¿ç”¨æ­¥éª¤"></a>1.3 Spring Taskä½¿ç”¨æ­¥éª¤</h3><ol>
<li>å¯¼å…¥mavenåæ ‡ spring-context</li>
<li>å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ @EnableScheduling å¼€å¯ä»»åŠ¡è°ƒåº¦</li>
<li>è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»</li>
</ol>
<h2 id="2-è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†"><a href="#2-è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†" class="headerlink" title="2. è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†"></a>2. è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</h2><h3 id="2-1-é—®é¢˜åˆ†æ"><a href="#2-1-é—®é¢˜åˆ†æ" class="headerlink" title="2.1 é—®é¢˜åˆ†æ"></a>2.1 é—®é¢˜åˆ†æ</h3><ul>
<li>ä¸‹å•åæœªæ”¯ä»˜ï¼Œè®¢å•ä¸€ç›´å¤„äº**â€œå¾…æ”¯ä»˜â€**çŠ¶æ€</li>
<li>ç”¨æˆ·æ”¶è´§åç®¡ç†ç«¯æœªç‚¹å‡»å®ŒæˆæŒ‰é’®ï¼Œè®¢å•ä¸€ç›´å¤„äº**â€œæ´¾é€ä¸­â€**çŠ¶æ€</li>
</ul>
<p>å¯¹äºä¸Šé¢ä¸¤ç§æƒ…å†µéœ€è¦é€šè¿‡<strong>å®šæ—¶ä»»åŠ¡</strong>æ¥ä¿®æ”¹è®¢å•çŠ¶æ€ï¼Œå…·ä½“é€»è¾‘ä¸ºï¼š</p>
<ul>
<li>é€šè¿‡å®šæ—¶ä»»åŠ¡æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨æ”¯ä»˜è¶…æ—¶è®¢å•ï¼ˆä¸‹å•åè¶…è¿‡15åˆ†é’Ÿä»æœªæ”¯ä»˜åˆ™åˆ¤å®šä¸ºæ”¯ä»˜è¶…æ—¶è®¢å•ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºâ€œå·²å–æ¶ˆâ€</li>
<li>é€šè¿‡å®šæ—¶ä»»åŠ¡æ¯å¤©å‡Œæ™¨1ç‚¹æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦å­˜åœ¨â€œæ´¾é€ä¸­â€çš„è®¢å•ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºâ€œå·²å®Œæˆâ€</li>
</ul>
<h3 id="2-2-è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»OrderTask"><a href="#2-2-è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»OrderTask" class="headerlink" title="2.2 è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»OrderTask"></a>2.2 è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»OrderTask</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.task;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ï¼Œå®ç°è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTask</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderMapper orderMapper;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Scheduled(cron = &quot;0 * * * * ?&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processTimeoutOrder</span><span class="hljs-params">()</span>&#123;<br>        log.info(<span class="hljs-string">&quot;å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> LocalDateTime.now().plusMinutes(-<span class="hljs-number">15</span>);<br><br>        <span class="hljs-comment">// select * from orders where status = 1 and order_time &lt; å½“å‰æ—¶é—´-15åˆ†é’Ÿ</span><br>        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrdertimeLT(Orders.PENDING_PAYMENT, time);<br>        <span class="hljs-keyword">if</span>(ordersList != <span class="hljs-literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="hljs-number">0</span>)&#123;<br>            ordersList.forEach(order -&gt; &#123;<br>                order.setStatus(Orders.CANCELLED);<br>                order.setCancelReason(<span class="hljs-string">&quot;æ”¯ä»˜è¶…æ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆ&quot;</span>);<br>                order.setCancelTime(LocalDateTime.now());<br>                orderMapper.update(order);<br>            &#125;);<br>        &#125;<br>    &#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¤„ç†â€œæ´¾é€ä¸­â€çŠ¶æ€çš„è®¢å•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processDeliveryOrder</span><span class="hljs-params">()</span>&#123;<br>        log.info(<span class="hljs-string">&quot;å¤„ç†æ´¾é€ä¸­è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        <span class="hljs-comment">// select * from orders where status = 4 and order_time &lt; å½“å‰æ—¶é—´-1å°æ—¶</span><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> LocalDateTime.now().plusMinutes(-<span class="hljs-number">60</span>);<br>        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrdertimeLT(Orders.DELIVERY_IN_PROGRESS, time);<br><br>        <span class="hljs-keyword">if</span>(ordersList != <span class="hljs-literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="hljs-number">0</span>)&#123;<br>            ordersList.forEach(order -&gt; &#123;<br>                order.setStatus(Orders.COMPLETED);<br>                orderMapper.update(order);<br>            &#125;);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="2-3-åœ¨OrderMapperæ¥å£ä¸­æ‰©å±•æ–¹æ³•"><a href="#2-3-åœ¨OrderMapperæ¥å£ä¸­æ‰©å±•æ–¹æ³•" class="headerlink" title="2.3 åœ¨OrderMapperæ¥å£ä¸­æ‰©å±•æ–¹æ³•"></a>2.3 åœ¨OrderMapperæ¥å£ä¸­æ‰©å±•æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®çŠ¶æ€å’Œä¸‹å•æ—¶é—´æŸ¥è¯¢è®¢å•</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> orderTime</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Select(&quot;select * from orders where status = #&#123;status&#125; and order_time &lt; #&#123;orderTime&#125;&quot;)</span><br>   List&lt;Orders&gt; <span class="hljs-title function_">getByStatusAndOrdertimeLT</span><span class="hljs-params">(Integer status, LocalDateTime orderTime)</span>;<br></code></pre></td></tr></table></figure>

<h1 id="åå…­-WebSocket-å’Œ-ç”¨æˆ·æ¥å•å‚¬å•æé†’"><a href="#åå…­-WebSocket-å’Œ-ç”¨æˆ·æ¥å•å‚¬å•æé†’" class="headerlink" title="åå…­. WebSocket å’Œ ç”¨æˆ·æ¥å•å‚¬å•æé†’"></a>åå…­. WebSocket å’Œ ç”¨æˆ·æ¥å•å‚¬å•æé†’</h1><h2 id="1-WebSocket"><a href="#1-WebSocket" class="headerlink" title="1. WebSocket"></a>1. WebSocket</h2><p>WebSocket æ˜¯åŸºäº TCP çš„ä¸€ç§æ–°çš„<strong>ç½‘ç»œåè®®</strong>ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡â€”â€”æµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±å¯ä»¥åˆ›å»º<strong>æŒä¹…æ€§</strong>çš„è¿æ¥ï¼Œ å¹¶è¿›è¡Œ<strong>åŒå‘</strong>æ•°æ®ä¼ è¾“ã€‚</p>
<p><strong>HTTPåè®®å’ŒWebSocketåè®®å¯¹æ¯”ï¼š</strong></p>
<ul>
<li>HTTPæ˜¯<strong>çŸ­è¿æ¥</strong></li>
<li>WebSocketæ˜¯<strong>é•¿è¿æ¥</strong></li>
<li>HTTPé€šä¿¡æ˜¯<strong>å•å‘</strong>çš„ï¼ŒåŸºäºè¯·æ±‚å“åº”æ¨¡å¼</li>
<li>WebSocketæ”¯æŒ<strong>åŒå‘</strong>é€šä¿¡</li>
<li>HTTPå’ŒWebSocketåº•å±‚éƒ½æ˜¯TCPè¿æ¥</li>
</ul>
<h2 id="2-ç”¨æˆ·æ¥å•æé†’"><a href="#2-ç”¨æˆ·æ¥å•æé†’" class="headerlink" title="2. ç”¨æˆ·æ¥å•æé†’"></a>2. ç”¨æˆ·æ¥å•æé†’</h2><h3 id="2-1-å®ç°æ€è·¯"><a href="#2-1-å®ç°æ€è·¯" class="headerlink" title="2.1 å®ç°æ€è·¯"></a>2.1 å®ç°æ€è·¯</h3><ul>
<li>é€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯ä¿æŒé•¿è¿æ¥çŠ¶æ€</li>
<li>å½“å®¢æˆ·æ”¯ä»˜åï¼Œè°ƒç”¨WebSocketçš„ç›¸å…³APIå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯</li>
<li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·å‚¬å•ï¼Œè¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥</li>
<li>çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå­—æ®µåŒ…æ‹¬ï¼štypeï¼ŒorderIdï¼Œcontent<ul>
<li>type ä¸ºæ¶ˆæ¯ç±»å‹ï¼Œ1ä¸ºæ¥å•æé†’ 2ä¸ºå®¢æˆ·å‚¬å•</li>
<li>orderId ä¸ºè®¢å•id</li>
<li>content ä¸ºæ¶ˆæ¯å†…å®¹</li>
</ul>
</li>
</ul>
<h3 id="2-2-ä»£ç å¼€å‘"><a href="#2-2-ä»£ç å¼€å‘" class="headerlink" title="2.2 ä»£ç å¼€å‘"></a>2.2 ä»£ç å¼€å‘</h3><p><strong>åœ¨OrderServiceImplä¸­æ³¨å…¥WebSocketServerå¯¹è±¡ï¼Œä¿®æ”¹paySuccessæ–¹æ³•ï¼ŒåŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> WebSocketServer webSocketServer;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ”¯ä»˜æˆåŠŸï¼Œä¿®æ”¹è®¢å•çŠ¶æ€</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> outTradeNo</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">paySuccess</span><span class="hljs-params">(String outTradeNo)</span> &#123;<br>       <span class="hljs-comment">// å½“å‰ç™»å½•ç”¨æˆ·id</span><br>       <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><br>       <span class="hljs-comment">// æ ¹æ®è®¢å•å·æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è®¢å•</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">ordersDB</span> <span class="hljs-operator">=</span> orderMapper.getByNumberAndUserId(outTradeNo, userId);<br><br>       <span class="hljs-comment">// æ ¹æ®è®¢å•idæ›´æ–°è®¢å•çš„çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ã€æ”¯ä»˜çŠ¶æ€ã€ç»“è´¦æ—¶é—´</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> Orders.builder()<br>               .id(ordersDB.getId())<br>               .status(Orders.TO_BE_CONFIRMED)<br>               .payStatus(Orders.PAID)<br>               .checkoutTime(LocalDateTime.now())<br>               .build();<br><br>       orderMapper.update(orders);<br>	<span class="hljs-comment">//////////////////////////////////////////////</span><br>       <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>       map.put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-number">1</span>);<span class="hljs-comment">//æ¶ˆæ¯ç±»å‹ï¼Œ1è¡¨ç¤ºæ¥å•æé†’</span><br>       map.put(<span class="hljs-string">&quot;orderId&quot;</span>, orders.getId());<br>       map.put(<span class="hljs-string">&quot;content&quot;</span>, <span class="hljs-string">&quot;è®¢å•å·ï¼š&quot;</span> + outTradeNo);<br><br>       <span class="hljs-comment">//é€šè¿‡WebSocketå®ç°æ¥å•æé†’ï¼Œå‘å®¢æˆ·ç«¯æµè§ˆå™¨æ¨é€æ¶ˆæ¯</span><br>       webSocketServer.sendToAllClient(JSON.toJSONString(map));<br>       <span class="hljs-comment">///////////////////////////////////////////////////</span><br>   &#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-ç”¨æˆ·å‚¬å•æé†’"><a href="#3-ç”¨æˆ·å‚¬å•æé†’" class="headerlink" title="3. ç”¨æˆ·å‚¬å•æé†’"></a>3. ç”¨æˆ·å‚¬å•æé†’</h2><h3 id="3-1-Controllerå±‚-3"><a href="#3-1-Controllerå±‚-3" class="headerlink" title="3.1 Controllerå±‚"></a>3.1 Controllerå±‚</h3><p><strong>æ ¹æ®ç”¨æˆ·å‚¬å•çš„æ¥å£å®šä¹‰ï¼Œåœ¨user&#x2F;OrderControllerä¸­åˆ›å»ºå‚¬å•æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ç”¨æˆ·å‚¬å•</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@GetMapping(&quot;/reminder/&#123;id&#125;&quot;)</span><br>   <span class="hljs-meta">@ApiOperation(&quot;ç”¨æˆ·å‚¬å•&quot;)</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">reminder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>       orderService.reminder(id);<br>       <span class="hljs-keyword">return</span> Result.success();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-Serviceå±‚æ¥å£-1"><a href="#3-2-Serviceå±‚æ¥å£-1" class="headerlink" title="3.2 Serviceå±‚æ¥å£"></a>3.2 Serviceå±‚æ¥å£</h3><p><strong>åœ¨OrderServiceæ¥å£ä¸­å£°æ˜reminderæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ç”¨æˆ·å‚¬å•</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">reminder</span><span class="hljs-params">(Long id)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-Serviceå±‚å®ç°ç±»-1"><a href="#3-3-Serviceå±‚å®ç°ç±»-1" class="headerlink" title="3.3 Serviceå±‚å®ç°ç±»"></a>3.3 Serviceå±‚å®ç°ç±»</h3><p><strong>åœ¨OrderServiceImplä¸­å®ç°reminderæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * ç”¨æˆ·å‚¬å•</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reminder</span><span class="hljs-params">(Long id)</span> &#123;<br>       <span class="hljs-comment">// æŸ¥è¯¢è®¢å•æ˜¯å¦å­˜åœ¨</span><br>       <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> orderMapper.getById(id);<br>       <span class="hljs-keyword">if</span> (orders == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderBusinessException</span>(MessageConstant.ORDER_NOT_FOUND);<br>       &#125;<br><br>       <span class="hljs-comment">//åŸºäºWebSocketå®ç°å‚¬å•</span><br>       <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>       map.put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-number">2</span>);<span class="hljs-comment">//2ä»£è¡¨ç”¨æˆ·å‚¬å•</span><br>       map.put(<span class="hljs-string">&quot;orderId&quot;</span>, id);<br>       map.put(<span class="hljs-string">&quot;content&quot;</span>, <span class="hljs-string">&quot;è®¢å•å·ï¼š&quot;</span> + orders.getNumber());<br>       webSocketServer.sendToAllClient(JSON.toJSONString(map));<br>   &#125;<br></code></pre></td></tr></table></figure>

<h1 id="åä¸ƒ-æ•°æ®ç»Ÿè®¡åŠŸèƒ½"><a href="#åä¸ƒ-æ•°æ®ç»Ÿè®¡åŠŸèƒ½" class="headerlink" title="åä¸ƒ. æ•°æ®ç»Ÿè®¡åŠŸèƒ½"></a>åä¸ƒ. æ•°æ®ç»Ÿè®¡åŠŸèƒ½</h1><h2 id="1-è¥ä¸šé¢ç»Ÿè®¡"><a href="#1-è¥ä¸šé¢ç»Ÿè®¡" class="headerlink" title="1. è¥ä¸šé¢ç»Ÿè®¡"></a>1. è¥ä¸šé¢ç»Ÿè®¡</h2><h3 id="1-1-Controllerå±‚-3"><a href="#1-1-Controllerå±‚-3" class="headerlink" title="1.1 Controllerå±‚"></a>1.1 Controllerå±‚</h3><p><strong>æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºReportControllerï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.controller.admin;<br><br><span class="hljs-keyword">import</span> com.sky.result.Result;<br><span class="hljs-keyword">import</span> com.sky.service.ReportService;<br><span class="hljs-keyword">import</span> com.sky.vo.TurnoverReportVO;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.format.annotation.DateTimeFormat;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> java.time.LocalDate;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŠ¥è¡¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/report&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(tags = &quot;ç»Ÿè®¡æŠ¥è¡¨ç›¸å…³æ¥å£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReportController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ReportService reportService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¥ä¸šé¢æ•°æ®ç»Ÿè®¡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/turnoverStatistics&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;è¥ä¸šé¢æ•°æ®ç»Ÿè®¡&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;TurnoverReportVO&gt; <span class="hljs-title function_">turnoverStatistics</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="hljs-params">                    LocalDate begin,</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="hljs-params">                    LocalDate end)</span> &#123;<br>        <span class="hljs-keyword">return</span> Result.success(reportService.getTurnover(begin, end));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-2-Serviceå±‚æ¥å£"><a href="#1-2-Serviceå±‚æ¥å£" class="headerlink" title="1.2 Serviceå±‚æ¥å£"></a>1.2 Serviceå±‚æ¥å£</h3><p><strong>åˆ›å»ºReportServiceæ¥å£ï¼Œå£°æ˜getTurnoveræ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service;<br><br><span class="hljs-keyword">import</span> com.sky.vo.TurnoverReportVO;<br><span class="hljs-keyword">import</span> java.time.LocalDate;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ReportService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡è¥ä¸šé¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> beginTime</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> endTime</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    TurnoverReportVO <span class="hljs-title function_">getTurnover</span><span class="hljs-params">(LocalDate beginTime, LocalDate endTime)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-3-Serviceå±‚å®ç°ç±»"><a href="#1-3-Serviceå±‚å®ç°ç±»" class="headerlink" title="1.3 Serviceå±‚å®ç°ç±»"></a>1.3 Serviceå±‚å®ç°ç±»</h3><p><strong>åˆ›å»ºReportServiceImplå®ç°ç±»ï¼Œå®ç°getTurnoveræ–¹æ³•:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.service.impl;<br><br><span class="hljs-keyword">import</span> com.sky.entity.Orders;<br><span class="hljs-keyword">import</span> com.sky.mapper.OrderMapper;<br><span class="hljs-keyword">import</span> com.sky.service.ReportService;<br><span class="hljs-keyword">import</span> com.sky.vo.TurnoverReportVO;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.apache.commons.lang.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> java.time.LocalDate;<br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><span class="hljs-keyword">import</span> java.time.LocalTime;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReportServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ReportService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderMapper orderMapper;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡è¥ä¸šé¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> TurnoverReportVO <span class="hljs-title function_">getTurnover</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span> &#123;<br>        List&lt;LocalDate&gt; dateList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        dateList.add(begin);<br><br>        <span class="hljs-keyword">while</span> (!begin.equals(end))&#123;<br>            begin = begin.plusDays(<span class="hljs-number">1</span>);<span class="hljs-comment">//æ—¥æœŸè®¡ç®—ï¼Œè·å¾—æŒ‡å®šæ—¥æœŸå1å¤©çš„æ—¥æœŸ</span><br>            dateList.add(begin);<br>        &#125;<br>        <br>       List&lt;Double&gt; turnoverList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (LocalDate date : dateList) &#123;<br>            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">beginTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MIN);<br>            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MAX);<br>            <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        	map.put(<span class="hljs-string">&quot;status&quot;</span>, Orders.COMPLETED);<br>        	map.put(<span class="hljs-string">&quot;begin&quot;</span>,beginTime);<br>        	map.put(<span class="hljs-string">&quot;end&quot;</span>, endTime);<br>            <span class="hljs-type">Double</span> <span class="hljs-variable">turnover</span> <span class="hljs-operator">=</span> orderMapper.sumByMap(map); <br>            turnover = turnover == <span class="hljs-literal">null</span> ? <span class="hljs-number">0.0</span> : turnover;<br>            turnoverList.add(turnover);<br>        &#125;<br><br>        <span class="hljs-comment">//æ•°æ®å°è£…</span><br>        <span class="hljs-keyword">return</span> TurnoverReportVO.builder()<br>                .dateList(StringUtils.join(dateList,<span class="hljs-string">&quot;,&quot;</span>))<br>                .turnoverList(StringUtils.join(turnoverList,<span class="hljs-string">&quot;,&quot;</span>))<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-4-Mapperå±‚-1"><a href="#1-4-Mapperå±‚-1" class="headerlink" title="1.4 Mapperå±‚"></a>1.4 Mapperå±‚</h3><p><strong>åœ¨OrderMapperæ¥å£å£°æ˜sumByMapæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®åŠ¨æ€æ¡ä»¶ç»Ÿè®¡è¥ä¸šé¢</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> map</span><br><span class="hljs-comment">    */</span><br>   Double <span class="hljs-title function_">sumByMap</span><span class="hljs-params">(Map map)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨OrderMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™åŠ¨æ€SQLï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sumByMap&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.Double&quot;</span>&gt;</span><br>        select sum(amount) from orders<br>        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;status != null&quot;</span>&gt;</span><br>                and status = #&#123;status&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;begin != null&quot;</span>&gt;</span><br>                and order_time <span class="hljs-symbol">&amp;gt;</span>= #&#123;begin&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;end != null&quot;</span>&gt;</span><br>                and order_time <span class="hljs-symbol">&amp;lt;</span>= #&#123;end&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="2-ç”¨æˆ·ç»Ÿè®¡"><a href="#2-ç”¨æˆ·ç»Ÿè®¡" class="headerlink" title="2. ç”¨æˆ·ç»Ÿè®¡"></a>2. ç”¨æˆ·ç»Ÿè®¡</h2><h3 id="2-1-Controllerå±‚-1"><a href="#2-1-Controllerå±‚-1" class="headerlink" title="2.1 Controllerå±‚"></a>2.1 Controllerå±‚</h3><p><strong>æ ¹æ®æ¥å£å®šä¹‰ï¼Œåœ¨ReportControllerä¸­åˆ›å»ºuserStatisticsæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·æ•°æ®ç»Ÿè®¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/userStatistics&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;ç”¨æˆ·æ•°æ®ç»Ÿè®¡&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;UserReportVO&gt; <span class="hljs-title function_">userStatistics</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span>&#123;<br><br>        <span class="hljs-keyword">return</span> Result.success(reportService.getUserStatistics(begin,end));            <br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-Serviceå±‚æ¥å£-1"><a href="#2-2-Serviceå±‚æ¥å£-1" class="headerlink" title="2.2 Serviceå±‚æ¥å£"></a>2.2 Serviceå±‚æ¥å£</h3><p><strong>åœ¨ReportServiceæ¥å£ä¸­å£°æ˜getUserStatisticsæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡ç”¨æˆ·æ•°é‡</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   UserReportVO <span class="hljs-title function_">getUserStatistics</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-Serviceå±‚å®ç°ç±»-1"><a href="#2-3-Serviceå±‚å®ç°ç±»-1" class="headerlink" title="2.3 Serviceå±‚å®ç°ç±»"></a>2.3 Serviceå±‚å®ç°ç±»</h3><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­å®ç°getUserStatisticsæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> UserReportVO <span class="hljs-title function_">getUserStatistics</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span> &#123;<br>       List&lt;LocalDate&gt; dateList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>       dateList.add(begin);<br><br>       <span class="hljs-keyword">while</span> (!begin.equals(end))&#123;<br>           begin = begin.plusDays(<span class="hljs-number">1</span>);<br>           dateList.add(begin);<br>       &#125;<br>       List&lt;Integer&gt; newUserList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(); <span class="hljs-comment">//æ–°å¢ç”¨æˆ·æ•°</span><br>       List&lt;Integer&gt; totalUserList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(); <span class="hljs-comment">//æ€»ç”¨æˆ·æ•°</span><br><br>       <span class="hljs-keyword">for</span> (LocalDate date : dateList) &#123;<br>           <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">beginTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MIN);<br>           <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MAX);<br>           <span class="hljs-comment">//æ–°å¢ç”¨æˆ·æ•°é‡ select count(id) from user where create_time &gt; ? and create_time &lt; ?</span><br>           <span class="hljs-type">Integer</span> <span class="hljs-variable">newUser</span> <span class="hljs-operator">=</span> getUserCount(beginTime, endTime);<br>           <span class="hljs-comment">//æ€»ç”¨æˆ·æ•°é‡ select count(id) from user where  create_time &lt; ?</span><br>           <span class="hljs-type">Integer</span> <span class="hljs-variable">totalUser</span> <span class="hljs-operator">=</span> getUserCount(<span class="hljs-literal">null</span>, endTime);<br><br>           newUserList.add(newUser);<br>           totalUserList.add(totalUser);<br>       &#125;<br><br>       <span class="hljs-keyword">return</span> UserReportVO.builder()<br>               .dateList(StringUtils.join(dateList,<span class="hljs-string">&quot;,&quot;</span>))<br>               .newUserList(StringUtils.join(newUserList,<span class="hljs-string">&quot;,&quot;</span>))<br>               .totalUserList(StringUtils.join(totalUserList,<span class="hljs-string">&quot;,&quot;</span>))<br>               .build();<br>   &#125;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­åˆ›å»ºç§æœ‰æ–¹æ³•getUserCountï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡ç”¨æˆ·æ•°é‡</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> beginTime</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> endTime</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">private</span> Integer <span class="hljs-title function_">getUserCount</span><span class="hljs-params">(LocalDateTime beginTime, LocalDateTime endTime)</span> &#123;<br>       <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>       map.put(<span class="hljs-string">&quot;begin&quot;</span>,beginTime);<br>       map.put(<span class="hljs-string">&quot;end&quot;</span>, endTime);<br>       <span class="hljs-keyword">return</span> userMapper.countByMap(map);<br>   &#125;<br></code></pre></td></tr></table></figure>



<h3 id="2-4-Mapperå±‚-1"><a href="#2-4-Mapperå±‚-1" class="headerlink" title="2.4 Mapperå±‚"></a>2.4 Mapperå±‚</h3><p><strong>åœ¨UserMapperæ¥å£ä¸­å£°æ˜countByMapæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * æ ¹æ®åŠ¨æ€æ¡ä»¶ç»Ÿè®¡ç”¨æˆ·æ•°é‡</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> map</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   Integer <span class="hljs-title function_">countByMap</span><span class="hljs-params">(Map map)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨UserMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™åŠ¨æ€SQLï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;select id=<span class="hljs-string">&quot;countByMap&quot;</span> resultType=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;<br>        select <span class="hljs-title function_">count</span><span class="hljs-params">(id)</span> from user<br>        &lt;where&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;begin != null&quot;</span>&gt;<br>                and create_time &amp;gt;= #&#123;begin&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;end != null&quot;</span>&gt;<br>                and create_time &amp;lt;= #&#123;end&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>        &lt;/where&gt;<br>&lt;/select&gt;<br></code></pre></td></tr></table></figure>


<h2 id="3-è®¢å•ç»Ÿè®¡"><a href="#3-è®¢å•ç»Ÿè®¡" class="headerlink" title="3. è®¢å•ç»Ÿè®¡"></a>3. è®¢å•ç»Ÿè®¡</h2><h3 id="3-1-Controllerå±‚-4"><a href="#3-1-Controllerå±‚-4" class="headerlink" title="3.1 Controllerå±‚"></a>3.1 Controllerå±‚</h3><p><strong>åœ¨ReportControllerä¸­æ ¹æ®è®¢å•ç»Ÿè®¡æ¥å£åˆ›å»ºorderStatisticsæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¢å•æ•°æ®ç»Ÿè®¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/ordersStatistics&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;ç”¨æˆ·æ•°æ®ç»Ÿè®¡&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;OrderReportVO&gt; <span class="hljs-title function_">orderStatistics</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="hljs-params">                    LocalDate begin,</span><br><span class="hljs-params">            <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="hljs-params">                    LocalDate end)</span>&#123;<br><br>        <span class="hljs-keyword">return</span> Result.success(reportService.getOrderStatistics(begin,end));<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-Serviceå±‚æ¥å£-2"><a href="#3-2-Serviceå±‚æ¥å£-2" class="headerlink" title="3.2 Serviceå±‚æ¥å£"></a>3.2 Serviceå±‚æ¥å£</h3><p><strong>åœ¨ReportServiceæ¥å£ä¸­å£°æ˜getOrderStatisticsæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡è®¢å•æ•°é‡</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin </span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span> </span><br><span class="hljs-comment">*/</span><br>OrderReportVO <span class="hljs-title function_">getOrderStatistics</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>;<br></code></pre></td></tr></table></figure>


<h3 id="3-3-Serviceå±‚å®ç°ç±»-2"><a href="#3-3-Serviceå±‚å®ç°ç±»-2" class="headerlink" title="3.3 Serviceå±‚å®ç°ç±»"></a>3.3 Serviceå±‚å®ç°ç±»</h3><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­å®ç°getOrderStatisticsæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡è®¢å•æ•°é‡</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin </span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span> </span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> OrderReportVO <span class="hljs-title function_">getOrderStatistics</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>&#123;<br>	List&lt;LocalDate&gt; dateList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    dateList.add(begin);<br><br>    <span class="hljs-keyword">while</span> (!begin.equals(end))&#123;<br>          begin = begin.plusDays(<span class="hljs-number">1</span>);<br>          dateList.add(begin);<br>     &#125;<br>    <span class="hljs-comment">//æ¯å¤©è®¢å•æ€»æ•°é›†åˆ</span><br>     List&lt;Integer&gt; orderCountList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-comment">//æ¯å¤©æœ‰æ•ˆè®¢å•æ•°é›†åˆ</span><br>    List&lt;Integer&gt; validOrderCountList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (LocalDate date : dateList) &#123;<br>         <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">beginTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MIN);<br>         <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(date, LocalTime.MAX);<br>   <span class="hljs-comment">//æŸ¥è¯¢æ¯å¤©çš„æ€»è®¢å•æ•° select count(id) from orders where order_time &gt; ? and order_time &lt; ?</span><br>         <span class="hljs-type">Integer</span> <span class="hljs-variable">orderCount</span> <span class="hljs-operator">=</span> getOrderCount(beginTime, endTime, <span class="hljs-literal">null</span>);<br><br>  <span class="hljs-comment">//æŸ¥è¯¢æ¯å¤©çš„æœ‰æ•ˆè®¢å•æ•° select count(id) from orders where order_time &gt; ? and order_time &lt; ? and status = ?</span><br>         <span class="hljs-type">Integer</span> <span class="hljs-variable">validOrderCount</span> <span class="hljs-operator">=</span> getOrderCount(beginTime, endTime, Orders.COMPLETED);<br><br>         orderCountList.add(orderCount);<br>         validOrderCountList.add(validOrderCount);<br>        &#125;<br><br>    <span class="hljs-comment">//æ—¶é—´åŒºé—´å†…çš„æ€»è®¢å•æ•°</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">totalOrderCount</span> <span class="hljs-operator">=</span> orderCountList.stream().reduce(Integer::sum).get();<br>    <span class="hljs-comment">//æ—¶é—´åŒºé—´å†…çš„æ€»æœ‰æ•ˆè®¢å•æ•°</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">validOrderCount</span> <span class="hljs-operator">=</span> validOrderCountList.stream().reduce(Integer::sum).get();<br>    <span class="hljs-comment">//è®¢å•å®Œæˆç‡</span><br>    <span class="hljs-type">Double</span> <span class="hljs-variable">orderCompletionRate</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>;<br>    <span class="hljs-keyword">if</span>(totalOrderCount != <span class="hljs-number">0</span>)&#123;<br>         orderCompletionRate = validOrderCount.doubleValue() / totalOrderCount;<br>     &#125;<br>    <span class="hljs-keyword">return</span> OrderReportVO.builder()<br>                .dateList(StringUtils.join(dateList, <span class="hljs-string">&quot;,&quot;</span>))<br>                .orderCountList(StringUtils.join(orderCountList, <span class="hljs-string">&quot;,&quot;</span>))<br>                .validOrderCountList(StringUtils.join(validOrderCountList, <span class="hljs-string">&quot;,&quot;</span>))<br>                .totalOrderCount(totalOrderCount)<br>                .validOrderCount(validOrderCount)<br>                .orderCompletionRate(orderCompletionRate)<br>                .build();<br>    <br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­æä¾›ç§æœ‰æ–¹æ³•getOrderCountï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡æŒ‡å®šçŠ¶æ€çš„è®¢å•æ•°é‡</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> beginTime</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> endTime</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> status</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">private</span> Integer <span class="hljs-title function_">getOrderCount</span><span class="hljs-params">(LocalDateTime beginTime, LocalDateTime endTime, Integer status)</span> &#123;<br>	<span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>	map.put(<span class="hljs-string">&quot;status&quot;</span>, status);<br>	map.put(<span class="hljs-string">&quot;begin&quot;</span>,beginTime);<br>	map.put(<span class="hljs-string">&quot;end&quot;</span>, endTime);<br>	<span class="hljs-keyword">return</span> orderMapper.countByMap(map);<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="3-4-Mapperå±‚-1"><a href="#3-4-Mapperå±‚-1" class="headerlink" title="3.4 Mapperå±‚"></a>3.4 Mapperå±‚</h3><p><strong>åœ¨OrderMapperæ¥å£ä¸­å£°æ˜countByMapæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*æ ¹æ®åŠ¨æ€æ¡ä»¶ç»Ÿè®¡è®¢å•æ•°é‡</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> map</span><br><span class="hljs-comment">*/</span><br>Integer <span class="hljs-title function_">countByMap</span><span class="hljs-params">(Map map)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨OrderMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™åŠ¨æ€SQLï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;select id=<span class="hljs-string">&quot;countByMap&quot;</span> resultType=<span class="hljs-string">&quot;java.lang.Integer&quot;</span>&gt;<br>        select <span class="hljs-title function_">count</span><span class="hljs-params">(id)</span> from orders<br>        &lt;where&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;status != null&quot;</span>&gt;<br>                <span class="hljs-type">and</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> #&#123;status&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;begin != null&quot;</span>&gt;<br>                and order_time &amp;gt;= #&#123;begin&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>            &lt;<span class="hljs-keyword">if</span> test=<span class="hljs-string">&quot;end != null&quot;</span>&gt;<br>                and order_time &amp;lt;= #&#123;end&#125;<br>            &lt;/<span class="hljs-keyword">if</span>&gt;<br>        &lt;/where&gt;<br>&lt;/select&gt;<br></code></pre></td></tr></table></figure>


<h2 id="4-é”€é‡æ’åTop10"><a href="#4-é”€é‡æ’åTop10" class="headerlink" title="4. é”€é‡æ’åTop10"></a>4. é”€é‡æ’åTop10</h2><h3 id="4-1-Controllerå±‚-1"><a href="#4-1-Controllerå±‚-1" class="headerlink" title="4.1 Controllerå±‚"></a>4.1 Controllerå±‚</h3><p><strong>åœ¨ReportControllerä¸­æ ¹æ®é”€é‡æ’åæ¥å£åˆ›å»ºtop10æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* é”€é‡æ’åç»Ÿè®¡</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@GetMapping(&quot;/top10&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;é”€é‡æ’åç»Ÿè®¡&quot;)</span><br><span class="hljs-keyword">public</span> Result&lt;SalesTop10ReportVO&gt; <span class="hljs-title function_">top10</span><span class="hljs-params">(</span><br><span class="hljs-params">    <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span><br><span class="hljs-params">    <span class="hljs-meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span>&#123;<br>	<span class="hljs-keyword">return</span> Result.success(reportService.getSalesTop10(begin,end));<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-Serviceå±‚æ¥å£"><a href="#4-2-Serviceå±‚æ¥å£" class="headerlink" title="4.2 Serviceå±‚æ¥å£"></a>4.2 Serviceå±‚æ¥å£</h3><p><strong>åœ¨ReportServiceæ¥å£ä¸­å£°æ˜getSalesTop10æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æŸ¥è¯¢æŒ‡å®šæ—¶é—´åŒºé—´å†…çš„é”€é‡æ’åtop10 </span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">* <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">*/</span><br>SalesTop10ReportVO <span class="hljs-title function_">getSalesTop10</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>;<br></code></pre></td></tr></table></figure>


<h3 id="4-3-Serviceå±‚å®ç°ç±»"><a href="#4-3-Serviceå±‚å®ç°ç±»" class="headerlink" title="4.3 Serviceå±‚å®ç°ç±»"></a>4.3 Serviceå±‚å®ç°ç±»</h3><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­å®ç°getSalesTop10æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŸ¥è¯¢æŒ‡å®šæ—¶é—´åŒºé—´å†…çš„é”€é‡æ’åtop10</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * */</span><br>    <span class="hljs-keyword">public</span> SalesTop10ReportVO <span class="hljs-title function_">getSalesTop10</span><span class="hljs-params">(LocalDate begin, LocalDate end)</span>&#123;<br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">beginTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(begin, LocalTime.MIN);<br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(end, LocalTime.MAX);<br>        List&lt;GoodsSalesDTO&gt; goodsSalesDTOList = orderMapper.getSalesTop10(beginTime, endTime);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">nameList</span> <span class="hljs-operator">=</span> StringUtils.join(goodsSalesDTOList.stream().map(GoodsSalesDTO::getName).collect(Collectors.toList()),<span class="hljs-string">&quot;,&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">numberList</span> <span class="hljs-operator">=</span> StringUtils.join(goodsSalesDTOList.stream().map(GoodsSalesDTO::getNumber).collect(Collectors.toList()),<span class="hljs-string">&quot;,&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> SalesTop10ReportVO.builder()<br>                .nameList(nameList)<br>                .numberList(numberList)<br>                .build();<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-Mapperå±‚"><a href="#4-4-Mapperå±‚" class="headerlink" title="4.4 Mapperå±‚"></a>4.4 Mapperå±‚</h3><p><strong>åœ¨OrderMapperæ¥å£ä¸­å£°æ˜getSalesTop10æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æŸ¥è¯¢å•†å“é”€é‡æ’å</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> begin</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> end</span><br><span class="hljs-comment">*/</span><br>List&lt;GoodsSalesDTO&gt; <span class="hljs-title function_">getSalesTop10</span><span class="hljs-params">(LocalDateTime begin, LocalDateTime end)</span>;<br></code></pre></td></tr></table></figure>

<p><strong>åœ¨OrderMapper.xmlæ–‡ä»¶ä¸­ç¼–å†™åŠ¨æ€SQLï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getSalesTop10&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.sky.dto.GoodsSalesDTO&quot;</span>&gt;</span><br>        select od.name name,sum(od.number) number from order_detail od ,orders o<br>        where od.order_id = o.id<br>            and o.status = 5<br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;begin != null&quot;</span>&gt;</span><br>                and order_time <span class="hljs-symbol">&amp;gt;</span>= #&#123;begin&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;end != null&quot;</span>&gt;</span><br>                and order_time <span class="hljs-symbol">&amp;lt;</span>= #&#123;end&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        group by name<br>        order by number desc<br>        limit 0, 10<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h1 id="åå…«-Apache-POI-å’Œ-å¯¼å‡ºè¿è¥æ•°æ®"><a href="#åå…«-Apache-POI-å’Œ-å¯¼å‡ºè¿è¥æ•°æ®" class="headerlink" title="åå…«. Apache POI å’Œ å¯¼å‡ºè¿è¥æ•°æ®"></a>åå…«. Apache POI å’Œ å¯¼å‡ºè¿è¥æ•°æ®</h1><h2 id="1-Apache-POI"><a href="#1-Apache-POI" class="headerlink" title="1. Apache POI"></a>1. Apache POI</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPOI éƒ½æ˜¯ç”¨äºæ“ä½œ Excel æ–‡ä»¶ã€‚</p>
<h3 id="1-1-å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶"><a href="#1-1-å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶" class="headerlink" title="1.1 å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶"></a>1.1 å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.test;<br><br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFCell;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFRow;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">POITest</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŸºäºPOIå‘Excelæ–‡ä»¶å†™å…¥æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">//åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªExcelæ–‡ä»¶å¯¹è±¡</span><br>        <span class="hljs-type">XSSFWorkbook</span> <span class="hljs-variable">excel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XSSFWorkbook</span>();<br>        <span class="hljs-comment">//åˆ›å»ºSheeté¡µ</span><br>        <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> excel.createSheet(<span class="hljs-string">&quot;itcast&quot;</span>);<br><br>        <span class="hljs-comment">//åœ¨Sheeté¡µä¸­åˆ›å»ºè¡Œï¼Œ0è¡¨ç¤ºç¬¬1è¡Œ</span><br>        <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">row1</span> <span class="hljs-operator">=</span> sheet.createRow(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">//åˆ›å»ºå•å…ƒæ ¼å¹¶åœ¨å•å…ƒæ ¼ä¸­è®¾ç½®å€¼ï¼Œå•å…ƒæ ¼ç¼–å·ä¹Ÿæ˜¯ä»0å¼€å§‹ï¼Œ1è¡¨ç¤ºç¬¬2ä¸ªå•å…ƒæ ¼</span><br>        row1.createCell(<span class="hljs-number">1</span>).setCellValue(<span class="hljs-string">&quot;å§“å&quot;</span>);<br>        row1.createCell(<span class="hljs-number">2</span>).setCellValue(<span class="hljs-string">&quot;åŸå¸‚&quot;</span>);<br><br>        <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">row2</span> <span class="hljs-operator">=</span> sheet.createRow(<span class="hljs-number">1</span>);<br>        row2.createCell(<span class="hljs-number">1</span>).setCellValue(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);<br>        row2.createCell(<span class="hljs-number">2</span>).setCellValue(<span class="hljs-string">&quot;åŒ—äº¬&quot;</span>);<br><br>        <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">row3</span> <span class="hljs-operator">=</span> sheet.createRow(<span class="hljs-number">2</span>);<br>        row3.createCell(<span class="hljs-number">1</span>).setCellValue(<span class="hljs-string">&quot;æå››&quot;</span>);<br>        row3.createCell(<span class="hljs-number">2</span>).setCellValue(<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>);<br><br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;D:\\itcast.xlsx&quot;</span>));<br>        <span class="hljs-comment">//é€šè¿‡è¾“å‡ºæµå°†å†…å­˜ä¸­çš„Excelæ–‡ä»¶å†™å…¥åˆ°ç£ç›˜ä¸Š</span><br>        excel.write(out);<br><br>        <span class="hljs-comment">//å…³é—­èµ„æº</span><br>        out.flush();<br>        out.close();<br>        excel.close();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        write();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®"><a href="#1-2-è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®" class="headerlink" title="1.2 è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®"></a>1.2 è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.sky.test;<br><br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFCell;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFRow;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">POITest</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŸºäºPOIè¯»å–Excelæ–‡ä»¶</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">read</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;D:\\itcast.xlsx&quot;</span>));<br>        <span class="hljs-comment">//é€šè¿‡è¾“å…¥æµè¯»å–æŒ‡å®šçš„Excelæ–‡ä»¶</span><br>        <span class="hljs-type">XSSFWorkbook</span> <span class="hljs-variable">excel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XSSFWorkbook</span>(in);<br>        <span class="hljs-comment">//è·å–Excelæ–‡ä»¶çš„ç¬¬1ä¸ªSheeté¡µ</span><br>        <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> excel.getSheetAt(<span class="hljs-number">0</span>);<br><br>        <span class="hljs-comment">//è·å–Sheeté¡µä¸­çš„æœ€åä¸€è¡Œçš„è¡Œå·</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">lastRowNum</span> <span class="hljs-operator">=</span> sheet.getLastRowNum();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt;= lastRowNum; i++) &#123;<br>            <span class="hljs-comment">//è·å–Sheeté¡µä¸­çš„è¡Œ</span><br>            <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">titleRow</span> <span class="hljs-operator">=</span> sheet.getRow(i);<br>            <span class="hljs-comment">//è·å–è¡Œçš„ç¬¬2ä¸ªå•å…ƒæ ¼</span><br>            <span class="hljs-type">XSSFCell</span> <span class="hljs-variable">cell1</span> <span class="hljs-operator">=</span> titleRow.getCell(<span class="hljs-number">1</span>);<br>            <span class="hljs-comment">//è·å–å•å…ƒæ ¼ä¸­çš„æ–‡æœ¬å†…å®¹</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">cellValue1</span> <span class="hljs-operator">=</span> cell1.getStringCellValue();<br>            <span class="hljs-comment">//è·å–è¡Œçš„ç¬¬3ä¸ªå•å…ƒæ ¼</span><br>            <span class="hljs-type">XSSFCell</span> <span class="hljs-variable">cell2</span> <span class="hljs-operator">=</span> titleRow.getCell(<span class="hljs-number">2</span>);<br>            <span class="hljs-comment">//è·å–å•å…ƒæ ¼ä¸­çš„æ–‡æœ¬å†…å®¹</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">cellValue2</span> <span class="hljs-operator">=</span> cell2.getStringCellValue();<br><br>            System.out.println(cellValue1 + <span class="hljs-string">&quot; &quot;</span> +cellValue2);<br>        &#125;<br><br>        <span class="hljs-comment">//å…³é—­èµ„æº</span><br>        in.close();<br>        excel.close();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        read();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="2-å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨"><a href="#2-å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨" class="headerlink" title="2. å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨"></a>2. å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</h2><h3 id="2-1-å®ç°æ­¥éª¤"><a href="#2-1-å®ç°æ­¥éª¤" class="headerlink" title="2.1 å®ç°æ­¥éª¤"></a>2.1 å®ç°æ­¥éª¤</h3><ol>
<li>è®¾è®¡Excelæ¨¡æ¿æ–‡ä»¶</li>
<li>æŸ¥è¯¢è¿‘30å¤©çš„è¿è¥æ•°æ®</li>
<li>å°†æŸ¥è¯¢åˆ°çš„è¿è¥æ•°æ®å†™å…¥æ¨¡æ¿æ–‡ä»¶</li>
<li>é€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨</li>
</ol>
<h3 id="2-2-Controllerå±‚-1"><a href="#2-2-Controllerå±‚-1" class="headerlink" title="2.2 Controllerå±‚"></a>2.2 Controllerå±‚</h3><p><strong>æ ¹æ®æ¥å£å®šä¹‰ï¼Œåœ¨ReportControllerä¸­åˆ›å»ºexportæ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/export&quot;)</span><br><span class="hljs-meta">@ApiOperation(&quot;å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">export</span><span class="hljs-params">(HttpServletResponse response)</span>&#123;<br>    reportService.exportBusinessData(response);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-3-Serviceå±‚æ¥å£"><a href="#2-3-Serviceå±‚æ¥å£" class="headerlink" title="2.3 Serviceå±‚æ¥å£"></a>2.3 Serviceå±‚æ¥å£</h3><p><strong>åœ¨ReportServiceæ¥å£ä¸­å£°æ˜å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨çš„æ–¹æ³•ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯¼å‡ºè¿‘30å¤©çš„è¿è¥æ•°æ®æŠ¥è¡¨</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">exportBusinessData</span><span class="hljs-params">(HttpServletResponse response)</span>;<br></code></pre></td></tr></table></figure>

<h3 id="2-4-Serviceå±‚å®ç°ç±»"><a href="#2-4-Serviceå±‚å®ç°ç±»" class="headerlink" title="2.4 Serviceå±‚å®ç°ç±»"></a>2.4 Serviceå±‚å®ç°ç±»</h3><p><strong>åœ¨ReportServiceImplå®ç°ç±»ä¸­å®ç°å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨çš„æ–¹æ³•:</strong></p>
<p>æå‰å°†èµ„æ–™ä¸­çš„<strong>è¿è¥æ•°æ®æŠ¥è¡¨æ¨¡æ¿.xlsx</strong>æ‹·è´åˆ°é¡¹ç›®çš„resources&#x2F;templateç›®å½•ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**å¯¼å‡ºè¿‘30å¤©çš„è¿è¥æ•°æ®æŠ¥è¡¨</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exportBusinessData</span><span class="hljs-params">(HttpServletResponse response)</span> &#123;<br>    <span class="hljs-type">LocalDate</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> LocalDate.now().minusDays(<span class="hljs-number">30</span>);<br>    <span class="hljs-type">LocalDate</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> LocalDate.now().minusDays(<span class="hljs-number">1</span>);<br>    <span class="hljs-comment">//æŸ¥è¯¢æ¦‚è§ˆè¿è¥æ•°æ®ï¼Œæä¾›ç»™Excelæ¨¡æ¿æ–‡ä»¶</span><br>    <span class="hljs-type">BusinessDataVO</span> <span class="hljs-variable">businessData</span> <span class="hljs-operator">=</span> workspaceService.getBusinessData(LocalDateTime.of(begin,LocalTime.MIN), LocalDateTime.of(end, LocalTime.MAX));<br>    <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;template/è¿è¥æ•°æ®æŠ¥è¡¨æ¨¡æ¿.xlsx&quot;</span>);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//åŸºäºæä¾›å¥½çš„æ¨¡æ¿æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„Excelè¡¨æ ¼å¯¹è±¡</span><br>        <span class="hljs-type">XSSFWorkbook</span> <span class="hljs-variable">excel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XSSFWorkbook</span>(inputStream);<br>        <span class="hljs-comment">//è·å¾—Excelæ–‡ä»¶ä¸­çš„ä¸€ä¸ªSheeté¡µ</span><br>        <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> excel.getSheet(<span class="hljs-string">&quot;Sheet1&quot;</span>);<br><br>        sheet.getRow(<span class="hljs-number">1</span>).getCell(<span class="hljs-number">1</span>).setCellValue(begin + <span class="hljs-string">&quot;è‡³&quot;</span> + end);<br>        <span class="hljs-comment">//è·å¾—ç¬¬4è¡Œ</span><br>        <span class="hljs-type">XSSFRow</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> sheet.getRow(<span class="hljs-number">3</span>);<br>        <span class="hljs-comment">//è·å–å•å…ƒæ ¼</span><br>        row.getCell(<span class="hljs-number">2</span>).setCellValue(businessData.getTurnover());<br>        row.getCell(<span class="hljs-number">4</span>).setCellValue(businessData.getOrderCompletionRate());<br>        row.getCell(<span class="hljs-number">6</span>).setCellValue(businessData.getNewUsers());<br>        row = sheet.getRow(<span class="hljs-number">4</span>);<br>        row.getCell(<span class="hljs-number">2</span>).setCellValue(businessData.getValidOrderCount());<br>        row.getCell(<span class="hljs-number">4</span>).setCellValue(businessData.getUnitPrice());<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) &#123;<br>            <span class="hljs-type">LocalDate</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> begin.plusDays(i);<br>           <span class="hljs-comment">//å‡†å¤‡æ˜ç»†æ•°æ®</span><br>            businessData = workspaceService.getBusinessData(LocalDateTime.of(date,LocalTime.MIN), LocalDateTime.of(date, LocalTime.MAX));<br>            row = sheet.getRow(<span class="hljs-number">7</span> + i);<br>            row.getCell(<span class="hljs-number">1</span>).setCellValue(date.toString());<br>            row.getCell(<span class="hljs-number">2</span>).setCellValue(businessData.getTurnover());<br>            row.getCell(<span class="hljs-number">3</span>).setCellValue(businessData.getValidOrderCount());<br>            row.getCell(<span class="hljs-number">4</span>).setCellValue(businessData.getOrderCompletionRate());<br>            row.getCell(<span class="hljs-number">5</span>).setCellValue(businessData.getUnitPrice());<br>            row.getCell(<span class="hljs-number">6</span>).setCellValue(businessData.getNewUsers());<br>        &#125;<br>        <span class="hljs-comment">//é€šè¿‡è¾“å‡ºæµå°†æ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­</span><br>        <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> response.getOutputStream();<br>        excel.write(out);<br>        <span class="hljs-comment">//å…³é—­èµ„æº</span><br>        out.flush();<br>        out.close();<br>        excel.close();<br><br>    &#125;<span class="hljs-keyword">catch</span> (IOException e)&#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/JAVA/" class="category-chain-item">JAVA</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/JAVA/" class="print-no-link">#JAVA</a>
      
        <a href="/tags/javase/" class="print-no-link">#javase</a>
      
        <a href="/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/" class="print-no-link">#è‹ç©¹å¤–å–</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/03/05/JAVA/SpringCloud/MybatisPlus/" title="MybatisPluså­¦ä¹ ç¬”è®°">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MybatisPluså­¦ä¹ ç¬”è®°</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/03/03/JAVA/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96DebugAndResolve/" title="è‹ç©¹å¤–å–è®¢å•æ”¯ä»˜è·³è¿‡å¾®ä¿¡æ”¯ä»˜åŠè§£å†³åç»­è®¢å•å–æ¶ˆã€æ‹’å•ç­‰é—®é¢˜">
                        <span class="hidden-mobile">è‹ç©¹å¤–å–è®¢å•æ”¯ä»˜è·³è¿‡å¾®ä¿¡æ”¯ä»˜åŠè§£å†³åç»­è®¢å•å–æ¶ˆã€æ‹’å•ç­‰é—®é¢˜</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"sj2tGuxMGSDhkN5hNuOIVta1-gzGzoHsz","appKey":"ysR5OTuTzoby2oNvNyGOtXFQ","path":"window.location.pathname","placeholder":"å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿æŒ‡æ­£~","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <span>AI</span> <i class="iconfont icon-love"></i> <span>CPP</span> <i class="iconfont icon-love"></i> <span>JAVA</span> <i class="iconfont icon-love"></i> <span>CyberSec</span> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/love.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiaoxingxing.js"></script>
<script src="/js/bubble.js"></script>



<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
