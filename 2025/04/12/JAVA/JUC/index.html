

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/about/dogs.jpg">
  <link rel="icon" href="/img/about/dogs.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="ranzier">
  <meta name="keywords" content="">
  
    <meta name="description" content="JUCÂπ∂ÂèëÁºñÁ®ãÂ≠¶‰π†Á¨îËÆ∞   ‰∏Ä. Âü∫Êú¨Ê¶ÇÂøµ1. ËøõÁ®ã‰∏éÁ∫øÁ®ã ËøõÁ®ã  Á®ãÂ∫èÁî±Êåá‰ª§ÂíåÊï∞ÊçÆÁªÑÊàêÔºå‰ΩÜËøô‰∫õÊåá‰ª§Ë¶ÅËøêË°åÔºåÊï∞ÊçÆË¶ÅËØªÂÜôÔºåÂ∞±ÂøÖÈ°ªÂ∞ÜÊåá‰ª§Âä†ËΩΩËá≥ CPUÔºåÊï∞ÊçÆÂä†ËΩΩËá≥ÂÜÖÂ≠ò„ÄÇÂú®Êåá‰ª§ËøêË°åËøáÁ®ã‰∏≠ËøòÈúÄË¶ÅÁî®Âà∞Á£ÅÁõò„ÄÅÁΩëÁªúÁ≠âËÆæÂ§á„ÄÇËøõÁ®ãÂ∞±ÊòØÁî®Êù•Âä†ËΩΩÊåá‰ª§„ÄÅÁÆ°ÁêÜÂÜÖÂ≠ò„ÄÅÁÆ°ÁêÜ IO ÁöÑ„ÄÇ ÂΩì‰∏Ä‰∏™Á®ãÂ∫èË¢´ËøêË°åÔºå‰ªéÁ£ÅÁõòÂä†ËΩΩËøô‰∏™Á®ãÂ∫èÁöÑ‰ª£Á†ÅËá≥ÂÜÖÂ≠òÔºåËøôÊó∂Â∞±ÂºÄÂêØ‰∫Ü‰∏Ä‰∏™ËøõÁ®ã„ÄÇ ËøõÁ®ãÂ∞±ÂèØ‰ª•ËßÜ‰∏∫Á®ãÂ∫èÁöÑ‰∏Ä‰∏™ÂÆû‰æã„ÄÇÂ§ßÈÉ®ÂàÜÁ®ãÂ∫èÂèØ‰ª•ÂêåÊó∂ËøêË°åÂ§ö‰∏™ÂÆû‰æãËøõÁ®ãÔºà‰æã">
<meta property="og:type" content="article">
<meta property="og:title" content="JUCÂπ∂ÂèëÁºñÁ®ãÂ≠¶‰π†Á¨îËÆ∞">
<meta property="og:url" content="http://example.com/2025/04/12/JAVA/JUC/index.html">
<meta property="og:site_name" content="RANZIER">
<meta property="og:description" content="JUCÂπ∂ÂèëÁºñÁ®ãÂ≠¶‰π†Á¨îËÆ∞   ‰∏Ä. Âü∫Êú¨Ê¶ÇÂøµ1. ËøõÁ®ã‰∏éÁ∫øÁ®ã ËøõÁ®ã  Á®ãÂ∫èÁî±Êåá‰ª§ÂíåÊï∞ÊçÆÁªÑÊàêÔºå‰ΩÜËøô‰∫õÊåá‰ª§Ë¶ÅËøêË°åÔºåÊï∞ÊçÆË¶ÅËØªÂÜôÔºåÂ∞±ÂøÖÈ°ªÂ∞ÜÊåá‰ª§Âä†ËΩΩËá≥ CPUÔºåÊï∞ÊçÆÂä†ËΩΩËá≥ÂÜÖÂ≠ò„ÄÇÂú®Êåá‰ª§ËøêË°åËøáÁ®ã‰∏≠ËøòÈúÄË¶ÅÁî®Âà∞Á£ÅÁõò„ÄÅÁΩëÁªúÁ≠âËÆæÂ§á„ÄÇËøõÁ®ãÂ∞±ÊòØÁî®Êù•Âä†ËΩΩÊåá‰ª§„ÄÅÁÆ°ÁêÜÂÜÖÂ≠ò„ÄÅÁÆ°ÁêÜ IO ÁöÑ„ÄÇ ÂΩì‰∏Ä‰∏™Á®ãÂ∫èË¢´ËøêË°åÔºå‰ªéÁ£ÅÁõòÂä†ËΩΩËøô‰∏™Á®ãÂ∫èÁöÑ‰ª£Á†ÅËá≥ÂÜÖÂ≠òÔºåËøôÊó∂Â∞±ÂºÄÂêØ‰∫Ü‰∏Ä‰∏™ËøõÁ®ã„ÄÇ ËøõÁ®ãÂ∞±ÂèØ‰ª•ËßÜ‰∏∫Á®ãÂ∫èÁöÑ‰∏Ä‰∏™ÂÆû‰æã„ÄÇÂ§ßÈÉ®ÂàÜÁ®ãÂ∫èÂèØ‰ª•ÂêåÊó∂ËøêË°åÂ§ö‰∏™ÂÆû‰æãËøõÁ®ãÔºà‰æã">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/bg/35.jpg">
<meta property="article:published_time" content="2025-04-12T03:29:24.000Z">
<meta property="article:modified_time" content="2025-10-14T07:27:19.504Z">
<meta property="article:author" content="ranzier">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="JUC">
<meta property="article:tag" content="Â≠¶‰π†">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/bg/35.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>JUCÂπ∂ÂèëÁºñÁ®ãÂ≠¶‰π†Á¨îËÆ∞ - RANZIER</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ‰∏ªÈ¢ò‰æùËµñÁöÑÂõæÊ†áÂ∫ìÔºå‰∏çË¶ÅËá™Ë°å‰øÆÊîπ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3846514_kabxni94auf.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/gundongtiao.css">
<link rel="stylesheet" href="/css/bubble.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"üåü","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body><!-- hexo injector body_begin start --><div id="web_bg"></div><!-- hexo injector body_begin end -->
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>RANZIER</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>È¶ñÈ°µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>ÂΩíÊ°£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>ÂàÜÁ±ª</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Ê†áÁ≠æ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>ÂÖ≥‰∫é</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bg/3.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.35)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="JUCÂπ∂ÂèëÁºñÁ®ãÂ≠¶‰π†Á¨îËÆ∞"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-04-12 11:29" pubdate>
          2025Âπ¥4Êúà12Êó• ‰∏äÂçà
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          23k Â≠ó
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          116 ÂàÜÈíü
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          Êú¨ÊñáÈòÖËØªÊ¨°Êï∞Ôºö<span id="busuanzi_value_page_pv"></span> Ê¨°
        </span>
        

      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">JUCÂπ∂ÂèëÁºñÁ®ãÂ≠¶‰π†Á¨îËÆ∞</h1>
            
            
              <div class="markdown-body">
                
                <h1 align="center">JUCÂπ∂ÂèëÁºñÁ®ãÂ≠¶‰π†Á¨îËÆ∞</h1>


<h1 id="‰∏Ä-Âü∫Êú¨Ê¶ÇÂøµ"><a href="#‰∏Ä-Âü∫Êú¨Ê¶ÇÂøµ" class="headerlink" title="‰∏Ä. Âü∫Êú¨Ê¶ÇÂøµ"></a>‰∏Ä. Âü∫Êú¨Ê¶ÇÂøµ</h1><h2 id="1-ËøõÁ®ã‰∏éÁ∫øÁ®ã"><a href="#1-ËøõÁ®ã‰∏éÁ∫øÁ®ã" class="headerlink" title="1. ËøõÁ®ã‰∏éÁ∫øÁ®ã"></a>1. ËøõÁ®ã‰∏éÁ∫øÁ®ã</h2><ul>
<li><p><strong>ËøõÁ®ã</strong></p>
<ul>
<li>Á®ãÂ∫èÁî±Êåá‰ª§ÂíåÊï∞ÊçÆÁªÑÊàêÔºå‰ΩÜËøô‰∫õÊåá‰ª§Ë¶ÅËøêË°åÔºåÊï∞ÊçÆË¶ÅËØªÂÜôÔºåÂ∞±ÂøÖÈ°ªÂ∞ÜÊåá‰ª§Âä†ËΩΩËá≥ CPUÔºåÊï∞ÊçÆÂä†ËΩΩËá≥ÂÜÖÂ≠ò„ÄÇÂú®Êåá‰ª§ËøêË°åËøáÁ®ã‰∏≠ËøòÈúÄË¶ÅÁî®Âà∞Á£ÅÁõò„ÄÅÁΩëÁªúÁ≠âËÆæÂ§á„ÄÇ<strong>ËøõÁ®ãÂ∞±ÊòØÁî®Êù•Âä†ËΩΩÊåá‰ª§„ÄÅÁÆ°ÁêÜÂÜÖÂ≠ò„ÄÅÁÆ°ÁêÜ IO ÁöÑ</strong>„ÄÇ</li>
<li>ÂΩì‰∏Ä‰∏™Á®ãÂ∫èË¢´ËøêË°åÔºå‰ªéÁ£ÅÁõòÂä†ËΩΩËøô‰∏™Á®ãÂ∫èÁöÑ‰ª£Á†ÅËá≥ÂÜÖÂ≠òÔºåËøôÊó∂Â∞±ÂºÄÂêØ‰∫Ü‰∏Ä‰∏™ËøõÁ®ã„ÄÇ</li>
<li><strong>ËøõÁ®ãÂ∞±ÂèØ‰ª•ËßÜ‰∏∫Á®ãÂ∫èÁöÑ‰∏Ä‰∏™ÂÆû‰æã</strong>„ÄÇÂ§ßÈÉ®ÂàÜÁ®ãÂ∫èÂèØ‰ª•ÂêåÊó∂ËøêË°åÂ§ö‰∏™ÂÆû‰æãËøõÁ®ãÔºà‰æãÂ¶ÇËÆ∞‰∫ãÊú¨„ÄÅÁîªÂõæ„ÄÅÊµèËßàÂô®Á≠âÔºâÔºå‰πüÊúâÁöÑÁ®ãÂ∫èÂè™ËÉΩÂêØÂä®‰∏Ä‰∏™ÂÆû‰æãËøõÁ®ãÔºà‰æãÂ¶ÇÁΩëÊòì‰∫ëÈü≥‰πê„ÄÅ360 ÂÆâÂÖ®Âç´Â£´Á≠âÔºâ</li>
</ul>
</li>
<li><p><strong>Á∫øÁ®ã</strong></p>
<ul>
<li><strong>‰∏Ä‰∏™ËøõÁ®ã‰πãÂÜÖÂèØ‰ª•ÂàÜ‰∏∫‰∏ÄÂà∞Â§ö‰∏™Á∫øÁ®ã</strong>„ÄÇ</li>
<li>‰∏Ä‰∏™Á∫øÁ®ãÂ∞±ÊòØ‰∏Ä‰∏™Êåá‰ª§ÊµÅÔºåÂ∞ÜÊåá‰ª§ÊµÅ‰∏≠ÁöÑ‰∏ÄÊù°Êù°Êåá‰ª§‰ª•‰∏ÄÂÆöÁöÑÈ°∫Â∫è‰∫§Áªô CPU ÊâßË°å„ÄÇ<strong>Á∫øÁ®ãË¥üË¥£ÊâßË°åÊåá‰ª§</strong>„ÄÇ</li>
<li>Java ‰∏≠Ôºå<strong>Á∫øÁ®ã‰Ωú‰∏∫ÊúÄÂ∞èË∞ÉÂ∫¶Âçï‰ΩçÔºåËøõÁ®ã‰Ωú‰∏∫ËµÑÊ∫êÂàÜÈÖçÁöÑÊúÄÂ∞èÂçï‰Ωç</strong>„ÄÇ Âú® windows ‰∏≠ËøõÁ®ãÊòØ‰∏çÊ¥ªÂä®ÁöÑÔºåÂè™ÊòØ‰Ωú‰∏∫Á∫øÁ®ãÁöÑÂÆπÂô®</li>
</ul>
</li>
<li><p><strong>‰∏§ËÄÖÂØπÊØî</strong></p>
<ul>
<li>ËøõÁ®ãÂü∫Êú¨‰∏äÁõ∏‰∫íÁã¨Á´ãÁöÑÔºåËÄå<strong>Á∫øÁ®ãÂ≠òÂú®‰∫éËøõÁ®ãÂÜÖÔºåÊòØËøõÁ®ãÁöÑ‰∏Ä‰∏™Â≠êÈõÜ</strong> </li>
<li><strong>ËøõÁ®ãÊã•ÊúâÂÖ±‰∫´ÁöÑËµÑÊ∫êÔºåÂ¶ÇÂÜÖÂ≠òÁ©∫Èó¥Á≠âÔºå‰æõÂÖ∂ÂÜÖÈÉ®ÁöÑÁ∫øÁ®ãÂÖ±‰∫´</strong></li>
<li>ËøõÁ®ãÈó¥ÈÄö‰ø°ËæÉ‰∏∫Â§çÊùÇ <ul>
<li>Âêå‰∏ÄÂè∞ËÆ°ÁÆóÊú∫ÁöÑËøõÁ®ãÈÄö‰ø°Áß∞‰∏∫ IPCÔºàInter-process communicationÔºâ</li>
<li>‰∏çÂêåËÆ°ÁÆóÊú∫‰πãÈó¥ÁöÑËøõÁ®ãÈÄö‰ø°ÔºåÈúÄË¶ÅÈÄöËøáÁΩëÁªúÔºåÂπ∂ÈÅµÂÆàÂÖ±ÂêåÁöÑÂçèËÆÆÔºå‰æãÂ¶Ç HTTP</li>
</ul>
</li>
<li>Á∫øÁ®ãÈÄö‰ø°Áõ∏ÂØπÁÆÄÂçïÔºåÂõ†‰∏∫ÂÆÉ‰ª¨ÂÖ±‰∫´ËøõÁ®ãÂÜÖÁöÑÂÜÖÂ≠òÔºå‰∏Ä‰∏™‰æãÂ≠êÊòØÂ§ö‰∏™Á∫øÁ®ãÂèØ‰ª•ËÆøÈóÆÂêå‰∏Ä‰∏™ÂÖ±‰∫´ÂèòÈáè </li>
<li>Á∫øÁ®ãÊõ¥ËΩªÈáèÔºåÁ∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢ÊàêÊú¨‰∏ÄËà¨‰∏äË¶ÅÊØîËøõÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢‰Ωé</li>
</ul>
</li>
</ul>
<h2 id="2-Âπ∂Ë°åÂíåÂπ∂Âèë"><a href="#2-Âπ∂Ë°åÂíåÂπ∂Âèë" class="headerlink" title="2. Âπ∂Ë°åÂíåÂπ∂Âèë"></a>2. Âπ∂Ë°åÂíåÂπ∂Âèë</h2><ul>
<li>Âπ∂ÂèëÊòØ‰∏Ä‰∏™CPUÂú®‰∏çÂêåÁöÑÊó∂Èó¥Âéª‰∏çÂêåÁ∫øÁ®ã‰∏≠ÊâßË°åÊåá‰ª§„ÄÇ<strong>Á∫øÁ®ãËΩÆÊµÅ‰ΩøÁî®CPUÁöÑÂÅöÊ≥ïÁß∞‰∏∫Âπ∂Âèë</strong></li>
<li>Âπ∂Ë°åÊòØÂ§ö‰∏™CPUÂêåÊó∂Â§ÑÁêÜ‰∏çÂêåÁöÑÁ∫øÁ®ã„ÄÇ<strong>Â§öÊ†∏CPU‰∏ãÔºåÊØè‰∏™Ê†∏Ë∞ÉÂ∫¶ËøêË°åÁ∫øÁ®ãÔºåËøô‰∏™Êó∂ÂÄôÁ∫øÁ®ãÊòØÂπ∂Ë°åÁöÑ</strong></li>
<li>Âπ∂ÂèëÔºö Âêå‰∏ÄÊó∂Èó¥ÊÆµÔºåÂ§ö‰∏™‰ªªÂä°ÈÉΩÂú®ÊâßË°å (Âçï‰ΩçÊó∂Èó¥ÂÜÖ‰∏ç‰∏ÄÂÆöÂêåÊó∂ÊâßË°å)Ôºõ</li>
<li>Âπ∂Ë°åÔºö Âçï‰ΩçÊó∂Èó¥ÂÜÖÔºåÂ§ö‰∏™‰ªªÂä°<strong>ÂêåÊó∂ÊâßË°å</strong>„ÄÇ</li>
</ul>
<h2 id="3-ÂêåÊ≠•ÂíåÂºÇÊ≠•"><a href="#3-ÂêåÊ≠•ÂíåÂºÇÊ≠•" class="headerlink" title="3. ÂêåÊ≠•ÂíåÂºÇÊ≠•"></a>3. ÂêåÊ≠•ÂíåÂºÇÊ≠•</h2><p>‰ªéË∞ÉÁî®ÊñπÁöÑËßíÂ∫¶ÔºåÂ¶ÇÊûú</p>
<ul>
<li>ÂêåÊ≠•Ôºö<strong>ÈúÄË¶ÅÁ≠âÂæÖÁªìÊûúËøîÂõûÊâçËÉΩÁªßÁª≠ËøêË°å</strong>ÁöÑËØùÂ∞±ÊòØÂêåÊ≠•</li>
<li>ÂºÇÊ≠•Ôºö<strong>‰∏çÈúÄË¶ÅÁ≠âÂæÖ</strong>Â∞±ÊòØÂºÇÊ≠•</li>
</ul>
<h2 id="4-ÁªìËÆ∫"><a href="#4-ÁªìËÆ∫" class="headerlink" title="4. ÁªìËÆ∫"></a>4. ÁªìËÆ∫</h2><ol>
<li><strong>ÂçïÊ†∏cpu‰∏ãÔºåÂ§öÁ∫øÁ®ã‰∏çËÉΩÂÆûÈôÖÊèêÈ´òÁ®ãÂ∫èËøêË°åÊïàÁéá</strong>ÔºåÂè™ÊòØ‰∏∫‰∫ÜËÉΩÂ§üÂú®‰∏çÂêåÁöÑ‰ªªÂä°‰πãÈó¥ÂàáÊç¢Ôºå‰∏çÂêåÁ∫øÁ®ãËΩÆÊµÅ‰ΩøÁî® cpuÔºå‰∏çËá≥‰∫é‰∏Ä‰∏™Á∫øÁ®ãÊÄªÂç†Áî® cpuÔºåÂà´ÁöÑÁ∫øÁ®ãÊ≤°Ê≥ïÂπ≤Ê¥ª</li>
<li>Â§öÊ†∏ cpu ÂèØ‰ª•Âπ∂Ë°åË∑ëÂ§ö‰∏™Á∫øÁ®ãÔºå‰ΩÜËÉΩÂê¶ÊèêÈ´òÁ®ãÂ∫èËøêË°åÊïàÁéáËøòÊòØË¶ÅÂàÜÊÉÖÂÜµÁöÑ<ul>
<li>Êúâ‰∫õ‰ªªÂä°ÔºåÁªèËøáÁ≤æÂøÉËÆæËÆ°Ôºå<strong>Â∞Ü‰ªªÂä°ÊãÜÂàÜÔºåÂπ∂Ë°åÊâßË°åÔºåÂΩìÁÑ∂ÂèØ‰ª•ÊèêÈ´òÁ®ãÂ∫èÁöÑËøêË°åÊïàÁéá„ÄÇ<strong>‰ΩÜ</strong>‰∏çÊòØÊâÄÊúâËÆ°ÁÆó‰ªªÂä°ÈÉΩËÉΩÊãÜÂàÜ</strong></li>
<li><strong>‰πü‰∏çÊòØÊâÄÊúâ‰ªªÂä°ÈÉΩÈúÄË¶ÅÊãÜÂàÜ</strong>Ôºå‰ªªÂä°ÁöÑÁõÆÁöÑÂ¶ÇÊûú‰∏çÂêåÔºåË∞àÊãÜÂàÜÂíåÊïàÁéáÊ≤°Âï•ÊÑè‰πâ</li>
</ul>
</li>
<li><strong>IO Êìç‰Ωú‰∏çÂç†Áî® cpu</strong>ÔºåÂè™ÊòØÊàë‰ª¨‰∏ÄËà¨Êã∑Ë¥ùÊñá‰ª∂‰ΩøÁî®ÁöÑÊòØ„ÄêÈòªÂ°û IO„ÄëÔºåËøôÊó∂Áõ∏ÂΩì‰∫éÁ∫øÁ®ãËôΩÁÑ∂‰∏çÁî® cpuÔºå‰ΩÜÈúÄË¶Å‰∏ÄÁõ¥Á≠âÂæÖ IO ÁªìÊùüÔºåÊ≤°ËÉΩÂÖÖÂàÜÂà©Áî®Á∫øÁ®ã„ÄÇ</li>
</ol>
<h1 id="‰∫å-JavaÁ∫øÁ®ã"><a href="#‰∫å-JavaÁ∫øÁ®ã" class="headerlink" title="‰∫å. JavaÁ∫øÁ®ã"></a>‰∫å. JavaÁ∫øÁ®ã</h1><h2 id="1-ÂàõÂª∫ÂíåËøêË°åÁ∫øÁ®ã"><a href="#1-ÂàõÂª∫ÂíåËøêË°åÁ∫øÁ®ã" class="headerlink" title="1. ÂàõÂª∫ÂíåËøêË°åÁ∫øÁ®ã"></a>1. ÂàõÂª∫ÂíåËøêË°åÁ∫øÁ®ã</h2><h3 id="1-1-Áõ¥Êé•‰ΩøÁî®Thread"><a href="#1-1-Áõ¥Êé•‰ΩøÁî®Thread" class="headerlink" title="1.1 Áõ¥Êé•‰ΩøÁî®Thread"></a>1.1 Áõ¥Êé•‰ΩøÁî®Thread</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// ÂåøÂêçÂÜÖÈÉ®Á±ªÊñπÂºèÂàõÂª∫ ThreadÂØπË±°</span><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-string">&quot;t1&quot;</span>) &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-comment">//runÊñπÊ≥ïÂÜÖÂÆûÁé∞Ë¶ÅÊâßË°åÁöÑ‰ªªÂä°</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                log.debug(<span class="hljs-string">&quot;running&quot;</span>);<br>            &#125;<br>        &#125;;<br>        <br>        <span class="hljs-comment">//ÂêØÂä®Á∫øÁ®ã</span><br>        t.start();<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-‰ΩøÁî®-Runnable-ÈÖçÂêà-ThreadÔºàÊé®ËçêÔºâ"><a href="#1-2-‰ΩøÁî®-Runnable-ÈÖçÂêà-ThreadÔºàÊé®ËçêÔºâ" class="headerlink" title="1.2 ‰ΩøÁî® Runnable ÈÖçÂêà ThreadÔºàÊé®ËçêÔºâ"></a>1.2 ‰ΩøÁî® Runnable ÈÖçÂêà ThreadÔºàÊé®ËçêÔºâ</h3><p>ÊääÁ∫øÁ®ãÂíå‰ªªÂä°ÂàÜÂºÄ</p>
<ul>
<li>Thread ‰ª£Ë°®Á∫øÁ®ã</li>
<li>Runnable ÂèØËøêË°åÁöÑ‰ªªÂä°ÔºàÁ∫øÁ®ãË¶ÅÊâßË°åÁöÑ‰ª£Á†ÅÔºâ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Runnable</span> <span class="hljs-variable">runnable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// Ë¶ÅÊâßË°åÁöÑ‰ªªÂä°</span><br>    &#125;<br>&#125;;<br><span class="hljs-comment">// ÂàõÂª∫Á∫øÁ®ãÂØπË±°</span><br><span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(runnable);<br><span class="hljs-comment">// ÂêØÂä®Á∫øÁ®ã</span><br>t.start();<br></code></pre></td></tr></table></figure>
<p>lambda Á≤æÁÆÄ‰ª£Á†Å:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ÂàõÂª∫‰ªªÂä°ÂØπË±°</span><br><span class="hljs-type">Runnable</span> <span class="hljs-variable">task2</span> <span class="hljs-operator">=</span> () -&gt; log.debug(<span class="hljs-string">&quot;hello&quot;</span>);<br> <br><span class="hljs-comment">// ÂèÇÊï∞1 ÊòØ‰ªªÂä°ÂØπË±°; ÂèÇÊï∞2 ÊòØÁ∫øÁ®ãÂêçÂ≠óÔºåÊé®Ëçê</span><br><span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task2, <span class="hljs-string">&quot;t2&quot;</span>);<br>t2.start();<br></code></pre></td></tr></table></figure>

<ul>
<li>Thread ‰∏é Runnable ÁöÑÂÖ≥Á≥ª<ul>
<li>ÊñπÊ≥ï1 ÊòØÊääÁ∫øÁ®ãÂíå‰ªªÂä°ÂêàÂπ∂Âú®‰∫Ü‰∏ÄËµ∑ÔºåÊñπÊ≥ï2 ÊòØÊääÁ∫øÁ®ãÂíå‰ªªÂä°ÂàÜÂºÄ‰∫Ü</li>
<li>Áî® Runnable Êõ¥ÂÆπÊòì‰∏éÁ∫øÁ®ãÊ±†Á≠âÈ´òÁ∫ß API ÈÖçÂêà</li>
<li>Áî® Runnable ËÆ©‰ªªÂä°Á±ªËÑ±Á¶ª‰∫Ü Thread ÁªßÊâø‰ΩìÁ≥ªÔºåÊõ¥ÁÅµÊ¥ª</li>
</ul>
</li>
</ul>
<h3 id="1-3-FutureTask-ÈÖçÂêà-Thread"><a href="#1-3-FutureTask-ÈÖçÂêà-Thread" class="headerlink" title="1.3 FutureTask ÈÖçÂêà Thread"></a>1.3 FutureTask ÈÖçÂêà Thread</h3><p>FutureTask ËÉΩÂ§üÊé•Êî∂ Callable Á±ªÂûãÁöÑÂèÇÊï∞ÔºåÁî®Êù•Â§ÑÁêÜÊúâËøîÂõûÁªìÊûúÁöÑÊÉÖÂÜµ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ÂàõÂª∫‰ªªÂä°ÂØπË±°</span><br>FutureTask&lt;Integer&gt; task3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(() -&gt; &#123;<br>    log.debug(<span class="hljs-string">&quot;hello&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;<br>&#125;);<br> <br><span class="hljs-comment">// ÂèÇÊï∞1 ÊòØ‰ªªÂä°ÂØπË±°; ÂèÇÊï∞2 ÊòØÁ∫øÁ®ãÂêçÂ≠óÔºåÊé®Ëçê</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task3, <span class="hljs-string">&quot;t3&quot;</span>).start();<br></code></pre></td></tr></table></figure>

<h2 id="2-Êü•ÁúãËøõÁ®ãÁ∫øÁ®ãÁöÑÊñπÊ≥ï"><a href="#2-Êü•ÁúãËøõÁ®ãÁ∫øÁ®ãÁöÑÊñπÊ≥ï" class="headerlink" title="2. Êü•ÁúãËøõÁ®ãÁ∫øÁ®ãÁöÑÊñπÊ≥ï"></a>2. Êü•ÁúãËøõÁ®ãÁ∫øÁ®ãÁöÑÊñπÊ≥ï</h2><ul>
<li>‰ªªÂä°ÁÆ°ÁêÜÂô®ÂèØ‰ª•Êü•ÁúãËøõÁ®ãÂíåÁ∫øÁ®ãÊï∞Ôºå‰πüÂèØ‰ª•Áî®Êù•ÊùÄÊ≠ªËøõÁ®ã</li>
<li>tasklist  Êü•ÁúãËøõÁ®ã</li>
<li>taskkill  ÊùÄÊ≠ªËøõÁ®ã</li>
<li>jps  ÂëΩ‰ª§Êü•ÁúãÊâÄÊúâ Java ËøõÁ®ã</li>
<li><code>jstack &lt;PID&gt;</code>  Êü•ÁúãÊüê‰∏™ Java ËøõÁ®ãÔºàPIDÔºâÁöÑÊâÄÊúâÁ∫øÁ®ãÁä∂ÊÄÅ </li>
<li>jconsole  Êù•Êü•ÁúãÊüê‰∏™ Java ËøõÁ®ã‰∏≠Á∫øÁ®ãÁöÑËøêË°åÊÉÖÂÜµÔºàÂõæÂΩ¢ÁïåÈù¢Ôºâ</li>
</ul>
<h2 id="3-Á∫øÁ®ãËøêË°åÁöÑÂéüÁêÜ"><a href="#3-Á∫øÁ®ãËøêË°åÁöÑÂéüÁêÜ" class="headerlink" title="3. Á∫øÁ®ãËøêË°åÁöÑÂéüÁêÜ"></a>3. Á∫øÁ®ãËøêË°åÁöÑÂéüÁêÜ</h2><h3 id="3-1-Ê†à‰∏éÊ†àÂ∏ß"><a href="#3-1-Ê†à‰∏éÊ†àÂ∏ß" class="headerlink" title="3.1 Ê†à‰∏éÊ†àÂ∏ß"></a>3.1 Ê†à‰∏éÊ†àÂ∏ß</h3><ul>
<li>JVM ‰∏≠Áî±Â†Ü„ÄÅÊ†à„ÄÅÊñπÊ≥ïÂå∫ÊâÄÁªÑÊàê</li>
<li>ÂÖ∂‰∏≠Ê†àÂÜÖÂ≠òÊòØÁªôÁ∫øÁ®ãÁî®ÁöÑÔºåÊØè‰∏™<strong>Á∫øÁ®ãÂêØÂä®ÂêéÔºåËôöÊãüÊú∫Â∞±‰ºö‰∏∫ÂÖ∂ÂàÜÈÖç‰∏ÄÂùóÊ†àÂÜÖÂ≠ò</strong>„ÄÇ<ul>
<li>ÊØè‰∏™Ê†àÁî±Â§ö‰∏™Ê†àÂ∏ßÔºàFrameÔºâÁªÑÊàêÔºåÂØπÂ∫îÁùÄÊØèÊ¨°ÊñπÊ≥ïË∞ÉÁî®Êó∂ÊâÄÂç†Áî®ÁöÑÂÜÖÂ≠ò</li>
<li><strong>ÊØè‰∏™Á∫øÁ®ãÂè™ËÉΩÊúâ‰∏Ä‰∏™Ê¥ªÂä®Ê†àÂ∏ß</strong>ÔºåÂØπÂ∫îÁùÄÂΩìÂâçÊ≠£Âú®ÊâßË°åÁöÑÈÇ£‰∏™ÊñπÊ≥ï</li>
</ul>
</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.2.1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-2-Á∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢"><a href="#3-2-Á∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢" class="headerlink" title="3.2 Á∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢"></a>3.2 Á∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢</h3><p>‰ªé‰ΩøÁî®CPUÂà∞‰∏ç‰ΩøÁî®CPUÂ∞±ÊòØÁ∫øÁ®ãÂàáÊç¢</p>
<p>Âõ†‰∏∫‰ª•‰∏ã‰∏Ä‰∫õÂéüÂõ†ÂØºËá¥ cpu ‰∏çÂÜçÊâßË°åÂΩìÂâçÁöÑÁ∫øÁ®ãÔºåËΩ¨ËÄåÊâßË°åÂè¶‰∏Ä‰∏™Á∫øÁ®ãÁöÑ‰ª£Á†Å</p>
<ul>
<li>Á∫øÁ®ãÁöÑ cpu Êó∂Èó¥ÁâáÁî®ÂÆå</li>
<li>ÂûÉÂúæÂõûÊî∂</li>
<li>ÊúâÊõ¥È´ò‰ºòÂÖàÁ∫ßÁöÑÁ∫øÁ®ãÈúÄË¶ÅËøêË°å</li>
<li>Á∫øÁ®ãËá™Â∑±Ë∞ÉÁî®‰∫Ü sleep„ÄÅyield„ÄÅwait„ÄÅjoin„ÄÅpark„ÄÅsynchronized„ÄÅlock Á≠âÊñπÊ≥ï</li>
</ul>
<p>ÂΩì‰∏ä‰∏ãÊñáÂàáÊç¢ÂèëÁîüÊó∂Ôºå<strong>ÈúÄË¶ÅÁî±Êìç‰ΩúÁ≥ªÁªü‰øùÂ≠òÂΩìÂâçÁ∫øÁ®ãÁöÑÁä∂ÊÄÅ</strong>ÔºåÂπ∂ÊÅ¢Â§çÂè¶‰∏Ä‰∏™Á∫øÁ®ãÁöÑÁä∂ÊÄÅÔºåJava ‰∏≠ÂØπÂ∫îÁöÑÊ¶ÇÂøµ</p>
<ul>
<li>Á®ãÂ∫èËÆ°Êï∞Âô®ÔºåÂÆÉÁöÑ‰ΩúÁî®ÊòØ<strong>ËÆ∞‰Ωè‰∏ã‰∏ÄÊù° jvm Êåá‰ª§ÁöÑÊâßË°åÂú∞ÂùÄ</strong>ÔºåÊòØÁ∫øÁ®ãÁßÅÊúâÁöÑ</li>
<li>Áä∂ÊÄÅÂåÖÊã¨Á®ãÂ∫èËÆ°Êï∞Âô®„ÄÅËôöÊãüÊú∫Ê†à‰∏≠ÊØè‰∏™Ê†àÂ∏ßÁöÑ‰ø°ÊÅØÔºåÂ¶ÇÂ±ÄÈÉ®ÂèòÈáè„ÄÅÊìç‰ΩúÊï∞Ê†à„ÄÅËøîÂõûÂú∞ÂùÄÁ≠â</li>
<li>‰∏ä‰∏ãÊñá<strong>ÂàáÊç¢È¢ëÁπÅÂèëÁîü‰ºöÂΩ±ÂìçÊÄßËÉΩ</strong></li>
</ul>
<h2 id="4-Á∫øÁ®ãÁöÑÂ∏∏ËßÅÊñπÊ≥ï"><a href="#4-Á∫øÁ®ãÁöÑÂ∏∏ËßÅÊñπÊ≥ï" class="headerlink" title="4. Á∫øÁ®ãÁöÑÂ∏∏ËßÅÊñπÊ≥ï"></a>4. Á∫øÁ®ãÁöÑÂ∏∏ËßÅÊñπÊ≥ï</h2><table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>static</th>
<th>ÂäüËÉΩËØ¥Êòé</th>
<th>Ê≥®ÊÑè</th>
</tr>
</thead>
<tbody><tr>
<td>start()</td>
<td></td>
<td>ÂêØÂä®‰∏Ä‰∏™Êñ∞Á∫øÁ®ãÔºåÂú®Êñ∞Á∫øÁ®ã‰∏≠ËøêË°å run ÊñπÊ≥ï‰∏≠ÁöÑ‰ª£Á†Å</td>
<td>start ÊñπÊ≥ïÂè™ÊòØËÆ©Á∫øÁ®ãËøõÂÖ•Â∞±Áª™Áä∂ÊÄÅÔºåÈáåÈù¢‰ª£Á†Å‰∏ç‰∏ÄÂÆöÁ´ãÂàªËøêË°å„ÄÇÊØè‰∏™Á∫øÁ®ãÁöÑ start ÊñπÊ≥ïÂè™ËÉΩË∞ÉÁî®‰∏ÄÊ¨°„ÄÇ</td>
</tr>
<tr>
<td>run()</td>
<td></td>
<td>Êñ∞Á∫øÁ®ãÂêØÂä®‰ºöË∞ÉÁî®ÁöÑÊñπÊ≥ï</td>
<td>Â¶ÇÊûúÂú®ÊûÑÈÄ† Thread ÂØπË±°Êó∂‰º†ÈÄí‰∫Ü Runnable ÂèÇÊï∞ÔºåÂàôÁ∫øÁ®ãÂêØÂä®Âêé‰ºöË∞ÉÁî® Runnable ‰∏≠ÁöÑ run ÊñπÊ≥ï„ÄÇ</td>
</tr>
<tr>
<td>join()</td>
<td></td>
<td>Á≠âÂæÖÁ∫øÁ®ãËøêË°åÁªìÊùü</td>
<td></td>
</tr>
<tr>
<td>join(long n)</td>
<td></td>
<td>Á≠âÂæÖÁ∫øÁ®ãËøêË°åÁªìÊùü,ÊúÄÂ§öÁ≠âÂæÖ n ÊØ´Áßí</td>
<td></td>
</tr>
<tr>
<td>getId()</td>
<td></td>
<td>Ëé∑ÂèñÁ∫øÁ®ãÈïøÊï¥ÂûãÁöÑ id</td>
<td>id ÂîØ‰∏Ä</td>
</tr>
<tr>
<td>getName()</td>
<td></td>
<td>Ëé∑ÂèñÁ∫øÁ®ãÂêç</td>
<td></td>
</tr>
<tr>
<td>setName(String)</td>
<td></td>
<td>‰øÆÊîπÁ∫øÁ®ãÂêç</td>
<td></td>
</tr>
<tr>
<td>getPriority()</td>
<td></td>
<td>Ëé∑ÂèñÁ∫øÁ®ã‰ºòÂÖàÁ∫ß</td>
<td></td>
</tr>
<tr>
<td>setPriority(int)</td>
<td></td>
<td>‰øÆÊîπÁ∫øÁ®ã‰ºòÂÖàÁ∫ß</td>
<td>Java ‰∏≠Á∫øÁ®ã‰ºòÂÖàÁ∫ßÊòØ1~10 ÁöÑÊï¥Êï∞ÔºåËæÉÂ§ßÁöÑ‰ºòÂÖàÁ∫ßËÉΩÊèêÈ´òËØ•Á∫øÁ®ãË¢´ CPU Ë∞ÉÂ∫¶ÁöÑÊú∫Áéá„ÄÇ</td>
</tr>
<tr>
<td>getState()</td>
<td></td>
<td>Ëé∑ÂèñÁ∫øÁ®ãÁä∂ÊÄÅ</td>
<td>Java ‰∏≠Á∫øÁ®ãÁä∂ÊÄÅÊòØÁî® 6 ‰∏™ enum Ë°®Á§∫ÔºöNEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TERMINATED„ÄÇ</td>
</tr>
<tr>
<td>isInterrupted()</td>
<td></td>
<td>Âà§Êñ≠ÊòØÂê¶Ë¢´ÊâìÊñ≠</td>
<td>‰∏ç‰ºöÊ∏ÖÈô§ ÊâìÊñ≠Ê†áËÆ∞</td>
</tr>
<tr>
<td>isAlive()</td>
<td></td>
<td>Á∫øÁ®ãÊòØÂê¶Â≠òÊ¥ªÔºàËøòÊ≤°ÊúâËøêË°åÂÆåÊØïÔºâ</td>
<td></td>
</tr>
<tr>
<td>interrupt()</td>
<td></td>
<td>ÊâìÊñ≠Á∫øÁ®ã</td>
<td>Â¶ÇÊûúË¢´ÊâìÊñ≠Á∫øÁ®ãÊ≠£Âú® sleepÔºåwaitÔºåjoin ‰ºöÂØºËá¥Ë¢´ÊâìÊñ≠ÁöÑÁ∫øÁ®ãÊäõÂá∫ InterruptedExceptionÔºåÂπ∂Ê∏ÖÈô§ ÊâìÊñ≠Ê†áËÆ∞„ÄÇ</td>
</tr>
<tr>
<td>interrupted()</td>
<td>static</td>
<td>Âà§Êñ≠ÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶Ë¢´ÊâìÊñ≠</td>
<td>‰ºöÊ∏ÖÈô§ ÊâìÊñ≠Ê†áËÆ∞</td>
</tr>
<tr>
<td>currentThread()</td>
<td>static</td>
<td>Ëé∑ÂèñÂΩìÂâçÊ≠£Âú®ÊâßË°åÁöÑÁ∫øÁ®ã</td>
<td></td>
</tr>
<tr>
<td>sleep(long n)</td>
<td>static</td>
<td>ËÆ©ÂΩìÂâçÊâßË°åÁöÑÁ∫øÁ®ã‰ºëÁú†nÊØ´ÁßíÔºå‰ºëÁú†Êó∂ËÆ©Âá∫ cpu ÁöÑÊó∂Èó¥ÁâáÁªôÂÖ∂ÂÆÉÁ∫øÁ®ã</td>
<td></td>
</tr>
<tr>
<td>yield()</td>
<td>static</td>
<td>ÊèêÁ§∫Á∫øÁ®ãË∞ÉÂ∫¶Âô®ËÆ©Âá∫ÂΩìÂâçÁ∫øÁ®ãÂØπCPUÁöÑ‰ΩøÁî®</td>
<td>‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÊµãËØïÂíåË∞ÉËØï</td>
</tr>
</tbody></table>
<h3 id="4-1-start-‰∏é-run"><a href="#4-1-start-‰∏é-run" class="headerlink" title="4.1  start ‰∏é run"></a>4.1  start ‰∏é run</h3><ul>
<li>ÂøÖÈ°ª<strong>Ë¶ÅÂÖàË∞ÉÁî®startÂºÄÂêØÁ∫øÁ®ãÔºåÂÜçË∞ÉÁî®runËøêË°å</strong></li>
<li>Áõ¥Êé•Ë∞ÉÁî® run ÊòØÂú®‰∏ªÁ∫øÁ®ã‰∏≠ÊâßË°å‰∫Ü runÔºåÊ≤°ÊúâÂêØÂä®Êñ∞ÁöÑÁ∫øÁ®ã</li>
<li>‰ΩøÁî® start ÊòØÂêØÂä®Êñ∞ÁöÑÁ∫øÁ®ãÔºåÈÄöËøáÊñ∞ÁöÑÁ∫øÁ®ãÈó¥Êé•ÊâßË°å run ‰∏≠ÁöÑ‰ª£Á†Å</li>
</ul>
<h3 id="4-2-sleep-‰∏é-yield"><a href="#4-2-sleep-‰∏é-yield" class="headerlink" title="4.2 sleep ‰∏é yield"></a>4.2 sleep ‰∏é yield</h3><h4 id="4-2-1-sleep-Áù°Áú†"><a href="#4-2-1-sleep-Áù°Áú†" class="headerlink" title="4.2.1 sleep (Áù°Áú†)"></a>4.2.1 sleep (Áù°Áú†)</h4><ol>
<li>Ë∞ÉÁî® sleep ‰ºöËÆ©<strong>ÂΩìÂâçÁ∫øÁ®ã‰ªé Running ËøêË°åÁä∂ÊÄÅ ËøõÂÖ• Timed Waiting Áù°Áú†Áä∂ÊÄÅ</strong>ÔºàÈòªÂ°ûÔºâ</li>
<li>ÂÖ∂ÂÆÉÁ∫øÁ®ãÂèØ‰ª•‰ΩøÁî®  <strong>interrupt ÊñπÊ≥ïÊâìÊñ≠Ê≠£Âú®Áù°Áú†ÁöÑÁ∫øÁ®ã</strong>ÔºåËøôÊó∂ sleep ÊñπÊ≥ï‰ºöÊäõÂá∫  InterruptedException  </li>
<li>Áù°Áú†ÁªìÊùüÂêéÁöÑÁ∫øÁ®ãÊú™ÂøÖ‰ºöÁ´ãÂàªÂæóÂà∞ÊâßË°å</li>
</ol>
<h4 id="4-2-2-yield-ËÆ©Âá∫"><a href="#4-2-2-yield-ËÆ©Âá∫" class="headerlink" title="4.2.2 yield (ËÆ©Âá∫)"></a>4.2.2 yield (ËÆ©Âá∫)</h4><ul>
<li>Ë∞ÉÁî® yield ‰ºö<strong>ËÆ©ÂΩìÂâçÁ∫øÁ®ã‰ªé Running(ËøêË°åÁä∂ÊÄÅ) ËøõÂÖ• Runnable (Â∞±Áª™Áä∂ÊÄÅ)</strong>ÔºåÁÑ∂ÂêéË∞ÉÂ∫¶ÊâßË°åÂÖ∂ÂÆÉÁ∫øÁ®ã</li>
</ul>
<h4 id="4-2-3-Á∫øÁ®ã‰ºòÂÖàÁ∫ß"><a href="#4-2-3-Á∫øÁ®ã‰ºòÂÖàÁ∫ß" class="headerlink" title="4.2.3 Á∫øÁ®ã‰ºòÂÖàÁ∫ß"></a>4.2.3 Á∫øÁ®ã‰ºòÂÖàÁ∫ß</h4><ul>
<li>Á∫øÁ®ã‰ºòÂÖàÁ∫ß‰ºöÊèêÁ§∫ÔºàhintÔºâË∞ÉÂ∫¶Âô®<strong>‰ºòÂÖàË∞ÉÂ∫¶ËØ•Á∫øÁ®ã</strong>Ôºå‰ΩÜÂÆÉ‰ªÖ‰ªÖÊòØ‰∏Ä‰∏™ÊèêÁ§∫ÔºåË∞ÉÂ∫¶Âô®ÂèØ‰ª•ÂøΩÁï•ÂÆÉ</li>
<li>Â¶ÇÊûú cpu ÊØîËæÉÂøôÔºåÈÇ£‰πà<strong>‰ºòÂÖàÁ∫ßÈ´òÁöÑÁ∫øÁ®ã‰ºöËé∑ÂæóÊõ¥Â§öÁöÑÊó∂Èó¥Áâá</strong>Ôºå‰ΩÜ cpu Èó≤Êó∂Ôºå‰ºòÂÖàÁ∫ßÂá†‰πéÊ≤°‰ΩúÁî®</li>
</ul>
<h4 id="4-2-4-Èò≤Ê≠¢CPUÂç†Áî®100"><a href="#4-2-4-Èò≤Ê≠¢CPUÂç†Áî®100" class="headerlink" title="4.2.4 Èò≤Ê≠¢CPUÂç†Áî®100%"></a>4.2.4 Èò≤Ê≠¢CPUÂç†Áî®100%</h4><p>Âú®Ê≤°ÊúâÂà©Áî®cpuÊù•ËÆ°ÁÆóÊó∂,‰∏çË¶ÅËÆ©while(true)Á©∫ËΩ¨Êµ™Ë¥πcpu,ËøôÊó∂ÂèØ‰ª•‰ΩøÁî®yieldÊàñsleepÊù•ËÆ©Âá∫cpuÁöÑ‰ΩøÁî®ÊùÉÁªôÂÖ∂‰ªñÁ®ãÂ∫è</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">50</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-3-join"><a href="#4-3-join" class="headerlink" title="4.3 join"></a>4.3 join</h3><p><strong>Á≠âÂæÖÊüê‰∏™Á∫øÁ®ãËøêË°åÁªìÊùü</strong><br>Âú®<strong>ÂêåÊ≠•Â∫îÁî®</strong>Ë¶Å‰ΩøÁî®join</p>
<ul>
<li>ÈúÄË¶ÅÁ≠âÂæÖÁªìÊûúËøîÂõûÔºåÊâçËÉΩÁªßÁª≠ËøêË°åÂ∞±ÊòØÂêåÊ≠•</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.2.2.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4-4-interrupt"><a href="#4-4-interrupt" class="headerlink" title="4.4 interrupt"></a>4.4 interrupt</h3><p>Ë∞ÉÁî®interruptÊñπÊ≥ïÂèØ‰ª•ÊâìÊñ≠ÂΩìÂâçËøêË°åÁöÑÁ∫øÁ®ãÔºåÂπ∂Â∞ÜÊâìÊñ≠Áä∂ÊÄÅÁΩÆ‰∏∫true„ÄÇ</p>
<h4 id="4-4-1-ÊâìÊñ≠-sleepÔºåwaitÔºåjoin-ÁöÑÁ∫øÁ®ã"><a href="#4-4-1-ÊâìÊñ≠-sleepÔºåwaitÔºåjoin-ÁöÑÁ∫øÁ®ã" class="headerlink" title="4.4.1 ÊâìÊñ≠ sleepÔºåwaitÔºåjoin ÁöÑÁ∫øÁ®ã"></a>4.4.1 ÊâìÊñ≠ sleepÔºåwaitÔºåjoin ÁöÑÁ∫øÁ®ã</h4><p>ËøôÂá†‰∏™ÊñπÊ≥ïÈÉΩ‰ºöËÆ©Á∫øÁ®ãËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅ</p>
<ul>
<li>ÊâìÊñ≠ sleep ÁöÑÁ∫øÁ®ã, <strong>‰ºöÊ∏ÖÁ©∫ÊâìÊñ≠Áä∂ÊÄÅ</strong></li>
</ul>
<h4 id="4-4-2-ÊâìÊñ≠Ê≠£Â∏∏ËøêË°åÁöÑÁ∫øÁ®ã"><a href="#4-4-2-ÊâìÊñ≠Ê≠£Â∏∏ËøêË°åÁöÑÁ∫øÁ®ã" class="headerlink" title="4.4.2 ÊâìÊñ≠Ê≠£Â∏∏ËøêË°åÁöÑÁ∫øÁ®ã"></a>4.4.2 ÊâìÊñ≠Ê≠£Â∏∏ËøêË°åÁöÑÁ∫øÁ®ã</h4><p>ÊâìÊñ≠Ê≠£Â∏∏ËøêË°åÁöÑÁ∫øÁ®ã, ‰∏ç‰ºöÊ∏ÖÁ©∫ÊâìÊñ≠Áä∂ÊÄÅ</p>
<h4 id="4-4-3-‰∏§Èò∂ÊÆµÁªàÊ≠¢Ê®°Âºè"><a href="#4-4-3-‰∏§Èò∂ÊÆµÁªàÊ≠¢Ê®°Âºè" class="headerlink" title="4.4.3 ‰∏§Èò∂ÊÆµÁªàÊ≠¢Ê®°Âºè"></a>4.4.3 ‰∏§Èò∂ÊÆµÁªàÊ≠¢Ê®°Âºè</h4><p><img src="/img/blogs/java/jvm-juc/juc.2.3.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="4-4-4-ÊâìÊñ≠-park-Á∫øÁ®ã"><a href="#4-4-4-ÊâìÊñ≠-park-Á∫øÁ®ã" class="headerlink" title="4.4.4 ÊâìÊñ≠ park Á∫øÁ®ã"></a>4.4.4 ÊâìÊñ≠ park Á∫øÁ®ã</h4><p>park‰πüÊòØËÆ©ÂΩìÂâçÁ∫øÁ®ãÂÅú‰∏ãÊù•<br>ÊâìÊñ≠ park Á∫øÁ®ã, ‰∏ç‰ºöÊ∏ÖÁ©∫ÊâìÊñ≠Áä∂ÊÄÅ</p>
<h3 id="4-5-‰∏çÊé®ËçêÁöÑÊñπÊ≥ï"><a href="#4-5-‰∏çÊé®ËçêÁöÑÊñπÊ≥ï" class="headerlink" title="4.5 ‰∏çÊé®ËçêÁöÑÊñπÊ≥ï"></a>4.5 ‰∏çÊé®ËçêÁöÑÊñπÊ≥ï</h3><p>Ëøô‰∫õÊñπÊ≥ïÂ∑≤ËøáÊó∂ÔºåÂÆπÊòìÁ†¥ÂùèÂêåÊ≠•‰ª£Á†ÅÂùóÔºåÈÄ†ÊàêÁ∫øÁ®ãÊ≠ªÈîÅ</p>
<table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêç</th>
<th>ÂäüËÉΩËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td>stop()</td>
<td>ÂÅúÊ≠¢Á∫øÁ®ãËøêË°å</td>
</tr>
<tr>
<td>suspend()</td>
<td>ÊåÇËµ∑ÔºàÊöÇÂÅúÔºâÁ∫øÁ®ãËøêË°å</td>
</tr>
<tr>
<td>resume()</td>
<td>ÊÅ¢Â§çÁ∫øÁ®ãËøêË°å</td>
</tr>
</tbody></table>
<h2 id="5-‰∏ªÁ∫øÁ®ãÂíåÂÆàÊä§Á∫øÁ®ã"><a href="#5-‰∏ªÁ∫øÁ®ãÂíåÂÆàÊä§Á∫øÁ®ã" class="headerlink" title="5. ‰∏ªÁ∫øÁ®ãÂíåÂÆàÊä§Á∫øÁ®ã"></a>5. ‰∏ªÁ∫øÁ®ãÂíåÂÆàÊä§Á∫øÁ®ã</h2><ul>
<li>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºå<strong>Java ËøõÁ®ãÈúÄË¶ÅÁ≠âÂæÖÊâÄÊúâÁ∫øÁ®ãÈÉΩËøêË°åÁªìÊùüÔºåÊâç‰ºöÁªìÊùü</strong>„ÄÇ</li>
<li>Êúâ‰∏ÄÁßçÁâπÊÆäÁöÑÁ∫øÁ®ãÂè´ÂÅöÂÆàÊä§Á∫øÁ®ãÔºå<strong>Âè™Ë¶ÅÂÖ∂ÂÆÉÈùûÂÆàÊä§Á∫øÁ®ãËøêË°åÁªìÊùü‰∫ÜÔºåÂç≥‰ΩøÂÆàÊä§Á∫øÁ®ãÁöÑ‰ª£Á†ÅÊ≤°ÊúâÊâßË°åÂÆåÔºå‰πü‰ºöÂº∫Âà∂ÁªìÊùü</strong></li>
<li>ÂûÉÂúæÂõûÊî∂Âô®Á∫øÁ®ãÂ∞±ÊòØ‰∏ÄÁßçÂÆàÊä§Á∫øÁ®ã</li>
<li>Tomcat ‰∏≠ÁöÑ Acceptor Âíå Poller Á∫øÁ®ãÈÉΩÊòØÂÆàÊä§Á∫øÁ®ãÔºåÊâÄ‰ª• Tomcat Êé•Êî∂Âà∞ shutdown ÂëΩ‰ª§ÂêéÔºå‰∏ç‰ºöÁ≠âÂæÖÂÆÉ‰ª¨Â§ÑÁêÜÂÆåÂΩìÂâçËØ∑Ê±Ç</li>
</ul>
<h2 id="6-Á∫øÁ®ãÁöÑ‰∫îÁßçÁä∂ÊÄÅ-Êìç‰ΩúÁ≥ªÁªüÂ±ÇÈù¢"><a href="#6-Á∫øÁ®ãÁöÑ‰∫îÁßçÁä∂ÊÄÅ-Êìç‰ΩúÁ≥ªÁªüÂ±ÇÈù¢" class="headerlink" title="6. Á∫øÁ®ãÁöÑ‰∫îÁßçÁä∂ÊÄÅ(Êìç‰ΩúÁ≥ªÁªüÂ±ÇÈù¢)"></a>6. Á∫øÁ®ãÁöÑ‰∫îÁßçÁä∂ÊÄÅ(Êìç‰ΩúÁ≥ªÁªüÂ±ÇÈù¢)</h2><p><img src="/img/blogs/java/jvm-juc/juc.2.4.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>„Äê<strong>ÂàùÂßãÁä∂ÊÄÅ</strong>„Äë‰ªÖÊòØÂú®ËØ≠Ë®ÄÂ±ÇÈù¢<strong>ÂàõÂª∫‰∫ÜÁ∫øÁ®ãÂØπË±°</strong>ÔºåËøòÊú™‰∏éÊìç‰ΩúÁ≥ªÁªüÁ∫øÁ®ãÂÖ≥ËÅî</li>
<li>„Äê<strong>ÂèØËøêË°åÁä∂ÊÄÅ</strong>„ÄëÔºàÂ∞±Áª™Áä∂ÊÄÅÔºâÊåáËØ•Á∫øÁ®ã<strong>Â∑≤ÁªèË¢´ÂàõÂª∫</strong>Ôºà‰∏éÊìç‰ΩúÁ≥ªÁªüÁ∫øÁ®ãÂÖ≥ËÅîÔºâÔºå<strong>ÂèØ‰ª•Áî± CPU Ë∞ÉÂ∫¶ÊâßË°åÔºå‰ΩÜËøòÊ≤°ÊúâË¢´ÂàÜÈÖçÊó∂Èó¥Áâá</strong></li>
<li>„Äê<strong>ËøêË°åÁä∂ÊÄÅ</strong>„ÄëÊåáËé∑Âèñ‰∫Ü CPU Êó∂Èó¥ÁâáËøêË°å‰∏≠ÁöÑÁä∂ÊÄÅ<ul>
<li>ÂΩì CPU Êó∂Èó¥ÁâáÁî®ÂÆåÔºå‰ºö‰ªé„ÄêËøêË°åÁä∂ÊÄÅ„ÄëËΩ¨Êç¢Ëá≥„ÄêÂèØËøêË°åÁä∂ÊÄÅ„ÄëÔºå‰ºöÂØºËá¥Á∫øÁ®ãÁöÑ‰∏ä‰∏ãÊñáÂàáÊç¢</li>
</ul>
</li>
<li>„Äê<strong>ÈòªÂ°ûÁä∂ÊÄÅ</strong>„Äë<ul>
<li>Â¶ÇÊûúË∞ÉÁî®‰∫ÜÈòªÂ°û APIÔºåÂ¶Ç BIO ËØªÂÜôÊñá‰ª∂ÔºåËøôÊó∂ËØ•Á∫øÁ®ãÂÆûÈôÖ‰∏ç‰ºöÁî®Âà∞ CPUÔºå‰ºö<strong>ÂØºËá¥Á∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢</strong>ÔºåËøõÂÖ•„ÄêÈòªÂ°ûÁä∂ÊÄÅ„Äë</li>
<li>Á≠â BIO Êìç‰ΩúÂÆåÊØïÔºå‰ºöÁî±Êìç‰ΩúÁ≥ªÁªüÂî§ÈÜíÈòªÂ°ûÁöÑÁ∫øÁ®ãÔºåËΩ¨Êç¢Ëá≥„ÄêÂèØËøêË°åÁä∂ÊÄÅ„Äë</li>
<li>‰∏é„ÄêÂèØËøêË°åÁä∂ÊÄÅ„ÄëÁöÑÂå∫Âà´ÊòØÔºåÂØπ„ÄêÈòªÂ°ûÁä∂ÊÄÅ„ÄëÁöÑÁ∫øÁ®ãÊù•ËØ¥<strong>Âè™Ë¶ÅÂÆÉ‰ª¨‰∏ÄÁõ¥‰∏çÂî§ÈÜíÔºåË∞ÉÂ∫¶Âô®Â∞±‰∏ÄÁõ¥‰∏ç‰ºöËÄÉËôëË∞ÉÂ∫¶ÂÆÉ‰ª¨</strong></li>
</ul>
</li>
<li>„Äê<strong>ÁªàÊ≠¢Áä∂ÊÄÅ</strong>„ÄëË°®Á§∫Á∫øÁ®ãÂ∑≤ÁªèÊâßË°åÂÆåÊØïÔºåÁîüÂëΩÂë®ÊúüÂ∑≤ÁªèÁªìÊùüÔºå‰∏ç‰ºöÂÜçËΩ¨Êç¢‰∏∫ÂÖ∂ÂÆÉÁä∂ÊÄÅ</li>
</ul>
<h2 id="7-Á∫øÁ®ãÁöÑÂÖ≠ÁßçÁä∂ÊÄÅ-JAVA-APIÂ±ÇÈù¢"><a href="#7-Á∫øÁ®ãÁöÑÂÖ≠ÁßçÁä∂ÊÄÅ-JAVA-APIÂ±ÇÈù¢" class="headerlink" title="7. Á∫øÁ®ãÁöÑÂÖ≠ÁßçÁä∂ÊÄÅ(JAVA APIÂ±ÇÈù¢)"></a>7. Á∫øÁ®ãÁöÑÂÖ≠ÁßçÁä∂ÊÄÅ(JAVA APIÂ±ÇÈù¢)</h2><p>Ê†πÊçÆ Thread.State Êûö‰∏æÔºåÂàÜ‰∏∫ÂÖ≠ÁßçÁä∂ÊÄÅ</p>
<p><img src="/img/blogs/java/jvm-juc/juc.2.5.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><strong>NEW</strong>:  Á∫øÁ®ãÂàöË¢´ÂàõÂª∫Ôºå‰ΩÜÊòØËøòÊ≤°ÊúâË∞ÉÁî® start() ÊñπÊ≥ï</li>
<li><strong>RUNNABLE</strong>:  ÂΩìË∞ÉÁî®‰∫Üstart() ÊñπÊ≥ï‰πãÂêéÔºåÊ≥®ÊÑèÔºåJava API Â±ÇÈù¢ÁöÑ<strong>RUNNABLE Áä∂ÊÄÅÊ∂µÁõñ‰∫ÜÊìç‰ΩúÁ≥ªÁªü Â±ÇÈù¢ÁöÑ„ÄêÂèØËøêË°åÁä∂ÊÄÅ„Äë„ÄÅ„ÄêËøêË°åÁä∂ÊÄÅ„ÄëÂíå„ÄêÈòªÂ°ûÁä∂ÊÄÅ„Äë</strong>ÔºàÁî±‰∫é BIO ÂØºËá¥ÁöÑÁ∫øÁ®ãÈòªÂ°ûÔºåÂú® Java ÈáåÊó†Ê≥ïÂå∫ÂàÜÔºå‰ªçÁÑ∂ËÆ§‰∏∫ÊòØÂèØËøêË°åÔºâ</li>
<li><strong>BLOCKED Ôºå WAITING Ôºå TIMED_WAITING</strong>:  ÈÉΩÊòØ Java API Â±ÇÈù¢ÂØπ„ÄêÈòªÂ°ûÁä∂ÊÄÅ„ÄëÁöÑÁªÜÂàÜ</li>
<li><strong>TERMINATED</strong>:  ÂΩìÁ∫øÁ®ã‰ª£Á†ÅËøêË°åÁªìÊùü</li>
</ul>
<h1 id="‰∏â-ÂÖ±‰∫´Ê®°Âûã‰πãÁÆ°Á®ã"><a href="#‰∏â-ÂÖ±‰∫´Ê®°Âûã‰πãÁÆ°Á®ã" class="headerlink" title="‰∏â. ÂÖ±‰∫´Ê®°Âûã‰πãÁÆ°Á®ã"></a>‰∏â. ÂÖ±‰∫´Ê®°Âûã‰πãÁÆ°Á®ã</h1><h2 id="1-ÂÖ±‰∫´Â∏¶Êù•ÁöÑÈóÆÈ¢ò"><a href="#1-ÂÖ±‰∫´Â∏¶Êù•ÁöÑÈóÆÈ¢ò" class="headerlink" title="1. ÂÖ±‰∫´Â∏¶Êù•ÁöÑÈóÆÈ¢ò"></a>1. ÂÖ±‰∫´Â∏¶Êù•ÁöÑÈóÆÈ¢ò</h2><p>Â§öÁ∫øÁ®ã‰∏ãÔºåÂØπÂÖ±‰∫´ËµÑÊ∫êËÆøÈóÆÂ∏¶Êù•ÁöÑÈóÆÈ¢ò</p>
<h3 id="1-1-‰∏¥ÁïåÂå∫-Critical-Section"><a href="#1-1-‰∏¥ÁïåÂå∫-Critical-Section" class="headerlink" title="1.1 ‰∏¥ÁïåÂå∫ Critical Section"></a>1.1 ‰∏¥ÁïåÂå∫ Critical Section</h3><ul>
<li>‰∏Ä‰∏™Á®ãÂ∫èËøêË°åÂ§ö‰∏™Á∫øÁ®ãÊú¨Ë∫´ÊòØÊ≤°ÊúâÈóÆÈ¢òÁöÑ</li>
<li>ÈóÆÈ¢òÂá∫Âú®<strong>Â§ö‰∏™Á∫øÁ®ãËÆøÈóÆÂÖ±‰∫´ËµÑÊ∫ê</strong><ul>
<li>Â§ö‰∏™Á∫øÁ®ã<strong>ËØªÂÖ±‰∫´ËµÑÊ∫ê</strong>ÂÖ∂ÂÆû‰πüÊ≤°ÊúâÈóÆÈ¢ò</li>
<li>Âú®Â§ö‰∏™Á∫øÁ®ã<strong>ÂØπÂÖ±‰∫´ËµÑÊ∫êËØªÂÜôÊìç‰ΩúÊó∂ÂèëÁîüÊåá‰ª§‰∫§Èîô</strong>ÔºåÂ∞±‰ºöÂá∫Áé∞ÈóÆÈ¢ò</li>
</ul>
</li>
<li>‰∏ÄÊÆµ‰ª£Á†ÅÂùóÂÜÖÂ¶ÇÊûú<strong>Â≠òÂú®ÂØπÂÖ±‰∫´ËµÑÊ∫êÁöÑÂ§öÁ∫øÁ®ãËØªÂÜô</strong>Êìç‰ΩúÔºåÁß∞<strong>ËøôÊÆµ‰ª£Á†ÅÂùó‰∏∫‰∏¥ÁïåÂå∫</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br> <br><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> <br><span class="hljs-comment">// ‰∏¥ÁïåÂå∫</span><br>&#123;    <br>    counter++; <span class="hljs-comment">//counterÂ∞±ÊòØÂÖ±‰∫´ËµÑÊ∫ê</span><br>&#125;<br> <br><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> <br><span class="hljs-comment">// ‰∏¥ÁïåÂå∫</span><br>&#123;    <br>    counter--; <span class="hljs-comment">//counterÂ∞±ÊòØÂÖ±‰∫´ËµÑÊ∫ê</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-Á´ûÊÄÅÊù°‰ª∂-Race-Condition"><a href="#1-2-Á´ûÊÄÅÊù°‰ª∂-Race-Condition" class="headerlink" title="1.2 Á´ûÊÄÅÊù°‰ª∂ Race Condition"></a>1.2 Á´ûÊÄÅÊù°‰ª∂ Race Condition</h3><p>Â§ö‰∏™Á∫øÁ®ãÂú®‰∏¥ÁïåÂå∫ÂÜÖÊâßË°åÔºåÁî±‰∫é<strong>‰ª£Á†ÅÁöÑÊâßË°åÂ∫èÂàó‰∏çÂêåËÄåÂØºËá¥ÁªìÊûúÊó†Ê≥ïÈ¢ÑÊµã</strong>ÔºåÁß∞‰πã‰∏∫ÂèëÁîü‰∫Ü<strong>Á´ûÊÄÅÊù°‰ª∂</strong></p>
<h2 id="2-synchronized-Ëß£ÂÜ≥ÊñπÊ°à"><a href="#2-synchronized-Ëß£ÂÜ≥ÊñπÊ°à" class="headerlink" title="2. synchronized Ëß£ÂÜ≥ÊñπÊ°à"></a>2. synchronized Ëß£ÂÜ≥ÊñπÊ°à</h2><ul>
<li>ÈòªÂ°ûÂºèÁöÑËß£ÂÜ≥ÊñπÊ°àÔºösynchronizedÔºåLock</li>
<li>ÈùûÈòªÂ°ûÂºèÁöÑËß£ÂÜ≥ÊñπÊ°àÔºöÂéüÂ≠êÂèòÈáè</li>
</ul>
<p>synchronizedÔºå‰øóÁß∞„ÄêÂØπË±°ÈîÅ„ÄëÔºåÂÆÉÈááÁî®<strong>‰∫íÊñ•</strong>ÁöÑÊñπÂºèËÆ©<strong>Âêå‰∏ÄÊó∂ÂàªËá≥Â§öÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ã</strong>ËÉΩÊåÅÊúâ„ÄêÂØπË±°ÈîÅ„ÄëÔºåÂÖ∂ÂÆÉÁ∫øÁ®ãÂÜçÊÉ≥Ëé∑ÂèñËøô‰∏™„ÄêÂØπË±°ÈîÅ„ÄëÊó∂Â∞±‰ºöÈòªÂ°û‰Ωè„ÄÇËøôÊ†∑Â∞±ËÉΩ‰øùËØÅÊã•ÊúâÈîÅÁöÑÁ∫øÁ®ãÂèØ‰ª•ÂÆâÂÖ®ÁöÑÊâßË°å‰∏¥ÁïåÂå∫ÂÜÖÁöÑ‰ª£Á†ÅÔºå‰∏çÁî®ÊãÖÂøÉÁ∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢</p>
<h3 id="2-1-synchronizedËØ≠Ê≥ï"><a href="#2-1-synchronizedËØ≠Ê≥ï" class="headerlink" title="2.1 synchronizedËØ≠Ê≥ï"></a>2.1 synchronizedËØ≠Ê≥ï</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span>(ÂØπË±°) <span class="hljs-comment">// Á∫øÁ®ã1Ôºå Á∫øÁ®ã2(blocked)</span><br>&#123;<br>    ‰∏¥ÁïåÂå∫<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Á§∫‰æãÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">room</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>            <span class="hljs-keyword">synchronized</span> (room) &#123;<span class="hljs-comment">//Âä†ÈîÅ</span><br>                counter++;<br>            &#125;<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>            <span class="hljs-keyword">synchronized</span> (room) &#123;<span class="hljs-comment">//Âä†ÈîÅ</span><br>                counter--;<br>            &#125;<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>);<br><br>    t1.start();<br>    t2.start();<br>    t1.join();<br>    t2.join();<br>    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,counter);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-synchronizedÁöÑÂéüÂ≠êÊÄß"><a href="#2-2-synchronizedÁöÑÂéüÂ≠êÊÄß" class="headerlink" title="2.2 synchronizedÁöÑÂéüÂ≠êÊÄß"></a>2.2 synchronizedÁöÑÂéüÂ≠êÊÄß</h3><p>synchronized ÂÆûÈôÖÊòØÁî®<strong>ÂØπË±°ÈîÅ</strong>‰øùËØÅ‰∫Ü<strong>‰∏¥ÁïåÂå∫ÂÜÖ‰ª£Á†ÅÁöÑÂéüÂ≠êÊÄß</strong>Ôºå‰∏¥ÁïåÂå∫ÂÜÖÁöÑ‰ª£Á†ÅÂØπÂ§ñÊòØ<strong>‰∏çÂèØÂàÜÂâ≤ÁöÑ</strong>Ôºå‰∏ç‰ºöË¢´Á∫øÁ®ãÂàáÊç¢ÊâÄÊâìÊñ≠„ÄÇ</p>
<h3 id="2-3-Èù¢ÂêëÂØπË±°ÁöÑÊîπËøõ"><a href="#2-3-Èù¢ÂêëÂØπË±°ÁöÑÊîπËøõ" class="headerlink" title="2.3 Èù¢ÂêëÂØπË±°ÁöÑÊîπËøõ"></a>2.3 Èù¢ÂêëÂØπË±°ÁöÑÊîπËøõ</h3><p>ÊääÈúÄË¶Å‰øùÊä§ÁöÑÂÖ±‰∫´ÂèòÈáèÊîæÂÖ•‰∏Ä‰∏™Á±ªÔºåÂ∞ÅË£ÖÊàê‰∏Ä‰∏™Á±ª</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Room</span> &#123;<br>      <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> &#123;<br>          <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>              value++;<br>          &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> &#123;<br>          <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>              value--;<br>          &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>          <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>              <span class="hljs-keyword">return</span> value;<br>          &#125;<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure>
<p>Ë∞ÉÁî®Ôºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">Room</span> <span class="hljs-variable">room</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Room</span>();<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">5000</span>; j++) &#123;<br>                room.increment();<br>                &#125;<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br> <br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">5000</span>; j++) &#123;<br>                room.decrement();<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t2&quot;</span>);<br>        t1.start();<br>        t2.start();<br> <br>        t1.join();<br>        t2.join();<br>        log.debug(<span class="hljs-string">&quot;count: &#123;&#125;&quot;</span> , room.get());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-ÊñπÊ≥ï‰∏äÁöÑ-synchronized"><a href="#3-ÊñπÊ≥ï‰∏äÁöÑ-synchronized" class="headerlink" title="3. ÊñπÊ≥ï‰∏äÁöÑ synchronized"></a>3. ÊñπÊ≥ï‰∏äÁöÑ synchronized</h2><ul>
<li>Âä†Âú®ÊñπÊ≥ï‰∏äÁöÑÈîÅÔºå‰∏ç‰ª£Ë°®ÈîÅÁöÑÊòØÊñπÊ≥ïÔºåËÄåÊòØÈîÅÁöÑ<strong>ÊñπÊ≥ï‰∏≠ÁöÑthisÂØπË±°</strong></li>
<li>Âä†Âú®ÈùôÊÄÅÊñπÊ≥ï(static)‰∏äÁöÑÈîÅÔºå‰∏ç‰ª£Ë°®ÈîÅÁöÑÊòØÊñπÊ≥ïÔºåËÄåÊòØÈîÅÁöÑ<strong>ÈùôÊÄÅÊñπÊ≥ïÁöÑÁ±ªÂØπË±°</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>    <br>    &#125;<br>&#125;<br><span class="hljs-comment">//Á≠â‰ª∑‰∫é</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) &#123;<br>        <br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br> <br>    &#125;<br>&#125;<br><span class="hljs-comment">//Á≠â‰ª∑‰∫é</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span>(Test.class) &#123;<br>            <br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4-ÂèòÈáèÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÂàÜÊûê"><a href="#4-ÂèòÈáèÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÂàÜÊûê" class="headerlink" title="4. ÂèòÈáèÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÂàÜÊûê"></a>4. ÂèòÈáèÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÂàÜÊûê</h2><h3 id="4-1-ÊàêÂëòÂèòÈáèÂíåÈùôÊÄÅÂèòÈáèÊòØÂê¶Á∫øÁ®ãÂÆâÂÖ®Ôºü"><a href="#4-1-ÊàêÂëòÂèòÈáèÂíåÈùôÊÄÅÂèòÈáèÊòØÂê¶Á∫øÁ®ãÂÆâÂÖ®Ôºü" class="headerlink" title="4.1 ÊàêÂëòÂèòÈáèÂíåÈùôÊÄÅÂèòÈáèÊòØÂê¶Á∫øÁ®ãÂÆâÂÖ®Ôºü"></a>4.1 ÊàêÂëòÂèòÈáèÂíåÈùôÊÄÅÂèòÈáèÊòØÂê¶Á∫øÁ®ãÂÆâÂÖ®Ôºü</h3><ul>
<li>Â¶ÇÊûúÂÆÉ‰ª¨<strong>Ê≤°ÊúâÂÖ±‰∫´ÔºåÂàôÁ∫øÁ®ãÂÆâÂÖ®</strong></li>
<li>Â¶ÇÊûúÂÆÉ‰ª¨Ë¢´<strong>ÂÖ±‰∫´‰∫Ü</strong>ÔºåÊ†πÊçÆÂÆÉ‰ª¨ÁöÑÁä∂ÊÄÅÊòØÂê¶ËÉΩÂ§üÊîπÂèòÔºåÂèàÂàÜ‰∏§ÁßçÊÉÖÂÜµ<ul>
<li>Â¶ÇÊûú<strong>Âè™ÊúâËØªÊìç‰Ωú</strong>ÔºåÂàôÁ∫øÁ®ãÂÆâÂÖ®</li>
<li>Â¶ÇÊûú<strong>ÊúâËØªÂÜôÊìç‰Ωú</strong>ÔºåÂàôËøôÊÆµ‰ª£Á†ÅÊòØ<strong>‰∏¥ÁïåÂå∫</strong>ÔºåÈúÄË¶ÅËÄÉËôëÁ∫øÁ®ãÂÆâÂÖ®</li>
</ul>
</li>
</ul>
<h3 id="4-2-Â±ÄÈÉ®ÂèòÈáèÊòØÂê¶Á∫øÁ®ãÂÆâÂÖ®Ôºü"><a href="#4-2-Â±ÄÈÉ®ÂèòÈáèÊòØÂê¶Á∫øÁ®ãÂÆâÂÖ®Ôºü" class="headerlink" title="4.2 Â±ÄÈÉ®ÂèòÈáèÊòØÂê¶Á∫øÁ®ãÂÆâÂÖ®Ôºü"></a>4.2 Â±ÄÈÉ®ÂèòÈáèÊòØÂê¶Á∫øÁ®ãÂÆâÂÖ®Ôºü</h3><ul>
<li>Â±ÄÈÉ®ÂèòÈáèÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ</li>
<li>‰ΩÜÂ±ÄÈÉ®ÂèòÈáè<strong>ÂºïÁî®ÁöÑÂØπË±°</strong>ÂàôÊú™ÂøÖ<ul>
<li>Â¶ÇÊûúËØ•ÂØπË±°<strong>Ê≤°ÊúâÈÄÉÁ¶ªÊñπÊ≥ïÁöÑ‰ΩúÁî®ËÆøÈóÆ</strong>ÔºåÂÆÉÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ</li>
<li>Â¶ÇÊûúËØ•ÂØπË±°<strong>ÈÄÉÁ¶ªÊñπÊ≥ïÁöÑ‰ΩúÁî®ËåÉÂõ¥ÔºåÈúÄË¶ÅËÄÉËôëÁ∫øÁ®ãÂÆâÂÖ®</strong></li>
</ul>
</li>
<li>Â±ÄÈÉ®ÂèòÈáèÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ: Âõ†‰∏∫ÊØè‰∏™Á∫øÁ®ãÈÉΩ‰ºöÂàÜÈÖç‰∏ÄÂùóÊ†àÂ∏ßÁ©∫Èó¥Áî®Êù•Â≠òÊîæÂ±ÄÈÉ®ÂèòÈáèÔºå<strong>ÊòØÁã¨Á´ãÁöÑÔºå‰∏ç‰ºöË¢´ÂÖ∂‰ªñÁ∫øÁ®ãÊâÄÂÖ±‰∫´</strong></li>
</ul>
<h3 id="4-3-Â∏∏ËßÅÁ∫øÁ®ãÂÆâÂÖ®Á±ª"><a href="#4-3-Â∏∏ËßÅÁ∫øÁ®ãÂÆâÂÖ®Á±ª" class="headerlink" title="4.3 Â∏∏ËßÅÁ∫øÁ®ãÂÆâÂÖ®Á±ª"></a>4.3 Â∏∏ËßÅÁ∫øÁ®ãÂÆâÂÖ®Á±ª</h3><ul>
<li>String</li>
<li>Integer</li>
<li>StringBuffer</li>
<li>Random</li>
<li>Vector</li>
<li>Hashtable</li>
<li>java.util.concurrent ÂåÖ‰∏ãÁöÑÁ±ª</li>
</ul>
<p>ËøôÈáåËØ¥ÂÆÉ‰ª¨ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÊòØÊåáÔºåÂ§ö‰∏™Á∫øÁ®ãË∞ÉÁî®ÂÆÉ‰ª¨<strong>Âêå‰∏Ä‰∏™ÂÆû‰æãÁöÑÊüê‰∏™ÊñπÊ≥ï</strong>Êó∂Ôºå<strong>ÊòØÁ∫øÁ®ãÂÆâÂÖ®</strong>ÁöÑÔºåÂÆÉ‰ª¨ÁöÑ<strong>ÊØè‰∏™ÊñπÊ≥ïÊòØÂéüÂ≠êÁöÑ</strong><br>‰ΩÜÊ≥®ÊÑèÂÆÉ‰ª¨<strong>Â§ö‰∏™ÊñπÊ≥ïÁöÑÁªÑÂêà‰∏çÊòØÂéüÂ≠êÁöÑ</strong>ÔºåÁ∫øÁ®ãÂÆâÂÖ®Á±ªÊñπÊ≥ïÁöÑÁªÑÂêà‰∏ç‰∏ÄÂÆöÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ</p>
<ul>
<li><strong>‰∏çÂèØÂèòÁ±ª</strong>Á∫øÁ®ãÂÆâÂÖ®ÊÄß (<strong>Âè™ËÉΩËØªÔºå‰∏çËÉΩÊîπÔºåÊâÄ‰ª•Á∫øÁ®ãÂÆâÂÖ®</strong>)<ul>
<li>String„ÄÅInteger Á≠âÈÉΩÊòØ‰∏çÂèØÂèòÁ±ªÔºåÂõ†‰∏∫<strong>ÂÖ∂ÂÜÖÈÉ®ÁöÑÁä∂ÊÄÅ‰∏çÂèØ‰ª•ÊîπÂèò</strong>ÔºåÂõ†Ê≠§ÂÆÉ‰ª¨ÁöÑÊñπÊ≥ïÈÉΩÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ</li>
</ul>
</li>
</ul>
<h2 id="5-Monitor-ÈîÅ"><a href="#5-Monitor-ÈîÅ" class="headerlink" title="5. Monitor(ÈîÅ)"></a>5. Monitor(ÈîÅ)</h2><h3 id="5-1-Java-ÂØπË±°Â§¥"><a href="#5-1-Java-ÂØπË±°Â§¥" class="headerlink" title="5.1 Java ÂØπË±°Â§¥"></a>5.1 Java ÂØπË±°Â§¥</h3><p>ÊôÆÈÄöÂØπË±°ÁöÑÂØπË±°Â§¥Ôºö</p>
<p><img src="/img/blogs/java/jvm-juc/juc.3.1.png" srcset="/img/loading.gif" lazyload></p>
<p>ÂÖ∂‰∏≠ÁöÑMark WordÁªìÊûÑÔºö</p>
<p><img src="/img/blogs/java/jvm-juc/juc.3.2.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="5-2-Monitor-ÂéüÁêÜ"><a href="#5-2-Monitor-ÂéüÁêÜ" class="headerlink" title="5.2 Monitor ÂéüÁêÜ"></a>5.2 Monitor ÂéüÁêÜ</h3><ul>
<li>Monitor Ë¢´ÁøªËØë‰∏∫ÁõëËßÜÂô®ÊàñËÄÖËØ¥<strong>ÁÆ°Á®ã</strong></li>
<li><strong>ÊØè‰∏™ java ÂØπË±°ÈÉΩÂèØ‰ª•ÂÖ≥ËÅî‰∏Ä‰∏™ Monitor</strong> ÔºåÂ¶ÇÊûú‰ΩøÁî® synchronized ÁªôÂØπË±°‰∏äÈîÅÔºàÈáçÈáèÁ∫ßÔºâÔºåËØ•ÂØπË±°Â§¥ÁöÑ Mark Word ‰∏≠Â∞±Ë¢´ËÆæÁΩÆ‰∏∫ÊåáÂêë Monitor ÂØπË±°ÁöÑÊåáÈíà„ÄÇ</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.3.3.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li>ÂàöÂºÄÂßãÊó∂ Monitor ‰∏≠ÁöÑ Owner ‰∏∫ null</li>
<li>ÂΩì Thread-2 ÊâßË°å synchronized(obj){} ‰ª£Á†ÅÊó∂Â∞±‰ºöÂ∞Ü Monitor ÁöÑÊâÄÊúâËÄÖOwner ËÆæÁΩÆ‰∏∫ Thread-2Ôºå‰∏äÈîÅÊàêÂäüÔºåMonitor ‰∏≠Âêå‰∏ÄÊó∂ÂàªÂè™ËÉΩÊúâ‰∏Ä‰∏™ Owner</li>
<li>ÂΩì Thread-2 Âç†ÊçÆÈîÅÊó∂ÔºåÂ¶ÇÊûúÁ∫øÁ®ã Thread-3 ÔºåThread-4 ‰πüÊù•ÊâßË°åsynchronized(obj){} ‰ª£Á†ÅÔºåÂ∞±‰ºöËøõÂÖ• EntryListÔºàÈòªÂ°ûÈòüÂàóÔºâ ‰∏≠ÂèòÊàêBLOCKEDÔºàÈòªÂ°ûÔºâ Áä∂ÊÄÅ</li>
<li>Thread-2 ÊâßË°åÂÆåÂêåÊ≠•‰ª£Á†ÅÂùóÁöÑÂÜÖÂÆπÔºåÁÑ∂ÂêéÂî§ÈÜí EntryList ‰∏≠Á≠âÂæÖÁöÑÁ∫øÁ®ãÊù•Á´û‰∫âÈîÅÔºåÁ´û‰∫âÊó∂ÊòØÈùûÂÖ¨Âπ≥ÁöÑ</li>
<li>Âõæ‰∏≠ WaitSet ‰∏≠ÁöÑ Thread-0ÔºåThread-1 ÊòØ‰πãÂâçËé∑ÂæóËøáÈîÅÔºå‰ΩÜÊù°‰ª∂‰∏çÊª°Ë∂≥ËøõÂÖ• WAITING Áä∂ÊÄÅÁöÑÁ∫øÁ®ã</li>
</ol>
<h2 id="6-synchronized-ÂéüÁêÜËøõÈò∂"><a href="#6-synchronized-ÂéüÁêÜËøõÈò∂" class="headerlink" title="6. synchronized ÂéüÁêÜËøõÈò∂"></a>6. synchronized ÂéüÁêÜËøõÈò∂</h2><h3 id="6-1-ËΩªÈáèÁ∫ßÈîÅ"><a href="#6-1-ËΩªÈáèÁ∫ßÈîÅ" class="headerlink" title="6.1 ËΩªÈáèÁ∫ßÈîÅ"></a>6.1 ËΩªÈáèÁ∫ßÈîÅ</h3><p>ËΩªÈáèÁ∫ßÈîÅÁöÑ‰ΩøÁî®Âú∫ÊôØ</p>
<ul>
<li>Â¶ÇÊûú‰∏Ä‰∏™ÂØπË±°ËôΩÁÑ∂ÊúâÂ§ö‰∏™Á∫øÁ®ãË¶ÅÂØπÂÆÉËøõË°åÂä†ÈîÅÔºå‰ΩÜÊòØ<strong>Âä†ÈîÅÁöÑÊó∂Èó¥ÊòØÈîôÂºÄÁöÑ</strong>Ôºà‰πüÂ∞±ÊòØÊ≤°Êúâ‰∫∫ÂèØ‰ª•Á´û‰∫âÁöÑÔºâÔºåÈÇ£‰πàÂèØ‰ª•‰ΩøÁî®ËΩªÈáèÁ∫ßÈîÅÊù•ËøõË°å‰ºòÂåñ„ÄÇ</li>
<li>ËΩªÈáèÁ∫ßÈîÅÂØπ‰ΩøÁî®ËÄÖÊòØÈÄèÊòéÁöÑÔºåÂç≥ËØ≠Ê≥ï‰ªçÁÑ∂ÊòØ synchronized</li>
</ul>
<ol>
<li>ÊØèÊ¨°ÊåáÂêëÂà∞ synchronized ‰ª£Á†ÅÂùóÊó∂ÔºåÈÉΩ‰ºöÂàõÂª∫ÈîÅËÆ∞ÂΩïÔºàLock RecordÔºâÂØπË±°ÔºåÊØè‰∏™Á∫øÁ®ãÈÉΩ‰ºöÂåÖÊã¨‰∏Ä‰∏™ÈîÅËÆ∞ÂΩïÁöÑÁªìÊûÑÔºåÈîÅËÆ∞ÂΩïÂÜÖÈÉ®ÂèØ‰ª•ÂÇ®Â≠òÂØπË±°ÁöÑ Mark Word ÂíåÂØπË±°ÂºïÁî® reference</li>
<li>ËÆ©ÈîÅËÆ∞ÂΩï‰∏≠ÁöÑ Object reference ÊåáÂêëÂØπË±°ÔºåÂπ∂‰∏îÂ∞ùËØïÁî® cas(compare and sweep) ÊõøÊç¢ Object ÂØπË±°ÁöÑ Mark Word ÔºåÂ∞Ü Mark Word ÁöÑÂÄºÂ≠òÂÖ•ÈîÅËÆ∞ÂΩï‰∏≠„ÄÇ</li>
<li>Â¶ÇÊûú cas ÊõøÊç¢ÊàêÂäüÔºåÈÇ£‰πàÂØπË±°ÁöÑÂØπË±°Â§¥ÂÇ®Â≠òÁöÑÂ∞±ÊòØÈîÅËÆ∞ÂΩïÁöÑÂú∞ÂùÄÂíåÁä∂ÊÄÅ 00 Ë°®Á§∫ËΩªÈáèÁ∫ßÈîÅ</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.3.4.png" srcset="/img/loading.gif" lazyload></p>
<ol start="4">
<li>Â¶ÇÊûúcasÂ§±Ë¥•ÔºåÊúâ‰∏§ÁßçÊÉÖÂÜµ<ul>
<li>Â¶ÇÊûúÊòØÂÖ∂ÂÆÉÁ∫øÁ®ãÂ∑≤ÁªèÊåÅÊúâ‰∫ÜËØ• Object ÁöÑËΩªÈáèÁ∫ßÈîÅÔºåÈÇ£‰πàË°®Á§∫ÊúâÁ´û‰∫âÔºåÈ¶ñÂÖà‰ºöËøõË°åËá™ÊóãÈîÅÔºåËá™Êóã‰∏ÄÂÆöÊ¨°Êï∞ÂêéÔºåÂ¶ÇÊûúËøòÊòØÂ§±Ë¥•Â∞±ËøõÂÖ•ÈîÅËÜ®ËÉÄÈò∂ÊÆµ„ÄÇ</li>
<li>Â¶ÇÊûúÊòØËá™Â∑±ÁöÑÁ∫øÁ®ãÂ∑≤ÁªèÊâßË°å‰∫Ü synchronized ËøõË°åÂä†ÈîÅÔºåÈÇ£‰πàÂÜçÊ∑ªÂä†‰∏ÄÊù° Lock Record ‰Ωú‰∏∫ÈáçÂÖ•ÁöÑËÆ°Êï∞„ÄÇ</li>
</ul>
</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.3.5.png" srcset="/img/loading.gif" lazyload></p>
<ol start="5">
<li>ÂΩìÁ∫øÁ®ãÈÄÄÂá∫ synchronized ‰ª£Á†ÅÂùóÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúËé∑ÂèñÁöÑÊòØÂèñÂÄº‰∏∫ null ÁöÑÈîÅËÆ∞ÂΩïÔºåË°®Á§∫ÊúâÈáçÂÖ•ÔºåËøôÊó∂ÈáçÁΩÆÈîÅËÆ∞ÂΩïÔºåË°®Á§∫ÈáçÂÖ•ËÆ°Êï∞Âáè‰∏Ä</li>
<li>ÂΩìÁ∫øÁ®ãÈÄÄÂá∫ synchronized ‰ª£Á†ÅÂùóÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúËé∑ÂèñÁöÑÈîÅËÆ∞ÂΩïÂèñÂÄº‰∏ç‰∏∫ nullÔºåÈÇ£‰πà‰ΩøÁî® cas Â∞Ü Mark Word ÁöÑÂÄºÊÅ¢Â§çÁªôÂØπË±°<ul>
<li>ÊàêÂäüÂàôËß£ÈîÅÊàêÂäü</li>
<li>Â§±Ë¥•ÔºåÂàôËØ¥ÊòéËΩªÈáèÁ∫ßÈîÅËøõË°å‰∫ÜÈîÅËÜ®ËÉÄÊàñÂ∑≤ÁªèÂçáÁ∫ß‰∏∫ÈáçÈáèÁ∫ßÈîÅÔºåËøõÂÖ•ÈáçÈáèÁ∫ßÈîÅËß£ÈîÅÊµÅÁ®ã</li>
</ul>
</li>
</ol>
<h3 id="6-2-ÈîÅËÜ®ËÉÄ"><a href="#6-2-ÈîÅËÜ®ËÉÄ" class="headerlink" title="6.2 ÈîÅËÜ®ËÉÄ"></a>6.2 ÈîÅËÜ®ËÉÄ</h3><p>Â¶ÇÊûúÂú®Â∞ùËØïÂä†ËΩªÈáèÁ∫ßÈîÅÁöÑËøáÁ®ã‰∏≠Ôºåcas Êìç‰ΩúÊó†Ê≥ïÊàêÂäüÔºåËøôÊòØÊúâ‰∏ÄÁßçÊÉÖÂÜµÂ∞±ÊòØÂÖ∂ÂÆÉÁ∫øÁ®ãÂ∑≤Áªè‰∏∫Ëøô‰∏™ÂØπË±°Âä†‰∏ä‰∫ÜËΩªÈáèÁ∫ßÈîÅÔºåËøôÊòØÂ∞±Ë¶Å<strong>ËøõË°åÈîÅËÜ®ËÉÄÔºåÂ∞ÜËΩªÈáèÁ∫ßÈîÅÂèòÊàêÈáçÈáèÁ∫ßÈîÅ</strong></p>
<p><img src="/img/blogs/java/jvm-juc/juc.3.6.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li>ÂΩì Thread-1 ËøõË°åËΩªÈáèÁ∫ßÂä†ÈîÅÊó∂ÔºåThread-0 Â∑≤ÁªèÂØπËØ•ÂØπË±°Âä†‰∫ÜËΩªÈáèÁ∫ßÈîÅ</li>
<li>ËøôÊó∂ Thread-1 Âä†ËΩªÈáèÁ∫ßÈîÅÂ§±Ë¥•ÔºåËøõÂÖ•ÈîÅËÜ®ËÉÄÊµÅÁ®ãÔºå</li>
</ol>
<ul>
<li>Âç≥‰∏∫ÂØπË±°Áî≥ËØ∑MonitorÈîÅÔºåËÆ©ObjectÊåáÂêëÈáçÈáèÁ∫ßÈîÅÂú∞ÂùÄ</li>
<li>ÁÑ∂ÂêéËá™Â∑±ËøõÂÖ•Monitor ÁöÑEntryList ÂèòÊàêBLOCKEDÁä∂ÊÄÅ</li>
</ul>
<ol start="3">
<li>ÂΩì Thread-0 ÈÄÄÂá∫ synchronized ÂêåÊ≠•ÂùóÊó∂Ôºå‰ΩøÁî® cas Â∞Ü Mark Word ÁöÑÂÄºÊÅ¢Â§çÁªôÂØπË±°Â§¥ÔºåÂØπË±°ÁöÑÂØπË±°Â§¥ÊåáÂêë MonitorÔºåÈÇ£‰πà‰ºöËøõÂÖ•ÈáçÈáèÁ∫ßÈîÅÁöÑËß£ÈîÅËøáÁ®ãÔºåÂç≥ÊåâÁÖß Monitor ÁöÑÂú∞ÂùÄÊâæÂà∞ Monitor ÂØπË±°ÔºåÂ∞Ü Owner ËÆæÁΩÆ‰∏∫ null ÔºåÂî§ÈÜí EntryList ‰∏≠ÁöÑ Thread-1 Á∫øÁ®ã</li>
</ol>
<h3 id="6-3-Ëá™Êóã‰ºòÂåñ"><a href="#6-3-Ëá™Êóã‰ºòÂåñ" class="headerlink" title="6.3 Ëá™Êóã‰ºòÂåñ"></a>6.3 Ëá™Êóã‰ºòÂåñ</h3><p>ÈáçÈáèÁ∫ßÈîÅÁ´û‰∫âÁöÑÊó∂ÂÄôÔºåËøòÂèØ‰ª•‰ΩøÁî®Ëá™ÊóãÔºàÂæ™ÁéØÔºâÊù•ËøõË°å‰ºòÂåñÔºåÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãËá™ÊóãÊàêÂäüÔºàÂç≥Âú®Ëá™ÊóãÁöÑÊó∂ÂÄôÊåÅÈîÅÁöÑÁ∫øÁ®ãÈáäÊîæ‰∫ÜÈîÅÔºâÔºåÈÇ£‰πàÂΩìÂâçÁ∫øÁ®ãÂ∞±ÂèØ‰ª•‰∏çÁî®ËøõË°å‰∏ä‰∏ãÊñáÂàáÊç¢Â∞±Ëé∑Âæó‰∫ÜÈîÅ</p>
<h3 id="6-4-ÂÅèÂêëÈîÅ"><a href="#6-4-ÂÅèÂêëÈîÅ" class="headerlink" title="6.4 ÂÅèÂêëÈîÅ"></a>6.4 ÂÅèÂêëÈîÅ</h3><p>Âú®ËΩªÈáèÁ∫ßÁöÑÈîÅ‰∏≠ÔºåÂ¶ÇÊûúÂêå‰∏Ä‰∏™Á∫øÁ®ãÂØπÂêå‰∏Ä‰∏™ÂØπË±°ËøõË°å<strong>ÈáçÂÖ•</strong>ÈîÅÊó∂Ôºå‰πüÈúÄË¶ÅÊâßË°å CAS Êìç‰Ωú</p>
<ul>
<li>ÂÅèÂêëÈîÅÔºöÂè™ÊúâÁ¨¨‰∏ÄÊ¨°‰ΩøÁî® CAS Êó∂Â∞ÜÂØπË±°ÁöÑ Mark Word Â§¥ËÆæÁΩÆ‰∏∫ÂÅèÂêëÁ∫øÁ®ã IDÔºå‰πãÂêéËøô‰∏™ÂÖ•ÈîÅÁ∫øÁ®ãÂÜçËøõË°åÈáçÂÖ•ÈîÅÊó∂ÔºåÂèëÁé∞Á∫øÁ®ã ID ÊòØËá™Â∑±ÁöÑÔºåÈÇ£‰πàÂ∞±‰∏çÁî®ÂÜçËøõË°åCAS‰∫Ü„ÄÇ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m1</span><span class="hljs-params">()</span> &#123;<br>	<span class="hljs-keyword">synchronized</span>(obj) &#123;<br>		<span class="hljs-comment">// ÂêåÊ≠•Âùó A</span><br>		m2();<br>	&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m2</span><span class="hljs-params">()</span> &#123;<br>	<span class="hljs-keyword">synchronized</span>(obj) &#123;<br>		<span class="hljs-comment">// ÂêåÊ≠•Âùó B</span><br>		m3();<br>	&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">m3</span><span class="hljs-params">()</span> &#123;<br>	<span class="hljs-keyword">synchronized</span>(obj) &#123;<br>		<span class="hljs-comment">// ÂêåÊ≠•Âùó C</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/img/blogs/java/jvm-juc/juc.3.7.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="6-4-1-ÂÅèÂêëÁä∂ÊÄÅ"><a href="#6-4-1-ÂÅèÂêëÁä∂ÊÄÅ" class="headerlink" title="6.4.1 ÂÅèÂêëÁä∂ÊÄÅ"></a>6.4.1 ÂÅèÂêëÁä∂ÊÄÅ</h4><p>‰∏Ä‰∏™ÂØπË±°ÁöÑÂàõÂª∫ËøáÁ®ã</p>
<ul>
<li>Â¶ÇÊûúÂºÄÂêØ‰∫ÜÂÅèÂêëÈîÅÔºàÈªòËÆ§ÊòØÂºÄÂêØÁöÑÔºâÔºåÈÇ£‰πàÂØπË±°ÂàöÂàõÂª∫‰πãÂêéÔºå<strong>Mark Word ÊúÄÂêé‰∏â‰ΩçÁöÑÂÄº101</strong>ÔºåÂπ∂‰∏îËøôÊòØÂÆÉÁöÑ ThreadÔºåepochÔºåage ÈÉΩÊòØ 0 ÔºåÂú®Âä†ÈîÅÁöÑÊó∂ÂÄôËøõË°åËÆæÁΩÆËøô‰∫õÁöÑÂÄº.</li>
<li><strong>ÂÅèÂêëÈîÅÈªòËÆ§ÊòØÂª∂ËøüÁöÑ</strong>Ôºå‰∏ç‰ºöÂú®Á®ãÂ∫èÂêØÂä®ÁöÑÊó∂ÂÄôÁ´ãÂàªÁîüÊïà</li>
</ul>
<h4 id="6-4-2-Êí§ÈîÄÂÅèÂêë"><a href="#6-4-2-Êí§ÈîÄÂÅèÂêë" class="headerlink" title="6.4.2 Êí§ÈîÄÂÅèÂêë"></a>6.4.2 Êí§ÈîÄÂÅèÂêë</h4><p>‰ª•‰∏ãÂá†ÁßçÊÉÖÂÜµ‰ºö‰ΩøÂØπË±°ÁöÑÂÅèÂêëÈîÅÂ§±Êïà</p>
<ul>
<li>Ë∞ÉÁî®ÂØπË±°ÁöÑ hashCode ÊñπÊ≥ï</li>
<li>Â§ö‰∏™Á∫øÁ®ã‰ΩøÁî®ËØ•ÂØπË±°</li>
<li>Ë∞ÉÁî®‰∫Ü wait&#x2F;notify ÊñπÊ≥ïÔºàË∞ÉÁî®waitÊñπÊ≥ï‰ºöÂØºËá¥ÈîÅËÜ®ËÉÄËÄå‰ΩøÁî®ÈáçÈáèÁ∫ßÈîÅÔºâ</li>
</ul>
<h4 id="6-4-3-ÊâπÈáèÈáçÂÅèÂêë"><a href="#6-4-3-ÊâπÈáèÈáçÂÅèÂêë" class="headerlink" title="6.4.3 ÊâπÈáèÈáçÂÅèÂêë"></a>6.4.3 ÊâπÈáèÈáçÂÅèÂêë</h4><p>Â¶ÇÊûúÂØπË±°ËôΩÁÑ∂Ë¢´Â§ö‰∏™Á∫øÁ®ãËÆøÈóÆÔºå‰ΩÜÊòØÁ∫øÁ®ãÈó¥‰∏çÂ≠òÂú®Á´û‰∫âÔºåËøôÊó∂<strong>ÂÅèÂêë t1 ÁöÑÂØπË±°‰ªçÊúâÊú∫‰ºöÈáçÊñ∞ÂÅèÂêë t2</strong></p>
<ul>
<li>ÈáçÂÅèÂêë‰ºöÈáçÁΩÆThread ID<br>ÂΩìÊí§ÈîÄË∂ÖËøá20Ê¨°ÂêéÔºà<strong>Ë∂ÖËøáÈòàÂÄº</strong>ÔºâÔºåJVM ‰ºöËßâÂæóÊòØ‰∏çÊòØÂÅèÂêëÈîô‰∫ÜÔºåËøôÊó∂‰ºöÂú®ÁªôÂØπË±°Âä†ÈîÅÊó∂Ôºå<strong>ÈáçÊñ∞ÂÅèÂêëËá≥Âä†ÈîÅÁ∫øÁ®ã</strong>„ÄÇ</li>
</ul>
<h4 id="6-4-4-ÊâπÈáèÊí§ÈîÄ"><a href="#6-4-4-ÊâπÈáèÊí§ÈîÄ" class="headerlink" title="6.4.4 ÊâπÈáèÊí§ÈîÄ"></a>6.4.4 ÊâπÈáèÊí§ÈîÄ</h4><p>ÂΩìÊí§ÈîÄÂÅèÂêëÈîÅÁöÑ<strong>ÈòàÂÄºË∂ÖËøá 40 ‰ª•Âêé</strong>ÔºåÂ∞±‰ºöÂ∞Ü<strong>Êï¥‰∏™Á±ª</strong>ÁöÑÂØπË±°<strong>ÈÉΩÊîπ‰∏∫‰∏çÂèØÂÅèÂêëÁöÑ</strong></p>
<h2 id="7-wait-notify"><a href="#7-wait-notify" class="headerlink" title="7. wait notify"></a>7. wait notify</h2><h3 id="7-1-wait-notify-API‰ªãÁªç"><a href="#7-1-wait-notify-API‰ªãÁªç" class="headerlink" title="7.1 wait notify API‰ªãÁªç"></a>7.1 wait notify API‰ªãÁªç</h3><ul>
<li>obj.wait()  ËÆ©ËøõÂÖ• object ÁõëËßÜÂô®ÁöÑÁ∫øÁ®ãÂà∞ waitSet Á≠âÂæÖ</li>
<li>obj.notify()  Âú® object ‰∏äÊ≠£Âú® waitSet Á≠âÂæÖÁöÑÁ∫øÁ®ã‰∏≠Êåë‰∏Ä‰∏™Âî§ÈÜí </li>
<li>obj.notifyAll()  ËÆ© object ‰∏äÊ≠£Âú® waitSet Á≠âÂæÖÁöÑÁ∫øÁ®ãÂÖ®ÈÉ®Âî§ÈÜí</li>
</ul>
<p>ÂÆÉ‰ª¨ÈÉΩÊòØÁ∫øÁ®ã‰πãÈó¥ËøõË°åÂçè‰ΩúÁöÑÊâãÊÆµÔºåÈÉΩÂ±û‰∫é Object ÂØπË±°ÁöÑÊñπÊ≥ï„ÄÇ<strong>ÂøÖÈ°ªËé∑ÂæóÊ≠§ÂØπË±°ÁöÑÈîÅÔºåÊâçËÉΩË∞ÉÁî®ËøôÂá†‰∏™ÊñπÊ≥ï</strong></p>
<ul>
<li>wait()  ÊñπÊ≥ï‰ºöÈáäÊîæÂØπË±°ÁöÑÈîÅÔºåËøõÂÖ• WaitSet Á≠âÂæÖÂå∫Ôºå‰ªéËÄåËÆ©ÂÖ∂‰ªñÁ∫øÁ®ãÂ∞±Êú∫‰ºöËé∑ÂèñÂØπË±°ÁöÑÈîÅ„ÄÇÊó†ÈôêÂà∂Á≠âÂæÖÔºåÁõ¥Âà∞notify ‰∏∫Ê≠¢</li>
<li>wait(long n)  ÊúâÊó∂ÈôêÁöÑÁ≠âÂæÖ, Âà∞ n ÊØ´ÁßíÂêéÁªìÊùüÁ≠âÂæÖÔºåÊàñÊòØË¢´ notify</li>
</ul>
<p>‰ΩøÁî®Á§∫‰æãÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br> <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">synchronized</span> (obj) &#123;<br>            log.debug(<span class="hljs-string">&quot;ÊâßË°å....&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                obj.wait(); <span class="hljs-comment">// ËÆ©Á∫øÁ®ãÂú®obj‰∏ä‰∏ÄÁõ¥Á≠âÂæÖ‰∏ãÂéª</span><br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>            log.debug(<span class="hljs-string">&quot;ÂÖ∂ÂÆÉ‰ª£Á†Å....&quot;</span>);<br>        &#125;<br>    &#125;).start();<br> <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">synchronized</span> (obj) &#123;<br>            log.debug(<span class="hljs-string">&quot;ÊâßË°å....&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                obj.wait(); <span class="hljs-comment">// ËÆ©Á∫øÁ®ãÂú®obj‰∏ä‰∏ÄÁõ¥Á≠âÂæÖ‰∏ãÂéª</span><br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>            log.debug(<span class="hljs-string">&quot;ÂÖ∂ÂÆÉ‰ª£Á†Å....&quot;</span>);<br>        &#125;<br>    &#125;).start();<br> <br>    <span class="hljs-comment">// ‰∏ªÁ∫øÁ®ã‰∏§ÁßíÂêéÊâßË°å</span><br>    sleep(<span class="hljs-number">2</span>);<br>    log.debug(<span class="hljs-string">&quot;Âî§ÈÜí obj ‰∏äÂÖ∂ÂÆÉÁ∫øÁ®ã&quot;</span>);<br>    <span class="hljs-keyword">synchronized</span> (obj) &#123;<br>        obj.notify(); <span class="hljs-comment">// Âî§ÈÜíobj‰∏ä‰∏Ä‰∏™Á∫øÁ®ã</span><br>        <span class="hljs-comment">// obj.notifyAll(); // Âî§ÈÜíobj‰∏äÊâÄÊúâÁ≠âÂæÖÁ∫øÁ®ã</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="7-2-sleep-long-n-Âíå-wait-long-n-ÁöÑÂå∫Âà´"><a href="#7-2-sleep-long-n-Âíå-wait-long-n-ÁöÑÂå∫Âà´" class="headerlink" title="7.2 sleep(long n)  Âíå  wait(long n)  ÁöÑÂå∫Âà´"></a>7.2 sleep(long n)  Âíå  wait(long n)  ÁöÑÂå∫Âà´</h3><ol>
<li>sleep ÊòØ Thread ÊñπÊ≥ïÔºåËÄå wait ÊòØ Object ÁöÑÊñπÊ≥ï </li>
<li>sleep ‰∏çÈúÄË¶ÅÂº∫Âà∂Âíå synchronized ÈÖçÂêà‰ΩøÁî®Ôºå‰ΩÜ wait ÈúÄË¶ÅÂíå synchronized ‰∏ÄËµ∑Áî®</li>
<li>sleep Âú®Áù°Áú†ÁöÑÂêåÊó∂Ôºå‰∏ç‰ºöÈáäÊîæÂØπË±°ÈîÅÁöÑÔºå‰ΩÜ wait Âú®Á≠âÂæÖÁöÑÊó∂ÂÄô‰ºöÈáäÊîæÂØπË±°ÈîÅ</li>
<li>ÂÆÉ‰ª¨ÁöÑÁä∂ÊÄÅÈÉΩÊòØ TIMED_WAITING</li>
</ol>
<h3 id="7-3-wait-notify-ÂéüÁêÜ"><a href="#7-3-wait-notify-ÂéüÁêÜ" class="headerlink" title="7.3 wait notify ÂéüÁêÜ"></a>7.3 wait notify ÂéüÁêÜ</h3><p><img src="/img/blogs/java/jvm-juc/juc.3.8.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li>Owner Á∫øÁ®ãÂèëÁé∞Êù°‰ª∂‰∏çÊª°Ë∂≥ÔºåË∞ÉÁî® wait ÊñπÊ≥ïÔºåÂç≥ÂèØËøõÂÖ• WaitSet Âèò‰∏∫ WAITING Áä∂ÊÄÅ</li>
<li>BLOCKED Âíå WAITING ÁöÑÁ∫øÁ®ãÈÉΩÂ§Ñ‰∫éÈòªÂ°ûÁä∂ÊÄÅÔºå‰∏çÂç†Áî® CPU Êó∂Èó¥Áâá</li>
<li>BLOCKED Á∫øÁ®ã‰ºöÂú® Owner Á∫øÁ®ãÈáäÊîæÈîÅÊó∂Âî§ÈÜí</li>
<li>WAITING Á∫øÁ®ã‰ºöÂú® Owner Á∫øÁ®ãË∞ÉÁî® notify Êàñ notifyAll Êó∂Âî§ÈÜíÔºå‰ΩÜÂî§ÈÜíÂêéÂπ∂‰∏çÊÑèÂë≥ËÄÖÁ´ãÂàªËé∑ÂæóÈîÅÔºå‰ªçÈúÄËøõÂÖ•EntryList ÈáçÊñ∞Á´û‰∫â</li>
</ol>
<h2 id="8-ÂêåÊ≠•Ê®°Âºè‰πã‰øùÊä§ÊÄßÊöÇÂÅú"><a href="#8-ÂêåÊ≠•Ê®°Âºè‰πã‰øùÊä§ÊÄßÊöÇÂÅú" class="headerlink" title="8. ÂêåÊ≠•Ê®°Âºè‰πã‰øùÊä§ÊÄßÊöÇÂÅú"></a>8. ÂêåÊ≠•Ê®°Âºè‰πã‰øùÊä§ÊÄßÊöÇÂÅú</h2><h3 id="8-1-ÂÆö‰πâ"><a href="#8-1-ÂÆö‰πâ" class="headerlink" title="8.1 ÂÆö‰πâ"></a>8.1 ÂÆö‰πâ</h3><p>Guarded SuspensionÔºåÁî®Âú®<strong>‰∏Ä‰∏™Á∫øÁ®ãÁ≠âÂæÖÂè¶‰∏Ä‰∏™Á∫øÁ®ãÁöÑÊâßË°åÁªìÊûú</strong></p>
<ul>
<li>Êúâ‰∏Ä‰∏™<strong>ÁªìÊûúÈúÄË¶Å‰ªé‰∏Ä‰∏™Á∫øÁ®ã‰º†ÈÄíÂà∞Âè¶‰∏Ä‰∏™Á∫øÁ®ã</strong>ÔºåËÆ©‰ªñ‰ª¨ÂÖ≥ËÅîÂêå‰∏Ä‰∏™ GuardedObject</li>
<li>Â¶ÇÊûúÊúâÁªìÊûú‰∏çÊñ≠‰ªé‰∏Ä‰∏™Á∫øÁ®ãÂà∞Âè¶‰∏Ä‰∏™Á∫øÁ®ãÈÇ£‰πàÂèØ‰ª•‰ΩøÁî®Ê∂àÊÅØÈòüÂàóÔºàËßÅÁîü‰∫ßËÄÖ&#x2F;Ê∂àË¥πËÄÖÔºâ</li>
<li>JDK ‰∏≠Ôºåjoin ÁöÑÂÆûÁé∞„ÄÅFuture ÁöÑÂÆûÁé∞ÔºåÈááÁî®ÁöÑÂ∞±ÊòØÊ≠§Ê®°Âºè</li>
<li>Âõ†‰∏∫<strong>Ë¶ÅÁ≠âÂæÖÂè¶‰∏ÄÊñπÁöÑÁªìÊûú</strong>ÔºåÂõ†Ê≠§ÂΩíÁ±ªÂà∞ÂêåÊ≠•Ê®°Âºè</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.3.9.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="8-2-joinÂéüÁêÜ"><a href="#8-2-joinÂéüÁêÜ" class="headerlink" title="8.2 joinÂéüÁêÜ"></a>8.2 joinÂéüÁêÜ</h3><p>join <strong>‰ΩìÁé∞ÁöÑÊòØ„Äê‰øùÊä§ÊÄßÊöÇÂÅú„ÄëÊ®°Âºè</strong><br>Ë∞ÉÁî®ËÄÖ<strong>ËΩÆËØ¢Ê£ÄÊü•Á∫øÁ®ã alive Áä∂ÊÄÅ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">t1.join();<br><span class="hljs-comment">//Á≠â‰ª∑‰∫é‰∏ãÈù¢ÁöÑ‰ª£Á†ÅÔºö</span><br><span class="hljs-keyword">synchronized</span> (t1) &#123;<br>    <span class="hljs-comment">// Ë∞ÉÁî®ËÄÖÁ∫øÁ®ãËøõÂÖ• t1 ÁöÑ waitSet Á≠âÂæÖ, Áõ¥Âà∞ t1 ËøêË°åÁªìÊùü</span><br>    <span class="hljs-keyword">while</span> (t1.isAlive()) &#123;<br>        t1.wait(<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="8-3-Â§ö‰ªªÂä°Áâà-GuardedObject"><a href="#8-3-Â§ö‰ªªÂä°Áâà-GuardedObject" class="headerlink" title="8.3 Â§ö‰ªªÂä°Áâà GuardedObject"></a>8.3 Â§ö‰ªªÂä°Áâà GuardedObject</h3><p>Â¶ÇÊûúÈúÄË¶ÅÂú®Â§ö‰∏™Á±ª‰πãÈó¥‰ΩøÁî® GuardedObject ÂØπË±°Ôºå‰Ωú‰∏∫ÂèÇÊï∞‰º†ÈÄí‰∏çÊòØÂæàÊñπ‰æøÔºåÂõ†Ê≠§ËÆæËÆ°‰∏Ä‰∏™Áî®Êù•Ëß£ËÄ¶ÁöÑ‰∏≠Èó¥Á±ªÔºåËøôÊ†∑‰∏ç‰ªÖËÉΩÂ§üËß£ËÄ¶„ÄêÁªìÊûúÁ≠âÂæÖËÄÖ„ÄëÂíå„ÄêÁªìÊûúÁîü‰∫ßËÄÖ„ÄëÔºåËøòËÉΩÂ§üÂêåÊó∂ÊîØÊåÅÂ§ö‰∏™‰ªªÂä°ÁöÑÁÆ°ÁêÜ</p>
<p><img src="/img/blogs/java/jvm-juc/juc.3.10.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="9-ÂºÇÊ≠•Ê®°Âºè‰πãÁîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖ"><a href="#9-ÂºÇÊ≠•Ê®°Âºè‰πãÁîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖ" class="headerlink" title="9. ÂºÇÊ≠•Ê®°Âºè‰πãÁîü‰∫ßËÄÖ&#x2F;Ê∂àË¥πËÄÖ"></a>9. ÂºÇÊ≠•Ê®°Âºè‰πãÁîü‰∫ßËÄÖ&#x2F;Ê∂àË¥πËÄÖ</h2><ul>
<li>‰∏éÂâçÈù¢ÁöÑ‰øùÊä§ÊÄßÊöÇÂÅú‰∏≠ÁöÑ GuardObject ‰∏çÂêåÔºå‰∏çÈúÄË¶Å‰∫ßÁîüÁªìÊûúÂíåÊ∂àË¥πÁªìÊûúÁöÑÁ∫øÁ®ã‰∏Ä‰∏ÄÂØπÂ∫î</li>
<li>Ê∂àË¥πÈòüÂàóÂèØ‰ª•Áî®Êù•Âπ≥Ë°°Áîü‰∫ßÂíåÊ∂àË¥πÁöÑÁ∫øÁ®ãËµÑÊ∫ê</li>
<li><strong>Áîü‰∫ßËÄÖ‰ªÖË¥üË¥£‰∫ßÁîüÁªìÊûúÊï∞ÊçÆÔºå‰∏çÂÖ≥ÂøÉÊï∞ÊçÆËØ•Â¶Ç‰ΩïÂ§ÑÁêÜÔºåËÄåÊ∂àË¥πËÄÖ‰∏ìÂøÉÂ§ÑÁêÜÁªìÊûúÊï∞ÊçÆ</strong></li>
<li>Ê∂àÊÅØÈòüÂàóÊòØÊúâÂÆπÈáèÈôêÂà∂ÁöÑÔºåÊª°Êó∂‰∏ç‰ºöÂÜçÂä†ÂÖ•Êï∞ÊçÆÔºåÁ©∫Êó∂‰∏ç‰ºöÂÜçÊ∂àËÄóÊï∞ÊçÆ</li>
<li>JDK ‰∏≠ÂêÑÁßçÈòªÂ°ûÈòüÂàóÔºåÈááÁî®ÁöÑÂ∞±ÊòØËøôÁßçÊ®°Âºè</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.3.11.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="10-Park-Unpark"><a href="#10-Park-Unpark" class="headerlink" title="10. Park &amp; Unpark"></a>10. Park &amp; Unpark</h2><p>ÊòØLockSupport Á±ª‰∏≠ÁöÑÊñπÊ≥ï</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ÊöÇÂÅúÂΩìÂâçÁ∫øÁ®ã</span><br>LockSupport.park(); <br><span class="hljs-comment">// ÊÅ¢Â§çÊüê‰∏™Á∫øÁ®ãÁöÑËøêË°å</span><br>LockSupport.unpark(ÊöÇÂÅúÁ∫øÁ®ãÂØπË±°)<br></code></pre></td></tr></table></figure>

<p><strong>‰∏é Object ÁöÑ wait &amp; notify Áõ∏ÊØî</strong></p>
<ul>
<li>waitÔºånotify Âíå notifyAll ÂøÖÈ°ªÈÖçÂêà Object Monitor ‰∏ÄËµ∑‰ΩøÁî®ÔºåËÄå parkÔºåunpark ‰∏çÂøÖ</li>
<li>park &amp; unpark ÊòØ‰ª•Á∫øÁ®ã‰∏∫Âçï‰ΩçÊù•„ÄêÈòªÂ°û„ÄëÂíå„ÄêÂî§ÈÜí„ÄëÁ∫øÁ®ãÔºåËÄå notify Âè™ËÉΩÈöèÊú∫Âî§ÈÜí‰∏Ä‰∏™Á≠âÂæÖÁ∫øÁ®ãÔºånotifyAll ÊòØÂî§ÈÜíÊâÄÊúâÁ≠âÂæÖÁ∫øÁ®ãÔºåÂ∞±‰∏çÈÇ£‰πà„ÄêÁ≤æÁ°Æ„Äë</li>
<li>park &amp; unpark ÂèØ‰ª•ÂÖà unparkÔºåËÄå wait &amp; notify ‰∏çËÉΩÂÖà notify</li>
<li><strong>ÂèØ‰ª•ÂÖàParkÂÜçunpark;‰πüÂèØ‰ª•ÂÖàunparkÂÜçpark</strong></li>
</ul>
<h2 id="11-ÈáçÊñ∞ÁêÜËß£Á∫øÁ®ãÁä∂ÊÄÅËΩ¨Êç¢"><a href="#11-ÈáçÊñ∞ÁêÜËß£Á∫øÁ®ãÁä∂ÊÄÅËΩ¨Êç¢" class="headerlink" title="11. ÈáçÊñ∞ÁêÜËß£Á∫øÁ®ãÁä∂ÊÄÅËΩ¨Êç¢"></a>11. ÈáçÊñ∞ÁêÜËß£Á∫øÁ®ãÁä∂ÊÄÅËΩ¨Êç¢</h2><p>ÂÅáËÆæÊúâÁ∫øÁ®ã  Thread t</p>
<p><img src="/img/blogs/java/jvm-juc/juc.3.12.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li><strong>NEW ‚Äì&gt; RUNNABLE</strong></li>
</ol>
<ul>
<li>ÂΩìË∞ÉÁî®  <strong>t.start()</strong>  ÊñπÊ≥ïÊó∂ÔºåÁî±  NEW ‚Äì&gt; RUNNABLE</li>
</ul>
<ol start="2">
<li><strong>RUNNABLE &lt;‚Äì&gt; WAITING</strong><br>t Á∫øÁ®ãÁî®  synchronized(obj)  Ëé∑Âèñ‰∫ÜÂØπË±°ÈîÅÂêé<ul>
<li>Ë∞ÉÁî®  <strong>obj.wait()</strong>  ÊñπÊ≥ïÊó∂Ôºåt Á∫øÁ®ã‰ªé  RUNNABLE ‚Äì&gt; WAITING</li>
<li>Ë∞ÉÁî®  <strong>obj.notify() Ôºå obj.notifyAll() Ôºå t.interrupt()</strong>  Êó∂<ul>
<li>Á´û‰∫âÈîÅÊàêÂäüÔºåt Á∫øÁ®ã‰ªé   WAITING ‚Äì&gt; RUNNABLE  </li>
<li>Á´û‰∫âÈîÅÂ§±Ë¥•Ôºåt Á∫øÁ®ã‰ªé   WAITING ‚Äì&gt; BLOCKED</li>
</ul>
</li>
</ul>
</li>
<li><strong>RUNNABLE &lt;‚Äì&gt; WAITING</strong>  <ul>
<li>ÂΩìÂâçÁ∫øÁ®ãË∞ÉÁî®  <strong>t.join()</strong>  ÊñπÊ≥ïÊó∂ÔºåÂΩìÂâçÁ∫øÁ®ã‰ªé  RUNNABLE ‚Äì&gt; WAITING</li>
<li>t Á∫øÁ®ãËøêË°åÁªìÊùüÔºåÊàñË∞ÉÁî®‰∫ÜÂΩìÂâçÁ∫øÁ®ãÁöÑ  <strong>interrupt()</strong>  Êó∂ÔºåÂΩìÂâçÁ∫øÁ®ã‰ªé  WAITING ‚Äì&gt; RUNNABLE</li>
</ul>
</li>
<li><strong>RUNNABLE &lt;‚Äì&gt; WAITING</strong>  <ul>
<li>ÂΩìÂâçÁ∫øÁ®ãË∞ÉÁî®  <strong>LockSupport.park()</strong>  ÊñπÊ≥ï‰ºöËÆ©ÂΩìÂâçÁ∫øÁ®ã‰ªé  RUNNABLE ‚Äì&gt; WAITING</li>
<li>Ë∞ÉÁî®  <strong>LockSupport.unpark(ÁõÆÊ†áÁ∫øÁ®ã)</strong>  ÊàñË∞ÉÁî®‰∫ÜÁ∫øÁ®ãÁöÑ <strong>interrupt()</strong>Ôºå‰ºöËÆ©ÁõÆÊ†áÁ∫øÁ®ã‰ªé  WAITING ‚Äì&gt; RUNNABLE</li>
</ul>
</li>
<li><strong>RUNNABLE &lt;‚Äì&gt; TIMED_WAITING</strong><br>t Á∫øÁ®ãÁî®  synchronized(obj)  Ëé∑Âèñ‰∫ÜÂØπË±°ÈîÅÂêé<ul>
<li>Ë∞ÉÁî®  <strong>obj.wait(long n)</strong>  ÊñπÊ≥ïÊó∂Ôºåt Á∫øÁ®ã‰ªé  RUNNABLE ‚Äì&gt; TIMED_WAITING</li>
<li>t Á∫øÁ®ãÁ≠âÂæÖÊó∂Èó¥Ë∂ÖËøá‰∫Ü n ÊØ´ÁßíÔºåÊàñË∞ÉÁî®  obj.notify() Ôºå obj.notifyAll() Ôºå t.interrupt()  Êó∂<ul>
<li>Á´û‰∫âÈîÅÊàêÂäüÔºåt Á∫øÁ®ã‰ªé   TIMED_WAITING ‚Äì&gt; RUNNABLE  </li>
<li>Á´û‰∫âÈîÅÂ§±Ë¥•Ôºåt Á∫øÁ®ã‰ªé   TIMED_WAITING ‚Äì&gt; BLOCKED</li>
</ul>
</li>
</ul>
</li>
<li><strong>RUNNABLE &lt;‚Äì&gt; TIMED_WAITING</strong>  <ul>
<li>ÂΩìÂâçÁ∫øÁ®ãË∞ÉÁî®  <strong>t.join(long n)</strong>  ÊñπÊ≥ïÊó∂ÔºåÂΩìÂâçÁ∫øÁ®ã‰ªé  RUNNABLE ‚Äì&gt; TIMED_WAITING</li>
<li>ÂΩìÂâçÁ∫øÁ®ãÁ≠âÂæÖÊó∂Èó¥Ë∂ÖËøá‰∫Ü n ÊØ´ÁßíÔºåÊàñt Á∫øÁ®ãËøêË°åÁªìÊùüÔºåÊàñË∞ÉÁî®‰∫ÜÂΩìÂâçÁ∫øÁ®ãÁöÑ  <strong>interrupt()</strong>  Êó∂ÔºåÂΩìÂâçÁ∫øÁ®ã‰ªéTIMED_WAITING ‚Äì&gt; RUNNABLE</li>
</ul>
</li>
<li><strong>RUNNABLE &lt;‚Äì&gt; TIMED_WAITING</strong>  <ul>
<li>ÂΩìÂâçÁ∫øÁ®ãË∞ÉÁî®  <strong>Thread.sleep(long n)</strong> ÔºåÂΩìÂâçÁ∫øÁ®ã‰ªé  RUNNABLE ‚Äì&gt; TIMED_WAITING  </li>
<li>ÂΩìÂâçÁ∫øÁ®ãÁ≠âÂæÖÊó∂Èó¥Ë∂ÖËøá‰∫Ü n ÊØ´ÁßíÔºåÂΩìÂâçÁ∫øÁ®ã‰ªéTIMED_WAITING ‚Äì&gt; RUNNABLE</li>
</ul>
</li>
<li><strong>RUNNABLE &lt;‚Äì&gt; TIMED_WAITING</strong>  <ul>
<li>ÂΩìÂâçÁ∫øÁ®ãË∞ÉÁî®  <strong>LockSupport.parkNanos(long nanos)  Êàñ  LockSupport.parkUntil(long millis)</strong>  Êó∂ÔºåÂΩìÂâçÁ∫øÁ®ã‰ªé  RUNNABLE ‚Äì&gt; TIMED_WAITING</li>
<li>Ë∞ÉÁî®  <strong>LockSupport.unpark(ÁõÆÊ†áÁ∫øÁ®ã) ÊàñË∞ÉÁî®‰∫ÜÁ∫øÁ®ãÁöÑinterrupt()</strong> ÔºåÊàñÊòØÁ≠âÂæÖË∂ÖÊó∂Ôºå‰ºöËÆ©ÁõÆÊ†áÁ∫øÁ®ã‰ªéTIMED_WAITING‚Äì&gt; RUNNABLE</li>
</ul>
</li>
<li><strong>RUNNABLE &lt;‚Äì&gt; BLOCKED</strong>  <ul>
<li>t Á∫øÁ®ãÁî®   <strong>synchronized(obj)</strong>  Ëé∑Âèñ‰∫ÜÂØπË±°ÈîÅÊó∂<strong>Â¶ÇÊûúÁ´û‰∫âÂ§±Ë¥•</strong>Ôºå‰ªé   RUNNABLE ‚Äì&gt; BLOCKED  </li>
<li>ÊåÅ obj ÈîÅÁ∫øÁ®ãÁöÑÂêåÊ≠•‰ª£Á†ÅÂùóÊâßË°åÂÆåÊØïÔºå‰ºö<strong>Âî§ÈÜíËØ•ÂØπË±°‰∏äÊâÄÊúâ  BLOCKED   ÁöÑÁ∫øÁ®ãÈáçÊñ∞Á´û‰∫â</strong>ÔºåÂ¶ÇÊûúÂÖ∂‰∏≠ t Á∫øÁ®ãÁ´û‰∫â<strong>ÊàêÂäü</strong>Ôºå‰ªé  BLOCKED ‚Äì&gt; RUNNABLE ÔºåÂÖ∂ÂÆÉ<strong>Â§±Ë¥•</strong>ÁöÑÁ∫øÁ®ã‰ªçÁÑ∂   BLOCKED</li>
</ul>
</li>
<li><strong>RUNNABLE &lt;‚Äì&gt; TERMINATED</strong>  <ul>
<li>ÂΩìÂâçÁ∫øÁ®ãÊâÄÊúâ‰ª£Á†Å<strong>ËøêË°åÂÆåÊØï</strong>ÔºåËøõÂÖ• TERMINATED</li>
</ul>
</li>
</ol>
<h2 id="12-Â§öÊääÈîÅ"><a href="#12-Â§öÊääÈîÅ" class="headerlink" title="12. Â§öÊääÈîÅ"></a>12. Â§öÊääÈîÅ</h2><p>Â¶ÇÊûú‰∏ÄÊääÈîÅÈîÅÂú®‰∏Ä‰∏™ÂæàÂ§ßÁöÑÂÖ±‰∫´ÂçïÂÖÉ(Á≤óÁ≤íÂ∫¶)ÁöÑÊó∂ÂÄôÔºåÈÇ£‰πàÂπ∂ÂèëÂ∫¶Â∞±‰ºöÂæà‰Ωé</p>
<ul>
<li>Ëß£ÂÜ≥ÊñπÊ≥ïÊòØÂáÜÂ§áÂ§ö‰∏™ÊàøÈó¥Ôºà<strong>Â§ö‰∏™ÂØπË±°ÈîÅ</strong>Ôºâ</li>
</ul>
<p>Â∞ÜÈîÅÁöÑÁ≤íÂ∫¶ÁªÜÂàÜ</p>
<ul>
<li>Â•ΩÂ§ÑÔºåÊòØÂèØ‰ª•Â¢ûÂº∫Âπ∂ÂèëÂ∫¶</li>
<li>ÂùèÂ§ÑÔºåÂ¶ÇÊûú‰∏Ä‰∏™Á∫øÁ®ãÈúÄË¶ÅÂêåÊó∂Ëé∑ÂæóÂ§öÊääÈîÅÔºåÂ∞±ÂÆπÊòìÂèëÁîüÊ≠ªÈîÅ</li>
</ul>
<h2 id="13-Ê¥ªË∑ÉÊÄß"><a href="#13-Ê¥ªË∑ÉÊÄß" class="headerlink" title="13. Ê¥ªË∑ÉÊÄß"></a>13. Ê¥ªË∑ÉÊÄß</h2><h3 id="13-1-Ê≠ªÈîÅ"><a href="#13-1-Ê≠ªÈîÅ" class="headerlink" title="13.1 Ê≠ªÈîÅ"></a>13.1 Ê≠ªÈîÅ</h3><p>‰∏Ä‰∏™Á∫øÁ®ãÈúÄË¶ÅÂêåÊó∂Ëé∑ÂèñÂ§öÊääÈîÅÔºåËøôÊó∂Â∞±ÂÆπÊòìÂèëÁîü<strong>Ê≠ªÈîÅ</strong></p>
<ul>
<li>t1 Á∫øÁ®ãËé∑ÂæóAÂØπË±°ÈîÅÔºåÊé•‰∏ãÊù•ÊÉ≥Ëé∑ÂèñBÂØπË±°ÁöÑÈîÅ  </li>
<li>t2 Á∫øÁ®ãËé∑ÂæóBÂØπË±°ÈîÅÔºåÊé•‰∏ãÊù•ÊÉ≥Ëé∑ÂèñAÂØπË±°ÁöÑÈîÅ</li>
</ul>
<p><strong>ÈÅøÂÖçÊ≠ªÈîÅÁöÑÊñπÊ≥ï</strong>:</p>
<ul>
<li>Âú®Á∫øÁ®ã‰ΩøÁî®ÈîÅÂØπË±°Êó∂Ôºå<strong>È°∫Â∫èÂä†ÈîÅ</strong>Âç≥ÂèØÈÅøÂÖçÊ≠ªÈîÅ</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.3.13.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="13-2-ÂÆö‰ΩçÊ≠ªÈîÅ"><a href="#13-2-ÂÆö‰ΩçÊ≠ªÈîÅ" class="headerlink" title="13.2 ÂÆö‰ΩçÊ≠ªÈîÅ"></a>13.2 ÂÆö‰ΩçÊ≠ªÈîÅ</h3><p>Ê£ÄÊµãÊ≠ªÈîÅÂèØ‰ª•‰ΩøÁî® <strong>jconsoleÂ∑•ÂÖ∑</strong>ÔºåÊàñËÄÖ‰ΩøÁî® jps ÂÆö‰ΩçËøõÁ®ã idÔºåÂÜçÁî® <strong>jstack</strong> ÂÆö‰ΩçÊ≠ªÈîÅ</p>
<h3 id="13-3-Âì≤Â≠¶ÂÆ∂Â∞±È§êÈóÆÈ¢ò"><a href="#13-3-Âì≤Â≠¶ÂÆ∂Â∞±È§êÈóÆÈ¢ò" class="headerlink" title="13.3 Âì≤Â≠¶ÂÆ∂Â∞±È§êÈóÆÈ¢ò"></a>13.3 Âì≤Â≠¶ÂÆ∂Â∞±È§êÈóÆÈ¢ò</h3><p>Êúâ‰∫î‰ΩçÂì≤Â≠¶ÂÆ∂ÔºåÂõ¥ÂùêÂú®ÂúÜÊ°åÊóÅ„ÄÇ ‰ªñ‰ª¨Âè™ÂÅö‰∏§‰ª∂‰∫ãÔºåÊÄùËÄÉÂíåÂêÉÈ•≠ÔºåÊÄùËÄÉ‰∏Ä‰ºöÂêÉÂè£È•≠ÔºåÂêÉÂÆåÈ•≠ÂêéÊé•ÁùÄÊÄùËÄÉ„ÄÇ ÂêÉÈ•≠Êó∂Ë¶ÅÁî®‰∏§Ê†πÁ≠∑Â≠êÂêÉÔºåÊ°å‰∏äÂÖ±Êúâ 5 Ê†πÁ≠∑Â≠êÔºåÊØè‰ΩçÂì≤Â≠¶ÂÆ∂Â∑¶Âè≥ÊâãËæπÂêÑÊúâ‰∏ÄÊ†πÁ≠∑Â≠ê„ÄÇ Â¶ÇÊûúÁ≠∑Â≠êË¢´Ë∫´ËæπÁöÑ‰∫∫ÊãøÁùÄÔºåËá™Â∑±Â∞±ÂæóÁ≠âÂæÖ „ÄÇ<br>ÂΩìÊØè‰∏™Âì≤Â≠¶ÂÆ∂Âç≥Á∫øÁ®ã<strong>ÊåÅÊúâ‰∏ÄÊ†πÁ≠∑Â≠êÊó∂Ôºå‰ªñ‰ª¨ÈÉΩÂú®Á≠âÂæÖÂè¶‰∏Ä‰∏™Á∫øÁ®ãÈáäÊîæÈîÅÔºåÂõ†Ê≠§ÈÄ†Êàê‰∫ÜÊ≠ªÈîÅ</strong>„ÄÇ</p>
<h3 id="13-4-Ê¥ªÈîÅ"><a href="#13-4-Ê¥ªÈîÅ" class="headerlink" title="13.4 Ê¥ªÈîÅ"></a>13.4 Ê¥ªÈîÅ</h3><p>Ê¥ªÈîÅÂá∫Áé∞Âú®‰∏§‰∏™Á∫øÁ®ã<strong>‰∫íÁõ∏ÊîπÂèòÂØπÊñπÁöÑÁªìÊùüÊù°‰ª∂ÔºåÊúÄÂêéË∞Å‰πüÊó†Ê≥ïÁªìÊùü</strong></p>
<ul>
<li><strong>ÈÅøÂÖçÊ¥ªÈîÅÁöÑÊñπÊ≥ï</strong>Ôºö Âú®Á∫øÁ®ãÊâßË°åÊó∂Ôºå‰∏≠ÈÄîÁªô‰∫à‰∏çÂêåÁöÑ<strong>Èó¥ÈöîÊó∂Èó¥</strong>Âç≥ÂèØ„ÄÇ</li>
</ul>
<p><strong>Ê≠ªÈîÅ‰∏éÊ¥ªÈîÅÁöÑÂå∫Âà´</strong></p>
<ul>
<li>Ê≠ªÈîÅÊòØÂõ†‰∏∫Á∫øÁ®ã‰∫íÁõ∏ÊåÅÊúâÂØπË±°ÊÉ≥Ë¶ÅÁöÑÈîÅÔºåÂπ∂‰∏î<strong>ÈÉΩ‰∏çÈáäÊîæ</strong>ÔºåÊúÄÂêéÂà∞Êó∂<strong>Á∫øÁ®ãÈòªÂ°û</strong>Ôºå<strong>ÂÅúÊ≠¢ËøêË°å</strong>ÁöÑÁé∞Ë±°„ÄÇ</li>
<li>Ê¥ªÈîÅÊòØÂõ†‰∏∫Á∫øÁ®ãÈó¥‰øÆÊîπ‰∫ÜÂØπÊñπÁöÑÁªìÊùüÊù°‰ª∂ÔºåËÄåÂØºËá¥<strong>‰ª£Á†Å‰∏ÄÁõ¥Âú®ËøêË°åÔºåÂç¥‰∏ÄÁõ¥ËøêË°å‰∏çÂÆå</strong>ÁöÑÁé∞Ë±°„ÄÇ</li>
</ul>
<h3 id="13-5-È••È•ø"><a href="#13-5-È••È•ø" class="headerlink" title="13.5 È••È•ø"></a>13.5 È••È•ø</h3><ul>
<li>‰∏Ä‰∏™Á∫øÁ®ãÁî±‰∫é<strong>‰ºòÂÖàÁ∫ßÂ§™‰ΩéÔºåÂßãÁªàÂæó‰∏çÂà∞ CPU Ë∞ÉÂ∫¶ÊâßË°å</strong>Ôºå‰πü‰∏çËÉΩÂ§üÁªìÊùü</li>
<li>Êüê‰∫õÁ∫øÁ®ãÂõ†‰∏∫‰ºòÂÖàÁ∫ßÂ§™‰ΩéÔºåÂØºËá¥‰∏ÄÁõ¥Êó†Ê≥ïËé∑ÂæóËµÑÊ∫êÁöÑÁé∞Ë±°„ÄÇ</li>
<li>Âú®‰ΩøÁî®<strong>È°∫Â∫èÂä†ÈîÅ</strong>Êó∂ÔºåÂèØËÉΩ‰ºöÂá∫Áé∞È••È•øÁé∞Ë±°</li>
</ul>
<h2 id="14-ReentrantLock"><a href="#14-ReentrantLock" class="headerlink" title="14. ReentrantLock"></a>14. ReentrantLock</h2><p>Áõ∏ÂØπ‰∫é synchronized ÂÆÉÂÖ∑Â§áÂ¶Ç‰∏ãÁâπÁÇπ:</p>
<ul>
<li>ÂèØ‰∏≠Êñ≠</li>
<li>ÂèØ‰ª•ËÆæÁΩÆË∂ÖÊó∂Êó∂Èó¥</li>
<li>ÂèØ‰ª•ËÆæÁΩÆ‰∏∫ÂÖ¨Âπ≥ÈîÅ(Èò≤Ê≠¢È••È•ø)</li>
<li>ÊîØÊåÅÂ§ö‰∏™Êù°‰ª∂ÂèòÈáè</li>
<li>‰∏é synchronized ‰∏ÄÊ†∑ÔºåÈÉΩÊîØÊåÅÂèØÈáçÂÖ•</li>
</ul>
<h3 id="14-1-Âü∫Êú¨ËØ≠Ê≥ï"><a href="#14-1-Âü∫Êú¨ËØ≠Ê≥ï" class="headerlink" title="14.1 Âü∫Êú¨ËØ≠Ê≥ï"></a>14.1 Âü∫Êú¨ËØ≠Ê≥ï</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Ëé∑ÂèñÈîÅ</span><br>reentrantLock.lock();<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// ‰∏¥ÁïåÂå∫</span><br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    <span class="hljs-comment">// ÈáäÊîæÈîÅ</span><br>    reentrantLock.unlock();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="14-2-ÂèØÈáçÂÖ•"><a href="#14-2-ÂèØÈáçÂÖ•" class="headerlink" title="14.2 ÂèØÈáçÂÖ•"></a>14.2 ÂèØÈáçÂÖ•</h3><ul>
<li>ÂèØÈáçÂÖ•ÊòØÊåáÂêå‰∏Ä‰∏™Á∫øÁ®ãÂ¶ÇÊûúÈ¶ñÊ¨°Ëé∑Âæó‰∫ÜËøôÊääÈîÅÔºåÈÇ£‰πàÂõ†‰∏∫ÂÆÉÊòØËøôÊääÈîÅÁöÑÊã•ÊúâËÄÖÔºåÂõ†Ê≠§ÊúâÊùÉÂà©ÂÜçÊ¨°Ëé∑ÂèñËøôÊääÈîÅ</li>
<li>Â¶ÇÊûúÊòØ‰∏çÂèØÈáçÂÖ•ÈîÅÔºåÈÇ£‰πàÁ¨¨‰∫åÊ¨°Ëé∑ÂæóÈîÅÊó∂ÔºåËá™Â∑±‰πü‰ºöË¢´ÈîÅÊå°‰Ωè</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    method1();<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method1</span><span class="hljs-params">()</span> &#123;<br>    lock.lock();<br>    <span class="hljs-keyword">try</span> &#123;<br>        log.debug(<span class="hljs-string">&quot;execute method1&quot;</span>);<br>        method2();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        lock.unlock();<br>    &#125;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method2</span><span class="hljs-params">()</span> &#123;<br>    lock.lock();<br>    <span class="hljs-keyword">try</span> &#123;<br>        log.debug(<span class="hljs-string">&quot;execute method2&quot;</span>);<br>        method3();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        lock.unlock();<br>    &#125;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method3</span><span class="hljs-params">()</span> &#123;<br>    lock.lock();<br>    <span class="hljs-keyword">try</span> &#123;<br>        log.debug(<span class="hljs-string">&quot;execute method3&quot;</span>);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        lock.unlock();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>method1„ÄÅmethod2„ÄÅmethod3ÈÉΩÂæóÂà∞ÊâßË°åÔºåËØ¥ÊòéÊòØÂèØÈáçÂÖ•ÁöÑ</p>
<h3 id="14-3-ÂèØÊâìÊñ≠"><a href="#14-3-ÂèØÊâìÊñ≠" class="headerlink" title="14.3 ÂèØÊâìÊñ≠"></a>14.3 ÂèØÊâìÊñ≠</h3><p>ÂèØÊâìÊñ≠ÈúÄË¶Å‰ΩøÁî®**lockInterruptibly()**ÊñπÊ≥ï<br>Â§Ñ‰∫éÈòªÂ°ûÁä∂ÊÄÅÁöÑÁ∫øÁ®ãÔºåË¢´ÊâìÊñ≠‰∫ÜÂ∞±‰∏çÁî®ÈòªÂ°û‰∫ÜÔºå<strong>Áõ¥Êé•ÂÅúÊ≠¢ËøêË°å</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>		<span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br>		<span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>			<span class="hljs-keyword">try</span> &#123;<br>				<span class="hljs-comment">// Âä†ÈîÅÔºåÂèØÊâìÊñ≠ÈîÅ</span><br>				lock.lockInterruptibly();<br>			&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>				e.printStackTrace();<br>                <span class="hljs-comment">// Ë¢´ÊâìÊñ≠ÔºåËøîÂõûÔºå‰∏çÂÜçÂêë‰∏ãÊâßË°å</span><br>				<span class="hljs-keyword">return</span>;<br>			&#125;<span class="hljs-keyword">finally</span> &#123;<br>				<span class="hljs-comment">// ÈáäÊîæÈîÅ</span><br>				lock.unlock();<br>			&#125;<br><br>		&#125;);<br><br>		lock.lock();<br>		<span class="hljs-keyword">try</span> &#123;<br>			t1.start();<br>			Thread.sleep(<span class="hljs-number">1000</span>);<br>			<span class="hljs-comment">// ÊâìÊñ≠</span><br>			t1.interrupt();<br>		&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>			e.printStackTrace();<br>		&#125; <span class="hljs-keyword">finally</span> &#123;<br>			lock.unlock();<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>

<h3 id="14-4-ÈîÅË∂ÖÊó∂"><a href="#14-4-ÈîÅË∂ÖÊó∂" class="headerlink" title="14.4 ÈîÅË∂ÖÊó∂"></a>14.4 ÈîÅË∂ÖÊó∂</h3><p>‰ΩøÁî®**tryLock()**ÊñπÊ≥ïÔºåÂèØËøîÂõûË∂ÖÊó∂Â§±Ë¥•<br>ËÆæÁΩÆË∂ÖÊó∂Êó∂Èó¥ÔºåÂ¶ÇÊûúË∂ÖÊó∂‰∫ÜÔºåÂ∞±ËøîÂõû</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>		<span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br>		<span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>			<span class="hljs-keyword">try</span> &#123;<br>				<span class="hljs-comment">// Âà§Êñ≠Ëé∑ÂèñÈîÅÊòØÂê¶ÊàêÂäüÔºåÊúÄÂ§öÁ≠âÂæÖ1Áßí</span><br>				<span class="hljs-keyword">if</span>(!lock.tryLock(<span class="hljs-number">1</span>, TimeUnit.SECONDS)) &#123;<br>					System.out.println(<span class="hljs-string">&quot;Ëé∑ÂèñÂ§±Ë¥•&quot;</span>);<br>					<span class="hljs-comment">// Ëé∑ÂèñÂ§±Ë¥•Ôºå‰∏çÂÜçÂêë‰∏ãÊâßË°åÔºåÁõ¥Êé•ËøîÂõû</span><br>					<span class="hljs-keyword">return</span>;<br>				&#125;<br>			&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>				e.printStackTrace();<br>				<span class="hljs-comment">// Ë¢´ÊâìÊñ≠Ôºå‰∏çÂÜçÂêë‰∏ãÊâßË°åÔºåÁõ¥Êé•ËøîÂõû</span><br>				<span class="hljs-keyword">return</span>;<br>			&#125;<br>			System.out.println(<span class="hljs-string">&quot;ÂæóÂà∞‰∫ÜÈîÅ&quot;</span>);<br>			<span class="hljs-comment">// ÈáäÊîæÈîÅ</span><br>			lock.unlock();<br>		&#125;);<br><br><br>		lock.lock();<br>		<span class="hljs-keyword">try</span>&#123;<br>			t1.start();<br>			<span class="hljs-comment">// ÊâìÊñ≠Á≠âÂæÖ</span><br>			t1.interrupt();<br>			Thread.sleep(<span class="hljs-number">3000</span>);<br>		&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>			e.printStackTrace();<br>		&#125; <span class="hljs-keyword">finally</span> &#123;<br>			lock.unlock();<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>‰ΩøÁî® tryLock ÂèØ‰ª•Ëß£ÂÜ≥Âì≤Â≠¶ÂÆ∂Â∞±È§êÈóÆÈ¢ò</li>
</ul>
<h3 id="14-5-ÂÖ¨Âπ≥ÈîÅ"><a href="#14-5-ÂÖ¨Âπ≥ÈîÅ" class="headerlink" title="14.5 ÂÖ¨Âπ≥ÈîÅ"></a>14.5 ÂÖ¨Âπ≥ÈîÅ</h3><ul>
<li>Á∫øÁ®ãÂÖàÂÖ•ÂÖàÂæóÔºåÈò≤Ê≠¢È••È•ø</li>
<li>Âú®Á∫øÁ®ãËé∑ÂèñÈîÅÂ§±Ë¥•ÔºåËøõÂÖ•ÈòªÂ°ûÈòüÂàóÊó∂Ôºå<strong>ÂÖàËøõÂÖ•ÁöÑ‰ºöÂú®ÈîÅË¢´ÈáäÊîæÂêéÂÖàËé∑ÂæóÈîÅ</strong>„ÄÇËøôÊ†∑ÁöÑËé∑ÂèñÊñπÂºèÂ∞±ÊòØÂÖ¨Âπ≥ÁöÑ„ÄÇ</li>
<li>ReentrantLock ÈªòËÆ§ÊòØ‰∏çÂÖ¨Âπ≥ÁöÑ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ÈªòËÆ§ÊòØ‰∏çÂÖ¨Âπ≥ÈîÅÔºåÈúÄË¶ÅÂú®ÂàõÂª∫Êó∂ÊåáÂÆö‰∏∫ÂÖ¨Âπ≥ÈîÅ</span><br><span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure>

<h3 id="14-6-Êù°‰ª∂ÂèòÈáè"><a href="#14-6-Êù°‰ª∂ÂèòÈáè" class="headerlink" title="14.6 Êù°‰ª∂ÂèòÈáè"></a>14.6 Êù°‰ª∂ÂèòÈáè</h3><ul>
<li>synchronized ‰∏≠‰πüÊúâÊù°‰ª∂ÂèòÈáèÔºåÂ∞±ÊòØÊàë‰ª¨ËÆ≤ÂéüÁêÜÊó∂ÈÇ£‰∏™ waitSet ‰ºëÊÅØÂÆ§ÔºåÂΩìÊù°‰ª∂‰∏çÊª°Ë∂≥Êó∂ËøõÂÖ•waitSetÁ≠âÂæÖ„ÄÇ</li>
<li>ReentrantLock ÁöÑÊù°‰ª∂ÂèòÈáèÊØî synchronized Âº∫Â§ß‰πãÂ§ÑÂú®‰∫éÔºåÂÆÉÊòØ<strong>ÊîØÊåÅÂ§ö‰∏™Êù°‰ª∂ÂèòÈáè</strong>ÁöÑÔºåËøôÂ∞±Â•ΩÊØî<ul>
<li>synchronized ÊòØÈÇ£‰∫õ‰∏çÊª°Ë∂≥Êù°‰ª∂ÁöÑÁ∫øÁ®ãÈÉΩÂú®‰∏ÄÈó¥‰ºëÊÅØÂÆ§Á≠âÊ∂àÊÅØ</li>
<li>ËÄå ReentrantLock ÊîØÊåÅÂ§öÈó¥‰ºëÊÅØÂÆ§ÔºåÊúâ‰∏ìÈó®Á≠âÁÉüÁöÑ‰ºëÊÅØÂÆ§„ÄÅ‰∏ìÈó®Á≠âÊó©È§êÁöÑ‰ºëÊÅØÂÆ§„ÄÅÂî§ÈÜíÊó∂‰πüÊòØÊåâ‰ºëÊÅØÂÆ§Êù•Âî§ÈÜí</li>
</ul>
</li>
</ul>
<ol>
<li>await ÂâçÈúÄË¶ÅËé∑ÂæóÈîÅ</li>
<li>await ÊâßË°åÂêéÔºå‰ºöÈáäÊîæÈîÅÔºåËøõÂÖ• conditionObject Á≠âÂæÖ</li>
<li>await ÁöÑÁ∫øÁ®ãË¢´Âî§ÈÜíÔºàÊàñÊâìÊñ≠„ÄÅÊàñË∂ÖÊó∂ÔºâÂèñÈáçÊñ∞Á´û‰∫â lock ÈîÅ</li>
<li>Á´û‰∫â lock ÈîÅÊàêÂäüÂêéÔºå‰ªé await ÂêéÁªßÁª≠ÊâßË°å</li>
</ol>
<h2 id="15-ÂêåÊ≠•Ê®°Âºè‰πãÈ°∫Â∫èÊéßÂà∂"><a href="#15-ÂêåÊ≠•Ê®°Âºè‰πãÈ°∫Â∫èÊéßÂà∂" class="headerlink" title="15. ÂêåÊ≠•Ê®°Âºè‰πãÈ°∫Â∫èÊéßÂà∂"></a>15. ÂêåÊ≠•Ê®°Âºè‰πãÈ°∫Â∫èÊéßÂà∂</h2><h3 id="15-1-Âõ∫ÂÆöËøêË°åÈ°∫Â∫è"><a href="#15-1-Âõ∫ÂÆöËøêË°åÈ°∫Â∫è" class="headerlink" title="15.1 Âõ∫ÂÆöËøêË°åÈ°∫Â∫è"></a>15.1 Âõ∫ÂÆöËøêË°åÈ°∫Â∫è</h3><p>ÊØîÂ¶ÇÔºåÂøÖÈ°ªÂÖà 2 Âêé 1 ÊâìÂç∞</p>
<p><strong>wait notify Áâà</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Áî®Êù•ÂêåÊ≠•ÁöÑÂØπË±°</span><br><span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><span class="hljs-comment">// t2 ËøêË°åÊ†áËÆ∞Ôºå ‰ª£Ë°® t2 ÊòØÂê¶ÊâßË°åËøá</span><br><span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">t2runed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br> <br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">synchronized</span> (obj) &#123;<br>            <span class="hljs-comment">// Â¶ÇÊûú t2 Ê≤°ÊúâÊâßË°åËøá</span><br>            <span class="hljs-keyword">while</span> (!t2runed) &#123; <br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">// t1 ÂÖàÁ≠â‰∏Ä‰ºö</span><br>                    obj.wait(); <br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                    &#125;<br>            &#125;<br>        &#125;<br>        System.out.println(<span class="hljs-number">1</span>);<br>    &#125;);<br> <br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        System.out.println(<span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">synchronized</span> (obj) &#123;<br>            <span class="hljs-comment">// ‰øÆÊîπËøêË°åÊ†áËÆ∞</span><br>            t2runed = <span class="hljs-literal">true</span>;<br>            <span class="hljs-comment">// ÈÄöÁü• obj ‰∏äÁ≠âÂæÖÁöÑÁ∫øÁ®ãÔºàÂèØËÉΩÊúâÂ§ö‰∏™ÔºåÂõ†Ê≠§ÈúÄË¶ÅÁî® notifyAllÔºâ</span><br>            obj.notifyAll();<br>        &#125;<br>    &#125;);<br> <br>    t1.start();<br>    t2.start();<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>‰πüÂèØ‰ª•‰ΩøÁî®<strong>park Âíå unpark ÊñπÊ≥ï</strong></li>
</ul>
<h3 id="15-2-‰∫§ÊõøËæìÂá∫"><a href="#15-2-‰∫§ÊõøËæìÂá∫" class="headerlink" title="15.2 ‰∫§ÊõøËæìÂá∫"></a>15.2 ‰∫§ÊõøËæìÂá∫</h3><p>Á∫øÁ®ã 1 ËæìÂá∫ a 5 Ê¨°ÔºåÁ∫øÁ®ã 2 ËæìÂá∫ b 5 Ê¨°ÔºåÁ∫øÁ®ã 3 ËæìÂá∫ c 5 Ê¨°„ÄÇÁé∞Âú®Ë¶ÅÊ±ÇËæìÂá∫ abcabcabcabcabc ÊÄé‰πàÂÆûÁé∞</p>
<p><strong>Wait&#x2F;Notify</strong> ÂÆûÁé∞:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Code_32_Test</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">WaitAndNotify</span> <span class="hljs-variable">waitAndNotify</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WaitAndNotify</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>);<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>            waitAndNotify.run(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>        &#125;).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>            waitAndNotify.run(<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br>        &#125;).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>            waitAndNotify.run(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>);<br>        &#125;).start();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WaitAndNotify</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String str, <span class="hljs-type">int</span> flag, <span class="hljs-type">int</span> nextFlag)</span> &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; loopNumber; i++) &#123;<br>            <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) &#123;<br>                <span class="hljs-keyword">while</span> (flag != <span class="hljs-built_in">this</span>.flag) &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-built_in">this</span>.wait();<br>                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                        e.printStackTrace();<br>                    &#125;<br>                &#125;<br>                System.out.print(str);<br>                <span class="hljs-comment">// ËÆæÁΩÆ‰∏ã‰∏Ä‰∏™ËøêË°åÁöÑÁ∫øÁ®ãÊ†áËÆ∞</span><br>                <span class="hljs-built_in">this</span>.flag = nextFlag;<br>                <span class="hljs-comment">// Âî§ÈÜíÊâÄÊúâÁ∫øÁ®ã</span><br>                <span class="hljs-built_in">this</span>.notifyAll();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> flag;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> loopNumber;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WaitAndNotify</span><span class="hljs-params">(<span class="hljs-type">int</span> flag, <span class="hljs-type">int</span> loopNumber)</span> &#123;<br>        <span class="hljs-built_in">this</span>.flag = flag;<br>        <span class="hljs-built_in">this</span>.loopNumber = loopNumber;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><strong>park&#x2F;unpary</strong> ÂÆûÁé∞</li>
<li><strong>await&#x2F;signal</strong> ÂÆûÁé∞</li>
</ul>
<h2 id="16-Êú¨Á´†ÊÄªÁªì"><a href="#16-Êú¨Á´†ÊÄªÁªì" class="headerlink" title="16. Êú¨Á´†ÊÄªÁªì"></a>16. Êú¨Á´†ÊÄªÁªì</h2><p>Êú¨Á´†Êàë‰ª¨ÈúÄË¶ÅÈáçÁÇπÊéåÊè°ÁöÑÊòØ</p>
<ul>
<li>ÂàÜÊûêÂ§öÁ∫øÁ®ãËÆøÈóÆÂÖ±‰∫´ËµÑÊ∫êÊó∂ÔºåÂì™‰∫õ‰ª£Á†ÅÁâáÊÆµÂ±û‰∫é‰∏¥ÁïåÂå∫</li>
<li>‰ΩøÁî® synchronized ‰∫íÊñ•Ëß£ÂÜ≥‰∏¥ÁïåÂå∫ÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢ò<ul>
<li>ÊéåÊè° synchronized ÈîÅÂØπË±°ËØ≠Ê≥ï</li>
<li>ÊéåÊè° synchronzied Âä†ËΩΩÊàêÂëòÊñπÊ≥ïÂíåÈùôÊÄÅÊñπÊ≥ïËØ≠Ê≥ï</li>
<li>ÊéåÊè° wait&#x2F;notify ÂêåÊ≠•ÊñπÊ≥ï</li>
</ul>
</li>
<li>‰ΩøÁî® lock ‰∫íÊñ•Ëß£ÂÜ≥‰∏¥ÁïåÂå∫ÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢ò <ul>
<li>ÊéåÊè° lock ÁöÑ‰ΩøÁî®ÁªÜËäÇÔºöÂèØÊâìÊñ≠„ÄÅÈîÅË∂ÖÊó∂„ÄÅÂÖ¨Âπ≥ÈîÅ„ÄÅÊù°‰ª∂ÂèòÈáè</li>
</ul>
</li>
<li>‰∫ÜËß£Á∫øÁ®ãÊ¥ªË∑ÉÊÄßÈóÆÈ¢òÔºöÊ≠ªÈîÅ„ÄÅÊ¥ªÈîÅ„ÄÅÈ••È•ø</li>
<li><strong>Â∫îÁî®ÊñπÈù¢</strong><ul>
<li>‰∫íÊñ•Ôºö‰ΩøÁî® synchronized Êàñ Lock ËææÂà∞ÂÖ±‰∫´ËµÑÊ∫ê‰∫íÊñ•ÊïàÊûúÔºåÂÆûÁé∞ÂéüÂ≠êÊÄßÊïàÊûúÔºå‰øùËØÅÁ∫øÁ®ãÂÆâÂÖ®„ÄÇ</li>
<li>ÂêåÊ≠•Ôºö‰ΩøÁî® wait&#x2F;notify Êàñ Lock ÁöÑÊù°‰ª∂ÂèòÈáèÊù•ËææÂà∞Á∫øÁ®ãÈó¥ÈÄö‰ø°ÊïàÊûú„ÄÇ</li>
</ul>
</li>
<li><strong>ÂéüÁêÜÊñπÈù¢</strong><ul>
<li>monitor„ÄÅsynchronized „ÄÅwait&#x2F;notify ÂéüÁêÜ</li>
<li>synchronized ËøõÈò∂ÂéüÁêÜ</li>
<li>park &amp; unpark ÂéüÁêÜ</li>
</ul>
</li>
<li><strong>Ê®°ÂºèÊñπÈù¢</strong><ul>
<li>ÂêåÊ≠•Ê®°Âºè‰πã‰øùÊä§ÊÄßÊöÇÂÅú</li>
<li>ÂºÇÊ≠•Ê®°Âºè‰πãÁîü‰∫ßËÄÖÊ∂àË¥πËÄÖ</li>
<li>ÂêåÊ≠•Ê®°Âºè‰πãÈ°∫Â∫èÊéßÂà∂</li>
</ul>
</li>
</ul>
<h1 id="Âõõ-ÂÖ±‰∫´Ê®°Âûã‰πãÂÜÖÂ≠ò-JMM"><a href="#Âõõ-ÂÖ±‰∫´Ê®°Âûã‰πãÂÜÖÂ≠ò-JMM" class="headerlink" title="Âõõ. ÂÖ±‰∫´Ê®°Âûã‰πãÂÜÖÂ≠ò(JMM)"></a>Âõõ. ÂÖ±‰∫´Ê®°Âûã‰πãÂÜÖÂ≠ò(JMM)</h1><h2 id="1-Java-ÂÜÖÂ≠òÊ®°ÂûãÔºàJMMÔºâ"><a href="#1-Java-ÂÜÖÂ≠òÊ®°ÂûãÔºàJMMÔºâ" class="headerlink" title="1. Java ÂÜÖÂ≠òÊ®°ÂûãÔºàJMMÔºâ"></a>1. Java ÂÜÖÂ≠òÊ®°ÂûãÔºàJMMÔºâ</h2><p>JMM Âç≥ Java Memory ModelÔºåÂÆÉÂÆö‰πâ‰∫Ü‰∏ªÂ≠òÔºàÂÖ±‰∫´ÂÜÖÂ≠òÔºâ„ÄÅÂ∑•‰ΩúÂÜÖÂ≠òÔºàÁ∫øÁ®ãÁßÅÊúâÔºâÊäΩË±°Ê¶ÇÂøµÔºåÂ∫ïÂ±ÇÂØπÂ∫îÁùÄ CPU ÂØÑÂ≠òÂô®„ÄÅÁºìÂ≠ò„ÄÅÁ°¨‰ª∂ÂÜÖÂ≠ò„ÄÅ CPU Êåá‰ª§‰ºòÂåñÁ≠â„ÄÇ<br>JMM ‰ΩìÁé∞Âú®‰ª•‰∏ãÂá†‰∏™ÊñπÈù¢:</p>
<ul>
<li><strong>ÂéüÂ≠êÊÄß</strong> - ‰øùËØÅÊåá‰ª§‰∏ç‰ºöÂèóÂà∞Á∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢ÁöÑÂΩ±Âìç</li>
<li><strong>ÂèØËßÅÊÄß</strong> - ‰øùËØÅÊåá‰ª§‰∏ç‰ºöÂèó cpu ÁºìÂ≠òÁöÑÂΩ±Âìç</li>
<li><strong>ÊúâÂ∫èÊÄß</strong> - ‰øùËØÅÊåá‰ª§‰∏ç‰ºöÂèó cpu Êåá‰ª§Âπ∂Ë°å‰ºòÂåñÁöÑÂΩ±Âìç</li>
</ul>
<h2 id="2-ÂèØËßÅÊÄß"><a href="#2-ÂèØËßÅÊÄß" class="headerlink" title="2. ÂèØËßÅÊÄß"></a>2. ÂèØËßÅÊÄß</h2><h3 id="2-1-ÈÄÄ‰∏çÂá∫ÁöÑÂæ™ÁéØ"><a href="#2-1-ÈÄÄ‰∏çÂá∫ÁöÑÂæ™ÁéØ" class="headerlink" title="2.1 ÈÄÄ‰∏çÂá∫ÁöÑÂæ™ÁéØ"></a>2.1 ÈÄÄ‰∏çÂá∫ÁöÑÂæ™ÁéØ</h3><p>ÂÖàÊù•Áúã‰∏Ä‰∏™Áé∞Ë±°Ôºåmain Á∫øÁ®ãÂØπ run ÂèòÈáèÁöÑ‰øÆÊîπÂØπ‰∫é t Á∫øÁ®ã‰∏çÂèØËßÅÔºåÂØºËá¥‰∫Ü t Á∫øÁ®ãÊó†Ê≥ïÂÅúÊ≠¢Ôºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">while</span>(run) &#123;<br><br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>        t1.start();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        log.info(<span class="hljs-string">&quot;t1 Stop&quot;</span>);<br>        run = <span class="hljs-literal">false</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p><strong>ÂéüÂõ†ÂàÜÊûê</strong>Ôºö</p>
<ol>
<li>ÂàùÂßãÁä∂ÊÄÅÔºå t Á∫øÁ®ãÂàöÂºÄÂßã‰ªé‰∏ªÂÜÖÂ≠òËØªÂèñ‰∫Ü run ÁöÑÂÄºÂà∞Â∑•‰ΩúÂÜÖÂ≠ò„ÄÇ</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.4.1.png" srcset="/img/loading.gif" lazyload></p>
<ol start="2">
<li>Âõ†‰∏∫ t Á∫øÁ®ãË¶ÅÈ¢ëÁπÅ‰ªé‰∏ªÂÜÖÂ≠ò‰∏≠ËØªÂèñ run ÁöÑÂÄºÔºåJIT ÁºñËØëÂô®‰ºöÂ∞Ü run ÁöÑÂÄºÁºìÂ≠òËá≥<strong>Ëá™Â∑±Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÁöÑÈ´òÈÄüÁºìÂ≠ò</strong>‰∏≠ÔºåÂáèÂ∞ëÂØπ‰∏ªÂ≠ò‰∏≠ run ÁöÑËÆøÈóÆÔºåÊèêÈ´òÊïàÁéá</li>
<li>1 Áßí‰πãÂêéÔºåmain Á∫øÁ®ã‰øÆÊîπ‰∫Ü run ÁöÑÂÄºÔºåÂπ∂ÂêåÊ≠•Ëá≥‰∏ªÂ≠òÔºåËÄå t ÊòØ‰ªéËá™Â∑±Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÁöÑÈ´òÈÄüÁºìÂ≠ò‰∏≠ËØªÂèñËøô‰∏™ÂèòÈáèÁöÑÂÄºÔºåÁªìÊûúÊ∞∏ËøúÊòØÊóßÂÄº</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.4.2.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>Ëß£ÂÜ≥ÊñπÊ≥ï</strong>Ôºö</p>
<ul>
<li>‰ΩøÁî® <strong>volatile</strong> ÔºàÊòìÂèòÂÖ≥ÈîÆÂ≠óÔºâ</li>
<li>ÂÆÉÂèØ‰ª•Áî®Êù•‰øÆÈ•∞ÊàêÂëòÂèòÈáèÂíåÈùôÊÄÅÊàêÂëòÂèòÈáèÔºàÊîæÂú®‰∏ªÂ≠ò‰∏≠ÁöÑÂèòÈáèÔºâÔºå‰ªñ<strong>ÂèØ‰ª•ÈÅøÂÖçÁ∫øÁ®ã‰ªéËá™Â∑±ÁöÑÂ∑•‰ΩúÁºìÂ≠ò‰∏≠Êü•ÊâæÂèòÈáèÁöÑÂÄºÔºåÂøÖÈ°ªÂà∞‰∏ªÂ≠ò‰∏≠Ëé∑ÂèñÂÆÉÁöÑÂÄº</strong>ÔºåÁ∫øÁ®ãÊìç‰Ωú volatile ÂèòÈáèÈÉΩÊòØ<strong>Áõ¥Êé•Êìç‰Ωú‰∏ªÂ≠ò</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// ‰øùËØÅÂÜÖÂ≠òÁöÑÂèØËßÅÊÄß</span><br></code></pre></td></tr></table></figure>

<h3 id="2-2-ÂèØËßÅÊÄßÂíåÂéüÂ≠êÊÄß"><a href="#2-2-ÂèØËßÅÊÄßÂíåÂéüÂ≠êÊÄß" class="headerlink" title="2.2 ÂèØËßÅÊÄßÂíåÂéüÂ≠êÊÄß"></a>2.2 ÂèØËßÅÊÄßÂíåÂéüÂ≠êÊÄß</h3><ul>
<li>ÂèØËßÅÊÄß‰øùËØÅÁöÑÊòØÂú®Â§ö‰∏™Á∫øÁ®ã‰πãÈó¥Ôºå‰∏Ä‰∏™Á∫øÁ®ãÂØπvolatileÂèòÈáèÁöÑ‰øÆÊîπÂØπÂè¶‰∏Ä‰∏™Á∫øÁ®ãÂèØËßÅÔºå<strong>‰∏çËÉΩ‰øùËØÅÂéüÂ≠êÊÄß</strong></li>
<li><strong>volatile</strong>Ôºö ‰ªÖÁî®Âú®<strong>‰∏Ä‰∏™ÂÜôÁ∫øÁ®ãÔºåÂ§ö‰∏™ËØªÁ∫øÁ®ã</strong>ÁöÑÊÉÖÂÜµ„ÄÇ</li>
<li><strong>synchronized</strong>ËØ≠Âè•ÂùóÔºö<strong>Êó¢ÂèØ‰ª•‰øùËØÅ‰ª£Á†ÅÂùóÁöÑÂéüÂ≠êÊÄß</strong>Ôºå<strong>‰πüÂêåÊó∂‰øùËØÅ‰ª£Á†ÅÂùóÂÜÖÂèòÈáèÁöÑÂèØËßÅÊÄß</strong>„ÄÇ‰ΩÜÁº∫ÁÇπÊòØsynchronized ÊòØÂ±û‰∫éÈáçÈáèÁ∫ßÊìç‰ΩúÔºå<strong>ÊÄßËÉΩÁõ∏ÂØπÊõ¥‰Ωé</strong></li>
</ul>
<h2 id="3-Ê®°Âºè‰πã‰∏§Èò∂ÊÆµÁªàÊ≠¢"><a href="#3-Ê®°Âºè‰πã‰∏§Èò∂ÊÆµÁªàÊ≠¢" class="headerlink" title="3. Ê®°Âºè‰πã‰∏§Èò∂ÊÆµÁªàÊ≠¢"></a>3. Ê®°Âºè‰πã‰∏§Èò∂ÊÆµÁªàÊ≠¢</h2><p>‰ΩøÁî® <strong>volatile</strong> ÂÖ≥ÈîÆÂ≠óÊù•ÂÆûÁé∞‰∏§Èò∂ÊÆµÁªàÊ≠¢Ê®°Âºè</p>
<ul>
<li>ÂÅúÊ≠¢Ê†áËÆ∞Áî® volatile ÊòØ‰∏∫‰∫Ü‰øùËØÅËØ•ÂèòÈáèÂú®Â§ö‰∏™Á∫øÁ®ã‰πãÈó¥ÁöÑÂèØËßÅÊÄß</li>
<li>Êàë‰ª¨ÁöÑ‰æãÂ≠ê‰∏≠ÔºåÂç≥‰∏ªÁ∫øÁ®ãÊääÂÆÉ‰øÆÊîπ‰∏∫ true ÂØπ t1 Á∫øÁ®ãÂèØËßÅ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Monitor</span> &#123;<br>	Thread monitor;<br>	<span class="hljs-comment">// ËÆæÁΩÆÊ†áËÆ∞ÔºåÁî®‰∫éÂà§Êñ≠ÊòØÂê¶Ë¢´ÁªàÊ≠¢‰∫Ü</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">stop</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * ÂêØÂä®ÁõëÊéßÂô®Á∫øÁ®ã</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-comment">// ËÆæÁΩÆÁ∫øÊéßÂô®Á∫øÁ®ãÔºåÁî®‰∫éÁõëÊéßÁ∫øÁ®ãÁä∂ÊÄÅ</span><br>		monitor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>() &#123;<br>			<span class="hljs-meta">@Override</span><br>			<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>				<span class="hljs-comment">// ÂºÄÂßã‰∏çÂÅúÁöÑÁõëÊéß</span><br>				<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>					<span class="hljs-keyword">if</span>(stop) &#123;<br>						System.out.println(<span class="hljs-string">&quot;Â§ÑÁêÜÂêéÁª≠‰ªªÂä°&quot;</span>);<br>						<span class="hljs-keyword">break</span>;<br>					&#125;<br>					System.out.println(<span class="hljs-string">&quot;ÁõëÊéßÂô®ËøêË°å‰∏≠...&quot;</span>);<br>					<span class="hljs-keyword">try</span> &#123;<br>						<span class="hljs-comment">// Á∫øÁ®ã‰ºëÁú†</span><br>						Thread.sleep(<span class="hljs-number">1000</span>);<br>					&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>						System.out.println(<span class="hljs-string">&quot;Ë¢´ÊâìÊñ≠‰∫Ü&quot;</span>);<br>					&#125;<br>				&#125;<br>			&#125;<br>		&#125;;<br>		monitor.start();<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 	Áî®‰∫éÂÅúÊ≠¢ÁõëÊéßÂô®Á∫øÁ®ã</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> &#123;<br>		<span class="hljs-comment">// ‰øÆÊîπÊ†áËÆ∞</span><br>		stop = <span class="hljs-literal">true</span>;<br>		<span class="hljs-comment">// ÊâìÊñ≠Á∫øÁ®ã</span><br>		monitor.interrupt();        <br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4-ÂêåÊ≠•Ê®°Âºè‰πã-Balking"><a href="#4-ÂêåÊ≠•Ê®°Âºè‰πã-Balking" class="headerlink" title="4. ÂêåÊ≠•Ê®°Âºè‰πã Balking"></a>4. ÂêåÊ≠•Ê®°Âºè‰πã Balking</h2><p>Balking ÔºàÁäπË±´ÔºâÊ®°ÂºèÁî®Âú®‰∏Ä‰∏™Á∫øÁ®ãÂèëÁé∞Âè¶‰∏Ä‰∏™Á∫øÁ®ãÊàñÊú¨Á∫øÁ®ãÂ∑≤ÁªèÂÅö‰∫ÜÊüê‰∏Ä‰ª∂Áõ∏ÂêåÁöÑ‰∫ãÔºåÈÇ£‰πàÊú¨Á∫øÁ®ãÂ∞±Êó†ÈúÄÂÜçÂÅö‰∫ÜÔºåÁõ¥Êé•ÁªìÊùüËøîÂõû</p>
<ul>
<li>Áî®‰∏Ä‰∏™Ê†áËÆ∞Êù•Âà§Êñ≠ËØ•‰ªªÂä°ÊòØÂê¶Â∑≤ÁªèË¢´ÊâßË°åËøá‰∫Ü</li>
<li>ÈúÄË¶ÅÈÅøÂÖçÁ∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢ò</li>
<li>Âä†ÈîÅÁöÑ‰ª£Á†ÅÂùóË¶ÅÂ∞ΩÈáèÁöÑÂ∞èÔºå‰ª•‰øùËØÅÊÄßËÉΩ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitorService</span> &#123;<br> <br>    <span class="hljs-comment">// Áî®Êù•Ë°®Á§∫ÊòØÂê¶Â∑≤ÁªèÊúâÁ∫øÁ®ãÂ∑≤ÁªèÂú®ÊâßË°åÂêØÂä®‰∫Ü</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> starting;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;<br>        log.info(<span class="hljs-string">&quot;Â∞ùËØïÂêØÂä®ÁõëÊéßÁ∫øÁ®ã...&quot;</span>);<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">if</span> (starting) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            starting = <span class="hljs-literal">true</span>;<br>        &#125;<br>        <br>        <span class="hljs-comment">// ÁúüÊ≠£ÂêØÂä®ÁõëÊéßÁ∫øÁ®ã...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ÂÆÉËøòÁªèÂ∏∏Áî®Êù•ÂÆûÁé∞Á∫øÁ®ãÂÆâÂÖ®ÁöÑÂçï‰æã:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> INSTANCE;<br>        &#125;<br>        <br>        INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-ÊúâÂ∫èÊÄß"><a href="#5-ÊúâÂ∫èÊÄß" class="headerlink" title="5. ÊúâÂ∫èÊÄß"></a>5. ÊúâÂ∫èÊÄß</h2><h3 id="5-1-Êåá‰ª§ÈáçÊéí"><a href="#5-1-Êåá‰ª§ÈáçÊéí" class="headerlink" title="5.1 Êåá‰ª§ÈáçÊéí"></a>5.1 Êåá‰ª§ÈáçÊéí</h3><p>JVM ‰ºöÂú®‰∏çÂΩ±ÂìçÊ≠£Á°ÆÊÄßÁöÑÂâçÊèê‰∏ãÔºåÂèØ‰ª•Ë∞ÉÊï¥ËØ≠Âè•ÁöÑÊâßË°åÈ°∫Â∫è</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> i;<br><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> j;<br> <br><span class="hljs-comment">// Âú®Êüê‰∏™Á∫øÁ®ãÂÜÖÊâßË°åÂ¶Ç‰∏ãËµãÂÄºÊìç‰Ωú</span><br>i = ...; <br>j = ...;<br></code></pre></td></tr></table></figure>

<p><strong>Êåá‰ª§ÈáçÊéí</strong>ÔºöÂèØËÉΩÂÖàÊâßË°åiÔºåÂÜçÊâßË°åjÔºõ‰πüÂèØËÉΩÂÖàÊâßË°åjÔºåÂÜçÊâßË°åi</p>
<ul>
<li>Êåá‰ª§ÈáçÊéíÔºöÂú®Á®ãÂ∫èÁªìÊûú‰∏çÂèóÂΩ±ÂìçÁöÑÂâçÊèê‰∏ãÔºåÂèØ‰ª•Ë∞ÉÊï¥Êåá‰ª§ËØ≠Âè•ÊâßË°åÈ°∫Â∫è</li>
<li>Â§öÁ∫øÁ®ã‰∏ã„ÄéÊåá‰ª§ÈáçÊéí„Äè‰ºöÂΩ±ÂìçÊ≠£Á°ÆÊÄß</li>
</ul>
<h3 id="5-2-Ëß£ÂÜ≥ÊñπÊ≥ï"><a href="#5-2-Ëß£ÂÜ≥ÊñπÊ≥ï" class="headerlink" title="5.2 Ëß£ÂÜ≥ÊñπÊ≥ï"></a>5.2 Ëß£ÂÜ≥ÊñπÊ≥ï</h3><p><strong>volatile</strong>‰øÆÈ•∞ÁöÑÂèòÈáèÔºåÂèØ‰ª•Á¶ÅÁî®Êåá‰ª§ÈáçÊéíÔºåÁ¶ÅÊ≠¢ÁöÑÊòØ<strong>Âä† volatile ÂÖ≥ÈîÆÂ≠óÂèòÈáè‰πãÂâçÁöÑ‰ª£Á†Å</strong>ÈáçÊéíÂ∫è</p>
<h2 id="6-volatile-ÂéüÁêÜ"><a href="#6-volatile-ÂéüÁêÜ" class="headerlink" title="6. volatile ÂéüÁêÜ"></a>6. volatile ÂéüÁêÜ</h2><p>volatile ÁöÑÂ∫ïÂ±ÇÂÆûÁé∞ÂéüÁêÜÊòØ<strong>ÂÜÖÂ≠òÂ±èÈöú</strong>ÔºåMemory BarrierÔºàMemory FenceÔºâ</p>
<ul>
<li>ÂØπ volatile ÂèòÈáèÁöÑ<strong>ÂÜôÊåá‰ª§Âêé</strong>‰ºöÂä†ÂÖ•ÂÜôÂ±èÈöú</li>
<li>ÂØπ volatile ÂèòÈáèÁöÑ<strong>ËØªÊåá‰ª§Ââç</strong>‰ºöÂä†ÂÖ•ËØªÂ±èÈöú</li>
</ul>
<h3 id="6-1-Â¶Ç‰Ωï‰øùËØÅÂèØËßÅÊÄß"><a href="#6-1-Â¶Ç‰Ωï‰øùËØÅÂèØËßÅÊÄß" class="headerlink" title="6.1 Â¶Ç‰Ωï‰øùËØÅÂèØËßÅÊÄß"></a>6.1 Â¶Ç‰Ωï‰øùËØÅÂèØËßÅÊÄß</h3><p>ÂÜôÂ±èÈöúÔºàsfenceÔºâ‰øùËØÅÂú®<strong>ËØ•Â±èÈöú‰πãÂâçÁöÑ</strong>ÔºåÂØπÂÖ±‰∫´ÂèòÈáèÁöÑ<strong>ÊîπÂä®ÔºåÈÉΩÂêåÊ≠•Âà∞‰∏ªÂ≠ò</strong>ÂΩì‰∏≠</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">actor2</span><span class="hljs-params">(I_Result r)</span> &#123;<br>     num = <span class="hljs-number">2</span>;<br>     ready = <span class="hljs-literal">true</span>; <span class="hljs-comment">// ready ÊòØË¢´ volatile ‰øÆÈ•∞ÁöÑÔºåËµãÂÄºÂ∏¶ÂÜôÂ±èÈöú</span><br>     <span class="hljs-comment">// ÂÜôÂ±èÈöú</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>ËÄåËØªÂ±èÈöúÔºàlfenceÔºâ‰øùËØÅÂú®<strong>ËØ•Â±èÈöú‰πãÂêé</strong>ÔºåÂØπÂÖ±‰∫´ÂèòÈáèÁöÑ<strong>ËØªÂèñÔºåÂä†ËΩΩÁöÑÊòØ‰∏ªÂ≠ò‰∏≠ÊúÄÊñ∞Êï∞ÊçÆ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">actor1</span><span class="hljs-params">(I_Result r)</span> &#123;<br> <span class="hljs-comment">// ËØªÂ±èÈöú</span><br> <span class="hljs-comment">// readyÊòØË¢´ volatile ‰øÆÈ•∞ÁöÑÔºåËØªÂèñÂÄºÂ∏¶ËØªÂ±èÈöú</span><br> <span class="hljs-keyword">if</span>(ready) &#123;<br> 	r.r1 = num + num;<br> &#125; <span class="hljs-keyword">else</span> &#123;<br> 	r.r1 = <span class="hljs-number">1</span>;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/img/blogs/java/jvm-juc/juc.4.3.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="6-2-Â¶Ç‰Ωï‰øùËØÅÊúâÂ∫èÊÄß"><a href="#6-2-Â¶Ç‰Ωï‰øùËØÅÊúâÂ∫èÊÄß" class="headerlink" title="6.2 Â¶Ç‰Ωï‰øùËØÅÊúâÂ∫èÊÄß"></a>6.2 Â¶Ç‰Ωï‰øùËØÅÊúâÂ∫èÊÄß</h3><p>ÂÜôÂ±èÈöú‰ºöÁ°Æ‰øùÊåá‰ª§ÈáçÊéíÂ∫èÊó∂Ôºå‰∏ç‰ºöÂ∞ÜÂÜôÂ±èÈöú‰πãÂâçÁöÑ‰ª£Á†ÅÊéíÂú®ÂÜôÂ±èÈöú‰πãÂêé</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">actor2</span><span class="hljs-params">(I_Result r)</span> &#123;<br> num = <span class="hljs-number">2</span>;<br> ready = <span class="hljs-literal">true</span>; <span class="hljs-comment">// ready ÊòØË¢´ volatile ‰øÆÈ•∞ÁöÑÔºåËµãÂÄºÂ∏¶ÂÜôÂ±èÈöú</span><br> <span class="hljs-comment">// ÂÜôÂ±èÈöú</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>ËØªÂ±èÈöú‰ºöÁ°Æ‰øùÊåá‰ª§ÈáçÊéíÂ∫èÊó∂Ôºå‰∏ç‰ºöÂ∞ÜËØªÂ±èÈöú‰πãÂêéÁöÑ‰ª£Á†ÅÊéíÂú®ËØªÂ±èÈöú‰πãÂâç</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">actor1</span><span class="hljs-params">(I_Result r)</span> &#123;<br> <span class="hljs-comment">// ËØªÂ±èÈöú</span><br> <span class="hljs-comment">// ready ÊòØË¢´ volatile ‰øÆÈ•∞ÁöÑÔºåËØªÂèñÂÄºÂ∏¶ËØªÂ±èÈöú</span><br> <span class="hljs-keyword">if</span>(ready) &#123;<br> 	r.r1 = num + num;<br> &#125; <span class="hljs-keyword">else</span> &#123;<br> 	r.r1 = <span class="hljs-number">1</span>;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/img/blogs/java/jvm-juc/juc.4.4.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>volatile‰∏çËÉΩËß£ÂÜ≥Êåá‰ª§‰∫§Èîô<ul>
<li>ÂÜôÂ±èÈöú‰ªÖ‰ªÖÊòØ‰øùËØÅ‰πãÂêéÁöÑËØªËÉΩÂ§üËØªÂà∞ÊúÄÊñ∞ÁöÑÁªìÊûúÔºå‰ΩÜ‰∏çËÉΩ‰øùËØÅËØªË∑ëÂà∞ÂÆÉÂâçÈù¢Âéª</li>
<li>ËÄåÊúâÂ∫èÊÄßÁöÑ‰øùËØÅ‰πüÂè™ÊòØ<strong>‰øùËØÅ‰∫ÜÊú¨Á∫øÁ®ãÂÜÖÁõ∏ÂÖ≥‰ª£Á†Å‰∏çË¢´ÈáçÊéíÂ∫è</strong></li>
</ul>
</li>
</ul>
<h2 id="7-double-checked-locking"><a href="#7-double-checked-locking" class="headerlink" title="7. double-checked locking"></a>7. double-checked locking</h2><p><strong>ÈóÆÈ¢ò</strong>Ôºö‰ºöÂá∫Áé∞Êåá‰ª§ÈáçÊéíÁöÑÁé∞Ë±°Ôºå‰ªéËÄåÂØºËá¥Âá∫Áé∞ÊúâÂ∫èÊÄßÈóÆÈ¢ò</p>
<p><strong>Ëß£ÂÜ≥ÊñπÊ°à</strong>ÔºöÂä†‰∏ävolatile</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123; &#125;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-comment">// ÂÆû‰æãÊ≤°ÂàõÂª∫ÔºåÊâç‰ºöËøõÂÖ•ÂÜÖÈÉ®ÁöÑ synchronized‰ª£Á†ÅÂùó</span><br>            <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123; <span class="hljs-comment">// t2</span><br>                    <span class="hljs-comment">// ‰πüËÆ∏ÊúâÂÖ∂ÂÆÉÁ∫øÁ®ãÂ∑≤ÁªèÂàõÂª∫ÂÆû‰æãÔºåÊâÄ‰ª•ÂÜçÂà§Êñ≠‰∏ÄÊ¨°</span><br>                    <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// t1</span><br>                        INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> INSTANCE;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ÂèØËßÅÊÄß<ul>
<li>ÂÜôÂ±èÈöú‰øùËØÅÂú®ËØ•Â±èÈöú‰πãÂâçÁöÑ t1 ÂØπÂÖ±‰∫´ÂèòÈáèÁöÑÊîπÂä®ÔºåÈÉΩÂêåÊ≠•Âà∞‰∏ªÂ≠òÂΩì‰∏≠</li>
<li>ËÄåËØªÂ±èÈöú‰øùËØÅÂú®ËØ•Â±èÈöú‰πãÂêé t2 ÂØπÂÖ±‰∫´ÂèòÈáèÁöÑËØªÂèñÔºåÂä†ËΩΩÁöÑÊòØ‰∏ªÂ≠ò‰∏≠ÊúÄÊñ∞Êï∞ÊçÆ</li>
</ul>
</li>
<li>ÊúâÂ∫èÊÄß<ul>
<li>ÂÜôÂ±èÈöú‰ºöÁ°Æ‰øùÊåá‰ª§ÈáçÊéíÂ∫èÊó∂Ôºå‰∏ç‰ºöÂ∞ÜÂÜôÂ±èÈöú‰πãÂâçÁöÑ‰ª£Á†ÅÊéíÂú®ÂÜôÂ±èÈöú‰πãÂêé</li>
<li>ËØªÂ±èÈöú‰ºöÁ°Æ‰øùÊåá‰ª§ÈáçÊéíÂ∫èÊó∂Ôºå‰∏ç‰ºöÂ∞ÜËØªÂ±èÈöú‰πãÂêéÁöÑ‰ª£Á†ÅÊéíÂú®ËØªÂ±èÈöú‰πãÂâç</li>
</ul>
</li>
</ul>
<h2 id="8-happens-before"><a href="#8-happens-before" class="headerlink" title="8. happens-before"></a>8. happens-before</h2><p>happens-before <strong>ËßÑÂÆö‰∫ÜÂØπÂÖ±‰∫´ÂèòÈáèÁöÑÂÜôÊìç‰ΩúÂØπÂÖ∂ÂÆÉÁ∫øÁ®ãÁöÑËØªÊìç‰ΩúÂèØËßÅ</strong>ÔºåÂÆÉÊòØ<strong>ÂèØËßÅÊÄß‰∏éÊúâÂ∫èÊÄßÁöÑ‰∏ÄÂ•óËßÑÂàôÊÄªÁªì</strong>ÔºåÊäõÂºÄ‰ª•‰∏ã happens-before ËßÑÂàôÔºåJMM Âπ∂‰∏çËÉΩ‰øùËØÅ‰∏Ä‰∏™Á∫øÁ®ãÂØπÂÖ±‰∫´ÂèòÈáèÁöÑÂÜôÔºåÂØπ‰∫éÂÖ∂ÂÆÉÁ∫øÁ®ãÂØπËØ•ÂÖ±‰∫´ÂèòÈáèÁöÑËØªÂèØËßÅ</p>
<ul>
<li>Á∫øÁ®ã<strong>Ëß£ÈîÅ m ‰πãÂâç</strong>ÂØπÂèòÈáèÁöÑÂÜôÔºåÂØπ‰∫é<strong>Êé•‰∏ãÊù•ÂØπ m Âä†ÈîÅ</strong>ÁöÑÂÖ∂ÂÆÉÁ∫øÁ®ãÂØπËØ•ÂèòÈáèÁöÑ<strong>ËØªÂèØËßÅ</strong></li>
<li>Á∫øÁ®ãÂØπ <strong>volatile ÂèòÈáèÁöÑÂÜô</strong>ÔºåÂØπÊé•‰∏ãÊù•ÂÖ∂ÂÆÉÁ∫øÁ®ãÂØπËØ•ÂèòÈáèÁöÑ<strong>ËØªÂèØËßÅ</strong></li>
<li>Á∫øÁ®ã <strong>start ÂâçÂØπÂèòÈáèÁöÑÂÜô</strong>ÔºåÂØπËØ•Á∫øÁ®ãÂºÄÂßãÂêéÂØπËØ•ÂèòÈáèÁöÑ<strong>ËØªÂèØËßÅ</strong></li>
<li>Á∫øÁ®ã<strong>ÁªìÊùüÂâçÂØπÂèòÈáèÁöÑÂÜô</strong>ÔºåÂØπÂÖ∂ÂÆÉÁ∫øÁ®ã<strong>ÂæóÁü•ÂÆÉÁªìÊùüÂêéÁöÑËØªÂèØËßÅ</strong>ÔºàÊØîÂ¶ÇÂÖ∂ÂÆÉÁ∫øÁ®ãË∞ÉÁî® t1.isAlive() Êàñ t1.join()Á≠âÂæÖÂÆÉÁªìÊùüÔºâ</li>
<li><strong>Á∫øÁ®ã t1 ÊâìÊñ≠ t2ÔºàinterruptÔºâÂâçÂØπÂèòÈáèÁöÑÂÜô</strong>ÔºåÂØπ‰∫éÂÖ∂‰ªñÁ∫øÁ®ãÂæóÁü• t2 Ë¢´ÊâìÊñ≠ÂêéÂØπÂèòÈáèÁöÑ<strong>ËØªÂèØËßÅ</strong>ÔºàÈÄöËøá t2.interrupted Êàñ t2.isInterruptedÔºâ</li>
<li>ÂØπÂèòÈáè<strong>ÈªòËÆ§ÂÄº</strong>Ôºà0ÔºåfalseÔºånullÔºâÁöÑÂÜôÔºåÂØπÂÖ∂ÂÆÉÁ∫øÁ®ãÂØπËØ•ÂèòÈáèÁöÑ<strong>ËØªÂèØËßÅ</strong></li>
<li><strong>ÂÖ∑Êúâ‰º†ÈÄíÊÄß</strong>ÔºåÂ¶ÇÊûú x hb-&gt; y Âπ∂‰∏î y hb-&gt; z ÈÇ£‰πàÊúâ x hb-&gt; z ÔºåÈÖçÂêà volatile ÁöÑÈò≤Êåá‰ª§ÈáçÊéí</li>
</ul>
<h2 id="9-ÊÄªÁªì"><a href="#9-ÊÄªÁªì" class="headerlink" title="9. ÊÄªÁªì"></a>9. ÊÄªÁªì</h2><ul>
<li><p><strong>synchronized</strong>ËÉΩ‰øùËØÅ‰ª£Á†ÅÁöÑ<strong>ÂéüÂ≠êÊÄß„ÄÅÂèØËßÅÊÄß„ÄÅÊúâÂ∫èÊÄß</strong></p>
</li>
<li><p><strong>volatile</strong>ËÉΩ‰øùËØÅ‰ª£Á†ÅÁöÑ<strong>ÂèØËßÅÊÄßÂíåÊúâÂ∫èÊÄß</strong></p>
</li>
<li><p>ÂèØËßÅÊÄß - Áî± <strong>JVM ÁºìÂ≠ò‰ºòÂåñ</strong>ÂºïËµ∑</p>
</li>
<li><p>ÊúâÂ∫èÊÄß - Áî± <strong>JVM Êåá‰ª§ÈáçÊéíÂ∫è‰ºòÂåñ</strong>ÂºïËµ∑</p>
</li>
</ul>
<h1 id="‰∫î-ÂÖ±‰∫´Ê®°Âûã‰πãÊó†ÈîÅ"><a href="#‰∫î-ÂÖ±‰∫´Ê®°Âûã‰πãÊó†ÈîÅ" class="headerlink" title="‰∫î. ÂÖ±‰∫´Ê®°Âûã‰πãÊó†ÈîÅ"></a>‰∫î. ÂÖ±‰∫´Ê®°Âûã‰πãÊó†ÈîÅ</h1><p>ÈÄöËøá<strong>ÈùûÈòªÂ°ûÂºèÁöÑ‰πêËßÇÈîÅ</strong>ÁöÑÊù•ÂÆûÁé∞Âπ∂ÂèëÊéßÂà∂</p>
<h2 id="1-CAS‰∏évolatile"><a href="#1-CAS‰∏évolatile" class="headerlink" title="1. CAS‰∏évolatile"></a>1. CAS‰∏évolatile</h2><h3 id="1-1-CAS-compareAndSet"><a href="#1-1-CAS-compareAndSet" class="headerlink" title="1.1 CAS(compareAndSet)"></a>1.1 CAS(compareAndSet)</h3><p><strong>compareAndSet</strong>ÔºåÂÆÉÁöÑÁÆÄÁß∞Â∞±ÊòØ CAS Ôºà‰πüÊúâ Compare And Swap ÁöÑËØ¥Ê≥ïÔºâÔºåÂÆÉÂøÖÈ°ªÊòØÂéüÂ≠êÊìç‰Ωú„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">withdraw</span><span class="hljs-params">(Integer amount)</span> &#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-comment">// ÈúÄË¶Å‰∏çÊñ≠Â∞ùËØïÔºåÁõ¥Âà∞ÊàêÂäü‰∏∫Ê≠¢</span><br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-comment">// ÊØîÂ¶ÇÊãøÂà∞‰∫ÜÊóßÂÄº 1000</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> balance.get();<br>            <span class="hljs-comment">// Âú®Ëøô‰∏™Âü∫Á°Ä‰∏ä 1000-10 = 990</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> prev - amount;<br>            <span class="hljs-comment">/*</span><br><span class="hljs-comment">        compareAndSet Ê≠£ÊòØÂÅöËøô‰∏™Ê£ÄÊü•ÔºåÂú® set ÂâçÔºåÂÖàÊØîËæÉ prev ‰∏éÂΩìÂâçÂÄº</span><br><span class="hljs-comment">        - ‰∏ç‰∏ÄËá¥‰∫ÜÔºånext ‰ΩúÂ∫üÔºåËøîÂõû false Ë°®Á§∫Â§±Ë¥•</span><br><span class="hljs-comment">           ÊØîÂ¶ÇÔºåÂà´ÁöÑÁ∫øÁ®ãÂ∑≤ÁªèÂÅö‰∫ÜÂáèÊ≥ïÔºåÂΩìÂâçÂÄºÂ∑≤ÁªèË¢´ÂáèÊàê‰∫Ü 990</span><br><span class="hljs-comment">           ÈÇ£‰πàÊú¨Á∫øÁ®ãÁöÑËøôÊ¨° 990 Â∞±‰ΩúÂ∫ü‰∫ÜÔºåËøõÂÖ• while ‰∏ãÊ¨°Âæ™ÁéØÈáçËØï</span><br><span class="hljs-comment">        - ‰∏ÄËá¥Ôºå‰ª• next ËÆæÁΩÆ‰∏∫Êñ∞ÂÄºÔºåËøîÂõû true Ë°®Á§∫ÊàêÂäü</span><br><span class="hljs-comment">        */</span><br>            <span class="hljs-keyword">if</span> (balance.compareAndSet(prev, next)) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/img/blogs/java/jvm-juc/juc.5.1.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>CAS ÁöÑÂ∫ïÂ±ÇÊòØ  lock cmpxchg  Êåá‰ª§ÔºàX86 Êû∂ÊûÑÔºâÔºåÂú®ÂçïÊ†∏ CPU ÂíåÂ§öÊ†∏ CPU ‰∏ãÈÉΩËÉΩÂ§ü‰øùËØÅ„ÄêÊØîËæÉ-‰∫§Êç¢„ÄëÁöÑÂéüÂ≠êÊÄß</li>
</ul>
<h3 id="1-2-volatile"><a href="#1-2-volatile" class="headerlink" title="1.2 volatile"></a>1.2 volatile</h3><ul>
<li>‰∏∫‰∫Ü‰øùËØÅËØ•ÂèòÈáèÁöÑÂèØËßÅÊÄßÔºåÈúÄË¶Å‰ΩøÁî® volatile ‰øÆÈ•∞„ÄÇ</li>
<li><strong>CAS ÂøÖÈ°ªÂÄüÂä© volatile ÊâçËÉΩËØªÂèñÂà∞ÂÖ±‰∫´ÂèòÈáèÁöÑÊúÄÊñ∞ÂÄºÊù•ÂÆûÁé∞„ÄêÊØîËæÉÂπ∂‰∫§Êç¢„ÄëÁöÑÊïàÊûú</strong></li>
</ul>
<h3 id="1-3-‰∏∫‰ªÄ‰πàÊó†ÈîÅÊïàÁéáÈ´ò"><a href="#1-3-‰∏∫‰ªÄ‰πàÊó†ÈîÅÊïàÁéáÈ´ò" class="headerlink" title="1.3 ‰∏∫‰ªÄ‰πàÊó†ÈîÅÊïàÁéáÈ´ò"></a>1.3 ‰∏∫‰ªÄ‰πàÊó†ÈîÅÊïàÁéáÈ´ò</h3><ul>
<li>Êó†ÈîÅÊÉÖÂÜµ‰∏ãÔºåÂç≥‰ΩøÈáçËØïÂ§±Ë¥•ÔºåÁ∫øÁ®ãÂßãÁªàÂú®È´òÈÄüËøêË°åÔºåÊ≤°ÊúâÂÅúÊ≠á</li>
<li>ËÄå synchronized ‰ºöËÆ©Á∫øÁ®ãÂú®Ê≤°ÊúâËé∑ÂæóÈîÅÁöÑÊó∂ÂÄôÔºåÂèëÁîü‰∏ä‰∏ãÊñáÂàáÊç¢ÔºåËøõÂÖ•ÈòªÂ°û„ÄÇ</li>
</ul>
<h3 id="1-4-CAS-ÁöÑÁâπÁÇπ"><a href="#1-4-CAS-ÁöÑÁâπÁÇπ" class="headerlink" title="1.4 CAS ÁöÑÁâπÁÇπ"></a>1.4 CAS ÁöÑÁâπÁÇπ</h3><p>ÁªìÂêà CAS Âíå volatile ÂèØ‰ª•ÂÆûÁé∞Êó†ÈîÅÂπ∂ÂèëÔºå<strong>ÈÄÇÁî®‰∫éÁ∫øÁ®ãÊï∞Â∞ë„ÄÅÂ§öÊ†∏ CPU</strong> ÁöÑÂú∫ÊôØ‰∏ã„ÄÇ</p>
<ul>
<li>CAS ÊòØÂü∫‰∫é<strong>‰πêËßÇÈîÅ</strong>ÁöÑÊÄùÊÉ≥ÔºöÊúÄ‰πêËßÇÁöÑ‰º∞ËÆ°Ôºå‰∏çÊÄïÂà´ÁöÑÁ∫øÁ®ãÊù•‰øÆÊîπÂÖ±‰∫´ÂèòÈáèÔºåÂ∞±ÁÆóÊîπ‰∫Ü‰πüÊ≤°ÂÖ≥Á≥ªÔºåÊàëÂêÉ‰∫èÁÇπÂÜçÈáçËØïÂëó„ÄÇ</li>
<li>synchronized ÊòØÂü∫‰∫é<strong>ÊÇ≤ËßÇÈîÅ</strong>ÁöÑÊÄùÊÉ≥ÔºöÊúÄÊÇ≤ËßÇÁöÑ‰º∞ËÆ°Ôºå<strong>ÂæóÈò≤ÁùÄÂÖ∂ÂÆÉÁ∫øÁ®ãÊù•‰øÆÊîπÂÖ±‰∫´ÂèòÈáè</strong>ÔºåÊàë‰∏ä‰∫ÜÈîÅ‰Ω†‰ª¨ÈÉΩÂà´ÊÉ≥ÊîπÔºåÊàëÊîπÂÆå‰∫ÜËß£ÂºÄÈîÅÔºå‰Ω†‰ª¨ÊâçÊúâÊú∫‰ºö„ÄÇ</li>
<li>CAS ‰ΩìÁé∞ÁöÑÊòØ<strong>Êó†ÈîÅÂπ∂Âèë„ÄÅÊó†ÈòªÂ°ûÂπ∂Âèë</strong><ul>
<li>Âõ†‰∏∫Ê≤°Êúâ‰ΩøÁî® synchronizedÔºåÊâÄ‰ª•Á∫øÁ®ã‰∏ç‰ºöÈô∑ÂÖ•ÈòªÂ°ûÔºåËøôÊòØÊïàÁéáÊèêÂçáÁöÑÂõ†Á¥†‰πã‰∏Ä</li>
<li>‰ΩÜÂ¶ÇÊûúÁ´û‰∫âÊøÄÁÉàÔºåÂèØ‰ª•ÊÉ≥Âà∞ÈáçËØïÂøÖÁÑ∂È¢ëÁπÅÂèëÁîüÔºåÂèçËÄåÊïàÁéá‰ºöÂèóÂΩ±Âìç</li>
</ul>
</li>
</ul>
<h2 id="2-ÂéüÂ≠êÊï¥Êï∞"><a href="#2-ÂéüÂ≠êÊï¥Êï∞" class="headerlink" title="2. ÂéüÂ≠êÊï¥Êï∞"></a>2. ÂéüÂ≠êÊï¥Êï∞</h2><p>J.U.C Âπ∂ÂèëÂåÖÊèê‰æõ‰∫ÜÔºö</p>
<ul>
<li>AtomicBooleanÔºöÂ∏ÉÂ∞îÂûãÂéüÂ≠êÁ±ª</li>
<li>AtomicInteger Ôºö Êï¥ÂûãÂéüÂ≠êÁ±ª</li>
<li>AtomicLongÔºöÈïøÊï¥ÂûãÂéüÂ≠êÁ±ª</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">// Ëé∑ÂèñÂπ∂Ëá™Â¢ûÔºài = 0, ÁªìÊûú i = 1, ËøîÂõû 0ÔºâÔºåÁ±ª‰ºº‰∫é i++</span><br>    System.out.println(i.getAndIncrement());<br>    <span class="hljs-comment">// Ëá™Â¢ûÂπ∂Ëé∑ÂèñÔºài = 1, ÁªìÊûú i = 2, ËøîÂõû 2ÔºâÔºåÁ±ª‰ºº‰∫é ++i</span><br>    System.out.println(i.incrementAndGet());<br>    <span class="hljs-comment">// Ëá™ÂáèÂπ∂Ëé∑ÂèñÔºài = 2, ÁªìÊûú i = 1, ËøîÂõû 1ÔºâÔºåÁ±ª‰ºº‰∫é --i</span><br>    System.out.println(i.decrementAndGet());<br>    <span class="hljs-comment">// Ëé∑ÂèñÂπ∂Ëá™ÂáèÔºài = 1, ÁªìÊûú i = 0, ËøîÂõû 1ÔºâÔºåÁ±ª‰ºº‰∫é i--</span><br>    System.out.println(i.getAndDecrement());<br>    <span class="hljs-comment">// Ëé∑ÂèñÂπ∂Âä†ÂÄºÔºài = 0, ÁªìÊûú i = 5, ËøîÂõû 0Ôºâ</span><br>    System.out.println(i.getAndAdd(<span class="hljs-number">5</span>));<br>    <span class="hljs-comment">// Âä†ÂÄºÂπ∂Ëé∑ÂèñÔºài = 5, ÁªìÊûú i = 0, ËøîÂõû 0Ôºâ</span><br>    System.out.println(i.addAndGet(-<span class="hljs-number">5</span>));<br>    <span class="hljs-comment">// Ëé∑ÂèñÂπ∂Êõ¥Êñ∞Ôºài = 0, p ‰∏∫ i ÁöÑÂΩìÂâçÂÄº, ÁªìÊûú i = -2, ËøîÂõû 0Ôºâ</span><br>    <span class="hljs-comment">// ÂáΩÊï∞ÂºèÁºñÁ®ãÊé•Âè£ÔºåÂÖ∂‰∏≠ÂáΩÊï∞‰∏≠ÁöÑÊìç‰ΩúËÉΩ‰øùËØÅÂéüÂ≠êÔºå‰ΩÜÂáΩÊï∞ÈúÄË¶ÅÊó†ÂâØ‰ΩúÁî®</span><br>    System.out.println(i.getAndUpdate(p -&gt; p - <span class="hljs-number">2</span>));<br>    <span class="hljs-comment">// Êõ¥Êñ∞Âπ∂Ëé∑ÂèñÔºài = -2, p ‰∏∫ i ÁöÑÂΩìÂâçÂÄº, ÁªìÊûú i = 0, ËøîÂõû 0Ôºâ</span><br>    <span class="hljs-comment">// ÂáΩÊï∞ÂºèÁºñÁ®ãÊé•Âè£ÔºåÂÖ∂‰∏≠ÂáΩÊï∞‰∏≠ÁöÑÊìç‰ΩúËÉΩ‰øùËØÅÂéüÂ≠êÔºå‰ΩÜÂáΩÊï∞ÈúÄË¶ÅÊó†ÂâØ‰ΩúÁî®</span><br>    System.out.println(i.updateAndGet(p -&gt; p + <span class="hljs-number">2</span>));<br>    <span class="hljs-comment">// Ëé∑ÂèñÂπ∂ËÆ°ÁÆóÔºài = 0, p ‰∏∫ i ÁöÑÂΩìÂâçÂÄº, x ‰∏∫ÂèÇÊï∞1, ÁªìÊûú i = 10, ËøîÂõû 0Ôºâ</span><br>    <span class="hljs-comment">// ÂáΩÊï∞ÂºèÁºñÁ®ãÊé•Âè£ÔºåÂÖ∂‰∏≠ÂáΩÊï∞‰∏≠ÁöÑÊìç‰ΩúËÉΩ‰øùËØÅÂéüÂ≠êÔºå‰ΩÜÂáΩÊï∞ÈúÄË¶ÅÊó†ÂâØ‰ΩúÁî®</span><br>    <span class="hljs-comment">// getAndUpdate Â¶ÇÊûúÂú® lambda ‰∏≠ÂºïÁî®‰∫ÜÂ§ñÈÉ®ÁöÑÂ±ÄÈÉ®ÂèòÈáèÔºåË¶Å‰øùËØÅËØ•Â±ÄÈÉ®ÂèòÈáèÊòØ final ÁöÑ</span><br>    <span class="hljs-comment">// getAndAccumulate ÂèØ‰ª•ÈÄöËøá ÂèÇÊï∞1 Êù•ÂºïÁî®Â§ñÈÉ®ÁöÑÂ±ÄÈÉ®ÂèòÈáèÔºå‰ΩÜÂõ†‰∏∫ÂÖ∂‰∏çÂú® lambda ‰∏≠Âõ†Ê≠§‰∏çÂøÖÊòØ final</span><br>    System.out.println(i.getAndAccumulate(<span class="hljs-number">10</span>, (p, x) -&gt; p + x));<br>    <span class="hljs-comment">// ËÆ°ÁÆóÂπ∂Ëé∑ÂèñÔºài = 10, p ‰∏∫ i ÁöÑÂΩìÂâçÂÄº, x ‰∏∫ÂèÇÊï∞1ÂÄº, ÁªìÊûú i = 0, ËøîÂõû 0Ôºâ</span><br>    <span class="hljs-comment">// ÂáΩÊï∞ÂºèÁºñÁ®ãÊé•Âè£ÔºåÂÖ∂‰∏≠ÂáΩÊï∞‰∏≠ÁöÑÊìç‰ΩúËÉΩ‰øùËØÅÂéüÂ≠êÔºå‰ΩÜÂáΩÊï∞ÈúÄË¶ÅÊó†ÂâØ‰ΩúÁî®</span><br>    System.out.println(i.accumulateAndGet(-<span class="hljs-number">10</span>, (p, x) -&gt; p + x));<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-ÂéüÂ≠êÂºïÁî®"><a href="#3-ÂéüÂ≠êÂºïÁî®" class="headerlink" title="3. ÂéüÂ≠êÂºïÁî®"></a>3. ÂéüÂ≠êÂºïÁî®</h2><p>‰øùËØÅ<strong>ÂºïÁî®Á±ªÂûã</strong>ÁöÑÂÖ±‰∫´ÂèòÈáèÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ</p>
<ul>
<li>AtomicReference: ÂºïÁî®Á±ªÂûãÂéüÂ≠êÁ±ª</li>
<li>AtomicMarkableReference: ÂéüÂ≠êÊõ¥Êñ∞Â∏¶ÊúâÊ†áËÆ∞ÁöÑÂºïÁî®Á±ªÂûã</li>
<li>AtomicStampedReferenceÔºõ ÂéüÂ≠êÊõ¥Êñ∞Â∏¶ÊúâÁâàÊú¨Âè∑ÁöÑÂºïÁî®Á±ªÂûã</li>
</ul>
<h3 id="3-1-AtomicReference"><a href="#3-1-AtomicReference" class="headerlink" title="3.1 AtomicReference"></a>3.1 AtomicReference</h3><p>‰ΩøÁî®Êó†ÈîÅÁöÑÊñπÂºè CAS Êù•Ëß£ÂÜ≥ÔºåËß£ÂÜ≥ÊñπÂºèÊòØÁî® AtomicReference ÂéüÂ≠êÂºïÁî®Ëß£ÂÜ≥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DecimalAccountCas</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DecimalAccount</span> &#123;<br>    <span class="hljs-keyword">private</span> AtomicReference&lt;BigDecimal&gt; balance;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DecimalAccountCas</span><span class="hljs-params">(BigDecimal balance)</span> &#123;<br>        <span class="hljs-built_in">this</span>.balance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;(balance);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">getBalance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> balance.get();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">withdraw</span><span class="hljs-params">(BigDecimal amount)</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">preVal</span> <span class="hljs-operator">=</span> balance.get();<br>            <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">nextVal</span> <span class="hljs-operator">=</span> preVal.subtract(amount);<br>            <span class="hljs-keyword">if</span>(balance.compareAndSet(preVal, nextVal)) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-ABAÈóÆÈ¢ò"><a href="#3-2-ABAÈóÆÈ¢ò" class="headerlink" title="3.2 ABAÈóÆÈ¢ò"></a>3.2 ABAÈóÆÈ¢ò</h3><p>ABAÈóÆÈ¢òÔºö‰∏ªÁ∫øÁ®ã‰ªÖËÉΩÂà§Êñ≠Âá∫ÂÖ±‰∫´ÂèòÈáèÁöÑÂÄº‰∏éÊúÄÂàùÂÄº A ÊòØÂê¶Áõ∏ÂêåÔºå‰∏çËÉΩÊÑüÁü•Âà∞ËøôÁßç<strong>‰ªé A Êîπ‰∏∫ B Âèà ÊîπÂõû A ÁöÑÊÉÖÂÜµ</strong></p>
<h3 id="3-3-AtomicStampedReference"><a href="#3-3-AtomicStampedReference" class="headerlink" title="3.3 AtomicStampedReference"></a>3.3 AtomicStampedReference</h3><p>Â¶ÇÊûú‰∏ªÁ∫øÁ®ãÂ∏åÊúõÂè™Ë¶ÅÊúâÂÖ∂ÂÆÉÁ∫øÁ®ã„ÄêÂä®Ëøá‰∫Ü„ÄëÂÖ±‰∫´ÂèòÈáèÔºåÈÇ£‰πàËá™Â∑±ÁöÑ cas Â∞±ÁÆóÂ§±Ë¥•ÔºåËøôÊó∂Ôºå‰ªÖÊØîËæÉÂÄºÊòØ‰∏çÂ§üÁöÑÔºåÈúÄË¶ÅÂÜçÂä†‰∏Ä‰∏™<strong>ÁâàÊú¨Âè∑</strong><br>‰ΩøÁî® AtomicStampedReference Âä† stamp ÔºàÁâàÊú¨Âè∑ÊàñËÄÖÊó∂Èó¥Êà≥ÔºâÁöÑÊñπÂºèËß£ÂÜ≥ ABA ÈóÆÈ¢ò</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ‰∏§‰∏™ÂèÇÊï∞ÔºåÁ¨¨‰∏Ä‰∏™ÔºöÂèòÈáèÁöÑÂÄº Á¨¨‰∫å‰∏™ÔºöÁâàÊú¨Âè∑ÂàùÂßãÂÄº</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AtomicStampedReference&lt;String&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicStampedReference</span>&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        log.debug(<span class="hljs-string">&quot;main start...&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">preVal</span> <span class="hljs-operator">=</span> ref.getReference();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> ref.getStamp();<br>        log.info(<span class="hljs-string">&quot;main ÊãøÂà∞ÁöÑÁâàÊú¨Âè∑ &#123;&#125;&quot;</span>,stamp);<br>        other();<br>        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br>        log.info(<span class="hljs-string">&quot;‰øÆÊîπÂêéÁöÑÁâàÊú¨Âè∑ &#123;&#125;&quot;</span>,ref.getStamp());<br>        log.info(<span class="hljs-string">&quot;change A-&gt;C:&#123;&#125;&quot;</span>, ref.compareAndSet(preVal, <span class="hljs-string">&quot;C&quot;</span>, stamp, stamp + <span class="hljs-number">1</span>));<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> ref.getStamp();<br>            log.info(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,stamp);<br>            log.info(<span class="hljs-string">&quot;change A-&gt;B:&#123;&#125;&quot;</span>, ref.compareAndSet(ref.getReference(), <span class="hljs-string">&quot;B&quot;</span>, stamp, stamp + <span class="hljs-number">1</span>));<br>        &#125;).start();<br>        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> ref.getStamp();<br>            log.info(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,stamp);<br>            log.debug(<span class="hljs-string">&quot;change B-&gt;A:&#123;&#125;&quot;</span>, ref.compareAndSet(ref.getReference(), <span class="hljs-string">&quot;A&quot;</span>,stamp,stamp + <span class="hljs-number">1</span>));<br>        &#125;).start();<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-4-AtomicMarkableReference"><a href="#3-4-AtomicMarkableReference" class="headerlink" title="3.4 AtomicMarkableReference"></a>3.4 AtomicMarkableReference</h3><p>AtomicStampedReference ÂèØ‰ª•ÁªôÂéüÂ≠êÂºïÁî®Âä†‰∏äÁâàÊú¨Âè∑ÔºåËøΩË∏™ÂéüÂ≠êÂºïÁî®Êï¥‰∏™ÁöÑÂèòÂåñËøáÁ®ãÔºåÂ¶ÇÔºöA -&gt; B -&gt; A -&gt;CÔºå<strong>ÈÄöËøáAtomicStampedReferenceÔºåÊàë‰ª¨ÂèØ‰ª•Áü•ÈÅìÔºåÂºïÁî®ÂèòÈáè‰∏≠ÈÄîË¢´Êõ¥Êîπ‰∫ÜÂá†Ê¨°</strong>„ÄÇ</p>
<p>‰ΩÜÊòØÊúâÊó∂ÂÄôÔºåÂπ∂‰∏çÂÖ≥ÂøÉÂºïÁî®ÂèòÈáèÊõ¥Êîπ‰∫ÜÂá†Ê¨°ÔºåÂè™ÊòØ<strong>ÂçïÁ∫ØÁöÑÂÖ≥ÂøÉÊòØÂê¶Êõ¥ÊîπËøá</strong>ÔºåÊâÄ‰ª•Â∞±Êúâ‰∫ÜAtomicMarkableReference</p>
<h2 id="4-ÂéüÂ≠êÊï∞ÁªÑ"><a href="#4-ÂéüÂ≠êÊï∞ÁªÑ" class="headerlink" title="4. ÂéüÂ≠êÊï∞ÁªÑ"></a>4. ÂéüÂ≠êÊï∞ÁªÑ</h2><p>‰ΩøÁî®ÂéüÂ≠êÁöÑÊñπÂºèÊõ¥Êñ∞Êï∞ÁªÑÈáåÁöÑÊüê‰∏™ÂÖÉÁ¥†Ôºå‰ΩøÁî®ÂéüÂ≠êÊï∞ÁªÑÂèØ‰ª•‰øùËØÅ<strong>Êï∞ÁªÑÂÖÉÁ¥†</strong>ÁöÑÁ∫øÁ®ãÂÆâÂÖ®„ÄÇ</p>
<ul>
<li>AtomicIntegerArrayÔºöÊï¥ÂΩ¢Êï∞ÁªÑÂéüÂ≠êÁ±ª</li>
<li>AtomicLongArrayÔºöÈïøÊï¥ÂΩ¢Êï∞ÁªÑÂéüÂ≠êÁ±ª</li>
<li>AtomicReferenceArrayÔºöÂºïÁî®Á±ªÂûãÊï∞ÁªÑÂéüÂ≠êÁ±ª</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Code_10_AtomicArrayTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * ÁªìÊûúÂ¶Ç‰∏ãÔºö</span><br><span class="hljs-comment">         * [9934, 9938, 9940, 9931, 9935, 9933, 9944, 9942, 9939, 9940]</span><br><span class="hljs-comment">         * [10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000]</span><br><span class="hljs-comment">         */</span><br>        demo(<br>                () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>],<br>                (array) -&gt; array.length,<br>                (array, index) -&gt; array[index]++,<br>                (array) -&gt; System.out.println(Arrays.toString(array))<br>        );<br>        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br>        demo(<br>                () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicIntegerArray</span>(<span class="hljs-number">10</span>),<br>                (array) -&gt; array.length(),<br>                (array, index) -&gt; array.getAndIncrement(index),<br>                (array) -&gt; System.out.println(array)<br>        );<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">demo</span><span class="hljs-params">(</span><br><span class="hljs-params">            Supplier&lt;T&gt; arraySupplier,</span><br><span class="hljs-params">            Function&lt;T, Integer&gt; lengthFun,</span><br><span class="hljs-params">            BiConsumer&lt;T, Integer&gt; putConsumer,</span><br><span class="hljs-params">            Consumer&lt;T&gt; printConsumer)</span> &#123;<br>        ArrayList&lt;Thread&gt; ts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(); <span class="hljs-comment">// ÂàõÂª∫ÈõÜÂêà</span><br>        <span class="hljs-type">T</span> <span class="hljs-variable">array</span> <span class="hljs-operator">=</span> arraySupplier.get(); <span class="hljs-comment">// Ëé∑ÂèñÊï∞ÁªÑ</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> lengthFun.apply(array); <span class="hljs-comment">// Ëé∑ÂèñÊï∞ÁªÑÁöÑÈïøÂ∫¶</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>            ts.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10000</span>; j++) &#123;<br>                    putConsumer.accept(array, j % length);<br>                &#125;<br>            &#125;));<br>        &#125;<br>        ts.forEach(Thread::start);<br>        ts.forEach((thread) -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                thread.join();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;);<br>        printConsumer.accept(array);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-Â≠óÊÆµÊõ¥Êñ∞Âô®"><a href="#5-Â≠óÊÆµÊõ¥Êñ∞Âô®" class="headerlink" title="5. Â≠óÊÆµÊõ¥Êñ∞Âô®"></a>5. Â≠óÊÆµÊõ¥Êñ∞Âô®</h2><p>Âà©Áî®Â≠óÊÆµÊõ¥Êñ∞Âô®ÔºåÂèØ‰ª•ÈíàÂØπ<strong>ÂØπË±°ÁöÑÊüê‰∏™Âüü</strong>ÔºàFieldÔºâËøõË°åÂéüÂ≠êÊìç‰ΩúÔºåÂè™ËÉΩÈÖçÂêà volatile ‰øÆÈ•∞ÁöÑÂ≠óÊÆµ‰ΩøÁî®ÔºåÂê¶Âàô‰ºöÂá∫Áé∞ÂºÇÂ∏∏</p>
<ul>
<li><p>AtomicReferenceFieldUpdater &#x2F;&#x2F; Âüü  Â≠óÊÆµ</p>
</li>
<li><p>AtomicIntegerFieldUpdater</p>
</li>
<li><p>AtomicLongFieldUpdater</p>
</li>
<li><p>Â≠óÊÆµÊõ¥Êñ∞Âô®Â∞±ÊòØ‰∏∫‰∫Ü<strong>‰øùËØÅÁ±ª‰∏≠Êüê‰∏™Â±ûÊÄß</strong>Á∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢ò„ÄÇ</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test5</span> &#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> field;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br> <br>        <span class="hljs-type">AtomicIntegerFieldUpdater</span> <span class="hljs-variable">fieldUpdater</span> <span class="hljs-operator">=</span> <br>        AtomicIntegerFieldUpdater.newUpdater(Test5.class, <span class="hljs-string">&quot;field&quot;</span>);<br> <br>        <span class="hljs-type">Test5</span> <span class="hljs-variable">test5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test5</span>();<br>        fieldUpdater.compareAndSet(test5, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>);<br> <br>        <span class="hljs-comment">// ‰øÆÊîπÊàêÂäü field = 10</span><br>        System.out.println(test5.field);<br> <br>        <span class="hljs-comment">// ‰øÆÊîπÊàêÂäü field = 20</span><br>        fieldUpdater.compareAndSet(test5, <span class="hljs-number">10</span>, <span class="hljs-number">20</span>);<br>        System.out.println(test5.field);<br> <br>        <span class="hljs-comment">// ‰øÆÊîπÂ§±Ë¥• field = 20</span><br>        fieldUpdater.compareAndSet(test5, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>);<br>        System.out.println(test5.field);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="6-ÂéüÂ≠êÁ¥ØÂä†Âô®"><a href="#6-ÂéüÂ≠êÁ¥ØÂä†Âô®" class="headerlink" title="6. ÂéüÂ≠êÁ¥ØÂä†Âô®"></a>6. ÂéüÂ≠êÁ¥ØÂä†Âô®</h2><h3 id="6-1-ÂÆö‰πâ"><a href="#6-1-ÂÆö‰πâ" class="headerlink" title="6.1 ÂÆö‰πâ"></a>6.1 ÂÆö‰πâ</h3><p>AtomicLong Vs <strong>LongAdder</strong><br>ÊâßË°å‰ª£Á†ÅÂêéÔºåÂèëÁé∞‰ΩøÁî® <strong>LongAdder</strong> ÊØî AtomicLong Âø´2Ôºå3ÂÄçÔºå‰ΩøÁî® LongAdder ÊÄßËÉΩÊèêÂçá</p>
<h3 id="6-2-ÂéüÁêÜ"><a href="#6-2-ÂéüÁêÜ" class="headerlink" title="6.2 ÂéüÁêÜ"></a>6.2 ÂéüÁêÜ</h3><p>ÊÄßËÉΩÊèêÂçáÁöÑÂéüÂõ†ÂæàÁÆÄÂçïÔºåÂ∞±ÊòØÂú®ÊúâÁ´û‰∫âÊó∂Ôºå<strong>ËÆæÁΩÆÂ§ö‰∏™Á¥ØÂä†ÂçïÂÖÉ</strong>ÔºåTherad-0 Á¥ØÂä† Cell[0]ÔºåËÄå Thread-1 Á¥ØÂä†Cell[1]‚Ä¶ <strong>ÊúÄÂêéÂ∞ÜÁªìÊûúÊ±áÊÄª</strong>„ÄÇËøôÊ†∑ÂÆÉ‰ª¨Âú®Á¥ØÂä†Êó∂Êìç‰ΩúÁöÑ‰∏çÂêåÁöÑ Cell ÂèòÈáèÔºåÂõ†Ê≠§ÂáèÂ∞ë‰∫Ü CAS ÈáçËØïÂ§±Ë¥•Ôºå‰ªéËÄåÊèêÈ´òÊÄßËÉΩ</p>
<h3 id="6-3-LongAdderÊ∫êÁ†Å"><a href="#6-3-LongAdderÊ∫êÁ†Å" class="headerlink" title="6.3  LongAdderÊ∫êÁ†Å"></a>6.3  LongAdderÊ∫êÁ†Å</h3><p>LongAdder Á±ªÊúâÂá†‰∏™ÂÖ≥ÈîÆÂüü</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Á¥ØÂä†ÂçïÂÖÉÊï∞ÁªÑ, ÊáíÊÉ∞ÂàùÂßãÂåñ</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Cell[] cells;<br> <br><span class="hljs-comment">// Âü∫Á°ÄÂÄº, Â¶ÇÊûúÊ≤°ÊúâÁ´û‰∫â, ÂàôÁî® cas Á¥ØÂä†Ëøô‰∏™Âüü</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> base;<br> <br><span class="hljs-comment">// Âú® cells ÂàõÂª∫ÊàñÊâ©ÂÆπÊó∂, ÁΩÆ‰∏∫ 1, Ë°®Á§∫Âä†ÈîÅ</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> cellsBusy;<br></code></pre></td></tr></table></figure>

<h2 id="7-Unsafe"><a href="#7-Unsafe" class="headerlink" title="7. Unsafe"></a>7. Unsafe</h2><p>Unsafe ÂØπË±°Êèê‰æõ‰∫ÜÈùûÂ∏∏Â∫ïÂ±ÇÁöÑÔºå<strong>Êìç‰ΩúÂÜÖÂ≠ò„ÄÅÁ∫øÁ®ãÁöÑÊñπÊ≥ï</strong>ÔºåUnsafe ÂØπË±°‰∏çËÉΩÁõ¥Êé•Ë∞ÉÁî®ÔºåÂè™ËÉΩÈÄöËøá<strong>ÂèçÂ∞Ñ</strong>Ëé∑Âæó</p>
<p><strong>ÈÄöËøáÂèçÂ∞ÑËé∑ÂèñUnsafe ÂØπË±°</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;<br>		<span class="hljs-comment">// Unsafe ‰ΩøÁî®‰∫ÜÂçï‰æãÊ®°ÂºèÔºåunsafe ÂØπË±°ÊòØÁ±ª‰∏≠ÁöÑ‰∏Ä‰∏™ÁßÅÊúâÁöÑÂèòÈáè </span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">theUnsafe</span> <span class="hljs-operator">=</span> Unsafe.class.getDeclaredField(<span class="hljs-string">&quot;theUnsafe&quot;</span>);<br>        theUnsafe.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> (Unsafe)theUnsafe.get(<span class="hljs-literal">null</span>);<br>        <br>    &#125;<br></code></pre></td></tr></table></figure>

<p><strong>Unsafe Ê®°ÊãüÂÆûÁé∞ cas Êìç‰Ωú</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Code_14_UnsafeTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;<br><br>        <span class="hljs-comment">// ÂàõÂª∫ unsafe ÂØπË±°</span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">theUnsafe</span> <span class="hljs-operator">=</span> Unsafe.class.getDeclaredField(<span class="hljs-string">&quot;theUnsafe&quot;</span>);<br>        theUnsafe.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> (Unsafe)theUnsafe.get(<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// ÊãøÂà∞ÂÅèÁßªÈáè</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">idOffset</span> <span class="hljs-operator">=</span> unsafe.objectFieldOffset(Teacher.class.getDeclaredField(<span class="hljs-string">&quot;id&quot;</span>));<br>        <span class="hljs-type">long</span> <span class="hljs-variable">nameOffset</span> <span class="hljs-operator">=</span> unsafe.objectFieldOffset(Teacher.class.getDeclaredField(<span class="hljs-string">&quot;name&quot;</span>));<br><br>        <span class="hljs-comment">// ËøõË°å cas Êìç‰Ωú</span><br>        <span class="hljs-type">Teacher</span> <span class="hljs-variable">teacher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Teacher</span>();<br>        unsafe.compareAndSwapLong(teacher, idOffset, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>);<br>        unsafe.compareAndSwapObject(teacher, nameOffset, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;lisi&quot;</span>);<br><br>        System.out.println(teacher);<br>    &#125;<br><br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> String name;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="8-Êú¨Á´†ÊÄªÁªì"><a href="#8-Êú¨Á´†ÊÄªÁªì" class="headerlink" title="8. Êú¨Á´†ÊÄªÁªì"></a>8. Êú¨Á´†ÊÄªÁªì</h2><ul>
<li>CAS ‰∏é volatile</li>
<li>juc ÂåÖ‰∏ã API<ul>
<li>ÂéüÂ≠êÊï¥Êï∞</li>
<li>ÂéüÂ≠êÂºïÁî®</li>
<li>ÂéüÂ≠êÊï∞ÁªÑ</li>
<li>Â≠óÊÆµÊõ¥Êñ∞Âô®</li>
<li>ÂéüÂ≠êÁ¥ØÂä†Âô®</li>
</ul>
</li>
<li>Unsafe</li>
</ul>
<h1 id="ÂÖ≠-ÂÖ±‰∫´Ê®°Âûã‰πã‰∏çÂèØÂèò"><a href="#ÂÖ≠-ÂÖ±‰∫´Ê®°Âûã‰πã‰∏çÂèØÂèò" class="headerlink" title="ÂÖ≠. ÂÖ±‰∫´Ê®°Âûã‰πã‰∏çÂèØÂèò"></a>ÂÖ≠. ÂÖ±‰∫´Ê®°Âûã‰πã‰∏çÂèØÂèò</h1><p>‰∏çÂèØÂèòÁ±ªÁöÑÂØπË±°ÔºåÂõ†‰∏∫Êó†Ê≥ï‰øÆÊîπÂÖ±‰∫´ÊàêÂëòÁöÑÁä∂ÊÄÅÔºåÊâÄ‰ª•‰∏ç‰ºöÊúâÁ∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢ò</p>
<ul>
<li>‰∏çÂèØÂèòÁ±ªÁöÑ‰ΩøÁî®</li>
<li>‰∏çÂèØÂèòÁ±ªËÆæËÆ°</li>
<li>Êó†Áä∂ÊÄÅÁ±ªËÆæËÆ°</li>
</ul>
<h2 id="1-‰∏çÂèØÂèòÁ±ªÁöÑ‰ΩøÁî®"><a href="#1-‰∏çÂèØÂèòÁ±ªÁöÑ‰ΩøÁî®" class="headerlink" title="1. ‰∏çÂèØÂèòÁ±ªÁöÑ‰ΩøÁî®"></a>1. ‰∏çÂèØÂèòÁ±ªÁöÑ‰ΩøÁî®</h2><p>Â¶ÇÊûú‰∏Ä‰∏™ÂØπË±°Âú®‰∏çËÉΩÂ§ü‰øÆÊîπÂÖ∂ÂÜÖÈÉ®Áä∂ÊÄÅÔºàÂ±ûÊÄßÔºâÔºåÈÇ£‰πàÂÆÉÂ∞±ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ<br>Âú® Java 8 ÂêéÔºåÊèê‰æõ‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÊó•ÊúüÊ†ºÂºèÂåñÁ±ª DateTimeFormatter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">dtf</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-type">LocalDate</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> dtf.parse(<span class="hljs-string">&quot;2018-10-01&quot;</span>, LocalDate::from);<br>            log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, date);<br>        &#125;).start();<br>    &#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-‰∏çÂèØÂèòÁ±ªÁöÑËÆæËÆ°-‰ª•StringÁ±ª‰∏∫‰æã"><a href="#2-‰∏çÂèØÂèòÁ±ªÁöÑËÆæËÆ°-‰ª•StringÁ±ª‰∏∫‰æã" class="headerlink" title="2. ‰∏çÂèØÂèòÁ±ªÁöÑËÆæËÆ°(‰ª•StringÁ±ª‰∏∫‰æã)"></a>2. ‰∏çÂèØÂèòÁ±ªÁöÑËÆæËÆ°(‰ª•StringÁ±ª‰∏∫‰æã)</h2><p>String Á±ªÊòØ‰∏çÂèØÂèòÁöÑ</p>
<h3 id="2-1-final-ÁöÑ‰ΩøÁî®"><a href="#2-1-final-ÁöÑ‰ΩøÁî®" class="headerlink" title="2.1 final ÁöÑ‰ΩøÁî®"></a>2.1 final ÁöÑ‰ΩøÁî®</h3><p>ÂèëÁé∞ËØ•Á±ª„ÄÅÁ±ª‰∏≠ÊâÄÊúâÂ±ûÊÄßÈÉΩÊòØ final ÁöÑ</p>
<ul>
<li>Â±ûÊÄßÁî® final ‰øÆÈ•∞‰øùËØÅ‰∫Ü<strong>ËØ•Â±ûÊÄßÊòØÂè™ËØªÁöÑ</strong>Ôºå‰∏çËÉΩ‰øÆÊîπ</li>
<li>Á±ªÁî® final ‰øÆÈ•∞,<strong>Ê≤°ÊúâÂ≠êÁ±ªÁªßÊâø</strong>Ôºå‰øùËØÅ‰∫ÜËØ•Á±ª‰∏≠ÁöÑ<strong>ÊñπÊ≥ï‰∏çËÉΩË¢´Ë¶ÜÁõñ</strong>ÔºåÈò≤Ê≠¢Â≠êÁ±ªÊó†ÊÑèÈó¥Á†¥Âùè‰∏çÂèØÂèòÊÄß</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">String</span><br>    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">java</span>.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123;<br>    <span class="hljs-comment">/** The value is used for character storage. */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">char</span> value[];<br> <br>    <span class="hljs-comment">/** Cache the hash code for the string */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> hash; <span class="hljs-comment">// Default to 0</span><br>    <br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-‰øùÊä§ÊÄßÊã∑Ë¥ù"><a href="#2-2-‰øùÊä§ÊÄßÊã∑Ë¥ù" class="headerlink" title="2.2 ‰øùÊä§ÊÄßÊã∑Ë¥ù"></a>2.2 ‰øùÊä§ÊÄßÊã∑Ë¥ù</h3><p>‰ΩÜÊúâÂêåÂ≠¶‰ºöËØ¥Ôºå‰ΩøÁî®Â≠óÁ¨¶‰∏≤Êó∂Ôºå‰πüÊúâ‰∏Ä‰∫õË∑ü‰øÆÊîπÁõ∏ÂÖ≥ÁöÑÊñπÊ≥ïÂïäÔºåÊØîÂ¶Ç substring Á≠âÔºåÈÇ£‰πà‰∏ãÈù¢Â∞±Áúã‰∏ÄÁúãËøô‰∫õÊñπÊ≥ïÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑÔºåÂ∞±‰ª• substring ‰∏∫‰æã</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">substring</span><span class="hljs-params">(<span class="hljs-type">int</span> beginIndex)</span> &#123;<br>    <span class="hljs-keyword">if</span> (beginIndex &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringIndexOutOfBoundsException</span>(beginIndex);<br>    &#125;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">subLen</span> <span class="hljs-operator">=</span> value.length - beginIndex;<br>    <span class="hljs-keyword">if</span> (subLen &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringIndexOutOfBoundsException</span>(subLen);<br>    &#125;<br>    <span class="hljs-keyword">return</span> (beginIndex == <span class="hljs-number">0</span>) ? <span class="hljs-built_in">this</span> : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(value, beginIndex, subLen);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ÂèëÁé∞ÂÖ∂ÂÜÖÈÉ®ÊòØË∞ÉÁî® String ÁöÑÊûÑÈÄ†ÊñπÊ≥ï<strong>ÂàõÂª∫‰∫Ü‰∏Ä‰∏™Êñ∞Â≠óÁ¨¶‰∏≤</strong><br>ÊûÑÈÄ†Êñ∞Â≠óÁ¨¶‰∏≤ÂØπË±°Êó∂Ôºå‰ºöÁîüÊàêÊñ∞ÁöÑ char[] valueÔºåÂØπÂÜÖÂÆπËøõË°å<strong>Â§çÂà∂</strong> „ÄÇËøôÁßçÈÄöËøá<strong>ÂàõÂª∫ÂâØÊú¨ÂØπË±°Êù•ÈÅøÂÖçÂÖ±‰∫´</strong>ÁöÑÊâãÊÆµÁß∞‰πã‰∏∫„Äê‰øùÊä§ÊÄßÊã∑Ë¥ùÔºådefensive copy„Äë</p>
<h2 id="3-‰∫´ÂÖÉÊ®°Âºè"><a href="#3-‰∫´ÂÖÉÊ®°Âºè" class="headerlink" title="3. ‰∫´ÂÖÉÊ®°Âºè"></a>3. ‰∫´ÂÖÉÊ®°Âºè</h2><p>Flyweight pattern. ÂΩìÈúÄË¶ÅÈáçÁî®Êï∞ÈáèÊúâÈôêÁöÑÂêå‰∏ÄÁ±ªÂØπË±°Êó∂</p>
<h3 id="3-1-‰ΩìÁé∞"><a href="#3-1-‰ΩìÁé∞" class="headerlink" title="3.1 ‰ΩìÁé∞"></a>3.1 ‰ΩìÁé∞</h3><p><strong>ÂåÖË£ÖÁ±ª</strong>„ÄÅ<strong>String ‰∏≤Ê±†</strong>„ÄÅ<strong>BigDecimal BigInteger</strong></p>
<ul>
<li>Âú®JDK‰∏≠ BooleanÔºåByteÔºåShortÔºåIntegerÔºåLongÔºåCharacter Á≠âÂåÖË£ÖÁ±ªÊèê‰æõ‰∫Ü valueOf ÊñπÊ≥ïÔºå‰æãÂ¶Ç Long ÁöÑvalueOf ‰ºö<strong>ÁºìÂ≠ò -128~127 ‰πãÈó¥ÁöÑ Long ÂØπË±°</strong>ÔºåÂú®Ëøô‰∏™ËåÉÂõ¥‰πãÈó¥‰ºöÈáçÁî®ÂØπË±°ÔºåÂ§ß‰∫éËøô‰∏™ËåÉÂõ¥ÔºåÊâç‰ºöÊñ∞Âª∫ Long ÂØπË±°Ôºö</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Long <span class="hljs-title function_">valueOf</span><span class="hljs-params">(<span class="hljs-type">long</span> l)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">offset</span> <span class="hljs-operator">=</span> <span class="hljs-number">128</span>;<br>    <span class="hljs-keyword">if</span> (l &gt;= -<span class="hljs-number">128</span> &amp;&amp; l &lt;= <span class="hljs-number">127</span>) &#123; <span class="hljs-comment">// will cache</span><br>        <span class="hljs-keyword">return</span> LongCache.cache[(<span class="hljs-type">int</span>)l + offset];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(l);<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Byte, Short, Long ÁºìÂ≠òÁöÑËåÉÂõ¥ÈÉΩÊòØ -128~127</li>
<li>Character ÁºìÂ≠òÁöÑËåÉÂõ¥ÊòØ 0~127</li>
<li>IntegerÁöÑÈªòËÆ§ËåÉÂõ¥ÊòØ -128~127</li>
<li>Boolean ÁºìÂ≠ò‰∫Ü TRUE Âíå FALSE</li>
</ul>
<h3 id="3-2-DIY-ÂÆûÁé∞ÁÆÄÂçïÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†"><a href="#3-2-DIY-ÂÆûÁé∞ÁÆÄÂçïÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†" class="headerlink" title="3.2 DIY ÂÆûÁé∞ÁÆÄÂçïÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†"></a>3.2 DIY ÂÆûÁé∞ÁÆÄÂçïÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†</h3><p>‰∏Ä‰∏™Á∫ø‰∏äÂïÜÂüéÂ∫îÁî®ÔºåQPS ËææÂà∞Êï∞ÂçÉÔºåÂ¶ÇÊûúÊØèÊ¨°ÈÉΩÈáçÊñ∞ÂàõÂª∫ÂíåÂÖ≥Èó≠Êï∞ÊçÆÂ∫ìËøûÊé•ÔºåÊÄßËÉΩ‰ºöÂèóÂà∞ÊûÅÂ§ßÂΩ±Âìç„ÄÇ ËøôÊó∂È¢ÑÂÖàÂàõÂª∫Â•Ω‰∏ÄÊâπËøûÊé•ÔºåÊîæÂÖ•ËøûÊé•Ê±†„ÄÇ‰∏ÄÊ¨°ËØ∑Ê±ÇÂà∞ËææÂêéÔºå‰ªéËøûÊé•Ê±†Ëé∑ÂèñËøûÊé•Ôºå‰ΩøÁî®ÂÆåÊØïÂêéÂÜçËøòÂõûËøûÊé•Ê±†ÔºåËøôÊ†∑Êó¢ËäÇÁ∫¶‰∫ÜËøûÊé•ÁöÑÂàõÂª∫ÂíåÂÖ≥Èó≠Êó∂Èó¥Ôºå‰πüÂÆûÁé∞‰∫ÜËøûÊé•ÁöÑÈáçÁî®Ôºå‰∏çËá≥‰∫éËÆ©Â∫ûÂ§ßÁöÑËøûÊé•Êï∞ÂéãÂûÆÊï∞ÊçÆÂ∫ì„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Code_17_DatabaseConnectionPoolTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Pool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pool</span>(<span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> pool.borrow();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">1000</span>));<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                pool.free(connection);<br>            &#125;).start();<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-meta">@Slf4j(topic = &quot;c.Pool&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Pool</span> &#123;<br><br>    <span class="hljs-comment">// ËøûÊé•Ê±†ÁöÑÂ§ßÂ∞è, Âõ†‰∏∫Ê≤°ÊúâÂÆûÁé∞ËøûÊé•Ê±†Â§ßÂ∞èÁöÑÊâ©ÂÆπ, Áî® final Ë°®Á§∫Ê±†ÁöÑÂ§ßÂ∞èÊòØ‰∏Ä‰∏™Âõ∫ÂÆöÂÄº„ÄÇ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> poolSize;<br>    <span class="hljs-comment">// ËøûÊé•Ê±†</span><br>    <span class="hljs-keyword">private</span> Connection[] connections;<br>    <span class="hljs-comment">// Ë°®Á§∫ËøûÊé•Áä∂ÊÄÅ, Â¶ÇÊûúÊòØ 0 Ë°®Á§∫Ê≤°ËøûÊé•, 1 Ë°®Á§∫ÊúâËøûÊé•</span><br>    <span class="hljs-keyword">private</span> AtomicIntegerArray status;<br>    <span class="hljs-comment">// ÂàùÂßãÂåñËøûÊé•Ê±†</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Pool</span><span class="hljs-params">(<span class="hljs-type">int</span> poolSize)</span> &#123;<br>        <span class="hljs-built_in">this</span>.poolSize = poolSize;<br>        status = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicIntegerArray</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[poolSize]);<br>        connections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Connection</span>[poolSize];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;<br>            connections[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MockConnection</span>(<span class="hljs-string">&quot;ËøûÊé•&quot;</span> + (i + <span class="hljs-number">1</span>));<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ‰ªéËøûÊé•Ê±†‰∏≠Ëé∑ÂèñËøûÊé•</span><br>    <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">borrow</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-number">0</span> == status.get(i)) &#123;<br>                    <span class="hljs-keyword">if</span>(status.compareAndSet(i,<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>                        log.info(<span class="hljs-string">&quot;Ëé∑ÂèñËøûÊé•:&#123;&#125;&quot;</span>, connections[i]);<br>                        <span class="hljs-keyword">return</span> connections[i];<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.info(<span class="hljs-string">&quot;wait ...&quot;</span>);<br>                    wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ‰ªéËøûÊé•Ê±†‰∏≠ÈáäÊîæÊåáÂÆöÁöÑËøûÊé•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">free</span><span class="hljs-params">(Connection connection)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;<br>            <span class="hljs-keyword">if</span>(connections[i] == connection) &#123;<br>                status.set(i, <span class="hljs-number">0</span>);<br>                log.info(<span class="hljs-string">&quot;ÈáäÊîæËøûÊé•:&#123;&#125;&quot;</span>, connections[i]);<br>                <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                    notifyAll();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MockConnection</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Connection</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MockConnection</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;MockConnection&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4-finalÁöÑÂéüÁêÜ"><a href="#4-finalÁöÑÂéüÁêÜ" class="headerlink" title="4. finalÁöÑÂéüÁêÜ"></a>4. finalÁöÑÂéüÁêÜ</h2><h3 id="4-1-ËÆæÁΩÆ-final-ÂèòÈáèÁöÑÂéüÁêÜ"><a href="#4-1-ËÆæÁΩÆ-final-ÂèòÈáèÁöÑÂéüÁêÜ" class="headerlink" title="4.1 ËÆæÁΩÆ final ÂèòÈáèÁöÑÂéüÁêÜ"></a>4.1 ËÆæÁΩÆ final ÂèòÈáèÁöÑÂéüÁêÜ</h3><p>ÁêÜËß£‰∫Ü volatile ÂéüÁêÜÔºåÂÜçÂØπÊØî final ÁöÑÂÆûÁé∞Â∞±ÊØîËæÉÁÆÄÂçï‰∫Ü</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestFinal</span> &#123;<br>	<span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ÂèëÁé∞ final ÂèòÈáèÁöÑËµãÂÄº‰πü‰ºöÈÄöËøá putfield Êåá‰ª§Êù•ÂÆåÊàêÔºåÂêåÊ†∑Âú®ËøôÊù°Êåá‰ª§‰πãÂêé‰πü‰ºö<strong>Âä†ÂÖ•ÂÜôÂ±èÈöú</strong>Ôºå‰øùËØÅÂú®ÂÖ∂ÂÆÉÁ∫øÁ®ãËØªÂà∞ÂÆÉÁöÑÂÄºÊó∂‰∏ç‰ºöÂá∫Áé∞‰∏∫ 0 ÁöÑÊÉÖÂÜµ</p>
<h3 id="4-2-Ëé∑Âèñ-final-ÂèòÈáèÁöÑÂéüÁêÜ"><a href="#4-2-Ëé∑Âèñ-final-ÂèòÈáèÁöÑÂéüÁêÜ" class="headerlink" title="4.2 Ëé∑Âèñ final ÂèòÈáèÁöÑÂéüÁêÜ"></a>4.2 Ëé∑Âèñ final ÂèòÈáèÁöÑÂéüÁêÜ</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42651904/article/details/87708198?ops_request_misc=%257B%2522request%255Fid%2522%253A%252203d3d48b5d881880308676771f04918a%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=03d3d48b5d881880308676771f04918a&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-87708198-null-null.nonecase&utm_term=%E6%B7%B1%E5%85%A5final%E5%85%B3%E9%94%AE%E5%AD%97&spm=1018.2226.3001.4450">Ê∑±ÂÖ•ÁêÜËß£finalÂÖ≥ÈîÆÂ≠ó</a></p>
<h2 id="5-Êó†Áä∂ÊÄÅ"><a href="#5-Êó†Áä∂ÊÄÅ" class="headerlink" title="5. Êó†Áä∂ÊÄÅ"></a>5. Êó†Áä∂ÊÄÅ</h2><p>Âú® web Èò∂ÊÆµÂ≠¶‰π†Êó∂ÔºåËÆæËÆ° Servlet Êó∂‰∏∫‰∫Ü‰øùËØÅÂÖ∂Á∫øÁ®ãÂÆâÂÖ®ÔºåÈÉΩ‰ºöÊúâËøôÊ†∑ÁöÑÂª∫ËÆÆÔºå‰∏çË¶Å‰∏∫ Servlet ËÆæÁΩÆÊàêÂëòÂèòÈáèÔºåËøôÁßç<strong>Ê≤°Êúâ‰ªª‰ΩïÊàêÂëòÂèòÈáèÁöÑÁ±ª</strong>ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ</p>
<ul>
<li>Âõ†‰∏∫ÊàêÂëòÂèòÈáè‰øùÂ≠òÁöÑÊï∞ÊçÆ‰πüÂèØ‰ª•Áß∞‰∏∫Áä∂ÊÄÅ‰ø°ÊÅØÔºåÂõ†Ê≠§<strong>Ê≤°ÊúâÊàêÂëòÂèòÈáè</strong>Â∞±Áß∞‰πã‰∏∫„Äê<strong>Êó†Áä∂ÊÄÅ</strong>„Äë</li>
</ul>
<h1 id="‰∏É-ÂÖ±‰∫´Ê®°Âûã‰πãÂ∑•ÂÖ∑"><a href="#‰∏É-ÂÖ±‰∫´Ê®°Âûã‰πãÂ∑•ÂÖ∑" class="headerlink" title="‰∏É. ÂÖ±‰∫´Ê®°Âûã‰πãÂ∑•ÂÖ∑"></a>‰∏É. ÂÖ±‰∫´Ê®°Âûã‰πãÂ∑•ÂÖ∑</h1><h2 id="1-Á∫øÁ®ãÊ±†"><a href="#1-Á∫øÁ®ãÊ±†" class="headerlink" title="1. Á∫øÁ®ãÊ±†"></a>1. Á∫øÁ®ãÊ±†</h2><p>Ê±†ÂåñÊäÄÊúØÁöÑÊÄùÊÉ≥‰∏ªË¶ÅÊòØ‰∏∫‰∫Ü<strong>ÂáèÂ∞ëÊØèÊ¨°Ëé∑ÂèñËµÑÊ∫êÁöÑÊ∂àËÄóÔºåÊèêÈ´òÂØπËµÑÊ∫êÁöÑÂà©Áî®Áéá</strong>„ÄÇ<br>Á∫øÁ®ãÊ±†Êèê‰æõ‰∫Ü‰∏ÄÁßçÈôêÂà∂ÂíåÁÆ°ÁêÜËµÑÊ∫êÔºàÂåÖÊã¨ÊâßË°å‰∏Ä‰∏™‰ªªÂä°Ôºâ„ÄÇ ÊØè‰∏™Á∫øÁ®ãÊ±†ËøòÁª¥Êä§‰∏Ä‰∫õÂü∫Êú¨ÁªüËÆ°‰ø°ÊÅØÔºå‰æãÂ¶ÇÂ∑≤ÂÆåÊàê‰ªªÂä°ÁöÑÊï∞Èáè„ÄÇ</p>
<ul>
<li><strong>Èôç‰ΩéËµÑÊ∫êÊ∂àËÄó</strong>„ÄÇÈÄöËøáÈáçÂ§çÂà©Áî®Â∑≤ÂàõÂª∫ÁöÑÁ∫øÁ®ãÈôç‰ΩéÁ∫øÁ®ãÂàõÂª∫ÂíåÈîÄÊØÅÈÄ†ÊàêÁöÑÊ∂àËÄó„ÄÇ</li>
<li><strong>ÊèêÈ´òÂìçÂ∫îÈÄüÂ∫¶</strong>„ÄÇÂΩì‰ªªÂä°Âà∞ËææÊó∂Ôºå‰ªªÂä°ÂèØ‰ª•‰∏çÈúÄË¶ÅÁöÑÁ≠âÂà∞Á∫øÁ®ãÂàõÂª∫Â∞±ËÉΩÁ´ãÂç≥ÊâßË°å„ÄÇ</li>
<li><strong>ÊèêÈ´òÁ∫øÁ®ãÁöÑÂèØÁÆ°ÁêÜÊÄß</strong>„ÄÇÁ∫øÁ®ãÊòØÁ®ÄÁº∫ËµÑÊ∫êÔºåÂ¶ÇÊûúÊó†ÈôêÂà∂ÁöÑÂàõÂª∫Ôºå‰∏ç‰ªÖ‰ºöÊ∂àËÄóÁ≥ªÁªüËµÑÊ∫êÔºåËøò‰ºöÈôç‰ΩéÁ≥ªÁªüÁöÑÁ®≥ÂÆöÊÄßÔºå‰ΩøÁî®Á∫øÁ®ãÊ±†ÂèØ‰ª•ËøõË°åÁªü‰∏ÄÁöÑÂàÜÈÖçÔºåË∞É‰ºòÂíåÁõëÊéß„ÄÇ</li>
</ul>
<h3 id="1-1-Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†"><a href="#1-1-Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†" class="headerlink" title="1.1 Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†"></a>1.1 Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†</h3><p><img src="/img/blogs/java/jvm-juc/juc.7.1.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li>ÂÖàÂàùÂßãÂåñÁ∫øÁ®ãÊ±†„ÄÅÈòªÂ°ûÈòüÂàóÂ§ßÂ∞è</li>
<li>ÂºÄÂá†‰∏™Á∫øÁ®ãÈÄöËøáÁ∫øÁ®ãÊ±†ÂØπË±°Ë∞ÉÁî®ÊñπÊ≥ïÊâßË°å‰ªªÂä°ÔºåÁ∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ã‰ºöÊâßË°å‰ªªÂä°</li>
<li>Â¶ÇÊûú<strong>‰ªªÂä°ËøáÂ§öÔºå‰ºöÊ∑ªÂä†Âà∞ÈòªÂ°ûÈòüÂàó</strong>‰∏≠ÔºåÊâßË°åÂÆå‰ªªÂä°ÂÜç‰ªéÈòªÂ°ûÈòüÂàó‰∏≠ÂèñÂÄºÁªßÁª≠ÊâßË°å</li>
<li>ÂΩìÊâßË°åÁöÑ<strong>Á∫øÁ®ãÊï∞Â§ß‰∫éÁ∫øÁ®ãÊ±†ÂíåÈòªÂ°ûÈòüÂàóÁöÑÂ§ßÂ∞è</strong>ÔºåÊàë‰ª¨ÂèØ‰ª•ÂÆö‰πâ<strong>ÊãíÁªùÁ≠ñÁï•</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j(topic = &quot;c.Code_01_TestPool&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Code_01_ThreadPoolTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ThreadPool</span> <span class="hljs-variable">threadPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPool</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS, <span class="hljs-number">1</span>,<br>                (queue, task) -&gt; &#123;<br>                    <span class="hljs-comment">// 1. ÈòªÂ°ûÁ≠âÂæÖ„ÄÇ</span><br><span class="hljs-comment">//                    queue.put(task);</span><br>                    <span class="hljs-comment">// 2. Â∏¶Ë∂ÖÊó∂ÁöÑÁ≠âÂæÖ</span><br><span class="hljs-comment">//                    queue.offer(task, 500, TimeUnit.MILLISECONDS);</span><br>                    <span class="hljs-comment">// 3. Ë∞ÉÁî®ËÄÖÊîæÂºÉ</span><br><span class="hljs-comment">//                    log.info(&quot;ÊîæÂºÉ &#123;&#125;&quot;, task);</span><br>                    <span class="hljs-comment">// 4. Ë∞ÉÁî®ËÄÖÊäõÂá∫ÂºÇÂ∏∏</span><br><span class="hljs-comment">//                    throw new RuntimeException(&quot;‰ªªÂä°ÊâßË°åÂ§±Ë¥•&quot; + task);</span><br>                    <span class="hljs-comment">// 5. Ë∞ÉÁî®ËÄÖËá™Â∑±ÊâßË°å‰ªªÂä°</span><br>                    task.run();<br>                &#125;);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i;<br>            threadPool.executor(() -&gt;&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">1000</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                log.info(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, j);<br>            &#125;);<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-meta">@FunctionalInterface</span> <span class="hljs-comment">// ÊãíÁªùÁ≠ñÁï•</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RejectPolicy</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">reject</span><span class="hljs-params">(BlockingQueue&lt;T&gt; queue, T task)</span>;<br>&#125;<br><br><span class="hljs-comment">// ÂÆûÁé∞Á∫øÁ®ãÊ±†</span><br><span class="hljs-meta">@Slf4j(topic = &quot;c.ThreadPool&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPool</span> &#123;<br>    <span class="hljs-comment">// Á∫øÁ®ãÈõÜÂêà</span><br>    <span class="hljs-keyword">private</span> Set&lt;Worker&gt; works = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;Worker&gt;();<br>    <span class="hljs-comment">// ‰ªªÂä°ÈòüÂàó</span><br>    <span class="hljs-keyword">private</span> BlockingQueue&lt;Runnable&gt; taskQueue;<br>    <span class="hljs-comment">// Á∫øÁ®ãÊ±†ÁöÑÊ†∏ÂøÉÊï∞</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> coreSize;<br>    <span class="hljs-comment">// Ëé∑Âèñ‰ªªÂä°ÁöÑË∂ÖÊó∂Êó∂Èó¥</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timeout;<br>    <span class="hljs-keyword">private</span> TimeUnit unit;<br>    <span class="hljs-comment">// ‰ΩøÁî®Á≠ñÁï•Ê®°Âºè„ÄÇ</span><br>    <span class="hljs-keyword">private</span> RejectPolicy&lt;Runnable&gt; rejectPolicy;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> coreSize, <span class="hljs-type">long</span> timeout, TimeUnit unit, <span class="hljs-type">int</span> queueCapacity,</span><br><span class="hljs-params">                      RejectPolicy&lt;Runnable&gt; rejectPolicy)</span> &#123;<br>        <span class="hljs-built_in">this</span>.coreSize = coreSize;<br>        <span class="hljs-built_in">this</span>.timeout = timeout;<br>        <span class="hljs-built_in">this</span>.unit = unit;<br>        taskQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockingQueue</span>&lt;&gt;(queueCapacity);<br>        <span class="hljs-built_in">this</span>.rejectPolicy = rejectPolicy;<br>    &#125;<br><br>    <span class="hljs-comment">// ÊâßË°å‰ªªÂä°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executor</span><span class="hljs-params">(Runnable task)</span> &#123;<br>        <span class="hljs-comment">// Â¶ÇÊûúÁ∫øÁ®ãÊ±†Êª°‰∫Ü. Â∞±Â∞Ü‰ªªÂä°Âä†ÂÖ•Âà∞‰ªªÂä°ÈòüÂàó, Âê¶ÂàôÊâßË°å‰ªªÂä°</span><br>        <span class="hljs-keyword">synchronized</span> (works) &#123;<br>            <span class="hljs-keyword">if</span>(works.size() &lt; coreSize) &#123;<br>                <span class="hljs-type">Worker</span> <span class="hljs-variable">worker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(task);<br>                log.info(<span class="hljs-string">&quot;Êñ∞Â¢û worker &#123;&#125; Ôºå‰ªªÂä° &#123;&#125;&quot;</span>, worker, task);<br>                works.add(worker);<br>                worker.start();<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">//                taskQueue.put(task);</span><br>                <span class="hljs-comment">// 1ÔºâÊ≠ªÁ≠â</span><br>                <span class="hljs-comment">// 2ÔºâÂ∏¶Ë∂ÖÊó∂Á≠âÂæÖ</span><br>                <span class="hljs-comment">// 3ÔºâËÆ©Ë∞ÉÁî®ËÄÖÊîæÂºÉ‰ªªÂä°ÊâßË°å</span><br>                <span class="hljs-comment">// 4ÔºâËÆ©Ë∞ÉÁî®ËÄÖÊäõÂá∫ÂºÇÂ∏∏</span><br>                <span class="hljs-comment">// 5ÔºâËÆ©Ë∞ÉÁî®ËÄÖËá™Â∑±ÊâßË°å‰ªªÂä°</span><br><br>                taskQueue.tryPut(rejectPolicy, task);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br><br>        <span class="hljs-keyword">private</span> Runnable task;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Worker</span><span class="hljs-params">(Runnable task)</span> &#123;<br>            <span class="hljs-built_in">this</span>.task = task;<br>        &#125;<br><br>        <span class="hljs-comment">// ÊâßË°å‰ªªÂä°</span><br>        <span class="hljs-comment">// 1ÔºâÂΩì task ‰∏ç‰∏∫Á©∫ÔºåÊâßË°å‰ªªÂä°</span><br>        <span class="hljs-comment">// 2ÔºâÂΩì task ÊâßË°åÂÆåÊØïÔºåÂÜçÊé•ÁùÄ‰ªé‰ªªÂä°ÈòüÂàóËé∑Âèñ‰ªªÂä°Âπ∂ÊâßË°å</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//            while (task != null || (task = taskQueue.take()) != null) &#123;</span><br>            <span class="hljs-keyword">while</span> (task != <span class="hljs-literal">null</span> || (task = taskQueue.poll(timeout, unit)) != <span class="hljs-literal">null</span>) &#123;<br>                 <span class="hljs-keyword">try</span> &#123; <br>                     log.info(<span class="hljs-string">&quot;Ê≠£Âú®ÊâßË°å &#123;&#125;&quot;</span>, task);<br>                     task.run();<br>                 &#125;<span class="hljs-keyword">catch</span> (Exception e) &#123;<br><br>                 &#125; <span class="hljs-keyword">finally</span> &#123;<br>                     task = <span class="hljs-literal">null</span>;<br>                 &#125;<br>            &#125;<br>            <span class="hljs-keyword">synchronized</span> (works) &#123;<br>                log.info(<span class="hljs-string">&quot;worker Ë¢´ÁßªÈô§ &#123;&#125;&quot;</span>, <span class="hljs-built_in">this</span>);<br>                works.remove(<span class="hljs-built_in">this</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// ÂÆûÁé∞ÈòªÂ°ûÈòüÂàó</span><br><span class="hljs-meta">@Slf4j(topic = &quot;c.BlockingQueue&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockingQueue</span>&lt;T&gt; &#123;<br><br>    <span class="hljs-comment">// ÈòªÂ°ûÈòüÂàóÁöÑÂÆπÈáè</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> capacity;<br>    <span class="hljs-comment">// ÂèåÁ´ØÈìæË°®, ‰ªéÂ§¥Âèñ, ‰ªéÂ∞æÂä†</span><br>    <span class="hljs-keyword">private</span> Deque&lt;T&gt; queue;<br>    <span class="hljs-comment">// ÂÆö‰πâÈîÅ</span><br>    <span class="hljs-keyword">private</span> ReentrantLock lock;<br>    <span class="hljs-comment">// ÂΩìÈòªÂ°ûÈòüÂàóÊª°‰∫ÜÊó∂ÂÄô, Âéª fullWaitSet ‰ºëÊÅØ, Áîü‰∫ßËÄÖÊù°‰ª∂ÂèòÈáè</span><br>    <span class="hljs-keyword">private</span> Condition fullWaitSet;<br>    <span class="hljs-comment">// ÂΩìÈòªÂ°ûÈòüÂàóÁ©∫‰∫ÜÊó∂ÂÄôÔºåÂéª emptyWaitSet ‰ºëÊÅØ, Ê∂àË¥πËÄÖÂ∞è‰ª∂ÂèòÈáè</span><br>    <span class="hljs-keyword">private</span> Condition emptyWaitSet;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BlockingQueue</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> &#123;<br>        queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;(capacity);<br>        lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br>        fullWaitSet = lock.newCondition();<br>        emptyWaitSet = lock.newCondition();<br>        <span class="hljs-built_in">this</span>.capacity = capacity;<br>    &#125;<br><br>    <span class="hljs-comment">// Â∏¶ÊúâË∂ÖÊó∂Êó∂Èó¥ÁöÑËé∑Âèñ</span><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">poll</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// Âêå‰∏ÄÊó∂Èó¥Âçï‰Ωç</span><br>            <span class="hljs-type">long</span> <span class="hljs-variable">nanos</span> <span class="hljs-operator">=</span> unit.toNanos(timeout);<br>            <span class="hljs-keyword">while</span> (queue.isEmpty()) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span>(nanos &lt;= <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                    &#125;<br>                    <span class="hljs-comment">// Èò≤Ê≠¢ËôöÂÅáÂî§ÈÜí, ËøîÂõûÁöÑÊòØÊâÄÂâ©Êó∂Èó¥</span><br>                    nanos = emptyWaitSet.awaitNanos(nanos);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-type">T</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> queue.removeFirst();<br>            fullWaitSet.signal();<br>            <span class="hljs-keyword">return</span> t;<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// Ëé∑Âèñ</span><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">take</span><span class="hljs-params">()</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">while</span> (queue.isEmpty()) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    emptyWaitSet.await();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-type">T</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> queue.removeFirst();<br>            fullWaitSet.signal();<br>            <span class="hljs-keyword">return</span> t;<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// Ê∑ªÂä†</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(T task)</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">while</span> (queue.size() == capacity) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.info(<span class="hljs-string">&quot;Á≠âÂæÖÂä†ÂÖ•‰ªªÂä°ÈòüÂàó &#123;&#125;&quot;</span>, task);<br>                    fullWaitSet.await();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            log.info(<span class="hljs-string">&quot;Âä†ÂÖ•‰ªªÂä°ÈòüÂàó &#123;&#125;&quot;</span>, task);<br>            queue.addLast(task);<br>            emptyWaitSet.signal();<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// Â∏¶ÊúâË∂ÖÊó∂Êó∂Èó¥ÁöÑÊ∑ªÂä†</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">offer</span><span class="hljs-params">(T task, <span class="hljs-type">long</span> timeout, TimeUnit unit)</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">nanos</span> <span class="hljs-operator">=</span> unit.toNanos(timeout);<br>            <span class="hljs-keyword">while</span> (queue.size() == capacity) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span>(nanos &lt;= <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>                    &#125;<br>                    log.info(<span class="hljs-string">&quot;Á≠âÂæÖÂä†ÂÖ•‰ªªÂä°ÈòüÂàó &#123;&#125;&quot;</span>, task);<br>                    nanos = fullWaitSet.awaitNanos(nanos);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            log.info(<span class="hljs-string">&quot;Âä†ÂÖ•‰ªªÂä°ÈòüÂàó &#123;&#125;&quot;</span>, task);<br>            queue.addLast(task);<br>            emptyWaitSet.signal();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tryPut</span><span class="hljs-params">(RejectPolicy&lt;T&gt; rejectPolicy, T task)</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// Âà§Êñ≠Âà§Êñ≠ÊòØÂê¶Êª°</span><br>            <span class="hljs-keyword">if</span>(queue.size() == capacity) &#123;<br>                rejectPolicy.reject(<span class="hljs-built_in">this</span>, task);<br>            &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// ÊúâÁ©∫Èó≤</span><br>                log.info(<span class="hljs-string">&quot;Âä†ÂÖ•‰ªªÂä°ÈòüÂàó &#123;&#125;&quot;</span>, task);<br>                queue.addLast(task);<br>                emptyWaitSet.signal();<br>            &#125;<br><br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> queue.size();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-ThreadPoolExecutor"><a href="#1-2-ThreadPoolExecutor" class="headerlink" title="1.2 ThreadPoolExecutor"></a>1.2 ThreadPoolExecutor</h3><p><img src="/img/blogs/java/jvm-juc/juc.7.2.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="1-2-1-Á∫øÁ®ãÊ±†Áä∂ÊÄÅ"><a href="#1-2-1-Á∫øÁ®ãÊ±†Áä∂ÊÄÅ" class="headerlink" title="1.2.1 Á∫øÁ®ãÊ±†Áä∂ÊÄÅ"></a>1.2.1 Á∫øÁ®ãÊ±†Áä∂ÊÄÅ</h4><p>ThreadPoolExecutor ‰ΩøÁî® int ÁöÑ<strong>È´ò 3 ‰ΩçÊù•Ë°®Á§∫Á∫øÁ®ãÊ±†Áä∂ÊÄÅ</strong>Ôºå‰Ωé 29 ‰ΩçË°®Á§∫Á∫øÁ®ãÊï∞Èáè</p>
<table>
<thead>
<tr>
<th>Áä∂ÊÄÅÂêçÁß∞</th>
<th>È´ò3‰ΩçÁöÑÂÄº</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody><tr>
<td>RUNNING</td>
<td>111</td>
<td>Êé•Êî∂Êñ∞‰ªªÂä°ÔºåÂêåÊó∂Â§ÑÁêÜ‰ªªÂä°ÈòüÂàó‰∏≠ÁöÑ‰ªªÂä°</td>
</tr>
<tr>
<td>SHUTDOWN</td>
<td>000</td>
<td>‰∏çÊé•ÂèóÊñ∞‰ªªÂä°Ôºå‰ΩÜÊòØÂ§ÑÁêÜ‰ªªÂä°ÈòüÂàó‰∏≠ÁöÑ‰ªªÂä°</td>
</tr>
<tr>
<td>STOP</td>
<td>001</td>
<td>‰∏≠Êñ≠Ê≠£Âú®ÊâßË°åÁöÑ‰ªªÂä°ÔºåÂêåÊó∂ÊäõÂºÉÈòªÂ°ûÈòüÂàó‰∏≠ÁöÑ‰ªªÂä°</td>
</tr>
<tr>
<td>TIDYING</td>
<td>010</td>
<td>‰ªªÂä°ÊâßË°åÂÆåÊØïÔºåÊ¥ªÂä®Á∫øÁ®ã‰∏∫0Êó∂ÔºåÂç≥Â∞ÜËøõÂÖ•ÁªàÁªìÈò∂ÊÆµ</td>
</tr>
<tr>
<td>TERMINATED</td>
<td>011</td>
<td>ÁªàÁªìÁä∂ÊÄÅ</td>
</tr>
</tbody></table>
<p>Ëøô‰∫õ‰ø°ÊÅØÂ≠òÂÇ®Âú®<strong>‰∏Ä‰∏™</strong>ÂéüÂ≠êÂèòÈáè ctl ‰∏≠ÔºåÁõÆÁöÑÊòØÂ∞ÜÁ∫øÁ®ãÊ±†Áä∂ÊÄÅ‰∏éÁ∫øÁ®ã‰∏™Êï∞Âêà‰∫å‰∏∫‰∏ÄÔºåËøôÊ†∑Â∞±ÂèØ‰ª•<strong>Áî®‰∏ÄÊ¨° cas ÂéüÂ≠êÊìç‰Ωú</strong>ËøõË°åËµãÂÄº</p>
<h4 id="1-2-2-ÊûÑÈÄ†ÊñπÊ≥ï"><a href="#1-2-2-ÊûÑÈÄ†ÊñπÊ≥ï" class="headerlink" title="1.2.2 ÊûÑÈÄ†ÊñπÊ≥ï"></a>1.2.2 ÊûÑÈÄ†ÊñπÊ≥ï</h4><p>ThreadPoolExecutor Á±ªÂèÇÊï∞ÊúÄÂ§ö„ÄÅÊúÄÂÖ®ÁöÑÊúâÂèÇÊûÑÈÄ†ÊñπÊ≥ï</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,</span><br><span class="hljs-params">                          <span class="hljs-type">int</span> maximumPoolSize,</span><br><span class="hljs-params">                          <span class="hljs-type">long</span> keepAliveTime,</span><br><span class="hljs-params">                          TimeUnit unit,</span><br><span class="hljs-params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="hljs-params">                          ThreadFactory threadFactory,</span><br><span class="hljs-params">                          RejectedExecutionHandler handler)</span><br></code></pre></td></tr></table></figure>

<ul>
<li>corePoolSize Ê†∏ÂøÉÁ∫øÁ®ãÊï∞ÁõÆ (ÊúÄÂ§ö‰øùÁïôÁöÑÁ∫øÁ®ãÊï∞)</li>
<li>maximumPoolSize ÊúÄÂ§ßÁ∫øÁ®ãÊï∞ÁõÆ</li>
<li>keepAliveTime ÁîüÂ≠òÊó∂Èó¥ - ÈíàÂØπÊïëÊÄ•Á∫øÁ®ã</li>
<li>unit Êó∂Èó¥Âçï‰Ωç - ÈíàÂØπÊïëÊÄ•Á∫øÁ®ã</li>
<li>workQueue ÈòªÂ°ûÈòüÂàó</li>
<li>threadFactory Á∫øÁ®ãÂ∑•ÂéÇ - ÂèØ‰ª•‰∏∫Á∫øÁ®ãÂàõÂª∫Êó∂Ëµ∑‰∏™Â•ΩÂêçÂ≠ó</li>
<li>handler ÊãíÁªùÁ≠ñÁï•</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.3.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>ÂΩìÊ†∏ÂøÉÁ∫øÁ®ãË¢´Áî®ÂÆå‰∫ÜÔºåÂπ∂‰∏î‰ªªÂä°Â§™Â§ö‰∫ÜÔºåÈòªÂ°ûÈòüÂàóÊîæ‰∏ç‰∏ãÔºåËøô‰∏™Êó∂ÂÄô<strong>ÊïëÊÄ•Á∫øÁ®ãÂ∞±‰ºöË¢´ÂêØÁî®Êù•Â§ÑÁêÜ‰ªªÂä°</strong>„ÄÇ</li>
<li><strong>Ê†∏ÂøÉÁ∫øÁ®ã</strong>Ê∞∏Ëøú‰∏ç‰ºöË∂ÖÊó∂Ôºå‰∏ÄÁõ¥ËøêË°åÔºõ<strong>ÊïëÊÄ•Á∫øÁ®ã</strong>‰ºöË∂ÖÊó∂ÔºåË∂ÖÊó∂Ë¢´ÂÖ≥Èó≠</li>
</ul>
<p><strong>Â∑•‰ΩúÊµÅÁ®ã</strong>Ôºö</p>
<ol>
<li>Á∫øÁ®ãÊ±†‰∏≠ÂàöÂºÄÂßãÊ≤°ÊúâÁ∫øÁ®ãÔºåÂΩì‰∏Ä‰∏™‰ªªÂä°Êèê‰∫§ÁªôÁ∫øÁ®ãÊ±†ÂêéÔºåÁ∫øÁ®ãÊ±†‰ºöÂàõÂª∫‰∏Ä‰∏™Êñ∞Á∫øÁ®ãÊù•ÊâßË°å‰ªªÂä°„ÄÇ</li>
<li>ÂΩìÁ∫øÁ®ãÊï∞ËææÂà∞ corePoolSize Âπ∂Ê≤°ÊúâÁ∫øÁ®ãÁ©∫Èó≤ÔºåËøôÊó∂ÂÜçÂä†ÂÖ•‰ªªÂä°ÔºåÊñ∞Âä†ÁöÑ‰ªªÂä°‰ºöË¢´Âä†ÂÖ•workQueue ÈòüÂàóÊéíÈòüÔºåÁõ¥Âà∞ÊúâÁ©∫Èó≤ÁöÑÁ∫øÁ®ã„ÄÇ</li>
<li>Â¶ÇÊûúÈòüÂàóÈÄâÊã©‰∫ÜÊúâÁïåÈòüÂàóÔºåÈÇ£‰πà‰ªªÂä°Ë∂ÖËøá‰∫ÜÈòüÂàóÂ§ßÂ∞èÊó∂Ôºå‰ºöÂàõÂª∫ maximumPoolSize - corePoolSize Êï∞ÁõÆÁöÑÁ∫øÁ®ãÊù•ÊïëÊÄ•„ÄÇ</li>
<li>Â¶ÇÊûúÁ∫øÁ®ãÂà∞Ëææ maximumPoolSize ‰ªçÁÑ∂ÊúâÊñ∞‰ªªÂä°ËøôÊó∂‰ºöÊâßË°åÊãíÁªùÁ≠ñÁï•„ÄÇ</li>
<li>ÂΩìÈ´òÂ≥∞ËøáÂéªÂêéÔºåË∂ÖËøácorePoolSize ÁöÑÊïëÊÄ•Á∫øÁ®ãÂ¶ÇÊûú‰∏ÄÊÆµÊó∂Èó¥Ê≤°Êúâ‰ªªÂä°ÂÅöÔºåÈúÄË¶ÅÁªìÊùüËäÇÁúÅËµÑÊ∫êÔºåËøô‰∏™Êó∂Èó¥Áî±keepAliveTime Âíå unit Êù•ÊéßÂà∂</li>
</ol>
<p><strong>ÊãíÁªùÁ≠ñÁï•</strong>Ôºö<br>jdk Êèê‰æõ‰∫Ü 4 ÁßçÂÆûÁé∞ÔºåÂÖ∂ÂÆÉËëóÂêçÊ°ÜÊû∂‰πüÊèê‰æõ‰∫ÜÂÆûÁé∞</p>
<ol>
<li><strong>AbortPolicy</strong> ËÆ©Ë∞ÉÁî®ËÄÖÊäõÂá∫ RejectedExecutionException ÂºÇÂ∏∏ÔºåËøôÊòØÈªòËÆ§Á≠ñÁï•</li>
<li><strong>CallerRunsPolicy</strong> ËÆ©Ë∞ÉÁî®ËÄÖËøêË°å‰ªªÂä°</li>
<li><strong>DiscardPolicy</strong> ÊîæÂºÉÊú¨Ê¨°‰ªªÂä°</li>
<li><strong>DiscardOldestPolicy</strong> ÊîæÂºÉÈòüÂàó‰∏≠ÊúÄÊó©ÁöÑ‰ªªÂä°ÔºåÊú¨‰ªªÂä°ÂèñËÄå‰ª£‰πã</li>
</ol>
<ul>
<li>Dubbo ÁöÑÂÆûÁé∞ÔºåÂú®ÊäõÂá∫ RejectedExecutionException ÂºÇÂ∏∏‰πãÂâç‰ºöËÆ∞ÂΩïÊó•ÂøóÔºåÂπ∂ dump Á∫øÁ®ãÊ†à‰ø°ÊÅØÔºåÊñπ‰æøÂÆö‰ΩçÈóÆÈ¢ò</li>
<li>Netty ÁöÑÂÆûÁé∞ÔºåÊòØÂàõÂª∫‰∏Ä‰∏™Êñ∞Á∫øÁ®ãÊù•ÊâßË°å‰ªªÂä°</li>
<li>ActiveMQ ÁöÑÂÆûÁé∞ÔºåÂ∏¶Ë∂ÖÊó∂Á≠âÂæÖÔºà60sÔºâÂ∞ùËØïÊîæÂÖ•ÈòüÂàóÔºåÁ±ª‰ººÊàë‰ª¨‰πãÂâçËá™ÂÆö‰πâÁöÑÊãíÁªùÁ≠ñÁï•</li>
<li>PinPoint ÁöÑÂÆûÁé∞ÔºåÂÆÉ‰ΩøÁî®‰∫Ü‰∏Ä‰∏™ÊãíÁªùÁ≠ñÁï•ÈìæÔºå‰ºöÈÄê‰∏ÄÂ∞ùËØïÁ≠ñÁï•Èìæ‰∏≠ÊØèÁßçÊãíÁªùÁ≠ñÁï•</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.4.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="1-2-3-newFixedThreadPool"><a href="#1-2-3-newFixedThreadPool" class="headerlink" title="1.2.3  newFixedThreadPool"></a>1.2.3  newFixedThreadPool</h4><p>ÈÄÇÁî®‰∫é<strong>‰ªªÂä°ÈáèÂ∑≤Áü•ÔºåÁõ∏ÂØπËÄóÊó∂</strong>ÁöÑ‰ªªÂä°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> nThreads)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(nThreads, nThreads,<br>                                  <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br>                                  <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><strong>Ê†∏ÂøÉÁ∫øÁ®ãÊï∞ &#x3D;&#x3D; ÊúÄÂ§ßÁ∫øÁ®ãÊï∞</strong>ÔºàÊ≤°ÊúâÊïëÊÄ•Á∫øÁ®ãË¢´ÂàõÂª∫ÔºâÔºåÂõ†Ê≠§‰πüÊó†ÈúÄË∂ÖÊó∂Êó∂Èó¥</li>
<li>ÈòªÂ°ûÈòüÂàóÊòØÊó†ÁïåÁöÑÔºåÂèØ‰ª•Êîæ‰ªªÊÑèÊï∞ÈáèÁöÑ‰ªªÂä°</li>
</ul>
<h4 id="1-2-4-newCachedThreadPool"><a href="#1-2-4-newCachedThreadPool" class="headerlink" title="1.2.4  newCachedThreadPool"></a>1.2.4  newCachedThreadPool</h4><p>Êï¥‰∏™Á∫øÁ®ãÊ±†Ë°®Áé∞‰∏∫Á∫øÁ®ãÊï∞‰ºöÊ†πÊçÆ‰ªªÂä°Èáè‰∏çÊñ≠Â¢ûÈïøÔºåÊ≤°Êúâ‰∏äÈôêÔºåÂΩì‰ªªÂä°ÊâßË°åÂÆåÊØïÔºåÁ©∫Èó≤ 1ÂàÜÈíüÂêéÈáäÊîæÁ∫øÁ®ã„ÄÇ <strong>ÈÄÇÂêà‰ªªÂä°Êï∞ÊØîËæÉÂØÜÈõÜÔºå‰ΩÜÊØè‰∏™‰ªªÂä°ÊâßË°åÊó∂Èó¥ËæÉÁü≠</strong>ÁöÑÊÉÖÂÜµ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newCachedThreadPool</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">0</span>, Integer.MAX_VALUE,<br>                                  <span class="hljs-number">60L</span>, TimeUnit.SECONDS,<br>                                  <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;Runnable&gt;());<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><strong>Ê†∏ÂøÉÁ∫øÁ®ãÊï∞ÊòØ 0</strong>Ôºå ÊúÄÂ§ßÁ∫øÁ®ãÊï∞ÊòØ Integer.MAX_VALUEÔºåÊïëÊÄ•Á∫øÁ®ãÁöÑÁ©∫Èó≤ÁîüÂ≠òÊó∂Èó¥ÊòØ 60sÔºåÊÑèÂë≥ÁùÄ<strong>ÂÖ®ÈÉ®ÈÉΩÊòØÊïëÊÄ•Á∫øÁ®ã</strong>Ôºà60s ÂêéÂèØ‰ª•ÂõûÊî∂Ôºâ</li>
<li>ÊïëÊÄ•Á∫øÁ®ãÂèØ‰ª•Êó†ÈôêÂàõÂª∫</li>
<li>ÈòüÂàóÈááÁî®‰∫Ü SynchronousQueue ÂÆûÁé∞ÁâπÁÇπÊòØÔºåÂÆÉÊ≤°ÊúâÂÆπÈáèÔºåÊ≤°ÊúâÁ∫øÁ®ãÊù•ÂèñÊòØÊîæ‰∏çËøõÂéªÁöÑÔºà‰∏ÄÊâã‰∫§Èí±„ÄÅ‰∏ÄÊâã‰∫§Ë¥ßÔºâ</li>
</ul>
<h4 id="1-2-5-newSingleThreadExecutor"><a href="#1-2-5-newSingleThreadExecutor" class="headerlink" title="1.2.5  newSingleThreadExecutor"></a>1.2.5  newSingleThreadExecutor</h4><p>ÈÄÇÁî®‰∫é<strong>Â§ö‰∏™‰ªªÂä°ÊéíÈòüÊâßË°åÔºà‰∏≤Ë°åÔºâ</strong>„ÄÇÁ∫øÁ®ãÊï∞Âõ∫ÂÆö‰∏∫ 1Ôºå‰ªªÂä°Êï∞Â§ö‰∫é 1 Êó∂Ôºå‰ºöÊîæÂÖ•Êó†ÁïåÈòüÂàóÊéíÈòü„ÄÇ‰ªªÂä°ÊâßË°åÂÆåÊØïÔºåËøôÂîØ‰∏ÄÁöÑÁ∫øÁ®ã‰πü‰∏ç‰ºöË¢´ÈáäÊîæ„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newSingleThreadExecutor</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FinalizableDelegatedExecutorService</span><br>        (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<br>                                <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br>                                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Âå∫Âà´Ôºö</p>
<ul>
<li>Ëá™Â∑±ÂàõÂª∫‰∏Ä‰∏™ÂçïÁ∫øÁ®ã‰∏≤Ë°åÊâßË°å‰ªªÂä°ÔºåÂ¶ÇÊûú‰ªªÂä°ÊâßË°åÂ§±Ë¥•ËÄåÁªàÊ≠¢ÈÇ£‰πàÊ≤°Êúâ‰ªª‰ΩïË°•ÊïëÊé™ÊñΩÔºåËÄåÁ∫øÁ®ãÊ±†Ëøò‰ºöÊñ∞Âª∫‰∏Ä‰∏™Á∫øÁ®ãÔºå‰øùËØÅÊ±†ÁöÑÊ≠£Â∏∏Â∑•‰Ωú</li>
<li>Executors.newSingleThreadExecutor() Á∫øÁ®ã‰∏™Êï∞ÂßãÁªà‰∏∫1Ôºå‰∏çËÉΩ‰øÆÊîπ<ul>
<li>FinalizableDelegatedExecutorService Â∫îÁî®ÁöÑÊòØË£ÖÈ•∞Âô®Ê®°ÂºèÔºåÂè™ÂØπÂ§ñÊö¥Èú≤‰∫ÜExecutorService Êé•Âè£ÔºåÂõ†Ê≠§‰∏çËÉΩË∞ÉÁî® ThreadPoolExecutor ‰∏≠ÁâπÊúâÁöÑÊñπÊ≥ï</li>
</ul>
</li>
<li>Executors.newFixedThreadPool(1) ÂàùÂßãÊó∂‰∏∫1Ôºå‰ª•ÂêéËøòÂèØ‰ª•‰øÆÊîπ<ul>
<li>ÂØπÂ§ñÊö¥Èú≤ÁöÑÊòØ ThreadPoolExecutor ÂØπË±°ÔºåÂèØ‰ª•Âº∫ËΩ¨ÂêéË∞ÉÁî® setCorePoolSize Á≠âÊñπÊ≥ïËøõË°å‰øÆÊîπ</li>
</ul>
</li>
</ul>
<h4 id="1-2-6-Êèê‰∫§‰ªªÂä°"><a href="#1-2-6-Êèê‰∫§‰ªªÂä°" class="headerlink" title="1.2.6 Êèê‰∫§‰ªªÂä°"></a>1.2.6 Êèê‰∫§‰ªªÂä°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ÊâßË°å‰ªªÂä°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(Runnable command)</span>;<br><span class="hljs-comment">// Êèê‰∫§‰ªªÂä° taskÔºåÁî®ËøîÂõûÂÄº Future Ëé∑Âæó‰ªªÂä°ÊâßË°åÁªìÊûúÔºåFutureÁöÑÂéüÁêÜÂ∞±ÊòØÂà©Áî®Êàë‰ª¨‰πãÂâçËÆ≤Âà∞ÁöÑ‰øùÊä§ÊÄßÊöÇÂÅúÊ®°ÂºèÊù•Êé•ÂèóËøîÂõûÁªìÊûúÁöÑÔºå‰∏ªÁ∫øÁ®ãÂèØ‰ª•ÊâßË°å FutureTask.get()ÊñπÊ≥ïÊù•Á≠âÂæÖ‰ªªÂä°ÊâßË°åÂÆåÊàê</span><br>&lt;T&gt; Future&lt;T&gt; <span class="hljs-title function_">submit</span><span class="hljs-params">(Callable&lt;T&gt; task)</span>;<br><span class="hljs-comment">// Êèê‰∫§ tasks ‰∏≠ÊâÄÊúâ‰ªªÂä°</span><br>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; <span class="hljs-title function_">invokeAll</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br> <span class="hljs-keyword">throws</span> InterruptedException;<br><span class="hljs-comment">// Êèê‰∫§ tasks ‰∏≠ÊâÄÊúâ‰ªªÂä°ÔºåÂ∏¶Ë∂ÖÊó∂Êó∂Èó¥</span><br>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; <span class="hljs-title function_">invokeAll</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span><br><span class="hljs-params"> <span class="hljs-type">long</span> timeout, TimeUnit unit)</span><br> <span class="hljs-keyword">throws</span> InterruptedException;<br><span class="hljs-comment">// Êèê‰∫§ tasks ‰∏≠ÊâÄÊúâ‰ªªÂä°ÔºåÂì™‰∏™‰ªªÂä°ÂÖàÊàêÂäüÊâßË°åÂÆåÊØïÔºåËøîÂõûÊ≠§‰ªªÂä°ÊâßË°åÁªìÊûúÔºåÂÖ∂ÂÆÉ‰ªªÂä°ÂèñÊ∂à</span><br>&lt;T&gt; T <span class="hljs-title function_">invokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException;<br><span class="hljs-comment">// Êèê‰∫§ tasks ‰∏≠ÊâÄÊúâ‰ªªÂä°ÔºåÂì™‰∏™‰ªªÂä°ÂÖàÊàêÂäüÊâßË°åÂÆåÊØïÔºåËøîÂõûÊ≠§‰ªªÂä°ÊâßË°åÁªìÊûúÔºåÂÖ∂ÂÆÉ‰ªªÂä°ÂèñÊ∂àÔºåÂ∏¶Ë∂ÖÊó∂Êó∂Èó¥</span><br>&lt;T&gt; T <span class="hljs-title function_">invokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span><br><span class="hljs-params"> <span class="hljs-type">long</span> timeout, TimeUnit unit)</span><br> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException, TimeoutException;<br></code></pre></td></tr></table></figure>

<h4 id="1-2-7-ÂÖ≥Èó≠Á∫øÁ®ãÊ±†"><a href="#1-2-7-ÂÖ≥Èó≠Á∫øÁ®ãÊ±†" class="headerlink" title="1.2.7 ÂÖ≥Èó≠Á∫øÁ®ãÊ±†"></a>1.2.7 ÂÖ≥Èó≠Á∫øÁ®ãÊ±†</h4><h5 id="1-2-7-1-shutdown"><a href="#1-2-7-1-shutdown" class="headerlink" title="1.2.7.1 shutdown"></a>1.2.7.1 shutdown</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">Á∫øÁ®ãÊ±†Áä∂ÊÄÅÂèò‰∏∫ SHUTDOWN</span><br><span class="hljs-comment"> - ‰∏ç‰ºöÊé•Êî∂Êñ∞‰ªªÂä°</span><br><span class="hljs-comment"> - ‰ΩÜÂ∑≤Êèê‰∫§‰ªªÂä°‰ºöÊâßË°åÂÆå</span><br><span class="hljs-comment"> - Ê≠§ÊñπÊ≥ï‰∏ç‰ºöÈòªÂ°ûË∞ÉÁî®Á∫øÁ®ãÁöÑÊâßË°å</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure>

<h5 id="1-2-7-2-shutdownNow"><a href="#1-2-7-2-shutdownNow" class="headerlink" title="1.2.7.2 shutdownNow"></a>1.2.7.2 shutdownNow</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">Á∫øÁ®ãÊ±†Áä∂ÊÄÅÂèò‰∏∫ STOP</span><br><span class="hljs-comment"> - ‰∏ç‰ºöÊé•Êî∂Êñ∞‰ªªÂä°</span><br><span class="hljs-comment"> - ‰ºöÂ∞ÜÈòüÂàó‰∏≠ÁöÑ‰ªªÂä°ËøîÂõû</span><br><span class="hljs-comment"> - Âπ∂Áî® interrupt ÁöÑÊñπÂºè‰∏≠Êñ≠Ê≠£Âú®ÊâßË°åÁöÑ‰ªªÂä°</span><br><span class="hljs-comment">*/</span><br>List&lt;Runnable&gt; <span class="hljs-title function_">shutdownNow</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure>

<h5 id="1-2-7-3-ÂÖ∂‰ªñÊñπÊ≥ï"><a href="#1-2-7-3-ÂÖ∂‰ªñÊñπÊ≥ï" class="headerlink" title="1.2.7.3 ÂÖ∂‰ªñÊñπÊ≥ï"></a>1.2.7.3 ÂÖ∂‰ªñÊñπÊ≥ï</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ‰∏çÂú® RUNNING Áä∂ÊÄÅÁöÑÁ∫øÁ®ãÊ±†ÔºåÊ≠§ÊñπÊ≥ïÂ∞±ËøîÂõû true</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">isShutdown</span><span class="hljs-params">()</span>;<br> <br><span class="hljs-comment">// Á∫øÁ®ãÊ±†Áä∂ÊÄÅÊòØÂê¶ÊòØ TERMINATED</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">isTerminated</span><span class="hljs-params">()</span>;<br> <br><span class="hljs-comment">// Ë∞ÉÁî® shutdown ÂêéÔºåÁî±‰∫éË∞ÉÁî®Á∫øÁ®ãÂπ∂‰∏ç‰ºöÁ≠âÂæÖÊâÄÊúâ‰ªªÂä°ËøêË°åÁªìÊùüÔºåÂõ†Ê≠§Â¶ÇÊûúÂÆÉÊÉ≥Âú®Á∫øÁ®ãÊ±† TERMINATED ÂêéÂÅö‰∫õ‰∫ãÊÉÖÔºåÂèØ‰ª•Âà©Áî®Ê≠§ÊñπÊ≥ïÁ≠âÂæÖ</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">awaitTermination</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException;<br></code></pre></td></tr></table></figure>

<h4 id="1-2-8-‰ªªÂä°Ë∞ÉÂ∫¶Á∫øÁ®ãÊ±†"><a href="#1-2-8-‰ªªÂä°Ë∞ÉÂ∫¶Á∫øÁ®ãÊ±†" class="headerlink" title="1.2.8 ‰ªªÂä°Ë∞ÉÂ∫¶Á∫øÁ®ãÊ±†"></a>1.2.8 ‰ªªÂä°Ë∞ÉÂ∫¶Á∫øÁ®ãÊ±†</h4><p>Á∫øÁ®ãÊï∞Âõ∫ÂÆöÔºå‰ªªÂä°Êï∞Â§ö‰∫éÁ∫øÁ®ãÊï∞Êó∂Ôºå‰ºöÊîæÂÖ•Êó†ÁïåÈòüÂàóÊéíÈòü„ÄÇ‰ªªÂä°ÊâßË°åÂÆåÊØïÔºåËøô‰∫õÁ∫øÁ®ã‰πü‰∏ç‰ºöË¢´ÈáäÊîæ„ÄÇÁî®Êù•<strong>ÊâßË°åÂª∂ËøüÊàñÂèçÂ§çÊâßË°åÁöÑ‰ªªÂä°</strong></p>
<ul>
<li>ScheduledExecutorService ‰∏≠ scheduleAtFixedRate ÊñπÊ≥ïÁöÑ‰ΩøÁî®ÔºåÊòØ ‰∏ÄÊÆµÊó∂Èó¥ ÁöÑ ÊúüÈó¥„ÄÇ</li>
<li>ScheduledExecutorService ‰∏≠ scheduleWithFixedDelay ÊñπÊ≥ïÁöÑ‰ΩøÁî®ÔºåÊòØ ‰∏ÄÊÆµÊó∂Èó¥ ÁöÑ Èó¥Èöî„ÄÇ</li>
</ul>
<h4 id="1-2-9-Ê≠£Á°ÆÂ§ÑÁêÜÊâßË°å‰ªªÂä°ÂºÇÂ∏∏"><a href="#1-2-9-Ê≠£Á°ÆÂ§ÑÁêÜÊâßË°å‰ªªÂä°ÂºÇÂ∏∏" class="headerlink" title="1.2.9 Ê≠£Á°ÆÂ§ÑÁêÜÊâßË°å‰ªªÂä°ÂºÇÂ∏∏"></a>1.2.9 Ê≠£Á°ÆÂ§ÑÁêÜÊâßË°å‰ªªÂä°ÂºÇÂ∏∏</h4><ul>
<li>ÊñπÊ≥ï1Ôºö‰∏ªÂä®ÊçâÂºÇÂ∏∏,try catch</li>
<li>ÊñπÊ≥ï2Ôºö‰ΩøÁî® FutureÔºåÈîôËØØ‰ø°ÊÅØÈÉΩË¢´Â∞ÅË£ÖËøõsubmitÊñπÊ≥ïÁöÑËøîÂõûÊñπÊ≥ï‰∏≠</li>
</ul>
<h4 id="1-2-10-Tomcat-Á∫øÁ®ãÊ±†"><a href="#1-2-10-Tomcat-Á∫øÁ®ãÊ±†" class="headerlink" title="1.2.10  Tomcat Á∫øÁ®ãÊ±†"></a>1.2.10  Tomcat Á∫øÁ®ãÊ±†</h4><p><img src="/img/blogs/java/jvm-juc/juc.7.5.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>LimitLatch Áî®Êù•ÈôêÊµÅÔºåÂèØ‰ª•ÊéßÂà∂ÊúÄÂ§ßËøûÊé•‰∏™Êï∞ÔºåÁ±ª‰ºº J.U.C ‰∏≠ÁöÑ  Semaphore ÂêéÈù¢ÂÜçËÆ≤</li>
<li>Acceptor Âè™Ë¥üË¥£„ÄêÊé•Êî∂Êñ∞ÁöÑ socket ËøûÊé•„Äë</li>
<li>Poller Âè™Ë¥üË¥£ÁõëÂê¨ socket channel ÊòØÂê¶Êúâ„ÄêÂèØËØªÁöÑ I&#x2F;O ‰∫ã‰ª∂„Äë</li>
<li>‰∏ÄÊó¶ÂèØËØªÔºåÂ∞ÅË£Ö‰∏Ä‰∏™‰ªªÂä°ÂØπË±°ÔºàsocketProcessorÔºâÔºåÊèê‰∫§Áªô Executor Á∫øÁ®ãÊ±†Â§ÑÁêÜ</li>
<li>Executor Á∫øÁ®ãÊ±†‰∏≠ÁöÑÂ∑•‰ΩúÁ∫øÁ®ãÊúÄÁªàË¥üË¥£„ÄêÂ§ÑÁêÜËØ∑Ê±Ç„Äë</li>
</ul>
<p>Tomcat Á∫øÁ®ãÊ±†Êâ©Â±ï‰∫Ü ThreadPoolExecutorÔºåË°å‰∏∫Á®çÊúâ‰∏çÂêå</p>
<ul>
<li><p>Â¶ÇÊûúÊÄªÁ∫øÁ®ãÊï∞ËææÂà∞ maximumPoolSize</p>
<ul>
<li>ËøôÊó∂‰∏ç‰ºöÁ´ãÂàªÊäõ RejectedExecutionException ÂºÇÂ∏∏</li>
<li>ËÄåÊòØÂÜçÊ¨°<strong>Â∞ùËØïÂ∞Ü‰ªªÂä°ÊîæÂÖ•ÈòüÂàó</strong>ÔºåÂ¶ÇÊûúËøòÂ§±Ë¥•ÔºåÊâçÊäõÂá∫ RejectedExecutionException ÂºÇÂ∏∏</li>
</ul>
</li>
<li><p>ÂΩìÊ∑ªÂä†Êñ∞ÁöÑ‰ªªÂä°Êó∂ÔºåÂ¶ÇÊûúÊèê‰∫§ÁöÑ‰ªªÂä°Â§ß‰∫éÊ†∏ÂøÉÁ∫øÁ®ãÊï∞ÔºåÂ∞è‰∫éÊúÄÂ§ßÁ∫øÁ®ãÊï∞Â∞±ÂàõÂª∫ÊïëÊÄ•Á∫øÁ®ãÔºåÂê¶ÂàôÂ∞±Âä†ÂÖ•‰ªªÂä°ÈòüÂàó‰∏≠Ôºö</p>
</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.6.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="1-3-ÂºÇÊ≠•Ê®°Âºè‰πãÂ∑•‰ΩúÁ∫øÁ®ã"><a href="#1-3-ÂºÇÊ≠•Ê®°Âºè‰πãÂ∑•‰ΩúÁ∫øÁ®ã" class="headerlink" title="1.3 ÂºÇÊ≠•Ê®°Âºè‰πãÂ∑•‰ΩúÁ∫øÁ®ã"></a>1.3 ÂºÇÊ≠•Ê®°Âºè‰πãÂ∑•‰ΩúÁ∫øÁ®ã</h3><h4 id="1-3-1-ÂÆö‰πâ"><a href="#1-3-1-ÂÆö‰πâ" class="headerlink" title="1.3.1 ÂÆö‰πâ"></a>1.3.1 ÂÆö‰πâ</h4><p>ËÆ©<strong>ÊúâÈôêÁöÑÂ∑•‰ΩúÁ∫øÁ®ãÊù•ËΩÆÊµÅÂºÇÊ≠•Â§ÑÁêÜÊó†ÈôêÂ§öÁöÑ‰ªªÂä°</strong>„ÄÇ‰πüÂèØ‰ª•Â∞ÜÂÖ∂ÂΩíÁ±ª‰∏∫ÂàÜÂ∑•Ê®°ÂºèÔºåÂÆÉÁöÑÂÖ∏ÂûãÂÆûÁé∞Â∞±ÊòØÁ∫øÁ®ãÊ±†Ôºå‰πü‰ΩìÁé∞‰∫ÜÁªèÂÖ∏ËÆæËÆ°Ê®°Âºè‰∏≠ÁöÑ‰∫´ÂÖÉÊ®°Âºè„ÄÇ</p>
<ul>
<li>‰æãÂ¶ÇÔºåÊµ∑Â∫ïÊçûÁöÑÊúçÂä°ÂëòÔºàÁ∫øÁ®ãÔºâÔºåËΩÆÊµÅÂ§ÑÁêÜÊØè‰ΩçÂÆ¢‰∫∫ÁöÑÁÇπÈ§êÔºà‰ªªÂä°ÔºâÔºåÂ¶ÇÊûú‰∏∫ÊØè‰ΩçÂÆ¢‰∫∫ÈÉΩÈÖç‰∏ÄÂêç‰∏ìÂ±ûÁöÑÊúçÂä°ÂëòÔºåÈÇ£‰πàÊàêÊú¨Â∞±Â§™È´ò‰∫ÜÔºàÂØπÊØîÂè¶‰∏ÄÁßçÂ§öÁ∫øÁ®ãËÆæËÆ°Ê®°ÂºèÔºöThread-Per-MessageÔºâ</li>
</ul>
<p>Ê≥®ÊÑèÔºå<strong>‰∏çÂêå‰ªªÂä°Á±ªÂûãÂ∫îËØ•‰ΩøÁî®‰∏çÂêåÁöÑÁ∫øÁ®ãÊ±†</strong>ÔºåËøôÊ†∑ËÉΩÂ§ü<strong>ÈÅøÂÖçÈ••È•ø</strong>ÔºåÂπ∂ËÉΩÊèêÂçáÊïàÁéá</p>
<ul>
<li>‰æãÂ¶ÇÔºåÂ¶ÇÊûú‰∏Ä‰∏™È§êÈ¶ÜÁöÑÂ∑•‰∫∫Êó¢Ë¶ÅÊãõÂëºÂÆ¢‰∫∫Ôºà‰ªªÂä°Á±ªÂûãAÔºâÔºåÂèàË¶ÅÂà∞ÂêéÂé®ÂÅöËèúÔºà‰ªªÂä°Á±ªÂûãBÔºâÊòæÁÑ∂ÊïàÁéá‰∏çÂíãÂú∞ÔºåÂàÜÊàêÊúçÂä°ÂëòÔºàÁ∫øÁ®ãÊ±†AÔºâ‰∏éÂé®Â∏àÔºàÁ∫øÁ®ãÊ±†BÔºâÊõ¥‰∏∫ÂêàÁêÜÔºåÂΩìÁÑ∂‰Ω†ËÉΩÊÉ≥Âà∞Êõ¥ÁªÜËá¥ÁöÑÂàÜÂ∑•</li>
</ul>
<h4 id="1-3-2-È••È•ø"><a href="#1-3-2-È••È•ø" class="headerlink" title="1.3.2 È••È•ø"></a>1.3.2 È••È•ø</h4><ul>
<li>Âõ∫ÂÆöÂ§ßÂ∞èÁ∫øÁ®ãÊ±†‰ºöÊúâÈ••È•øÁé∞Ë±°<ul>
<li>‰∏§‰∏™Â∑•‰∫∫ÊòØÂêå‰∏Ä‰∏™Á∫øÁ®ãÊ±†‰∏≠ÁöÑ‰∏§‰∏™Á∫øÁ®ã</li>
<li>‰ªñ‰ª¨Ë¶ÅÂÅöÁöÑ‰∫ãÊÉÖÊòØÔºö‰∏∫ÂÆ¢‰∫∫ÁÇπÈ§êÂíåÂà∞ÂêéÂé®ÂÅöËèúÔºåËøôÊòØ‰∏§‰∏™Èò∂ÊÆµÁöÑÂ∑•‰Ωú</li>
<li>ÂÆ¢‰∫∫ÁÇπÈ§êÔºöÂøÖÈ°ªÂÖàÁÇπÂÆåÈ§êÔºåÁ≠âËèúÂÅöÂ•ΩÔºå‰∏äËèúÔºåÂú®Ê≠§ÊúüÈó¥Â§ÑÁêÜÁÇπÈ§êÁöÑÂ∑•‰∫∫ÂøÖÈ°ªÁ≠âÂæÖ</li>
<li>ÂêéÂé®ÂÅöËèúÔºöÊ≤°Âï•ËØ¥ÁöÑÔºåÂÅöÂ∞±ÊòØ‰∫Ü</li>
<li>ÊØîÂ¶ÇÂ∑•‰∫∫A Â§ÑÁêÜ‰∫ÜÁÇπÈ§ê‰ªªÂä°ÔºåÊé•‰∏ãÊù•ÂÆÉË¶ÅÁ≠âÁùÄ Â∑•‰∫∫B ÊääËèúÂÅöÂ•ΩÔºåÁÑ∂Âêé‰∏äËèúÔºå‰ªñ‰ø©‰πüÈÖçÂêàÁöÑËõÆÂ•Ω</li>
<li>‰ΩÜÁé∞Âú®ÂêåÊó∂Êù•‰∫Ü‰∏§‰∏™ÂÆ¢‰∫∫ÔºåËøô‰∏™Êó∂ÂÄôÂ∑•‰∫∫A ÂíåÂ∑•‰∫∫B ÈÉΩÂéªÂ§ÑÁêÜÁÇπÈ§ê‰∫ÜÔºåËøôÊó∂Ê≤°‰∫∫ÂÅöÈ•≠‰∫ÜÔºåÈ••È•ø</li>
</ul>
</li>
</ul>
<h4 id="1-3-3-ÂàõÂª∫Â§öÂ∞ëÁ∫øÁ®ãÊ±†ÂêàÈÄÇ"><a href="#1-3-3-ÂàõÂª∫Â§öÂ∞ëÁ∫øÁ®ãÊ±†ÂêàÈÄÇ" class="headerlink" title="1.3.3 ÂàõÂª∫Â§öÂ∞ëÁ∫øÁ®ãÊ±†ÂêàÈÄÇ"></a>1.3.3 ÂàõÂª∫Â§öÂ∞ëÁ∫øÁ®ãÊ±†ÂêàÈÄÇ</h4><ul>
<li>ËøáÂ∞è‰ºöÂØºËá¥Á®ãÂ∫è‰∏çËÉΩÂÖÖÂàÜÂú∞Âà©Áî®Á≥ªÁªüËµÑÊ∫ê„ÄÅÂÆπÊòìÂØºËá¥È••È•ø</li>
<li>ËøáÂ§ß‰ºöÂØºËá¥Êõ¥Â§öÁöÑÁ∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢ÔºåÂç†Áî®Êõ¥Â§öÂÜÖÂ≠ò</li>
</ul>
<h5 id="1-3-3-1-CPU-ÂØÜÈõÜÂûãËøêÁÆó"><a href="#1-3-3-1-CPU-ÂØÜÈõÜÂûãËøêÁÆó" class="headerlink" title="1.3.3.1 CPU ÂØÜÈõÜÂûãËøêÁÆó"></a>1.3.3.1 CPU ÂØÜÈõÜÂûãËøêÁÆó</h5><p>ÈÄöÂ∏∏ÈááÁî®  <code>cpu Ê†∏Êï∞ + 1</code>  ËÉΩÂ§üÂÆûÁé∞<strong>ÊúÄ‰ºòÁöÑ CPU Âà©Áî®Áéá</strong>Ôºå+1 ÊòØ‰øùËØÅÂΩìÁ∫øÁ®ãÁî±‰∫éÈ°µÁº∫Â§±ÊïÖÈöúÔºàÊìç‰ΩúÁ≥ªÁªüÔºâÊàñÂÖ∂ÂÆÉÂéüÂõ†ÂØºËá¥ÊöÇÂÅúÊó∂ÔºåÈ¢ùÂ§ñÁöÑËøô‰∏™Á∫øÁ®ãÂ∞±ËÉΩÈ°∂‰∏äÂéªÔºå‰øùËØÅ CPU Êó∂ÈíüÂë®Êúü‰∏çË¢´Êµ™Ë¥π</p>
<h5 id="1-3-3-2-I-O-ÂØÜÈõÜÂûãËøêÁÆó"><a href="#1-3-3-2-I-O-ÂØÜÈõÜÂûãËøêÁÆó" class="headerlink" title="1.3.3.2 I&#x2F;O ÂØÜÈõÜÂûãËøêÁÆó"></a>1.3.3.2 I&#x2F;O ÂØÜÈõÜÂûãËøêÁÆó</h5><p>CPU ‰∏çÊÄªÊòØÂ§Ñ‰∫éÁπÅÂøôÁä∂ÊÄÅÔºå‰æãÂ¶ÇÔºåÂΩì‰Ω†ÊâßË°å‰∏öÂä°ËÆ°ÁÆóÊó∂ÔºåËøôÊó∂ÂÄô‰ºö‰ΩøÁî® CPU ËµÑÊ∫êÔºå‰ΩÜÂΩì‰Ω†ÊâßË°å I&#x2F;O Êìç‰ΩúÊó∂„ÄÅËøúÁ®ãRPC Ë∞ÉÁî®Êó∂ÔºåÂåÖÊã¨ËøõË°åÊï∞ÊçÆÂ∫ìÊìç‰ΩúÊó∂ÔºåËøôÊó∂ÂÄô CPU Â∞±Èó≤‰∏ãÊù•‰∫ÜÔºå‰Ω†ÂèØ‰ª•Âà©Áî®Â§öÁ∫øÁ®ãÊèêÈ´òÂÆÉÁöÑÂà©Áî®Áéá„ÄÇ</p>
<p><code>Á∫øÁ®ãÊï∞ = Ê†∏Êï∞ * ÊúüÊúõ CPU Âà©Áî®Áéá * ÊÄªÊó∂Èó¥(CPUËÆ°ÁÆóÊó∂Èó¥+Á≠âÂæÖÊó∂Èó¥) / CPU ËÆ°ÁÆóÊó∂Èó¥</code></p>
<ul>
<li>‰æãÂ¶Ç 4 Ê†∏ CPU ËÆ°ÁÆóÊó∂Èó¥ÊòØ 10% ÔºåÂÖ∂ÂÆÉÁ≠âÂæÖÊó∂Èó¥ÊòØ 90%ÔºåÊúüÊúõ cpu Ë¢´ 100% Âà©Áî®ÔºåÂ•óÁî®ÂÖ¨Âºè<br><code>4 * 100% * 100% / 10% = 40</code></li>
</ul>
<h3 id="1-4-Fork-Join-Á∫øÁ®ãÊ±†"><a href="#1-4-Fork-Join-Á∫øÁ®ãÊ±†" class="headerlink" title="1.4 Fork&#x2F;Join Á∫øÁ®ãÊ±†"></a>1.4 Fork&#x2F;Join Á∫øÁ®ãÊ±†</h3><h4 id="1-4-1-Ê¶ÇÂøµ"><a href="#1-4-1-Ê¶ÇÂøµ" class="headerlink" title="1.4.1 Ê¶ÇÂøµ"></a>1.4.1 Ê¶ÇÂøµ</h4><ul>
<li>Fork&#x2F;Join ÊòØ JDK 1.7 Âä†ÂÖ•ÁöÑÊñ∞ÁöÑÁ∫øÁ®ãÊ±†ÂÆûÁé∞ÔºåÂÆÉ‰ΩìÁé∞ÁöÑÊòØ‰∏ÄÁßç<strong>ÂàÜÊ≤ªÊÄùÊÉ≥</strong>Ôºå<strong>ÈÄÇÁî®‰∫éËÉΩÂ§üËøõË°å‰ªªÂä°ÊãÜÂàÜÁöÑ cpu ÂØÜÈõÜÂûãËøêÁÆó</strong></li>
<li>ÊâÄË∞ìÁöÑ‰ªªÂä°ÊãÜÂàÜÔºåÊòØÂ∞Ü‰∏Ä‰∏™Â§ß‰ªªÂä°ÊãÜÂàÜ‰∏∫ÁÆóÊ≥ï‰∏äÁõ∏ÂêåÁöÑÂ∞è‰ªªÂä°ÔºåÁõ¥Ëá≥‰∏çËÉΩÊãÜÂàÜÂèØ‰ª•Áõ¥Êé•Ê±ÇËß£„ÄÇË∑üÈÄíÂΩíÁõ∏ÂÖ≥ÁöÑ‰∏Ä‰∫õËÆ°ÁÆóÔºåÂ¶ÇÂΩíÂπ∂ÊéíÂ∫è„ÄÅÊñêÊ≥¢ÈÇ£Â•ëÊï∞Âàó„ÄÅÈÉΩÂèØ‰ª•Áî®ÂàÜÊ≤ªÊÄùÊÉ≥ËøõË°åÊ±ÇËß£</li>
<li>Fork&#x2F;Join Âú®ÂàÜÊ≤ªÁöÑÂü∫Á°Ä‰∏äÂä†ÂÖ•‰∫ÜÂ§öÁ∫øÁ®ãÔºåÂèØ‰ª•ÊääÊØè‰∏™‰ªªÂä°ÁöÑÂàÜËß£ÂíåÂêàÂπ∂‰∫§Áªô‰∏çÂêåÁöÑÁ∫øÁ®ãÊù•ÂÆåÊàêÔºåËøõ‰∏ÄÊ≠•ÊèêÂçá‰∫ÜËøêÁÆóÊïàÁéá</li>
<li>Fork&#x2F;Join ÈªòËÆ§‰ºö<strong>ÂàõÂª∫‰∏é cpu Ê†∏ÂøÉÊï∞Â§ßÂ∞èÁõ∏Âêå</strong>ÁöÑÁ∫øÁ®ãÊ±†</li>
</ul>
<h4 id="1-4-2-‰ΩøÁî®"><a href="#1-4-2-‰ΩøÁî®" class="headerlink" title="1.4.2 ‰ΩøÁî®"></a>1.4.2 ‰ΩøÁî®</h4><p>Êèê‰∫§Áªô Fork&#x2F;Join Á∫øÁ®ãÊ±†ÁöÑ‰ªªÂä°ÈúÄË¶ÅÁªßÊâø RecursiveTaskÔºàÊúâËøîÂõûÂÄºÔºâÊàñ RecursiveActionÔºàÊ≤°ÊúâËøîÂõûÂÄºÔºâÔºå‰æãÂ¶Ç‰∏ãÈù¢ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ÂØπ 1~n ‰πãÈó¥ÁöÑÊï¥Êï∞Ê±ÇÂíåÁöÑ‰ªªÂä°</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.7.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2-J-U-C-java-util-concurrent"><a href="#2-J-U-C-java-util-concurrent" class="headerlink" title="2. J.U.C(java.util.concurrent)"></a>2. J.U.C(java.util.concurrent)</h2><h3 id="2-1-AQS-ÂéüÁêÜ"><a href="#2-1-AQS-ÂéüÁêÜ" class="headerlink" title="2.1 AQS ÂéüÁêÜ"></a>2.1 AQS ÂéüÁêÜ</h3><p>ÂÖ®Áß∞ÊòØ AbstractQueuedSynchronizerÔºåÊòØÈòªÂ°ûÂºèÈîÅÂíåÁõ∏ÂÖ≥ÁöÑÂêåÊ≠•Âô®Â∑•ÂÖ∑ÁöÑÊ°ÜÊû∂</p>
<ul>
<li>Áî® state Â±ûÊÄßÊù•Ë°®Á§∫ËµÑÊ∫êÁöÑÁä∂ÊÄÅÔºàÂàÜÁã¨Âç†Ê®°ÂºèÂíåÂÖ±‰∫´Ê®°ÂºèÔºâÔºåÂ≠êÁ±ªÈúÄË¶ÅÂÆö‰πâÂ¶Ç‰ΩïÁª¥Êä§Ëøô‰∏™Áä∂ÊÄÅÔºåÊéßÂà∂Â¶Ç‰ΩïËé∑ÂèñÈîÅÂíåÈáäÊîæÈîÅ<ul>
<li>getState - Ëé∑Âèñ state Áä∂ÊÄÅ</li>
<li>setState - ËÆæÁΩÆ state Áä∂ÊÄÅ</li>
<li>compareAndSetState - cas Êú∫Âà∂ËÆæÁΩÆ state Áä∂ÊÄÅ</li>
<li>Áã¨Âç†Ê®°ÂºèÊòØÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËÉΩÂ§üËÆøÈóÆËµÑÊ∫êÔºåËÄåÂÖ±‰∫´Ê®°ÂºèÂèØ‰ª•ÂÖÅËÆ∏Â§ö‰∏™Á∫øÁ®ãËÆøÈóÆËµÑÊ∫ê</li>
</ul>
</li>
<li>Êèê‰æõ‰∫ÜÂü∫‰∫é FIFO ÁöÑÁ≠âÂæÖÈòüÂàóÔºåÁ±ª‰ºº‰∫é Monitor ÁöÑ EntryList</li>
<li>Êù°‰ª∂ÂèòÈáèÊù•ÂÆûÁé∞Á≠âÂæÖ„ÄÅÂî§ÈÜíÊú∫Âà∂ÔºåÊîØÊåÅÂ§ö‰∏™Êù°‰ª∂ÂèòÈáèÔºåÁ±ª‰ºº‰∫é Monitor ÁöÑ WaitSet</li>
</ul>
<p>Â≠êÁ±ª‰∏ªË¶ÅÂÆûÁé∞ËøôÊ†∑‰∏Ä‰∫õÊñπÊ≥ïÔºàÈªòËÆ§ÊäõÂá∫ UnsupportedOperationExceptionÔºâ</p>
<ul>
<li>tryAcquire</li>
<li>tryRelease</li>
<li>tryAcquireShared</li>
<li>tryReleaseShared</li>
<li>isHeldExclusively</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Ëé∑ÂèñÈîÅ</span><br><span class="hljs-comment">// Â¶ÇÊûúËé∑ÂèñÈîÅÂ§±Ë¥•</span><br><span class="hljs-keyword">if</span> (!tryAcquire(arg)) &#123;<br>    <span class="hljs-comment">// ÂÖ•Èòü, ÂèØ‰ª•ÈÄâÊã©ÈòªÂ°ûÂΩìÂâçÁ∫øÁ®ã  park unpark</span><br>&#125;<br><br><span class="hljs-comment">//ÈáäÊîæÈîÅ</span><br><span class="hljs-comment">// Â¶ÇÊûúÈáäÊîæÈîÅÊàêÂäü</span><br><span class="hljs-keyword">if</span> (tryRelease(arg)) &#123;<br>    <span class="hljs-comment">// ËÆ©ÈòªÂ°ûÁ∫øÁ®ãÊÅ¢Â§çËøêË°å</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-ReentrantLock-ÂéüÁêÜ"><a href="#2-2-ReentrantLock-ÂéüÁêÜ" class="headerlink" title="2.2 ReentrantLock ÂéüÁêÜ"></a>2.2 ReentrantLock ÂéüÁêÜ</h3><p><img src="/img/blogs/java/jvm-juc/juc.7.8.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="2-2-1-ÈùûÂÖ¨Âπ≥ÈîÅÂÆûÁé∞ÂéüÁêÜ"><a href="#2-2-1-ÈùûÂÖ¨Âπ≥ÈîÅÂÆûÁé∞ÂéüÁêÜ" class="headerlink" title="2.2.1 ÈùûÂÖ¨Âπ≥ÈîÅÂÆûÁé∞ÂéüÁêÜ"></a>2.2.1 ÈùûÂÖ¨Âπ≥ÈîÅÂÆûÁé∞ÂéüÁêÜ</h4><p>ÂÖà‰ªéÊûÑÈÄ†Âô®ÂºÄÂßãÁúãÔºåÈªòËÆ§‰∏∫ÈùûÂÖ¨Âπ≥ÈîÅÂÆûÁé∞</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ReentrantLock</span><span class="hljs-params">()</span> &#123;<br>       sync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>();<span class="hljs-comment">//NonfairSync ÁªßÊâøËá™ AQS</span><br>   &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Ê≤°ÊúâÁ´û‰∫âÊó∂</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.9.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>Á¨¨‰∏Ä‰∏™Á´û‰∫âÂá∫Áé∞Êó∂</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.10.png" srcset="/img/loading.gif" lazyload></p>
<p>Thread-1 ÊâßË°å‰∫Ü</p>
<ol>
<li>CAS Â∞ùËØïÂ∞Ü state Áî± 0 Êîπ‰∏∫ 1ÔºåÁªìÊûúÂ§±Ë¥•</li>
<li>ËøõÂÖ• tryAcquire ÈÄªËæëÔºåËøôÊó∂ state Â∑≤ÁªèÊòØ1ÔºåÁªìÊûú‰ªçÁÑ∂Â§±Ë¥•</li>
<li>Êé•‰∏ãÊù•ËøõÂÖ• addWaiter ÈÄªËæëÔºåÊûÑÈÄ† Node ÈòüÂàó<ul>
<li>Âõæ‰∏≠ÈªÑËâ≤‰∏âËßíË°®Á§∫ËØ• Node ÁöÑ waitStatus Áä∂ÊÄÅÔºåÂÖ∂‰∏≠ 0 ‰∏∫ÈªòËÆ§Ê≠£Â∏∏Áä∂ÊÄÅ</li>
<li>Node ÁöÑÂàõÂª∫ÊòØÊáíÊÉ∞ÁöÑ</li>
<li>ÂÖ∂‰∏≠Á¨¨‰∏Ä‰∏™ Node Áß∞‰∏∫ DummyÔºàÂìëÂÖÉÔºâÊàñÂì®ÂÖµÔºåÁî®Êù•Âç†‰ΩçÔºåÂπ∂‰∏çÂÖ≥ËÅîÁ∫øÁ®ã</li>
</ul>
</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.7.11.png" srcset="/img/loading.gif" lazyload></p>
<p>ÂΩìÂâçÁ∫øÁ®ãËøõÂÖ• acquireQueued ÈÄªËæë</p>
<ol>
<li>acquireQueued ‰ºöÂú®‰∏Ä‰∏™Ê≠ªÂæ™ÁéØ‰∏≠‰∏çÊñ≠Â∞ùËØïËé∑ÂæóÈîÅÔºåÂ§±Ë¥•ÂêéËøõÂÖ• park ÈòªÂ°û</li>
<li>Â¶ÇÊûúËá™Â∑±ÊòØÁ¥ßÈÇªÁùÄ headÔºàÊéíÁ¨¨‰∫å‰ΩçÔºâÔºåÈÇ£‰πàÂÜçÊ¨° tryAcquire Â∞ùËØïËé∑ÂèñÈîÅÔºåÂΩìÁÑ∂ËøôÊó∂state ‰ªç‰∏∫ 1ÔºåÂ§±Ë¥•</li>
<li>ËøõÂÖ• shouldParkAfterFailedAcquire ÈÄªËæëÔºåÂ∞ÜÂâçÈ©± nodeÔºåÂç≥ head ÁöÑ waitStatus Êîπ‰∏∫ -1ÔºåËøôÊ¨°ËøîÂõû false</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.7.12.png" srcset="/img/loading.gif" lazyload></p>
<ol start="4">
<li>shouldParkAfterFailedAcquire ÊâßË°åÂÆåÊØïÂõûÂà∞ acquireQueued ÔºåÂÜçÊ¨° tryAcquire Â∞ùËØïËé∑ÂèñÈîÅÔºåÂΩìÁÑ∂ËøôÊó∂ state ‰ªç‰∏∫ 1ÔºåÂ§±Ë¥•</li>
<li>ÂΩìÂÜçÊ¨°ËøõÂÖ• shouldParkAfterFailedAcquire Êó∂ÔºåËøôÊó∂Âõ†‰∏∫ÂÖ∂ÂâçÈ©± node ÁöÑ waitStatus Â∑≤ÁªèÊòØ -1ÔºåËøôÊ¨°ËøîÂõû true</li>
<li>ËøõÂÖ• parkAndCheckInterruptÔºå Thread-1 parkÔºàÁÅ∞Ëâ≤Ë°®Á§∫Ôºâ</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.7.13.png" srcset="/img/loading.gif" lazyload></p>
<p>ÂÜçÊ¨°ÊúâÂ§ö‰∏™Á∫øÁ®ãÁªèÂéÜ‰∏äËø∞ËøáÁ®ãÁ´û‰∫âÂ§±Ë¥•ÔºåÂèòÊàêËøô‰∏™Ê†∑Â≠ê</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.14.png" srcset="/img/loading.gif" lazyload></p>
<p>Thread-0 ÈáäÊîæÈîÅÔºåËøõÂÖ• tryRelease ÊµÅÁ®ãÔºåÂ¶ÇÊûúÊàêÂäü</p>
<ul>
<li>ËÆæÁΩÆ exclusiveOwnerThread ‰∏∫ null</li>
<li>state &#x3D; 0</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.15.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>ÂΩìÂâçÈòüÂàó‰∏ç‰∏∫ nullÔºåÂπ∂‰∏î head ÁöÑ waitStatus &#x3D; -1ÔºåËøõÂÖ• unparkSuccessor ÊµÅÁ®ã</li>
<li>ÊâæÂà∞ÈòüÂàó‰∏≠Á¶ª head ÊúÄËøëÁöÑ‰∏Ä‰∏™ NodeÔºàÊ≤°ÂèñÊ∂àÁöÑÔºâÔºåunpark ÊÅ¢Â§çÂÖ∂ËøêË°åÔºåÊú¨‰æã‰∏≠Âç≥‰∏∫Thread-1</li>
<li>ÂõûÂà∞ Thread-1 ÁöÑ acquireQueued ÊµÅÁ®ã</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.16.png" srcset="/img/loading.gif" lazyload></p>
<p>Â¶ÇÊûúÂä†ÈîÅÊàêÂäüÔºàÊ≤°ÊúâÁ´û‰∫âÔºâÔºå‰ºöËÆæÁΩÆ</p>
<ul>
<li>exclusiveOwnerThread ‰∏∫ Thread-1Ôºåstate &#x3D; 1</li>
<li>head ÊåáÂêëÂàöÂàö Thread-1 ÊâÄÂú®ÁöÑ NodeÔºåËØ• Node Ê∏ÖÁ©∫ Thread</li>
<li>ÂéüÊú¨ÁöÑ head Âõ†‰∏∫‰ªéÈìæË°®Êñ≠ÂºÄÔºåËÄåÂèØË¢´ÂûÉÂúæÂõûÊî∂<br>Â¶ÇÊûúËøôÊó∂ÂÄôÊúâÂÖ∂ÂÆÉÁ∫øÁ®ãÊù•Á´û‰∫âÔºàÈùûÂÖ¨Âπ≥ÁöÑ‰ΩìÁé∞ÔºâÔºå‰æãÂ¶ÇËøôÊó∂Êúâ Thread-4 Êù•‰∫Ü</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.17.png" srcset="/img/loading.gif" lazyload></p>
<p>Â¶ÇÊûú‰∏çÂ∑ßÂèàË¢´ Thread-4 Âç†‰∫ÜÂÖà</p>
<ul>
<li>Thread-4 Ë¢´ËÆæÁΩÆ‰∏∫ exclusiveOwnerThreadÔºåstate &#x3D; 1</li>
<li>Thread-1 ÂÜçÊ¨°ËøõÂÖ• acquireQueued ÊµÅÁ®ãÔºåËé∑ÂèñÈîÅÂ§±Ë¥•ÔºåÈáçÊñ∞ËøõÂÖ• park ÈòªÂ°û</li>
</ul>
<h4 id="2-2-2-ÂèØÈáçÂÖ•ÂéüÁêÜ"><a href="#2-2-2-ÂèØÈáçÂÖ•ÂéüÁêÜ" class="headerlink" title="2.2.2 ÂèØÈáçÂÖ•ÂéüÁêÜ"></a>2.2.2 ÂèØÈáçÂÖ•ÂéüÁêÜ</h4><ul>
<li>Âä†ÈîÅÊó∂ÔºöÊØèÂ¢ûÂä†‰∏Ä‰∏™ÈîÅÔºåÁä∂ÊÄÅÂä†‰∏ÄÔºåstate++</li>
<li>Ëß£ÈîÅÊó∂ÔºöËß£ÈîÅ‰∏ÄÂ±ÇÔºåstate‚ÄìÔºõÁõ¥Âà∞‰∏∫0ÊâçÈáäÊîæÈîÅ</li>
</ul>
<h4 id="2-2-3-ÂèØÊâìÊñ≠ÂéüÁêÜ"><a href="#2-2-3-ÂèØÊâìÊñ≠ÂéüÁêÜ" class="headerlink" title="2.2.3 ÂèØÊâìÊñ≠ÂéüÁêÜ"></a>2.2.3 ÂèØÊâìÊñ≠ÂéüÁêÜ</h4><ul>
<li>‰∏çÂèØÊâìÊñ≠Ê®°ÂºèÔºö Âú®Ê≠§Ê®°Âºè‰∏ãÔºåÂç≥‰ΩøÂÆÉË¢´ÊâìÊñ≠Ôºå‰ªç<strong>‰ºöÈ©ªÁïôÂú® AQS ÈòüÂàó</strong>‰∏≠Ôºå‰∏ÄÁõ¥Ë¶ÅÁ≠âÂà∞Ëé∑ÂæóÈîÅÂêéÊñπËÉΩÂæóÁü•Ëá™Â∑±Ë¢´ÊâìÊñ≠‰∫Ü</li>
<li>ÂèØÊâìÊñ≠Ê®°ÂºèÔºö Âú® park ËøáÁ®ã‰∏≠Â¶ÇÊûúË¢´ interrupt ÔºåËøôÊó∂ÂÄô<strong>ÊäõÂá∫ÂºÇÂ∏∏</strong>, ËÄå‰∏ç‰ºöÂÜçÊ¨°ËøõÂÖ• for (;;)</li>
</ul>
<h4 id="2-2-4-ÂÖ¨Âπ≥ÈîÅÂÆûÁé∞ÂéüÁêÜ"><a href="#2-2-4-ÂÖ¨Âπ≥ÈîÅÂÆûÁé∞ÂéüÁêÜ" class="headerlink" title="2.2.4 ÂÖ¨Âπ≥ÈîÅÂÆûÁé∞ÂéüÁêÜ"></a>2.2.4 ÂÖ¨Âπ≥ÈîÅÂÆûÁé∞ÂéüÁêÜ</h4><p>ÂÖ¨Âπ≥ÈîÅÔºö ÂÖàÊ£ÄÊü• AQS ÈòüÂàó‰∏≠ÊòØÂê¶ÊúâÂâçÈ©±ËäÇÁÇπ, Ê≤°ÊúâÊâçÂéªÁ´û‰∫â</p>
<h4 id="2-2-5-Êù°‰ª∂ÂèòÈáèÂÆûÁé∞ÂéüÁêÜ"><a href="#2-2-5-Êù°‰ª∂ÂèòÈáèÂÆûÁé∞ÂéüÁêÜ" class="headerlink" title="2.2.5 Êù°‰ª∂ÂèòÈáèÂÆûÁé∞ÂéüÁêÜ"></a>2.2.5 Êù°‰ª∂ÂèòÈáèÂÆûÁé∞ÂéüÁêÜ</h4><p>ÊØè‰∏™Êù°‰ª∂ÂèòÈáèÂÖ∂ÂÆûÂ∞±ÂØπÂ∫îÁùÄ‰∏Ä‰∏™Á≠âÂæÖÈòüÂàóÔºåÂÖ∂ÂÆûÁé∞Á±ªÊòØ ConditionObject</p>
<h5 id="2-2-5-1-await-ÊµÅÁ®ã"><a href="#2-2-5-1-await-ÊµÅÁ®ã" class="headerlink" title="2.2.5.1 await ÊµÅÁ®ã"></a>2.2.5.1 await ÊµÅÁ®ã</h5><ul>
<li>ÂºÄÂßã Thread-0 ÊåÅÊúâÈîÅÔºåË∞ÉÁî® awaitÔºåËøõÂÖ• ConditionObject ÁöÑ addConditionWaiter ÊµÅÁ®ã</li>
<li>ÂàõÂª∫Êñ∞ÁöÑ Node Áä∂ÊÄÅ‰∏∫ -2ÔºàNode.CONDITIONÔºâÔºåÂÖ≥ËÅî Thread-0ÔºåÂä†ÂÖ•Á≠âÂæÖÈòüÂàóÂ∞æÈÉ®</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.18.png" srcset="/img/loading.gif" lazyload></p>
<p>Êé•‰∏ãÊù•ËøõÂÖ• AQS ÁöÑ fullyRelease ÊµÅÁ®ãÔºåÈáäÊîæÂêåÊ≠•Âô®‰∏äÁöÑÈîÅ</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.19.png" srcset="/img/loading.gif" lazyload></p>
<p>unpark AQS ÈòüÂàó‰∏≠ÁöÑ‰∏ã‰∏Ä‰∏™ËäÇÁÇπÔºåÁ´û‰∫âÈîÅÔºåÂÅáËÆæÊ≤°ÊúâÂÖ∂‰ªñÁ´û‰∫âÁ∫øÁ®ãÔºåÈÇ£‰πà Thread-1 Á´û‰∫âÊàêÂäü</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.20.png" srcset="/img/loading.gif" lazyload></p>
<p>park ÈòªÂ°û Thread-0</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.21.png" srcset="/img/loading.gif" lazyload></p>
<h5 id="2-2-5-2-signal-ÊµÅÁ®ã"><a href="#2-2-5-2-signal-ÊµÅÁ®ã" class="headerlink" title="2.2.5.2 signal ÊµÅÁ®ã"></a>2.2.5.2 signal ÊµÅÁ®ã</h5><p>ÂÅáËÆæ Thread-1 Ë¶ÅÊù•Âî§ÈÜí Thread-0</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.22.png" srcset="/img/loading.gif" lazyload></p>
<p>ËøõÂÖ• ConditionObject ÁöÑ doSignal ÊµÅÁ®ãÔºåÂèñÂæóÁ≠âÂæÖÈòüÂàó‰∏≠Á¨¨‰∏Ä‰∏™ NodeÔºåÂç≥ Thread-0 ÊâÄÂú® Node</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.23.png" srcset="/img/loading.gif" lazyload></p>
<p>ÊâßË°å transferForSignal ÊµÅÁ®ãÔºåÂ∞ÜËØ• Node Âä†ÂÖ• AQS ÈòüÂàóÂ∞æÈÉ®ÔºåÂ∞Ü Thread-0 ÁöÑ waitStatus Êîπ‰∏∫ 0ÔºåThread-3 ÁöÑwaitStatus Êîπ‰∏∫ -1</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.24.png" srcset="/img/loading.gif" lazyload></p>
<p>Thread-1 ÈáäÊîæÈîÅÔºåËøõÂÖ• unlock ÊµÅÁ®ãÔºåÁï•</p>
<h3 id="2-3-ËØªÂÜôÈîÅ"><a href="#2-3-ËØªÂÜôÈîÅ" class="headerlink" title="2.3 ËØªÂÜôÈîÅ"></a>2.3 ËØªÂÜôÈîÅ</h3><h4 id="2-3-1-ReentrantReadWriteLock"><a href="#2-3-1-ReentrantReadWriteLock" class="headerlink" title="2.3.1 ReentrantReadWriteLock"></a>2.3.1 ReentrantReadWriteLock</h4><p>ÂΩìËØªÊìç‰ΩúËøúËøúÈ´ò‰∫éÂÜôÊìç‰ΩúÊó∂ÔºåËøôÊó∂ÂÄô<strong>‰ΩøÁî®ËØªÂÜôÈîÅËÆ©ËØª-ËØªÂèØ‰ª•Âπ∂Âèë</strong>ÔºåÊèêÈ´òÊÄßËÉΩ„ÄÇ Á±ª‰ºº‰∫éÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑ  <code>select ...from ... lock in share mode</code></p>
<ul>
<li>ËØªÈîÅ<strong>‰∏çÊîØÊåÅÊù°‰ª∂ÂèòÈáè</strong></li>
<li>ÈáçÂÖ•Êó∂ÂçáÁ∫ß‰∏çÊîØÊåÅÔºöÂç≥ÊåÅÊúâËØªÈîÅÁöÑÊÉÖÂÜµ‰∏ãÂéªËé∑ÂèñÂÜôÈîÅÔºå‰ºöÂØºËá¥Ëé∑ÂèñÂÜôÈîÅÊ∞∏‰πÖÁ≠âÂæÖ</li>
<li>ÈáçÂÖ•Êó∂ÈôçÁ∫ßÊîØÊåÅÔºöÂç≥ÊåÅÊúâÂÜôÈîÅÁöÑÊÉÖÂÜµ‰∏ãÂéªËé∑ÂèñËØªÈîÅ</li>
</ul>
<h4 id="2-3-2-Â∫îÁî®‰πãÁºìÂ≠ò"><a href="#2-3-2-Â∫îÁî®‰πãÁºìÂ≠ò" class="headerlink" title="2.3.2 Â∫îÁî®‰πãÁºìÂ≠ò"></a>2.3.2 Â∫îÁî®‰πãÁºìÂ≠ò</h4><h5 id="2-3-2-1-ÁºìÂ≠òÊõ¥Êñ∞Á≠ñÁï•"><a href="#2-3-2-1-ÁºìÂ≠òÊõ¥Êñ∞Á≠ñÁï•" class="headerlink" title="2.3.2.1 ÁºìÂ≠òÊõ¥Êñ∞Á≠ñÁï•"></a>2.3.2.1 ÁºìÂ≠òÊõ¥Êñ∞Á≠ñÁï•</h5><p>Êõ¥Êñ∞Êó∂ÔºåÊòØÂÖàÊ∏ÖÁºìÂ≠òËøòÊòØÂÖàÊõ¥Êñ∞Êï∞ÊçÆÂ∫ìÔºü</p>
<ul>
<li>ÂÖàÊ∏ÖÈô§ÁºìÂ≠ò:</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.25.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>ÂÖàÊõ¥Êñ∞Êï∞ÊçÆÂ∫ì(Êé®Ëçê)</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.26.png" srcset="/img/loading.gif" lazyload></p>
<h5 id="2-3-2-2-ËØªÂÜôÈîÅÂÆûÁé∞‰∏ÄËá¥ÊÄßÁºìÂ≠ò"><a href="#2-3-2-2-ËØªÂÜôÈîÅÂÆûÁé∞‰∏ÄËá¥ÊÄßÁºìÂ≠ò" class="headerlink" title="2.3.2.2 ËØªÂÜôÈîÅÂÆûÁé∞‰∏ÄËá¥ÊÄßÁºìÂ≠ò"></a>2.3.2.2 ËØªÂÜôÈîÅÂÆûÁé∞‰∏ÄËá¥ÊÄßÁºìÂ≠ò</h5><p>‰ΩøÁî®ËØªÂÜôÈîÅÂèØ‰ª•ÂÆûÁé∞‰∏Ä‰∏™ÁÆÄÂçïÁöÑÊåâÈúÄÂä†ËΩΩÁºìÂ≠òÔºå‰øùËØÅÁºìÂ≠òÂíåÊï∞ÊçÆÂ∫ìÁöÑ‰∏ÄËá¥ÊÄß</p>
<h4 id="2-3-3-StampedLock"><a href="#2-3-3-StampedLock" class="headerlink" title="2.3.3 StampedLock"></a>2.3.3 StampedLock</h4><p>ËØ•Á±ªËá™ JDK 8 Âä†ÂÖ•ÔºåÊòØ‰∏∫‰∫Ü<strong>Ëøõ‰∏ÄÊ≠•‰ºòÂåñËØªÊÄßËÉΩ</strong>ÔºåÂÆÉÁöÑÁâπÁÇπÊòØÂú®‰ΩøÁî®ËØªÈîÅ„ÄÅÂÜôÈîÅÊó∂ÈÉΩÂøÖÈ°ªÈÖçÂêà„ÄêÊà≥„Äë‰ΩøÁî®</p>
<p><strong>Âä†Ëß£ËØªÈîÅ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> lock.readLock();<br>lock.unlockRead(stamp);<br></code></pre></td></tr></table></figure>

<p><strong>Âä†Ëß£ÂÜôÈîÅ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> lock.writeLock();<br>lock.unlockWrite(stamp);<br></code></pre></td></tr></table></figure>

<p><strong>‰πêËßÇËØª</strong>: StampedLock ÊîØÊåÅ tryOptimisticRead() ÊñπÊ≥ïÔºà‰πêËßÇËØªÔºâÔºåËØªÂèñÂÆåÊØïÂêéÈúÄË¶ÅÂÅö‰∏ÄÊ¨° Êà≥Ê†°È™å Â¶ÇÊûúÊ†°È™åÈÄö ËøáÔºåË°®Á§∫ËøôÊúüÈó¥Á°ÆÂÆûÊ≤°ÊúâÂÜôÊìç‰ΩúÔºåÊï∞ÊçÆÂèØ‰ª•ÂÆâÂÖ®‰ΩøÁî®ÔºåÂ¶ÇÊûúÊ†°È™åÊ≤°ÈÄöËøáÔºåÈúÄË¶ÅÈáçÊñ∞Ëé∑ÂèñËØªÈîÅÔºå‰øùËØÅÊï∞ÊçÆÂÆâÂÖ®„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> lock.tryOptimisticRead();<br><span class="hljs-comment">// È™åÊà≥</span><br><span class="hljs-keyword">if</span>(!lock.validate(stamp))&#123;<br> <span class="hljs-comment">// ÈîÅÂçáÁ∫ß</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>StampedLock ‰∏çÊîØÊåÅÊù°‰ª∂ÂèòÈáè</li>
<li>StampedLock ‰∏çÊîØÊåÅÂèØÈáçÂÖ•</li>
</ul>
<h3 id="2-4-ËØªÂÜôÈîÅÂéüÁêÜ"><a href="#2-4-ËØªÂÜôÈîÅÂéüÁêÜ" class="headerlink" title="2.4 ËØªÂÜôÈîÅÂéüÁêÜ"></a>2.4 ËØªÂÜôÈîÅÂéüÁêÜ</h3><p>ËØªÂÜôÈîÅÁî®ÁöÑÊòØÂêå‰∏Ä‰∏™ Sycn ÂêåÊ≠•Âô®ÔºåÂõ†Ê≠§Á≠âÂæÖÈòüÂàó„ÄÅstate Á≠â‰πüÊòØÂêå‰∏Ä‰∏™</p>
<h4 id="2-4-1-t1-w-lockÔºåt2-r-lock"><a href="#2-4-1-t1-w-lockÔºåt2-r-lock" class="headerlink" title="2.4.1 t1 w.lockÔºåt2 r.lock"></a>2.4.1 t1 w.lockÔºåt2 r.lock</h4><ol>
<li>t1 ÊàêÂäü‰∏äÈîÅÔºåÊµÅÁ®ã‰∏é ReentrantLock Âä†ÈîÅÁõ∏ÊØîÊ≤°ÊúâÁâπÊÆä‰πãÂ§ÑÔºå‰∏çÂêåÊòØÂÜôÈîÅÁä∂ÊÄÅÂç†‰∫Ü state ÁöÑ‰Ωé 16 ‰ΩçÔºåËÄåËØªÈîÅ‰ΩøÁî®ÁöÑÊòØ state ÁöÑÈ´ò 16 ‰Ωç</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.7.27.png" srcset="/img/loading.gif" lazyload></p>
<ol start="2">
<li>t2 ÊâßË°å r.lockÔºåËøôÊó∂ËøõÂÖ•ËØªÈîÅÁöÑ sync.acquireShared(1) ÊµÅÁ®ãÔºåÈ¶ñÂÖà‰ºöËøõÂÖ• tryAcquireShared ÊµÅÁ®ã„ÄÇÂ¶ÇÊûúÊúâÂÜôÈîÅÂç†ÊçÆÔºåÈÇ£‰πà tryAcquireShared ËøîÂõû -1 Ë°®Á§∫Â§±Ë¥•</li>
</ol>
<ul>
<li>tryAcquireShared ËøîÂõûÂÄºË°®Á§∫<ul>
<li>-1 Ë°®Á§∫Â§±Ë¥•</li>
<li>0 Ë°®Á§∫ÊàêÂäüÔºå‰ΩÜÂêéÁªßËäÇÁÇπ‰∏ç‰ºöÁªßÁª≠Âî§ÈÜí</li>
<li>Ê≠£Êï∞Ë°®Á§∫ÊàêÂäüÔºåËÄå‰∏îÊï∞ÂÄºÊòØËøòÊúâÂá†‰∏™ÂêéÁªßËäÇÁÇπÈúÄË¶ÅÂî§ÈÜíÔºåËØªÂÜôÈîÅËøîÂõû 1</li>
</ul>
</li>
</ul>
<p><img src="/img/blogs/java/jvm-juc/juc.7.28.png" srcset="/img/loading.gif" lazyload></p>
<ol start="3">
<li>ËøôÊó∂‰ºöËøõÂÖ• sync.doAcquireShared(1) ÊµÅÁ®ãÔºåÈ¶ñÂÖà‰πüÊòØË∞ÉÁî® addWaiter Ê∑ªÂä†ËäÇÁÇπÔºå‰∏çÂêå‰πãÂ§ÑÂú®‰∫éËäÇÁÇπË¢´ËÆæÁΩÆ‰∏∫Node.SHARED Ê®°ÂºèËÄåÈùû Node.EXCLUSIVE Ê®°ÂºèÔºåÊ≥®ÊÑèÊ≠§Êó∂ t2 ‰ªçÂ§Ñ‰∫éÊ¥ªË∑ÉÁä∂ÊÄÅ</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.7.29.png" srcset="/img/loading.gif" lazyload></p>
<ol start="4">
<li>t2 ‰ºöÁúãÁúãËá™Â∑±ÁöÑËäÇÁÇπÊòØ‰∏çÊòØËÄÅ‰∫åÔºåÂ¶ÇÊûúÊòØÔºåËøò‰ºöÂÜçÊ¨°Ë∞ÉÁî® tryAcquireShared(1) Êù•Â∞ùËØïËé∑ÂèñÈîÅ</li>
<li>Â¶ÇÊûúÊ≤°ÊúâÊàêÂäüÔºåÂú® doAcquireShared ÂÜÖ for (;;) Âæ™ÁéØ‰∏ÄÊ¨°ÔºåÊääÂâçÈ©±ËäÇÁÇπÁöÑ waitStatus Êîπ‰∏∫ -1ÔºåÂÜç for (;;) Âæ™ÁéØ‰∏ÄÊ¨°Â∞ùËØï tryAcquireShared(1) Â¶ÇÊûúËøò‰∏çÊàêÂäüÔºåÈÇ£‰πàÂú® parkAndCheckInterrupt() Â§Ñ park</li>
</ol>
<p><img src="/img/blogs/java/jvm-juc/juc.7.30.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="2-4-2-t3-r-lockÔºåt4-w-lock"><a href="#2-4-2-t3-r-lockÔºåt4-w-lock" class="headerlink" title="2.4.2 t3 r.lockÔºåt4 w.lock"></a>2.4.2 t3 r.lockÔºåt4 w.lock</h4><p>ËøôÁßçÁä∂ÊÄÅ‰∏ãÔºåÂÅáËÆæÂèàÊúâ t3 Âä†ËØªÈîÅÂíå t4 Âä†ÂÜôÈîÅÔºåËøôÊúüÈó¥ t1 ‰ªçÁÑ∂ÊåÅÊúâÈîÅÔºåÂ∞±ÂèòÊàê‰∫Ü‰∏ãÈù¢ÁöÑÊ†∑Â≠ê</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.31.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="2-4-3-t1-w-unlock"><a href="#2-4-3-t1-w-unlock" class="headerlink" title="2.4.3 t1 w.unlock"></a>2.4.3 t1 w.unlock</h4><p>ËøôÊó∂‰ºöËµ∞Âà∞ÂÜôÈîÅÁöÑ sync.release(1) ÊµÅÁ®ãÔºåË∞ÉÁî® sync.tryRelease(1) ÊàêÂäüÔºåÂèòÊàê‰∏ãÈù¢ÁöÑÊ†∑Â≠ê</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.32.png" srcset="/img/loading.gif" lazyload></p>
<p>Êé•‰∏ãÊù•ÊâßË°åÂî§ÈÜíÊµÅÁ®ã sync.unparkSuccessorÔºåÂç≥ËÆ©ËÄÅ‰∫åÊÅ¢Â§çËøêË°åÔºåËøôÊó∂ t2 Âú® doAcquireShared ÂÜÖparkAndCheckInterrupt() Â§ÑÊÅ¢Â§çËøêË°å<br>ËøôÂõûÂÜçÊù•‰∏ÄÊ¨° for (;;) ÊâßË°å tryAcquireShared ÊàêÂäüÂàôËÆ©ËØªÈîÅËÆ°Êï∞Âä†‰∏Ä</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.33.png" srcset="/img/loading.gif" lazyload></p>
<p>ËøôÊó∂ t2 Â∑≤ÁªèÊÅ¢Â§çËøêË°åÔºåÊé•‰∏ãÊù• t2 Ë∞ÉÁî® setHeadAndPropagate(node, 1)ÔºåÂÆÉÂéüÊú¨ÊâÄÂú®ËäÇÁÇπË¢´ÁΩÆ‰∏∫Â§¥ËäÇÁÇπ</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.34.png" srcset="/img/loading.gif" lazyload></p>
<p>‰∫ãÊÉÖËøòÊ≤°ÂÆåÔºåÂú® setHeadAndPropagate ÊñπÊ≥ïÂÜÖËøò‰ºöÊ£ÄÊü•‰∏ã‰∏Ä‰∏™ËäÇÁÇπÊòØÂê¶ÊòØ sharedÔºåÂ¶ÇÊûúÊòØÂàôË∞ÉÁî®doReleaseShared() Â∞Ü head ÁöÑÁä∂ÊÄÅ‰ªé -1 Êîπ‰∏∫ 0 Âπ∂Âî§ÈÜíËÄÅ‰∫åÔºåËøôÊó∂ t3 Âú®doAcquireShared ÂÜÖparkAndCheckInterrupt() Â§ÑÊÅ¢Â§çËøêË°å</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.35.png" srcset="/img/loading.gif" lazyload></p>
<p>ËøôÂõûÂÜçÊù•‰∏ÄÊ¨° for (;;) ÊâßË°å tryAcquireShared ÊàêÂäüÂàôËÆ©ËØªÈîÅËÆ°Êï∞Âä†‰∏Ä</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.36.png" srcset="/img/loading.gif" lazyload></p>
<p>ËøôÊó∂ t3 Â∑≤ÁªèÊÅ¢Â§çËøêË°åÔºåÊé•‰∏ãÊù• t3 Ë∞ÉÁî® setHeadAndPropagate(node, 1)ÔºåÂÆÉÂéüÊú¨ÊâÄÂú®ËäÇÁÇπË¢´ÁΩÆ‰∏∫Â§¥ËäÇÁÇπ</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.37.png" srcset="/img/loading.gif" lazyload></p>
<p>‰∏ã‰∏Ä‰∏™ËäÇÁÇπ‰∏çÊòØ shared ‰∫ÜÔºåÂõ†Ê≠§‰∏ç‰ºöÁªßÁª≠Âî§ÈÜí t4 ÊâÄÂú®ËäÇÁÇπ</p>
<h4 id="2-4-4-t2-r-unlockÔºåt3-r-unlock"><a href="#2-4-4-t2-r-unlockÔºåt3-r-unlock" class="headerlink" title="2.4.4 t2 r.unlockÔºåt3 r.unlock"></a>2.4.4 t2 r.unlockÔºåt3 r.unlock</h4><p>t2 ËøõÂÖ• sync.releaseShared(1) ‰∏≠ÔºåË∞ÉÁî® tryReleaseShared(1) ËÆ©ËÆ°Êï∞Âáè‰∏ÄÔºå‰ΩÜÁî±‰∫éËÆ°Êï∞Ëøò‰∏ç‰∏∫Èõ∂</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.38.png" srcset="/img/loading.gif" lazyload></p>
<p>t3 ËøõÂÖ• sync.releaseShared(1) ‰∏≠ÔºåË∞ÉÁî® tryReleaseShared(1) ËÆ©ËÆ°Êï∞Âáè‰∏ÄÔºåËøôÂõûËÆ°Êï∞‰∏∫Èõ∂‰∫ÜÔºåËøõÂÖ•doReleaseShared() Â∞ÜÂ§¥ËäÇÁÇπ‰ªé -1 Êîπ‰∏∫ 0 Âπ∂Âî§ÈÜíËÄÅ‰∫åÔºåÂç≥</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.39.png" srcset="/img/loading.gif" lazyload></p>
<p>‰πãÂêé t4 Âú® acquireQueued ‰∏≠ parkAndCheckInterrupt Â§ÑÊÅ¢Â§çËøêË°åÔºåÂÜçÊ¨° for (;;) ËøôÊ¨°Ëá™Â∑±ÊòØËÄÅ‰∫åÔºåÂπ∂‰∏îÊ≤°ÊúâÂÖ∂‰ªñÁ´û‰∫âÔºåtryAcquire(1) ÊàêÂäüÔºå‰øÆÊîπÂ§¥ÁªìÁÇπÔºåÊµÅÁ®ãÁªìÊùü</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.40.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-5-Semaphore"><a href="#2-5-Semaphore" class="headerlink" title="2.5 Semaphore"></a>2.5 Semaphore</h3><h4 id="2-5-1-ÂÆö‰πâ"><a href="#2-5-1-ÂÆö‰πâ" class="headerlink" title="2.5.1 ÂÆö‰πâ"></a>2.5.1 ÂÆö‰πâ</h4><p>‰ø°Âè∑ÈáèÔºå<strong>Áî®Êù•ÈôêÂà∂ËÉΩÂêåÊó∂ËÆøÈóÆÂÖ±‰∫´ËµÑÊ∫êÁöÑÁ∫øÁ®ã‰∏äÈôê</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 1. ÂàõÂª∫‰∏Ä‰∏™ÂØπË±°</span><br>        <span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">3</span>);<br><br>        <span class="hljs-comment">// 2. ÂºÄ 10 ‰∏™Á∫øÁ®ã</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                <span class="hljs-comment">// Ëé∑Âèñ‰∏Ä‰∏™ËÆ∏ÂèØ</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    semaphore.acquire();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.info(<span class="hljs-string">&quot;start ...&quot;</span>);<br>                    Thread.sleep(<span class="hljs-number">1000</span>);<br>                    log.info(<span class="hljs-string">&quot;end ....&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    semaphore.release();<br>                &#125;<br>            &#125;, <span class="hljs-string">&quot;t&quot;</span> + (i + <span class="hljs-number">1</span>)).start();;<br>        &#125;<br><br>    &#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-5-2-semaphoreÂ∫îÁî®"><a href="#2-5-2-semaphoreÂ∫îÁî®" class="headerlink" title="2.5.2 semaphoreÂ∫îÁî®"></a>2.5.2 semaphoreÂ∫îÁî®</h4><p><strong>ÈôêÂà∂ÂØπÂÖ±‰∫´ËµÑÊ∫êÁöÑ‰ΩøÁî®</strong></p>
<ul>
<li>‰ΩøÁî® Semaphore ÈôêÊµÅÔºåÂú®ËÆøÈóÆÈ´òÂ≥∞ÊúüÊó∂ÔºåËÆ©ËØ∑Ê±ÇÁ∫øÁ®ãÈòªÂ°ûÔºåÈ´òÂ≥∞ÊúüËøáÂéªÂÜçÈáäÊîæËÆ∏ÂèØÔºåÂΩìÁÑ∂ÂÆÉÂè™ÈÄÇÂêàÈôêÂà∂ÂçïÊú∫Á∫øÁ®ãÊï∞ÈáèÔºåÂπ∂‰∏î‰ªÖÊòØÈôêÂà∂Á∫øÁ®ãÊï∞ÔºåËÄå‰∏çÊòØÈôêÂà∂ËµÑÊ∫êÊï∞</li>
<li>Áî®  Semaphore ÂÆûÁé∞ÁÆÄÂçïËøûÊé•Ê±†ÔºåÂØπÊØî„Äé‰∫´ÂÖÉÊ®°Âºè„Äè‰∏ãÁöÑÂÆûÁé∞ÔºàÁî®wait notifyÔºâÔºåÊÄßËÉΩÂíåÂèØËØªÊÄßÊòæÁÑ∂Êõ¥Â•ΩÔºåÊ≥®ÊÑè‰∏ãÈù¢ÁöÑÂÆûÁé∞‰∏≠<strong>Á∫øÁ®ãÊï∞ÂíåÊï∞ÊçÆÂ∫ìËøûÊé•Êï∞ÊòØÁõ∏Á≠âÁöÑ</strong></li>
</ul>
<h4 id="2-5-3-Semaphore-ÂéüÁêÜ"><a href="#2-5-3-Semaphore-ÂéüÁêÜ" class="headerlink" title="2.5.3 Semaphore ÂéüÁêÜ"></a>2.5.3 Semaphore ÂéüÁêÜ</h4><p><strong>Âä†ÈîÅËß£ÈîÅÊµÅÁ®ã</strong><br><strong>Semaphore ÊúâÁÇπÂÉè‰∏Ä‰∏™ÂÅúËΩ¶Âú∫</strong>Ôºåpermits Â∞±Â•ΩÂÉèÂÅúËΩ¶‰ΩçÊï∞ÈáèÔºåÂΩìÁ∫øÁ®ãËé∑Âæó‰∫Ü permits Â∞±ÂÉèÊòØËé∑Âæó‰∫ÜÂÅúËΩ¶‰ΩçÔºåÁÑ∂ÂêéÂÅúËΩ¶Âú∫ÊòæÁ§∫Á©∫‰ΩôËΩ¶‰ΩçÂáè‰∏Ä<br>ÂàöÂºÄÂßãÔºåpermitsÔºàstateÔºâ‰∏∫ 3ÔºåËøôÊó∂ 5 ‰∏™Á∫øÁ®ãÊù•Ëé∑ÂèñËµÑÊ∫ê</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.41.png" srcset="/img/loading.gif" lazyload></p>
<p>ÂÅáËÆæÂÖ∂‰∏≠ Thread-1ÔºåThread-2ÔºåThread-4 cas Á´û‰∫âÊàêÂäüÔºåËÄå Thread-0 Âíå Thread-3 Á´û‰∫âÂ§±Ë¥•ÔºåËøõÂÖ• AQS ÈòüÂàópark ÈòªÂ°û</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.42.png" srcset="/img/loading.gif" lazyload></p>
<p>ËøôÊó∂ Thread-4 ÈáäÊîæ‰∫Ü permitsÔºåÁä∂ÊÄÅÂ¶Ç‰∏ã</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.43.png" srcset="/img/loading.gif" lazyload></p>
<p>Êé•‰∏ãÊù• Thread-0 Á´û‰∫âÊàêÂäüÔºåpermits ÂÜçÊ¨°ËÆæÁΩÆ‰∏∫ 0ÔºåËÆæÁΩÆËá™Â∑±‰∏∫ head ËäÇÁÇπÔºåÊñ≠ÂºÄÂéüÊù•ÁöÑ head ËäÇÁÇπÔºåunpark Êé•‰∏ãÊù•ÁöÑ Thread-3 ËäÇÁÇπÔºå‰ΩÜÁî±‰∫é permits ÊòØ 0ÔºåÂõ†Ê≠§ Thread-3 Âú®Â∞ùËØï‰∏çÊàêÂäüÂêéÂÜçÊ¨°ËøõÂÖ• park Áä∂ÊÄÅ</p>
<p><img src="/img/blogs/java/jvm-juc/juc.7.44.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-6-CountdownLatch"><a href="#2-6-CountdownLatch" class="headerlink" title="2.6 CountdownLatch"></a>2.6 CountdownLatch</h3><p><strong>ÂÄíËÆ°Êó∂ÈîÅ</strong></p>
<ul>
<li>CountDownLatch ÂÖÅËÆ∏Â§öÁ∫øÁ®ã<strong>ÈòªÂ°ûÂú®‰∏Ä‰∏™Âú∞Êñπ</strong>Ôºå<strong>Áõ¥Ëá≥ÊâÄÊúâÁ∫øÁ®ãÁöÑ‰ªªÂä°ÈÉΩÊâßË°åÂÆåÊØï</strong>„ÄÇ</li>
<li>Áî®Êù•ËøõË°åÁ∫øÁ®ãÂêåÊ≠•Âçè‰ΩúÔºåÁ≠âÂæÖÊâÄÊúâÁ∫øÁ®ãÂÆåÊàêÂÄíËÆ°Êó∂„ÄÇ</li>
<li>ÂÖ∂‰∏≠ÊûÑÈÄ†ÂèÇÊï∞Áî®Êù•ÂàùÂßãÂåñÁ≠âÂæÖËÆ°Êï∞ÂÄºÔºåawait() Áî®Êù•Á≠âÂæÖËÆ°Êï∞ÂΩíÈõ∂ÔºåcountDown() Áî®Êù•ËÆ©ËÆ°Êï∞Âáè‰∏Ä</li>
<li>Áõ¥Ëá≥ÊúÄÂêé‰∏Ä‰∏™Á∫øÁ®ãË∞ÉÁî®‰∫Ü countDown Ôºå‰ΩøÂæó state &#x3D;&#x3D; 0Ôºå‰∫éÊòØÈòªÂ°ûÁöÑÁ∫øÁ®ã‰æøÂà§Êñ≠ÊàêÂäüÔºåÂÖ®ÈÉ®ÂæÄ‰∏ãÊâßË°å</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">3</span>);<br> <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;begin...&quot;</span>);<br>        sleep(<span class="hljs-number">1</span>);<br>        latch.countDown();<br>        log.debug(<span class="hljs-string">&quot;end...&#123;&#125;&quot;</span>, latch.getCount());<br>    &#125;).start();<br> <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;begin...&quot;</span>);<br>        sleep(<span class="hljs-number">2</span>);<br>        latch.countDown();<br>        log.debug(<span class="hljs-string">&quot;end...&#123;&#125;&quot;</span>, latch.getCount());<br>    &#125;).start();<br> <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;begin...&quot;</span>);<br>        sleep(<span class="hljs-number">1.5</span>);<br>        latch.countDown();<br>        log.debug(<span class="hljs-string">&quot;end...&#123;&#125;&quot;</span>, latch.getCount());<br>    &#125;).start();<br> <br>    log.debug(<span class="hljs-string">&quot;waiting...&quot;</span>);<br>    latch.await();<br>    log.debug(<span class="hljs-string">&quot;wait end...&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Â∫îÁî®‰πãÂêåÊ≠•Á≠âÂæÖÂ§öÁ∫øÁ®ãÂáÜÂ§áÂÆåÊØï</li>
<li>Â∫îÁî®‰πãÂêåÊ≠•Á≠âÂæÖÂ§ö‰∏™ËøúÁ®ãË∞ÉÁî®ÁªìÊùü</li>
</ul>
<h3 id="2-7-CyclicBarrier"><a href="#2-7-CyclicBarrier" class="headerlink" title="2.7 CyclicBarrier"></a>2.7 CyclicBarrier</h3><p>Âæ™ÁéØÊ†ÖÊ†èÔºåÁî®Êù•ËøõË°åÁ∫øÁ®ãÂçè‰ΩúÔºåÁ≠âÂæÖÁ∫øÁ®ãÊª°Ë∂≥Êüê‰∏™ËÆ°Êï∞„ÄÇÊûÑÈÄ†Êó∂ËÆæÁΩÆ„ÄéËÆ°Êï∞‰∏™Êï∞„ÄèÔºåÊØè‰∏™Á∫øÁ®ãÊâßË°åÂà∞Êüê‰∏™ÈúÄË¶Å‚ÄúÂêåÊ≠•‚ÄùÁöÑÊó∂ÂàªË∞ÉÁî® await() ÊñπÊ≥ïËøõË°åÁ≠âÂæÖÔºåÂΩìÁ≠âÂæÖÁöÑÁ∫øÁ®ãÊï∞Êª°Ë∂≥„ÄéËÆ°Êï∞‰∏™Êï∞„ÄèÊó∂ÔºåÁªßÁª≠ÊâßË°å</p>
<ul>
<li>Ë∑ü CountdownLatch ‰∏ÄÊ†∑Ôºå‰ΩÜ<strong>Ëøô‰∏™ÂèØ‰ª•ÈáçÁî®</strong>„ÄÇ</li>
</ul>
<h3 id="2-8-Á∫øÁ®ãÂÆâÂÖ®ÈõÜÂêàÁ±ªÊ¶ÇËø∞"><a href="#2-8-Á∫øÁ®ãÂÆâÂÖ®ÈõÜÂêàÁ±ªÊ¶ÇËø∞" class="headerlink" title="2.8 Á∫øÁ®ãÂÆâÂÖ®ÈõÜÂêàÁ±ªÊ¶ÇËø∞"></a>2.8 Á∫øÁ®ãÂÆâÂÖ®ÈõÜÂêàÁ±ªÊ¶ÇËø∞</h3><p><img src="/img/blogs/java/jvm-juc/juc.7.45.png" srcset="/img/loading.gif" lazyload></p>
<p>Á∫øÁ®ãÂÆâÂÖ®ÈõÜÂêàÁ±ªÂèØ‰ª•ÂàÜ‰∏∫‰∏âÂ§ßÁ±ªÔºö</p>
<ol>
<li>ÈÅóÁïôÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÈõÜÂêàÂ¶Ç  Hashtable Ôºå Vector</li>
<li>‰ΩøÁî® Collections Ë£ÖÈ•∞ÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÈõÜÂêàÔºåÂ¶ÇÔºö<ul>
<li>Collections.synchronizedCollection</li>
<li>Collections.synchronizedList</li>
<li>Collections.synchronizedMap</li>
<li>Collections.synchronizedSet</li>
<li>Collections.synchronizedNavigableMap</li>
<li>Collections.synchronizedNavigableSet    </li>
<li>Collections.synchronizedSortedMap</li>
<li>Collections.synchronizedSortedSet</li>
</ul>
</li>
<li>java.util.concurrent.*</li>
</ol>
<p>ÈáçÁÇπ‰ªãÁªç java.util.concurrent.*  ‰∏ãÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÈõÜÂêàÁ±ªÔºåÂèØ‰ª•ÂèëÁé∞ÂÆÉ‰ª¨ÊúâËßÑÂæãÔºåÈáåÈù¢ÂåÖÂê´‰∏âÁ±ªÂÖ≥ÈîÆËØçÔºö<strong>Blocking„ÄÅCopyOnWrite„ÄÅConcurrent</strong></p>
<ul>
<li>Blocking Â§ßÈÉ®ÂàÜÂÆûÁé∞Âü∫‰∫éÈîÅÔºåÂπ∂Êèê‰æõÁî®Êù•ÈòªÂ°ûÁöÑÊñπÊ≥ï</li>
<li>CopyOnWrite ‰πãÁ±ªÂÆπÂô®‰øÆÊîπÂºÄÈîÄÁõ∏ÂØπËæÉÈáç</li>
<li>Concurrent Á±ªÂûãÁöÑÂÆπÂô®<ul>
<li>ÂÜÖÈÉ®ÂæàÂ§öÊìç‰Ωú‰ΩøÁî® cas ‰ºòÂåñÔºå‰∏ÄËà¨ÂèØ‰ª•Êèê‰æõËæÉÈ´òÂêûÂêêÈáè</li>
<li>Âº±‰∏ÄËá¥ÊÄß<ul>
<li>ÈÅçÂéÜÊó∂Âº±‰∏ÄËá¥ÊÄßÔºå‰æãÂ¶ÇÔºåÂΩìÂà©Áî®Ëø≠‰ª£Âô®ÈÅçÂéÜÊó∂ÔºåÂ¶ÇÊûúÂÆπÂô®ÂèëÁîü‰øÆÊîπÔºåËø≠‰ª£Âô®‰ªçÁÑ∂ÂèØ‰ª•ÁªßÁª≠ËøõË°åÈÅçÂéÜÔºåËøôÊó∂ÂÜÖÂÆπÊòØÊóßÁöÑ</li>
<li>Ê±ÇÂ§ßÂ∞èÂº±‰∏ÄËá¥ÊÄßÔºåsize Êìç‰ΩúÊú™ÂøÖÊòØ 100% ÂáÜÁ°Æ</li>
<li>ËØªÂèñÂº±‰∏ÄËá¥ÊÄß</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ÈÅçÂéÜÊó∂Â¶ÇÊûúÂèëÁîü‰∫Ü‰øÆÊîπÔºåÂØπ‰∫éÈùûÂÆâÂÖ®ÂÆπÂô®Êù•ËÆ≤Ôºå‰ΩøÁî® fail-fast Êú∫Âà∂‰πüÂ∞±ÊòØËÆ©ÈÅçÂéÜÁ´ãÂàªÂ§±Ë¥•ÔºåÊäõÂá∫ConcurrentModificationExceptionÔºå‰∏çÂÜçÁªßÁª≠ÈÅçÂéÜ</p>
<h3 id="2-9-ConcurrentHashMapÂéüÁêÜ"><a href="#2-9-ConcurrentHashMapÂéüÁêÜ" class="headerlink" title="2.9 ConcurrentHashMapÂéüÁêÜ"></a>2.9 ConcurrentHashMapÂéüÁêÜ</h3><p>ÂØπHashMapÁöÑÂéüÂ≠êÂåñÁ±ª</p>
<p><strong>JDK 8 ConcurrentHashMap</strong>Ôºö<br><strong>ÈáçË¶ÅÂ±ûÊÄßÂíåÂÜÖÈÉ®Á±ª</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ÈªòËÆ§‰∏∫ 0</span><br><span class="hljs-comment">// ÂΩìÂàùÂßãÂåñÊó∂, ‰∏∫ -1</span><br><span class="hljs-comment">// ÂΩìÊâ©ÂÆπÊó∂, ‰∏∫ -(1 + Êâ©ÂÆπÁ∫øÁ®ãÊï∞)</span><br><span class="hljs-comment">// ÂΩìÂàùÂßãÂåñÊàñÊâ©ÂÆπÂÆåÊàêÂêéÔºå‰∏∫ ‰∏ã‰∏ÄÊ¨°ÁöÑÊâ©ÂÆπÁöÑÈòàÂÄºÂ§ßÂ∞è</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> sizeCtl;<br> <br><span class="hljs-comment">// Êï¥‰∏™ ConcurrentHashMap Â∞±ÊòØ‰∏Ä‰∏™ Node[]</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Map</span>.Entry&lt;K,V&gt; &#123;&#125;<br> <br><span class="hljs-comment">// hash Ë°®</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node&lt;K,V&gt;[] table;<br> <br><span class="hljs-comment">// Êâ©ÂÆπÊó∂ÁöÑ Êñ∞ hash Ë°®</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node&lt;K,V&gt;[] nextTable;<br> <br><span class="hljs-comment">// Êâ©ÂÆπÊó∂Â¶ÇÊûúÊüê‰∏™ bin ËøÅÁßªÂÆåÊØï, Áî® ForwardingNode ‰Ωú‰∏∫Êóß table bin ÁöÑÂ§¥ÁªìÁÇπ</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForwardingNode</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt; &#123;&#125;<br> <br><span class="hljs-comment">// Áî®Âú® compute ‰ª•Âèä computeIfAbsent Êó∂, Áî®Êù•Âç†‰Ωç, ËÆ°ÁÆóÂÆåÊàêÂêéÊõøÊç¢‰∏∫ÊôÆÈÄö Node</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReservationNode</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt; &#123;&#125;<br> <br><span class="hljs-comment">// ‰Ωú‰∏∫ treebin ÁöÑÂ§¥ËäÇÁÇπ, Â≠òÂÇ® root Âíå first</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeBin</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt; &#123;&#125;<br> <br><span class="hljs-comment">// ‰Ωú‰∏∫ treebin ÁöÑËäÇÁÇπ, Â≠òÂÇ® parent, left, right</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt; &#123;&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ÈáçË¶ÅÊñπÊ≥ï</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Ëé∑Âèñ Node[] ‰∏≠Á¨¨ i ‰∏™ Node</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> &lt;K,V&gt; Node&lt;K,V&gt; <span class="hljs-title function_">tabAt</span><span class="hljs-params">(Node&lt;K,V&gt;[] tab, <span class="hljs-type">int</span> i)</span><br>    <br><span class="hljs-comment">// cas ‰øÆÊîπ Node[] ‰∏≠Á¨¨ i ‰∏™ Node ÁöÑÂÄº, c ‰∏∫ÊóßÂÄº, v ‰∏∫Êñ∞ÂÄº</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> &lt;K,V&gt; <span class="hljs-type">boolean</span> <span class="hljs-title function_">casTabAt</span><span class="hljs-params">(Node&lt;K,V&gt;[] tab, <span class="hljs-type">int</span> i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</span><br>    <br><span class="hljs-comment">// Áõ¥Êé•‰øÆÊîπ Node[] ‰∏≠Á¨¨ i ‰∏™ Node ÁöÑÂÄº, v ‰∏∫Êñ∞ÂÄº</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> &lt;K,V&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTabAt</span><span class="hljs-params">(Node&lt;K,V&gt;[] tab, <span class="hljs-type">int</span> i, Node&lt;K,V&gt; v)</span><br></code></pre></td></tr></table></figure>

<p>Java 8 <strong>Êï∞ÁªÑÔºàNodeÔºâ +Ôºà ÈìæË°® Node | Á∫¢ÈªëÊ†ë TreeNode</strong> Ôºâ ‰ª•‰∏ãÊï∞ÁªÑÁÆÄÁß∞ÔºàtableÔºâÔºåÈìæË°®ÁÆÄÁß∞ÔºàbinÔºâ</p>
<ul>
<li>ÂàùÂßãÂåñÔºå‰ΩøÁî® cas Êù•‰øùËØÅÂπ∂ÂèëÂÆâÂÖ®ÔºåÊáíÊÉ∞ÂàùÂßãÂåñ table</li>
<li>Ê†ëÂåñÔºåÂΩì table.length &lt; 64 Êó∂ÔºåÂÖàÂ∞ùËØïÊâ©ÂÆπÔºåË∂ÖËøá 64 Êó∂ÔºåÂπ∂‰∏î bin.length &gt; 8 Êó∂Ôºå‰ºöÂ∞ÜÈìæË°®Ê†ëÂåñÔºåÊ†ëÂåñËøáÁ®ã‰ºöÁî® synchronized ÈîÅ‰ΩèÈìæË°®Â§¥</li>
<li>putÔºåÂ¶ÇÊûúËØ• bin Â∞öÊú™ÂàõÂª∫ÔºåÂè™ÈúÄË¶Å‰ΩøÁî® cas ÂàõÂª∫ binÔºõÂ¶ÇÊûúÂ∑≤ÁªèÊúâ‰∫ÜÔºåÈîÅ‰ΩèÈìæË°®Â§¥ËøõË°åÂêéÁª≠ put Êìç‰ΩúÔºåÂÖÉÁ¥†Ê∑ªÂä†Ëá≥ bin ÁöÑÂ∞æÈÉ®</li>
<li>getÔºåÊó†ÈîÅÊìç‰Ωú‰ªÖÈúÄË¶Å‰øùËØÅÂèØËßÅÊÄßÔºåÊâ©ÂÆπËøáÁ®ã‰∏≠ get Êìç‰ΩúÊãøÂà∞ÁöÑÊòØ ForwardingNode ÂÆÉ‰ºöËÆ© get Êìç‰ΩúÂú®Êñ∞ table ËøõË°åÊêúÁ¥¢</li>
<li>Êâ©ÂÆπÔºåÊâ©ÂÆπÊó∂‰ª• bin ‰∏∫Âçï‰ΩçËøõË°åÔºåÈúÄË¶ÅÂØπ bin ËøõË°å synchronizedÔºå‰ΩÜËøôÊó∂Â¶ôÁöÑÊòØÂÖ∂ÂÆÉÁ´û‰∫âÁ∫øÁ®ã‰πü‰∏çÊòØÊó†‰∫ãÂèØÂÅöÔºåÂÆÉ‰ª¨‰ºöÂ∏ÆÂä©ÊääÂÖ∂ÂÆÉ bin ËøõË°åÊâ©ÂÆπÔºåÊâ©ÂÆπÊó∂Âπ≥ÂùáÂè™Êúâ 1&#x2F;6 ÁöÑËäÇÁÇπ‰ºöÊääÂ§çÂà∂Âà∞Êñ∞ table ‰∏≠</li>
<li>sizeÔºåÂÖÉÁ¥†‰∏™Êï∞‰øùÂ≠òÂú® baseCount ‰∏≠ÔºåÂπ∂ÂèëÊó∂ÁöÑ‰∏™Êï∞ÂèòÂä®‰øùÂ≠òÂú® CounterCell[] ÂΩì‰∏≠„ÄÇÊúÄÂêéÁªüËÆ°Êï∞ÈáèÊó∂Á¥ØÂä†Âç≥ÂèØ</li>
</ul>
<h3 id="2-10-LinkedBlockingQueue"><a href="#2-10-LinkedBlockingQueue" class="headerlink" title="2.10 LinkedBlockingQueue"></a>2.10 LinkedBlockingQueue</h3><h4 id="2-10-1-Âü∫Êú¨ÁöÑÂÖ•ÈòüÂá∫Èòü"><a href="#2-10-1-Âü∫Êú¨ÁöÑÂÖ•ÈòüÂá∫Èòü" class="headerlink" title="2.10.1 Âü∫Êú¨ÁöÑÂÖ•ÈòüÂá∫Èòü"></a>2.10.1 Âü∫Êú¨ÁöÑÂÖ•ÈòüÂá∫Èòü</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueue</span>&lt;E&gt;<br>        <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BlockingQueue</span>&lt;E&gt;, java.io.Serializable &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;E&gt; &#123;<br>        E item;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * One of:</span><br><span class="hljs-comment">         * - the real successor Node(ÁúüÊ≠£ÁöÑÂêéÁªßËäÇÁÇπ)</span><br><span class="hljs-comment">         * - this Node, meaning the successor is head.next(Ëá™Â∑±, ÂèëÁîüÂú®Âá∫ÈòüÁöÑÊó∂ÂÄô)</span><br><span class="hljs-comment">         * - null, meaning there is no successor (this is the last node)(null, Ë°®Á§∫Ê≤°ÊúâÂêéÁªßËäÇÁÇπ, ÊòØÊúÄÂêé‰∫Ü)</span><br><span class="hljs-comment">         */</span><br>        Node&lt;E&gt; next;<br><br>        Node(E x) &#123; item = x; &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(Node&lt;E&gt; node)</span> &#123;<br>      <span class="hljs-comment">// assert putLock.isHeldByCurrentThread();</span><br>      <span class="hljs-comment">// assert last.next == null;</span><br>      last = last.next = node;<br>  &#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-10-2-Âä†ÈîÅÂàÜÊûê"><a href="#2-10-2-Âä†ÈîÅÂàÜÊûê" class="headerlink" title="2.10.2 Âä†ÈîÅÂàÜÊûê"></a>2.10.2 Âä†ÈîÅÂàÜÊûê</h4><p>È´òÊòé‰πãÂ§ÑÂú®‰∫é<strong>Áî®‰∫Ü‰∏§ÊääÈîÅÂíå dummy ËäÇÁÇπ</strong></p>
<ul>
<li>Áî®‰∏ÄÊääÈîÅÔºåÂêå‰∏ÄÊó∂ÂàªÔºåÊúÄÂ§öÂè™ÂÖÅËÆ∏Êúâ‰∏Ä‰∏™Á∫øÁ®ãÔºàÁîü‰∫ßËÄÖÊàñÊ∂àË¥πËÄÖÔºå‰∫åÈÄâ‰∏ÄÔºâÊâßË°å</li>
<li>Áî®‰∏§ÊääÈîÅÔºåÂêå‰∏ÄÊó∂ÂàªÔºåÂèØ‰ª•ÂÖÅËÆ∏‰∏§‰∏™Á∫øÁ®ãÂêåÊó∂Ôºà‰∏Ä‰∏™Áîü‰∫ßËÄÖ‰∏é‰∏Ä‰∏™Ê∂àË¥πËÄÖÔºâÊâßË°å<ul>
<li>Ê∂àË¥πËÄÖ‰∏éÊ∂àË¥πËÄÖÁ∫øÁ®ã‰ªçÁÑ∂‰∏≤Ë°å</li>
<li>Áîü‰∫ßËÄÖ‰∏éÁîü‰∫ßËÄÖÁ∫øÁ®ã‰ªçÁÑ∂‰∏≤Ë°å</li>
</ul>
</li>
</ul>
<p><strong>Á∫øÁ®ãÂÆâÂÖ®ÂàÜÊûê</strong></p>
<ul>
<li>ÂΩìËäÇÁÇπÊÄªÊï∞Â§ß‰∫é 2 Êó∂ÔºàÂåÖÊã¨ dummy ËäÇÁÇπÔºâÔºåputLock ‰øùËØÅÁöÑÊòØ last ËäÇÁÇπÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÔºåtakeLock ‰øùËØÅÁöÑÊòØ head ËäÇÁÇπÁöÑÁ∫øÁ®ãÂÆâÂÖ®„ÄÇ‰∏§ÊääÈîÅ‰øùËØÅ‰∫ÜÂÖ•ÈòüÂíåÂá∫ÈòüÊ≤°ÊúâÁ´û‰∫â</li>
<li>ÂΩìËäÇÁÇπÊÄªÊï∞Á≠â‰∫é 2 Êó∂ÔºàÂç≥‰∏Ä‰∏™ dummy ËäÇÁÇπÔºå‰∏Ä‰∏™Ê≠£Â∏∏ËäÇÁÇπÔºâËøôÊó∂ÂÄôÔºå‰ªçÁÑ∂ÊòØ‰∏§ÊääÈîÅÈîÅ‰∏§‰∏™ÂØπË±°Ôºå‰∏ç‰ºöÁ´û‰∫â</li>
<li>ÂΩìËäÇÁÇπÊÄªÊï∞Á≠â‰∫é 1 Êó∂ÔºàÂ∞±‰∏Ä‰∏™ dummy ËäÇÁÇπÔºâËøôÊó∂ take Á∫øÁ®ã‰ºöË¢´ notEmpty Êù°‰ª∂ÈòªÂ°ûÔºåÊúâÁ´û‰∫âÔºå‰ºöÈòªÂ°û</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Áî®‰∫é put(ÈòªÂ°û) offer(ÈùûÈòªÂ°û)</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">putLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><span class="hljs-comment">// Áî®Êà∑ take(ÈòªÂ°û) poll(ÈùûÈòªÂ°û)</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">takeLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br></code></pre></td></tr></table></figure>

<h4 id="2-10-3-ÊÄßËÉΩÊØîËæÉ"><a href="#2-10-3-ÊÄßËÉΩÊØîËæÉ" class="headerlink" title="2.10.3 ÊÄßËÉΩÊØîËæÉ"></a>2.10.3 ÊÄßËÉΩÊØîËæÉ</h4><p>‰∏ªË¶ÅÂàó‰∏æ LinkedBlockingQueue ‰∏é ArrayBlockingQueue ÁöÑÊÄßËÉΩÊØîËæÉ</p>
<ul>
<li>Linked ÊîØÊåÅÊúâÁïåÔºåArray Âº∫Âà∂ÊúâÁïå</li>
<li>Linked ÂÆûÁé∞ÊòØÈìæË°®ÔºåArray ÂÆûÁé∞ÊòØÊï∞ÁªÑ</li>
<li>Linked ÊòØÊáíÊÉ∞ÁöÑÔºåËÄå Array ÈúÄË¶ÅÊèêÂâçÂàùÂßãÂåñ Node Êï∞ÁªÑ</li>
<li>Linked ÊØèÊ¨°ÂÖ•Èòü‰ºöÁîüÊàêÊñ∞ NodeÔºåËÄå Array ÁöÑ Node ÊòØÊèêÂâçÂàõÂª∫Â•ΩÁöÑ</li>
<li>Linked ‰∏§ÊääÈîÅÔºåArray ‰∏ÄÊääÈîÅ</li>
</ul>
<h3 id="2-11-ConcurrentLinkedQueue"><a href="#2-11-ConcurrentLinkedQueue" class="headerlink" title="2.11 ConcurrentLinkedQueue"></a>2.11 ConcurrentLinkedQueue</h3><p>ConcurrentLinkedQueue ÁöÑËÆæËÆ°‰∏é LinkedBlockingQueue ÈùûÂ∏∏ÂÉèÔºå‰πüÊòØ</p>
<ul>
<li>‰∏§Êää„ÄêÈîÅ„ÄëÔºåÂêå‰∏ÄÊó∂ÂàªÔºåÂèØ‰ª•ÂÖÅËÆ∏‰∏§‰∏™Á∫øÁ®ãÂêåÊó∂Ôºà‰∏Ä‰∏™Áîü‰∫ßËÄÖ‰∏é‰∏Ä‰∏™Ê∂àË¥πËÄÖÔºâÊâßË°å</li>
<li>dummy ËäÇÁÇπÁöÑÂºïÂÖ•ËÆ©‰∏§Êää„ÄêÈîÅ„ÄëÂ∞ÜÊù•ÈîÅ‰ΩèÁöÑÊòØ‰∏çÂêåÂØπË±°ÔºåÈÅøÂÖçÁ´û‰∫â</li>
<li>Âè™ÊòØËøô„ÄêÈîÅ„Äë‰ΩøÁî®‰∫Ü cas Êù•ÂÆûÁé∞<br>‰∫ãÂÆû‰∏äÔºåConcurrentLinkedQueue Â∫îÁî®ËøòÊòØÈùûÂ∏∏ÂπøÊ≥õÁöÑ<br>‰æãÂ¶Ç‰πãÂâçËÆ≤ÁöÑ Tomcat ÁöÑ Connector ÁªìÊûÑÊó∂ÔºåAcceptor ‰Ωú‰∏∫Áîü‰∫ßËÄÖÂêë Poller Ê∂àË¥πËÄÖ‰º†ÈÄí‰∫ã‰ª∂‰ø°ÊÅØÊó∂<br>,Ê≠£ÊòØÈááÁî®‰∫ÜConcurrentLinkedQueue Â∞Ü SocketChannel Áªô Poller ‰ΩøÁî®</li>
</ul>
<h3 id="2-12-CopyOnWriteArrayList"><a href="#2-12-CopyOnWriteArrayList" class="headerlink" title="2.12 CopyOnWriteArrayList"></a>2.12 CopyOnWriteArrayList</h3><p>CopyOnWriteArraySet  ÊòØÂÆÉÁöÑÈ©¨Áî≤Â∫ïÂ±ÇÂÆûÁé∞ÈááÁî®‰∫Ü  <strong>ÂÜôÂÖ•Êó∂Êã∑Ë¥ù</strong>  ÁöÑÊÄùÊÉ≥Ôºå<strong>Â¢ûÂà†ÊîπÊìç‰Ωú‰ºöÂ∞ÜÂ∫ïÂ±ÇÊï∞ÁªÑÊã∑Ë¥ù‰∏Ä‰ªΩ</strong>ÔºåÊõ¥ÊîπÊìç‰ΩúÂú®Êñ∞Êï∞ÁªÑ‰∏äÊâßË°åÔºåËøôÊó∂‰∏çÂΩ±ÂìçÂÖ∂ÂÆÉÁ∫øÁ®ãÁöÑ<strong>Âπ∂ÂèëËØªÔºåËØªÂÜôÂàÜÁ¶ª</strong>„ÄÇ</p>
<ul>
<li>ÈÄÇÂêà„ÄéËØªÂ§öÂÜôÂ∞ë„ÄèÁöÑÂ∫îÁî®Âú∫ÊôØ</li>
</ul>
<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/JAVA/" class="category-chain-item">JAVA</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%AD%A6%E4%B9%A0/" class="print-no-link">#Â≠¶‰π†</a>
      
        <a href="/tags/JAVA/" class="print-no-link">#JAVA</a>
      
        <a href="/tags/JUC/" class="print-no-link">#JUC</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/04/12/JAVA/JVM/" title="JVMÂ≠¶‰π†Á¨îËÆ∞">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">JVMÂ≠¶‰π†Á¨îËÆ∞</span>
                        <span class="visible-mobile">‰∏ä‰∏ÄÁØá</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/04/08/JAVA/redis/" title="RedisÂ≠¶‰π†Á¨îËÆ∞ÂèäÈù¢ËØïÈóÆÈ¢òÂàÜÊûê">
                        <span class="hidden-mobile">RedisÂ≠¶‰π†Á¨îËÆ∞ÂèäÈù¢ËØïÈóÆÈ¢òÂàÜÊûê</span>
                        <span class="visible-mobile">‰∏ã‰∏ÄÁØá</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"sj2tGuxMGSDhkN5hNuOIVta1-gzGzoHsz","appKey":"ysR5OTuTzoby2oNvNyGOtXFQ","path":"window.location.pathname","placeholder":"Â¶ÇÊúâÈóÆÈ¢òÔºåÊ¨¢ËøéÊåáÊ≠£~","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ÁõÆÂΩï</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">ÊêúÁ¥¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">ÂÖ≥ÈîÆËØç</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <span>AI</span> <i class="iconfont icon-love"></i> <span>CPP</span> <i class="iconfont icon-love"></i> <span>JAVA</span> <i class="iconfont icon-love"></i> <span>CyberSec</span> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        ÊÄªËÆøÈóÆÈáè 
        <span id="busuanzi_value_site_pv"></span>
         Ê¨°
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        ÊÄªËÆøÂÆ¢Êï∞ 
        <span id="busuanzi_value_site_uv"></span>
         ‰∫∫
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/love.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiaoxingxing.js"></script>
<script src="/js/bubble.js"></script>



<!-- ‰∏ªÈ¢òÁöÑÂêØÂä®È°πÔºåÂ∞ÜÂÆÉ‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">ÂçöÂÆ¢Âú®ÂÖÅËÆ∏ JavaScript ËøêË°åÁöÑÁéØÂ¢É‰∏ãÊµèËßàÊïàÊûúÊõ¥‰Ω≥</div>
  </noscript>
<!-- hexo injector body_end start --><script src="/js/backgroundize.js"></script><!-- hexo injector body_end end --></body>
</html>
